// modules are defined as an array
// [ module function, map of requires ]
//
// map of requires is short require name -> numeric require
//
// anything defined in a previous bundle is accessed via the
// orig method which is the require for previous bundles
parcelRequire = (function (modules, cache, entry, globalName) {
  // Save the require from previous bundle to this closure if any
  var previousRequire = typeof parcelRequire === 'function' && parcelRequire;
  var nodeRequire = typeof require === 'function' && require;

  function newRequire(name, jumped) {
    if (!cache[name]) {
      if (!modules[name]) {
        // if we cannot find the module within our internal map or
        // cache jump to the current global require ie. the last bundle
        // that was added to the page.
        var currentRequire = typeof parcelRequire === 'function' && parcelRequire;
        if (!jumped && currentRequire) {
          return currentRequire(name, true);
        }

        // If there are other bundles on this page the require from the
        // previous one is saved to 'previousRequire'. Repeat this as
        // many times as there are bundles until the module is found or
        // we exhaust the require chain.
        if (previousRequire) {
          return previousRequire(name, true);
        }

        // Try the node require function if it exists.
        if (nodeRequire && typeof name === 'string') {
          return nodeRequire(name);
        }

        var err = new Error('Cannot find module \'' + name + '\'');
        err.code = 'MODULE_NOT_FOUND';
        throw err;
      }

      localRequire.resolve = resolve;
      localRequire.cache = {};

      var module = cache[name] = new newRequire.Module(name);

      modules[name][0].call(module.exports, localRequire, module, module.exports, this);
    }

    return cache[name].exports;

    function localRequire(x){
      return newRequire(localRequire.resolve(x));
    }

    function resolve(x){
      return modules[name][1][x] || x;
    }
  }

  function Module(moduleName) {
    this.id = moduleName;
    this.bundle = newRequire;
    this.exports = {};
  }

  newRequire.isParcelRequire = true;
  newRequire.Module = Module;
  newRequire.modules = modules;
  newRequire.cache = cache;
  newRequire.parent = previousRequire;
  newRequire.register = function (id, exports) {
    modules[id] = [function (require, module) {
      module.exports = exports;
    }, {}];
  };

  var error;
  for (var i = 0; i < entry.length; i++) {
    try {
      newRequire(entry[i]);
    } catch (e) {
      // Save first error but execute all entries
      if (!error) {
        error = e;
      }
    }
  }

  if (entry.length) {
    // Expose entry point to Node, AMD or browser globals
    // Based on https://github.com/ForbesLindesay/umd/blob/master/template.js
    var mainExports = newRequire(entry[entry.length - 1]);

    // CommonJS
    if (typeof exports === "object" && typeof module !== "undefined") {
      module.exports = mainExports;

    // RequireJS
    } else if (typeof define === "function" && define.amd) {
     define(function () {
       return mainExports;
     });

    // <script>
    } else if (globalName) {
      this[globalName] = mainExports;
    }
  }

  // Override the current require with this new one
  parcelRequire = newRequire;

  if (error) {
    // throw error from earlier, _after updating parcelRequire_
    throw error;
  }

  return newRequire;
})({"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/bundle-url.js":[function(require,module,exports) {
var bundleURL = null;
function getBundleURLCached() {
  if (!bundleURL) {
    bundleURL = getBundleURL();
  }
  return bundleURL;
}
function getBundleURL() {
  // Attempt to find the URL of the current script and use that as the base URL
  try {
    throw new Error();
  } catch (err) {
    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);
    if (matches) {
      return getBaseURL(matches[0]);
    }
  }
  return '/';
}
function getBaseURL(url) {
  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/, '$1') + '/';
}
exports.getBundleURL = getBundleURLCached;
exports.getBaseURL = getBaseURL;
},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/bundle-loader.js":[function(require,module,exports) {
var getBundleURL = require('./bundle-url').getBundleURL;
function loadBundlesLazy(bundles) {
  if (!Array.isArray(bundles)) {
    bundles = [bundles];
  }
  var id = bundles[bundles.length - 1];
  try {
    return Promise.resolve(require(id));
  } catch (err) {
    if (err.code === 'MODULE_NOT_FOUND') {
      return new LazyPromise(function (resolve, reject) {
        loadBundles(bundles.slice(0, -1)).then(function () {
          return require(id);
        }).then(resolve, reject);
      });
    }
    throw err;
  }
}
function loadBundles(bundles) {
  return Promise.all(bundles.map(loadBundle));
}
var bundleLoaders = {};
function registerBundleLoader(type, loader) {
  bundleLoaders[type] = loader;
}
module.exports = exports = loadBundlesLazy;
exports.load = loadBundles;
exports.register = registerBundleLoader;
var bundles = {};
function loadBundle(bundle) {
  var id;
  if (Array.isArray(bundle)) {
    id = bundle[1];
    bundle = bundle[0];
  }
  if (bundles[bundle]) {
    return bundles[bundle];
  }
  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();
  var bundleLoader = bundleLoaders[type];
  if (bundleLoader) {
    return bundles[bundle] = bundleLoader(getBundleURL() + bundle).then(function (resolved) {
      if (resolved) {
        module.bundle.register(id, resolved);
      }
      return resolved;
    }).catch(function (e) {
      delete bundles[bundle];
      throw e;
    });
  }
}
function LazyPromise(executor) {
  this.executor = executor;
  this.promise = null;
}
LazyPromise.prototype.then = function (onSuccess, onError) {
  if (this.promise === null) this.promise = new Promise(this.executor);
  return this.promise.then(onSuccess, onError);
};
LazyPromise.prototype.catch = function (onError) {
  if (this.promise === null) this.promise = new Promise(this.executor);
  return this.promise.catch(onError);
};
},{"./bundle-url":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/bundle-url.js"}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/process/browser.js":[function(require,module,exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;
function defaultSetTimout() {
  throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout() {
  throw new Error('clearTimeout has not been defined');
}
(function () {
  try {
    if (typeof setTimeout === 'function') {
      cachedSetTimeout = setTimeout;
    } else {
      cachedSetTimeout = defaultSetTimout;
    }
  } catch (e) {
    cachedSetTimeout = defaultSetTimout;
  }
  try {
    if (typeof clearTimeout === 'function') {
      cachedClearTimeout = clearTimeout;
    } else {
      cachedClearTimeout = defaultClearTimeout;
    }
  } catch (e) {
    cachedClearTimeout = defaultClearTimeout;
  }
})();
function runTimeout(fun) {
  if (cachedSetTimeout === setTimeout) {
    //normal enviroments in sane situations
    return setTimeout(fun, 0);
  }
  // if setTimeout wasn't available but was latter defined
  if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
    cachedSetTimeout = setTimeout;
    return setTimeout(fun, 0);
  }
  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedSetTimeout(fun, 0);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
      return cachedSetTimeout.call(null, fun, 0);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
      return cachedSetTimeout.call(this, fun, 0);
    }
  }
}
function runClearTimeout(marker) {
  if (cachedClearTimeout === clearTimeout) {
    //normal enviroments in sane situations
    return clearTimeout(marker);
  }
  // if clearTimeout wasn't available but was latter defined
  if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
    cachedClearTimeout = clearTimeout;
    return clearTimeout(marker);
  }
  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedClearTimeout(marker);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
      return cachedClearTimeout.call(null, marker);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
      // Some versions of I.E. have different rules for clearTimeout vs setTimeout
      return cachedClearTimeout.call(this, marker);
    }
  }
}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;
function cleanUpNextTick() {
  if (!draining || !currentQueue) {
    return;
  }
  draining = false;
  if (currentQueue.length) {
    queue = currentQueue.concat(queue);
  } else {
    queueIndex = -1;
  }
  if (queue.length) {
    drainQueue();
  }
}
function drainQueue() {
  if (draining) {
    return;
  }
  var timeout = runTimeout(cleanUpNextTick);
  draining = true;
  var len = queue.length;
  while (len) {
    currentQueue = queue;
    queue = [];
    while (++queueIndex < len) {
      if (currentQueue) {
        currentQueue[queueIndex].run();
      }
    }
    queueIndex = -1;
    len = queue.length;
  }
  currentQueue = null;
  draining = false;
  runClearTimeout(timeout);
}
process.nextTick = function (fun) {
  var args = new Array(arguments.length - 1);
  if (arguments.length > 1) {
    for (var i = 1; i < arguments.length; i++) {
      args[i - 1] = arguments[i];
    }
  }
  queue.push(new Item(fun, args));
  if (queue.length === 1 && !draining) {
    runTimeout(drainQueue);
  }
};

// v8 likes predictible objects
function Item(fun, array) {
  this.fun = fun;
  this.array = array;
}
Item.prototype.run = function () {
  this.fun.apply(null, this.array);
};
process.title = 'browser';
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};
function noop() {}
process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;
process.listeners = function (name) {
  return [];
};
process.binding = function (name) {
  throw new Error('process.binding is not supported');
};
process.cwd = function () {
  return '/';
};
process.chdir = function (dir) {
  throw new Error('process.chdir is not supported');
};
process.umask = function () {
  return 0;
};
},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/base64-js/index.js":[function(require,module,exports) {
'use strict'

exports.byteLength = byteLength
exports.toByteArray = toByteArray
exports.fromByteArray = fromByteArray

var lookup = []
var revLookup = []
var Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array

var code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
for (var i = 0, len = code.length; i < len; ++i) {
  lookup[i] = code[i]
  revLookup[code.charCodeAt(i)] = i
}

// Support decoding URL-safe base64 strings, as Node.js does.
// See: https://en.wikipedia.org/wiki/Base64#URL_applications
revLookup['-'.charCodeAt(0)] = 62
revLookup['_'.charCodeAt(0)] = 63

function getLens (b64) {
  var len = b64.length

  if (len % 4 > 0) {
    throw new Error('Invalid string. Length must be a multiple of 4')
  }

  // Trim off extra bytes after placeholder bytes are found
  // See: https://github.com/beatgammit/base64-js/issues/42
  var validLen = b64.indexOf('=')
  if (validLen === -1) validLen = len

  var placeHoldersLen = validLen === len
    ? 0
    : 4 - (validLen % 4)

  return [validLen, placeHoldersLen]
}

// base64 is 4/3 + up to two characters of the original data
function byteLength (b64) {
  var lens = getLens(b64)
  var validLen = lens[0]
  var placeHoldersLen = lens[1]
  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen
}

function _byteLength (b64, validLen, placeHoldersLen) {
  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen
}

function toByteArray (b64) {
  var tmp
  var lens = getLens(b64)
  var validLen = lens[0]
  var placeHoldersLen = lens[1]

  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))

  var curByte = 0

  // if there are placeholders, only get up to the last complete 4 chars
  var len = placeHoldersLen > 0
    ? validLen - 4
    : validLen

  var i
  for (i = 0; i < len; i += 4) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 18) |
      (revLookup[b64.charCodeAt(i + 1)] << 12) |
      (revLookup[b64.charCodeAt(i + 2)] << 6) |
      revLookup[b64.charCodeAt(i + 3)]
    arr[curByte++] = (tmp >> 16) & 0xFF
    arr[curByte++] = (tmp >> 8) & 0xFF
    arr[curByte++] = tmp & 0xFF
  }

  if (placeHoldersLen === 2) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 2) |
      (revLookup[b64.charCodeAt(i + 1)] >> 4)
    arr[curByte++] = tmp & 0xFF
  }

  if (placeHoldersLen === 1) {
    tmp =
      (revLookup[b64.charCodeAt(i)] << 10) |
      (revLookup[b64.charCodeAt(i + 1)] << 4) |
      (revLookup[b64.charCodeAt(i + 2)] >> 2)
    arr[curByte++] = (tmp >> 8) & 0xFF
    arr[curByte++] = tmp & 0xFF
  }

  return arr
}

function tripletToBase64 (num) {
  return lookup[num >> 18 & 0x3F] +
    lookup[num >> 12 & 0x3F] +
    lookup[num >> 6 & 0x3F] +
    lookup[num & 0x3F]
}

function encodeChunk (uint8, start, end) {
  var tmp
  var output = []
  for (var i = start; i < end; i += 3) {
    tmp =
      ((uint8[i] << 16) & 0xFF0000) +
      ((uint8[i + 1] << 8) & 0xFF00) +
      (uint8[i + 2] & 0xFF)
    output.push(tripletToBase64(tmp))
  }
  return output.join('')
}

function fromByteArray (uint8) {
  var tmp
  var len = uint8.length
  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes
  var parts = []
  var maxChunkLength = 16383 // must be multiple of 3

  // go through the array every three bytes, we'll deal with trailing stuff later
  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {
    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))
  }

  // pad the end with zeros, but make sure to not forget the extra bytes
  if (extraBytes === 1) {
    tmp = uint8[len - 1]
    parts.push(
      lookup[tmp >> 2] +
      lookup[(tmp << 4) & 0x3F] +
      '=='
    )
  } else if (extraBytes === 2) {
    tmp = (uint8[len - 2] << 8) + uint8[len - 1]
    parts.push(
      lookup[tmp >> 10] +
      lookup[(tmp >> 4) & 0x3F] +
      lookup[(tmp << 2) & 0x3F] +
      '='
    )
  }

  return parts.join('')
}

},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/ieee754/index.js":[function(require,module,exports) {
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
exports.read = function (buffer, offset, isLE, mLen, nBytes) {
  var e, m
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var nBits = -7
  var i = isLE ? (nBytes - 1) : 0
  var d = isLE ? -1 : 1
  var s = buffer[offset + i]

  i += d

  e = s & ((1 << (-nBits)) - 1)
  s >>= (-nBits)
  nBits += eLen
  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  m = e & ((1 << (-nBits)) - 1)
  e >>= (-nBits)
  nBits += mLen
  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}

  if (e === 0) {
    e = 1 - eBias
  } else if (e === eMax) {
    return m ? NaN : ((s ? -1 : 1) * Infinity)
  } else {
    m = m + Math.pow(2, mLen)
    e = e - eBias
  }
  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)
}

exports.write = function (buffer, value, offset, isLE, mLen, nBytes) {
  var e, m, c
  var eLen = (nBytes * 8) - mLen - 1
  var eMax = (1 << eLen) - 1
  var eBias = eMax >> 1
  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)
  var i = isLE ? 0 : (nBytes - 1)
  var d = isLE ? 1 : -1
  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0

  value = Math.abs(value)

  if (isNaN(value) || value === Infinity) {
    m = isNaN(value) ? 1 : 0
    e = eMax
  } else {
    e = Math.floor(Math.log(value) / Math.LN2)
    if (value * (c = Math.pow(2, -e)) < 1) {
      e--
      c *= 2
    }
    if (e + eBias >= 1) {
      value += rt / c
    } else {
      value += rt * Math.pow(2, 1 - eBias)
    }
    if (value * c >= 2) {
      e++
      c /= 2
    }

    if (e + eBias >= eMax) {
      m = 0
      e = eMax
    } else if (e + eBias >= 1) {
      m = ((value * c) - 1) * Math.pow(2, mLen)
      e = e + eBias
    } else {
      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)
      e = 0
    }
  }

  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}

  e = (e << mLen) | m
  eLen += mLen
  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}

  buffer[offset + i - d] |= s * 128
}

},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/isarray/index.js":[function(require,module,exports) {
var toString = {}.toString;

module.exports = Array.isArray || function (arr) {
  return toString.call(arr) == '[object Array]';
};

},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/buffer/index.js":[function(require,module,exports) {

var global = arguments[3];
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
/* eslint-disable no-proto */

'use strict'

var base64 = require('base64-js')
var ieee754 = require('ieee754')
var isArray = require('isarray')

exports.Buffer = Buffer
exports.SlowBuffer = SlowBuffer
exports.INSPECT_MAX_BYTES = 50

/**
 * If `Buffer.TYPED_ARRAY_SUPPORT`:
 *   === true    Use Uint8Array implementation (fastest)
 *   === false   Use Object implementation (most compatible, even IE6)
 *
 * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,
 * Opera 11.6+, iOS 4.2+.
 *
 * Due to various browser bugs, sometimes the Object implementation will be used even
 * when the browser supports typed arrays.
 *
 * Note:
 *
 *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,
 *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.
 *
 *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.
 *
 *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of
 *     incorrect length in some situations.

 * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they
 * get the Object implementation, which is slower but behaves correctly.
 */
Buffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined
  ? global.TYPED_ARRAY_SUPPORT
  : typedArraySupport()

/*
 * Export kMaxLength after typed array support is determined.
 */
exports.kMaxLength = kMaxLength()

function typedArraySupport () {
  try {
    var arr = new Uint8Array(1)
    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}
    return arr.foo() === 42 && // typed array instances can be augmented
        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`
        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`
  } catch (e) {
    return false
  }
}

function kMaxLength () {
  return Buffer.TYPED_ARRAY_SUPPORT
    ? 0x7fffffff
    : 0x3fffffff
}

function createBuffer (that, length) {
  if (kMaxLength() < length) {
    throw new RangeError('Invalid typed array length')
  }
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    that = new Uint8Array(length)
    that.__proto__ = Buffer.prototype
  } else {
    // Fallback: Return an object instance of the Buffer class
    if (that === null) {
      that = new Buffer(length)
    }
    that.length = length
  }

  return that
}

/**
 * The Buffer constructor returns instances of `Uint8Array` that have their
 * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of
 * `Uint8Array`, so the returned instances will have all the node `Buffer` methods
 * and the `Uint8Array` methods. Square bracket notation works as expected -- it
 * returns a single octet.
 *
 * The `Uint8Array` prototype remains unmodified.
 */

function Buffer (arg, encodingOrOffset, length) {
  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {
    return new Buffer(arg, encodingOrOffset, length)
  }

  // Common case.
  if (typeof arg === 'number') {
    if (typeof encodingOrOffset === 'string') {
      throw new Error(
        'If encoding is specified then the first argument must be a string'
      )
    }
    return allocUnsafe(this, arg)
  }
  return from(this, arg, encodingOrOffset, length)
}

Buffer.poolSize = 8192 // not used by this implementation

// TODO: Legacy, not needed anymore. Remove in next major version.
Buffer._augment = function (arr) {
  arr.__proto__ = Buffer.prototype
  return arr
}

function from (that, value, encodingOrOffset, length) {
  if (typeof value === 'number') {
    throw new TypeError('"value" argument must not be a number')
  }

  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {
    return fromArrayBuffer(that, value, encodingOrOffset, length)
  }

  if (typeof value === 'string') {
    return fromString(that, value, encodingOrOffset)
  }

  return fromObject(that, value)
}

/**
 * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError
 * if value is a number.
 * Buffer.from(str[, encoding])
 * Buffer.from(array)
 * Buffer.from(buffer)
 * Buffer.from(arrayBuffer[, byteOffset[, length]])
 **/
Buffer.from = function (value, encodingOrOffset, length) {
  return from(null, value, encodingOrOffset, length)
}

if (Buffer.TYPED_ARRAY_SUPPORT) {
  Buffer.prototype.__proto__ = Uint8Array.prototype
  Buffer.__proto__ = Uint8Array
  if (typeof Symbol !== 'undefined' && Symbol.species &&
      Buffer[Symbol.species] === Buffer) {
    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97
    Object.defineProperty(Buffer, Symbol.species, {
      value: null,
      configurable: true
    })
  }
}

function assertSize (size) {
  if (typeof size !== 'number') {
    throw new TypeError('"size" argument must be a number')
  } else if (size < 0) {
    throw new RangeError('"size" argument must not be negative')
  }
}

function alloc (that, size, fill, encoding) {
  assertSize(size)
  if (size <= 0) {
    return createBuffer(that, size)
  }
  if (fill !== undefined) {
    // Only pay attention to encoding if it's a string. This
    // prevents accidentally sending in a number that would
    // be interpretted as a start offset.
    return typeof encoding === 'string'
      ? createBuffer(that, size).fill(fill, encoding)
      : createBuffer(that, size).fill(fill)
  }
  return createBuffer(that, size)
}

/**
 * Creates a new filled Buffer instance.
 * alloc(size[, fill[, encoding]])
 **/
Buffer.alloc = function (size, fill, encoding) {
  return alloc(null, size, fill, encoding)
}

function allocUnsafe (that, size) {
  assertSize(size)
  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) {
    for (var i = 0; i < size; ++i) {
      that[i] = 0
    }
  }
  return that
}

/**
 * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.
 * */
Buffer.allocUnsafe = function (size) {
  return allocUnsafe(null, size)
}
/**
 * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.
 */
Buffer.allocUnsafeSlow = function (size) {
  return allocUnsafe(null, size)
}

function fromString (that, string, encoding) {
  if (typeof encoding !== 'string' || encoding === '') {
    encoding = 'utf8'
  }

  if (!Buffer.isEncoding(encoding)) {
    throw new TypeError('"encoding" must be a valid string encoding')
  }

  var length = byteLength(string, encoding) | 0
  that = createBuffer(that, length)

  var actual = that.write(string, encoding)

  if (actual !== length) {
    // Writing a hex string, for example, that contains invalid characters will
    // cause everything after the first invalid character to be ignored. (e.g.
    // 'abxxcd' will be treated as 'ab')
    that = that.slice(0, actual)
  }

  return that
}

function fromArrayLike (that, array) {
  var length = array.length < 0 ? 0 : checked(array.length) | 0
  that = createBuffer(that, length)
  for (var i = 0; i < length; i += 1) {
    that[i] = array[i] & 255
  }
  return that
}

function fromArrayBuffer (that, array, byteOffset, length) {
  array.byteLength // this throws if `array` is not a valid ArrayBuffer

  if (byteOffset < 0 || array.byteLength < byteOffset) {
    throw new RangeError('\'offset\' is out of bounds')
  }

  if (array.byteLength < byteOffset + (length || 0)) {
    throw new RangeError('\'length\' is out of bounds')
  }

  if (byteOffset === undefined && length === undefined) {
    array = new Uint8Array(array)
  } else if (length === undefined) {
    array = new Uint8Array(array, byteOffset)
  } else {
    array = new Uint8Array(array, byteOffset, length)
  }

  if (Buffer.TYPED_ARRAY_SUPPORT) {
    // Return an augmented `Uint8Array` instance, for best performance
    that = array
    that.__proto__ = Buffer.prototype
  } else {
    // Fallback: Return an object instance of the Buffer class
    that = fromArrayLike(that, array)
  }
  return that
}

function fromObject (that, obj) {
  if (Buffer.isBuffer(obj)) {
    var len = checked(obj.length) | 0
    that = createBuffer(that, len)

    if (that.length === 0) {
      return that
    }

    obj.copy(that, 0, 0, len)
    return that
  }

  if (obj) {
    if ((typeof ArrayBuffer !== 'undefined' &&
        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {
      if (typeof obj.length !== 'number' || isnan(obj.length)) {
        return createBuffer(that, 0)
      }
      return fromArrayLike(that, obj)
    }

    if (obj.type === 'Buffer' && isArray(obj.data)) {
      return fromArrayLike(that, obj.data)
    }
  }

  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')
}

function checked (length) {
  // Note: cannot use `length < kMaxLength()` here because that fails when
  // length is NaN (which is otherwise coerced to zero.)
  if (length >= kMaxLength()) {
    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +
                         'size: 0x' + kMaxLength().toString(16) + ' bytes')
  }
  return length | 0
}

function SlowBuffer (length) {
  if (+length != length) { // eslint-disable-line eqeqeq
    length = 0
  }
  return Buffer.alloc(+length)
}

Buffer.isBuffer = function isBuffer (b) {
  return !!(b != null && b._isBuffer)
}

Buffer.compare = function compare (a, b) {
  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {
    throw new TypeError('Arguments must be Buffers')
  }

  if (a === b) return 0

  var x = a.length
  var y = b.length

  for (var i = 0, len = Math.min(x, y); i < len; ++i) {
    if (a[i] !== b[i]) {
      x = a[i]
      y = b[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

Buffer.isEncoding = function isEncoding (encoding) {
  switch (String(encoding).toLowerCase()) {
    case 'hex':
    case 'utf8':
    case 'utf-8':
    case 'ascii':
    case 'latin1':
    case 'binary':
    case 'base64':
    case 'ucs2':
    case 'ucs-2':
    case 'utf16le':
    case 'utf-16le':
      return true
    default:
      return false
  }
}

Buffer.concat = function concat (list, length) {
  if (!isArray(list)) {
    throw new TypeError('"list" argument must be an Array of Buffers')
  }

  if (list.length === 0) {
    return Buffer.alloc(0)
  }

  var i
  if (length === undefined) {
    length = 0
    for (i = 0; i < list.length; ++i) {
      length += list[i].length
    }
  }

  var buffer = Buffer.allocUnsafe(length)
  var pos = 0
  for (i = 0; i < list.length; ++i) {
    var buf = list[i]
    if (!Buffer.isBuffer(buf)) {
      throw new TypeError('"list" argument must be an Array of Buffers')
    }
    buf.copy(buffer, pos)
    pos += buf.length
  }
  return buffer
}

function byteLength (string, encoding) {
  if (Buffer.isBuffer(string)) {
    return string.length
  }
  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&
      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {
    return string.byteLength
  }
  if (typeof string !== 'string') {
    string = '' + string
  }

  var len = string.length
  if (len === 0) return 0

  // Use a for loop to avoid recursion
  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'ascii':
      case 'latin1':
      case 'binary':
        return len
      case 'utf8':
      case 'utf-8':
      case undefined:
        return utf8ToBytes(string).length
      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return len * 2
      case 'hex':
        return len >>> 1
      case 'base64':
        return base64ToBytes(string).length
      default:
        if (loweredCase) return utf8ToBytes(string).length // assume utf8
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}
Buffer.byteLength = byteLength

function slowToString (encoding, start, end) {
  var loweredCase = false

  // No need to verify that "this.length <= MAX_UINT32" since it's a read-only
  // property of a typed array.

  // This behaves neither like String nor Uint8Array in that we set start/end
  // to their upper/lower bounds if the value passed is out of range.
  // undefined is handled specially as per ECMA-262 6th Edition,
  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.
  if (start === undefined || start < 0) {
    start = 0
  }
  // Return early if start > this.length. Done here to prevent potential uint32
  // coercion fail below.
  if (start > this.length) {
    return ''
  }

  if (end === undefined || end > this.length) {
    end = this.length
  }

  if (end <= 0) {
    return ''
  }

  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.
  end >>>= 0
  start >>>= 0

  if (end <= start) {
    return ''
  }

  if (!encoding) encoding = 'utf8'

  while (true) {
    switch (encoding) {
      case 'hex':
        return hexSlice(this, start, end)

      case 'utf8':
      case 'utf-8':
        return utf8Slice(this, start, end)

      case 'ascii':
        return asciiSlice(this, start, end)

      case 'latin1':
      case 'binary':
        return latin1Slice(this, start, end)

      case 'base64':
        return base64Slice(this, start, end)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return utf16leSlice(this, start, end)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = (encoding + '').toLowerCase()
        loweredCase = true
    }
  }
}

// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect
// Buffer instances.
Buffer.prototype._isBuffer = true

function swap (b, n, m) {
  var i = b[n]
  b[n] = b[m]
  b[m] = i
}

Buffer.prototype.swap16 = function swap16 () {
  var len = this.length
  if (len % 2 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 16-bits')
  }
  for (var i = 0; i < len; i += 2) {
    swap(this, i, i + 1)
  }
  return this
}

Buffer.prototype.swap32 = function swap32 () {
  var len = this.length
  if (len % 4 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 32-bits')
  }
  for (var i = 0; i < len; i += 4) {
    swap(this, i, i + 3)
    swap(this, i + 1, i + 2)
  }
  return this
}

Buffer.prototype.swap64 = function swap64 () {
  var len = this.length
  if (len % 8 !== 0) {
    throw new RangeError('Buffer size must be a multiple of 64-bits')
  }
  for (var i = 0; i < len; i += 8) {
    swap(this, i, i + 7)
    swap(this, i + 1, i + 6)
    swap(this, i + 2, i + 5)
    swap(this, i + 3, i + 4)
  }
  return this
}

Buffer.prototype.toString = function toString () {
  var length = this.length | 0
  if (length === 0) return ''
  if (arguments.length === 0) return utf8Slice(this, 0, length)
  return slowToString.apply(this, arguments)
}

Buffer.prototype.equals = function equals (b) {
  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')
  if (this === b) return true
  return Buffer.compare(this, b) === 0
}

Buffer.prototype.inspect = function inspect () {
  var str = ''
  var max = exports.INSPECT_MAX_BYTES
  if (this.length > 0) {
    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')
    if (this.length > max) str += ' ... '
  }
  return '<Buffer ' + str + '>'
}

Buffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {
  if (!Buffer.isBuffer(target)) {
    throw new TypeError('Argument must be a Buffer')
  }

  if (start === undefined) {
    start = 0
  }
  if (end === undefined) {
    end = target ? target.length : 0
  }
  if (thisStart === undefined) {
    thisStart = 0
  }
  if (thisEnd === undefined) {
    thisEnd = this.length
  }

  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {
    throw new RangeError('out of range index')
  }

  if (thisStart >= thisEnd && start >= end) {
    return 0
  }
  if (thisStart >= thisEnd) {
    return -1
  }
  if (start >= end) {
    return 1
  }

  start >>>= 0
  end >>>= 0
  thisStart >>>= 0
  thisEnd >>>= 0

  if (this === target) return 0

  var x = thisEnd - thisStart
  var y = end - start
  var len = Math.min(x, y)

  var thisCopy = this.slice(thisStart, thisEnd)
  var targetCopy = target.slice(start, end)

  for (var i = 0; i < len; ++i) {
    if (thisCopy[i] !== targetCopy[i]) {
      x = thisCopy[i]
      y = targetCopy[i]
      break
    }
  }

  if (x < y) return -1
  if (y < x) return 1
  return 0
}

// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,
// OR the last index of `val` in `buffer` at offset <= `byteOffset`.
//
// Arguments:
// - buffer - a Buffer to search
// - val - a string, Buffer, or number
// - byteOffset - an index into `buffer`; will be clamped to an int32
// - encoding - an optional encoding, relevant is val is a string
// - dir - true for indexOf, false for lastIndexOf
function bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {
  // Empty buffer means no match
  if (buffer.length === 0) return -1

  // Normalize byteOffset
  if (typeof byteOffset === 'string') {
    encoding = byteOffset
    byteOffset = 0
  } else if (byteOffset > 0x7fffffff) {
    byteOffset = 0x7fffffff
  } else if (byteOffset < -0x80000000) {
    byteOffset = -0x80000000
  }
  byteOffset = +byteOffset  // Coerce to Number.
  if (isNaN(byteOffset)) {
    // byteOffset: it it's undefined, null, NaN, "foo", etc, search whole buffer
    byteOffset = dir ? 0 : (buffer.length - 1)
  }

  // Normalize byteOffset: negative offsets start from the end of the buffer
  if (byteOffset < 0) byteOffset = buffer.length + byteOffset
  if (byteOffset >= buffer.length) {
    if (dir) return -1
    else byteOffset = buffer.length - 1
  } else if (byteOffset < 0) {
    if (dir) byteOffset = 0
    else return -1
  }

  // Normalize val
  if (typeof val === 'string') {
    val = Buffer.from(val, encoding)
  }

  // Finally, search either indexOf (if dir is true) or lastIndexOf
  if (Buffer.isBuffer(val)) {
    // Special case: looking for empty string/buffer always fails
    if (val.length === 0) {
      return -1
    }
    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)
  } else if (typeof val === 'number') {
    val = val & 0xFF // Search for a byte value [0-255]
    if (Buffer.TYPED_ARRAY_SUPPORT &&
        typeof Uint8Array.prototype.indexOf === 'function') {
      if (dir) {
        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)
      } else {
        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)
      }
    }
    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)
  }

  throw new TypeError('val must be string, number or Buffer')
}

function arrayIndexOf (arr, val, byteOffset, encoding, dir) {
  var indexSize = 1
  var arrLength = arr.length
  var valLength = val.length

  if (encoding !== undefined) {
    encoding = String(encoding).toLowerCase()
    if (encoding === 'ucs2' || encoding === 'ucs-2' ||
        encoding === 'utf16le' || encoding === 'utf-16le') {
      if (arr.length < 2 || val.length < 2) {
        return -1
      }
      indexSize = 2
      arrLength /= 2
      valLength /= 2
      byteOffset /= 2
    }
  }

  function read (buf, i) {
    if (indexSize === 1) {
      return buf[i]
    } else {
      return buf.readUInt16BE(i * indexSize)
    }
  }

  var i
  if (dir) {
    var foundIndex = -1
    for (i = byteOffset; i < arrLength; i++) {
      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {
        if (foundIndex === -1) foundIndex = i
        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize
      } else {
        if (foundIndex !== -1) i -= i - foundIndex
        foundIndex = -1
      }
    }
  } else {
    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength
    for (i = byteOffset; i >= 0; i--) {
      var found = true
      for (var j = 0; j < valLength; j++) {
        if (read(arr, i + j) !== read(val, j)) {
          found = false
          break
        }
      }
      if (found) return i
    }
  }

  return -1
}

Buffer.prototype.includes = function includes (val, byteOffset, encoding) {
  return this.indexOf(val, byteOffset, encoding) !== -1
}

Buffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)
}

Buffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {
  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)
}

function hexWrite (buf, string, offset, length) {
  offset = Number(offset) || 0
  var remaining = buf.length - offset
  if (!length) {
    length = remaining
  } else {
    length = Number(length)
    if (length > remaining) {
      length = remaining
    }
  }

  // must be an even number of digits
  var strLen = string.length
  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')

  if (length > strLen / 2) {
    length = strLen / 2
  }
  for (var i = 0; i < length; ++i) {
    var parsed = parseInt(string.substr(i * 2, 2), 16)
    if (isNaN(parsed)) return i
    buf[offset + i] = parsed
  }
  return i
}

function utf8Write (buf, string, offset, length) {
  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)
}

function asciiWrite (buf, string, offset, length) {
  return blitBuffer(asciiToBytes(string), buf, offset, length)
}

function latin1Write (buf, string, offset, length) {
  return asciiWrite(buf, string, offset, length)
}

function base64Write (buf, string, offset, length) {
  return blitBuffer(base64ToBytes(string), buf, offset, length)
}

function ucs2Write (buf, string, offset, length) {
  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)
}

Buffer.prototype.write = function write (string, offset, length, encoding) {
  // Buffer#write(string)
  if (offset === undefined) {
    encoding = 'utf8'
    length = this.length
    offset = 0
  // Buffer#write(string, encoding)
  } else if (length === undefined && typeof offset === 'string') {
    encoding = offset
    length = this.length
    offset = 0
  // Buffer#write(string, offset[, length][, encoding])
  } else if (isFinite(offset)) {
    offset = offset | 0
    if (isFinite(length)) {
      length = length | 0
      if (encoding === undefined) encoding = 'utf8'
    } else {
      encoding = length
      length = undefined
    }
  // legacy write(string, encoding, offset, length) - remove in v0.13
  } else {
    throw new Error(
      'Buffer.write(string, encoding, offset[, length]) is no longer supported'
    )
  }

  var remaining = this.length - offset
  if (length === undefined || length > remaining) length = remaining

  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {
    throw new RangeError('Attempt to write outside buffer bounds')
  }

  if (!encoding) encoding = 'utf8'

  var loweredCase = false
  for (;;) {
    switch (encoding) {
      case 'hex':
        return hexWrite(this, string, offset, length)

      case 'utf8':
      case 'utf-8':
        return utf8Write(this, string, offset, length)

      case 'ascii':
        return asciiWrite(this, string, offset, length)

      case 'latin1':
      case 'binary':
        return latin1Write(this, string, offset, length)

      case 'base64':
        // Warning: maxLength not taken into account in base64Write
        return base64Write(this, string, offset, length)

      case 'ucs2':
      case 'ucs-2':
      case 'utf16le':
      case 'utf-16le':
        return ucs2Write(this, string, offset, length)

      default:
        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)
        encoding = ('' + encoding).toLowerCase()
        loweredCase = true
    }
  }
}

Buffer.prototype.toJSON = function toJSON () {
  return {
    type: 'Buffer',
    data: Array.prototype.slice.call(this._arr || this, 0)
  }
}

function base64Slice (buf, start, end) {
  if (start === 0 && end === buf.length) {
    return base64.fromByteArray(buf)
  } else {
    return base64.fromByteArray(buf.slice(start, end))
  }
}

function utf8Slice (buf, start, end) {
  end = Math.min(buf.length, end)
  var res = []

  var i = start
  while (i < end) {
    var firstByte = buf[i]
    var codePoint = null
    var bytesPerSequence = (firstByte > 0xEF) ? 4
      : (firstByte > 0xDF) ? 3
      : (firstByte > 0xBF) ? 2
      : 1

    if (i + bytesPerSequence <= end) {
      var secondByte, thirdByte, fourthByte, tempCodePoint

      switch (bytesPerSequence) {
        case 1:
          if (firstByte < 0x80) {
            codePoint = firstByte
          }
          break
        case 2:
          secondByte = buf[i + 1]
          if ((secondByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)
            if (tempCodePoint > 0x7F) {
              codePoint = tempCodePoint
            }
          }
          break
        case 3:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)
            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {
              codePoint = tempCodePoint
            }
          }
          break
        case 4:
          secondByte = buf[i + 1]
          thirdByte = buf[i + 2]
          fourthByte = buf[i + 3]
          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {
            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)
            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {
              codePoint = tempCodePoint
            }
          }
      }
    }

    if (codePoint === null) {
      // we did not generate a valid codePoint so insert a
      // replacement char (U+FFFD) and advance only 1 byte
      codePoint = 0xFFFD
      bytesPerSequence = 1
    } else if (codePoint > 0xFFFF) {
      // encode to utf16 (surrogate pair dance)
      codePoint -= 0x10000
      res.push(codePoint >>> 10 & 0x3FF | 0xD800)
      codePoint = 0xDC00 | codePoint & 0x3FF
    }

    res.push(codePoint)
    i += bytesPerSequence
  }

  return decodeCodePointsArray(res)
}

// Based on http://stackoverflow.com/a/22747272/680742, the browser with
// the lowest limit is Chrome, with 0x10000 args.
// We go 1 magnitude less, for safety
var MAX_ARGUMENTS_LENGTH = 0x1000

function decodeCodePointsArray (codePoints) {
  var len = codePoints.length
  if (len <= MAX_ARGUMENTS_LENGTH) {
    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()
  }

  // Decode in chunks to avoid "call stack size exceeded".
  var res = ''
  var i = 0
  while (i < len) {
    res += String.fromCharCode.apply(
      String,
      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)
    )
  }
  return res
}

function asciiSlice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i] & 0x7F)
  }
  return ret
}

function latin1Slice (buf, start, end) {
  var ret = ''
  end = Math.min(buf.length, end)

  for (var i = start; i < end; ++i) {
    ret += String.fromCharCode(buf[i])
  }
  return ret
}

function hexSlice (buf, start, end) {
  var len = buf.length

  if (!start || start < 0) start = 0
  if (!end || end < 0 || end > len) end = len

  var out = ''
  for (var i = start; i < end; ++i) {
    out += toHex(buf[i])
  }
  return out
}

function utf16leSlice (buf, start, end) {
  var bytes = buf.slice(start, end)
  var res = ''
  for (var i = 0; i < bytes.length; i += 2) {
    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)
  }
  return res
}

Buffer.prototype.slice = function slice (start, end) {
  var len = this.length
  start = ~~start
  end = end === undefined ? len : ~~end

  if (start < 0) {
    start += len
    if (start < 0) start = 0
  } else if (start > len) {
    start = len
  }

  if (end < 0) {
    end += len
    if (end < 0) end = 0
  } else if (end > len) {
    end = len
  }

  if (end < start) end = start

  var newBuf
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    newBuf = this.subarray(start, end)
    newBuf.__proto__ = Buffer.prototype
  } else {
    var sliceLen = end - start
    newBuf = new Buffer(sliceLen, undefined)
    for (var i = 0; i < sliceLen; ++i) {
      newBuf[i] = this[i + start]
    }
  }

  return newBuf
}

/*
 * Need to make sure that buffer isn't trying to write out of bounds.
 */
function checkOffset (offset, ext, length) {
  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')
  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')
}

Buffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }

  return val
}

Buffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    checkOffset(offset, byteLength, this.length)
  }

  var val = this[offset + --byteLength]
  var mul = 1
  while (byteLength > 0 && (mul *= 0x100)) {
    val += this[offset + --byteLength] * mul
  }

  return val
}

Buffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  return this[offset]
}

Buffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return this[offset] | (this[offset + 1] << 8)
}

Buffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  return (this[offset] << 8) | this[offset + 1]
}

Buffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return ((this[offset]) |
      (this[offset + 1] << 8) |
      (this[offset + 2] << 16)) +
      (this[offset + 3] * 0x1000000)
}

Buffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] * 0x1000000) +
    ((this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    this[offset + 3])
}

Buffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var val = this[offset]
  var mul = 1
  var i = 0
  while (++i < byteLength && (mul *= 0x100)) {
    val += this[offset + i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) checkOffset(offset, byteLength, this.length)

  var i = byteLength
  var mul = 1
  var val = this[offset + --i]
  while (i > 0 && (mul *= 0x100)) {
    val += this[offset + --i] * mul
  }
  mul *= 0x80

  if (val >= mul) val -= Math.pow(2, 8 * byteLength)

  return val
}

Buffer.prototype.readInt8 = function readInt8 (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 1, this.length)
  if (!(this[offset] & 0x80)) return (this[offset])
  return ((0xff - this[offset] + 1) * -1)
}

Buffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset] | (this[offset + 1] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 2, this.length)
  var val = this[offset + 1] | (this[offset] << 8)
  return (val & 0x8000) ? val | 0xFFFF0000 : val
}

Buffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset]) |
    (this[offset + 1] << 8) |
    (this[offset + 2] << 16) |
    (this[offset + 3] << 24)
}

Buffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)

  return (this[offset] << 24) |
    (this[offset + 1] << 16) |
    (this[offset + 2] << 8) |
    (this[offset + 3])
}

Buffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, true, 23, 4)
}

Buffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 4, this.length)
  return ieee754.read(this, offset, false, 23, 4)
}

Buffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, true, 52, 8)
}

Buffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {
  if (!noAssert) checkOffset(offset, 8, this.length)
  return ieee754.read(this, offset, false, 52, 8)
}

function checkInt (buf, value, offset, ext, max, min) {
  if (!Buffer.isBuffer(buf)) throw new TypeError('"buffer" argument must be a Buffer instance')
  if (value > max || value < min) throw new RangeError('"value" argument is out of bounds')
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
}

Buffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var mul = 1
  var i = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  byteLength = byteLength | 0
  if (!noAssert) {
    var maxBytes = Math.pow(2, 8 * byteLength) - 1
    checkInt(this, value, offset, byteLength, maxBytes, 0)
  }

  var i = byteLength - 1
  var mul = 1
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    this[offset + i] = (value / mul) & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  this[offset] = (value & 0xff)
  return offset + 1
}

function objectWriteUInt16 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {
    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>
      (littleEndian ? i : 1 - i) * 8
  }
}

Buffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

function objectWriteUInt32 (buf, value, offset, littleEndian) {
  if (value < 0) value = 0xffffffff + value + 1
  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {
    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff
  }
}

Buffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset + 3] = (value >>> 24)
    this[offset + 2] = (value >>> 16)
    this[offset + 1] = (value >>> 8)
    this[offset] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

Buffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = 0
  var mul = 1
  var sub = 0
  this[offset] = value & 0xFF
  while (++i < byteLength && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) {
    var limit = Math.pow(2, 8 * byteLength - 1)

    checkInt(this, value, offset, byteLength, limit - 1, -limit)
  }

  var i = byteLength - 1
  var mul = 1
  var sub = 0
  this[offset + i] = value & 0xFF
  while (--i >= 0 && (mul *= 0x100)) {
    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {
      sub = 1
    }
    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF
  }

  return offset + byteLength
}

Buffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)
  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)
  if (value < 0) value = 0xff + value + 1
  this[offset] = (value & 0xff)
  return offset + 1
}

Buffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
  } else {
    objectWriteUInt16(this, value, offset, true)
  }
  return offset + 2
}

Buffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 8)
    this[offset + 1] = (value & 0xff)
  } else {
    objectWriteUInt16(this, value, offset, false)
  }
  return offset + 2
}

Buffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value & 0xff)
    this[offset + 1] = (value >>> 8)
    this[offset + 2] = (value >>> 16)
    this[offset + 3] = (value >>> 24)
  } else {
    objectWriteUInt32(this, value, offset, true)
  }
  return offset + 4
}

Buffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {
  value = +value
  offset = offset | 0
  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)
  if (value < 0) value = 0xffffffff + value + 1
  if (Buffer.TYPED_ARRAY_SUPPORT) {
    this[offset] = (value >>> 24)
    this[offset + 1] = (value >>> 16)
    this[offset + 2] = (value >>> 8)
    this[offset + 3] = (value & 0xff)
  } else {
    objectWriteUInt32(this, value, offset, false)
  }
  return offset + 4
}

function checkIEEE754 (buf, value, offset, ext, max, min) {
  if (offset + ext > buf.length) throw new RangeError('Index out of range')
  if (offset < 0) throw new RangeError('Index out of range')
}

function writeFloat (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)
  }
  ieee754.write(buf, value, offset, littleEndian, 23, 4)
  return offset + 4
}

Buffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {
  return writeFloat(this, value, offset, true, noAssert)
}

Buffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {
  return writeFloat(this, value, offset, false, noAssert)
}

function writeDouble (buf, value, offset, littleEndian, noAssert) {
  if (!noAssert) {
    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)
  }
  ieee754.write(buf, value, offset, littleEndian, 52, 8)
  return offset + 8
}

Buffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {
  return writeDouble(this, value, offset, true, noAssert)
}

Buffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {
  return writeDouble(this, value, offset, false, noAssert)
}

// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)
Buffer.prototype.copy = function copy (target, targetStart, start, end) {
  if (!start) start = 0
  if (!end && end !== 0) end = this.length
  if (targetStart >= target.length) targetStart = target.length
  if (!targetStart) targetStart = 0
  if (end > 0 && end < start) end = start

  // Copy 0 bytes; we're done
  if (end === start) return 0
  if (target.length === 0 || this.length === 0) return 0

  // Fatal error conditions
  if (targetStart < 0) {
    throw new RangeError('targetStart out of bounds')
  }
  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')
  if (end < 0) throw new RangeError('sourceEnd out of bounds')

  // Are we oob?
  if (end > this.length) end = this.length
  if (target.length - targetStart < end - start) {
    end = target.length - targetStart + start
  }

  var len = end - start
  var i

  if (this === target && start < targetStart && targetStart < end) {
    // descending copy from end
    for (i = len - 1; i >= 0; --i) {
      target[i + targetStart] = this[i + start]
    }
  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {
    // ascending copy from start
    for (i = 0; i < len; ++i) {
      target[i + targetStart] = this[i + start]
    }
  } else {
    Uint8Array.prototype.set.call(
      target,
      this.subarray(start, start + len),
      targetStart
    )
  }

  return len
}

// Usage:
//    buffer.fill(number[, offset[, end]])
//    buffer.fill(buffer[, offset[, end]])
//    buffer.fill(string[, offset[, end]][, encoding])
Buffer.prototype.fill = function fill (val, start, end, encoding) {
  // Handle string cases:
  if (typeof val === 'string') {
    if (typeof start === 'string') {
      encoding = start
      start = 0
      end = this.length
    } else if (typeof end === 'string') {
      encoding = end
      end = this.length
    }
    if (val.length === 1) {
      var code = val.charCodeAt(0)
      if (code < 256) {
        val = code
      }
    }
    if (encoding !== undefined && typeof encoding !== 'string') {
      throw new TypeError('encoding must be a string')
    }
    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {
      throw new TypeError('Unknown encoding: ' + encoding)
    }
  } else if (typeof val === 'number') {
    val = val & 255
  }

  // Invalid ranges are not set to a default, so can range check early.
  if (start < 0 || this.length < start || this.length < end) {
    throw new RangeError('Out of range index')
  }

  if (end <= start) {
    return this
  }

  start = start >>> 0
  end = end === undefined ? this.length : end >>> 0

  if (!val) val = 0

  var i
  if (typeof val === 'number') {
    for (i = start; i < end; ++i) {
      this[i] = val
    }
  } else {
    var bytes = Buffer.isBuffer(val)
      ? val
      : utf8ToBytes(new Buffer(val, encoding).toString())
    var len = bytes.length
    for (i = 0; i < end - start; ++i) {
      this[i + start] = bytes[i % len]
    }
  }

  return this
}

// HELPER FUNCTIONS
// ================

var INVALID_BASE64_RE = /[^+\/0-9A-Za-z-_]/g

function base64clean (str) {
  // Node strips out invalid characters like \n and \t from the string, base64-js does not
  str = stringtrim(str).replace(INVALID_BASE64_RE, '')
  // Node converts strings with length < 2 to ''
  if (str.length < 2) return ''
  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not
  while (str.length % 4 !== 0) {
    str = str + '='
  }
  return str
}

function stringtrim (str) {
  if (str.trim) return str.trim()
  return str.replace(/^\s+|\s+$/g, '')
}

function toHex (n) {
  if (n < 16) return '0' + n.toString(16)
  return n.toString(16)
}

function utf8ToBytes (string, units) {
  units = units || Infinity
  var codePoint
  var length = string.length
  var leadSurrogate = null
  var bytes = []

  for (var i = 0; i < length; ++i) {
    codePoint = string.charCodeAt(i)

    // is surrogate component
    if (codePoint > 0xD7FF && codePoint < 0xE000) {
      // last char was a lead
      if (!leadSurrogate) {
        // no lead yet
        if (codePoint > 0xDBFF) {
          // unexpected trail
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        } else if (i + 1 === length) {
          // unpaired lead
          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
          continue
        }

        // valid lead
        leadSurrogate = codePoint

        continue
      }

      // 2 leads in a row
      if (codePoint < 0xDC00) {
        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
        leadSurrogate = codePoint
        continue
      }

      // valid surrogate pair
      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000
    } else if (leadSurrogate) {
      // valid bmp char, but last char was a lead
      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)
    }

    leadSurrogate = null

    // encode utf8
    if (codePoint < 0x80) {
      if ((units -= 1) < 0) break
      bytes.push(codePoint)
    } else if (codePoint < 0x800) {
      if ((units -= 2) < 0) break
      bytes.push(
        codePoint >> 0x6 | 0xC0,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x10000) {
      if ((units -= 3) < 0) break
      bytes.push(
        codePoint >> 0xC | 0xE0,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else if (codePoint < 0x110000) {
      if ((units -= 4) < 0) break
      bytes.push(
        codePoint >> 0x12 | 0xF0,
        codePoint >> 0xC & 0x3F | 0x80,
        codePoint >> 0x6 & 0x3F | 0x80,
        codePoint & 0x3F | 0x80
      )
    } else {
      throw new Error('Invalid code point')
    }
  }

  return bytes
}

function asciiToBytes (str) {
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    // Node's code seems to be doing this and not & 0x7F..
    byteArray.push(str.charCodeAt(i) & 0xFF)
  }
  return byteArray
}

function utf16leToBytes (str, units) {
  var c, hi, lo
  var byteArray = []
  for (var i = 0; i < str.length; ++i) {
    if ((units -= 2) < 0) break

    c = str.charCodeAt(i)
    hi = c >> 8
    lo = c % 256
    byteArray.push(lo)
    byteArray.push(hi)
  }

  return byteArray
}

function base64ToBytes (str) {
  return base64.toByteArray(base64clean(str))
}

function blitBuffer (src, dst, offset, length) {
  for (var i = 0; i < length; ++i) {
    if ((i + offset >= dst.length) || (i >= src.length)) break
    dst[i + offset] = src[i]
  }
  return i
}

function isnan (val) {
  return val !== val // eslint-disable-line no-self-compare
}

},{"base64-js":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/base64-js/index.js","ieee754":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/ieee754/index.js","isarray":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/isarray/index.js","buffer":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/buffer/index.js"}],"node_modules/@splinetool/runtime/build/runtime.js":[function(require,module,exports) {
var define;
var global = arguments[3];
var process = require("process");
var Buffer = require("buffer").Buffer;
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Application = void 0;
var _excluded = ["texture"],
  _excluded2 = ["texture"],
  _excluded3 = ["name"],
  _excluded4 = ["material"],
  _excluded5 = ["enabled"],
  _excluded6 = ["name"];
var _gn;
function _wrapRegExp() { _wrapRegExp = function _wrapRegExp(e, r) { return new BabelRegExp(e, void 0, r); }; var e = RegExp.prototype, r = new WeakMap(); function BabelRegExp(e, t, p) { var o = new RegExp(e, t); return r.set(o, p || r.get(e)), _setPrototypeOf(o, BabelRegExp.prototype); } function buildGroups(e, t) { var p = r.get(t); return Object.keys(p).reduce(function (r, t) { var o = p[t]; if ("number" == typeof o) r[t] = e[o];else { for (var i = 0; void 0 === e[o[i]] && i + 1 < o.length;) i++; r[t] = e[o[i]]; } return r; }, Object.create(null)); } return _inherits(BabelRegExp, RegExp), BabelRegExp.prototype.exec = function (r) { var t = e.exec.call(this, r); if (t) { t.groups = buildGroups(t, this); var p = t.indices; p && (p.groups = buildGroups(p, this)); } return t; }, BabelRegExp.prototype[Symbol.replace] = function (t, p) { if ("string" == typeof p) { var o = r.get(this); return e[Symbol.replace].call(this, t, p.replace(/\$<([^>]+)>/g, function (e, r) { var t = o[r]; return "$" + (Array.isArray(t) ? t.join("$") : t); })); } if ("function" == typeof p) { var i = this; return e[Symbol.replace].call(this, t, function () { var e = arguments; return "object" != _typeof(e[e.length - 1]) && (e = [].slice.call(e)).push(buildGroups(e, i)), p.apply(this, e); }); } return e[Symbol.replace].call(this, t, p); }, _wrapRegExp.apply(this, arguments); }
function set(target, property, value, receiver) { if (typeof Reflect !== "undefined" && Reflect.set) { set = Reflect.set; } else { set = function set(target, property, value, receiver) { var base = _superPropBase(target, property); var desc; if (base) { desc = Object.getOwnPropertyDescriptor(base, property); if (desc.set) { desc.set.call(receiver, value); return true; } else if (!desc.writable) { return false; } } desc = Object.getOwnPropertyDescriptor(receiver, property); if (desc) { if (!desc.writable) { return false; } desc.value = value; Object.defineProperty(receiver, property, desc); } else { _defineProperty(receiver, property, value); } return true; }; } return set(target, property, value, receiver); }
function _set(target, property, value, receiver, isStrict) { var s = set(target, property, value, receiver || target); if (!s && isStrict) { throw new TypeError('failed to set property'); } return value; }
function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }
function _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }
function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest(); }
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }
function _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct.bind(); } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }
function _isNativeFunction(fn) { try { return Function.toString.call(fn).indexOf("[native code]") !== -1; } catch (e) { return typeof fn === "function"; } }
function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }
function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
function _get() { if (typeof Reflect !== "undefined" && Reflect.get) { _get = Reflect.get.bind(); } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }
function _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }
function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }
function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }
function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }
function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }
function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }
function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }
function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _regeneratorRuntime() { "use strict"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = "function" == typeof Symbol ? Symbol : {}, a = i.iterator || "@@iterator", c = i.asyncIterator || "@@asyncIterator", u = i.toStringTag || "@@toStringTag"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, ""); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, "_invoke", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: "normal", arg: t.call(e, r) }; } catch (t) { return { type: "throw", arg: t }; } } e.wrap = wrap; var h = "suspendedStart", l = "suspendedYield", f = "executing", s = "completed", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { ["next", "throw", "return"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if ("throw" !== c.type) { var u = c.arg, h = u.value; return h && "object" == _typeof(h) && n.call(h, "__await") ? e.resolve(h.__await).then(function (t) { invoke("next", t, i, a); }, function (t) { invoke("throw", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke("throw", t, i, a); }); } a(c.arg); } var r; o(this, "_invoke", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw new Error("Generator is already running"); if (o === s) { if ("throw" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if ("next" === n.method) n.sent = n._sent = n.arg;else if ("throw" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else "return" === n.method && n.abrupt("return", n.arg); o = f; var p = tryCatch(e, r, n); if ("normal" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } "throw" === p.type && (o = s, n.method = "throw", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, "throw" === n && e.iterator.return && (r.method = "return", r.arg = t, maybeInvokeDelegate(e, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), y; var i = tryCatch(o, e.iterator, r.arg); if ("throw" === i.type) return r.method = "throw", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, "return" !== r.method && (r.method = "next", r.arg = t), r.delegate = null, y) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = "normal", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: "root" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || "" === e) { var r = e[a]; if (r) return r.call(e); if ("function" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + " is not iterable"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, "constructor", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, "constructor", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, "GeneratorFunction"), e.isGeneratorFunction = function (t) { var e = "function" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || "GeneratorFunction" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, "GeneratorFunction")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, "Generator"), define(g, a, function () { return this; }), define(g, "toString", function () { return "[object Generator]"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = "next", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if ("throw" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = "throw", a.arg = e, r.next = n, o && (r.method = "next", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if ("root" === i.tryLoc) return handle("end"); if (i.tryLoc <= this.prev) { var c = n.call(i, "catchLoc"), u = n.call(i, "finallyLoc"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw new Error("try statement without catch or finally"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) { var i = o; break; } } i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if ("throw" === t.type) throw t.arg; return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, catch: function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if ("throw" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw new Error("illegal catch attempt"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, "next" === this.method && (this.arg = t), y; } }, e; }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e74) { throw _e74; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e75) { didErr = true; err = _e75; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
var ON = Object.create;
var Sg = Object.defineProperty;
var IN = Object.getOwnPropertyDescriptor;
var RN = Object.getOwnPropertyNames;
var LN = Object.getPrototypeOf,
  BN = Object.prototype.hasOwnProperty;
var NN = function NN(n, t, e) {
  return t in n ? Sg(n, t, {
    enumerable: !0,
    configurable: !0,
    writable: !0,
    value: e
  }) : n[t] = e;
};
var en = function en(n, t) {
    return function () {
      return t || n((t = {
        exports: {}
      }).exports, t), t.exports;
    };
  },
  FN = function FN(n, t) {
    for (var e in t) Sg(n, e, {
      get: t[e],
      enumerable: !0
    });
  },
  kN = function kN(n, t, e, r) {
    if (t && _typeof(t) == "object" || typeof t == "function") {
      var _iterator = _createForOfIteratorHelper(RN(t)),
        _step;
      try {
        var _loop = function _loop() {
          var i = _step.value;
          !BN.call(n, i) && i !== e && Sg(n, i, {
            get: function get() {
              return t[i];
            },
            enumerable: !(r = IN(t, i)) || r.enumerable
          });
        };
        for (_iterator.s(); !(_step = _iterator.n()).done;) {
          _loop();
        }
      } catch (err) {
        _iterator.e(err);
      } finally {
        _iterator.f();
      }
    }
    return n;
  };
var Pi = function Pi(n, t, e) {
  return e = n != null ? ON(LN(n)) : {}, kN(t || !n || !n.__esModule ? Sg(e, "default", {
    value: n,
    enumerable: !0
  }) : e, n);
};
var Di = function Di(n, t, e) {
  return NN(n, _typeof(t) != "symbol" ? t + "" : t, e), e;
};
var uO = en(function (B1, cO) {
  (function (n, t) {
    _typeof(B1) == "object" ? cO.exports = t() : typeof define == "function" && define.amd ? define(t) : n.Alea = t();
  })(B1, function () {
    "use strict";

    return n.importState = function (e) {
      var r = new n();
      return r.importState(e), r;
    }, n;
    function n() {
      return function (e) {
        var r = 0,
          i = 0,
          s = 0,
          o = 1;
        e.length == 0 && (e = [+new Date()]);
        var a = t();
        r = a(" "), i = a(" "), s = a(" ");
        for (var l = 0; l < e.length; l++) r -= a(e[l]), r < 0 && (r += 1), i -= a(e[l]), i < 0 && (i += 1), s -= a(e[l]), s < 0 && (s += 1);
        a = null;
        var u = function u() {
          var c = 2091639 * r + o * 23283064365386963e-26;
          return r = i, i = s, s = c - (o = c | 0);
        };
        return u.next = u, u.uint32 = function () {
          return u() * 4294967296;
        }, u.fract53 = function () {
          return u() + (u() * 2097152 | 0) * 11102230246251565e-32;
        }, u.version = "Alea 0.9", u.args = e, u.exportState = function () {
          return [r, i, s, o];
        }, u.importState = function (c) {
          r = +c[0] || 0, i = +c[1] || 0, s = +c[2] || 0, o = +c[3] || 0;
        }, u;
      }(Array.prototype.slice.call(arguments));
    }
    function t() {
      var e = 4022871197,
        r = function r(i) {
          i = i.toString();
          for (var s = 0; s < i.length; s++) {
            e += i.charCodeAt(s);
            var o = .02519603282416938 * e;
            e = o >>> 0, o -= e, o *= e, e = o >>> 0, o -= e, e += o * 4294967296;
          }
          return (e >>> 0) * 23283064365386963e-26;
        };
      return r.version = "Mash 0.9", r;
    }
  });
});
var F1 = en(function (f0, pO) {
  (function (n, t) {
    _typeof(f0) == "object" && _typeof(pO) < "u" ? t(f0) : typeof define == "function" && define.amd ? define(["exports"], t) : t((n = (typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) < "u" ? globalThis : n || self).SVDJS = {});
  })(f0, function (n) {
    "use strict";

    n.SVD = function (t, e, r, i, s) {
      if (e = e === void 0 || e, r = r === void 0 || r, s = 1e-64 / (i = i || Math.pow(2, -52)), !t) throw new TypeError("Matrix a is not defined");
      var o,
        a,
        l,
        u,
        c,
        d,
        h,
        f,
        p,
        m,
        g,
        y,
        v = t[0].length,
        x = t.length;
      if (x < v) throw new TypeError("Invalid matrix: m < n");
      for (var S = [], w = [], A = [], E = e === "f" ? x : v, b = m = h = 0; b < x; b++) w[b] = new Array(E).fill(0);
      for (b = 0; b < v; b++) A[b] = new Array(v).fill(0);
      var T,
        M = new Array(v).fill(0);
      for (b = 0; b < x; b++) for (o = 0; o < v; o++) w[b][o] = t[b][o];
      for (b = 0; b < v; b++) {
        for (S[b] = h, p = 0, l = b + 1, o = b; o < x; o++) p += Math.pow(w[o][b], 2);
        if (p < s) h = 0;else for (f = (d = w[b][b]) * (h = d < 0 ? Math.sqrt(p) : -Math.sqrt(p)) - p, w[b][b] = d - h, o = l; o < v; o++) {
          for (p = 0, a = b; a < x; a++) p += w[a][b] * w[a][o];
          for (d = p / f, a = b; a < x; a++) w[a][o] = w[a][o] + d * w[a][b];
        }
        for (M[b] = h, p = 0, o = l; o < v; o++) p += Math.pow(w[b][o], 2);
        if (p < s) h = 0;else {
          for (f = (d = w[b][b + 1]) * (h = d < 0 ? Math.sqrt(p) : -Math.sqrt(p)) - p, w[b][b + 1] = d - h, o = l; o < v; o++) S[o] = w[b][o] / f;
          for (o = l; o < x; o++) {
            for (p = 0, a = l; a < v; a++) p += w[o][a] * w[b][a];
            for (a = l; a < v; a++) w[o][a] = w[o][a] + p * S[a];
          }
        }
        m < (g = Math.abs(M[b]) + Math.abs(S[b])) && (m = g);
      }
      if (r) for (b = v - 1; 0 <= b; b--) {
        if (h !== 0) {
          for (f = w[b][b + 1] * h, o = l; o < v; o++) A[o][b] = w[b][o] / f;
          for (o = l; o < v; o++) {
            for (p = 0, a = l; a < v; a++) p += w[b][a] * A[a][o];
            for (a = l; a < v; a++) A[a][o] = A[a][o] + p * A[a][b];
          }
        }
        for (o = l; o < v; o++) A[b][o] = 0, A[o][b] = 0;
        A[b][b] = 1, h = S[b], l = b;
      }
      if (e) {
        if (e === "f") for (b = v; b < x; b++) {
          for (o = v; o < x; o++) w[b][o] = 0;
          w[b][b] = 1;
        }
        for (b = v - 1; 0 <= b; b--) {
          for (l = b + 1, h = M[b], o = l; o < E; o++) w[b][o] = 0;
          if (h !== 0) {
            for (f = w[b][b] * h, o = l; o < E; o++) {
              for (p = 0, a = l; a < x; a++) p += w[a][b] * w[a][o];
              for (d = p / f, a = b; a < x; a++) w[a][o] = w[a][o] + d * w[a][b];
            }
            for (o = b; o < x; o++) w[o][b] = w[o][b] / h;
          } else for (o = b; o < x; o++) w[o][b] = 0;
          w[b][b] = w[b][b] + 1;
        }
      }
      for (i *= m, a = v - 1; 0 <= a; a--) for (var C = 0; C < 50; C++) {
        for (T = !1, l = a; 0 <= l; l--) {
          if (Math.abs(S[l]) <= i) {
            T = !0;
            break;
          }
          if (Math.abs(M[l - 1]) <= i) break;
        }
        if (!T) {
          for (c = 0, u = l - (p = 1), b = l; b < a + 1 && (d = p * S[b], S[b] = c * S[b], !(Math.abs(d) <= i)); b++) if (h = M[b], M[b] = Math.sqrt(d * d + h * h), c = h / (f = M[b]), p = -d / f, e) for (o = 0; o < x; o++) g = w[o][u], y = w[o][b], w[o][u] = g * c + y * p, w[o][b] = -g * p + y * c;
        }
        if (y = M[a], l === a) {
          if (y < 0 && (M[a] = -y, r)) for (o = 0; o < v; o++) A[o][a] = -A[o][a];
          break;
        }
        for (m = M[l], d = (((g = M[a - 1]) - y) * (g + y) + ((h = S[a - 1]) - (f = S[a])) * (h + f)) / (2 * f * g), h = Math.sqrt(d * d + 1), d = ((m - y) * (m + y) + f * (g / (d < 0 ? d - h : d + h) - f)) / m, b = l + (p = c = 1); b < a + 1; b++) {
          if (h = S[b], g = M[b], f = p * h, h *= c, y = Math.sqrt(d * d + f * f), d = m * (c = d / (S[b - 1] = y)) + h * (p = f / y), h = -m * p + h * c, f = g * p, g *= c, r) for (o = 0; o < v; o++) m = A[o][b - 1], y = A[o][b], A[o][b - 1] = m * c + y * p, A[o][b] = -m * p + y * c;
          if (y = Math.sqrt(d * d + f * f), d = (c = d / (M[b - 1] = y)) * h + (p = f / y) * g, m = -p * h + c * g, e) for (o = 0; o < x; o++) g = w[o][b - 1], y = w[o][b], w[o][b - 1] = g * c + y * p, w[o][b] = -g * p + y * c;
        }
        S[l] = 0, S[a] = d, M[a] = m;
      }
      for (b = 0; b < v; b++) M[b] < i && (M[b] = 0);
      return {
        u: w,
        q: M,
        v: A
      };
    }, n.VERSION = "1.1.1", Object.defineProperty(n, "__esModule", {
      value: !0
    });
  });
});
var UO = en(function (tA, rA) {
  (function (n, t) {
    _typeof(tA) == "object" && _typeof(rA) < "u" ? rA.exports = t() : typeof define == "function" && define.amd ? define(t) : (n = n || self, n.TinyQueue = t());
  })(tA, function () {
    "use strict";

    var n = function n(r, i) {
      if (r === void 0 && (r = []), i === void 0 && (i = t), this.data = r, this.length = this.data.length, this.compare = i, this.length > 0) for (var s = (this.length >> 1) - 1; s >= 0; s--) this._down(s);
    };
    n.prototype.push = function (r) {
      this.data.push(r), this.length++, this._up(this.length - 1);
    }, n.prototype.pop = function () {
      if (this.length !== 0) {
        var r = this.data[0],
          i = this.data.pop();
        return this.length--, this.length > 0 && (this.data[0] = i, this._down(0)), r;
      }
    }, n.prototype.peek = function () {
      return this.data[0];
    }, n.prototype._up = function (r) {
      for (var i = this, s = i.data, o = i.compare, a = s[r]; r > 0;) {
        var l = r - 1 >> 1,
          u = s[l];
        if (o(a, u) >= 0) break;
        s[r] = u, r = l;
      }
      s[r] = a;
    }, n.prototype._down = function (r) {
      for (var i = this, s = i.data, o = i.compare, a = this.length >> 1, l = s[r]; r < a;) {
        var u = (r << 1) + 1,
          c = s[u],
          d = u + 1;
        if (d < this.length && o(s[d], c) < 0 && (u = d, c = s[d]), o(c, l) >= 0) break;
        s[r] = c, r = u;
      }
      s[r] = l;
    };
    function t(e, r) {
      return e < r ? -1 : e > r ? 1 : 0;
    }
    return n;
  });
});
var jO = en(function (Sge, iA) {
  "use strict";

  var x0 = UO();
  x0.default && (x0 = x0.default);
  iA.exports = GO;
  iA.exports.default = GO;
  function GO(n, t, e) {
    t = t || 1;
    for (var r, i, s, o, a = 0; a < n[0].length; a++) {
      var l = n[0][a];
      (!a || l[0] < r) && (r = l[0]), (!a || l[1] < i) && (i = l[1]), (!a || l[0] > s) && (s = l[0]), (!a || l[1] > o) && (o = l[1]);
    }
    var u = s - r,
      c = o - i,
      d = Math.min(u, c),
      h = d / 2;
    if (d === 0) {
      var f = [r, i];
      return f.distance = 0, f;
    }
    for (var p = new x0(void 0, $9), m = r; m < s; m += d) for (var g = i; g < o; g += d) p.push(new Dl(m + h, g + h, h, n));
    var y = tY(n),
      v = new Dl(r + u / 2, i + c / 2, 0, n);
    v.d > y.d && (y = v);
    for (var x = p.length; p.length;) {
      var S = p.pop();
      S.d > y.d && (y = S, e && console.log("found best %d after %d probes", Math.round(1e4 * S.d) / 1e4, x)), !(S.max - y.d <= t) && (h = S.h / 2, p.push(new Dl(S.x - h, S.y - h, h, n)), p.push(new Dl(S.x + h, S.y - h, h, n)), p.push(new Dl(S.x - h, S.y + h, h, n)), p.push(new Dl(S.x + h, S.y + h, h, n)), x += 4);
    }
    e && (console.log("num probes: " + x), console.log("best distance: " + y.d));
    var w = [y.x, y.y];
    return w.distance = y.d, w;
  }
  function $9(n, t) {
    return t.max - n.max;
  }
  function Dl(n, t, e, r) {
    this.x = n, this.y = t, this.h = e, this.d = eY(n, t, r), this.max = this.d + this.h * Math.SQRT2;
  }
  function eY(n, t, e) {
    for (var r = !1, i = 1 / 0, s = 0; s < e.length; s++) for (var o = e[s], a = 0, l = o.length, u = l - 1; a < l; u = a++) {
      var c = o[a],
        d = o[u];
      c[1] > t != d[1] > t && n < (d[0] - c[0]) * (t - c[1]) / (d[1] - c[1]) + c[0] && (r = !r), i = Math.min(i, rY(n, t, c, d));
    }
    return i === 0 ? 0 : (r ? 1 : -1) * Math.sqrt(i);
  }
  function tY(n) {
    for (var t = 0, e = 0, r = 0, i = n[0], s = 0, o = i.length, a = o - 1; s < o; a = s++) {
      var l = i[s],
        u = i[a],
        c = l[0] * u[1] - u[0] * l[1];
      e += (l[0] + u[0]) * c, r += (l[1] + u[1]) * c, t += c * 3;
    }
    return t === 0 ? new Dl(i[0][0], i[0][1], 0, n) : new Dl(e / t, r / t, 0, n);
  }
  function rY(n, t, e, r) {
    var i = e[0],
      s = e[1],
      o = r[0] - i,
      a = r[1] - s;
    if (o !== 0 || a !== 0) {
      var l = ((n - i) * o + (t - s) * a) / (o * o + a * a);
      l > 1 ? (i = r[0], s = r[1]) : l > 0 && (i += o * l, s += a * l);
    }
    return o = n - i, a = t - s, o * o + a * a;
  }
});
var GI = en(function (H0, UI) {
  "use strict";

  Object.defineProperty(H0, "__esModule", {
    value: !0
  });
  H0.default = t7;
  function t7(n) {
    if (n === null || n === !0 || n === !1) return NaN;
    var t = Number(n);
    return isNaN(t) ? t : t < 0 ? Math.ceil(t) : Math.floor(t);
  }
  UI.exports = H0.default;
});
var HI = en(function (W0, jI) {
  "use strict";

  Object.defineProperty(W0, "__esModule", {
    value: !0
  });
  W0.default = r7;
  function r7(n) {
    var t = new Date(Date.UTC(n.getFullYear(), n.getMonth(), n.getDate(), n.getHours(), n.getMinutes(), n.getSeconds(), n.getMilliseconds()));
    return t.setUTCFullYear(n.getFullYear()), n.getTime() - t.getTime();
  }
  jI.exports = W0.default;
});
var eR = en(function (X0) {
  (function () {
    "use strict";

    var n = function n() {
      this.init();
    };
    n.prototype = {
      init: function init() {
        var c = this || t;
        return c._counter = 1e3, c._html5AudioPool = [], c.html5PoolSize = 10, c._codecs = {}, c._howls = [], c._muted = !1, c._volume = 1, c._canPlayEvent = "canplaythrough", c._navigator = (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && window.navigator ? window.navigator : null, c.masterGain = null, c.noAudio = !1, c.usingWebAudio = !0, c.autoSuspend = !0, c.ctx = null, c.autoUnlock = !0, c._setup(), c;
      },
      volume: function volume(c) {
        var d = this || t;
        if (c = parseFloat(c), d.ctx || u(), _typeof(c) < "u" && c >= 0 && c <= 1) {
          if (d._volume = c, d._muted) return d;
          d.usingWebAudio && d.masterGain.gain.setValueAtTime(c, t.ctx.currentTime);
          for (var h = 0; h < d._howls.length; h++) if (!d._howls[h]._webAudio) for (var f = d._howls[h]._getSoundIds(), p = 0; p < f.length; p++) {
            var m = d._howls[h]._soundById(f[p]);
            m && m._node && (m._node.volume = m._volume * c);
          }
          return d;
        }
        return d._volume;
      },
      mute: function mute(c) {
        var d = this || t;
        d.ctx || u(), d._muted = c, d.usingWebAudio && d.masterGain.gain.setValueAtTime(c ? 0 : d._volume, t.ctx.currentTime);
        for (var h = 0; h < d._howls.length; h++) if (!d._howls[h]._webAudio) for (var f = d._howls[h]._getSoundIds(), p = 0; p < f.length; p++) {
          var m = d._howls[h]._soundById(f[p]);
          m && m._node && (m._node.muted = c ? !0 : m._muted);
        }
        return d;
      },
      stop: function stop() {
        for (var c = this || t, d = 0; d < c._howls.length; d++) c._howls[d].stop();
        return c;
      },
      unload: function unload() {
        for (var c = this || t, d = c._howls.length - 1; d >= 0; d--) c._howls[d].unload();
        return c.usingWebAudio && c.ctx && _typeof(c.ctx.close) < "u" && (c.ctx.close(), c.ctx = null, u()), c;
      },
      codecs: function codecs(c) {
        return (this || t)._codecs[c.replace(/^x-/, "")];
      },
      _setup: function _setup() {
        var c = this || t;
        if (c.state = c.ctx && c.ctx.state || "suspended", c._autoSuspend(), !c.usingWebAudio) if ((typeof Audio === "undefined" ? "undefined" : _typeof(Audio)) < "u") try {
          var d = new Audio();
          _typeof(d.oncanplaythrough) > "u" && (c._canPlayEvent = "canplay");
        } catch (_unused) {
          c.noAudio = !0;
        } else c.noAudio = !0;
        try {
          var d = new Audio();
          d.muted && (c.noAudio = !0);
        } catch (_unused2) {}
        return c.noAudio || c._setupCodecs(), c;
      },
      _setupCodecs: function _setupCodecs() {
        var c = this || t,
          d = null;
        try {
          d = (typeof Audio === "undefined" ? "undefined" : _typeof(Audio)) < "u" ? new Audio() : null;
        } catch (_unused3) {
          return c;
        }
        if (!d || typeof d.canPlayType != "function") return c;
        var h = d.canPlayType("audio/mpeg;").replace(/^no$/, ""),
          f = c._navigator ? c._navigator.userAgent : "",
          p = f.match(/OPR\/([0-6].)/g),
          m = p && parseInt(p[0].split("/")[1], 10) < 33,
          g = f.indexOf("Safari") !== -1 && f.indexOf("Chrome") === -1,
          y = f.match(/Version\/(.*?) /),
          v = g && y && parseInt(y[1], 10) < 15;
        return c._codecs = {
          mp3: !!(!m && (h || d.canPlayType("audio/mp3;").replace(/^no$/, ""))),
          mpeg: !!h,
          opus: !!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/, ""),
          ogg: !!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
          oga: !!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""),
          wav: !!(d.canPlayType('audio/wav; codecs="1"') || d.canPlayType("audio/wav")).replace(/^no$/, ""),
          aac: !!d.canPlayType("audio/aac;").replace(/^no$/, ""),
          caf: !!d.canPlayType("audio/x-caf;").replace(/^no$/, ""),
          m4a: !!(d.canPlayType("audio/x-m4a;") || d.canPlayType("audio/m4a;") || d.canPlayType("audio/aac;")).replace(/^no$/, ""),
          m4b: !!(d.canPlayType("audio/x-m4b;") || d.canPlayType("audio/m4b;") || d.canPlayType("audio/aac;")).replace(/^no$/, ""),
          mp4: !!(d.canPlayType("audio/x-mp4;") || d.canPlayType("audio/mp4;") || d.canPlayType("audio/aac;")).replace(/^no$/, ""),
          weba: !!(!v && d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, "")),
          webm: !!(!v && d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/, "")),
          dolby: !!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/, ""),
          flac: !!(d.canPlayType("audio/x-flac;") || d.canPlayType("audio/flac;")).replace(/^no$/, "")
        }, c;
      },
      _unlockAudio: function _unlockAudio() {
        var c = this || t;
        if (!(c._audioUnlocked || !c.ctx)) {
          c._audioUnlocked = !1, c.autoUnlock = !1, !c._mobileUnloaded && c.ctx.sampleRate !== 44100 && (c._mobileUnloaded = !0, c.unload()), c._scratchBuffer = c.ctx.createBuffer(1, 1, 22050);
          var d = function d(h) {
            for (; c._html5AudioPool.length < c.html5PoolSize;) try {
              var f = new Audio();
              f._unlocked = !0, c._releaseHtml5Audio(f);
            } catch (_unused4) {
              c.noAudio = !0;
              break;
            }
            for (var p = 0; p < c._howls.length; p++) if (!c._howls[p]._webAudio) for (var m = c._howls[p]._getSoundIds(), g = 0; g < m.length; g++) {
              var y = c._howls[p]._soundById(m[g]);
              y && y._node && !y._node._unlocked && (y._node._unlocked = !0, y._node.load());
            }
            c._autoResume();
            var v = c.ctx.createBufferSource();
            v.buffer = c._scratchBuffer, v.connect(c.ctx.destination), _typeof(v.start) > "u" ? v.noteOn(0) : v.start(0), typeof c.ctx.resume == "function" && c.ctx.resume(), v.onended = function () {
              v.disconnect(0), c._audioUnlocked = !0, document.removeEventListener("touchstart", d, !0), document.removeEventListener("touchend", d, !0), document.removeEventListener("click", d, !0), document.removeEventListener("keydown", d, !0);
              for (var x = 0; x < c._howls.length; x++) c._howls[x]._emit("unlock");
            };
          };
          return document.addEventListener("touchstart", d, !0), document.addEventListener("touchend", d, !0), document.addEventListener("click", d, !0), document.addEventListener("keydown", d, !0), c;
        }
      },
      _obtainHtml5Audio: function _obtainHtml5Audio() {
        var c = this || t;
        if (c._html5AudioPool.length) return c._html5AudioPool.pop();
        var d = new Audio().play();
        return d && (typeof Promise === "undefined" ? "undefined" : _typeof(Promise)) < "u" && (d instanceof Promise || typeof d.then == "function") && d.catch(function () {
          console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.");
        }), new Audio();
      },
      _releaseHtml5Audio: function _releaseHtml5Audio(c) {
        var d = this || t;
        return c._unlocked && d._html5AudioPool.push(c), d;
      },
      _autoSuspend: function _autoSuspend() {
        var c = this;
        if (!(!c.autoSuspend || !c.ctx || _typeof(c.ctx.suspend) > "u" || !t.usingWebAudio)) {
          for (var d = 0; d < c._howls.length; d++) if (c._howls[d]._webAudio) {
            for (var h = 0; h < c._howls[d]._sounds.length; h++) if (!c._howls[d]._sounds[h]._paused) return c;
          }
          return c._suspendTimer && clearTimeout(c._suspendTimer), c._suspendTimer = setTimeout(function () {
            if (!!c.autoSuspend) {
              c._suspendTimer = null, c.state = "suspending";
              var f = function f() {
                c.state = "suspended", c._resumeAfterSuspend && (delete c._resumeAfterSuspend, c._autoResume());
              };
              c.ctx.suspend().then(f, f);
            }
          }, 3e4), c;
        }
      },
      _autoResume: function _autoResume() {
        var c = this;
        if (!(!c.ctx || _typeof(c.ctx.resume) > "u" || !t.usingWebAudio)) return c.state === "running" && c.ctx.state !== "interrupted" && c._suspendTimer ? (clearTimeout(c._suspendTimer), c._suspendTimer = null) : c.state === "suspended" || c.state === "running" && c.ctx.state === "interrupted" ? (c.ctx.resume().then(function () {
          c.state = "running";
          for (var d = 0; d < c._howls.length; d++) c._howls[d]._emit("resume");
        }), c._suspendTimer && (clearTimeout(c._suspendTimer), c._suspendTimer = null)) : c.state === "suspending" && (c._resumeAfterSuspend = !0), c;
      }
    };
    var t = new n(),
      e = function e(c) {
        var d = this;
        if (!c.src || c.src.length === 0) {
          console.error("An array of source files must be passed with any new Howl.");
          return;
        }
        d.init(c);
      };
    e.prototype = {
      init: function init(c) {
        var d = this;
        return t.ctx || u(), d._autoplay = c.autoplay || !1, d._format = typeof c.format != "string" ? c.format : [c.format], d._html5 = c.html5 || !1, d._muted = c.mute || !1, d._loop = c.loop || !1, d._pool = c.pool || 5, d._preload = typeof c.preload == "boolean" || c.preload === "metadata" ? c.preload : !0, d._rate = c.rate || 1, d._sprite = c.sprite || {}, d._src = typeof c.src != "string" ? c.src : [c.src], d._volume = c.volume !== void 0 ? c.volume : 1, d._xhr = {
          method: c.xhr && c.xhr.method ? c.xhr.method : "GET",
          headers: c.xhr && c.xhr.headers ? c.xhr.headers : null,
          withCredentials: c.xhr && c.xhr.withCredentials ? c.xhr.withCredentials : !1
        }, d._duration = 0, d._state = "unloaded", d._sounds = [], d._endTimers = {}, d._queue = [], d._playLock = !1, d._onend = c.onend ? [{
          fn: c.onend
        }] : [], d._onfade = c.onfade ? [{
          fn: c.onfade
        }] : [], d._onload = c.onload ? [{
          fn: c.onload
        }] : [], d._onloaderror = c.onloaderror ? [{
          fn: c.onloaderror
        }] : [], d._onplayerror = c.onplayerror ? [{
          fn: c.onplayerror
        }] : [], d._onpause = c.onpause ? [{
          fn: c.onpause
        }] : [], d._onplay = c.onplay ? [{
          fn: c.onplay
        }] : [], d._onstop = c.onstop ? [{
          fn: c.onstop
        }] : [], d._onmute = c.onmute ? [{
          fn: c.onmute
        }] : [], d._onvolume = c.onvolume ? [{
          fn: c.onvolume
        }] : [], d._onrate = c.onrate ? [{
          fn: c.onrate
        }] : [], d._onseek = c.onseek ? [{
          fn: c.onseek
        }] : [], d._onunlock = c.onunlock ? [{
          fn: c.onunlock
        }] : [], d._onresume = [], d._webAudio = t.usingWebAudio && !d._html5, _typeof(t.ctx) < "u" && t.ctx && t.autoUnlock && t._unlockAudio(), t._howls.push(d), d._autoplay && d._queue.push({
          event: "play",
          action: function action() {
            d.play();
          }
        }), d._preload && d._preload !== "none" && d.load(), d;
      },
      load: function load() {
        var c = this,
          d = null;
        if (t.noAudio) {
          c._emit("loaderror", null, "No audio support.");
          return;
        }
        typeof c._src == "string" && (c._src = [c._src]);
        for (var h = 0; h < c._src.length; h++) {
          var f, p;
          if (c._format && c._format[h]) f = c._format[h];else {
            if (p = c._src[h], typeof p != "string") {
              c._emit("loaderror", null, "Non-string found in selected audio sources - ignoring.");
              continue;
            }
            f = /^data:audio\/([^;,]+);/i.exec(p), f || (f = /\.([^.]+)$/.exec(p.split("?", 1)[0])), f && (f = f[1].toLowerCase());
          }
          if (f || console.warn('No file extension was found. Consider using the "format" property or specify an extension.'), f && t.codecs(f)) {
            d = c._src[h];
            break;
          }
        }
        if (!d) {
          c._emit("loaderror", null, "No codec support for selected audio sources.");
          return;
        }
        return c._src = d, c._state = "loading", window.location.protocol === "https:" && d.slice(0, 5) === "http:" && (c._html5 = !0, c._webAudio = !1), new r(c), c._webAudio && s(c), c;
      },
      play: function play(c, d) {
        var h = this,
          f = null;
        if (typeof c == "number") f = c, c = null;else {
          if (typeof c == "string" && h._state === "loaded" && !h._sprite[c]) return null;
          if (_typeof(c) > "u" && (c = "__default", !h._playLock)) {
            for (var p = 0, m = 0; m < h._sounds.length; m++) h._sounds[m]._paused && !h._sounds[m]._ended && (p++, f = h._sounds[m]._id);
            p === 1 ? c = null : f = null;
          }
        }
        var g = f ? h._soundById(f) : h._inactiveSound();
        if (!g) return null;
        if (f && !c && (c = g._sprite || "__default"), h._state !== "loaded") {
          g._sprite = c, g._ended = !1;
          var y = g._id;
          return h._queue.push({
            event: "play",
            action: function action() {
              h.play(y);
            }
          }), y;
        }
        if (f && !g._paused) return d || h._loadQueue("play"), g._id;
        h._webAudio && t._autoResume();
        var v = Math.max(0, g._seek > 0 ? g._seek : h._sprite[c][0] / 1e3),
          x = Math.max(0, (h._sprite[c][0] + h._sprite[c][1]) / 1e3 - v),
          S = x * 1e3 / Math.abs(g._rate),
          w = h._sprite[c][0] / 1e3,
          A = (h._sprite[c][0] + h._sprite[c][1]) / 1e3;
        g._sprite = c, g._ended = !1;
        var E = function E() {
          g._paused = !1, g._seek = v, g._start = w, g._stop = A, g._loop = !!(g._loop || h._sprite[c][2]);
        };
        if (v >= A) {
          h._ended(g);
          return;
        }
        var b = g._node;
        if (h._webAudio) {
          var T = function T() {
            h._playLock = !1, E(), h._refreshBuffer(g);
            var D = g._muted || h._muted ? 0 : g._volume;
            b.gain.setValueAtTime(D, t.ctx.currentTime), g._playStart = t.ctx.currentTime, _typeof(b.bufferSource.start) > "u" ? g._loop ? b.bufferSource.noteGrainOn(0, v, 86400) : b.bufferSource.noteGrainOn(0, v, x) : g._loop ? b.bufferSource.start(0, v, 86400) : b.bufferSource.start(0, v, x), S !== 1 / 0 && (h._endTimers[g._id] = setTimeout(h._ended.bind(h, g), S)), d || setTimeout(function () {
              h._emit("play", g._id), h._loadQueue();
            }, 0);
          };
          t.state === "running" && t.ctx.state !== "interrupted" ? T() : (h._playLock = !0, h.once("resume", T), h._clearTimer(g._id));
        } else {
          var M = function M() {
            b.currentTime = v, b.muted = g._muted || h._muted || t._muted || b.muted, b.volume = g._volume * t.volume(), b.playbackRate = g._rate;
            try {
              var D = b.play();
              if (D && (typeof Promise === "undefined" ? "undefined" : _typeof(Promise)) < "u" && (D instanceof Promise || typeof D.then == "function") ? (h._playLock = !0, E(), D.then(function () {
                h._playLock = !1, b._unlocked = !0, d ? h._loadQueue() : h._emit("play", g._id);
              }).catch(function () {
                h._playLock = !1, h._emit("playerror", g._id, "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."), g._ended = !0, g._paused = !0;
              })) : d || (h._playLock = !1, E(), h._emit("play", g._id)), b.playbackRate = g._rate, b.paused) {
                h._emit("playerror", g._id, "Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");
                return;
              }
              c !== "__default" || g._loop ? h._endTimers[g._id] = setTimeout(h._ended.bind(h, g), S) : (h._endTimers[g._id] = function () {
                h._ended(g), b.removeEventListener("ended", h._endTimers[g._id], !1);
              }, b.addEventListener("ended", h._endTimers[g._id], !1));
            } catch (O) {
              h._emit("playerror", g._id, O);
            }
          };
          b.src === "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA" && (b.src = h._src, b.load());
          var C = window && window.ejecta || !b.readyState && t._navigator.isCocoonJS;
          if (b.readyState >= 3 || C) M();else {
            h._playLock = !0, h._state = "loading";
            var P = function P() {
              h._state = "loaded", M(), b.removeEventListener(t._canPlayEvent, P, !1);
            };
            b.addEventListener(t._canPlayEvent, P, !1), h._clearTimer(g._id);
          }
        }
        return g._id;
      },
      pause: function pause(c) {
        var d = this;
        if (d._state !== "loaded" || d._playLock) return d._queue.push({
          event: "pause",
          action: function action() {
            d.pause(c);
          }
        }), d;
        for (var h = d._getSoundIds(c), f = 0; f < h.length; f++) {
          d._clearTimer(h[f]);
          var p = d._soundById(h[f]);
          if (p && !p._paused && (p._seek = d.seek(h[f]), p._rateSeek = 0, p._paused = !0, d._stopFade(h[f]), p._node)) if (d._webAudio) {
            if (!p._node.bufferSource) continue;
            _typeof(p._node.bufferSource.stop) > "u" ? p._node.bufferSource.noteOff(0) : p._node.bufferSource.stop(0), d._cleanBuffer(p._node);
          } else (!isNaN(p._node.duration) || p._node.duration === 1 / 0) && p._node.pause();
          arguments[1] || d._emit("pause", p ? p._id : null);
        }
        return d;
      },
      stop: function stop(c, d) {
        var h = this;
        if (h._state !== "loaded" || h._playLock) return h._queue.push({
          event: "stop",
          action: function action() {
            h.stop(c);
          }
        }), h;
        for (var f = h._getSoundIds(c), p = 0; p < f.length; p++) {
          h._clearTimer(f[p]);
          var m = h._soundById(f[p]);
          m && (m._seek = m._start || 0, m._rateSeek = 0, m._paused = !0, m._ended = !0, h._stopFade(f[p]), m._node && (h._webAudio ? m._node.bufferSource && (_typeof(m._node.bufferSource.stop) > "u" ? m._node.bufferSource.noteOff(0) : m._node.bufferSource.stop(0), h._cleanBuffer(m._node)) : (!isNaN(m._node.duration) || m._node.duration === 1 / 0) && (m._node.currentTime = m._start || 0, m._node.pause(), m._node.duration === 1 / 0 && h._clearSound(m._node))), d || h._emit("stop", m._id));
        }
        return h;
      },
      mute: function mute(c, d) {
        var h = this;
        if (h._state !== "loaded" || h._playLock) return h._queue.push({
          event: "mute",
          action: function action() {
            h.mute(c, d);
          }
        }), h;
        if (_typeof(d) > "u") if (typeof c == "boolean") h._muted = c;else return h._muted;
        for (var f = h._getSoundIds(d), p = 0; p < f.length; p++) {
          var m = h._soundById(f[p]);
          m && (m._muted = c, m._interval && h._stopFade(m._id), h._webAudio && m._node ? m._node.gain.setValueAtTime(c ? 0 : m._volume, t.ctx.currentTime) : m._node && (m._node.muted = t._muted ? !0 : c), h._emit("mute", m._id));
        }
        return h;
      },
      volume: function volume() {
        var c = this,
          d = arguments,
          h,
          f;
        if (d.length === 0) return c._volume;
        if (d.length === 1 || d.length === 2 && _typeof(d[1]) > "u") {
          var p = c._getSoundIds(),
            m = p.indexOf(d[0]);
          m >= 0 ? f = parseInt(d[0], 10) : h = parseFloat(d[0]);
        } else d.length >= 2 && (h = parseFloat(d[0]), f = parseInt(d[1], 10));
        var g;
        if (_typeof(h) < "u" && h >= 0 && h <= 1) {
          if (c._state !== "loaded" || c._playLock) return c._queue.push({
            event: "volume",
            action: function action() {
              c.volume.apply(c, d);
            }
          }), c;
          _typeof(f) > "u" && (c._volume = h), f = c._getSoundIds(f);
          for (var y = 0; y < f.length; y++) g = c._soundById(f[y]), g && (g._volume = h, d[2] || c._stopFade(f[y]), c._webAudio && g._node && !g._muted ? g._node.gain.setValueAtTime(h, t.ctx.currentTime) : g._node && !g._muted && (g._node.volume = h * t.volume()), c._emit("volume", g._id));
        } else return g = f ? c._soundById(f) : c._sounds[0], g ? g._volume : 0;
        return c;
      },
      fade: function fade(c, d, h, f) {
        var p = this;
        if (p._state !== "loaded" || p._playLock) return p._queue.push({
          event: "fade",
          action: function action() {
            p.fade(c, d, h, f);
          }
        }), p;
        c = Math.min(Math.max(0, parseFloat(c)), 1), d = Math.min(Math.max(0, parseFloat(d)), 1), h = parseFloat(h), p.volume(c, f);
        for (var m = p._getSoundIds(f), g = 0; g < m.length; g++) {
          var y = p._soundById(m[g]);
          if (y) {
            if (f || p._stopFade(m[g]), p._webAudio && !y._muted) {
              var v = t.ctx.currentTime,
                x = v + h / 1e3;
              y._volume = c, y._node.gain.setValueAtTime(c, v), y._node.gain.linearRampToValueAtTime(d, x);
            }
            p._startFadeInterval(y, c, d, h, m[g], _typeof(f) > "u");
          }
        }
        return p;
      },
      _startFadeInterval: function _startFadeInterval(c, d, h, f, p, m) {
        var g = this,
          y = d,
          v = h - d,
          x = Math.abs(v / .01),
          S = Math.max(4, x > 0 ? f / x : f),
          w = Date.now();
        c._fadeTo = h, c._interval = setInterval(function () {
          var A = (Date.now() - w) / f;
          w = Date.now(), y += v * A, y = Math.round(y * 100) / 100, v < 0 ? y = Math.max(h, y) : y = Math.min(h, y), g._webAudio ? c._volume = y : g.volume(y, c._id, !0), m && (g._volume = y), (h < d && y <= h || h > d && y >= h) && (clearInterval(c._interval), c._interval = null, c._fadeTo = null, g.volume(h, c._id), g._emit("fade", c._id));
        }, S);
      },
      _stopFade: function _stopFade(c) {
        var d = this,
          h = d._soundById(c);
        return h && h._interval && (d._webAudio && h._node.gain.cancelScheduledValues(t.ctx.currentTime), clearInterval(h._interval), h._interval = null, d.volume(h._fadeTo, c), h._fadeTo = null, d._emit("fade", c)), d;
      },
      loop: function loop() {
        var c = this,
          d = arguments,
          h,
          f,
          p;
        if (d.length === 0) return c._loop;
        if (d.length === 1) {
          if (typeof d[0] == "boolean") h = d[0], c._loop = h;else return p = c._soundById(parseInt(d[0], 10)), p ? p._loop : !1;
        } else d.length === 2 && (h = d[0], f = parseInt(d[1], 10));
        for (var m = c._getSoundIds(f), g = 0; g < m.length; g++) p = c._soundById(m[g]), p && (p._loop = h, c._webAudio && p._node && p._node.bufferSource && (p._node.bufferSource.loop = h, h && (p._node.bufferSource.loopStart = p._start || 0, p._node.bufferSource.loopEnd = p._stop, c.playing(m[g]) && (c.pause(m[g], !0), c.play(m[g], !0)))));
        return c;
      },
      rate: function rate() {
        var c = this,
          d = arguments,
          h,
          f;
        if (d.length === 0) f = c._sounds[0]._id;else if (d.length === 1) {
          var p = c._getSoundIds(),
            m = p.indexOf(d[0]);
          m >= 0 ? f = parseInt(d[0], 10) : h = parseFloat(d[0]);
        } else d.length === 2 && (h = parseFloat(d[0]), f = parseInt(d[1], 10));
        var g;
        if (typeof h == "number") {
          if (c._state !== "loaded" || c._playLock) return c._queue.push({
            event: "rate",
            action: function action() {
              c.rate.apply(c, d);
            }
          }), c;
          _typeof(f) > "u" && (c._rate = h), f = c._getSoundIds(f);
          for (var y = 0; y < f.length; y++) if (g = c._soundById(f[y]), g) {
            c.playing(f[y]) && (g._rateSeek = c.seek(f[y]), g._playStart = c._webAudio ? t.ctx.currentTime : g._playStart), g._rate = h, c._webAudio && g._node && g._node.bufferSource ? g._node.bufferSource.playbackRate.setValueAtTime(h, t.ctx.currentTime) : g._node && (g._node.playbackRate = h);
            var v = c.seek(f[y]),
              x = (c._sprite[g._sprite][0] + c._sprite[g._sprite][1]) / 1e3 - v,
              S = x * 1e3 / Math.abs(g._rate);
            (c._endTimers[f[y]] || !g._paused) && (c._clearTimer(f[y]), c._endTimers[f[y]] = setTimeout(c._ended.bind(c, g), S)), c._emit("rate", g._id);
          }
        } else return g = c._soundById(f), g ? g._rate : c._rate;
        return c;
      },
      seek: function seek() {
        var c = this,
          d = arguments,
          h,
          f;
        if (d.length === 0) c._sounds.length && (f = c._sounds[0]._id);else if (d.length === 1) {
          var p = c._getSoundIds(),
            m = p.indexOf(d[0]);
          m >= 0 ? f = parseInt(d[0], 10) : c._sounds.length && (f = c._sounds[0]._id, h = parseFloat(d[0]));
        } else d.length === 2 && (h = parseFloat(d[0]), f = parseInt(d[1], 10));
        if (_typeof(f) > "u") return 0;
        if (typeof h == "number" && (c._state !== "loaded" || c._playLock)) return c._queue.push({
          event: "seek",
          action: function action() {
            c.seek.apply(c, d);
          }
        }), c;
        var g = c._soundById(f);
        if (g) if (typeof h == "number" && h >= 0) {
          var y = c.playing(f);
          y && c.pause(f, !0), g._seek = h, g._ended = !1, c._clearTimer(f), !c._webAudio && g._node && !isNaN(g._node.duration) && (g._node.currentTime = h);
          var v = function v() {
            y && c.play(f, !0), c._emit("seek", f);
          };
          if (y && !c._webAudio) {
            var x = function x() {
              c._playLock ? setTimeout(x, 0) : v();
            };
            setTimeout(x, 0);
          } else v();
        } else if (c._webAudio) {
          var S = c.playing(f) ? t.ctx.currentTime - g._playStart : 0,
            w = g._rateSeek ? g._rateSeek - g._seek : 0;
          return g._seek + (w + S * Math.abs(g._rate));
        } else return g._node.currentTime;
        return c;
      },
      playing: function playing(c) {
        var d = this;
        if (typeof c == "number") {
          var h = d._soundById(c);
          return h ? !h._paused : !1;
        }
        for (var f = 0; f < d._sounds.length; f++) if (!d._sounds[f]._paused) return !0;
        return !1;
      },
      duration: function duration(c) {
        var d = this,
          h = d._duration,
          f = d._soundById(c);
        return f && (h = d._sprite[f._sprite][1] / 1e3), h;
      },
      state: function state() {
        return this._state;
      },
      unload: function unload() {
        for (var c = this, d = c._sounds, h = 0; h < d.length; h++) d[h]._paused || c.stop(d[h]._id), c._webAudio || (c._clearSound(d[h]._node), d[h]._node.removeEventListener("error", d[h]._errorFn, !1), d[h]._node.removeEventListener(t._canPlayEvent, d[h]._loadFn, !1), d[h]._node.removeEventListener("ended", d[h]._endFn, !1), t._releaseHtml5Audio(d[h]._node)), delete d[h]._node, c._clearTimer(d[h]._id);
        var f = t._howls.indexOf(c);
        f >= 0 && t._howls.splice(f, 1);
        var p = !0;
        for (h = 0; h < t._howls.length; h++) if (t._howls[h]._src === c._src || c._src.indexOf(t._howls[h]._src) >= 0) {
          p = !1;
          break;
        }
        return i && p && delete i[c._src], t.noAudio = !1, c._state = "unloaded", c._sounds = [], c = null, null;
      },
      on: function on(c, d, h, f) {
        var p = this,
          m = p["_on" + c];
        return typeof d == "function" && m.push(f ? {
          id: h,
          fn: d,
          once: f
        } : {
          id: h,
          fn: d
        }), p;
      },
      off: function off(c, d, h) {
        var f = this,
          p = f["_on" + c],
          m = 0;
        if (typeof d == "number" && (h = d, d = null), d || h) for (m = 0; m < p.length; m++) {
          var g = h === p[m].id;
          if (d === p[m].fn && g || !d && g) {
            p.splice(m, 1);
            break;
          }
        } else if (c) f["_on" + c] = [];else {
          var y = Object.keys(f);
          for (m = 0; m < y.length; m++) y[m].indexOf("_on") === 0 && Array.isArray(f[y[m]]) && (f[y[m]] = []);
        }
        return f;
      },
      once: function once(c, d, h) {
        var f = this;
        return f.on(c, d, h, 1), f;
      },
      _emit: function _emit(c, d, h) {
        for (var f = this, p = f["_on" + c], m = p.length - 1; m >= 0; m--) (!p[m].id || p[m].id === d || c === "load") && (setTimeout(function (g) {
          g.call(this, d, h);
        }.bind(f, p[m].fn), 0), p[m].once && f.off(c, p[m].fn, p[m].id));
        return f._loadQueue(c), f;
      },
      _loadQueue: function _loadQueue(c) {
        var d = this;
        if (d._queue.length > 0) {
          var h = d._queue[0];
          h.event === c && (d._queue.shift(), d._loadQueue()), c || h.action();
        }
        return d;
      },
      _ended: function _ended(c) {
        var d = this,
          h = c._sprite;
        if (!d._webAudio && c._node && !c._node.paused && !c._node.ended && c._node.currentTime < c._stop) return setTimeout(d._ended.bind(d, c), 100), d;
        var f = !!(c._loop || d._sprite[h][2]);
        if (d._emit("end", c._id), !d._webAudio && f && d.stop(c._id, !0).play(c._id), d._webAudio && f) {
          d._emit("play", c._id), c._seek = c._start || 0, c._rateSeek = 0, c._playStart = t.ctx.currentTime;
          var p = (c._stop - c._start) * 1e3 / Math.abs(c._rate);
          d._endTimers[c._id] = setTimeout(d._ended.bind(d, c), p);
        }
        return d._webAudio && !f && (c._paused = !0, c._ended = !0, c._seek = c._start || 0, c._rateSeek = 0, d._clearTimer(c._id), d._cleanBuffer(c._node), t._autoSuspend()), !d._webAudio && !f && d.stop(c._id, !0), d;
      },
      _clearTimer: function _clearTimer(c) {
        var d = this;
        if (d._endTimers[c]) {
          if (typeof d._endTimers[c] != "function") clearTimeout(d._endTimers[c]);else {
            var h = d._soundById(c);
            h && h._node && h._node.removeEventListener("ended", d._endTimers[c], !1);
          }
          delete d._endTimers[c];
        }
        return d;
      },
      _soundById: function _soundById(c) {
        for (var d = this, h = 0; h < d._sounds.length; h++) if (c === d._sounds[h]._id) return d._sounds[h];
        return null;
      },
      _inactiveSound: function _inactiveSound() {
        var c = this;
        c._drain();
        for (var d = 0; d < c._sounds.length; d++) if (c._sounds[d]._ended) return c._sounds[d].reset();
        return new r(c);
      },
      _drain: function _drain() {
        var c = this,
          d = c._pool,
          h = 0,
          f = 0;
        if (!(c._sounds.length < d)) {
          for (f = 0; f < c._sounds.length; f++) c._sounds[f]._ended && h++;
          for (f = c._sounds.length - 1; f >= 0; f--) {
            if (h <= d) return;
            c._sounds[f]._ended && (c._webAudio && c._sounds[f]._node && c._sounds[f]._node.disconnect(0), c._sounds.splice(f, 1), h--);
          }
        }
      },
      _getSoundIds: function _getSoundIds(c) {
        var d = this;
        if (_typeof(c) > "u") {
          for (var h = [], f = 0; f < d._sounds.length; f++) h.push(d._sounds[f]._id);
          return h;
        } else return [c];
      },
      _refreshBuffer: function _refreshBuffer(c) {
        var d = this;
        return c._node.bufferSource = t.ctx.createBufferSource(), c._node.bufferSource.buffer = i[d._src], c._panner ? c._node.bufferSource.connect(c._panner) : c._node.bufferSource.connect(c._node), c._node.bufferSource.loop = c._loop, c._loop && (c._node.bufferSource.loopStart = c._start || 0, c._node.bufferSource.loopEnd = c._stop || 0), c._node.bufferSource.playbackRate.setValueAtTime(c._rate, t.ctx.currentTime), d;
      },
      _cleanBuffer: function _cleanBuffer(c) {
        var d = this,
          h = t._navigator && t._navigator.vendor.indexOf("Apple") >= 0;
        if (t._scratchBuffer && c.bufferSource && (c.bufferSource.onended = null, c.bufferSource.disconnect(0), h)) try {
          c.bufferSource.buffer = t._scratchBuffer;
        } catch (_unused5) {}
        return c.bufferSource = null, d;
      },
      _clearSound: function _clearSound(c) {
        var d = /MSIE |Trident\//.test(t._navigator && t._navigator.userAgent);
        d || (c.src = "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA");
      }
    };
    var r = function r(c) {
      this._parent = c, this.init();
    };
    r.prototype = {
      init: function init() {
        var c = this,
          d = c._parent;
        return c._muted = d._muted, c._loop = d._loop, c._volume = d._volume, c._rate = d._rate, c._seek = 0, c._paused = !0, c._ended = !0, c._sprite = "__default", c._id = ++t._counter, d._sounds.push(c), c.create(), c;
      },
      create: function create() {
        var c = this,
          d = c._parent,
          h = t._muted || c._muted || c._parent._muted ? 0 : c._volume;
        return d._webAudio ? (c._node = _typeof(t.ctx.createGain) > "u" ? t.ctx.createGainNode() : t.ctx.createGain(), c._node.gain.setValueAtTime(h, t.ctx.currentTime), c._node.paused = !0, c._node.connect(t.masterGain)) : t.noAudio || (c._node = t._obtainHtml5Audio(), c._errorFn = c._errorListener.bind(c), c._node.addEventListener("error", c._errorFn, !1), c._loadFn = c._loadListener.bind(c), c._node.addEventListener(t._canPlayEvent, c._loadFn, !1), c._endFn = c._endListener.bind(c), c._node.addEventListener("ended", c._endFn, !1), c._node.src = d._src, c._node.preload = d._preload === !0 ? "auto" : d._preload, c._node.volume = h * t.volume(), c._node.load()), c;
      },
      reset: function reset() {
        var c = this,
          d = c._parent;
        return c._muted = d._muted, c._loop = d._loop, c._volume = d._volume, c._rate = d._rate, c._seek = 0, c._rateSeek = 0, c._paused = !0, c._ended = !0, c._sprite = "__default", c._id = ++t._counter, c;
      },
      _errorListener: function _errorListener() {
        var c = this;
        c._parent._emit("loaderror", c._id, c._node.error ? c._node.error.code : 0), c._node.removeEventListener("error", c._errorFn, !1);
      },
      _loadListener: function _loadListener() {
        var c = this,
          d = c._parent;
        d._duration = Math.ceil(c._node.duration * 10) / 10, Object.keys(d._sprite).length === 0 && (d._sprite = {
          __default: [0, d._duration * 1e3]
        }), d._state !== "loaded" && (d._state = "loaded", d._emit("load"), d._loadQueue()), c._node.removeEventListener(t._canPlayEvent, c._loadFn, !1);
      },
      _endListener: function _endListener() {
        var c = this,
          d = c._parent;
        d._duration === 1 / 0 && (d._duration = Math.ceil(c._node.duration * 10) / 10, d._sprite.__default[1] === 1 / 0 && (d._sprite.__default[1] = d._duration * 1e3), d._ended(c)), c._node.removeEventListener("ended", c._endFn, !1);
      }
    };
    var i = {},
      s = function s(c) {
        var d = c._src;
        if (i[d]) {
          c._duration = i[d].duration, l(c);
          return;
        }
        if (/^data:[^;]+;base64,/.test(d)) {
          for (var h = atob(d.split(",")[1]), f = new Uint8Array(h.length), p = 0; p < h.length; ++p) f[p] = h.charCodeAt(p);
          a(f.buffer, c);
        } else {
          var m = new XMLHttpRequest();
          m.open(c._xhr.method, d, !0), m.withCredentials = c._xhr.withCredentials, m.responseType = "arraybuffer", c._xhr.headers && Object.keys(c._xhr.headers).forEach(function (g) {
            m.setRequestHeader(g, c._xhr.headers[g]);
          }), m.onload = function () {
            var g = (m.status + "")[0];
            if (g !== "0" && g !== "2" && g !== "3") {
              c._emit("loaderror", null, "Failed loading audio file with status: " + m.status + ".");
              return;
            }
            a(m.response, c);
          }, m.onerror = function () {
            c._webAudio && (c._html5 = !0, c._webAudio = !1, c._sounds = [], delete i[d], c.load());
          }, o(m);
        }
      },
      o = function o(c) {
        try {
          c.send();
        } catch (_unused6) {
          c.onerror();
        }
      },
      a = function a(c, d) {
        var h = function h() {
            d._emit("loaderror", null, "Decoding audio data failed.");
          },
          f = function f(p) {
            p && d._sounds.length > 0 ? (i[d._src] = p, l(d, p)) : h();
          };
        (typeof Promise === "undefined" ? "undefined" : _typeof(Promise)) < "u" && t.ctx.decodeAudioData.length === 1 ? t.ctx.decodeAudioData(c).then(f).catch(h) : t.ctx.decodeAudioData(c, f, h);
      },
      l = function l(c, d) {
        d && !c._duration && (c._duration = d.duration), Object.keys(c._sprite).length === 0 && (c._sprite = {
          __default: [0, c._duration * 1e3]
        }), c._state !== "loaded" && (c._state = "loaded", c._emit("load"), c._loadQueue());
      },
      u = function u() {
        if (!!t.usingWebAudio) {
          try {
            (typeof AudioContext === "undefined" ? "undefined" : _typeof(AudioContext)) < "u" ? t.ctx = new AudioContext() : (typeof webkitAudioContext === "undefined" ? "undefined" : _typeof(webkitAudioContext)) < "u" ? t.ctx = new webkitAudioContext() : t.usingWebAudio = !1;
          } catch (_unused7) {
            t.usingWebAudio = !1;
          }
          t.ctx || (t.usingWebAudio = !1);
          var c = /iP(hone|od|ad)/.test(t._navigator && t._navigator.platform),
            d = t._navigator && t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),
            h = d ? parseInt(d[1], 10) : null;
          if (c && h && h < 9) {
            var f = /safari/.test(t._navigator && t._navigator.userAgent.toLowerCase());
            t._navigator && !f && (t.usingWebAudio = !1);
          }
          t.usingWebAudio && (t.masterGain = _typeof(t.ctx.createGain) > "u" ? t.ctx.createGainNode() : t.ctx.createGain(), t.masterGain.gain.setValueAtTime(t._muted ? 0 : t._volume, t.ctx.currentTime), t.masterGain.connect(t.ctx.destination)), t._setup();
        }
      };
    typeof define == "function" && define.amd && define([], function () {
      return {
        Howler: t,
        Howl: e
      };
    }), _typeof(X0) < "u" && (X0.Howler = t, X0.Howl = e), (typeof global === "undefined" ? "undefined" : _typeof(global)) < "u" ? (global.HowlerGlobal = n, global.Howler = t, global.Howl = e, global.Sound = r) : (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && (window.HowlerGlobal = n, window.Howler = t, window.Howl = e, window.Sound = r);
  })();
  (function () {
    "use strict";

    HowlerGlobal.prototype._pos = [0, 0, 0], HowlerGlobal.prototype._orientation = [0, 0, -1, 0, 1, 0], HowlerGlobal.prototype.stereo = function (t) {
      var e = this;
      if (!e.ctx || !e.ctx.listener) return e;
      for (var r = e._howls.length - 1; r >= 0; r--) e._howls[r].stereo(t);
      return e;
    }, HowlerGlobal.prototype.pos = function (t, e, r) {
      var i = this;
      if (!i.ctx || !i.ctx.listener) return i;
      if (e = typeof e != "number" ? i._pos[1] : e, r = typeof r != "number" ? i._pos[2] : r, typeof t == "number") i._pos = [t, e, r], _typeof(i.ctx.listener.positionX) < "u" ? (i.ctx.listener.positionX.setTargetAtTime(i._pos[0], Howler.ctx.currentTime, .1), i.ctx.listener.positionY.setTargetAtTime(i._pos[1], Howler.ctx.currentTime, .1), i.ctx.listener.positionZ.setTargetAtTime(i._pos[2], Howler.ctx.currentTime, .1)) : i.ctx.listener.setPosition(i._pos[0], i._pos[1], i._pos[2]);else return i._pos;
      return i;
    }, HowlerGlobal.prototype.orientation = function (t, e, r, i, s, o) {
      var a = this;
      if (!a.ctx || !a.ctx.listener) return a;
      var l = a._orientation;
      if (e = typeof e != "number" ? l[1] : e, r = typeof r != "number" ? l[2] : r, i = typeof i != "number" ? l[3] : i, s = typeof s != "number" ? l[4] : s, o = typeof o != "number" ? l[5] : o, typeof t == "number") a._orientation = [t, e, r, i, s, o], _typeof(a.ctx.listener.forwardX) < "u" ? (a.ctx.listener.forwardX.setTargetAtTime(t, Howler.ctx.currentTime, .1), a.ctx.listener.forwardY.setTargetAtTime(e, Howler.ctx.currentTime, .1), a.ctx.listener.forwardZ.setTargetAtTime(r, Howler.ctx.currentTime, .1), a.ctx.listener.upX.setTargetAtTime(i, Howler.ctx.currentTime, .1), a.ctx.listener.upY.setTargetAtTime(s, Howler.ctx.currentTime, .1), a.ctx.listener.upZ.setTargetAtTime(o, Howler.ctx.currentTime, .1)) : a.ctx.listener.setOrientation(t, e, r, i, s, o);else return l;
      return a;
    }, Howl.prototype.init = function (t) {
      return function (e) {
        var r = this;
        return r._orientation = e.orientation || [1, 0, 0], r._stereo = e.stereo || null, r._pos = e.pos || null, r._pannerAttr = {
          coneInnerAngle: _typeof(e.coneInnerAngle) < "u" ? e.coneInnerAngle : 360,
          coneOuterAngle: _typeof(e.coneOuterAngle) < "u" ? e.coneOuterAngle : 360,
          coneOuterGain: _typeof(e.coneOuterGain) < "u" ? e.coneOuterGain : 0,
          distanceModel: _typeof(e.distanceModel) < "u" ? e.distanceModel : "inverse",
          maxDistance: _typeof(e.maxDistance) < "u" ? e.maxDistance : 1e4,
          panningModel: _typeof(e.panningModel) < "u" ? e.panningModel : "HRTF",
          refDistance: _typeof(e.refDistance) < "u" ? e.refDistance : 1,
          rolloffFactor: _typeof(e.rolloffFactor) < "u" ? e.rolloffFactor : 1
        }, r._onstereo = e.onstereo ? [{
          fn: e.onstereo
        }] : [], r._onpos = e.onpos ? [{
          fn: e.onpos
        }] : [], r._onorientation = e.onorientation ? [{
          fn: e.onorientation
        }] : [], t.call(this, e);
      };
    }(Howl.prototype.init), Howl.prototype.stereo = function (t, e) {
      var r = this;
      if (!r._webAudio) return r;
      if (r._state !== "loaded") return r._queue.push({
        event: "stereo",
        action: function action() {
          r.stereo(t, e);
        }
      }), r;
      var i = _typeof(Howler.ctx.createStereoPanner) > "u" ? "spatial" : "stereo";
      if (_typeof(e) > "u") if (typeof t == "number") r._stereo = t, r._pos = [t, 0, 0];else return r._stereo;
      for (var s = r._getSoundIds(e), o = 0; o < s.length; o++) {
        var a = r._soundById(s[o]);
        if (a) if (typeof t == "number") a._stereo = t, a._pos = [t, 0, 0], a._node && (a._pannerAttr.panningModel = "equalpower", (!a._panner || !a._panner.pan) && n(a, i), i === "spatial" ? _typeof(a._panner.positionX) < "u" ? (a._panner.positionX.setValueAtTime(t, Howler.ctx.currentTime), a._panner.positionY.setValueAtTime(0, Howler.ctx.currentTime), a._panner.positionZ.setValueAtTime(0, Howler.ctx.currentTime)) : a._panner.setPosition(t, 0, 0) : a._panner.pan.setValueAtTime(t, Howler.ctx.currentTime)), r._emit("stereo", a._id);else return a._stereo;
      }
      return r;
    }, Howl.prototype.pos = function (t, e, r, i) {
      var s = this;
      if (!s._webAudio) return s;
      if (s._state !== "loaded") return s._queue.push({
        event: "pos",
        action: function action() {
          s.pos(t, e, r, i);
        }
      }), s;
      if (e = typeof e != "number" ? 0 : e, r = typeof r != "number" ? -.5 : r, _typeof(i) > "u") if (typeof t == "number") s._pos = [t, e, r];else return s._pos;
      for (var o = s._getSoundIds(i), a = 0; a < o.length; a++) {
        var l = s._soundById(o[a]);
        if (l) if (typeof t == "number") l._pos = [t, e, r], l._node && ((!l._panner || l._panner.pan) && n(l, "spatial"), _typeof(l._panner.positionX) < "u" ? (l._panner.positionX.setValueAtTime(t, Howler.ctx.currentTime), l._panner.positionY.setValueAtTime(e, Howler.ctx.currentTime), l._panner.positionZ.setValueAtTime(r, Howler.ctx.currentTime)) : l._panner.setPosition(t, e, r)), s._emit("pos", l._id);else return l._pos;
      }
      return s;
    }, Howl.prototype.orientation = function (t, e, r, i) {
      var s = this;
      if (!s._webAudio) return s;
      if (s._state !== "loaded") return s._queue.push({
        event: "orientation",
        action: function action() {
          s.orientation(t, e, r, i);
        }
      }), s;
      if (e = typeof e != "number" ? s._orientation[1] : e, r = typeof r != "number" ? s._orientation[2] : r, _typeof(i) > "u") if (typeof t == "number") s._orientation = [t, e, r];else return s._orientation;
      for (var o = s._getSoundIds(i), a = 0; a < o.length; a++) {
        var l = s._soundById(o[a]);
        if (l) if (typeof t == "number") l._orientation = [t, e, r], l._node && (l._panner || (l._pos || (l._pos = s._pos || [0, 0, -.5]), n(l, "spatial")), _typeof(l._panner.orientationX) < "u" ? (l._panner.orientationX.setValueAtTime(t, Howler.ctx.currentTime), l._panner.orientationY.setValueAtTime(e, Howler.ctx.currentTime), l._panner.orientationZ.setValueAtTime(r, Howler.ctx.currentTime)) : l._panner.setOrientation(t, e, r)), s._emit("orientation", l._id);else return l._orientation;
      }
      return s;
    }, Howl.prototype.pannerAttr = function () {
      var t = this,
        e = arguments,
        r,
        i,
        s;
      if (!t._webAudio) return t;
      if (e.length === 0) return t._pannerAttr;
      if (e.length === 1) {
        if (_typeof(e[0]) == "object") r = e[0], _typeof(i) > "u" && (r.pannerAttr || (r.pannerAttr = {
          coneInnerAngle: r.coneInnerAngle,
          coneOuterAngle: r.coneOuterAngle,
          coneOuterGain: r.coneOuterGain,
          distanceModel: r.distanceModel,
          maxDistance: r.maxDistance,
          refDistance: r.refDistance,
          rolloffFactor: r.rolloffFactor,
          panningModel: r.panningModel
        }), t._pannerAttr = {
          coneInnerAngle: _typeof(r.pannerAttr.coneInnerAngle) < "u" ? r.pannerAttr.coneInnerAngle : t._coneInnerAngle,
          coneOuterAngle: _typeof(r.pannerAttr.coneOuterAngle) < "u" ? r.pannerAttr.coneOuterAngle : t._coneOuterAngle,
          coneOuterGain: _typeof(r.pannerAttr.coneOuterGain) < "u" ? r.pannerAttr.coneOuterGain : t._coneOuterGain,
          distanceModel: _typeof(r.pannerAttr.distanceModel) < "u" ? r.pannerAttr.distanceModel : t._distanceModel,
          maxDistance: _typeof(r.pannerAttr.maxDistance) < "u" ? r.pannerAttr.maxDistance : t._maxDistance,
          refDistance: _typeof(r.pannerAttr.refDistance) < "u" ? r.pannerAttr.refDistance : t._refDistance,
          rolloffFactor: _typeof(r.pannerAttr.rolloffFactor) < "u" ? r.pannerAttr.rolloffFactor : t._rolloffFactor,
          panningModel: _typeof(r.pannerAttr.panningModel) < "u" ? r.pannerAttr.panningModel : t._panningModel
        });else return s = t._soundById(parseInt(e[0], 10)), s ? s._pannerAttr : t._pannerAttr;
      } else e.length === 2 && (r = e[0], i = parseInt(e[1], 10));
      for (var o = t._getSoundIds(i), a = 0; a < o.length; a++) if (s = t._soundById(o[a]), s) {
        var l = s._pannerAttr;
        l = {
          coneInnerAngle: _typeof(r.coneInnerAngle) < "u" ? r.coneInnerAngle : l.coneInnerAngle,
          coneOuterAngle: _typeof(r.coneOuterAngle) < "u" ? r.coneOuterAngle : l.coneOuterAngle,
          coneOuterGain: _typeof(r.coneOuterGain) < "u" ? r.coneOuterGain : l.coneOuterGain,
          distanceModel: _typeof(r.distanceModel) < "u" ? r.distanceModel : l.distanceModel,
          maxDistance: _typeof(r.maxDistance) < "u" ? r.maxDistance : l.maxDistance,
          refDistance: _typeof(r.refDistance) < "u" ? r.refDistance : l.refDistance,
          rolloffFactor: _typeof(r.rolloffFactor) < "u" ? r.rolloffFactor : l.rolloffFactor,
          panningModel: _typeof(r.panningModel) < "u" ? r.panningModel : l.panningModel
        };
        var u = s._panner;
        u ? (u.coneInnerAngle = l.coneInnerAngle, u.coneOuterAngle = l.coneOuterAngle, u.coneOuterGain = l.coneOuterGain, u.distanceModel = l.distanceModel, u.maxDistance = l.maxDistance, u.refDistance = l.refDistance, u.rolloffFactor = l.rolloffFactor, u.panningModel = l.panningModel) : (s._pos || (s._pos = t._pos || [0, 0, -.5]), n(s, "spatial"));
      }
      return t;
    }, Sound.prototype.init = function (t) {
      return function () {
        var e = this,
          r = e._parent;
        e._orientation = r._orientation, e._stereo = r._stereo, e._pos = r._pos, e._pannerAttr = r._pannerAttr, t.call(this), e._stereo ? r.stereo(e._stereo) : e._pos && r.pos(e._pos[0], e._pos[1], e._pos[2], e._id);
      };
    }(Sound.prototype.init), Sound.prototype.reset = function (t) {
      return function () {
        var e = this,
          r = e._parent;
        return e._orientation = r._orientation, e._stereo = r._stereo, e._pos = r._pos, e._pannerAttr = r._pannerAttr, e._stereo ? r.stereo(e._stereo) : e._pos ? r.pos(e._pos[0], e._pos[1], e._pos[2], e._id) : e._panner && (e._panner.disconnect(0), e._panner = void 0, r._refreshBuffer(e)), t.call(this);
      };
    }(Sound.prototype.reset);
    var n = function n(t, e) {
      e = e || "spatial", e === "spatial" ? (t._panner = Howler.ctx.createPanner(), t._panner.coneInnerAngle = t._pannerAttr.coneInnerAngle, t._panner.coneOuterAngle = t._pannerAttr.coneOuterAngle, t._panner.coneOuterGain = t._pannerAttr.coneOuterGain, t._panner.distanceModel = t._pannerAttr.distanceModel, t._panner.maxDistance = t._pannerAttr.maxDistance, t._panner.refDistance = t._pannerAttr.refDistance, t._panner.rolloffFactor = t._pannerAttr.rolloffFactor, t._panner.panningModel = t._pannerAttr.panningModel, _typeof(t._panner.positionX) < "u" ? (t._panner.positionX.setValueAtTime(t._pos[0], Howler.ctx.currentTime), t._panner.positionY.setValueAtTime(t._pos[1], Howler.ctx.currentTime), t._panner.positionZ.setValueAtTime(t._pos[2], Howler.ctx.currentTime)) : t._panner.setPosition(t._pos[0], t._pos[1], t._pos[2]), _typeof(t._panner.orientationX) < "u" ? (t._panner.orientationX.setValueAtTime(t._orientation[0], Howler.ctx.currentTime), t._panner.orientationY.setValueAtTime(t._orientation[1], Howler.ctx.currentTime), t._panner.orientationZ.setValueAtTime(t._orientation[2], Howler.ctx.currentTime)) : t._panner.setOrientation(t._orientation[0], t._orientation[1], t._orientation[2])) : (t._panner = Howler.ctx.createStereoPanner(), t._panner.pan.setValueAtTime(t._stereo, Howler.ctx.currentTime)), t._panner.connect(t._node), t._paused || t._parent.pause(t._id, !0).play(t._id, !0);
    };
  })();
});
var iL = en(function (Yke, rL) {
  "use strict";

  function zQ(n) {
    for (var t = new Array(n), e = 0; e < n; ++e) t[e] = e;
    return t;
  }
  rL.exports = zQ;
});
var oL = en(function (Xke, sL) {
  sL.exports = function (n) {
    return n != null && (nL(n) || VQ(n) || !!n._isBuffer);
  };
  function nL(n) {
    return !!n.constructor && typeof n.constructor.isBuffer == "function" && n.constructor.isBuffer(n);
  }
  function VQ(n) {
    return typeof n.readFloatLE == "function" && typeof n.slice == "function" && nL(n.slice(0, 0));
  }
});
var Tf = en(function (Qke, aL) {
  var UQ = iL(),
    GQ = oL(),
    jQ = (typeof Float64Array === "undefined" ? "undefined" : _typeof(Float64Array)) < "u";
  function HQ(n, t) {
    return n[0] - t[0];
  }
  function WQ() {
    var n = this.stride,
      t = new Array(n.length),
      e;
    for (e = 0; e < t.length; ++e) t[e] = [Math.abs(n[e]), e];
    t.sort(HQ);
    var r = new Array(t.length);
    for (e = 0; e < r.length; ++e) r[e] = t[e][1];
    return r;
  }
  function qQ(n, t) {
    var e = ["View", t, "d", n].join("");
    t < 0 && (e = "View_Nil" + n);
    var r = n === "generic";
    if (t === -1) {
      var i = "function " + e + "(a){this.data=a;};var proto=" + e + ".prototype;proto.dtype='" + n + "';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new " + e + "(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_" + e + "(a){return new " + e + "(a);}",
        m = new Function(i);
      return m();
    } else if (t === 0) {
      var i = "function " + e + "(a,d) {this.data = a;this.offset = d};var proto=" + e + ".prototype;proto.dtype='" + n + "';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function " + e + "_copy() {return new " + e + "(this.data,this.offset)};proto.pick=function " + e + "_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function " + e + "_get(){return " + (r ? "this.data.get(this.offset)" : "this.data[this.offset]") + "};proto.set=function " + e + "_set(v){return " + (r ? "this.data.set(this.offset,v)" : "this.data[this.offset]=v") + "};return function construct_" + e + "(a,b,c,d){return new " + e + "(a,d)}",
        m = new Function("TrivialArray", i);
      return m(Ux[n][0]);
    }
    var i = ["'use strict'"],
      s = UQ(t),
      o = s.map(function (g) {
        return "i" + g;
      }),
      a = "this.offset+" + s.map(function (g) {
        return "this.stride[" + g + "]*i" + g;
      }).join("+"),
      l = s.map(function (g) {
        return "b" + g;
      }).join(","),
      u = s.map(function (g) {
        return "c" + g;
      }).join(",");
    i.push("function " + e + "(a," + l + "," + u + ",d){this.data=a", "this.shape=[" + l + "]", "this.stride=[" + u + "]", "this.offset=d|0}", "var proto=" + e + ".prototype", "proto.dtype='" + n + "'", "proto.dimension=" + t), i.push("Object.defineProperty(proto,'size',{get:function " + e + "_size(){return " + s.map(function (g) {
      return "this.shape[" + g + "]";
    }).join("*"), "}})"), t === 1 ? i.push("proto.order=[0]") : (i.push("Object.defineProperty(proto,'order',{get:"), t < 4 ? (i.push("function " + e + "_order(){"), t === 2 ? i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})") : t === 3 && i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")) : i.push("ORDER})")), i.push("proto.set=function " + e + "_set(" + o.join(",") + ",v){"), r ? i.push("return this.data.set(" + a + ",v)}") : i.push("return this.data[" + a + "]=v}"), i.push("proto.get=function " + e + "_get(" + o.join(",") + "){"), r ? i.push("return this.data.get(" + a + ")}") : i.push("return this.data[" + a + "]}"), i.push("proto.index=function " + e + "_index(", o.join(), "){return " + a + "}"), i.push("proto.hi=function " + e + "_hi(" + o.join(",") + "){return new " + e + "(this.data," + s.map(function (g) {
      return ["(typeof i", g, "!=='number'||i", g, "<0)?this.shape[", g, "]:i", g, "|0"].join("");
    }).join(",") + "," + s.map(function (g) {
      return "this.stride[" + g + "]";
    }).join(",") + ",this.offset)}");
    var c = s.map(function (g) {
        return "a" + g + "=this.shape[" + g + "]";
      }),
      d = s.map(function (g) {
        return "c" + g + "=this.stride[" + g + "]";
      });
    i.push("proto.lo=function " + e + "_lo(" + o.join(",") + "){var b=this.offset,d=0," + c.join(",") + "," + d.join(","));
    for (var h = 0; h < t; ++h) i.push("if(typeof i" + h + "==='number'&&i" + h + ">=0){d=i" + h + "|0;b+=c" + h + "*d;a" + h + "-=d}");
    i.push("return new " + e + "(this.data," + s.map(function (g) {
      return "a" + g;
    }).join(",") + "," + s.map(function (g) {
      return "c" + g;
    }).join(",") + ",b)}"), i.push("proto.step=function " + e + "_step(" + o.join(",") + "){var " + s.map(function (g) {
      return "a" + g + "=this.shape[" + g + "]";
    }).join(",") + "," + s.map(function (g) {
      return "b" + g + "=this.stride[" + g + "]";
    }).join(",") + ",c=this.offset,d=0,ceil=Math.ceil");
    for (var h = 0; h < t; ++h) i.push("if(typeof i" + h + "==='number'){d=i" + h + "|0;if(d<0){c+=b" + h + "*(a" + h + "-1);a" + h + "=ceil(-a" + h + "/d)}else{a" + h + "=ceil(a" + h + "/d)}b" + h + "*=d}");
    i.push("return new " + e + "(this.data," + s.map(function (g) {
      return "a" + g;
    }).join(",") + "," + s.map(function (g) {
      return "b" + g;
    }).join(",") + ",c)}");
    for (var f = new Array(t), p = new Array(t), h = 0; h < t; ++h) f[h] = "a[i" + h + "]", p[h] = "b[i" + h + "]";
    i.push("proto.transpose=function " + e + "_transpose(" + o + "){" + o.map(function (g, y) {
      return g + "=(" + g + "===undefined?" + y + ":" + g + "|0)";
    }).join(";"), "var a=this.shape,b=this.stride;return new " + e + "(this.data," + f.join(",") + "," + p.join(",") + ",this.offset)}"), i.push("proto.pick=function " + e + "_pick(" + o + "){var a=[],b=[],c=this.offset");
    for (var h = 0; h < t; ++h) i.push("if(typeof i" + h + "==='number'&&i" + h + ">=0){c=(c+this.stride[" + h + "]*i" + h + ")|0}else{a.push(this.shape[" + h + "]);b.push(this.stride[" + h + "])}");
    i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"), i.push("return function construct_" + e + "(data,shape,stride,offset){return new " + e + "(data," + s.map(function (g) {
      return "shape[" + g + "]";
    }).join(",") + "," + s.map(function (g) {
      return "stride[" + g + "]";
    }).join(",") + ",offset)}");
    var m = new Function("CTOR_LIST", "ORDER", i.join("\n"));
    return m(Ux[n], WQ);
  }
  function YQ(n) {
    if (GQ(n)) return "buffer";
    if (jQ) switch (Object.prototype.toString.call(n)) {
      case "[object Float64Array]":
        return "float64";
      case "[object Float32Array]":
        return "float32";
      case "[object Int8Array]":
        return "int8";
      case "[object Int16Array]":
        return "int16";
      case "[object Int32Array]":
        return "int32";
      case "[object Uint8Array]":
        return "uint8";
      case "[object Uint16Array]":
        return "uint16";
      case "[object Uint32Array]":
        return "uint32";
      case "[object Uint8ClampedArray]":
        return "uint8_clamped";
      case "[object BigInt64Array]":
        return "bigint64";
      case "[object BigUint64Array]":
        return "biguint64";
    }
    return Array.isArray(n) ? "array" : "generic";
  }
  var Ux = {
    float32: [],
    float64: [],
    int8: [],
    int16: [],
    int32: [],
    uint8: [],
    uint16: [],
    uint32: [],
    array: [],
    uint8_clamped: [],
    bigint64: [],
    biguint64: [],
    buffer: [],
    generic: []
  };
  function XQ(n, t, e, r) {
    if (n === void 0) {
      var u = Ux.array[0];
      return u([]);
    } else typeof n == "number" && (n = [n]);
    t === void 0 && (t = [n.length]);
    var i = t.length;
    if (e === void 0) {
      e = new Array(i);
      for (var s = i - 1, o = 1; s >= 0; --s) e[s] = o, o *= t[s];
    }
    if (r === void 0) {
      r = 0;
      for (var s = 0; s < i; ++s) e[s] < 0 && (r -= (t[s] - 1) * e[s]);
    }
    for (var a = YQ(n), l = Ux[a]; l.length <= i + 1;) l.push(qQ(a, l.length - 1));
    var u = l[i + 1];
    return u(n, t, e, r);
  }
  aL.exports = XQ;
});
var cL = en(function (Kke, lL) {
  "use strict";

  function QQ(n, t) {
    for (var e = 1, r = n.length, i = n[0], s = n[0], o = 1; o < r; ++o) if (s = i, i = n[o], t(i, s)) {
      if (o === e) {
        e++;
        continue;
      }
      n[e++] = i;
    }
    return n.length = e, n;
  }
  function KQ(n) {
    for (var t = 1, e = n.length, r = n[0], i = n[0], s = 1; s < e; ++s, i = r) if (i = r, r = n[s], r !== i) {
      if (s === t) {
        t++;
        continue;
      }
      n[t++] = r;
    }
    return n.length = t, n;
  }
  function ZQ(n, t, e) {
    return n.length === 0 ? n : t ? (e || n.sort(t), QQ(n, t)) : (e || n.sort(), KQ(n));
  }
  lL.exports = ZQ;
});
var hL = en(function (Zke, dL) {
  "use strict";

  var JQ = cL();
  function uL(n, t, e) {
    var r = n.length,
      i = t.arrayArgs.length,
      s = t.indexArgs.length > 0,
      o = [],
      a = [],
      l = 0,
      u = 0,
      c,
      d;
    for (c = 0; c < r; ++c) a.push(["i", c, "=0"].join(""));
    for (d = 0; d < i; ++d) for (c = 0; c < r; ++c) u = l, l = n[c], c === 0 ? a.push(["d", d, "s", c, "=t", d, "p", l].join("")) : a.push(["d", d, "s", c, "=(t", d, "p", l, "-s", u, "*t", d, "p", u, ")"].join(""));
    for (a.length > 0 && o.push("var " + a.join(",")), c = r - 1; c >= 0; --c) l = n[c], o.push(["for(i", c, "=0;i", c, "<s", l, ";++i", c, "){"].join(""));
    for (o.push(e), c = 0; c < r; ++c) {
      for (u = l, l = n[c], d = 0; d < i; ++d) o.push(["p", d, "+=d", d, "s", c].join(""));
      s && (c > 0 && o.push(["index[", u, "]-=s", u].join("")), o.push(["++index[", l, "]"].join(""))), o.push("}");
    }
    return o.join("\n");
  }
  function $Q(n, t, e, r) {
    for (var i = t.length, s = e.arrayArgs.length, o = e.blockSize, a = e.indexArgs.length > 0, l = [], u = 0; u < s; ++u) l.push(["var offset", u, "=p", u].join(""));
    for (var u = n; u < i; ++u) l.push(["for(var j" + u + "=SS[", t[u], "]|0;j", u, ">0;){"].join("")), l.push(["if(j", u, "<", o, "){"].join("")), l.push(["s", t[u], "=j", u].join("")), l.push(["j", u, "=0"].join("")), l.push(["}else{s", t[u], "=", o].join("")), l.push(["j", u, "-=", o, "}"].join("")), a && l.push(["index[", t[u], "]=j", u].join(""));
    for (var u = 0; u < s; ++u) {
      for (var c = ["offset" + u], d = n; d < i; ++d) c.push(["j", d, "*t", u, "p", t[d]].join(""));
      l.push(["p", u, "=(", c.join("+"), ")"].join(""));
    }
    l.push(uL(t, e, r));
    for (var u = n; u < i; ++u) l.push("}");
    return l.join("\n");
  }
  function eK(n) {
    for (var t = 0, e = n[0].length; t < e;) {
      for (var r = 1; r < n.length; ++r) if (n[r][t] !== n[0][t]) return t;
      ++t;
    }
    return t;
  }
  function R_(n, t, e) {
    for (var r = n.body, i = [], s = [], o = 0; o < n.args.length; ++o) {
      var a = n.args[o];
      if (!(a.count <= 0)) {
        var l = new RegExp(a.name, "g"),
          u = "",
          c = t.arrayArgs.indexOf(o);
        switch (t.argTypes[o]) {
          case "offset":
            var d = t.offsetArgIndex.indexOf(o),
              h = t.offsetArgs[d];
            c = h.array, u = "+q" + d;
          case "array":
            u = "p" + c + u;
            var f = "l" + o,
              p = "a" + c;
            if (t.arrayBlockIndices[c] === 0) a.count === 1 ? e[c] === "generic" ? a.lvalue ? (i.push(["var ", f, "=", p, ".get(", u, ")"].join("")), r = r.replace(l, f), s.push([p, ".set(", u, ",", f, ")"].join(""))) : r = r.replace(l, [p, ".get(", u, ")"].join("")) : r = r.replace(l, [p, "[", u, "]"].join("")) : e[c] === "generic" ? (i.push(["var ", f, "=", p, ".get(", u, ")"].join("")), r = r.replace(l, f), a.lvalue && s.push([p, ".set(", u, ",", f, ")"].join(""))) : (i.push(["var ", f, "=", p, "[", u, "]"].join("")), r = r.replace(l, f), a.lvalue && s.push([p, "[", u, "]=", f].join("")));else {
              for (var m = [a.name], g = [u], y = 0; y < Math.abs(t.arrayBlockIndices[c]); y++) m.push("\\s*\\[([^\\]]+)\\]"), g.push("$" + (y + 1) + "*t" + c + "b" + y);
              if (l = new RegExp(m.join(""), "g"), u = g.join("+"), e[c] === "generic") throw new Error("cwise: Generic arrays not supported in combination with blocks!");
              r = r.replace(l, [p, "[", u, "]"].join(""));
            }
            break;
          case "scalar":
            r = r.replace(l, "Y" + t.scalarArgs.indexOf(o));
            break;
          case "index":
            r = r.replace(l, "index");
            break;
          case "shape":
            r = r.replace(l, "shape");
            break;
        }
      }
    }
    return [i.join("\n"), r, s.join("\n")].join("\n").trim();
  }
  function tK(n) {
    for (var t = new Array(n.length), e = !0, r = 0; r < n.length; ++r) {
      var i = n[r],
        s = i.match(/\d+/);
      s ? s = s[0] : s = "", i.charAt(0) === 0 ? t[r] = "u" + i.charAt(1) + s : t[r] = i.charAt(0) + s, r > 0 && (e = e && t[r] === t[r - 1]);
    }
    return e ? t[0] : t.join("");
  }
  function rK(n, t) {
    for (var e = t[1].length - Math.abs(n.arrayBlockIndices[0]) | 0, r = new Array(n.arrayArgs.length), i = new Array(n.arrayArgs.length), s = 0; s < n.arrayArgs.length; ++s) i[s] = t[2 * s], r[s] = t[2 * s + 1];
    for (var o = [], a = [], l = [], u = [], c = [], s = 0; s < n.arrayArgs.length; ++s) {
      n.arrayBlockIndices[s] < 0 ? (l.push(0), u.push(e), o.push(e), a.push(e + n.arrayBlockIndices[s])) : (l.push(n.arrayBlockIndices[s]), u.push(n.arrayBlockIndices[s] + e), o.push(0), a.push(n.arrayBlockIndices[s]));
      for (var d = [], h = 0; h < r[s].length; h++) l[s] <= r[s][h] && r[s][h] < u[s] && d.push(r[s][h] - l[s]);
      c.push(d);
    }
    for (var f = ["SS"], p = ["'use strict'"], m = [], h = 0; h < e; ++h) m.push(["s", h, "=SS[", h, "]"].join(""));
    for (var s = 0; s < n.arrayArgs.length; ++s) {
      f.push("a" + s), f.push("t" + s), f.push("p" + s);
      for (var h = 0; h < e; ++h) m.push(["t", s, "p", h, "=t", s, "[", l[s] + h, "]"].join(""));
      for (var h = 0; h < Math.abs(n.arrayBlockIndices[s]); ++h) m.push(["t", s, "b", h, "=t", s, "[", o[s] + h, "]"].join(""));
    }
    for (var s = 0; s < n.scalarArgs.length; ++s) f.push("Y" + s);
    if (n.shapeArgs.length > 0 && m.push("shape=SS.slice(0)"), n.indexArgs.length > 0) {
      for (var g = new Array(e), s = 0; s < e; ++s) g[s] = "0";
      m.push(["index=[", g.join(","), "]"].join(""));
    }
    for (var s = 0; s < n.offsetArgs.length; ++s) {
      for (var y = n.offsetArgs[s], v = [], h = 0; h < y.offset.length; ++h) y.offset[h] !== 0 && (y.offset[h] === 1 ? v.push(["t", y.array, "p", h].join("")) : v.push([y.offset[h], "*t", y.array, "p", h].join("")));
      v.length === 0 ? m.push("q" + s + "=0") : m.push(["q", s, "=", v.join("+")].join(""));
    }
    var x = JQ([].concat(n.pre.thisVars).concat(n.body.thisVars).concat(n.post.thisVars));
    m = m.concat(x), m.length > 0 && p.push("var " + m.join(","));
    for (var s = 0; s < n.arrayArgs.length; ++s) p.push("p" + s + "|=0");
    n.pre.body.length > 3 && p.push(R_(n.pre, n, i));
    var S = R_(n.body, n, i),
      w = eK(c);
    w < e ? p.push($Q(w, c[0], n, S)) : p.push(uL(c[0], n, S)), n.post.body.length > 3 && p.push(R_(n.post, n, i)), n.debug && console.log("-----Generated cwise routine for ", t, ":\n" + p.join("\n") + "\n----------");
    var A = [n.funcName || "unnamed", "_cwise_loop_", r[0].join("s"), "m", w, tK(i)].join(""),
      E = new Function(["function ", A, "(", f.join(","), "){", p.join("\n"), "} return ", A].join(""));
    return E();
  }
  dL.exports = rK;
});
var pL = en(function (Jke, fL) {
  "use strict";

  var iK = hL();
  function nK(n) {
    var t = ["'use strict'", "var CACHED={}"],
      e = [],
      r = n.funcName + "_cwise_thunk";
    t.push(["return function ", r, "(", n.shimArgs.join(","), "){"].join(""));
    for (var i = [], s = [], o = [["array", n.arrayArgs[0], ".shape.slice(", Math.max(0, n.arrayBlockIndices[0]), n.arrayBlockIndices[0] < 0 ? "," + n.arrayBlockIndices[0] + ")" : ")"].join("")], a = [], l = [], u = 0; u < n.arrayArgs.length; ++u) {
      var c = n.arrayArgs[u];
      e.push(["t", c, "=array", c, ".dtype,", "r", c, "=array", c, ".order"].join("")), i.push("t" + c), i.push("r" + c), s.push("t" + c), s.push("r" + c + ".join()"), o.push("array" + c + ".data"), o.push("array" + c + ".stride"), o.push("array" + c + ".offset|0"), u > 0 && (a.push("array" + n.arrayArgs[0] + ".shape.length===array" + c + ".shape.length+" + (Math.abs(n.arrayBlockIndices[0]) - Math.abs(n.arrayBlockIndices[u]))), l.push("array" + n.arrayArgs[0] + ".shape[shapeIndex+" + Math.max(0, n.arrayBlockIndices[0]) + "]===array" + c + ".shape[shapeIndex+" + Math.max(0, n.arrayBlockIndices[u]) + "]"));
    }
    n.arrayArgs.length > 1 && (t.push("if (!(" + a.join(" && ") + ")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"), t.push("for(var shapeIndex=array" + n.arrayArgs[0] + ".shape.length-" + Math.abs(n.arrayBlockIndices[0]) + "; shapeIndex-->0;) {"), t.push("if (!(" + l.join(" && ") + ")) throw new Error('cwise: Arrays do not all have the same shape!')"), t.push("}"));
    for (var u = 0; u < n.scalarArgs.length; ++u) o.push("scalar" + n.scalarArgs[u]);
    e.push(["type=[", s.join(","), "].join()"].join("")), e.push("proc=CACHED[type]"), t.push("var " + e.join(",")), t.push(["if(!proc){", "CACHED[type]=proc=compile([", i.join(","), "])}", "return proc(", o.join(","), ")}"].join("")), n.debug && console.log("-----Generated thunk:\n" + t.join("\n") + "\n----------");
    var d = new Function("compile", t.join("\n"));
    return d(iK.bind(void 0, n));
  }
  fL.exports = nK;
});
var gL = en(function ($ke, mL) {
  "use strict";

  var sK = pL();
  function oK() {
    this.argTypes = [], this.shimArgs = [], this.arrayArgs = [], this.arrayBlockIndices = [], this.scalarArgs = [], this.offsetArgs = [], this.offsetArgIndex = [], this.indexArgs = [], this.shapeArgs = [], this.funcName = "", this.pre = null, this.body = null, this.post = null, this.debug = !1;
  }
  function aK(n) {
    var t = new oK();
    t.pre = n.pre, t.body = n.body, t.post = n.post;
    var e = n.args.slice(0);
    t.argTypes = e;
    for (var r = 0; r < e.length; ++r) {
      var i = e[r];
      if (i === "array" || _typeof(i) == "object" && i.blockIndices) {
        if (t.argTypes[r] = "array", t.arrayArgs.push(r), t.arrayBlockIndices.push(i.blockIndices ? i.blockIndices : 0), t.shimArgs.push("array" + r), r < t.pre.args.length && t.pre.args[r].count > 0) throw new Error("cwise: pre() block may not reference array args");
        if (r < t.post.args.length && t.post.args[r].count > 0) throw new Error("cwise: post() block may not reference array args");
      } else if (i === "scalar") t.scalarArgs.push(r), t.shimArgs.push("scalar" + r);else if (i === "index") {
        if (t.indexArgs.push(r), r < t.pre.args.length && t.pre.args[r].count > 0) throw new Error("cwise: pre() block may not reference array index");
        if (r < t.body.args.length && t.body.args[r].lvalue) throw new Error("cwise: body() block may not write to array index");
        if (r < t.post.args.length && t.post.args[r].count > 0) throw new Error("cwise: post() block may not reference array index");
      } else if (i === "shape") {
        if (t.shapeArgs.push(r), r < t.pre.args.length && t.pre.args[r].lvalue) throw new Error("cwise: pre() block may not write to array shape");
        if (r < t.body.args.length && t.body.args[r].lvalue) throw new Error("cwise: body() block may not write to array shape");
        if (r < t.post.args.length && t.post.args[r].lvalue) throw new Error("cwise: post() block may not write to array shape");
      } else if (_typeof(i) == "object" && i.offset) t.argTypes[r] = "offset", t.offsetArgs.push({
        array: i.array,
        offset: i.offset
      }), t.offsetArgIndex.push(r);else throw new Error("cwise: Unknown argument type " + e[r]);
    }
    if (t.arrayArgs.length <= 0) throw new Error("cwise: No array arguments specified");
    if (t.pre.args.length > e.length) throw new Error("cwise: Too many arguments in pre() block");
    if (t.body.args.length > e.length) throw new Error("cwise: Too many arguments in body() block");
    if (t.post.args.length > e.length) throw new Error("cwise: Too many arguments in post() block");
    return t.debug = !!n.printCode || !!n.debug, t.funcName = n.funcName || "cwise", t.blockSize = n.blockSize || 64, sK(t);
  }
  mL.exports = aK;
});
var Mf = en(function (At) {
  "use strict";

  var Fn = gL(),
    Gx = {
      body: "",
      args: [],
      thisVars: [],
      localVars: []
    };
  function L_(n) {
    if (!n) return Gx;
    for (var t = 0; t < n.args.length; ++t) {
      var e = n.args[t];
      t === 0 ? n.args[t] = {
        name: e,
        lvalue: !0,
        rvalue: !!n.rvalue,
        count: n.count || 1
      } : n.args[t] = {
        name: e,
        lvalue: !1,
        rvalue: !0,
        count: 1
      };
    }
    return n.thisVars || (n.thisVars = []), n.localVars || (n.localVars = []), n;
  }
  function lK(n) {
    return Fn({
      args: n.args,
      pre: L_(n.pre),
      body: L_(n.body),
      post: L_(n.proc),
      funcName: n.funcName
    });
  }
  function Br(n) {
    for (var t = [], e = 0; e < n.args.length; ++e) t.push("a" + e);
    var r = new Function("P", ["return function ", n.funcName, "_ndarrayops(", t.join(","), ") {P(", t.join(","), ");return a0}"].join(""));
    return r(lK(n));
  }
  var yL = {
    add: "+",
    sub: "-",
    mul: "*",
    div: "/",
    mod: "%",
    band: "&",
    bor: "|",
    bxor: "^",
    lshift: "<<",
    rshift: ">>",
    rrshift: ">>>"
  };
  (function () {
    for (var n in yL) {
      var t = yL[n];
      At[n] = Br({
        args: ["array", "array", "array"],
        body: {
          args: ["a", "b", "c"],
          body: "a=b" + t + "c"
        },
        funcName: n
      }), At[n + "eq"] = Br({
        args: ["array", "array"],
        body: {
          args: ["a", "b"],
          body: "a" + t + "=b"
        },
        rvalue: !0,
        funcName: n + "eq"
      }), At[n + "s"] = Br({
        args: ["array", "array", "scalar"],
        body: {
          args: ["a", "b", "s"],
          body: "a=b" + t + "s"
        },
        funcName: n + "s"
      }), At[n + "seq"] = Br({
        args: ["array", "scalar"],
        body: {
          args: ["a", "s"],
          body: "a" + t + "=s"
        },
        rvalue: !0,
        funcName: n + "seq"
      });
    }
  })();
  var vL = {
    not: "!",
    bnot: "~",
    neg: "-",
    recip: "1.0/"
  };
  (function () {
    for (var n in vL) {
      var t = vL[n];
      At[n] = Br({
        args: ["array", "array"],
        body: {
          args: ["a", "b"],
          body: "a=" + t + "b"
        },
        funcName: n
      }), At[n + "eq"] = Br({
        args: ["array"],
        body: {
          args: ["a"],
          body: "a=" + t + "a"
        },
        rvalue: !0,
        count: 2,
        funcName: n + "eq"
      });
    }
  })();
  var xL = {
    and: "&&",
    or: "||",
    eq: "===",
    neq: "!==",
    lt: "<",
    gt: ">",
    leq: "<=",
    geq: ">="
  };
  (function () {
    for (var n in xL) {
      var t = xL[n];
      At[n] = Br({
        args: ["array", "array", "array"],
        body: {
          args: ["a", "b", "c"],
          body: "a=b" + t + "c"
        },
        funcName: n
      }), At[n + "s"] = Br({
        args: ["array", "array", "scalar"],
        body: {
          args: ["a", "b", "s"],
          body: "a=b" + t + "s"
        },
        funcName: n + "s"
      }), At[n + "eq"] = Br({
        args: ["array", "array"],
        body: {
          args: ["a", "b"],
          body: "a=a" + t + "b"
        },
        rvalue: !0,
        count: 2,
        funcName: n + "eq"
      }), At[n + "seq"] = Br({
        args: ["array", "scalar"],
        body: {
          args: ["a", "s"],
          body: "a=a" + t + "s"
        },
        rvalue: !0,
        count: 2,
        funcName: n + "seq"
      });
    }
  })();
  var bL = ["abs", "acos", "asin", "atan", "ceil", "cos", "exp", "floor", "log", "round", "sin", "sqrt", "tan"];
  (function () {
    for (var n = 0; n < bL.length; ++n) {
      var t = bL[n];
      At[t] = Br({
        args: ["array", "array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b"],
          body: "a=this_f(b)",
          thisVars: ["this_f"]
        },
        funcName: t
      }), At[t + "eq"] = Br({
        args: ["array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a"],
          body: "a=this_f(a)",
          thisVars: ["this_f"]
        },
        rvalue: !0,
        count: 2,
        funcName: t + "eq"
      });
    }
  })();
  var SL = ["max", "min", "atan2", "pow"];
  (function () {
    for (var n = 0; n < SL.length; ++n) {
      var t = SL[n];
      At[t] = Br({
        args: ["array", "array", "array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b", "c"],
          body: "a=this_f(b,c)",
          thisVars: ["this_f"]
        },
        funcName: t
      }), At[t + "s"] = Br({
        args: ["array", "array", "scalar"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b", "c"],
          body: "a=this_f(b,c)",
          thisVars: ["this_f"]
        },
        funcName: t + "s"
      }), At[t + "eq"] = Br({
        args: ["array", "array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b"],
          body: "a=this_f(a,b)",
          thisVars: ["this_f"]
        },
        rvalue: !0,
        count: 2,
        funcName: t + "eq"
      }), At[t + "seq"] = Br({
        args: ["array", "scalar"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b"],
          body: "a=this_f(a,b)",
          thisVars: ["this_f"]
        },
        rvalue: !0,
        count: 2,
        funcName: t + "seq"
      });
    }
  })();
  var wL = ["atan2", "pow"];
  (function () {
    for (var n = 0; n < wL.length; ++n) {
      var t = wL[n];
      At[t + "op"] = Br({
        args: ["array", "array", "array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b", "c"],
          body: "a=this_f(c,b)",
          thisVars: ["this_f"]
        },
        funcName: t + "op"
      }), At[t + "ops"] = Br({
        args: ["array", "array", "scalar"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b", "c"],
          body: "a=this_f(c,b)",
          thisVars: ["this_f"]
        },
        funcName: t + "ops"
      }), At[t + "opeq"] = Br({
        args: ["array", "array"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b"],
          body: "a=this_f(b,a)",
          thisVars: ["this_f"]
        },
        rvalue: !0,
        count: 2,
        funcName: t + "opeq"
      }), At[t + "opseq"] = Br({
        args: ["array", "scalar"],
        pre: {
          args: [],
          body: "this_f=Math." + t,
          thisVars: ["this_f"]
        },
        body: {
          args: ["a", "b"],
          body: "a=this_f(b,a)",
          thisVars: ["this_f"]
        },
        rvalue: !0,
        count: 2,
        funcName: t + "opseq"
      });
    }
  })();
  At.any = Fn({
    args: ["array"],
    pre: Gx,
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      body: "if(a){return true}",
      localVars: [],
      thisVars: []
    },
    post: {
      args: [],
      localVars: [],
      thisVars: [],
      body: "return false"
    },
    funcName: "any"
  });
  At.all = Fn({
    args: ["array"],
    pre: Gx,
    body: {
      args: [{
        name: "x",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      body: "if(!x){return false}",
      localVars: [],
      thisVars: []
    },
    post: {
      args: [],
      localVars: [],
      thisVars: [],
      body: "return true"
    },
    funcName: "all"
  });
  At.sum = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=0"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      body: "this_s+=a",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return this_s"
    },
    funcName: "sum"
  });
  At.prod = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=1"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      body: "this_s*=a",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return this_s"
    },
    funcName: "prod"
  });
  At.norm2squared = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=0"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      body: "this_s+=a*a",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return this_s"
    },
    funcName: "norm2squared"
  });
  At.norm2 = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=0"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      body: "this_s+=a*a",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return Math.sqrt(this_s)"
    },
    funcName: "norm2"
  });
  At.norminf = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=0"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 4
      }],
      body: "if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return this_s"
    },
    funcName: "norminf"
  });
  At.norm1 = Fn({
    args: ["array"],
    pre: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "this_s=0"
    },
    body: {
      args: [{
        name: "a",
        lvalue: !1,
        rvalue: !0,
        count: 3
      }],
      body: "this_s+=a<0?-a:a",
      localVars: [],
      thisVars: ["this_s"]
    },
    post: {
      args: [],
      localVars: [],
      thisVars: ["this_s"],
      body: "return this_s"
    },
    funcName: "norm1"
  });
  At.sup = Fn({
    args: ["array"],
    pre: {
      body: "this_h=-Infinity",
      args: [],
      thisVars: ["this_h"],
      localVars: []
    },
    body: {
      body: "if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",
      args: [{
        name: "_inline_1_arg0_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      thisVars: ["this_h"],
      localVars: []
    },
    post: {
      body: "return this_h",
      args: [],
      thisVars: ["this_h"],
      localVars: []
    }
  });
  At.inf = Fn({
    args: ["array"],
    pre: {
      body: "this_h=Infinity",
      args: [],
      thisVars: ["this_h"],
      localVars: []
    },
    body: {
      body: "if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",
      args: [{
        name: "_inline_1_arg0_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      thisVars: ["this_h"],
      localVars: []
    },
    post: {
      body: "return this_h",
      args: [],
      thisVars: ["this_h"],
      localVars: []
    }
  });
  At.argmin = Fn({
    args: ["index", "array", "shape"],
    pre: {
      body: "{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",
      args: [{
        name: "_inline_0_arg0_",
        lvalue: !1,
        rvalue: !1,
        count: 0
      }, {
        name: "_inline_0_arg1_",
        lvalue: !1,
        rvalue: !1,
        count: 0
      }, {
        name: "_inline_0_arg2_",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      thisVars: ["this_i", "this_v"],
      localVars: []
    },
    body: {
      body: "{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",
      args: [{
        name: "_inline_1_arg0_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }, {
        name: "_inline_1_arg1_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      thisVars: ["this_i", "this_v"],
      localVars: ["_inline_1_k"]
    },
    post: {
      body: "{return this_i}",
      args: [],
      thisVars: ["this_i"],
      localVars: []
    }
  });
  At.argmax = Fn({
    args: ["index", "array", "shape"],
    pre: {
      body: "{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",
      args: [{
        name: "_inline_0_arg0_",
        lvalue: !1,
        rvalue: !1,
        count: 0
      }, {
        name: "_inline_0_arg1_",
        lvalue: !1,
        rvalue: !1,
        count: 0
      }, {
        name: "_inline_0_arg2_",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      thisVars: ["this_i", "this_v"],
      localVars: []
    },
    body: {
      body: "{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",
      args: [{
        name: "_inline_1_arg0_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }, {
        name: "_inline_1_arg1_",
        lvalue: !1,
        rvalue: !0,
        count: 2
      }],
      thisVars: ["this_i", "this_v"],
      localVars: ["_inline_1_k"]
    },
    post: {
      body: "{return this_i}",
      args: [],
      thisVars: ["this_i"],
      localVars: []
    }
  });
  At.random = Br({
    args: ["array"],
    pre: {
      args: [],
      body: "this_f=Math.random",
      thisVars: ["this_f"]
    },
    body: {
      args: ["a"],
      body: "a=this_f()",
      thisVars: ["this_f"]
    },
    funcName: "random"
  });
  At.assign = Br({
    args: ["array", "array"],
    body: {
      args: ["a", "b"],
      body: "a=b"
    },
    funcName: "assign"
  });
  At.assigns = Br({
    args: ["array", "scalar"],
    body: {
      args: ["a", "b"],
      body: "a=b"
    },
    funcName: "assigns"
  });
  At.equals = Fn({
    args: ["array", "array"],
    pre: Gx,
    body: {
      args: [{
        name: "x",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }, {
        name: "y",
        lvalue: !1,
        rvalue: !0,
        count: 1
      }],
      body: "if(x!==y){return false}",
      localVars: [],
      thisVars: []
    },
    post: {
      args: [],
      localVars: [],
      thisVars: [],
      body: "return true"
    },
    funcName: "equals"
  });
});
var _N = en(function (x8e, AN) {
  AN.exports = function (t, e) {
    for (var r = t.split("."), i = e.split("."), s = 0; s < 3; s++) {
      var o = Number(r[s]),
        a = Number(i[s]);
      if (o > a) return 1;
      if (a > o) return -1;
      if (!isNaN(o) && isNaN(a)) return 1;
      if (isNaN(o) && !isNaN(a)) return -1;
    }
    return 0;
  };
});
var aa = "149";
var qn = {
    ROTATE: 0,
    PAN: 1,
    DOLLY_PAN: 2,
    DOLLY_ROTATE: 3
  },
  zN = 0,
  HE = 1,
  VN = 2;
var Ty = 1,
  UN = 2,
  ep = 3,
  jn = 0,
  ai = 1,
  qi = 2;
var Wt = 0,
  qa = 1,
  WE = 2,
  qE = 3,
  YE = 4,
  GN = 5,
  Au = 100,
  jN = 101,
  HN = 102,
  XE = 103,
  QE = 104,
  WN = 200,
  qN = 201,
  YN = 202,
  XN = 203,
  wM = 204,
  AM = 205,
  QN = 206,
  KN = 207,
  ZN = 208,
  JN = 209,
  $N = 210,
  eF = 0,
  tF = 1,
  rF = 2,
  wS = 3,
  iF = 4,
  nF = 5,
  sF = 6,
  oF = 7,
  _M = 0,
  aF = 1,
  lF = 2,
  Os = 0,
  cF = 1,
  uF = 2,
  dF = 3,
  hF = 4,
  fF = 5,
  EM = 300,
  Xa = 301,
  Qa = 302,
  AS = 303,
  _S = 304,
  Qu = 306,
  Is = 1e3,
  Ut = 1001,
  ES = 1002,
  Et = 1003,
  KE = 1004;
var zb = 1005;
var Qe = 1006,
  pF = 1007;
var dc = 1008;
var br = 1009,
  mF = 1010,
  gF = 1011,
  TM = 1012,
  yF = 1013,
  Ds = 1014,
  dr = 1015,
  sa = 1016,
  vF = 1017,
  xF = 1018,
  Ya = 1020,
  bF = 1021,
  Fr = 1023,
  SF = 1024,
  wF = 1025,
  cc = 1026,
  Ka = 1027,
  AF = 1028,
  _F = 1029,
  Ku = 1030,
  EF = 1031,
  nw = 1033,
  Vb = 33776,
  Ub = 33777,
  Gb = 33778,
  jb = 33779,
  ZE = 35840,
  JE = 35841,
  $E = 35842,
  eT = 35843,
  TF = 36196,
  tT = 37492,
  rT = 37496,
  iT = 37808,
  nT = 37809,
  sT = 37810,
  oT = 37811,
  aT = 37812,
  lT = 37813,
  cT = 37814,
  uT = 37815,
  dT = 37816,
  hT = 37817,
  fT = 37818,
  pT = 37819,
  mT = 37820,
  gT = 37821,
  Hb = 36492,
  MF = 36283,
  yT = 36284,
  vT = 36285,
  xT = 36286,
  sw = 2200,
  ow = 2201,
  Ap = 2202,
  Zg = 2300,
  Jg = 2301,
  Wb = 2302,
  _u = 2400,
  Eu = 2401,
  $g = 2402,
  aw = 2500,
  CF = 2501;
var dn = 3e3,
  tt = 3001,
  Ii = 3200,
  lw = 3201,
  PF = 0,
  DF = 1;
var ao = "srgb",
  ap = "srgb-linear";
var qb = 7680;
var OF = 519,
  TS = 35044,
  MM = 35048;
var bT = "300 es",
  MS = 1035,
  ir = /*#__PURE__*/function () {
    function ir() {
      _classCallCheck(this, ir);
    }
    _createClass(ir, [{
      key: "addEventListener",
      value: function addEventListener(t, e) {
        this._listeners === void 0 && (this._listeners = {});
        var r = this._listeners;
        r[t] === void 0 && (r[t] = []), r[t].indexOf(e) === -1 && r[t].push(e);
      }
    }, {
      key: "hasEventListener",
      value: function hasEventListener(t, e) {
        if (this._listeners === void 0) return !1;
        var r = this._listeners;
        return r[t] !== void 0 && r[t].indexOf(e) !== -1;
      }
    }, {
      key: "removeEventListener",
      value: function removeEventListener(t, e) {
        if (this._listeners === void 0) return;
        var i = this._listeners[t];
        if (i !== void 0) {
          var s = i.indexOf(e);
          s !== -1 && i.splice(s, 1);
        }
      }
    }, {
      key: "dispatchEvent",
      value: function dispatchEvent(t) {
        if (this._listeners === void 0) return;
        var r = this._listeners[t.type];
        if (r !== void 0) {
          t.target = this;
          var i = r.slice(0);
          for (var s = 0, o = i.length; s < o; s++) i[s].call(this, t);
          t.target = null;
        }
      }
    }]);
    return ir;
  }(),
  tn = ["00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "0a", "0b", "0c", "0d", "0e", "0f", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "1a", "1b", "1c", "1d", "1e", "1f", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "2a", "2b", "2c", "2d", "2e", "2f", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "3a", "3b", "3c", "3d", "3e", "3f", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "4a", "4b", "4c", "4d", "4e", "4f", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "5a", "5b", "5c", "5d", "5e", "5f", "60", "61", "62", "63", "64", "65", "66", "67", "68", "69", "6a", "6b", "6c", "6d", "6e", "6f", "70", "71", "72", "73", "74", "75", "76", "77", "78", "79", "7a", "7b", "7c", "7d", "7e", "7f", "80", "81", "82", "83", "84", "85", "86", "87", "88", "89", "8a", "8b", "8c", "8d", "8e", "8f", "90", "91", "92", "93", "94", "95", "96", "97", "98", "99", "9a", "9b", "9c", "9d", "9e", "9f", "a0", "a1", "a2", "a3", "a4", "a5", "a6", "a7", "a8", "a9", "aa", "ab", "ac", "ad", "ae", "af", "b0", "b1", "b2", "b3", "b4", "b5", "b6", "b7", "b8", "b9", "ba", "bb", "bc", "bd", "be", "bf", "c0", "c1", "c2", "c3", "c4", "c5", "c6", "c7", "c8", "c9", "ca", "cb", "cc", "cd", "ce", "cf", "d0", "d1", "d2", "d3", "d4", "d5", "d6", "d7", "d8", "d9", "da", "db", "dc", "dd", "de", "df", "e0", "e1", "e2", "e3", "e4", "e5", "e6", "e7", "e8", "e9", "ea", "eb", "ec", "ed", "ee", "ef", "f0", "f1", "f2", "f3", "f4", "f5", "f6", "f7", "f8", "f9", "fa", "fb", "fc", "fd", "fe", "ff"],
  ST = 1234567,
  rp = Math.PI / 180,
  lp = 180 / Math.PI;
function rs() {
  var n = Math.random() * 4294967295 | 0,
    t = Math.random() * 4294967295 | 0,
    e = Math.random() * 4294967295 | 0,
    r = Math.random() * 4294967295 | 0;
  return (tn[n & 255] + tn[n >> 8 & 255] + tn[n >> 16 & 255] + tn[n >> 24 & 255] + "-" + tn[t & 255] + tn[t >> 8 & 255] + "-" + tn[t >> 16 & 15 | 64] + tn[t >> 24 & 255] + "-" + tn[e & 63 | 128] + tn[e >> 8 & 255] + "-" + tn[e >> 16 & 255] + tn[e >> 24 & 255] + tn[r & 255] + tn[r >> 8 & 255] + tn[r >> 16 & 255] + tn[r >> 24 & 255]).toLowerCase();
}
function oi(n, t, e) {
  return Math.max(t, Math.min(e, n));
}
function cw(n, t) {
  return (n % t + t) % t;
}
function IF(n, t, e, r, i) {
  return r + (n - t) * (i - r) / (e - t);
}
function RF(n, t, e) {
  return n !== t ? (e - n) / (t - n) : 0;
}
function ip(n, t, e) {
  return (1 - e) * n + e * t;
}
function LF(n, t, e, r) {
  return ip(n, t, 1 - Math.exp(-e * r));
}
function BF(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
  return t - Math.abs(cw(n, t * 2) - t);
}
function NF(n, t, e) {
  return n <= t ? 0 : n >= e ? 1 : (n = (n - t) / (e - t), n * n * (3 - 2 * n));
}
function FF(n, t, e) {
  return n <= t ? 0 : n >= e ? 1 : (n = (n - t) / (e - t), n * n * n * (n * (n * 6 - 15) + 10));
}
function kF(n, t) {
  return n + Math.floor(Math.random() * (t - n + 1));
}
function zF(n, t) {
  return n + Math.random() * (t - n);
}
function VF(n) {
  return n * (.5 - Math.random());
}
function UF(n) {
  n !== void 0 && (ST = n);
  var t = ST += 1831565813;
  return t = Math.imul(t ^ t >>> 15, t | 1), t ^= t + Math.imul(t ^ t >>> 7, t | 61), ((t ^ t >>> 14) >>> 0) / 4294967296;
}
function GF(n) {
  return n * rp;
}
function jF(n) {
  return n * lp;
}
function CS(n) {
  return (n & n - 1) === 0 && n !== 0;
}
function CM(n) {
  return Math.pow(2, Math.ceil(Math.log(n) / Math.LN2));
}
function ey(n) {
  return Math.pow(2, Math.floor(Math.log(n) / Math.LN2));
}
function HF(n, t, e, r, i) {
  var s = Math.cos,
    o = Math.sin,
    a = s(e / 2),
    l = o(e / 2),
    u = s((t + r) / 2),
    c = o((t + r) / 2),
    d = s((t - r) / 2),
    h = o((t - r) / 2),
    f = s((r - t) / 2),
    p = o((r - t) / 2);
  switch (i) {
    case "XYX":
      n.set(a * c, l * d, l * h, a * u);
      break;
    case "YZY":
      n.set(l * h, a * c, l * d, a * u);
      break;
    case "ZXZ":
      n.set(l * d, l * h, a * c, a * u);
      break;
    case "XZX":
      n.set(a * c, l * p, l * f, a * u);
      break;
    case "YXY":
      n.set(l * f, a * c, l * p, a * u);
      break;
    case "ZYZ":
      n.set(l * p, l * f, a * c, a * u);
      break;
    default:
      console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: " + i);
  }
}
function na(n, t) {
  switch (t.constructor) {
    case Float32Array:
      return n;
    case Uint16Array:
      return n / 65535;
    case Uint8Array:
      return n / 255;
    case Int16Array:
      return Math.max(n / 32767, -1);
    case Int8Array:
      return Math.max(n / 127, -1);
    default:
      throw new Error("Invalid component type.");
  }
}
function ur(n, t) {
  switch (t.constructor) {
    case Float32Array:
      return n;
    case Uint16Array:
      return Math.round(n * 65535);
    case Uint8Array:
      return Math.round(n * 255);
    case Int16Array:
      return Math.round(n * 32767);
    case Int8Array:
      return Math.round(n * 127);
    default:
      throw new Error("Invalid component type.");
  }
}
var Se = Object.freeze({
    __proto__: null,
    DEG2RAD: rp,
    RAD2DEG: lp,
    ceilPowerOfTwo: CM,
    clamp: oi,
    damp: LF,
    degToRad: GF,
    denormalize: na,
    euclideanModulo: cw,
    floorPowerOfTwo: ey,
    generateUUID: rs,
    inverseLerp: RF,
    isPowerOfTwo: CS,
    lerp: ip,
    mapLinear: IF,
    normalize: ur,
    pingpong: BF,
    radToDeg: jF,
    randFloat: zF,
    randFloatSpread: VF,
    randInt: kF,
    seededRandom: UF,
    setQuaternionFromProperEuler: HF,
    smootherstep: FF,
    smoothstep: NF
  }),
  N = /*#__PURE__*/function (_Symbol$iterator) {
    function N() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      _classCallCheck(this, N);
      N.prototype.isVector2 = !0, this.x = t, this.y = e;
    }
    _createClass(N, [{
      key: "width",
      get: function get() {
        return this.x;
      },
      set: function set(t) {
        this.x = t;
      }
    }, {
      key: "height",
      get: function get() {
        return this.y;
      },
      set: function set(t) {
        this.y = t;
      }
    }, {
      key: "set",
      value: function set(t, e) {
        return this.x = t, this.y = e, this;
      }
    }, {
      key: "setScalar",
      value: function setScalar(t) {
        return this.x = t, this.y = t, this;
      }
    }, {
      key: "setX",
      value: function setX(t) {
        return this.x = t, this;
      }
    }, {
      key: "setY",
      value: function setY(t) {
        return this.y = t, this;
      }
    }, {
      key: "setComponent",
      value: function setComponent(t, e) {
        switch (t) {
          case 0:
            this.x = e;
            break;
          case 1:
            this.y = e;
            break;
          default:
            throw new Error("index is out of range: " + t);
        }
        return this;
      }
    }, {
      key: "getComponent",
      value: function getComponent(t) {
        switch (t) {
          case 0:
            return this.x;
          case 1:
            return this.y;
          default:
            throw new Error("index is out of range: " + t);
        }
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this.x, this.y);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.x = t.x, this.y = t.y, this;
      }
    }, {
      key: "add",
      value: function add(t) {
        return this.x += t.x, this.y += t.y, this;
      }
    }, {
      key: "addScalar",
      value: function addScalar(t) {
        return this.x += t, this.y += t, this;
      }
    }, {
      key: "addVectors",
      value: function addVectors(t, e) {
        return this.x = t.x + e.x, this.y = t.y + e.y, this;
      }
    }, {
      key: "addScaledVector",
      value: function addScaledVector(t, e) {
        return this.x += t.x * e, this.y += t.y * e, this;
      }
    }, {
      key: "sub",
      value: function sub(t) {
        return this.x -= t.x, this.y -= t.y, this;
      }
    }, {
      key: "subScalar",
      value: function subScalar(t) {
        return this.x -= t, this.y -= t, this;
      }
    }, {
      key: "subVectors",
      value: function subVectors(t, e) {
        return this.x = t.x - e.x, this.y = t.y - e.y, this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.x *= t.x, this.y *= t.y, this;
      }
    }, {
      key: "multiplyScalar",
      value: function multiplyScalar(t) {
        return this.x *= t, this.y *= t, this;
      }
    }, {
      key: "divide",
      value: function divide(t) {
        return this.x /= t.x, this.y /= t.y, this;
      }
    }, {
      key: "divideScalar",
      value: function divideScalar(t) {
        return this.multiplyScalar(1 / t);
      }
    }, {
      key: "applyMatrix3",
      value: function applyMatrix3(t) {
        var e = this.x,
          r = this.y,
          i = t.elements;
        return this.x = i[0] * e + i[3] * r + i[6], this.y = i[1] * e + i[4] * r + i[7], this;
      }
    }, {
      key: "min",
      value: function min(t) {
        return this.x = Math.min(this.x, t.x), this.y = Math.min(this.y, t.y), this;
      }
    }, {
      key: "max",
      value: function max(t) {
        return this.x = Math.max(this.x, t.x), this.y = Math.max(this.y, t.y), this;
      }
    }, {
      key: "clamp",
      value: function clamp(t, e) {
        return this.x = Math.max(t.x, Math.min(e.x, this.x)), this.y = Math.max(t.y, Math.min(e.y, this.y)), this;
      }
    }, {
      key: "clampScalar",
      value: function clampScalar(t, e) {
        return this.x = Math.max(t, Math.min(e, this.x)), this.y = Math.max(t, Math.min(e, this.y)), this;
      }
    }, {
      key: "clampLength",
      value: function clampLength(t, e) {
        var r = this.length();
        return this.divideScalar(r || 1).multiplyScalar(Math.max(t, Math.min(e, r)));
      }
    }, {
      key: "floor",
      value: function floor() {
        return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this;
      }
    }, {
      key: "ceil",
      value: function ceil() {
        return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this;
      }
    }, {
      key: "round",
      value: function round() {
        return this.x = Math.round(this.x), this.y = Math.round(this.y), this;
      }
    }, {
      key: "roundToZero",
      value: function roundToZero() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this;
      }
    }, {
      key: "negate",
      value: function negate() {
        return this.x = -this.x, this.y = -this.y, this;
      }
    }, {
      key: "dot",
      value: function dot(t) {
        return this.x * t.x + this.y * t.y;
      }
    }, {
      key: "cross",
      value: function cross(t) {
        return this.x * t.y - this.y * t.x;
      }
    }, {
      key: "lengthSq",
      value: function lengthSq() {
        return this.x * this.x + this.y * this.y;
      }
    }, {
      key: "length",
      value: function length() {
        return Math.sqrt(this.x * this.x + this.y * this.y);
      }
    }, {
      key: "manhattanLength",
      value: function manhattanLength() {
        return Math.abs(this.x) + Math.abs(this.y);
      }
    }, {
      key: "normalize",
      value: function normalize() {
        return this.divideScalar(this.length() || 1);
      }
    }, {
      key: "angle",
      value: function angle() {
        return Math.atan2(-this.y, -this.x) + Math.PI;
      }
    }, {
      key: "distanceTo",
      value: function distanceTo(t) {
        return Math.sqrt(this.distanceToSquared(t));
      }
    }, {
      key: "distanceToSquared",
      value: function distanceToSquared(t) {
        var e = this.x - t.x,
          r = this.y - t.y;
        return e * e + r * r;
      }
    }, {
      key: "manhattanDistanceTo",
      value: function manhattanDistanceTo(t) {
        return Math.abs(this.x - t.x) + Math.abs(this.y - t.y);
      }
    }, {
      key: "setLength",
      value: function setLength(t) {
        return this.normalize().multiplyScalar(t);
      }
    }, {
      key: "lerp",
      value: function lerp(t, e) {
        return this.x += (t.x - this.x) * e, this.y += (t.y - this.y) * e, this;
      }
    }, {
      key: "lerpVectors",
      value: function lerpVectors(t, e, r) {
        return this.x = t.x + (e.x - t.x) * r, this.y = t.y + (e.y - t.y) * r, this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.x === this.x && t.y === this.y;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this.x = t[e], this.y = t[e + 1], this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return t[e] = this.x, t[e + 1] = this.y, t;
      }
    }, {
      key: "fromBufferAttribute",
      value: function fromBufferAttribute(t, e) {
        return this.x = t.getX(e), this.y = t.getY(e), this;
      }
    }, {
      key: "rotateAround",
      value: function rotateAround(t, e) {
        var r = Math.cos(e),
          i = Math.sin(e),
          s = this.x - t.x,
          o = this.y - t.y;
        return this.x = s * r - o * i + t.x, this.y = s * i + o * r + t.y, this;
      }
    }, {
      key: "random",
      value: function random() {
        return this.x = Math.random(), this.y = Math.random(), this;
      }
    }, {
      key: _Symbol$iterator,
      value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
        return _regeneratorRuntime().wrap(function value$(_context) {
          while (1) switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return this.x;
            case 2:
              _context.next = 4;
              return this.y;
            case 4:
            case "end":
              return _context.stop();
          }
        }, value, this);
      })
    }]);
    return N;
  }(Symbol.iterator),
  Qt = /*#__PURE__*/function () {
    function Qt() {
      _classCallCheck(this, Qt);
      Qt.prototype.isMatrix3 = !0, this.elements = [1, 0, 0, 0, 1, 0, 0, 0, 1];
    }
    _createClass(Qt, [{
      key: "set",
      value: function set(t, e, r, i, s, o, a, l, u) {
        var c = this.elements;
        return c[0] = t, c[1] = i, c[2] = a, c[3] = e, c[4] = s, c[5] = l, c[6] = r, c[7] = o, c[8] = u, this;
      }
    }, {
      key: "identity",
      value: function identity() {
        return this.set(1, 0, 0, 0, 1, 0, 0, 0, 1), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        var e = this.elements,
          r = t.elements;
        return e[0] = r[0], e[1] = r[1], e[2] = r[2], e[3] = r[3], e[4] = r[4], e[5] = r[5], e[6] = r[6], e[7] = r[7], e[8] = r[8], this;
      }
    }, {
      key: "extractBasis",
      value: function extractBasis(t, e, r) {
        return t.setFromMatrix3Column(this, 0), e.setFromMatrix3Column(this, 1), r.setFromMatrix3Column(this, 2), this;
      }
    }, {
      key: "setFromMatrix4",
      value: function setFromMatrix4(t) {
        var e = t.elements;
        return this.set(e[0], e[4], e[8], e[1], e[5], e[9], e[2], e[6], e[10]), this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.multiplyMatrices(this, t);
      }
    }, {
      key: "premultiply",
      value: function premultiply(t) {
        return this.multiplyMatrices(t, this);
      }
    }, {
      key: "multiplyMatrices",
      value: function multiplyMatrices(t, e) {
        var r = t.elements,
          i = e.elements,
          s = this.elements,
          o = r[0],
          a = r[3],
          l = r[6],
          u = r[1],
          c = r[4],
          d = r[7],
          h = r[2],
          f = r[5],
          p = r[8],
          m = i[0],
          g = i[3],
          y = i[6],
          v = i[1],
          x = i[4],
          S = i[7],
          w = i[2],
          A = i[5],
          E = i[8];
        return s[0] = o * m + a * v + l * w, s[3] = o * g + a * x + l * A, s[6] = o * y + a * S + l * E, s[1] = u * m + c * v + d * w, s[4] = u * g + c * x + d * A, s[7] = u * y + c * S + d * E, s[2] = h * m + f * v + p * w, s[5] = h * g + f * x + p * A, s[8] = h * y + f * S + p * E, this;
      }
    }, {
      key: "multiplyScalar",
      value: function multiplyScalar(t) {
        var e = this.elements;
        return e[0] *= t, e[3] *= t, e[6] *= t, e[1] *= t, e[4] *= t, e[7] *= t, e[2] *= t, e[5] *= t, e[8] *= t, this;
      }
    }, {
      key: "determinant",
      value: function determinant() {
        var t = this.elements,
          e = t[0],
          r = t[1],
          i = t[2],
          s = t[3],
          o = t[4],
          a = t[5],
          l = t[6],
          u = t[7],
          c = t[8];
        return e * o * c - e * a * u - r * s * c + r * a * l + i * s * u - i * o * l;
      }
    }, {
      key: "invert",
      value: function invert() {
        var t = this.elements,
          e = t[0],
          r = t[1],
          i = t[2],
          s = t[3],
          o = t[4],
          a = t[5],
          l = t[6],
          u = t[7],
          c = t[8],
          d = c * o - a * u,
          h = a * l - c * s,
          f = u * s - o * l,
          p = e * d + r * h + i * f;
        if (p === 0) return this.set(0, 0, 0, 0, 0, 0, 0, 0, 0);
        var m = 1 / p;
        return t[0] = d * m, t[1] = (i * u - c * r) * m, t[2] = (a * r - i * o) * m, t[3] = h * m, t[4] = (c * e - i * l) * m, t[5] = (i * s - a * e) * m, t[6] = f * m, t[7] = (r * l - u * e) * m, t[8] = (o * e - r * s) * m, this;
      }
    }, {
      key: "transpose",
      value: function transpose() {
        var t,
          e = this.elements;
        return t = e[1], e[1] = e[3], e[3] = t, t = e[2], e[2] = e[6], e[6] = t, t = e[5], e[5] = e[7], e[7] = t, this;
      }
    }, {
      key: "getNormalMatrix",
      value: function getNormalMatrix(t) {
        return this.setFromMatrix4(t).invert().transpose();
      }
    }, {
      key: "transposeIntoArray",
      value: function transposeIntoArray(t) {
        var e = this.elements;
        return t[0] = e[0], t[1] = e[3], t[2] = e[6], t[3] = e[1], t[4] = e[4], t[5] = e[7], t[6] = e[2], t[7] = e[5], t[8] = e[8], this;
      }
    }, {
      key: "setUvTransform",
      value: function setUvTransform(t, e, r, i, s, o, a) {
        var l = Math.cos(s),
          u = Math.sin(s);
        return this.set(r * l, r * u, -r * (l * o + u * a) + o + t, -i * u, i * l, -i * (-u * o + l * a) + a + e, 0, 0, 1), this;
      }
    }, {
      key: "scale",
      value: function scale(t, e) {
        return this.premultiply(Yb.makeScale(t, e)), this;
      }
    }, {
      key: "rotate",
      value: function rotate(t) {
        return this.premultiply(Yb.makeRotation(-t)), this;
      }
    }, {
      key: "translate",
      value: function translate(t, e) {
        return this.premultiply(Yb.makeTranslation(t, e)), this;
      }
    }, {
      key: "makeTranslation",
      value: function makeTranslation(t, e) {
        return this.set(1, 0, t, 0, 1, e, 0, 0, 1), this;
      }
    }, {
      key: "makeRotation",
      value: function makeRotation(t) {
        var e = Math.cos(t),
          r = Math.sin(t);
        return this.set(e, -r, 0, r, e, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeScale",
      value: function makeScale(t, e) {
        return this.set(t, 0, 0, 0, e, 0, 0, 0, 1), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        var e = this.elements,
          r = t.elements;
        for (var i = 0; i < 9; i++) if (e[i] !== r[i]) return !1;
        return !0;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        for (var r = 0; r < 9; r++) this.elements[r] = t[r + e];
        return this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = this.elements;
        return t[e] = r[0], t[e + 1] = r[1], t[e + 2] = r[2], t[e + 3] = r[3], t[e + 4] = r[4], t[e + 5] = r[5], t[e + 6] = r[6], t[e + 7] = r[7], t[e + 8] = r[8], t;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().fromArray(this.elements);
      }
    }]);
    return Qt;
  }(),
  Yb = new Qt();
function PM(n) {
  for (var t = n.length - 1; t >= 0; --t) if (n[t] >= 65535) return !0;
  return !1;
}
var WF = {
  Int8Array: Int8Array,
  Uint8Array: Uint8Array,
  Uint8ClampedArray: Uint8ClampedArray,
  Int16Array: Int16Array,
  Uint16Array: Uint16Array,
  Int32Array: Int32Array,
  Uint32Array: Uint32Array,
  Float32Array: Float32Array,
  Float64Array: Float64Array
};
function wg(n, t) {
  return new WF[n](t);
}
function cp(n) {
  return document.createElementNS("http://www.w3.org/1999/xhtml", n);
}
function uc(n) {
  return n < .04045 ? n * .0773993808 : Math.pow(n * .9478672986 + .0521327014, 2.4);
}
function Kg(n) {
  return n < .0031308 ? n * 12.92 : 1.055 * Math.pow(n, .41666) - .055;
}
var Xb = _defineProperty(_defineProperty({}, ao, _defineProperty({}, ap, uc)), ap, _defineProperty({}, ao, Kg)),
  ln = {
    legacyMode: !0,
    get workingColorSpace() {
      return ap;
    },
    set workingColorSpace(n) {
      console.warn("THREE.ColorManagement: .workingColorSpace is readonly.");
    },
    convert: function convert(n, t, e) {
      if (this.legacyMode || t === e || !t || !e) return n;
      if (Xb[t] && Xb[t][e] !== void 0) {
        var r = Xb[t][e];
        return n.r = r(n.r), n.g = r(n.g), n.b = r(n.b), n;
      }
      throw new Error("Unsupported color space conversion.");
    },
    fromWorkingColorSpace: function fromWorkingColorSpace(n, t) {
      return this.convert(n, this.workingColorSpace, t);
    },
    toWorkingColorSpace: function toWorkingColorSpace(n, t) {
      return this.convert(n, t, this.workingColorSpace);
    }
  },
  DM = {
    aliceblue: 15792383,
    antiquewhite: 16444375,
    aqua: 65535,
    aquamarine: 8388564,
    azure: 15794175,
    beige: 16119260,
    bisque: 16770244,
    black: 0,
    blanchedalmond: 16772045,
    blue: 255,
    blueviolet: 9055202,
    brown: 10824234,
    burlywood: 14596231,
    cadetblue: 6266528,
    chartreuse: 8388352,
    chocolate: 13789470,
    coral: 16744272,
    cornflowerblue: 6591981,
    cornsilk: 16775388,
    crimson: 14423100,
    cyan: 65535,
    darkblue: 139,
    darkcyan: 35723,
    darkgoldenrod: 12092939,
    darkgray: 11119017,
    darkgreen: 25600,
    darkgrey: 11119017,
    darkkhaki: 12433259,
    darkmagenta: 9109643,
    darkolivegreen: 5597999,
    darkorange: 16747520,
    darkorchid: 10040012,
    darkred: 9109504,
    darksalmon: 15308410,
    darkseagreen: 9419919,
    darkslateblue: 4734347,
    darkslategray: 3100495,
    darkslategrey: 3100495,
    darkturquoise: 52945,
    darkviolet: 9699539,
    deeppink: 16716947,
    deepskyblue: 49151,
    dimgray: 6908265,
    dimgrey: 6908265,
    dodgerblue: 2003199,
    firebrick: 11674146,
    floralwhite: 16775920,
    forestgreen: 2263842,
    fuchsia: 16711935,
    gainsboro: 14474460,
    ghostwhite: 16316671,
    gold: 16766720,
    goldenrod: 14329120,
    gray: 8421504,
    green: 32768,
    greenyellow: 11403055,
    grey: 8421504,
    honeydew: 15794160,
    hotpink: 16738740,
    indianred: 13458524,
    indigo: 4915330,
    ivory: 16777200,
    khaki: 15787660,
    lavender: 15132410,
    lavenderblush: 16773365,
    lawngreen: 8190976,
    lemonchiffon: 16775885,
    lightblue: 11393254,
    lightcoral: 15761536,
    lightcyan: 14745599,
    lightgoldenrodyellow: 16448210,
    lightgray: 13882323,
    lightgreen: 9498256,
    lightgrey: 13882323,
    lightpink: 16758465,
    lightsalmon: 16752762,
    lightseagreen: 2142890,
    lightskyblue: 8900346,
    lightslategray: 7833753,
    lightslategrey: 7833753,
    lightsteelblue: 11584734,
    lightyellow: 16777184,
    lime: 65280,
    limegreen: 3329330,
    linen: 16445670,
    magenta: 16711935,
    maroon: 8388608,
    mediumaquamarine: 6737322,
    mediumblue: 205,
    mediumorchid: 12211667,
    mediumpurple: 9662683,
    mediumseagreen: 3978097,
    mediumslateblue: 8087790,
    mediumspringgreen: 64154,
    mediumturquoise: 4772300,
    mediumvioletred: 13047173,
    midnightblue: 1644912,
    mintcream: 16121850,
    mistyrose: 16770273,
    moccasin: 16770229,
    navajowhite: 16768685,
    navy: 128,
    oldlace: 16643558,
    olive: 8421376,
    olivedrab: 7048739,
    orange: 16753920,
    orangered: 16729344,
    orchid: 14315734,
    palegoldenrod: 15657130,
    palegreen: 10025880,
    paleturquoise: 11529966,
    palevioletred: 14381203,
    papayawhip: 16773077,
    peachpuff: 16767673,
    peru: 13468991,
    pink: 16761035,
    plum: 14524637,
    powderblue: 11591910,
    purple: 8388736,
    rebeccapurple: 6697881,
    red: 16711680,
    rosybrown: 12357519,
    royalblue: 4286945,
    saddlebrown: 9127187,
    salmon: 16416882,
    sandybrown: 16032864,
    seagreen: 3050327,
    seashell: 16774638,
    sienna: 10506797,
    silver: 12632256,
    skyblue: 8900331,
    slateblue: 6970061,
    slategray: 7372944,
    slategrey: 7372944,
    snow: 16775930,
    springgreen: 65407,
    steelblue: 4620980,
    tan: 13808780,
    teal: 32896,
    thistle: 14204888,
    tomato: 16737095,
    turquoise: 4251856,
    violet: 15631086,
    wheat: 16113331,
    white: 16777215,
    whitesmoke: 16119285,
    yellow: 16776960,
    yellowgreen: 10145074
  },
  mi = {
    r: 0,
    g: 0,
    b: 0
  },
  Ms = {
    h: 0,
    s: 0,
    l: 0
  },
  Ag = {
    h: 0,
    s: 0,
    l: 0
  };
function Qb(n, t, e) {
  return e < 0 && (e += 1), e > 1 && (e -= 1), e < 1 / 6 ? n + (t - n) * 6 * e : e < 1 / 2 ? t : e < 2 / 3 ? n + (t - n) * 6 * (2 / 3 - e) : n;
}
function _g(n, t) {
  return t.r = n.r, t.g = n.g, t.b = n.b, t;
}
var Le = /*#__PURE__*/function (_Symbol$iterator2) {
  function Le(t, e, r) {
    _classCallCheck(this, Le);
    return this.isColor = !0, this.r = 1, this.g = 1, this.b = 1, e === void 0 && r === void 0 ? this.set(t) : this.setRGB(t, e, r);
  }
  _createClass(Le, [{
    key: "set",
    value: function set(t) {
      return t && t.isColor ? this.copy(t) : typeof t == "number" ? this.setHex(t) : typeof t == "string" && this.setStyle(t), this;
    }
  }, {
    key: "setScalar",
    value: function setScalar(t) {
      return this.r = t, this.g = t, this.b = t, this;
    }
  }, {
    key: "setHex",
    value: function setHex(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ao;
      return t = Math.floor(t), this.r = (t >> 16 & 255) / 255, this.g = (t >> 8 & 255) / 255, this.b = (t & 255) / 255, ln.toWorkingColorSpace(this, e), this;
    }
  }, {
    key: "setRGB",
    value: function setRGB(t, e, r) {
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : ln.workingColorSpace;
      return this.r = t, this.g = e, this.b = r, ln.toWorkingColorSpace(this, i), this;
    }
  }, {
    key: "setHSL",
    value: function setHSL(t, e, r) {
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : ln.workingColorSpace;
      if (t = cw(t, 1), e = oi(e, 0, 1), r = oi(r, 0, 1), e === 0) this.r = this.g = this.b = r;else {
        var s = r <= .5 ? r * (1 + e) : r + e - r * e,
          o = 2 * r - s;
        this.r = Qb(o, s, t + 1 / 3), this.g = Qb(o, s, t), this.b = Qb(o, s, t - 1 / 3);
      }
      return ln.toWorkingColorSpace(this, i), this;
    }
  }, {
    key: "setStyle",
    value: function setStyle(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ao;
      function r(s) {
        s !== void 0 && parseFloat(s) < 1 && console.warn("THREE.Color: Alpha component of " + t + " will be ignored.");
      }
      var i;
      if (i = /^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)) {
        var s,
          o = i[1],
          a = i[2];
        switch (o) {
          case "rgb":
          case "rgba":
            if (s = /^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)) return this.r = Math.min(255, parseInt(s[1], 10)) / 255, this.g = Math.min(255, parseInt(s[2], 10)) / 255, this.b = Math.min(255, parseInt(s[3], 10)) / 255, ln.toWorkingColorSpace(this, e), r(s[4]), this;
            if (s = /^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)) return this.r = Math.min(100, parseInt(s[1], 10)) / 100, this.g = Math.min(100, parseInt(s[2], 10)) / 100, this.b = Math.min(100, parseInt(s[3], 10)) / 100, ln.toWorkingColorSpace(this, e), r(s[4]), this;
            break;
          case "hsl":
          case "hsla":
            if (s = /^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)) {
              var l = parseFloat(s[1]) / 360,
                u = parseFloat(s[2]) / 100,
                c = parseFloat(s[3]) / 100;
              return r(s[4]), this.setHSL(l, u, c, e);
            }
            break;
        }
      } else if (i = /^\#([A-Fa-f\d]+)$/.exec(t)) {
        var _s2 = i[1],
          _o2 = _s2.length;
        if (_o2 === 3) return this.r = parseInt(_s2.charAt(0) + _s2.charAt(0), 16) / 255, this.g = parseInt(_s2.charAt(1) + _s2.charAt(1), 16) / 255, this.b = parseInt(_s2.charAt(2) + _s2.charAt(2), 16) / 255, ln.toWorkingColorSpace(this, e), this;
        if (_o2 === 6) return this.r = parseInt(_s2.charAt(0) + _s2.charAt(1), 16) / 255, this.g = parseInt(_s2.charAt(2) + _s2.charAt(3), 16) / 255, this.b = parseInt(_s2.charAt(4) + _s2.charAt(5), 16) / 255, ln.toWorkingColorSpace(this, e), this;
      }
      return t && t.length > 0 ? this.setColorName(t, e) : this;
    }
  }, {
    key: "setColorName",
    value: function setColorName(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ao;
      var r = DM[t.toLowerCase()];
      return r !== void 0 ? this.setHex(r, e) : console.warn("THREE.Color: Unknown color " + t), this;
    }
  }, {
    key: "clone",
    value: function clone() {
      return new this.constructor(this.r, this.g, this.b);
    }
  }, {
    key: "copy",
    value: function copy(t) {
      return this.r = t.r, this.g = t.g, this.b = t.b, this;
    }
  }, {
    key: "copySRGBToLinear",
    value: function copySRGBToLinear(t) {
      return this.r = uc(t.r), this.g = uc(t.g), this.b = uc(t.b), this;
    }
  }, {
    key: "copyLinearToSRGB",
    value: function copyLinearToSRGB(t) {
      return this.r = Kg(t.r), this.g = Kg(t.g), this.b = Kg(t.b), this;
    }
  }, {
    key: "convertSRGBToLinear",
    value: function convertSRGBToLinear() {
      return this.copySRGBToLinear(this), this;
    }
  }, {
    key: "convertLinearToSRGB",
    value: function convertLinearToSRGB() {
      return this.copyLinearToSRGB(this), this;
    }
  }, {
    key: "getHex",
    value: function getHex() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ao;
      return ln.fromWorkingColorSpace(_g(this, mi), t), oi(mi.r * 255, 0, 255) << 16 ^ oi(mi.g * 255, 0, 255) << 8 ^ oi(mi.b * 255, 0, 255) << 0;
    }
  }, {
    key: "getHexString",
    value: function getHexString() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ao;
      return ("000000" + this.getHex(t).toString(16)).slice(-6);
    }
  }, {
    key: "getHSL",
    value: function getHSL(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ln.workingColorSpace;
      ln.fromWorkingColorSpace(_g(this, mi), e);
      var r = mi.r,
        i = mi.g,
        s = mi.b,
        o = Math.max(r, i, s),
        a = Math.min(r, i, s),
        l,
        u,
        c = (a + o) / 2;
      if (a === o) l = 0, u = 0;else {
        var d = o - a;
        switch (u = c <= .5 ? d / (o + a) : d / (2 - o - a), o) {
          case r:
            l = (i - s) / d + (i < s ? 6 : 0);
            break;
          case i:
            l = (s - r) / d + 2;
            break;
          case s:
            l = (r - i) / d + 4;
            break;
        }
        l /= 6;
      }
      return t.h = l, t.s = u, t.l = c, t;
    }
  }, {
    key: "getRGB",
    value: function getRGB(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ln.workingColorSpace;
      return ln.fromWorkingColorSpace(_g(this, mi), e), t.r = mi.r, t.g = mi.g, t.b = mi.b, t;
    }
  }, {
    key: "getStyle",
    value: function getStyle() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : ao;
      return ln.fromWorkingColorSpace(_g(this, mi), t), t !== ao ? "color(".concat(t, " ").concat(mi.r, " ").concat(mi.g, " ").concat(mi.b, ")") : "rgb(".concat(mi.r * 255 | 0, ",").concat(mi.g * 255 | 0, ",").concat(mi.b * 255 | 0, ")");
    }
  }, {
    key: "offsetHSL",
    value: function offsetHSL(t, e, r) {
      return this.getHSL(Ms), Ms.h += t, Ms.s += e, Ms.l += r, this.setHSL(Ms.h, Ms.s, Ms.l), this;
    }
  }, {
    key: "add",
    value: function add(t) {
      return this.r += t.r, this.g += t.g, this.b += t.b, this;
    }
  }, {
    key: "addColors",
    value: function addColors(t, e) {
      return this.r = t.r + e.r, this.g = t.g + e.g, this.b = t.b + e.b, this;
    }
  }, {
    key: "addScalar",
    value: function addScalar(t) {
      return this.r += t, this.g += t, this.b += t, this;
    }
  }, {
    key: "sub",
    value: function sub(t) {
      return this.r = Math.max(0, this.r - t.r), this.g = Math.max(0, this.g - t.g), this.b = Math.max(0, this.b - t.b), this;
    }
  }, {
    key: "multiply",
    value: function multiply(t) {
      return this.r *= t.r, this.g *= t.g, this.b *= t.b, this;
    }
  }, {
    key: "multiplyScalar",
    value: function multiplyScalar(t) {
      return this.r *= t, this.g *= t, this.b *= t, this;
    }
  }, {
    key: "lerp",
    value: function lerp(t, e) {
      return this.r += (t.r - this.r) * e, this.g += (t.g - this.g) * e, this.b += (t.b - this.b) * e, this;
    }
  }, {
    key: "lerpColors",
    value: function lerpColors(t, e, r) {
      return this.r = t.r + (e.r - t.r) * r, this.g = t.g + (e.g - t.g) * r, this.b = t.b + (e.b - t.b) * r, this;
    }
  }, {
    key: "lerpHSL",
    value: function lerpHSL(t, e) {
      this.getHSL(Ms), t.getHSL(Ag);
      var r = ip(Ms.h, Ag.h, e),
        i = ip(Ms.s, Ag.s, e),
        s = ip(Ms.l, Ag.l, e);
      return this.setHSL(r, i, s), this;
    }
  }, {
    key: "equals",
    value: function equals(t) {
      return t.r === this.r && t.g === this.g && t.b === this.b;
    }
  }, {
    key: "fromArray",
    value: function fromArray(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      return this.r = t[e], this.g = t[e + 1], this.b = t[e + 2], this;
    }
  }, {
    key: "toArray",
    value: function toArray() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      return t[e] = this.r, t[e + 1] = this.g, t[e + 2] = this.b, t;
    }
  }, {
    key: "fromBufferAttribute",
    value: function fromBufferAttribute(t, e) {
      return this.r = t.getX(e), this.g = t.getY(e), this.b = t.getZ(e), this;
    }
  }, {
    key: "toJSON",
    value: function toJSON() {
      return this.getHex();
    }
  }, {
    key: _Symbol$iterator2,
    value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
      return _regeneratorRuntime().wrap(function value$(_context2) {
        while (1) switch (_context2.prev = _context2.next) {
          case 0:
            _context2.next = 2;
            return this.r;
          case 2:
            _context2.next = 4;
            return this.g;
          case 4:
            _context2.next = 6;
            return this.b;
          case 6:
          case "end":
            return _context2.stop();
        }
      }, value, this);
    })
  }]);
  return Le;
}(Symbol.iterator);
Le.NAMES = DM;
var cu,
  ty = /*#__PURE__*/function () {
    function ty() {
      _classCallCheck(this, ty);
    }
    _createClass(ty, null, [{
      key: "getDataURL",
      value: function getDataURL(t) {
        if (/^data:/i.test(t.src) || (typeof HTMLCanvasElement === "undefined" ? "undefined" : _typeof(HTMLCanvasElement)) > "u") return t.src;
        var e;
        if (t instanceof HTMLCanvasElement) e = t;else {
          cu === void 0 && (cu = cp("canvas")), cu.width = t.width, cu.height = t.height;
          var r = cu.getContext("2d");
          t instanceof ImageData ? r.putImageData(t, 0, 0) : r.drawImage(t, 0, 0, t.width, t.height), e = cu;
        }
        return e.width > 2048 || e.height > 2048 ? (console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons", t), e.toDataURL("image/jpeg", .6)) : e.toDataURL("image/png");
      }
    }, {
      key: "sRGBToLinear",
      value: function sRGBToLinear(t) {
        if ((typeof HTMLImageElement === "undefined" ? "undefined" : _typeof(HTMLImageElement)) < "u" && t instanceof HTMLImageElement || (typeof HTMLCanvasElement === "undefined" ? "undefined" : _typeof(HTMLCanvasElement)) < "u" && t instanceof HTMLCanvasElement || (typeof ImageBitmap === "undefined" ? "undefined" : _typeof(ImageBitmap)) < "u" && t instanceof ImageBitmap) {
          var e = cp("canvas");
          e.width = t.width, e.height = t.height;
          var r = e.getContext("2d");
          r.drawImage(t, 0, 0, t.width, t.height);
          var i = r.getImageData(0, 0, t.width, t.height),
            s = i.data;
          for (var o = 0; o < s.length; o++) s[o] = uc(s[o] / 255) * 255;
          return r.putImageData(i, 0, 0), e;
        } else if (t.data) {
          var _e2 = t.data.slice(0);
          for (var _r2 = 0; _r2 < _e2.length; _r2++) _e2 instanceof Uint8Array || _e2 instanceof Uint8ClampedArray ? _e2[_r2] = Math.floor(uc(_e2[_r2] / 255) * 255) : _e2[_r2] = uc(_e2[_r2]);
          return {
            data: _e2,
            width: t.width,
            height: t.height
          };
        } else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."), t;
      }
    }]);
    return ty;
  }(),
  ry = /*#__PURE__*/function () {
    function ry() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      _classCallCheck(this, ry);
      this.isSource = !0, this.uuid = rs(), this.data = t, this.version = 0;
    }
    _createClass(ry, [{
      key: "needsUpdate",
      set: function set(t) {
        t === !0 && this.version++;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = t === void 0 || typeof t == "string";
        if (!e && t.images[this.uuid] !== void 0) return t.images[this.uuid];
        var r = {
            uuid: this.uuid,
            url: ""
          },
          i = this.data;
        if (i !== null) {
          var s;
          if (Array.isArray(i)) {
            s = [];
            for (var o = 0, a = i.length; o < a; o++) i[o].isDataTexture ? s.push(Kb(i[o].image)) : s.push(Kb(i[o]));
          } else s = Kb(i);
          r.url = s;
        }
        return e || (t.images[this.uuid] = r), r;
      }
    }]);
    return ry;
  }();
function Kb(n) {
  return (typeof HTMLImageElement === "undefined" ? "undefined" : _typeof(HTMLImageElement)) < "u" && n instanceof HTMLImageElement || (typeof HTMLCanvasElement === "undefined" ? "undefined" : _typeof(HTMLCanvasElement)) < "u" && n instanceof HTMLCanvasElement || (typeof ImageBitmap === "undefined" ? "undefined" : _typeof(ImageBitmap)) < "u" && n instanceof ImageBitmap ? ty.getDataURL(n) : n.data ? {
    data: Array.from(n.data),
    width: n.width,
    height: n.height,
    type: n.data.constructor.name
  } : (console.warn("THREE.Texture: Unable to serialize Texture."), {});
}
var qF = 0,
  qt = /*#__PURE__*/function (_ir) {
    _inherits(qt, _ir);
    var _super = _createSuper(qt);
    function qt() {
      var _this;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : qt.DEFAULT_IMAGE;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : qt.DEFAULT_MAPPING;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Ut;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Ut;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Qe;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : dc;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : Fr;
      var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : br;
      var u = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : qt.DEFAULT_ANISOTROPY;
      var c = arguments.length > 9 && arguments[9] !== undefined ? arguments[9] : dn;
      _classCallCheck(this, qt);
      _this = _super.call(this), _this.isTexture = !0, Object.defineProperty(_assertThisInitialized(_this), "id", {
        value: qF++
      }), _this.uuid = rs(), _this.name = "", _this.source = new ry(t), _this.mipmaps = [], _this.mapping = e, _this.wrapS = r, _this.wrapT = i, _this.magFilter = s, _this.minFilter = o, _this.anisotropy = u, _this.format = a, _this.internalFormat = null, _this.type = l, _this.offset = new N(0, 0), _this.repeat = new N(1, 1), _this.center = new N(0, 0), _this.rotation = 0, _this.matrixAutoUpdate = !0, _this.matrix = new Qt(), _this.generateMipmaps = !0, _this.premultiplyAlpha = !1, _this.flipY = !0, _this.unpackAlignment = 4, _this.encoding = c, _this.userData = {}, _this.version = 0, _this.onUpdate = null, _this.isRenderTargetTexture = !1, _this.needsPMREMUpdate = !1;
      return _this;
    }
    _createClass(qt, [{
      key: "image",
      get: function get() {
        return this.source.data;
      },
      set: function set(t) {
        this.source.data = t;
      }
    }, {
      key: "updateMatrix",
      value: function updateMatrix() {
        this.matrix.setUvTransform(this.offset.x, this.offset.y, this.repeat.x, this.repeat.y, this.rotation, this.center.x, this.center.y);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.name = t.name, this.source = t.source, this.mipmaps = t.mipmaps.slice(0), this.mapping = t.mapping, this.wrapS = t.wrapS, this.wrapT = t.wrapT, this.magFilter = t.magFilter, this.minFilter = t.minFilter, this.anisotropy = t.anisotropy, this.format = t.format, this.internalFormat = t.internalFormat, this.type = t.type, this.offset.copy(t.offset), this.repeat.copy(t.repeat), this.center.copy(t.center), this.rotation = t.rotation, this.matrixAutoUpdate = t.matrixAutoUpdate, this.matrix.copy(t.matrix), this.generateMipmaps = t.generateMipmaps, this.premultiplyAlpha = t.premultiplyAlpha, this.flipY = t.flipY, this.unpackAlignment = t.unpackAlignment, this.encoding = t.encoding, this.userData = JSON.parse(JSON.stringify(t.userData)), this.needsUpdate = !0, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = t === void 0 || typeof t == "string";
        if (!e && t.textures[this.uuid] !== void 0) return t.textures[this.uuid];
        var r = {
          metadata: {
            version: 4.5,
            type: "Texture",
            generator: "Texture.toJSON"
          },
          uuid: this.uuid,
          name: this.name,
          image: this.source.toJSON(t).uuid,
          mapping: this.mapping,
          repeat: [this.repeat.x, this.repeat.y],
          offset: [this.offset.x, this.offset.y],
          center: [this.center.x, this.center.y],
          rotation: this.rotation,
          wrap: [this.wrapS, this.wrapT],
          format: this.format,
          type: this.type,
          encoding: this.encoding,
          minFilter: this.minFilter,
          magFilter: this.magFilter,
          anisotropy: this.anisotropy,
          flipY: this.flipY,
          generateMipmaps: this.generateMipmaps,
          premultiplyAlpha: this.premultiplyAlpha,
          unpackAlignment: this.unpackAlignment
        };
        return Object.keys(this.userData).length > 0 && (r.userData = this.userData), e || (t.textures[this.uuid] = r), r;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }, {
      key: "transformUv",
      value: function transformUv(t) {
        if (this.mapping !== EM) return t;
        if (t.applyMatrix3(this.matrix), t.x < 0 || t.x > 1) switch (this.wrapS) {
          case Is:
            t.x = t.x - Math.floor(t.x);
            break;
          case Ut:
            t.x = t.x < 0 ? 0 : 1;
            break;
          case ES:
            Math.abs(Math.floor(t.x) % 2) === 1 ? t.x = Math.ceil(t.x) - t.x : t.x = t.x - Math.floor(t.x);
            break;
        }
        if (t.y < 0 || t.y > 1) switch (this.wrapT) {
          case Is:
            t.y = t.y - Math.floor(t.y);
            break;
          case Ut:
            t.y = t.y < 0 ? 0 : 1;
            break;
          case ES:
            Math.abs(Math.floor(t.y) % 2) === 1 ? t.y = Math.ceil(t.y) - t.y : t.y = t.y - Math.floor(t.y);
            break;
        }
        return this.flipY && (t.y = 1 - t.y), t;
      }
    }, {
      key: "needsUpdate",
      set: function set(t) {
        t === !0 && (this.version++, this.source.needsUpdate = !0);
      }
    }]);
    return qt;
  }(ir);
qt.DEFAULT_IMAGE = null;
qt.DEFAULT_MAPPING = EM;
qt.DEFAULT_ANISOTROPY = 1;
var He = /*#__PURE__*/function (_Symbol$iterator3) {
    function He() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, He);
      He.prototype.isVector4 = !0, this.x = t, this.y = e, this.z = r, this.w = i;
    }
    _createClass(He, [{
      key: "width",
      get: function get() {
        return this.z;
      },
      set: function set(t) {
        this.z = t;
      }
    }, {
      key: "height",
      get: function get() {
        return this.w;
      },
      set: function set(t) {
        this.w = t;
      }
    }, {
      key: "set",
      value: function set(t, e, r, i) {
        return this.x = t, this.y = e, this.z = r, this.w = i, this;
      }
    }, {
      key: "setScalar",
      value: function setScalar(t) {
        return this.x = t, this.y = t, this.z = t, this.w = t, this;
      }
    }, {
      key: "setX",
      value: function setX(t) {
        return this.x = t, this;
      }
    }, {
      key: "setY",
      value: function setY(t) {
        return this.y = t, this;
      }
    }, {
      key: "setZ",
      value: function setZ(t) {
        return this.z = t, this;
      }
    }, {
      key: "setW",
      value: function setW(t) {
        return this.w = t, this;
      }
    }, {
      key: "setComponent",
      value: function setComponent(t, e) {
        switch (t) {
          case 0:
            this.x = e;
            break;
          case 1:
            this.y = e;
            break;
          case 2:
            this.z = e;
            break;
          case 3:
            this.w = e;
            break;
          default:
            throw new Error("index is out of range: " + t);
        }
        return this;
      }
    }, {
      key: "getComponent",
      value: function getComponent(t) {
        switch (t) {
          case 0:
            return this.x;
          case 1:
            return this.y;
          case 2:
            return this.z;
          case 3:
            return this.w;
          default:
            throw new Error("index is out of range: " + t);
        }
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this.x, this.y, this.z, this.w);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.x = t.x, this.y = t.y, this.z = t.z, this.w = t.w !== void 0 ? t.w : 1, this;
      }
    }, {
      key: "add",
      value: function add(t) {
        return this.x += t.x, this.y += t.y, this.z += t.z, this.w += t.w, this;
      }
    }, {
      key: "addScalar",
      value: function addScalar(t) {
        return this.x += t, this.y += t, this.z += t, this.w += t, this;
      }
    }, {
      key: "addVectors",
      value: function addVectors(t, e) {
        return this.x = t.x + e.x, this.y = t.y + e.y, this.z = t.z + e.z, this.w = t.w + e.w, this;
      }
    }, {
      key: "addScaledVector",
      value: function addScaledVector(t, e) {
        return this.x += t.x * e, this.y += t.y * e, this.z += t.z * e, this.w += t.w * e, this;
      }
    }, {
      key: "sub",
      value: function sub(t) {
        return this.x -= t.x, this.y -= t.y, this.z -= t.z, this.w -= t.w, this;
      }
    }, {
      key: "subScalar",
      value: function subScalar(t) {
        return this.x -= t, this.y -= t, this.z -= t, this.w -= t, this;
      }
    }, {
      key: "subVectors",
      value: function subVectors(t, e) {
        return this.x = t.x - e.x, this.y = t.y - e.y, this.z = t.z - e.z, this.w = t.w - e.w, this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.x *= t.x, this.y *= t.y, this.z *= t.z, this.w *= t.w, this;
      }
    }, {
      key: "multiplyScalar",
      value: function multiplyScalar(t) {
        return this.x *= t, this.y *= t, this.z *= t, this.w *= t, this;
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        var e = this.x,
          r = this.y,
          i = this.z,
          s = this.w,
          o = t.elements;
        return this.x = o[0] * e + o[4] * r + o[8] * i + o[12] * s, this.y = o[1] * e + o[5] * r + o[9] * i + o[13] * s, this.z = o[2] * e + o[6] * r + o[10] * i + o[14] * s, this.w = o[3] * e + o[7] * r + o[11] * i + o[15] * s, this;
      }
    }, {
      key: "divideScalar",
      value: function divideScalar(t) {
        return this.multiplyScalar(1 / t);
      }
    }, {
      key: "setAxisAngleFromQuaternion",
      value: function setAxisAngleFromQuaternion(t) {
        this.w = 2 * Math.acos(t.w);
        var e = Math.sqrt(1 - t.w * t.w);
        return e < 1e-4 ? (this.x = 1, this.y = 0, this.z = 0) : (this.x = t.x / e, this.y = t.y / e, this.z = t.z / e), this;
      }
    }, {
      key: "setAxisAngleFromRotationMatrix",
      value: function setAxisAngleFromRotationMatrix(t) {
        var e,
          r,
          i,
          s,
          l = t.elements,
          u = l[0],
          c = l[4],
          d = l[8],
          h = l[1],
          f = l[5],
          p = l[9],
          m = l[2],
          g = l[6],
          y = l[10];
        if (Math.abs(c - h) < .01 && Math.abs(d - m) < .01 && Math.abs(p - g) < .01) {
          if (Math.abs(c + h) < .1 && Math.abs(d + m) < .1 && Math.abs(p + g) < .1 && Math.abs(u + f + y - 3) < .1) return this.set(1, 0, 0, 0), this;
          e = Math.PI;
          var x = (u + 1) / 2,
            S = (f + 1) / 2,
            w = (y + 1) / 2,
            A = (c + h) / 4,
            E = (d + m) / 4,
            b = (p + g) / 4;
          return x > S && x > w ? x < .01 ? (r = 0, i = .707106781, s = .707106781) : (r = Math.sqrt(x), i = A / r, s = E / r) : S > w ? S < .01 ? (r = .707106781, i = 0, s = .707106781) : (i = Math.sqrt(S), r = A / i, s = b / i) : w < .01 ? (r = .707106781, i = .707106781, s = 0) : (s = Math.sqrt(w), r = E / s, i = b / s), this.set(r, i, s, e), this;
        }
        var v = Math.sqrt((g - p) * (g - p) + (d - m) * (d - m) + (h - c) * (h - c));
        return Math.abs(v) < .001 && (v = 1), this.x = (g - p) / v, this.y = (d - m) / v, this.z = (h - c) / v, this.w = Math.acos((u + f + y - 1) / 2), this;
      }
    }, {
      key: "min",
      value: function min(t) {
        return this.x = Math.min(this.x, t.x), this.y = Math.min(this.y, t.y), this.z = Math.min(this.z, t.z), this.w = Math.min(this.w, t.w), this;
      }
    }, {
      key: "max",
      value: function max(t) {
        return this.x = Math.max(this.x, t.x), this.y = Math.max(this.y, t.y), this.z = Math.max(this.z, t.z), this.w = Math.max(this.w, t.w), this;
      }
    }, {
      key: "clamp",
      value: function clamp(t, e) {
        return this.x = Math.max(t.x, Math.min(e.x, this.x)), this.y = Math.max(t.y, Math.min(e.y, this.y)), this.z = Math.max(t.z, Math.min(e.z, this.z)), this.w = Math.max(t.w, Math.min(e.w, this.w)), this;
      }
    }, {
      key: "clampScalar",
      value: function clampScalar(t, e) {
        return this.x = Math.max(t, Math.min(e, this.x)), this.y = Math.max(t, Math.min(e, this.y)), this.z = Math.max(t, Math.min(e, this.z)), this.w = Math.max(t, Math.min(e, this.w)), this;
      }
    }, {
      key: "clampLength",
      value: function clampLength(t, e) {
        var r = this.length();
        return this.divideScalar(r || 1).multiplyScalar(Math.max(t, Math.min(e, r)));
      }
    }, {
      key: "floor",
      value: function floor() {
        return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this.z = Math.floor(this.z), this.w = Math.floor(this.w), this;
      }
    }, {
      key: "ceil",
      value: function ceil() {
        return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this.z = Math.ceil(this.z), this.w = Math.ceil(this.w), this;
      }
    }, {
      key: "round",
      value: function round() {
        return this.x = Math.round(this.x), this.y = Math.round(this.y), this.z = Math.round(this.z), this.w = Math.round(this.w), this;
      }
    }, {
      key: "roundToZero",
      value: function roundToZero() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z), this.w = this.w < 0 ? Math.ceil(this.w) : Math.floor(this.w), this;
      }
    }, {
      key: "negate",
      value: function negate() {
        return this.x = -this.x, this.y = -this.y, this.z = -this.z, this.w = -this.w, this;
      }
    }, {
      key: "dot",
      value: function dot(t) {
        return this.x * t.x + this.y * t.y + this.z * t.z + this.w * t.w;
      }
    }, {
      key: "lengthSq",
      value: function lengthSq() {
        return this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w;
      }
    }, {
      key: "length",
      value: function length() {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
      }
    }, {
      key: "manhattanLength",
      value: function manhattanLength() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z) + Math.abs(this.w);
      }
    }, {
      key: "normalize",
      value: function normalize() {
        return this.divideScalar(this.length() || 1);
      }
    }, {
      key: "setLength",
      value: function setLength(t) {
        return this.normalize().multiplyScalar(t);
      }
    }, {
      key: "lerp",
      value: function lerp(t, e) {
        return this.x += (t.x - this.x) * e, this.y += (t.y - this.y) * e, this.z += (t.z - this.z) * e, this.w += (t.w - this.w) * e, this;
      }
    }, {
      key: "lerpVectors",
      value: function lerpVectors(t, e, r) {
        return this.x = t.x + (e.x - t.x) * r, this.y = t.y + (e.y - t.y) * r, this.z = t.z + (e.z - t.z) * r, this.w = t.w + (e.w - t.w) * r, this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.x === this.x && t.y === this.y && t.z === this.z && t.w === this.w;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this.x = t[e], this.y = t[e + 1], this.z = t[e + 2], this.w = t[e + 3], this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return t[e] = this.x, t[e + 1] = this.y, t[e + 2] = this.z, t[e + 3] = this.w, t;
      }
    }, {
      key: "fromBufferAttribute",
      value: function fromBufferAttribute(t, e) {
        return this.x = t.getX(e), this.y = t.getY(e), this.z = t.getZ(e), this.w = t.getW(e), this;
      }
    }, {
      key: "random",
      value: function random() {
        return this.x = Math.random(), this.y = Math.random(), this.z = Math.random(), this.w = Math.random(), this;
      }
    }, {
      key: _Symbol$iterator3,
      value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
        return _regeneratorRuntime().wrap(function value$(_context3) {
          while (1) switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return this.x;
            case 2:
              _context3.next = 4;
              return this.y;
            case 4:
              _context3.next = 6;
              return this.z;
            case 6:
              _context3.next = 8;
              return this.w;
            case 8:
            case "end":
              return _context3.stop();
          }
        }, value, this);
      })
    }]);
    return He;
  }(Symbol.iterator),
  at = /*#__PURE__*/function (_ir2) {
    _inherits(at, _ir2);
    var _super2 = _createSuper(at);
    function at() {
      var _this2;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      _classCallCheck(this, at);
      _this2 = _super2.call(this), _this2.isWebGLRenderTarget = !0, _this2.width = t, _this2.height = e, _this2.depth = 1, _this2.scissor = new He(0, 0, t, e), _this2.scissorTest = !1, _this2.viewport = new He(0, 0, t, e);
      var i = {
        width: t,
        height: e,
        depth: 1
      };
      _this2.texture = new qt(i, r.mapping, r.wrapS, r.wrapT, r.magFilter, r.minFilter, r.format, r.type, r.anisotropy, r.encoding), _this2.texture.isRenderTargetTexture = !0, _this2.texture.flipY = !1, _this2.texture.generateMipmaps = r.generateMipmaps !== void 0 ? r.generateMipmaps : !1, _this2.texture.internalFormat = r.internalFormat !== void 0 ? r.internalFormat : null, _this2.texture.minFilter = r.minFilter !== void 0 ? r.minFilter : Qe, _this2.depthBuffer = r.depthBuffer !== void 0 ? r.depthBuffer : !0, _this2.stencilBuffer = r.stencilBuffer !== void 0 ? r.stencilBuffer : !1, _this2.depthTexture = r.depthTexture !== void 0 ? r.depthTexture : null, _this2.samples = r.samples !== void 0 ? r.samples : 0;
      return _this2;
    }
    _createClass(at, [{
      key: "setSize",
      value: function setSize(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
        (this.width !== t || this.height !== e || this.depth !== r) && (this.width = t, this.height = e, this.depth = r, this.texture.image.width = t, this.texture.image.height = e, this.texture.image.depth = r, this.dispose()), this.viewport.set(0, 0, t, e), this.scissor.set(0, 0, t, e);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.width = t.width, this.height = t.height, this.depth = t.depth, this.viewport.copy(t.viewport), this.texture = t.texture.clone(), this.texture.isRenderTargetTexture = !0;
        var e = Object.assign({}, t.texture.image);
        return this.texture.source = new ry(e), this.depthBuffer = t.depthBuffer, this.stencilBuffer = t.stencilBuffer, t.depthTexture !== null && (this.depthTexture = t.depthTexture.clone()), this.samples = t.samples, this;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }]);
    return at;
  }(ir),
  iy = /*#__PURE__*/function (_qt) {
    _inherits(iy, _qt);
    var _super3 = _createSuper(iy);
    function iy() {
      var _this3;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, iy);
      _this3 = _super3.call(this, null), _this3.isDataArrayTexture = !0, _this3.image = {
        data: t,
        width: e,
        height: r,
        depth: i
      }, _this3.magFilter = Et, _this3.minFilter = Et, _this3.wrapR = Ut, _this3.generateMipmaps = !1, _this3.flipY = !1, _this3.unpackAlignment = 1;
      return _this3;
    }
    return _createClass(iy);
  }(qt);
var ny = /*#__PURE__*/function (_qt2) {
  _inherits(ny, _qt2);
  var _super4 = _createSuper(ny);
  function ny() {
    var _this4;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
    _classCallCheck(this, ny);
    _this4 = _super4.call(this, null), _this4.isData3DTexture = !0, _this4.image = {
      data: t,
      width: e,
      height: r,
      depth: i
    }, _this4.magFilter = Et, _this4.minFilter = Et, _this4.wrapR = Ut, _this4.generateMipmaps = !1, _this4.flipY = !1, _this4.unpackAlignment = 1;
    return _this4;
  }
  return _createClass(ny);
}(qt);
var sy = /*#__PURE__*/function (_at) {
    _inherits(sy, _at);
    var _super5 = _createSuper(sy);
    function sy() {
      var _this5;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
      _classCallCheck(this, sy);
      _this5 = _super5.call(this, t, e, i), _this5.isWebGLMultipleRenderTargets = !0;
      var s = _this5.texture;
      _this5.texture = [];
      for (var o = 0; o < r; o++) _this5.texture[o] = s.clone(), _this5.texture[o].isRenderTargetTexture = !0;
      return _this5;
    }
    _createClass(sy, [{
      key: "setSize",
      value: function setSize(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
        if (this.width !== t || this.height !== e || this.depth !== r) {
          this.width = t, this.height = e, this.depth = r;
          for (var i = 0, s = this.texture.length; i < s; i++) this.texture[i].image.width = t, this.texture[i].image.height = e, this.texture[i].image.depth = r;
          this.dispose();
        }
        return this.viewport.set(0, 0, t, e), this.scissor.set(0, 0, t, e), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.dispose(), this.width = t.width, this.height = t.height, this.depth = t.depth, this.viewport.set(0, 0, this.width, this.height), this.scissor.set(0, 0, this.width, this.height), this.depthBuffer = t.depthBuffer, this.stencilBuffer = t.stencilBuffer, t.depthTexture !== null && (this.depthTexture = t.depthTexture.clone()), this.texture.length = 0;
        for (var e = 0, r = t.texture.length; e < r; e++) this.texture[e] = t.texture[e].clone(), this.texture[e].isRenderTargetTexture = !0;
        return this;
      }
    }]);
    return sy;
  }(at),
  je = /*#__PURE__*/function (_Symbol$iterator4) {
    function je() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, je);
      this.isQuaternion = !0, this._x = t, this._y = e, this._z = r, this._w = i;
    }
    _createClass(je, [{
      key: "x",
      get: function get() {
        return this._x;
      },
      set: function set(t) {
        this._x = t, this._onChangeCallback();
      }
    }, {
      key: "y",
      get: function get() {
        return this._y;
      },
      set: function set(t) {
        this._y = t, this._onChangeCallback();
      }
    }, {
      key: "z",
      get: function get() {
        return this._z;
      },
      set: function set(t) {
        this._z = t, this._onChangeCallback();
      }
    }, {
      key: "w",
      get: function get() {
        return this._w;
      },
      set: function set(t) {
        this._w = t, this._onChangeCallback();
      }
    }, {
      key: "set",
      value: function set(t, e, r, i) {
        return this._x = t, this._y = e, this._z = r, this._w = i, this._onChangeCallback(), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this._x, this._y, this._z, this._w);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this._x = t.x, this._y = t.y, this._z = t.z, this._w = t.w, this._onChangeCallback(), this;
      }
    }, {
      key: "setFromEuler",
      value: function setFromEuler(t, e) {
        var r = t._x,
          i = t._y,
          s = t._z,
          o = t._order,
          a = Math.cos,
          l = Math.sin,
          u = a(r / 2),
          c = a(i / 2),
          d = a(s / 2),
          h = l(r / 2),
          f = l(i / 2),
          p = l(s / 2);
        switch (o) {
          case "XYZ":
            this._x = h * c * d + u * f * p, this._y = u * f * d - h * c * p, this._z = u * c * p + h * f * d, this._w = u * c * d - h * f * p;
            break;
          case "YXZ":
            this._x = h * c * d + u * f * p, this._y = u * f * d - h * c * p, this._z = u * c * p - h * f * d, this._w = u * c * d + h * f * p;
            break;
          case "ZXY":
            this._x = h * c * d - u * f * p, this._y = u * f * d + h * c * p, this._z = u * c * p + h * f * d, this._w = u * c * d - h * f * p;
            break;
          case "ZYX":
            this._x = h * c * d - u * f * p, this._y = u * f * d + h * c * p, this._z = u * c * p - h * f * d, this._w = u * c * d + h * f * p;
            break;
          case "YZX":
            this._x = h * c * d + u * f * p, this._y = u * f * d + h * c * p, this._z = u * c * p - h * f * d, this._w = u * c * d - h * f * p;
            break;
          case "XZY":
            this._x = h * c * d - u * f * p, this._y = u * f * d - h * c * p, this._z = u * c * p + h * f * d, this._w = u * c * d + h * f * p;
            break;
          default:
            console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: " + o);
        }
        return e !== !1 && this._onChangeCallback(), this;
      }
    }, {
      key: "setFromAxisAngle",
      value: function setFromAxisAngle(t, e) {
        var r = e / 2,
          i = Math.sin(r);
        return this._x = t.x * i, this._y = t.y * i, this._z = t.z * i, this._w = Math.cos(r), this._onChangeCallback(), this;
      }
    }, {
      key: "setFromRotationMatrix",
      value: function setFromRotationMatrix(t) {
        var e = t.elements,
          r = e[0],
          i = e[4],
          s = e[8],
          o = e[1],
          a = e[5],
          l = e[9],
          u = e[2],
          c = e[6],
          d = e[10],
          h = r + a + d;
        if (h > 0) {
          var f = .5 / Math.sqrt(h + 1);
          this._w = .25 / f, this._x = (c - l) * f, this._y = (s - u) * f, this._z = (o - i) * f;
        } else if (r > a && r > d) {
          var _f2 = 2 * Math.sqrt(1 + r - a - d);
          this._w = (c - l) / _f2, this._x = .25 * _f2, this._y = (i + o) / _f2, this._z = (s + u) / _f2;
        } else if (a > d) {
          var _f3 = 2 * Math.sqrt(1 + a - r - d);
          this._w = (s - u) / _f3, this._x = (i + o) / _f3, this._y = .25 * _f3, this._z = (l + c) / _f3;
        } else {
          var _f4 = 2 * Math.sqrt(1 + d - r - a);
          this._w = (o - i) / _f4, this._x = (s + u) / _f4, this._y = (l + c) / _f4, this._z = .25 * _f4;
        }
        return this._onChangeCallback(), this;
      }
    }, {
      key: "setFromUnitVectors",
      value: function setFromUnitVectors(t, e) {
        var r = t.dot(e) + 1;
        return r < Number.EPSILON ? (r = 0, Math.abs(t.x) > Math.abs(t.z) ? (this._x = -t.y, this._y = t.x, this._z = 0, this._w = r) : (this._x = 0, this._y = -t.z, this._z = t.y, this._w = r)) : (this._x = t.y * e.z - t.z * e.y, this._y = t.z * e.x - t.x * e.z, this._z = t.x * e.y - t.y * e.x, this._w = r), this.normalize();
      }
    }, {
      key: "angleTo",
      value: function angleTo(t) {
        return 2 * Math.acos(Math.abs(oi(this.dot(t), -1, 1)));
      }
    }, {
      key: "rotateTowards",
      value: function rotateTowards(t, e) {
        var r = this.angleTo(t);
        if (r === 0) return this;
        var i = Math.min(1, e / r);
        return this.slerp(t, i), this;
      }
    }, {
      key: "identity",
      value: function identity() {
        return this.set(0, 0, 0, 1);
      }
    }, {
      key: "invert",
      value: function invert() {
        return this.conjugate();
      }
    }, {
      key: "conjugate",
      value: function conjugate() {
        return this._x *= -1, this._y *= -1, this._z *= -1, this._onChangeCallback(), this;
      }
    }, {
      key: "dot",
      value: function dot(t) {
        return this._x * t._x + this._y * t._y + this._z * t._z + this._w * t._w;
      }
    }, {
      key: "lengthSq",
      value: function lengthSq() {
        return this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w;
      }
    }, {
      key: "length",
      value: function length() {
        return Math.sqrt(this._x * this._x + this._y * this._y + this._z * this._z + this._w * this._w);
      }
    }, {
      key: "normalize",
      value: function normalize() {
        var t = this.length();
        return t === 0 ? (this._x = 0, this._y = 0, this._z = 0, this._w = 1) : (t = 1 / t, this._x = this._x * t, this._y = this._y * t, this._z = this._z * t, this._w = this._w * t), this._onChangeCallback(), this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.multiplyQuaternions(this, t);
      }
    }, {
      key: "premultiply",
      value: function premultiply(t) {
        return this.multiplyQuaternions(t, this);
      }
    }, {
      key: "multiplyQuaternions",
      value: function multiplyQuaternions(t, e) {
        var r = t._x,
          i = t._y,
          s = t._z,
          o = t._w,
          a = e._x,
          l = e._y,
          u = e._z,
          c = e._w;
        return this._x = r * c + o * a + i * u - s * l, this._y = i * c + o * l + s * a - r * u, this._z = s * c + o * u + r * l - i * a, this._w = o * c - r * a - i * l - s * u, this._onChangeCallback(), this;
      }
    }, {
      key: "slerp",
      value: function slerp(t, e) {
        if (e === 0) return this;
        if (e === 1) return this.copy(t);
        var r = this._x,
          i = this._y,
          s = this._z,
          o = this._w,
          a = o * t._w + r * t._x + i * t._y + s * t._z;
        if (a < 0 ? (this._w = -t._w, this._x = -t._x, this._y = -t._y, this._z = -t._z, a = -a) : this.copy(t), a >= 1) return this._w = o, this._x = r, this._y = i, this._z = s, this;
        var l = 1 - a * a;
        if (l <= Number.EPSILON) {
          var f = 1 - e;
          return this._w = f * o + e * this._w, this._x = f * r + e * this._x, this._y = f * i + e * this._y, this._z = f * s + e * this._z, this.normalize(), this._onChangeCallback(), this;
        }
        var u = Math.sqrt(l),
          c = Math.atan2(u, a),
          d = Math.sin((1 - e) * c) / u,
          h = Math.sin(e * c) / u;
        return this._w = o * d + this._w * h, this._x = r * d + this._x * h, this._y = i * d + this._y * h, this._z = s * d + this._z * h, this._onChangeCallback(), this;
      }
    }, {
      key: "slerpQuaternions",
      value: function slerpQuaternions(t, e, r) {
        return this.copy(t).slerp(e, r);
      }
    }, {
      key: "random",
      value: function random() {
        var t = Math.random(),
          e = Math.sqrt(1 - t),
          r = Math.sqrt(t),
          i = 2 * Math.PI * Math.random(),
          s = 2 * Math.PI * Math.random();
        return this.set(e * Math.cos(i), r * Math.sin(s), r * Math.cos(s), e * Math.sin(i));
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t._x === this._x && t._y === this._y && t._z === this._z && t._w === this._w;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this._x = t[e], this._y = t[e + 1], this._z = t[e + 2], this._w = t[e + 3], this._onChangeCallback(), this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return t[e] = this._x, t[e + 1] = this._y, t[e + 2] = this._z, t[e + 3] = this._w, t;
      }
    }, {
      key: "fromBufferAttribute",
      value: function fromBufferAttribute(t, e) {
        return this._x = t.getX(e), this._y = t.getY(e), this._z = t.getZ(e), this._w = t.getW(e), this;
      }
    }, {
      key: "_onChange",
      value: function _onChange(t) {
        return this._onChangeCallback = t, this;
      }
    }, {
      key: "_onChangeCallback",
      value: function _onChangeCallback() {}
    }, {
      key: _Symbol$iterator4,
      value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
        return _regeneratorRuntime().wrap(function value$(_context4) {
          while (1) switch (_context4.prev = _context4.next) {
            case 0:
              _context4.next = 2;
              return this._x;
            case 2:
              _context4.next = 4;
              return this._y;
            case 4:
              _context4.next = 6;
              return this._z;
            case 6:
              _context4.next = 8;
              return this._w;
            case 8:
            case "end":
              return _context4.stop();
          }
        }, value, this);
      })
    }], [{
      key: "slerpFlat",
      value: function slerpFlat(t, e, r, i, s, o, a) {
        var l = r[i + 0],
          u = r[i + 1],
          c = r[i + 2],
          d = r[i + 3],
          h = s[o + 0],
          f = s[o + 1],
          p = s[o + 2],
          m = s[o + 3];
        if (a === 0) {
          t[e + 0] = l, t[e + 1] = u, t[e + 2] = c, t[e + 3] = d;
          return;
        }
        if (a === 1) {
          t[e + 0] = h, t[e + 1] = f, t[e + 2] = p, t[e + 3] = m;
          return;
        }
        if (d !== m || l !== h || u !== f || c !== p) {
          var g = 1 - a,
            y = l * h + u * f + c * p + d * m,
            v = y >= 0 ? 1 : -1,
            x = 1 - y * y;
          if (x > Number.EPSILON) {
            var w = Math.sqrt(x),
              A = Math.atan2(w, y * v);
            g = Math.sin(g * A) / w, a = Math.sin(a * A) / w;
          }
          var S = a * v;
          if (l = l * g + h * S, u = u * g + f * S, c = c * g + p * S, d = d * g + m * S, g === 1 - a) {
            var _w2 = 1 / Math.sqrt(l * l + u * u + c * c + d * d);
            l *= _w2, u *= _w2, c *= _w2, d *= _w2;
          }
        }
        t[e] = l, t[e + 1] = u, t[e + 2] = c, t[e + 3] = d;
      }
    }, {
      key: "multiplyQuaternionsFlat",
      value: function multiplyQuaternionsFlat(t, e, r, i, s, o) {
        var a = r[i],
          l = r[i + 1],
          u = r[i + 2],
          c = r[i + 3],
          d = s[o],
          h = s[o + 1],
          f = s[o + 2],
          p = s[o + 3];
        return t[e] = a * p + c * d + l * f - u * h, t[e + 1] = l * p + c * h + u * d - a * f, t[e + 2] = u * p + c * f + a * h - l * d, t[e + 3] = c * p - a * d - l * h - u * f, t;
      }
    }]);
    return je;
  }(Symbol.iterator),
  _ = /*#__PURE__*/function (_Symbol$iterator5) {
    function _() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      _classCallCheck(this, _);
      _.prototype.isVector3 = !0, this.x = t, this.y = e, this.z = r;
    }
    _createClass(_, [{
      key: "set",
      value: function set(t, e, r) {
        return r === void 0 && (r = this.z), this.x = t, this.y = e, this.z = r, this;
      }
    }, {
      key: "setScalar",
      value: function setScalar(t) {
        return this.x = t, this.y = t, this.z = t, this;
      }
    }, {
      key: "setX",
      value: function setX(t) {
        return this.x = t, this;
      }
    }, {
      key: "setY",
      value: function setY(t) {
        return this.y = t, this;
      }
    }, {
      key: "setZ",
      value: function setZ(t) {
        return this.z = t, this;
      }
    }, {
      key: "setComponent",
      value: function setComponent(t, e) {
        switch (t) {
          case 0:
            this.x = e;
            break;
          case 1:
            this.y = e;
            break;
          case 2:
            this.z = e;
            break;
          default:
            throw new Error("index is out of range: " + t);
        }
        return this;
      }
    }, {
      key: "getComponent",
      value: function getComponent(t) {
        switch (t) {
          case 0:
            return this.x;
          case 1:
            return this.y;
          case 2:
            return this.z;
          default:
            throw new Error("index is out of range: " + t);
        }
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this.x, this.y, this.z);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.x = t.x, this.y = t.y, this.z = t.z, this;
      }
    }, {
      key: "add",
      value: function add(t) {
        return this.x += t.x, this.y += t.y, this.z += t.z, this;
      }
    }, {
      key: "addScalar",
      value: function addScalar(t) {
        return this.x += t, this.y += t, this.z += t, this;
      }
    }, {
      key: "addVectors",
      value: function addVectors(t, e) {
        return this.x = t.x + e.x, this.y = t.y + e.y, this.z = t.z + e.z, this;
      }
    }, {
      key: "addScaledVector",
      value: function addScaledVector(t, e) {
        return this.x += t.x * e, this.y += t.y * e, this.z += t.z * e, this;
      }
    }, {
      key: "sub",
      value: function sub(t) {
        return this.x -= t.x, this.y -= t.y, this.z -= t.z, this;
      }
    }, {
      key: "subScalar",
      value: function subScalar(t) {
        return this.x -= t, this.y -= t, this.z -= t, this;
      }
    }, {
      key: "subVectors",
      value: function subVectors(t, e) {
        return this.x = t.x - e.x, this.y = t.y - e.y, this.z = t.z - e.z, this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.x *= t.x, this.y *= t.y, this.z *= t.z, this;
      }
    }, {
      key: "multiplyScalar",
      value: function multiplyScalar(t) {
        return this.x *= t, this.y *= t, this.z *= t, this;
      }
    }, {
      key: "multiplyVectors",
      value: function multiplyVectors(t, e) {
        return this.x = t.x * e.x, this.y = t.y * e.y, this.z = t.z * e.z, this;
      }
    }, {
      key: "applyEuler",
      value: function applyEuler(t) {
        return this.applyQuaternion(wT.setFromEuler(t));
      }
    }, {
      key: "applyAxisAngle",
      value: function applyAxisAngle(t, e) {
        return this.applyQuaternion(wT.setFromAxisAngle(t, e));
      }
    }, {
      key: "applyMatrix3",
      value: function applyMatrix3(t) {
        var e = this.x,
          r = this.y,
          i = this.z,
          s = t.elements;
        return this.x = s[0] * e + s[3] * r + s[6] * i, this.y = s[1] * e + s[4] * r + s[7] * i, this.z = s[2] * e + s[5] * r + s[8] * i, this;
      }
    }, {
      key: "applyNormalMatrix",
      value: function applyNormalMatrix(t) {
        return this.applyMatrix3(t).normalize();
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        var e = this.x,
          r = this.y,
          i = this.z,
          s = t.elements,
          o = 1 / (s[3] * e + s[7] * r + s[11] * i + s[15]);
        return this.x = (s[0] * e + s[4] * r + s[8] * i + s[12]) * o, this.y = (s[1] * e + s[5] * r + s[9] * i + s[13]) * o, this.z = (s[2] * e + s[6] * r + s[10] * i + s[14]) * o, this;
      }
    }, {
      key: "applyQuaternion",
      value: function applyQuaternion(t) {
        var e = this.x,
          r = this.y,
          i = this.z,
          s = t.x,
          o = t.y,
          a = t.z,
          l = t.w,
          u = l * e + o * i - a * r,
          c = l * r + a * e - s * i,
          d = l * i + s * r - o * e,
          h = -s * e - o * r - a * i;
        return this.x = u * l + h * -s + c * -a - d * -o, this.y = c * l + h * -o + d * -s - u * -a, this.z = d * l + h * -a + u * -o - c * -s, this;
      }
    }, {
      key: "project",
      value: function project(t) {
        return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix);
      }
    }, {
      key: "unproject",
      value: function unproject(t) {
        return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld);
      }
    }, {
      key: "transformDirection",
      value: function transformDirection(t) {
        var e = this.x,
          r = this.y,
          i = this.z,
          s = t.elements;
        return this.x = s[0] * e + s[4] * r + s[8] * i, this.y = s[1] * e + s[5] * r + s[9] * i, this.z = s[2] * e + s[6] * r + s[10] * i, this.normalize();
      }
    }, {
      key: "divide",
      value: function divide(t) {
        return this.x /= t.x, this.y /= t.y, this.z /= t.z, this;
      }
    }, {
      key: "divideScalar",
      value: function divideScalar(t) {
        return this.multiplyScalar(1 / t);
      }
    }, {
      key: "min",
      value: function min(t) {
        return this.x = Math.min(this.x, t.x), this.y = Math.min(this.y, t.y), this.z = Math.min(this.z, t.z), this;
      }
    }, {
      key: "max",
      value: function max(t) {
        return this.x = Math.max(this.x, t.x), this.y = Math.max(this.y, t.y), this.z = Math.max(this.z, t.z), this;
      }
    }, {
      key: "clamp",
      value: function clamp(t, e) {
        return this.x = Math.max(t.x, Math.min(e.x, this.x)), this.y = Math.max(t.y, Math.min(e.y, this.y)), this.z = Math.max(t.z, Math.min(e.z, this.z)), this;
      }
    }, {
      key: "clampScalar",
      value: function clampScalar(t, e) {
        return this.x = Math.max(t, Math.min(e, this.x)), this.y = Math.max(t, Math.min(e, this.y)), this.z = Math.max(t, Math.min(e, this.z)), this;
      }
    }, {
      key: "clampLength",
      value: function clampLength(t, e) {
        var r = this.length();
        return this.divideScalar(r || 1).multiplyScalar(Math.max(t, Math.min(e, r)));
      }
    }, {
      key: "floor",
      value: function floor() {
        return this.x = Math.floor(this.x), this.y = Math.floor(this.y), this.z = Math.floor(this.z), this;
      }
    }, {
      key: "ceil",
      value: function ceil() {
        return this.x = Math.ceil(this.x), this.y = Math.ceil(this.y), this.z = Math.ceil(this.z), this;
      }
    }, {
      key: "round",
      value: function round() {
        return this.x = Math.round(this.x), this.y = Math.round(this.y), this.z = Math.round(this.z), this;
      }
    }, {
      key: "roundToZero",
      value: function roundToZero() {
        return this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x), this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y), this.z = this.z < 0 ? Math.ceil(this.z) : Math.floor(this.z), this;
      }
    }, {
      key: "negate",
      value: function negate() {
        return this.x = -this.x, this.y = -this.y, this.z = -this.z, this;
      }
    }, {
      key: "dot",
      value: function dot(t) {
        return this.x * t.x + this.y * t.y + this.z * t.z;
      }
    }, {
      key: "lengthSq",
      value: function lengthSq() {
        return this.x * this.x + this.y * this.y + this.z * this.z;
      }
    }, {
      key: "length",
      value: function length() {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
      }
    }, {
      key: "manhattanLength",
      value: function manhattanLength() {
        return Math.abs(this.x) + Math.abs(this.y) + Math.abs(this.z);
      }
    }, {
      key: "normalize",
      value: function normalize() {
        return this.divideScalar(this.length() || 1);
      }
    }, {
      key: "setLength",
      value: function setLength(t) {
        return this.normalize().multiplyScalar(t);
      }
    }, {
      key: "lerp",
      value: function lerp(t, e) {
        return this.x += (t.x - this.x) * e, this.y += (t.y - this.y) * e, this.z += (t.z - this.z) * e, this;
      }
    }, {
      key: "lerpVectors",
      value: function lerpVectors(t, e, r) {
        return this.x = t.x + (e.x - t.x) * r, this.y = t.y + (e.y - t.y) * r, this.z = t.z + (e.z - t.z) * r, this;
      }
    }, {
      key: "cross",
      value: function cross(t) {
        return this.crossVectors(this, t);
      }
    }, {
      key: "crossVectors",
      value: function crossVectors(t, e) {
        var r = t.x,
          i = t.y,
          s = t.z,
          o = e.x,
          a = e.y,
          l = e.z;
        return this.x = i * l - s * a, this.y = s * o - r * l, this.z = r * a - i * o, this;
      }
    }, {
      key: "projectOnVector",
      value: function projectOnVector(t) {
        var e = t.lengthSq();
        if (e === 0) return this.set(0, 0, 0);
        var r = t.dot(this) / e;
        return this.copy(t).multiplyScalar(r);
      }
    }, {
      key: "projectOnPlane",
      value: function projectOnPlane(t) {
        return Zb.copy(this).projectOnVector(t), this.sub(Zb);
      }
    }, {
      key: "reflect",
      value: function reflect(t) {
        return this.sub(Zb.copy(t).multiplyScalar(2 * this.dot(t)));
      }
    }, {
      key: "angleTo",
      value: function angleTo(t) {
        var e = Math.sqrt(this.lengthSq() * t.lengthSq());
        if (e === 0) return Math.PI / 2;
        var r = this.dot(t) / e;
        return Math.acos(oi(r, -1, 1));
      }
    }, {
      key: "distanceTo",
      value: function distanceTo(t) {
        return Math.sqrt(this.distanceToSquared(t));
      }
    }, {
      key: "distanceToSquared",
      value: function distanceToSquared(t) {
        var e = this.x - t.x,
          r = this.y - t.y,
          i = this.z - t.z;
        return e * e + r * r + i * i;
      }
    }, {
      key: "manhattanDistanceTo",
      value: function manhattanDistanceTo(t) {
        return Math.abs(this.x - t.x) + Math.abs(this.y - t.y) + Math.abs(this.z - t.z);
      }
    }, {
      key: "setFromSpherical",
      value: function setFromSpherical(t) {
        return this.setFromSphericalCoords(t.radius, t.phi, t.theta);
      }
    }, {
      key: "setFromSphericalCoords",
      value: function setFromSphericalCoords(t, e, r) {
        var i = Math.sin(e) * t;
        return this.x = i * Math.sin(r), this.y = Math.cos(e) * t, this.z = i * Math.cos(r), this;
      }
    }, {
      key: "setFromCylindrical",
      value: function setFromCylindrical(t) {
        return this.setFromCylindricalCoords(t.radius, t.theta, t.y);
      }
    }, {
      key: "setFromCylindricalCoords",
      value: function setFromCylindricalCoords(t, e, r) {
        return this.x = t * Math.sin(e), this.y = r, this.z = t * Math.cos(e), this;
      }
    }, {
      key: "setFromMatrixPosition",
      value: function setFromMatrixPosition(t) {
        var e = t.elements;
        return this.x = e[12], this.y = e[13], this.z = e[14], this;
      }
    }, {
      key: "setFromMatrixScale",
      value: function setFromMatrixScale(t) {
        var e = this.setFromMatrixColumn(t, 0).length(),
          r = this.setFromMatrixColumn(t, 1).length(),
          i = this.setFromMatrixColumn(t, 2).length();
        return this.x = e, this.y = r, this.z = i, this;
      }
    }, {
      key: "setFromMatrixColumn",
      value: function setFromMatrixColumn(t, e) {
        return this.fromArray(t.elements, e * 4);
      }
    }, {
      key: "setFromMatrix3Column",
      value: function setFromMatrix3Column(t, e) {
        return this.fromArray(t.elements, e * 3);
      }
    }, {
      key: "setFromEuler",
      value: function setFromEuler(t) {
        return this.x = t._x, this.y = t._y, this.z = t._z, this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.x === this.x && t.y === this.y && t.z === this.z;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this.x = t[e], this.y = t[e + 1], this.z = t[e + 2], this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return t[e] = this.x, t[e + 1] = this.y, t[e + 2] = this.z, t;
      }
    }, {
      key: "fromBufferAttribute",
      value: function fromBufferAttribute(t, e) {
        return this.x = t.getX(e), this.y = t.getY(e), this.z = t.getZ(e), this;
      }
    }, {
      key: "random",
      value: function random() {
        return this.x = Math.random(), this.y = Math.random(), this.z = Math.random(), this;
      }
    }, {
      key: "randomDirection",
      value: function randomDirection() {
        var t = (Math.random() - .5) * 2,
          e = Math.random() * Math.PI * 2,
          r = Math.sqrt(1 - Math.pow(t, 2));
        return this.x = r * Math.cos(e), this.y = r * Math.sin(e), this.z = t, this;
      }
    }, {
      key: _Symbol$iterator5,
      value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
        return _regeneratorRuntime().wrap(function value$(_context5) {
          while (1) switch (_context5.prev = _context5.next) {
            case 0:
              _context5.next = 2;
              return this.x;
            case 2:
              _context5.next = 4;
              return this.y;
            case 4:
              _context5.next = 6;
              return this.z;
            case 6:
            case "end":
              return _context5.stop();
          }
        }, value, this);
      })
    }]);
    return _;
  }(Symbol.iterator),
  Zb = new _(),
  wT = new je(),
  Bt = /*#__PURE__*/function () {
    function Bt() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _(1 / 0, 1 / 0, 1 / 0);
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _(-1 / 0, -1 / 0, -1 / 0);
      _classCallCheck(this, Bt);
      this.isBox3 = !0, this.min = t, this.max = e;
    }
    _createClass(Bt, [{
      key: "set",
      value: function set(t, e) {
        return this.min.copy(t), this.max.copy(e), this;
      }
    }, {
      key: "setFromArray",
      value: function setFromArray(t) {
        var e = 1 / 0,
          r = 1 / 0,
          i = 1 / 0,
          s = -1 / 0,
          o = -1 / 0,
          a = -1 / 0;
        for (var l = 0, u = t.length; l < u; l += 3) {
          var c = t[l],
            d = t[l + 1],
            h = t[l + 2];
          c < e && (e = c), d < r && (r = d), h < i && (i = h), c > s && (s = c), d > o && (o = d), h > a && (a = h);
        }
        return this.min.set(e, r, i), this.max.set(s, o, a), this;
      }
    }, {
      key: "setFromBufferAttribute",
      value: function setFromBufferAttribute(t) {
        var e = 1 / 0,
          r = 1 / 0,
          i = 1 / 0,
          s = -1 / 0,
          o = -1 / 0,
          a = -1 / 0;
        for (var l = 0, u = t.count; l < u; l++) {
          var c = t.getX(l),
            d = t.getY(l),
            h = t.getZ(l);
          c < e && (e = c), d < r && (r = d), h < i && (i = h), c > s && (s = c), d > o && (o = d), h > a && (a = h);
        }
        return this.min.set(e, r, i), this.max.set(s, o, a), this;
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t) {
        this.makeEmpty();
        for (var e = 0, r = t.length; e < r; e++) this.expandByPoint(t[e]);
        return this;
      }
    }, {
      key: "setFromCenterAndSize",
      value: function setFromCenterAndSize(t, e) {
        var r = nc.copy(e).multiplyScalar(.5);
        return this.min.copy(t).sub(r), this.max.copy(t).add(r), this;
      }
    }, {
      key: "setFromObject",
      value: function setFromObject(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        return this.makeEmpty(), this.expandByObject(t, e);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.min.copy(t.min), this.max.copy(t.max), this;
      }
    }, {
      key: "makeEmpty",
      value: function makeEmpty() {
        return this.min.x = this.min.y = this.min.z = 1 / 0, this.max.x = this.max.y = this.max.z = -1 / 0, this;
      }
    }, {
      key: "isEmpty",
      value: function isEmpty() {
        return this.max.x < this.min.x || this.max.y < this.min.y || this.max.z < this.min.z;
      }
    }, {
      key: "getCenter",
      value: function getCenter(t) {
        return this.isEmpty() ? t.set(0, 0, 0) : t.addVectors(this.min, this.max).multiplyScalar(.5);
      }
    }, {
      key: "getSize",
      value: function getSize(t) {
        return this.isEmpty() ? t.set(0, 0, 0) : t.subVectors(this.max, this.min);
      }
    }, {
      key: "expandByPoint",
      value: function expandByPoint(t) {
        return this.min.min(t), this.max.max(t), this;
      }
    }, {
      key: "expandByVector",
      value: function expandByVector(t) {
        return this.min.sub(t), this.max.add(t), this;
      }
    }, {
      key: "expandByScalar",
      value: function expandByScalar(t) {
        return this.min.addScalar(-t), this.max.addScalar(t), this;
      }
    }, {
      key: "expandByObject",
      value: function expandByObject(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        t.updateWorldMatrix(!1, !1);
        var r = t.geometry;
        if (r !== void 0) if (e && r.attributes != null && r.attributes.position !== void 0) {
          var s = r.attributes.position;
          for (var o = 0, a = s.count; o < a; o++) nc.fromBufferAttribute(s, o).applyMatrix4(t.matrixWorld), this.expandByPoint(nc);
        } else r.boundingBox === null && r.computeBoundingBox(), Jb.copy(r.boundingBox), Jb.applyMatrix4(t.matrixWorld), this.union(Jb);
        var i = t.children;
        for (var _s3 = 0, _o3 = i.length; _s3 < _o3; _s3++) this.expandByObject(i[_s3], e);
        return this;
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        return !(t.x < this.min.x || t.x > this.max.x || t.y < this.min.y || t.y > this.max.y || t.z < this.min.z || t.z > this.max.z);
      }
    }, {
      key: "containsBox",
      value: function containsBox(t) {
        return this.min.x <= t.min.x && t.max.x <= this.max.x && this.min.y <= t.min.y && t.max.y <= this.max.y && this.min.z <= t.min.z && t.max.z <= this.max.z;
      }
    }, {
      key: "getParameter",
      value: function getParameter(t, e) {
        return e.set((t.x - this.min.x) / (this.max.x - this.min.x), (t.y - this.min.y) / (this.max.y - this.min.y), (t.z - this.min.z) / (this.max.z - this.min.z));
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return !(t.max.x < this.min.x || t.min.x > this.max.x || t.max.y < this.min.y || t.min.y > this.max.y || t.max.z < this.min.z || t.min.z > this.max.z);
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        return this.clampPoint(t.center, nc), nc.distanceToSquared(t.center) <= t.radius * t.radius;
      }
    }, {
      key: "intersectsPlane",
      value: function intersectsPlane(t) {
        var e, r;
        return t.normal.x > 0 ? (e = t.normal.x * this.min.x, r = t.normal.x * this.max.x) : (e = t.normal.x * this.max.x, r = t.normal.x * this.min.x), t.normal.y > 0 ? (e += t.normal.y * this.min.y, r += t.normal.y * this.max.y) : (e += t.normal.y * this.max.y, r += t.normal.y * this.min.y), t.normal.z > 0 ? (e += t.normal.z * this.min.z, r += t.normal.z * this.max.z) : (e += t.normal.z * this.max.z, r += t.normal.z * this.min.z), e <= -t.constant && r >= -t.constant;
      }
    }, {
      key: "intersectsTriangle",
      value: function intersectsTriangle(t) {
        if (this.isEmpty()) return !1;
        this.getCenter(Wf), Eg.subVectors(this.max, Wf), uu.subVectors(t.a, Wf), du.subVectors(t.b, Wf), hu.subVectors(t.c, Wf), Ua.subVectors(du, uu), Ga.subVectors(hu, du), sc.subVectors(uu, hu);
        var e = [0, -Ua.z, Ua.y, 0, -Ga.z, Ga.y, 0, -sc.z, sc.y, Ua.z, 0, -Ua.x, Ga.z, 0, -Ga.x, sc.z, 0, -sc.x, -Ua.y, Ua.x, 0, -Ga.y, Ga.x, 0, -sc.y, sc.x, 0];
        return !$b(e, uu, du, hu, Eg) || (e = [1, 0, 0, 0, 1, 0, 0, 0, 1], !$b(e, uu, du, hu, Eg)) ? !1 : (Tg.crossVectors(Ua, Ga), e = [Tg.x, Tg.y, Tg.z], $b(e, uu, du, hu, Eg));
      }
    }, {
      key: "clampPoint",
      value: function clampPoint(t, e) {
        return e.copy(t).clamp(this.min, this.max);
      }
    }, {
      key: "distanceToPoint",
      value: function distanceToPoint(t) {
        return nc.copy(t).clamp(this.min, this.max).sub(t).length();
      }
    }, {
      key: "getBoundingSphere",
      value: function getBoundingSphere(t) {
        return this.getCenter(t.center), t.radius = this.getSize(nc).length() * .5, t;
      }
    }, {
      key: "intersect",
      value: function intersect(t) {
        return this.min.max(t.min), this.max.min(t.max), this.isEmpty() && this.makeEmpty(), this;
      }
    }, {
      key: "union",
      value: function union(t) {
        return this.min.min(t.min), this.max.max(t.max), this;
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        return this.isEmpty() ? this : (Zo[0].set(this.min.x, this.min.y, this.min.z).applyMatrix4(t), Zo[1].set(this.min.x, this.min.y, this.max.z).applyMatrix4(t), Zo[2].set(this.min.x, this.max.y, this.min.z).applyMatrix4(t), Zo[3].set(this.min.x, this.max.y, this.max.z).applyMatrix4(t), Zo[4].set(this.max.x, this.min.y, this.min.z).applyMatrix4(t), Zo[5].set(this.max.x, this.min.y, this.max.z).applyMatrix4(t), Zo[6].set(this.max.x, this.max.y, this.min.z).applyMatrix4(t), Zo[7].set(this.max.x, this.max.y, this.max.z).applyMatrix4(t), this.setFromPoints(Zo), this);
      }
    }, {
      key: "translate",
      value: function translate(t) {
        return this.min.add(t), this.max.add(t), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.min.equals(this.min) && t.max.equals(this.max);
      }
    }]);
    return Bt;
  }(),
  Zo = [new _(), new _(), new _(), new _(), new _(), new _(), new _(), new _()],
  nc = new _(),
  Jb = new Bt(),
  uu = new _(),
  du = new _(),
  hu = new _(),
  Ua = new _(),
  Ga = new _(),
  sc = new _(),
  Wf = new _(),
  Eg = new _(),
  Tg = new _(),
  oc = new _();
function $b(n, t, e, r, i) {
  for (var s = 0, o = n.length - 3; s <= o; s += 3) {
    oc.fromArray(n, s);
    var a = i.x * Math.abs(oc.x) + i.y * Math.abs(oc.y) + i.z * Math.abs(oc.z),
      l = t.dot(oc),
      u = e.dot(oc),
      c = r.dot(oc);
    if (Math.max(-Math.max(l, u, c), Math.min(l, u, c)) > a) return !1;
  }
  return !0;
}
var YF = new Bt(),
  qf = new _(),
  eS = new _(),
  Er = /*#__PURE__*/function () {
    function Er() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;
      _classCallCheck(this, Er);
      this.center = t, this.radius = e;
    }
    _createClass(Er, [{
      key: "set",
      value: function set(t, e) {
        return this.center.copy(t), this.radius = e, this;
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t, e) {
        var r = this.center;
        e !== void 0 ? r.copy(e) : YF.setFromPoints(t).getCenter(r);
        var i = 0;
        for (var s = 0, o = t.length; s < o; s++) i = Math.max(i, r.distanceToSquared(t[s]));
        return this.radius = Math.sqrt(i), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.center.copy(t.center), this.radius = t.radius, this;
      }
    }, {
      key: "isEmpty",
      value: function isEmpty() {
        return this.radius < 0;
      }
    }, {
      key: "makeEmpty",
      value: function makeEmpty() {
        return this.center.set(0, 0, 0), this.radius = -1, this;
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        return t.distanceToSquared(this.center) <= this.radius * this.radius;
      }
    }, {
      key: "distanceToPoint",
      value: function distanceToPoint(t) {
        return t.distanceTo(this.center) - this.radius;
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        var e = this.radius + t.radius;
        return t.center.distanceToSquared(this.center) <= e * e;
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return t.intersectsSphere(this);
      }
    }, {
      key: "intersectsPlane",
      value: function intersectsPlane(t) {
        return Math.abs(t.distanceToPoint(this.center)) <= this.radius;
      }
    }, {
      key: "clampPoint",
      value: function clampPoint(t, e) {
        var r = this.center.distanceToSquared(t);
        return e.copy(t), r > this.radius * this.radius && (e.sub(this.center).normalize(), e.multiplyScalar(this.radius).add(this.center)), e;
      }
    }, {
      key: "getBoundingBox",
      value: function getBoundingBox(t) {
        return this.isEmpty() ? (t.makeEmpty(), t) : (t.set(this.center, this.center), t.expandByScalar(this.radius), t);
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        return this.center.applyMatrix4(t), this.radius = this.radius * t.getMaxScaleOnAxis(), this;
      }
    }, {
      key: "translate",
      value: function translate(t) {
        return this.center.add(t), this;
      }
    }, {
      key: "expandByPoint",
      value: function expandByPoint(t) {
        if (this.isEmpty()) return this.center.copy(t), this.radius = 0, this;
        qf.subVectors(t, this.center);
        var e = qf.lengthSq();
        if (e > this.radius * this.radius) {
          var r = Math.sqrt(e),
            i = (r - this.radius) * .5;
          this.center.addScaledVector(qf, i / r), this.radius += i;
        }
        return this;
      }
    }, {
      key: "union",
      value: function union(t) {
        return t.isEmpty() ? this : this.isEmpty() ? (this.copy(t), this) : (this.center.equals(t.center) === !0 ? this.radius = Math.max(this.radius, t.radius) : (eS.subVectors(t.center, this.center).setLength(t.radius), this.expandByPoint(qf.copy(t.center).add(eS)), this.expandByPoint(qf.copy(t.center).sub(eS))), this);
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.center.equals(this.center) && t.radius === this.radius;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return Er;
  }(),
  Jo = new _(),
  tS = new _(),
  Mg = new _(),
  ja = new _(),
  rS = new _(),
  Cg = new _(),
  iS = new _(),
  Rs = /*#__PURE__*/function () {
    function Rs() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _(0, 0, -1);
      _classCallCheck(this, Rs);
      this.origin = t, this.direction = e;
    }
    _createClass(Rs, [{
      key: "set",
      value: function set(t, e) {
        return this.origin.copy(t), this.direction.copy(e), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.origin.copy(t.origin), this.direction.copy(t.direction), this;
      }
    }, {
      key: "at",
      value: function at(t, e) {
        return e.copy(this.direction).multiplyScalar(t).add(this.origin);
      }
    }, {
      key: "lookAt",
      value: function lookAt(t) {
        return this.direction.copy(t).sub(this.origin).normalize(), this;
      }
    }, {
      key: "recast",
      value: function recast(t) {
        return this.origin.copy(this.at(t, Jo)), this;
      }
    }, {
      key: "closestPointToPoint",
      value: function closestPointToPoint(t, e) {
        e.subVectors(t, this.origin);
        var r = e.dot(this.direction);
        return r < 0 ? e.copy(this.origin) : e.copy(this.direction).multiplyScalar(r).add(this.origin);
      }
    }, {
      key: "distanceToPoint",
      value: function distanceToPoint(t) {
        return Math.sqrt(this.distanceSqToPoint(t));
      }
    }, {
      key: "distanceSqToPoint",
      value: function distanceSqToPoint(t) {
        var e = Jo.subVectors(t, this.origin).dot(this.direction);
        return e < 0 ? this.origin.distanceToSquared(t) : (Jo.copy(this.direction).multiplyScalar(e).add(this.origin), Jo.distanceToSquared(t));
      }
    }, {
      key: "distanceSqToSegment",
      value: function distanceSqToSegment(t, e, r, i) {
        tS.copy(t).add(e).multiplyScalar(.5), Mg.copy(e).sub(t).normalize(), ja.copy(this.origin).sub(tS);
        var s = t.distanceTo(e) * .5,
          o = -this.direction.dot(Mg),
          a = ja.dot(this.direction),
          l = -ja.dot(Mg),
          u = ja.lengthSq(),
          c = Math.abs(1 - o * o),
          d,
          h,
          f,
          p;
        if (c > 0) {
          if (d = o * l - a, h = o * a - l, p = s * c, d >= 0) {
            if (h >= -p) {
              if (h <= p) {
                var m = 1 / c;
                d *= m, h *= m, f = d * (d + o * h + 2 * a) + h * (o * d + h + 2 * l) + u;
              } else h = s, d = Math.max(0, -(o * h + a)), f = -d * d + h * (h + 2 * l) + u;
            } else h = -s, d = Math.max(0, -(o * h + a)), f = -d * d + h * (h + 2 * l) + u;
          } else h <= -p ? (d = Math.max(0, -(-o * s + a)), h = d > 0 ? -s : Math.min(Math.max(-s, -l), s), f = -d * d + h * (h + 2 * l) + u) : h <= p ? (d = 0, h = Math.min(Math.max(-s, -l), s), f = h * (h + 2 * l) + u) : (d = Math.max(0, -(o * s + a)), h = d > 0 ? s : Math.min(Math.max(-s, -l), s), f = -d * d + h * (h + 2 * l) + u);
        } else h = o > 0 ? -s : s, d = Math.max(0, -(o * h + a)), f = -d * d + h * (h + 2 * l) + u;
        return r && r.copy(this.direction).multiplyScalar(d).add(this.origin), i && i.copy(Mg).multiplyScalar(h).add(tS), f;
      }
    }, {
      key: "intersectSphere",
      value: function intersectSphere(t, e) {
        Jo.subVectors(t.center, this.origin);
        var r = Jo.dot(this.direction),
          i = Jo.dot(Jo) - r * r,
          s = t.radius * t.radius;
        if (i > s) return null;
        var o = Math.sqrt(s - i),
          a = r - o,
          l = r + o;
        return a < 0 && l < 0 ? null : a < 0 ? this.at(l, e) : this.at(a, e);
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        return this.distanceSqToPoint(t.center) <= t.radius * t.radius;
      }
    }, {
      key: "distanceToPlane",
      value: function distanceToPlane(t) {
        var e = t.normal.dot(this.direction);
        if (e === 0) return t.distanceToPoint(this.origin) === 0 ? 0 : null;
        var r = -(this.origin.dot(t.normal) + t.constant) / e;
        return r >= 0 ? r : null;
      }
    }, {
      key: "intersectPlane",
      value: function intersectPlane(t, e) {
        var r = this.distanceToPlane(t);
        return r === null ? null : this.at(r, e);
      }
    }, {
      key: "intersectsPlane",
      value: function intersectsPlane(t) {
        var e = t.distanceToPoint(this.origin);
        return e === 0 || t.normal.dot(this.direction) * e < 0;
      }
    }, {
      key: "intersectBox",
      value: function intersectBox(t, e) {
        var r,
          i,
          s,
          o,
          a,
          l,
          u = 1 / this.direction.x,
          c = 1 / this.direction.y,
          d = 1 / this.direction.z,
          h = this.origin;
        return u >= 0 ? (r = (t.min.x - h.x) * u, i = (t.max.x - h.x) * u) : (r = (t.max.x - h.x) * u, i = (t.min.x - h.x) * u), c >= 0 ? (s = (t.min.y - h.y) * c, o = (t.max.y - h.y) * c) : (s = (t.max.y - h.y) * c, o = (t.min.y - h.y) * c), r > o || s > i || ((s > r || isNaN(r)) && (r = s), (o < i || isNaN(i)) && (i = o), d >= 0 ? (a = (t.min.z - h.z) * d, l = (t.max.z - h.z) * d) : (a = (t.max.z - h.z) * d, l = (t.min.z - h.z) * d), r > l || a > i) || ((a > r || r !== r) && (r = a), (l < i || i !== i) && (i = l), i < 0) ? null : this.at(r >= 0 ? r : i, e);
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return this.intersectBox(t, Jo) !== null;
      }
    }, {
      key: "intersectTriangle",
      value: function intersectTriangle(t, e, r, i, s) {
        rS.subVectors(e, t), Cg.subVectors(r, t), iS.crossVectors(rS, Cg);
        var o = this.direction.dot(iS),
          a;
        if (o > 0) {
          if (i) return null;
          a = 1;
        } else if (o < 0) a = -1, o = -o;else return null;
        ja.subVectors(this.origin, t);
        var l = a * this.direction.dot(Cg.crossVectors(ja, Cg));
        if (l < 0) return null;
        var u = a * this.direction.dot(rS.cross(ja));
        if (u < 0 || l + u > o) return null;
        var c = -a * ja.dot(iS);
        return c < 0 ? null : this.at(c / o, s);
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        return this.origin.applyMatrix4(t), this.direction.transformDirection(t), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.origin.equals(this.origin) && t.direction.equals(this.direction);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return Rs;
  }(),
  te = /*#__PURE__*/function () {
    function te() {
      _classCallCheck(this, te);
      te.prototype.isMatrix4 = !0, this.elements = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
    }
    _createClass(te, [{
      key: "set",
      value: function set(t, e, r, i, s, o, a, l, u, c, d, h, f, p, m, g) {
        var y = this.elements;
        return y[0] = t, y[4] = e, y[8] = r, y[12] = i, y[1] = s, y[5] = o, y[9] = a, y[13] = l, y[2] = u, y[6] = c, y[10] = d, y[14] = h, y[3] = f, y[7] = p, y[11] = m, y[15] = g, this;
      }
    }, {
      key: "identity",
      value: function identity() {
        return this.set(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new te().fromArray(this.elements);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        var e = this.elements,
          r = t.elements;
        return e[0] = r[0], e[1] = r[1], e[2] = r[2], e[3] = r[3], e[4] = r[4], e[5] = r[5], e[6] = r[6], e[7] = r[7], e[8] = r[8], e[9] = r[9], e[10] = r[10], e[11] = r[11], e[12] = r[12], e[13] = r[13], e[14] = r[14], e[15] = r[15], this;
      }
    }, {
      key: "copyPosition",
      value: function copyPosition(t) {
        var e = this.elements,
          r = t.elements;
        return e[12] = r[12], e[13] = r[13], e[14] = r[14], this;
      }
    }, {
      key: "setFromMatrix3",
      value: function setFromMatrix3(t) {
        var e = t.elements;
        return this.set(e[0], e[3], e[6], 0, e[1], e[4], e[7], 0, e[2], e[5], e[8], 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "extractBasis",
      value: function extractBasis(t, e, r) {
        return t.setFromMatrixColumn(this, 0), e.setFromMatrixColumn(this, 1), r.setFromMatrixColumn(this, 2), this;
      }
    }, {
      key: "makeBasis",
      value: function makeBasis(t, e, r) {
        return this.set(t.x, e.x, r.x, 0, t.y, e.y, r.y, 0, t.z, e.z, r.z, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "extractRotation",
      value: function extractRotation(t) {
        var e = this.elements,
          r = t.elements,
          i = 1 / fu.setFromMatrixColumn(t, 0).length(),
          s = 1 / fu.setFromMatrixColumn(t, 1).length(),
          o = 1 / fu.setFromMatrixColumn(t, 2).length();
        return e[0] = r[0] * i, e[1] = r[1] * i, e[2] = r[2] * i, e[3] = 0, e[4] = r[4] * s, e[5] = r[5] * s, e[6] = r[6] * s, e[7] = 0, e[8] = r[8] * o, e[9] = r[9] * o, e[10] = r[10] * o, e[11] = 0, e[12] = 0, e[13] = 0, e[14] = 0, e[15] = 1, this;
      }
    }, {
      key: "makeRotationFromEuler",
      value: function makeRotationFromEuler(t) {
        var e = this.elements,
          r = t.x,
          i = t.y,
          s = t.z,
          o = Math.cos(r),
          a = Math.sin(r),
          l = Math.cos(i),
          u = Math.sin(i),
          c = Math.cos(s),
          d = Math.sin(s);
        if (t.order === "XYZ") {
          var h = o * c,
            f = o * d,
            p = a * c,
            m = a * d;
          e[0] = l * c, e[4] = -l * d, e[8] = u, e[1] = f + p * u, e[5] = h - m * u, e[9] = -a * l, e[2] = m - h * u, e[6] = p + f * u, e[10] = o * l;
        } else if (t.order === "YXZ") {
          var _h2 = l * c,
            _f5 = l * d,
            _p2 = u * c,
            _m2 = u * d;
          e[0] = _h2 + _m2 * a, e[4] = _p2 * a - _f5, e[8] = o * u, e[1] = o * d, e[5] = o * c, e[9] = -a, e[2] = _f5 * a - _p2, e[6] = _m2 + _h2 * a, e[10] = o * l;
        } else if (t.order === "ZXY") {
          var _h3 = l * c,
            _f6 = l * d,
            _p3 = u * c,
            _m3 = u * d;
          e[0] = _h3 - _m3 * a, e[4] = -o * d, e[8] = _p3 + _f6 * a, e[1] = _f6 + _p3 * a, e[5] = o * c, e[9] = _m3 - _h3 * a, e[2] = -o * u, e[6] = a, e[10] = o * l;
        } else if (t.order === "ZYX") {
          var _h4 = o * c,
            _f7 = o * d,
            _p4 = a * c,
            _m4 = a * d;
          e[0] = l * c, e[4] = _p4 * u - _f7, e[8] = _h4 * u + _m4, e[1] = l * d, e[5] = _m4 * u + _h4, e[9] = _f7 * u - _p4, e[2] = -u, e[6] = a * l, e[10] = o * l;
        } else if (t.order === "YZX") {
          var _h5 = o * l,
            _f8 = o * u,
            _p5 = a * l,
            _m5 = a * u;
          e[0] = l * c, e[4] = _m5 - _h5 * d, e[8] = _p5 * d + _f8, e[1] = d, e[5] = o * c, e[9] = -a * c, e[2] = -u * c, e[6] = _f8 * d + _p5, e[10] = _h5 - _m5 * d;
        } else if (t.order === "XZY") {
          var _h6 = o * l,
            _f9 = o * u,
            _p6 = a * l,
            _m6 = a * u;
          e[0] = l * c, e[4] = -d, e[8] = u * c, e[1] = _h6 * d + _m6, e[5] = o * c, e[9] = _f9 * d - _p6, e[2] = _p6 * d - _f9, e[6] = a * c, e[10] = _m6 * d + _h6;
        }
        return e[3] = 0, e[7] = 0, e[11] = 0, e[12] = 0, e[13] = 0, e[14] = 0, e[15] = 1, this;
      }
    }, {
      key: "makeRotationFromQuaternion",
      value: function makeRotationFromQuaternion(t) {
        return this.compose(XF, t, QF);
      }
    }, {
      key: "lookAt",
      value: function lookAt(t, e, r) {
        var i = this.elements;
        return Un.subVectors(t, e), Un.lengthSq() === 0 && (Un.z = 1), Un.normalize(), Ha.crossVectors(r, Un), Ha.lengthSq() === 0 && (Math.abs(r.z) === 1 ? Un.x += 1e-4 : Un.z += 1e-4, Un.normalize(), Ha.crossVectors(r, Un)), Ha.normalize(), Pg.crossVectors(Un, Ha), i[0] = Ha.x, i[4] = Pg.x, i[8] = Un.x, i[1] = Ha.y, i[5] = Pg.y, i[9] = Un.y, i[2] = Ha.z, i[6] = Pg.z, i[10] = Un.z, this;
      }
    }, {
      key: "multiply",
      value: function multiply(t) {
        return this.multiplyMatrices(this, t);
      }
    }, {
      key: "premultiply",
      value: function premultiply(t) {
        return this.multiplyMatrices(t, this);
      }
    }, {
      key: "multiplyMatrices",
      value: function multiplyMatrices(t, e) {
        var r = t.elements,
          i = e.elements,
          s = this.elements,
          o = r[0],
          a = r[4],
          l = r[8],
          u = r[12],
          c = r[1],
          d = r[5],
          h = r[9],
          f = r[13],
          p = r[2],
          m = r[6],
          g = r[10],
          y = r[14],
          v = r[3],
          x = r[7],
          S = r[11],
          w = r[15],
          A = i[0],
          E = i[4],
          b = i[8],
          T = i[12],
          M = i[1],
          C = i[5],
          P = i[9],
          D = i[13],
          O = i[2],
          I = i[6],
          z = i[10],
          B = i[14],
          V = i[3],
          U = i[7],
          j = i[11],
          W = i[15];
        return s[0] = o * A + a * M + l * O + u * V, s[4] = o * E + a * C + l * I + u * U, s[8] = o * b + a * P + l * z + u * j, s[12] = o * T + a * D + l * B + u * W, s[1] = c * A + d * M + h * O + f * V, s[5] = c * E + d * C + h * I + f * U, s[9] = c * b + d * P + h * z + f * j, s[13] = c * T + d * D + h * B + f * W, s[2] = p * A + m * M + g * O + y * V, s[6] = p * E + m * C + g * I + y * U, s[10] = p * b + m * P + g * z + y * j, s[14] = p * T + m * D + g * B + y * W, s[3] = v * A + x * M + S * O + w * V, s[7] = v * E + x * C + S * I + w * U, s[11] = v * b + x * P + S * z + w * j, s[15] = v * T + x * D + S * B + w * W, this;
      }
    }, {
      key: "multiplyScalar",
      value: function multiplyScalar(t) {
        var e = this.elements;
        return e[0] *= t, e[4] *= t, e[8] *= t, e[12] *= t, e[1] *= t, e[5] *= t, e[9] *= t, e[13] *= t, e[2] *= t, e[6] *= t, e[10] *= t, e[14] *= t, e[3] *= t, e[7] *= t, e[11] *= t, e[15] *= t, this;
      }
    }, {
      key: "determinant",
      value: function determinant() {
        var t = this.elements,
          e = t[0],
          r = t[4],
          i = t[8],
          s = t[12],
          o = t[1],
          a = t[5],
          l = t[9],
          u = t[13],
          c = t[2],
          d = t[6],
          h = t[10],
          f = t[14],
          p = t[3],
          m = t[7],
          g = t[11],
          y = t[15];
        return p * (+s * l * d - i * u * d - s * a * h + r * u * h + i * a * f - r * l * f) + m * (+e * l * f - e * u * h + s * o * h - i * o * f + i * u * c - s * l * c) + g * (+e * u * d - e * a * f - s * o * d + r * o * f + s * a * c - r * u * c) + y * (-i * a * c - e * l * d + e * a * h + i * o * d - r * o * h + r * l * c);
      }
    }, {
      key: "transpose",
      value: function transpose() {
        var t = this.elements,
          e;
        return e = t[1], t[1] = t[4], t[4] = e, e = t[2], t[2] = t[8], t[8] = e, e = t[6], t[6] = t[9], t[9] = e, e = t[3], t[3] = t[12], t[12] = e, e = t[7], t[7] = t[13], t[13] = e, e = t[11], t[11] = t[14], t[14] = e, this;
      }
    }, {
      key: "setPosition",
      value: function setPosition(t, e, r) {
        var i = this.elements;
        return t.isVector3 ? (i[12] = t.x, i[13] = t.y, i[14] = t.z) : (i[12] = t, i[13] = e, i[14] = r), this;
      }
    }, {
      key: "invert",
      value: function invert() {
        var t = this.elements,
          e = t[0],
          r = t[1],
          i = t[2],
          s = t[3],
          o = t[4],
          a = t[5],
          l = t[6],
          u = t[7],
          c = t[8],
          d = t[9],
          h = t[10],
          f = t[11],
          p = t[12],
          m = t[13],
          g = t[14],
          y = t[15],
          v = d * g * u - m * h * u + m * l * f - a * g * f - d * l * y + a * h * y,
          x = p * h * u - c * g * u - p * l * f + o * g * f + c * l * y - o * h * y,
          S = c * m * u - p * d * u + p * a * f - o * m * f - c * a * y + o * d * y,
          w = p * d * l - c * m * l - p * a * h + o * m * h + c * a * g - o * d * g,
          A = e * v + r * x + i * S + s * w;
        if (A === 0) return this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        var E = 1 / A;
        return t[0] = v * E, t[1] = (m * h * s - d * g * s - m * i * f + r * g * f + d * i * y - r * h * y) * E, t[2] = (a * g * s - m * l * s + m * i * u - r * g * u - a * i * y + r * l * y) * E, t[3] = (d * l * s - a * h * s - d * i * u + r * h * u + a * i * f - r * l * f) * E, t[4] = x * E, t[5] = (c * g * s - p * h * s + p * i * f - e * g * f - c * i * y + e * h * y) * E, t[6] = (p * l * s - o * g * s - p * i * u + e * g * u + o * i * y - e * l * y) * E, t[7] = (o * h * s - c * l * s + c * i * u - e * h * u - o * i * f + e * l * f) * E, t[8] = S * E, t[9] = (p * d * s - c * m * s - p * r * f + e * m * f + c * r * y - e * d * y) * E, t[10] = (o * m * s - p * a * s + p * r * u - e * m * u - o * r * y + e * a * y) * E, t[11] = (c * a * s - o * d * s - c * r * u + e * d * u + o * r * f - e * a * f) * E, t[12] = w * E, t[13] = (c * m * i - p * d * i + p * r * h - e * m * h - c * r * g + e * d * g) * E, t[14] = (p * a * i - o * m * i - p * r * l + e * m * l + o * r * g - e * a * g) * E, t[15] = (o * d * i - c * a * i + c * r * l - e * d * l - o * r * h + e * a * h) * E, this;
      }
    }, {
      key: "scale",
      value: function scale(t) {
        var e = this.elements,
          r = t.x,
          i = t.y,
          s = t.z;
        return e[0] *= r, e[4] *= i, e[8] *= s, e[1] *= r, e[5] *= i, e[9] *= s, e[2] *= r, e[6] *= i, e[10] *= s, e[3] *= r, e[7] *= i, e[11] *= s, this;
      }
    }, {
      key: "getMaxScaleOnAxis",
      value: function getMaxScaleOnAxis() {
        var t = this.elements,
          e = t[0] * t[0] + t[1] * t[1] + t[2] * t[2],
          r = t[4] * t[4] + t[5] * t[5] + t[6] * t[6],
          i = t[8] * t[8] + t[9] * t[9] + t[10] * t[10];
        return Math.sqrt(Math.max(e, r, i));
      }
    }, {
      key: "makeTranslation",
      value: function makeTranslation(t, e, r) {
        return this.set(1, 0, 0, t, 0, 1, 0, e, 0, 0, 1, r, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeRotationX",
      value: function makeRotationX(t) {
        var e = Math.cos(t),
          r = Math.sin(t);
        return this.set(1, 0, 0, 0, 0, e, -r, 0, 0, r, e, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeRotationY",
      value: function makeRotationY(t) {
        var e = Math.cos(t),
          r = Math.sin(t);
        return this.set(e, 0, r, 0, 0, 1, 0, 0, -r, 0, e, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeRotationZ",
      value: function makeRotationZ(t) {
        var e = Math.cos(t),
          r = Math.sin(t);
        return this.set(e, -r, 0, 0, r, e, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeRotationAxis",
      value: function makeRotationAxis(t, e) {
        var r = Math.cos(e),
          i = Math.sin(e),
          s = 1 - r,
          o = t.x,
          a = t.y,
          l = t.z,
          u = s * o,
          c = s * a;
        return this.set(u * o + r, u * a - i * l, u * l + i * a, 0, u * a + i * l, c * a + r, c * l - i * o, 0, u * l - i * a, c * l + i * o, s * l * l + r, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeScale",
      value: function makeScale(t, e, r) {
        return this.set(t, 0, 0, 0, 0, e, 0, 0, 0, 0, r, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "makeShear",
      value: function makeShear(t, e, r, i, s, o) {
        return this.set(1, r, s, 0, t, 1, o, 0, e, i, 1, 0, 0, 0, 0, 1), this;
      }
    }, {
      key: "compose",
      value: function compose(t, e, r) {
        var i = this.elements,
          s = e._x,
          o = e._y,
          a = e._z,
          l = e._w,
          u = s + s,
          c = o + o,
          d = a + a,
          h = s * u,
          f = s * c,
          p = s * d,
          m = o * c,
          g = o * d,
          y = a * d,
          v = l * u,
          x = l * c,
          S = l * d,
          w = r.x,
          A = r.y,
          E = r.z;
        return i[0] = (1 - (m + y)) * w, i[1] = (f + S) * w, i[2] = (p - x) * w, i[3] = 0, i[4] = (f - S) * A, i[5] = (1 - (h + y)) * A, i[6] = (g + v) * A, i[7] = 0, i[8] = (p + x) * E, i[9] = (g - v) * E, i[10] = (1 - (h + m)) * E, i[11] = 0, i[12] = t.x, i[13] = t.y, i[14] = t.z, i[15] = 1, this;
      }
    }, {
      key: "decompose",
      value: function decompose(t, e, r) {
        var i = this.elements,
          s = fu.set(i[0], i[1], i[2]).length(),
          o = fu.set(i[4], i[5], i[6]).length(),
          a = fu.set(i[8], i[9], i[10]).length();
        this.determinant() < 0 && (s = -s), t.x = i[12], t.y = i[13], t.z = i[14], Cs.copy(this);
        var u = 1 / s,
          c = 1 / o,
          d = 1 / a;
        return Cs.elements[0] *= u, Cs.elements[1] *= u, Cs.elements[2] *= u, Cs.elements[4] *= c, Cs.elements[5] *= c, Cs.elements[6] *= c, Cs.elements[8] *= d, Cs.elements[9] *= d, Cs.elements[10] *= d, e.setFromRotationMatrix(Cs), r.x = s, r.y = o, r.z = a, this;
      }
    }, {
      key: "makePerspective",
      value: function makePerspective(t, e, r, i, s, o) {
        var a = this.elements,
          l = 2 * s / (e - t),
          u = 2 * s / (r - i),
          c = (e + t) / (e - t),
          d = (r + i) / (r - i),
          h = -(o + s) / (o - s),
          f = -2 * o * s / (o - s);
        return a[0] = l, a[4] = 0, a[8] = c, a[12] = 0, a[1] = 0, a[5] = u, a[9] = d, a[13] = 0, a[2] = 0, a[6] = 0, a[10] = h, a[14] = f, a[3] = 0, a[7] = 0, a[11] = -1, a[15] = 0, this;
      }
    }, {
      key: "makeOrthographic",
      value: function makeOrthographic(t, e, r, i, s, o) {
        var a = this.elements,
          l = 1 / (e - t),
          u = 1 / (r - i),
          c = 1 / (o - s),
          d = (e + t) * l,
          h = (r + i) * u,
          f = (o + s) * c;
        return a[0] = 2 * l, a[4] = 0, a[8] = 0, a[12] = -d, a[1] = 0, a[5] = 2 * u, a[9] = 0, a[13] = -h, a[2] = 0, a[6] = 0, a[10] = -2 * c, a[14] = -f, a[3] = 0, a[7] = 0, a[11] = 0, a[15] = 1, this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        var e = this.elements,
          r = t.elements;
        for (var i = 0; i < 16; i++) if (e[i] !== r[i]) return !1;
        return !0;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        for (var r = 0; r < 16; r++) this.elements[r] = t[r + e];
        return this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = this.elements;
        return t[e] = r[0], t[e + 1] = r[1], t[e + 2] = r[2], t[e + 3] = r[3], t[e + 4] = r[4], t[e + 5] = r[5], t[e + 6] = r[6], t[e + 7] = r[7], t[e + 8] = r[8], t[e + 9] = r[9], t[e + 10] = r[10], t[e + 11] = r[11], t[e + 12] = r[12], t[e + 13] = r[13], t[e + 14] = r[14], t[e + 15] = r[15], t;
      }
    }]);
    return te;
  }(),
  fu = new _(),
  Cs = new te(),
  XF = new _(0, 0, 0),
  QF = new _(1, 1, 1),
  Ha = new _(),
  Pg = new _(),
  Un = new _(),
  AT = new te(),
  _T = new je(),
  Kt = /*#__PURE__*/function (_Symbol$iterator6) {
    function Kt() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Kt.DEFAULT_ORDER;
      _classCallCheck(this, Kt);
      this.isEuler = !0, this._x = t, this._y = e, this._z = r, this._order = i;
    }
    _createClass(Kt, [{
      key: "x",
      get: function get() {
        return this._x;
      },
      set: function set(t) {
        this._x = t, this._onChangeCallback();
      }
    }, {
      key: "y",
      get: function get() {
        return this._y;
      },
      set: function set(t) {
        this._y = t, this._onChangeCallback();
      }
    }, {
      key: "z",
      get: function get() {
        return this._z;
      },
      set: function set(t) {
        this._z = t, this._onChangeCallback();
      }
    }, {
      key: "order",
      get: function get() {
        return this._order;
      },
      set: function set(t) {
        this._order = t, this._onChangeCallback();
      }
    }, {
      key: "set",
      value: function set(t, e, r) {
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : this._order;
        return this._x = t, this._y = e, this._z = r, this._order = i, this._onChangeCallback(), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this._x, this._y, this._z, this._order);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this._x = t._x, this._y = t._y, this._z = t._z, this._order = t._order, this._onChangeCallback(), this;
      }
    }, {
      key: "setFromRotationMatrix",
      value: function setFromRotationMatrix(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._order;
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
        var i = t.elements,
          s = i[0],
          o = i[4],
          a = i[8],
          l = i[1],
          u = i[5],
          c = i[9],
          d = i[2],
          h = i[6],
          f = i[10];
        switch (e) {
          case "XYZ":
            this._y = Math.asin(oi(a, -1, 1)), Math.abs(a) < .9999999 ? (this._x = Math.atan2(-c, f), this._z = Math.atan2(-o, s)) : (this._x = Math.atan2(h, u), this._z = 0);
            break;
          case "YXZ":
            this._x = Math.asin(-oi(c, -1, 1)), Math.abs(c) < .9999999 ? (this._y = Math.atan2(a, f), this._z = Math.atan2(l, u)) : (this._y = Math.atan2(-d, s), this._z = 0);
            break;
          case "ZXY":
            this._x = Math.asin(oi(h, -1, 1)), Math.abs(h) < .9999999 ? (this._y = Math.atan2(-d, f), this._z = Math.atan2(-o, u)) : (this._y = 0, this._z = Math.atan2(l, s));
            break;
          case "ZYX":
            this._y = Math.asin(-oi(d, -1, 1)), Math.abs(d) < .9999999 ? (this._x = Math.atan2(h, f), this._z = Math.atan2(l, s)) : (this._x = 0, this._z = Math.atan2(-o, u));
            break;
          case "YZX":
            this._z = Math.asin(oi(l, -1, 1)), Math.abs(l) < .9999999 ? (this._x = Math.atan2(-c, u), this._y = Math.atan2(-d, s)) : (this._x = 0, this._y = Math.atan2(a, f));
            break;
          case "XZY":
            this._z = Math.asin(-oi(o, -1, 1)), Math.abs(o) < .9999999 ? (this._x = Math.atan2(h, u), this._y = Math.atan2(a, s)) : (this._x = Math.atan2(-c, f), this._y = 0);
            break;
          default:
            console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: " + e);
        }
        return this._order = e, r === !0 && this._onChangeCallback(), this;
      }
    }, {
      key: "setFromQuaternion",
      value: function setFromQuaternion(t, e, r) {
        return AT.makeRotationFromQuaternion(t), this.setFromRotationMatrix(AT, e, r);
      }
    }, {
      key: "setFromVector3",
      value: function setFromVector3(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._order;
        return this.set(t.x, t.y, t.z, e);
      }
    }, {
      key: "reorder",
      value: function reorder(t) {
        return _T.setFromEuler(this), this.setFromQuaternion(_T, t);
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t._x === this._x && t._y === this._y && t._z === this._z && t._order === this._order;
      }
    }, {
      key: "fromArray",
      value: function fromArray(t) {
        return this._x = t[0], this._y = t[1], this._z = t[2], t[3] !== void 0 && (this._order = t[3]), this._onChangeCallback(), this;
      }
    }, {
      key: "toArray",
      value: function toArray() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return t[e] = this._x, t[e + 1] = this._y, t[e + 2] = this._z, t[e + 3] = this._order, t;
      }
    }, {
      key: "_onChange",
      value: function _onChange(t) {
        return this._onChangeCallback = t, this;
      }
    }, {
      key: "_onChangeCallback",
      value: function _onChangeCallback() {}
    }, {
      key: _Symbol$iterator6,
      value: /*#__PURE__*/_regeneratorRuntime().mark(function value() {
        return _regeneratorRuntime().wrap(function value$(_context6) {
          while (1) switch (_context6.prev = _context6.next) {
            case 0:
              _context6.next = 2;
              return this._x;
            case 2:
              _context6.next = 4;
              return this._y;
            case 4:
              _context6.next = 6;
              return this._z;
            case 6:
              _context6.next = 8;
              return this._order;
            case 8:
            case "end":
              return _context6.stop();
          }
        }, value, this);
      })
    }]);
    return Kt;
  }(Symbol.iterator);
Kt.DEFAULT_ORDER = "XYZ";
var up = /*#__PURE__*/function () {
    function up() {
      _classCallCheck(this, up);
      this.mask = 1;
    }
    _createClass(up, [{
      key: "set",
      value: function set(t) {
        this.mask = (1 << t | 0) >>> 0;
      }
    }, {
      key: "enable",
      value: function enable(t) {
        this.mask |= 1 << t | 0;
      }
    }, {
      key: "enableAll",
      value: function enableAll() {
        this.mask = -1;
      }
    }, {
      key: "toggle",
      value: function toggle(t) {
        this.mask ^= 1 << t | 0;
      }
    }, {
      key: "disable",
      value: function disable(t) {
        this.mask &= ~(1 << t | 0);
      }
    }, {
      key: "disableAll",
      value: function disableAll() {
        this.mask = 0;
      }
    }, {
      key: "test",
      value: function test(t) {
        return (this.mask & t.mask) !== 0;
      }
    }, {
      key: "isEnabled",
      value: function isEnabled(t) {
        return (this.mask & (1 << t | 0)) !== 0;
      }
    }]);
    return up;
  }(),
  KF = 0,
  ET = new _(),
  pu = new je(),
  $o = new te(),
  Dg = new _(),
  Yf = new _(),
  ZF = new _(),
  JF = new je(),
  TT = new _(1, 0, 0),
  MT = new _(0, 1, 0),
  CT = new _(0, 0, 1),
  $F = {
    type: "added"
  },
  PT = {
    type: "removed"
  },
  mt = /*#__PURE__*/function (_ir3) {
    _inherits(mt, _ir3);
    var _super6 = _createSuper(mt);
    function mt() {
      var _this6;
      _classCallCheck(this, mt);
      _this6 = _super6.call(this), _this6.isObject3D = !0, Object.defineProperty(_assertThisInitialized(_this6), "id", {
        value: KF++
      }), _this6.uuid = rs(), _this6.name = "", _this6.type = "Object3D", _this6.parent = null, _this6.children = [], _this6.up = mt.DEFAULT_UP.clone();
      var t = new _(),
        e = new Kt(),
        r = new je(),
        i = new _(1, 1, 1);
      function s() {
        r.setFromEuler(e, !1);
      }
      function o() {
        e.setFromQuaternion(r, void 0, !1);
      }
      e._onChange(s), r._onChange(o), Object.defineProperties(_assertThisInitialized(_this6), {
        position: {
          configurable: !0,
          enumerable: !0,
          value: t
        },
        rotation: {
          configurable: !0,
          enumerable: !0,
          value: e
        },
        quaternion: {
          configurable: !0,
          enumerable: !0,
          value: r
        },
        scale: {
          configurable: !0,
          enumerable: !0,
          value: i
        },
        modelViewMatrix: {
          value: new te()
        },
        normalMatrix: {
          value: new Qt()
        }
      }), _this6.matrix = new te(), _this6.matrixWorld = new te(), _this6.matrixAutoUpdate = mt.DEFAULT_MATRIX_AUTO_UPDATE, _this6.matrixWorldNeedsUpdate = !1, _this6.matrixWorldAutoUpdate = mt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE, _this6.layers = new up(), _this6.visible = !0, _this6.castShadow = !1, _this6.receiveShadow = !1, _this6.frustumCulled = !0, _this6.renderOrder = 0, _this6.animations = [], _this6.userData = {};
      return _this6;
    }
    _createClass(mt, [{
      key: "onBeforeRender",
      value: function onBeforeRender() {}
    }, {
      key: "onAfterRender",
      value: function onAfterRender() {}
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        this.matrixAutoUpdate && this.updateMatrix(), this.matrix.premultiply(t), this.matrix.decompose(this.position, this.quaternion, this.scale);
      }
    }, {
      key: "applyQuaternion",
      value: function applyQuaternion(t) {
        return this.quaternion.premultiply(t), this;
      }
    }, {
      key: "setRotationFromAxisAngle",
      value: function setRotationFromAxisAngle(t, e) {
        this.quaternion.setFromAxisAngle(t, e);
      }
    }, {
      key: "setRotationFromEuler",
      value: function setRotationFromEuler(t) {
        this.quaternion.setFromEuler(t, !0);
      }
    }, {
      key: "setRotationFromMatrix",
      value: function setRotationFromMatrix(t) {
        this.quaternion.setFromRotationMatrix(t);
      }
    }, {
      key: "setRotationFromQuaternion",
      value: function setRotationFromQuaternion(t) {
        this.quaternion.copy(t);
      }
    }, {
      key: "rotateOnAxis",
      value: function rotateOnAxis(t, e) {
        return pu.setFromAxisAngle(t, e), this.quaternion.multiply(pu), this;
      }
    }, {
      key: "rotateOnWorldAxis",
      value: function rotateOnWorldAxis(t, e) {
        return pu.setFromAxisAngle(t, e), this.quaternion.premultiply(pu), this;
      }
    }, {
      key: "rotateX",
      value: function rotateX(t) {
        return this.rotateOnAxis(TT, t);
      }
    }, {
      key: "rotateY",
      value: function rotateY(t) {
        return this.rotateOnAxis(MT, t);
      }
    }, {
      key: "rotateZ",
      value: function rotateZ(t) {
        return this.rotateOnAxis(CT, t);
      }
    }, {
      key: "translateOnAxis",
      value: function translateOnAxis(t, e) {
        return ET.copy(t).applyQuaternion(this.quaternion), this.position.add(ET.multiplyScalar(e)), this;
      }
    }, {
      key: "translateX",
      value: function translateX(t) {
        return this.translateOnAxis(TT, t);
      }
    }, {
      key: "translateY",
      value: function translateY(t) {
        return this.translateOnAxis(MT, t);
      }
    }, {
      key: "translateZ",
      value: function translateZ(t) {
        return this.translateOnAxis(CT, t);
      }
    }, {
      key: "localToWorld",
      value: function localToWorld(t) {
        return this.updateWorldMatrix(!0, !1), t.applyMatrix4(this.matrixWorld);
      }
    }, {
      key: "worldToLocal",
      value: function worldToLocal(t) {
        return this.updateWorldMatrix(!0, !1), t.applyMatrix4($o.copy(this.matrixWorld).invert());
      }
    }, {
      key: "lookAt",
      value: function lookAt(t, e, r) {
        t.isVector3 ? Dg.copy(t) : Dg.set(t, e, r);
        var i = this.parent;
        this.updateWorldMatrix(!0, !1), Yf.setFromMatrixPosition(this.matrixWorld), this.isCamera || this.isLight ? $o.lookAt(Yf, Dg, this.up) : $o.lookAt(Dg, Yf, this.up), this.quaternion.setFromRotationMatrix($o), i && ($o.extractRotation(i.matrixWorld), pu.setFromRotationMatrix($o), this.quaternion.premultiply(pu.invert()));
      }
    }, {
      key: "add",
      value: function add(t) {
        if (arguments.length > 1) {
          for (var e = 0; e < arguments.length; e++) this.add(arguments[e]);
          return this;
        }
        return t === this ? (console.error("THREE.Object3D.add: object can't be added as a child of itself.", t), this) : (t && t.isObject3D ? (t.parent !== null && t.parent.remove(t), t.parent = this, this.children.push(t), t.dispatchEvent($F)) : console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.", t), this);
      }
    }, {
      key: "remove",
      value: function remove(t) {
        if (arguments.length > 1) {
          for (var r = 0; r < arguments.length; r++) this.remove(arguments[r]);
          return this;
        }
        var e = this.children.indexOf(t);
        return e !== -1 && (t.parent = null, this.children.splice(e, 1), t.dispatchEvent(PT)), this;
      }
    }, {
      key: "removeFromParent",
      value: function removeFromParent() {
        var t = this.parent;
        return t !== null && t.remove(this), this;
      }
    }, {
      key: "clear",
      value: function clear() {
        for (var t = 0; t < this.children.length; t++) {
          var e = this.children[t];
          e.parent = null, e.dispatchEvent(PT);
        }
        return this.children.length = 0, this;
      }
    }, {
      key: "attach",
      value: function attach(t) {
        return this.updateWorldMatrix(!0, !1), $o.copy(this.matrixWorld).invert(), t.parent !== null && (t.parent.updateWorldMatrix(!0, !1), $o.multiply(t.parent.matrixWorld)), t.applyMatrix4($o), this.add(t), t.updateWorldMatrix(!1, !0), this;
      }
    }, {
      key: "getObjectById",
      value: function getObjectById(t) {
        return this.getObjectByProperty("id", t);
      }
    }, {
      key: "getObjectByName",
      value: function getObjectByName(t) {
        return this.getObjectByProperty("name", t);
      }
    }, {
      key: "getObjectByProperty",
      value: function getObjectByProperty(t, e) {
        if (this[t] === e) return this;
        for (var r = 0, i = this.children.length; r < i; r++) {
          var o = this.children[r].getObjectByProperty(t, e);
          if (o !== void 0) return o;
        }
      }
    }, {
      key: "getObjectsByProperty",
      value: function getObjectsByProperty(t, e) {
        var r = [];
        this[t] === e && r.push(this);
        for (var i = 0, s = this.children.length; i < s; i++) {
          var o = this.children[i].getObjectsByProperty(t, e);
          o.length > 0 && (r = r.concat(o));
        }
        return r;
      }
    }, {
      key: "getWorldPosition",
      value: function getWorldPosition(t) {
        return this.updateWorldMatrix(!0, !1), t.setFromMatrixPosition(this.matrixWorld);
      }
    }, {
      key: "getWorldQuaternion",
      value: function getWorldQuaternion(t) {
        return this.updateWorldMatrix(!0, !1), this.matrixWorld.decompose(Yf, t, ZF), t;
      }
    }, {
      key: "getWorldScale",
      value: function getWorldScale(t) {
        return this.updateWorldMatrix(!0, !1), this.matrixWorld.decompose(Yf, JF, t), t;
      }
    }, {
      key: "getWorldDirection",
      value: function getWorldDirection(t) {
        this.updateWorldMatrix(!0, !1);
        var e = this.matrixWorld.elements;
        return t.set(e[8], e[9], e[10]).normalize();
      }
    }, {
      key: "raycast",
      value: function raycast() {}
    }, {
      key: "traverse",
      value: function traverse(t) {
        t(this);
        var e = this.children;
        for (var r = 0, i = e.length; r < i; r++) e[r].traverse(t);
      }
    }, {
      key: "traverseVisible",
      value: function traverseVisible(t) {
        if (this.visible === !1) return;
        t(this);
        var e = this.children;
        for (var r = 0, i = e.length; r < i; r++) e[r].traverseVisible(t);
      }
    }, {
      key: "traverseAncestors",
      value: function traverseAncestors(t) {
        var e = this.parent;
        e !== null && (t(e), e.traverseAncestors(t));
      }
    }, {
      key: "updateMatrix",
      value: function updateMatrix() {
        this.matrix.compose(this.position, this.quaternion, this.scale), this.matrixWorldNeedsUpdate = !0;
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(t) {
        this.matrixAutoUpdate && this.updateMatrix(), (this.matrixWorldNeedsUpdate || t) && (this.parent === null ? this.matrixWorld.copy(this.matrix) : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix), this.matrixWorldNeedsUpdate = !1, t = !0);
        var e = this.children;
        for (var r = 0, i = e.length; r < i; r++) {
          var s = e[r];
          (s.matrixWorldAutoUpdate === !0 || t === !0) && s.updateMatrixWorld(t);
        }
      }
    }, {
      key: "updateWorldMatrix",
      value: function updateWorldMatrix(t, e) {
        var r = this.parent;
        if (t === !0 && r !== null && r.matrixWorldAutoUpdate === !0 && r.updateWorldMatrix(!0, !1), this.matrixAutoUpdate && this.updateMatrix(), this.parent === null ? this.matrixWorld.copy(this.matrix) : this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.matrix), e === !0) {
          var i = this.children;
          for (var s = 0, o = i.length; s < o; s++) {
            var a = i[s];
            a.matrixWorldAutoUpdate === !0 && a.updateWorldMatrix(!1, !0);
          }
        }
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = t === void 0 || typeof t == "string",
          r = {};
        e && (t = {
          geometries: {},
          materials: {},
          textures: {},
          images: {},
          shapes: {},
          skeletons: {},
          animations: {},
          nodes: {}
        }, r.metadata = {
          version: 4.5,
          type: "Object",
          generator: "Object3D.toJSON"
        });
        var i = {};
        i.uuid = this.uuid, i.type = this.type, this.name !== "" && (i.name = this.name), this.castShadow === !0 && (i.castShadow = !0), this.receiveShadow === !0 && (i.receiveShadow = !0), this.visible === !1 && (i.visible = !1), this.frustumCulled === !1 && (i.frustumCulled = !1), this.renderOrder !== 0 && (i.renderOrder = this.renderOrder), Object.keys(this.userData).length > 0 && (i.userData = this.userData), i.layers = this.layers.mask, i.matrix = this.matrix.toArray(), this.matrixAutoUpdate === !1 && (i.matrixAutoUpdate = !1), this.isInstancedMesh && (i.type = "InstancedMesh", i.count = this.count, i.instanceMatrix = this.instanceMatrix.toJSON(), this.instanceColor !== null && (i.instanceColor = this.instanceColor.toJSON()));
        function s(a, l) {
          return a[l.uuid] === void 0 && (a[l.uuid] = l.toJSON(t)), l.uuid;
        }
        if (this.isScene) this.background && (this.background.isColor ? i.background = this.background.toJSON() : this.background.isTexture && (i.background = this.background.toJSON(t).uuid)), this.environment && this.environment.isTexture && this.environment.isRenderTargetTexture !== !0 && (i.environment = this.environment.toJSON(t).uuid);else if (this.isMesh || this.isLine || this.isPoints) {
          i.geometry = s(t.geometries, this.geometry);
          var a = this.geometry.parameters;
          if (a !== void 0 && a.shapes !== void 0) {
            var l = a.shapes;
            if (Array.isArray(l)) for (var u = 0, c = l.length; u < c; u++) {
              var d = l[u];
              s(t.shapes, d);
            } else s(t.shapes, l);
          }
        }
        if (this.isSkinnedMesh && (i.bindMode = this.bindMode, i.bindMatrix = this.bindMatrix.toArray(), this.skeleton !== void 0 && (s(t.skeletons, this.skeleton), i.skeleton = this.skeleton.uuid)), this.material !== void 0) if (Array.isArray(this.material)) {
          var _a2 = [];
          for (var _l2 = 0, _u2 = this.material.length; _l2 < _u2; _l2++) _a2.push(s(t.materials, this.material[_l2]));
          i.material = _a2;
        } else i.material = s(t.materials, this.material);
        if (this.children.length > 0) {
          i.children = [];
          for (var _a3 = 0; _a3 < this.children.length; _a3++) i.children.push(this.children[_a3].toJSON(t).object);
        }
        if (this.animations.length > 0) {
          i.animations = [];
          for (var _a4 = 0; _a4 < this.animations.length; _a4++) {
            var _l3 = this.animations[_a4];
            i.animations.push(s(t.animations, _l3));
          }
        }
        if (e) {
          var _a5 = o(t.geometries),
            _l4 = o(t.materials),
            _u3 = o(t.textures),
            _c2 = o(t.images),
            _d2 = o(t.shapes),
            h = o(t.skeletons),
            f = o(t.animations),
            p = o(t.nodes);
          _a5.length > 0 && (r.geometries = _a5), _l4.length > 0 && (r.materials = _l4), _u3.length > 0 && (r.textures = _u3), _c2.length > 0 && (r.images = _c2), _d2.length > 0 && (r.shapes = _d2), h.length > 0 && (r.skeletons = h), f.length > 0 && (r.animations = f), p.length > 0 && (r.nodes = p);
        }
        return r.object = i, r;
        function o(a) {
          var l = [];
          for (var _u4 in a) {
            var _c3 = a[_u4];
            delete _c3.metadata, l.push(_c3);
          }
          return l;
        }
      }
    }, {
      key: "clone",
      value: function clone(t) {
        return new this.constructor().copy(this, t);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
        if (this.name = t.name, this.up.copy(t.up), this.position.copy(t.position), this.rotation.order = t.rotation.order, this.quaternion.copy(t.quaternion), this.scale.copy(t.scale), this.matrix.copy(t.matrix), this.matrixWorld.copy(t.matrixWorld), this.matrixAutoUpdate = t.matrixAutoUpdate, this.matrixWorldNeedsUpdate = t.matrixWorldNeedsUpdate, this.matrixWorldAutoUpdate = t.matrixWorldAutoUpdate, this.layers.mask = t.layers.mask, this.visible = t.visible, this.castShadow = t.castShadow, this.receiveShadow = t.receiveShadow, this.frustumCulled = t.frustumCulled, this.renderOrder = t.renderOrder, this.userData = JSON.parse(JSON.stringify(t.userData)), e === !0) for (var r = 0; r < t.children.length; r++) {
          var i = t.children[r];
          this.add(i.clone());
        }
        return this;
      }
    }]);
    return mt;
  }(ir);
mt.DEFAULT_UP = new _(0, 1, 0);
mt.DEFAULT_MATRIX_AUTO_UPDATE = !0;
mt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE = !0;
var Ps = new _(),
  ea = new _(),
  nS = new _(),
  ta = new _(),
  mu = new _(),
  gu = new _(),
  DT = new _(),
  sS = new _(),
  oS = new _(),
  aS = new _(),
  vr = /*#__PURE__*/function () {
    function vr() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new _();
      _classCallCheck(this, vr);
      this.a = t, this.b = e, this.c = r;
    }
    _createClass(vr, [{
      key: "set",
      value: function set(t, e, r) {
        return this.a.copy(t), this.b.copy(e), this.c.copy(r), this;
      }
    }, {
      key: "setFromPointsAndIndices",
      value: function setFromPointsAndIndices(t, e, r, i) {
        return this.a.copy(t[e]), this.b.copy(t[r]), this.c.copy(t[i]), this;
      }
    }, {
      key: "setFromAttributeAndIndices",
      value: function setFromAttributeAndIndices(t, e, r, i) {
        return this.a.fromBufferAttribute(t, e), this.b.fromBufferAttribute(t, r), this.c.fromBufferAttribute(t, i), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.a.copy(t.a), this.b.copy(t.b), this.c.copy(t.c), this;
      }
    }, {
      key: "getArea",
      value: function getArea() {
        return Ps.subVectors(this.c, this.b), ea.subVectors(this.a, this.b), Ps.cross(ea).length() * .5;
      }
    }, {
      key: "getMidpoint",
      value: function getMidpoint(t) {
        return t.addVectors(this.a, this.b).add(this.c).multiplyScalar(1 / 3);
      }
    }, {
      key: "getNormal",
      value: function getNormal(t) {
        return vr.getNormal(this.a, this.b, this.c, t);
      }
    }, {
      key: "getPlane",
      value: function getPlane(t) {
        return t.setFromCoplanarPoints(this.a, this.b, this.c);
      }
    }, {
      key: "getBarycoord",
      value: function getBarycoord(t, e) {
        return vr.getBarycoord(t, this.a, this.b, this.c, e);
      }
    }, {
      key: "getUV",
      value: function getUV(t, e, r, i, s) {
        return vr.getUV(t, this.a, this.b, this.c, e, r, i, s);
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        return vr.containsPoint(t, this.a, this.b, this.c);
      }
    }, {
      key: "isFrontFacing",
      value: function isFrontFacing(t) {
        return vr.isFrontFacing(this.a, this.b, this.c, t);
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return t.intersectsTriangle(this);
      }
    }, {
      key: "closestPointToPoint",
      value: function closestPointToPoint(t, e) {
        var r = this.a,
          i = this.b,
          s = this.c,
          o,
          a;
        mu.subVectors(i, r), gu.subVectors(s, r), sS.subVectors(t, r);
        var l = mu.dot(sS),
          u = gu.dot(sS);
        if (l <= 0 && u <= 0) return e.copy(r);
        oS.subVectors(t, i);
        var c = mu.dot(oS),
          d = gu.dot(oS);
        if (c >= 0 && d <= c) return e.copy(i);
        var h = l * d - c * u;
        if (h <= 0 && l >= 0 && c <= 0) return o = l / (l - c), e.copy(r).addScaledVector(mu, o);
        aS.subVectors(t, s);
        var f = mu.dot(aS),
          p = gu.dot(aS);
        if (p >= 0 && f <= p) return e.copy(s);
        var m = f * u - l * p;
        if (m <= 0 && u >= 0 && p <= 0) return a = u / (u - p), e.copy(r).addScaledVector(gu, a);
        var g = c * p - f * d;
        if (g <= 0 && d - c >= 0 && f - p >= 0) return DT.subVectors(s, i), a = (d - c) / (d - c + (f - p)), e.copy(i).addScaledVector(DT, a);
        var y = 1 / (g + m + h);
        return o = m * y, a = h * y, e.copy(r).addScaledVector(mu, o).addScaledVector(gu, a);
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.a.equals(this.a) && t.b.equals(this.b) && t.c.equals(this.c);
      }
    }], [{
      key: "getNormal",
      value: function getNormal(t, e, r, i) {
        i.subVectors(r, e), Ps.subVectors(t, e), i.cross(Ps);
        var s = i.lengthSq();
        return s > 0 ? i.multiplyScalar(1 / Math.sqrt(s)) : i.set(0, 0, 0);
      }
    }, {
      key: "getBarycoord",
      value: function getBarycoord(t, e, r, i, s) {
        Ps.subVectors(i, e), ea.subVectors(r, e), nS.subVectors(t, e);
        var o = Ps.dot(Ps),
          a = Ps.dot(ea),
          l = Ps.dot(nS),
          u = ea.dot(ea),
          c = ea.dot(nS),
          d = o * u - a * a;
        if (d === 0) return s.set(-2, -1, -1);
        var h = 1 / d,
          f = (u * l - a * c) * h,
          p = (o * c - a * l) * h;
        return s.set(1 - f - p, p, f);
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t, e, r, i) {
        return this.getBarycoord(t, e, r, i, ta), ta.x >= 0 && ta.y >= 0 && ta.x + ta.y <= 1;
      }
    }, {
      key: "getUV",
      value: function getUV(t, e, r, i, s, o, a, l) {
        return this.getBarycoord(t, e, r, i, ta), l.set(0, 0), l.addScaledVector(s, ta.x), l.addScaledVector(o, ta.y), l.addScaledVector(a, ta.z), l;
      }
    }, {
      key: "isFrontFacing",
      value: function isFrontFacing(t, e, r, i) {
        return Ps.subVectors(r, e), ea.subVectors(t, e), Ps.cross(ea).dot(i) < 0;
      }
    }]);
    return vr;
  }(),
  ek = 0,
  hc = /*#__PURE__*/function (_ir4) {
    _inherits(hc, _ir4);
    var _super7 = _createSuper(hc);
    function hc() {
      var _this7;
      _classCallCheck(this, hc);
      _this7 = _super7.call(this), _this7.isMaterial = !0, Object.defineProperty(_assertThisInitialized(_this7), "id", {
        value: ek++
      }), _this7.uuid = rs(), _this7.name = "", _this7.type = "Material", _this7.blending = qa, _this7.side = jn, _this7.vertexColors = !1, _this7.opacity = 1, _this7.transparent = !1, _this7.blendSrc = wM, _this7.blendDst = AM, _this7.blendEquation = Au, _this7.blendSrcAlpha = null, _this7.blendDstAlpha = null, _this7.blendEquationAlpha = null, _this7.depthFunc = wS, _this7.depthTest = !0, _this7.depthWrite = !0, _this7.stencilWriteMask = 255, _this7.stencilFunc = OF, _this7.stencilRef = 0, _this7.stencilFuncMask = 255, _this7.stencilFail = qb, _this7.stencilZFail = qb, _this7.stencilZPass = qb, _this7.stencilWrite = !1, _this7.clippingPlanes = null, _this7.clipIntersection = !1, _this7.clipShadows = !1, _this7.shadowSide = null, _this7.colorWrite = !0, _this7.precision = null, _this7.polygonOffset = !1, _this7.polygonOffsetFactor = 0, _this7.polygonOffsetUnits = 0, _this7.dithering = !1, _this7.alphaToCoverage = !1, _this7.premultipliedAlpha = !1, _this7.forceSinglePass = !1, _this7.visible = !0, _this7.toneMapped = !0, _this7.userData = {}, _this7.version = 0, _this7._alphaTest = 0;
      return _this7;
    }
    _createClass(hc, [{
      key: "alphaTest",
      get: function get() {
        return this._alphaTest;
      },
      set: function set(t) {
        this._alphaTest > 0 != t > 0 && this.version++, this._alphaTest = t;
      }
    }, {
      key: "onBuild",
      value: function onBuild() {}
    }, {
      key: "onBeforeRender",
      value: function onBeforeRender() {}
    }, {
      key: "onBeforeCompile",
      value: function onBeforeCompile() {}
    }, {
      key: "customProgramCacheKey",
      value: function customProgramCacheKey() {
        return this.onBeforeCompile.toString();
      }
    }, {
      key: "setValues",
      value: function setValues(t) {
        if (t !== void 0) for (var e in t) {
          var r = t[e];
          if (r === void 0) {
            console.warn("THREE.Material: '" + e + "' parameter is undefined.");
            continue;
          }
          var i = this[e];
          if (i === void 0) {
            console.warn("THREE." + this.type + ": '" + e + "' is not a property of this material.");
            continue;
          }
          i && i.isColor ? i.set(r) : i && i.isVector3 && r && r.isVector3 ? i.copy(r) : this[e] = r;
        }
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = t === void 0 || typeof t == "string";
        e && (t = {
          textures: {},
          images: {}
        });
        var r = {
          metadata: {
            version: 4.5,
            type: "Material",
            generator: "Material.toJSON"
          }
        };
        r.uuid = this.uuid, r.type = this.type, this.name !== "" && (r.name = this.name), this.color && this.color.isColor && (r.color = this.color.getHex()), this.roughness !== void 0 && (r.roughness = this.roughness), this.metalness !== void 0 && (r.metalness = this.metalness), this.sheen !== void 0 && (r.sheen = this.sheen), this.sheenColor && this.sheenColor.isColor && (r.sheenColor = this.sheenColor.getHex()), this.sheenRoughness !== void 0 && (r.sheenRoughness = this.sheenRoughness), this.emissive && this.emissive.isColor && (r.emissive = this.emissive.getHex()), this.emissiveIntensity && this.emissiveIntensity !== 1 && (r.emissiveIntensity = this.emissiveIntensity), this.specular && this.specular.isColor && (r.specular = this.specular.getHex()), this.specularIntensity !== void 0 && (r.specularIntensity = this.specularIntensity), this.specularColor && this.specularColor.isColor && (r.specularColor = this.specularColor.getHex()), this.shininess !== void 0 && (r.shininess = this.shininess), this.clearcoat !== void 0 && (r.clearcoat = this.clearcoat), this.clearcoatRoughness !== void 0 && (r.clearcoatRoughness = this.clearcoatRoughness), this.clearcoatMap && this.clearcoatMap.isTexture && (r.clearcoatMap = this.clearcoatMap.toJSON(t).uuid), this.clearcoatRoughnessMap && this.clearcoatRoughnessMap.isTexture && (r.clearcoatRoughnessMap = this.clearcoatRoughnessMap.toJSON(t).uuid), this.clearcoatNormalMap && this.clearcoatNormalMap.isTexture && (r.clearcoatNormalMap = this.clearcoatNormalMap.toJSON(t).uuid, r.clearcoatNormalScale = this.clearcoatNormalScale.toArray()), this.iridescence !== void 0 && (r.iridescence = this.iridescence), this.iridescenceIOR !== void 0 && (r.iridescenceIOR = this.iridescenceIOR), this.iridescenceThicknessRange !== void 0 && (r.iridescenceThicknessRange = this.iridescenceThicknessRange), this.iridescenceMap && this.iridescenceMap.isTexture && (r.iridescenceMap = this.iridescenceMap.toJSON(t).uuid), this.iridescenceThicknessMap && this.iridescenceThicknessMap.isTexture && (r.iridescenceThicknessMap = this.iridescenceThicknessMap.toJSON(t).uuid), this.map && this.map.isTexture && (r.map = this.map.toJSON(t).uuid), this.matcap && this.matcap.isTexture && (r.matcap = this.matcap.toJSON(t).uuid), this.alphaMap && this.alphaMap.isTexture && (r.alphaMap = this.alphaMap.toJSON(t).uuid), this.lightMap && this.lightMap.isTexture && (r.lightMap = this.lightMap.toJSON(t).uuid, r.lightMapIntensity = this.lightMapIntensity), this.aoMap && this.aoMap.isTexture && (r.aoMap = this.aoMap.toJSON(t).uuid, r.aoMapIntensity = this.aoMapIntensity), this.bumpMap && this.bumpMap.isTexture && (r.bumpMap = this.bumpMap.toJSON(t).uuid, r.bumpScale = this.bumpScale), this.normalMap && this.normalMap.isTexture && (r.normalMap = this.normalMap.toJSON(t).uuid, r.normalMapType = this.normalMapType, r.normalScale = this.normalScale.toArray()), this.displacementMap && this.displacementMap.isTexture && (r.displacementMap = this.displacementMap.toJSON(t).uuid, r.displacementScale = this.displacementScale, r.displacementBias = this.displacementBias), this.roughnessMap && this.roughnessMap.isTexture && (r.roughnessMap = this.roughnessMap.toJSON(t).uuid), this.metalnessMap && this.metalnessMap.isTexture && (r.metalnessMap = this.metalnessMap.toJSON(t).uuid), this.emissiveMap && this.emissiveMap.isTexture && (r.emissiveMap = this.emissiveMap.toJSON(t).uuid), this.specularMap && this.specularMap.isTexture && (r.specularMap = this.specularMap.toJSON(t).uuid), this.specularIntensityMap && this.specularIntensityMap.isTexture && (r.specularIntensityMap = this.specularIntensityMap.toJSON(t).uuid), this.specularColorMap && this.specularColorMap.isTexture && (r.specularColorMap = this.specularColorMap.toJSON(t).uuid), this.envMap && this.envMap.isTexture && (r.envMap = this.envMap.toJSON(t).uuid, this.combine !== void 0 && (r.combine = this.combine)), this.envMapIntensity !== void 0 && (r.envMapIntensity = this.envMapIntensity), this.reflectivity !== void 0 && (r.reflectivity = this.reflectivity), this.refractionRatio !== void 0 && (r.refractionRatio = this.refractionRatio), this.gradientMap && this.gradientMap.isTexture && (r.gradientMap = this.gradientMap.toJSON(t).uuid), this.transmission !== void 0 && (r.transmission = this.transmission), this.transmissionMap && this.transmissionMap.isTexture && (r.transmissionMap = this.transmissionMap.toJSON(t).uuid), this.thickness !== void 0 && (r.thickness = this.thickness), this.thicknessMap && this.thicknessMap.isTexture && (r.thicknessMap = this.thicknessMap.toJSON(t).uuid), this.attenuationDistance !== void 0 && this.attenuationDistance !== 1 / 0 && (r.attenuationDistance = this.attenuationDistance), this.attenuationColor !== void 0 && (r.attenuationColor = this.attenuationColor.getHex()), this.size !== void 0 && (r.size = this.size), this.shadowSide !== null && (r.shadowSide = this.shadowSide), this.sizeAttenuation !== void 0 && (r.sizeAttenuation = this.sizeAttenuation), this.blending !== qa && (r.blending = this.blending), this.side !== jn && (r.side = this.side), this.vertexColors && (r.vertexColors = !0), this.opacity < 1 && (r.opacity = this.opacity), this.transparent === !0 && (r.transparent = this.transparent), r.depthFunc = this.depthFunc, r.depthTest = this.depthTest, r.depthWrite = this.depthWrite, r.colorWrite = this.colorWrite, r.stencilWrite = this.stencilWrite, r.stencilWriteMask = this.stencilWriteMask, r.stencilFunc = this.stencilFunc, r.stencilRef = this.stencilRef, r.stencilFuncMask = this.stencilFuncMask, r.stencilFail = this.stencilFail, r.stencilZFail = this.stencilZFail, r.stencilZPass = this.stencilZPass, this.rotation !== void 0 && this.rotation !== 0 && (r.rotation = this.rotation), this.polygonOffset === !0 && (r.polygonOffset = !0), this.polygonOffsetFactor !== 0 && (r.polygonOffsetFactor = this.polygonOffsetFactor), this.polygonOffsetUnits !== 0 && (r.polygonOffsetUnits = this.polygonOffsetUnits), this.linewidth !== void 0 && this.linewidth !== 1 && (r.linewidth = this.linewidth), this.dashSize !== void 0 && (r.dashSize = this.dashSize), this.gapSize !== void 0 && (r.gapSize = this.gapSize), this.scale !== void 0 && (r.scale = this.scale), this.dithering === !0 && (r.dithering = !0), this.alphaTest > 0 && (r.alphaTest = this.alphaTest), this.alphaToCoverage === !0 && (r.alphaToCoverage = this.alphaToCoverage), this.premultipliedAlpha === !0 && (r.premultipliedAlpha = this.premultipliedAlpha), this.forceSinglePass === !0 && (r.forceSinglePass = this.forceSinglePass), this.wireframe === !0 && (r.wireframe = this.wireframe), this.wireframeLinewidth > 1 && (r.wireframeLinewidth = this.wireframeLinewidth), this.wireframeLinecap !== "round" && (r.wireframeLinecap = this.wireframeLinecap), this.wireframeLinejoin !== "round" && (r.wireframeLinejoin = this.wireframeLinejoin), this.flatShading === !0 && (r.flatShading = this.flatShading), this.visible === !1 && (r.visible = !1), this.toneMapped === !1 && (r.toneMapped = !1), this.fog === !1 && (r.fog = !1), Object.keys(this.userData).length > 0 && (r.userData = this.userData);
        function i(s) {
          var o = [];
          for (var a in s) {
            var l = s[a];
            delete l.metadata, o.push(l);
          }
          return o;
        }
        if (e) {
          var s = i(t.textures),
            o = i(t.images);
          s.length > 0 && (r.textures = s), o.length > 0 && (r.images = o);
        }
        return r;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.name = t.name, this.blending = t.blending, this.side = t.side, this.vertexColors = t.vertexColors, this.opacity = t.opacity, this.transparent = t.transparent, this.blendSrc = t.blendSrc, this.blendDst = t.blendDst, this.blendEquation = t.blendEquation, this.blendSrcAlpha = t.blendSrcAlpha, this.blendDstAlpha = t.blendDstAlpha, this.blendEquationAlpha = t.blendEquationAlpha, this.depthFunc = t.depthFunc, this.depthTest = t.depthTest, this.depthWrite = t.depthWrite, this.stencilWriteMask = t.stencilWriteMask, this.stencilFunc = t.stencilFunc, this.stencilRef = t.stencilRef, this.stencilFuncMask = t.stencilFuncMask, this.stencilFail = t.stencilFail, this.stencilZFail = t.stencilZFail, this.stencilZPass = t.stencilZPass, this.stencilWrite = t.stencilWrite;
        var e = t.clippingPlanes,
          r = null;
        if (e !== null) {
          var i = e.length;
          r = new Array(i);
          for (var s = 0; s !== i; ++s) r[s] = e[s].clone();
        }
        return this.clippingPlanes = r, this.clipIntersection = t.clipIntersection, this.clipShadows = t.clipShadows, this.shadowSide = t.shadowSide, this.colorWrite = t.colorWrite, this.precision = t.precision, this.polygonOffset = t.polygonOffset, this.polygonOffsetFactor = t.polygonOffsetFactor, this.polygonOffsetUnits = t.polygonOffsetUnits, this.dithering = t.dithering, this.alphaTest = t.alphaTest, this.alphaToCoverage = t.alphaToCoverage, this.premultipliedAlpha = t.premultipliedAlpha, this.forceSinglePass = t.forceSinglePass, this.visible = t.visible, this.toneMapped = t.toneMapped, this.userData = JSON.parse(JSON.stringify(t.userData)), this;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }, {
      key: "needsUpdate",
      set: function set(t) {
        t === !0 && this.version++;
      }
    }]);
    return hc;
  }(ir),
  Ls = /*#__PURE__*/function (_hc) {
    _inherits(Ls, _hc);
    var _super8 = _createSuper(Ls);
    function Ls(t) {
      var _this8;
      _classCallCheck(this, Ls);
      _this8 = _super8.call(this), _this8.isMeshBasicMaterial = !0, _this8.type = "MeshBasicMaterial", _this8.color = new Le(16777215), _this8.map = null, _this8.lightMap = null, _this8.lightMapIntensity = 1, _this8.aoMap = null, _this8.aoMapIntensity = 1, _this8.specularMap = null, _this8.alphaMap = null, _this8.envMap = null, _this8.combine = _M, _this8.reflectivity = 1, _this8.refractionRatio = .98, _this8.wireframe = !1, _this8.wireframeLinewidth = 1, _this8.wireframeLinecap = "round", _this8.wireframeLinejoin = "round", _this8.fog = !0, _this8.setValues(t);
      return _this8;
    }
    _createClass(Ls, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(Ls.prototype), "copy", this).call(this, t), this.color.copy(t.color), this.map = t.map, this.lightMap = t.lightMap, this.lightMapIntensity = t.lightMapIntensity, this.aoMap = t.aoMap, this.aoMapIntensity = t.aoMapIntensity, this.specularMap = t.specularMap, this.alphaMap = t.alphaMap, this.envMap = t.envMap, this.combine = t.combine, this.reflectivity = t.reflectivity, this.refractionRatio = t.refractionRatio, this.wireframe = t.wireframe, this.wireframeLinewidth = t.wireframeLinewidth, this.wireframeLinecap = t.wireframeLinecap, this.wireframeLinejoin = t.wireframeLinejoin, this.fog = t.fog, this;
      }
    }]);
    return Ls;
  }(hc),
  si = new _(),
  Og = new N(),
  Ge = /*#__PURE__*/function () {
    function Ge(t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      _classCallCheck(this, Ge);
      if (Array.isArray(t)) throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
      this.isBufferAttribute = !0, this.name = "", this.array = t, this.itemSize = e, this.count = t !== void 0 ? t.length / e : 0, this.normalized = r, this.usage = TS, this.updateRange = {
        offset: 0,
        count: -1
      }, this.version = 0;
    }
    _createClass(Ge, [{
      key: "onUploadCallback",
      value: function onUploadCallback() {}
    }, {
      key: "needsUpdate",
      set: function set(t) {
        t === !0 && this.version++;
      }
    }, {
      key: "setUsage",
      value: function setUsage(t) {
        return this.usage = t, this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.name = t.name, this.array = new t.array.constructor(t.array), this.itemSize = t.itemSize, this.count = t.count, this.normalized = t.normalized, this.usage = t.usage, this;
      }
    }, {
      key: "copyAt",
      value: function copyAt(t, e, r) {
        t *= this.itemSize, r *= e.itemSize;
        for (var i = 0, s = this.itemSize; i < s; i++) this.array[t + i] = e.array[r + i];
        return this;
      }
    }, {
      key: "copyArray",
      value: function copyArray(t) {
        return this.array.set(t), this;
      }
    }, {
      key: "applyMatrix3",
      value: function applyMatrix3(t) {
        if (this.itemSize === 2) for (var e = 0, r = this.count; e < r; e++) Og.fromBufferAttribute(this, e), Og.applyMatrix3(t), this.setXY(e, Og.x, Og.y);else if (this.itemSize === 3) for (var _e3 = 0, _r3 = this.count; _e3 < _r3; _e3++) si.fromBufferAttribute(this, _e3), si.applyMatrix3(t), this.setXYZ(_e3, si.x, si.y, si.z);
        return this;
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        for (var e = 0, r = this.count; e < r; e++) si.fromBufferAttribute(this, e), si.applyMatrix4(t), this.setXYZ(e, si.x, si.y, si.z);
        return this;
      }
    }, {
      key: "applyNormalMatrix",
      value: function applyNormalMatrix(t) {
        for (var e = 0, r = this.count; e < r; e++) si.fromBufferAttribute(this, e), si.applyNormalMatrix(t), this.setXYZ(e, si.x, si.y, si.z);
        return this;
      }
    }, {
      key: "transformDirection",
      value: function transformDirection(t) {
        for (var e = 0, r = this.count; e < r; e++) si.fromBufferAttribute(this, e), si.transformDirection(t), this.setXYZ(e, si.x, si.y, si.z);
        return this;
      }
    }, {
      key: "set",
      value: function set(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this.array.set(t, e), this;
      }
    }, {
      key: "getX",
      value: function getX(t) {
        var e = this.array[t * this.itemSize];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "setX",
      value: function setX(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.array[t * this.itemSize] = e, this;
      }
    }, {
      key: "getY",
      value: function getY(t) {
        var e = this.array[t * this.itemSize + 1];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "setY",
      value: function setY(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.array[t * this.itemSize + 1] = e, this;
      }
    }, {
      key: "getZ",
      value: function getZ(t) {
        var e = this.array[t * this.itemSize + 2];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "setZ",
      value: function setZ(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.array[t * this.itemSize + 2] = e, this;
      }
    }, {
      key: "getW",
      value: function getW(t) {
        var e = this.array[t * this.itemSize + 3];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "setW",
      value: function setW(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.array[t * this.itemSize + 3] = e, this;
      }
    }, {
      key: "setXY",
      value: function setXY(t, e, r) {
        return t *= this.itemSize, this.normalized && (e = ur(e, this.array), r = ur(r, this.array)), this.array[t + 0] = e, this.array[t + 1] = r, this;
      }
    }, {
      key: "setXYZ",
      value: function setXYZ(t, e, r, i) {
        return t *= this.itemSize, this.normalized && (e = ur(e, this.array), r = ur(r, this.array), i = ur(i, this.array)), this.array[t + 0] = e, this.array[t + 1] = r, this.array[t + 2] = i, this;
      }
    }, {
      key: "setXYZW",
      value: function setXYZW(t, e, r, i, s) {
        return t *= this.itemSize, this.normalized && (e = ur(e, this.array), r = ur(r, this.array), i = ur(i, this.array), s = ur(s, this.array)), this.array[t + 0] = e, this.array[t + 1] = r, this.array[t + 2] = i, this.array[t + 3] = s, this;
      }
    }, {
      key: "onUpload",
      value: function onUpload(t) {
        return this.onUploadCallback = t, this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor(this.array, this.itemSize).copy(this);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {
          itemSize: this.itemSize,
          type: this.array.constructor.name,
          array: Array.from(this.array),
          normalized: this.normalized
        };
        return this.name !== "" && (t.name = this.name), this.usage !== TS && (t.usage = this.usage), (this.updateRange.offset !== 0 || this.updateRange.count !== -1) && (t.updateRange = this.updateRange), t;
      }
    }, {
      key: "copyColorsArray",
      value: function copyColorsArray() {
        console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.");
      }
    }, {
      key: "copyVector2sArray",
      value: function copyVector2sArray() {
        console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.");
      }
    }, {
      key: "copyVector3sArray",
      value: function copyVector3sArray() {
        console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.");
      }
    }, {
      key: "copyVector4sArray",
      value: function copyVector4sArray() {
        console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.");
      }
    }]);
    return Ge;
  }();
var oy = /*#__PURE__*/function (_Ge) {
  _inherits(oy, _Ge);
  var _super9 = _createSuper(oy);
  function oy(t, e, r) {
    _classCallCheck(this, oy);
    return _super9.call(this, new Uint16Array(t), e, r);
  }
  return _createClass(oy);
}(Ge);
var co = /*#__PURE__*/function (_Ge2) {
  _inherits(co, _Ge2);
  var _super10 = _createSuper(co);
  function co(t, e, r) {
    _classCallCheck(this, co);
    return _super10.call(this, new Uint32Array(t), e, r);
  }
  return _createClass(co);
}(Ge);
var be = /*#__PURE__*/function (_Ge3) {
  _inherits(be, _Ge3);
  var _super11 = _createSuper(be);
  function be(t, e, r) {
    _classCallCheck(this, be);
    return _super11.call(this, new Float32Array(t), e, r);
  }
  return _createClass(be);
}(Ge);
var tk = 0,
  es = new te(),
  lS = new mt(),
  yu = new _(),
  Gn = new Bt(),
  Xf = new Bt(),
  Oi = new _(),
  we = /*#__PURE__*/function (_ir5) {
    _inherits(we, _ir5);
    var _super12 = _createSuper(we);
    function we() {
      var _this9;
      _classCallCheck(this, we);
      _this9 = _super12.call(this), _this9.isBufferGeometry = !0, Object.defineProperty(_assertThisInitialized(_this9), "id", {
        value: tk++
      }), _this9.uuid = rs(), _this9.name = "", _this9.type = "BufferGeometry", _this9.index = null, _this9.attributes = {}, _this9.morphAttributes = {}, _this9.morphTargetsRelative = !1, _this9.groups = [], _this9.boundingBox = null, _this9.boundingSphere = null, _this9.drawRange = {
        start: 0,
        count: 1 / 0
      }, _this9.userData = {};
      return _this9;
    }
    _createClass(we, [{
      key: "getIndex",
      value: function getIndex() {
        return this.index;
      }
    }, {
      key: "setIndex",
      value: function setIndex(t) {
        return Array.isArray(t) ? this.index = new (PM(t) ? co : oy)(t, 1) : this.index = t, this;
      }
    }, {
      key: "getAttribute",
      value: function getAttribute(t) {
        return this.attributes[t];
      }
    }, {
      key: "setAttribute",
      value: function setAttribute(t, e) {
        return this.attributes[t] = e, this;
      }
    }, {
      key: "deleteAttribute",
      value: function deleteAttribute(t) {
        return delete this.attributes[t], this;
      }
    }, {
      key: "hasAttribute",
      value: function hasAttribute(t) {
        return this.attributes[t] !== void 0;
      }
    }, {
      key: "addGroup",
      value: function addGroup(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        this.groups.push({
          start: t,
          count: e,
          materialIndex: r
        });
      }
    }, {
      key: "clearGroups",
      value: function clearGroups() {
        this.groups = [];
      }
    }, {
      key: "setDrawRange",
      value: function setDrawRange(t, e) {
        this.drawRange.start = t, this.drawRange.count = e;
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        var e = this.attributes.position;
        e !== void 0 && (e.applyMatrix4(t), e.needsUpdate = !0);
        var r = this.attributes.normal;
        if (r !== void 0) {
          var s = new Qt().getNormalMatrix(t);
          r.applyNormalMatrix(s), r.needsUpdate = !0;
        }
        var i = this.attributes.tangent;
        return i !== void 0 && (i.transformDirection(t), i.needsUpdate = !0), this.boundingBox !== null && this.computeBoundingBox(), this.boundingSphere !== null && this.computeBoundingSphere(), this;
      }
    }, {
      key: "applyQuaternion",
      value: function applyQuaternion(t) {
        return es.makeRotationFromQuaternion(t), this.applyMatrix4(es), this;
      }
    }, {
      key: "rotateX",
      value: function rotateX(t) {
        return es.makeRotationX(t), this.applyMatrix4(es), this;
      }
    }, {
      key: "rotateY",
      value: function rotateY(t) {
        return es.makeRotationY(t), this.applyMatrix4(es), this;
      }
    }, {
      key: "rotateZ",
      value: function rotateZ(t) {
        return es.makeRotationZ(t), this.applyMatrix4(es), this;
      }
    }, {
      key: "translate",
      value: function translate(t, e, r) {
        return es.makeTranslation(t, e, r), this.applyMatrix4(es), this;
      }
    }, {
      key: "scale",
      value: function scale(t, e, r) {
        return es.makeScale(t, e, r), this.applyMatrix4(es), this;
      }
    }, {
      key: "lookAt",
      value: function lookAt(t) {
        return lS.lookAt(t), lS.updateMatrix(), this.applyMatrix4(lS.matrix), this;
      }
    }, {
      key: "center",
      value: function center() {
        return this.computeBoundingBox(), this.boundingBox.getCenter(yu).negate(), this.translate(yu.x, yu.y, yu.z), this;
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t) {
        var e = [];
        for (var r = 0, i = t.length; r < i; r++) {
          var s = t[r];
          e.push(s.x, s.y, s.z || 0);
        }
        return this.setAttribute("position", new be(e, 3)), this;
      }
    }, {
      key: "computeBoundingBox",
      value: function computeBoundingBox() {
        this.boundingBox === null && (this.boundingBox = new Bt());
        var t = this.attributes.position,
          e = this.morphAttributes.position;
        if (t && t.isGLBufferAttribute) {
          console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".', this), this.boundingBox.set(new _(-1 / 0, -1 / 0, -1 / 0), new _(1 / 0, 1 / 0, 1 / 0));
          return;
        }
        if (t !== void 0) {
          if (this.boundingBox.setFromBufferAttribute(t), e) for (var r = 0, i = e.length; r < i; r++) {
            var s = e[r];
            Gn.setFromBufferAttribute(s), this.morphTargetsRelative ? (Oi.addVectors(this.boundingBox.min, Gn.min), this.boundingBox.expandByPoint(Oi), Oi.addVectors(this.boundingBox.max, Gn.max), this.boundingBox.expandByPoint(Oi)) : (this.boundingBox.expandByPoint(Gn.min), this.boundingBox.expandByPoint(Gn.max));
          }
        } else this.boundingBox.makeEmpty();
        (isNaN(this.boundingBox.min.x) || isNaN(this.boundingBox.min.y) || isNaN(this.boundingBox.min.z)) && console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.', this);
      }
    }, {
      key: "computeBoundingSphere",
      value: function computeBoundingSphere() {
        this.boundingSphere === null && (this.boundingSphere = new Er());
        var t = this.attributes.position,
          e = this.morphAttributes.position;
        if (t && t.isGLBufferAttribute) {
          console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".', this), this.boundingSphere.set(new _(), 1 / 0);
          return;
        }
        if (t) {
          var r = this.boundingSphere.center;
          if (Gn.setFromBufferAttribute(t), e) for (var s = 0, o = e.length; s < o; s++) {
            var a = e[s];
            Xf.setFromBufferAttribute(a), this.morphTargetsRelative ? (Oi.addVectors(Gn.min, Xf.min), Gn.expandByPoint(Oi), Oi.addVectors(Gn.max, Xf.max), Gn.expandByPoint(Oi)) : (Gn.expandByPoint(Xf.min), Gn.expandByPoint(Xf.max));
          }
          Gn.getCenter(r);
          var i = 0;
          for (var _s4 = 0, _o4 = t.count; _s4 < _o4; _s4++) Oi.fromBufferAttribute(t, _s4), i = Math.max(i, r.distanceToSquared(Oi));
          if (e) for (var _s5 = 0, _o5 = e.length; _s5 < _o5; _s5++) {
            var _a6 = e[_s5],
              l = this.morphTargetsRelative;
            for (var u = 0, c = _a6.count; u < c; u++) Oi.fromBufferAttribute(_a6, u), l && (yu.fromBufferAttribute(t, u), Oi.add(yu)), i = Math.max(i, r.distanceToSquared(Oi));
          }
          this.boundingSphere.radius = Math.sqrt(i), isNaN(this.boundingSphere.radius) && console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.', this);
        }
      }
    }, {
      key: "computeTangents",
      value: function computeTangents() {
        var t = this.index,
          e = this.attributes;
        if (t === null || e.position === void 0 || e.normal === void 0 || e.uv === void 0) {
          console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");
          return;
        }
        var r = t.array,
          i = e.position.array,
          s = e.normal.array,
          o = e.uv.array,
          a = i.length / 3;
        this.hasAttribute("tangent") === !1 && this.setAttribute("tangent", new Ge(new Float32Array(4 * a), 4));
        var l = this.getAttribute("tangent").array,
          u = [],
          c = [];
        for (var M = 0; M < a; M++) u[M] = new _(), c[M] = new _();
        var d = new _(),
          h = new _(),
          f = new _(),
          p = new N(),
          m = new N(),
          g = new N(),
          y = new _(),
          v = new _();
        function x(M, C, P) {
          d.fromArray(i, M * 3), h.fromArray(i, C * 3), f.fromArray(i, P * 3), p.fromArray(o, M * 2), m.fromArray(o, C * 2), g.fromArray(o, P * 2), h.sub(d), f.sub(d), m.sub(p), g.sub(p);
          var D = 1 / (m.x * g.y - g.x * m.y);
          !isFinite(D) || (y.copy(h).multiplyScalar(g.y).addScaledVector(f, -m.y).multiplyScalar(D), v.copy(f).multiplyScalar(m.x).addScaledVector(h, -g.x).multiplyScalar(D), u[M].add(y), u[C].add(y), u[P].add(y), c[M].add(v), c[C].add(v), c[P].add(v));
        }
        var S = this.groups;
        S.length === 0 && (S = [{
          start: 0,
          count: r.length
        }]);
        for (var _M2 = 0, C = S.length; _M2 < C; ++_M2) {
          var P = S[_M2],
            D = P.start,
            O = P.count;
          for (var I = D, z = D + O; I < z; I += 3) x(r[I + 0], r[I + 1], r[I + 2]);
        }
        var w = new _(),
          A = new _(),
          E = new _(),
          b = new _();
        function T(M) {
          E.fromArray(s, M * 3), b.copy(E);
          var C = u[M];
          w.copy(C), w.sub(E.multiplyScalar(E.dot(C))).normalize(), A.crossVectors(b, C);
          var D = A.dot(c[M]) < 0 ? -1 : 1;
          l[M * 4] = w.x, l[M * 4 + 1] = w.y, l[M * 4 + 2] = w.z, l[M * 4 + 3] = D;
        }
        for (var _M3 = 0, _C2 = S.length; _M3 < _C2; ++_M3) {
          var _P2 = S[_M3],
            _D2 = _P2.start,
            _O2 = _P2.count;
          for (var _I2 = _D2, _z2 = _D2 + _O2; _I2 < _z2; _I2 += 3) T(r[_I2 + 0]), T(r[_I2 + 1]), T(r[_I2 + 2]);
        }
      }
    }, {
      key: "computeVertexNormals",
      value: function computeVertexNormals() {
        var t = this.index,
          e = this.getAttribute("position");
        if (e !== void 0) {
          var r = this.getAttribute("normal");
          if (r === void 0) r = new Ge(new Float32Array(e.count * 3), 3), this.setAttribute("normal", r);else for (var h = 0, f = r.count; h < f; h++) r.setXYZ(h, 0, 0, 0);
          var i = new _(),
            s = new _(),
            o = new _(),
            a = new _(),
            l = new _(),
            u = new _(),
            c = new _(),
            d = new _();
          if (t) for (var _h7 = 0, _f10 = t.count; _h7 < _f10; _h7 += 3) {
            var p = t.getX(_h7 + 0),
              m = t.getX(_h7 + 1),
              g = t.getX(_h7 + 2);
            i.fromBufferAttribute(e, p), s.fromBufferAttribute(e, m), o.fromBufferAttribute(e, g), c.subVectors(o, s), d.subVectors(i, s), c.cross(d), a.fromBufferAttribute(r, p), l.fromBufferAttribute(r, m), u.fromBufferAttribute(r, g), a.add(c), l.add(c), u.add(c), r.setXYZ(p, a.x, a.y, a.z), r.setXYZ(m, l.x, l.y, l.z), r.setXYZ(g, u.x, u.y, u.z);
          } else for (var _h8 = 0, _f11 = e.count; _h8 < _f11; _h8 += 3) i.fromBufferAttribute(e, _h8 + 0), s.fromBufferAttribute(e, _h8 + 1), o.fromBufferAttribute(e, _h8 + 2), c.subVectors(o, s), d.subVectors(i, s), c.cross(d), r.setXYZ(_h8 + 0, c.x, c.y, c.z), r.setXYZ(_h8 + 1, c.x, c.y, c.z), r.setXYZ(_h8 + 2, c.x, c.y, c.z);
          this.normalizeNormals(), r.needsUpdate = !0;
        }
      }
    }, {
      key: "merge",
      value: function merge() {
        return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."), this;
      }
    }, {
      key: "normalizeNormals",
      value: function normalizeNormals() {
        var t = this.attributes.normal;
        for (var e = 0, r = t.count; e < r; e++) Oi.fromBufferAttribute(t, e), Oi.normalize(), t.setXYZ(e, Oi.x, Oi.y, Oi.z);
      }
    }, {
      key: "toNonIndexed",
      value: function toNonIndexed() {
        function t(a, l) {
          var u = a.array,
            c = a.itemSize,
            d = a.normalized,
            h = new u.constructor(l.length * c),
            f = 0,
            p = 0;
          for (var m = 0, g = l.length; m < g; m++) {
            a.isInterleavedBufferAttribute ? f = l[m] * a.data.stride + a.offset : f = l[m] * c;
            for (var y = 0; y < c; y++) h[p++] = u[f++];
          }
          return new Ge(h, c, d);
        }
        if (this.index === null) return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."), this;
        var e = new we(),
          r = this.index.array,
          i = this.attributes;
        for (var a in i) {
          var l = i[a],
            u = t(l, r);
          e.setAttribute(a, u);
        }
        var s = this.morphAttributes;
        for (var _a7 in s) {
          var _l5 = [],
            _u5 = s[_a7];
          for (var c = 0, d = _u5.length; c < d; c++) {
            var h = _u5[c],
              f = t(h, r);
            _l5.push(f);
          }
          e.morphAttributes[_a7] = _l5;
        }
        e.morphTargetsRelative = this.morphTargetsRelative;
        var o = this.groups;
        for (var _a8 = 0, _l6 = o.length; _a8 < _l6; _a8++) {
          var _u6 = o[_a8];
          e.addGroup(_u6.start, _u6.count, _u6.materialIndex);
        }
        return e;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {
          metadata: {
            version: 4.5,
            type: "BufferGeometry",
            generator: "BufferGeometry.toJSON"
          }
        };
        if (t.uuid = this.uuid, t.type = this.type, this.name !== "" && (t.name = this.name), Object.keys(this.userData).length > 0 && (t.userData = this.userData), this.parameters !== void 0) {
          var l = this.parameters;
          for (var u in l) l[u] !== void 0 && (t[u] = l[u]);
          return t;
        }
        t.data = {
          attributes: {}
        };
        var e = this.index;
        e !== null && (t.data.index = {
          type: e.array.constructor.name,
          array: Array.prototype.slice.call(e.array)
        });
        var r = this.attributes;
        for (var _l7 in r) {
          var _u7 = r[_l7];
          t.data.attributes[_l7] = _u7.toJSON(t.data);
        }
        var i = {},
          s = !1;
        for (var _l8 in this.morphAttributes) {
          var _u8 = this.morphAttributes[_l8],
            c = [];
          for (var d = 0, h = _u8.length; d < h; d++) {
            var f = _u8[d];
            c.push(f.toJSON(t.data));
          }
          c.length > 0 && (i[_l8] = c, s = !0);
        }
        s && (t.data.morphAttributes = i, t.data.morphTargetsRelative = this.morphTargetsRelative);
        var o = this.groups;
        o.length > 0 && (t.data.groups = JSON.parse(JSON.stringify(o)));
        var a = this.boundingSphere;
        return a !== null && (t.data.boundingSphere = {
          center: a.center.toArray(),
          radius: a.radius
        }), t;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.index = null, this.attributes = {}, this.morphAttributes = {}, this.groups = [], this.boundingBox = null, this.boundingSphere = null;
        var e = {};
        this.name = t.name;
        var r = t.index;
        r !== null && this.setIndex(r.clone(e));
        var i = t.attributes;
        for (var u in i) {
          var c = i[u];
          this.setAttribute(u, c.clone(e));
        }
        var s = t.morphAttributes;
        for (var _u9 in s) {
          var _c4 = [],
            d = s[_u9];
          for (var h = 0, f = d.length; h < f; h++) _c4.push(d[h].clone(e));
          this.morphAttributes[_u9] = _c4;
        }
        this.morphTargetsRelative = t.morphTargetsRelative;
        var o = t.groups;
        for (var _u10 = 0, _c5 = o.length; _u10 < _c5; _u10++) {
          var _d3 = o[_u10];
          this.addGroup(_d3.start, _d3.count, _d3.materialIndex);
        }
        var a = t.boundingBox;
        a !== null && (this.boundingBox = a.clone());
        var l = t.boundingSphere;
        return l !== null && (this.boundingSphere = l.clone()), this.drawRange.start = t.drawRange.start, this.drawRange.count = t.drawRange.count, this.userData = t.userData, t.parameters !== void 0 && (this.parameters = Object.assign({}, t.parameters)), this;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }]);
    return we;
  }(ir),
  OT = new te(),
  vu = new Rs(),
  cS = new Er(),
  Qf = new _(),
  Kf = new _(),
  Zf = new _(),
  uS = new _(),
  Ig = new _(),
  Rg = new N(),
  Lg = new N(),
  Bg = new N(),
  dS = new _(),
  Ng = new _(),
  rr = /*#__PURE__*/function (_mt) {
    _inherits(rr, _mt);
    var _super13 = _createSuper(rr);
    function rr() {
      var _this10;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new we();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new Ls();
      _classCallCheck(this, rr);
      _this10 = _super13.call(this), _this10.isMesh = !0, _this10.type = "Mesh", _this10.geometry = t, _this10.material = e, _this10.updateMorphTargets();
      return _this10;
    }
    _createClass(rr, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(rr.prototype), "copy", this).call(this, t, e), t.morphTargetInfluences !== void 0 && (this.morphTargetInfluences = t.morphTargetInfluences.slice()), t.morphTargetDictionary !== void 0 && (this.morphTargetDictionary = Object.assign({}, t.morphTargetDictionary)), this.material = t.material, this.geometry = t.geometry, this;
      }
    }, {
      key: "updateMorphTargets",
      value: function updateMorphTargets() {
        var e = this.geometry.morphAttributes,
          r = Object.keys(e);
        if (r.length > 0) {
          var i = e[r[0]];
          if (i !== void 0) {
            this.morphTargetInfluences = [], this.morphTargetDictionary = {};
            for (var s = 0, o = i.length; s < o; s++) {
              var a = i[s].name || String(s);
              this.morphTargetInfluences.push(0), this.morphTargetDictionary[a] = s;
            }
          }
        }
      }
    }, {
      key: "getVertexPosition",
      value: function getVertexPosition(t, e) {
        var r = this.geometry,
          i = r.attributes.position,
          s = r.morphAttributes.position,
          o = r.morphTargetsRelative;
        e.fromBufferAttribute(i, t);
        var a = this.morphTargetInfluences;
        if (s && a) {
          Ig.set(0, 0, 0);
          for (var l = 0, u = s.length; l < u; l++) {
            var c = a[l],
              d = s[l];
            c !== 0 && (uS.fromBufferAttribute(d, t), o ? Ig.addScaledVector(uS, c) : Ig.addScaledVector(uS.sub(e), c));
          }
          e.add(Ig);
        }
        return this.isSkinnedMesh && this.boneTransform(t, e), e;
      }
    }, {
      key: "raycast",
      value: function raycast(t, e) {
        var r = this.geometry,
          i = this.material,
          s = this.matrixWorld;
        if (i === void 0 || (r.boundingSphere === null && r.computeBoundingSphere(), cS.copy(r.boundingSphere), cS.applyMatrix4(s), t.ray.intersectsSphere(cS) === !1) || (OT.copy(s).invert(), vu.copy(t.ray).applyMatrix4(OT), r.boundingBox !== null && vu.intersectsBox(r.boundingBox) === !1)) return;
        var o,
          a = r.index,
          l = r.attributes.position,
          u = r.attributes.uv,
          c = r.attributes.uv2,
          d = r.groups,
          h = r.drawRange;
        if (a !== null) {
          if (Array.isArray(i)) for (var f = 0, p = d.length; f < p; f++) {
            var m = d[f],
              g = i[m.materialIndex],
              y = Math.max(m.start, h.start),
              v = Math.min(a.count, Math.min(m.start + m.count, h.start + h.count));
            for (var x = y, S = v; x < S; x += 3) {
              var w = a.getX(x),
                A = a.getX(x + 1),
                E = a.getX(x + 2);
              o = Fg(this, g, t, vu, u, c, w, A, E), o && (o.faceIndex = Math.floor(x / 3), o.face.materialIndex = m.materialIndex, e.push(o));
            }
          } else {
            var _f12 = Math.max(0, h.start),
              _p7 = Math.min(a.count, h.start + h.count);
            for (var _m7 = _f12, _g2 = _p7; _m7 < _g2; _m7 += 3) {
              var _y2 = a.getX(_m7),
                _v2 = a.getX(_m7 + 1),
                _x2 = a.getX(_m7 + 2);
              o = Fg(this, i, t, vu, u, c, _y2, _v2, _x2), o && (o.faceIndex = Math.floor(_m7 / 3), e.push(o));
            }
          }
        } else if (l !== void 0) if (Array.isArray(i)) for (var _f13 = 0, _p8 = d.length; _f13 < _p8; _f13++) {
          var _m8 = d[_f13],
            _g3 = i[_m8.materialIndex],
            _y3 = Math.max(_m8.start, h.start),
            _v3 = Math.min(l.count, Math.min(_m8.start + _m8.count, h.start + h.count));
          for (var _x3 = _y3, _S2 = _v3; _x3 < _S2; _x3 += 3) {
            var _w3 = _x3,
              _A2 = _x3 + 1,
              _E2 = _x3 + 2;
            o = Fg(this, _g3, t, vu, u, c, _w3, _A2, _E2), o && (o.faceIndex = Math.floor(_x3 / 3), o.face.materialIndex = _m8.materialIndex, e.push(o));
          }
        } else {
          var _f14 = Math.max(0, h.start),
            _p9 = Math.min(l.count, h.start + h.count);
          for (var _m9 = _f14, _g4 = _p9; _m9 < _g4; _m9 += 3) {
            var _y4 = _m9,
              _v4 = _m9 + 1,
              _x4 = _m9 + 2;
            o = Fg(this, i, t, vu, u, c, _y4, _v4, _x4), o && (o.faceIndex = Math.floor(_m9 / 3), e.push(o));
          }
        }
      }
    }]);
    return rr;
  }(mt);
function rk(n, t, e, r, i, s, o, a) {
  var l;
  if (t.side === ai ? l = r.intersectTriangle(o, s, i, !0, a) : l = r.intersectTriangle(i, s, o, t.side === jn, a), l === null) return null;
  Ng.copy(a), Ng.applyMatrix4(n.matrixWorld);
  var u = e.ray.origin.distanceTo(Ng);
  return u < e.near || u > e.far ? null : {
    distance: u,
    point: Ng.clone(),
    object: n
  };
}
function Fg(n, t, e, r, i, s, o, a, l) {
  n.getVertexPosition(o, Qf), n.getVertexPosition(a, Kf), n.getVertexPosition(l, Zf);
  var u = rk(n, t, e, r, Qf, Kf, Zf, dS);
  if (u) {
    i && (Rg.fromBufferAttribute(i, o), Lg.fromBufferAttribute(i, a), Bg.fromBufferAttribute(i, l), u.uv = vr.getUV(dS, Qf, Kf, Zf, Rg, Lg, Bg, new N())), s && (Rg.fromBufferAttribute(s, o), Lg.fromBufferAttribute(s, a), Bg.fromBufferAttribute(s, l), u.uv2 = vr.getUV(dS, Qf, Kf, Zf, Rg, Lg, Bg, new N()));
    var c = {
      a: o,
      b: a,
      c: l,
      normal: new _(),
      materialIndex: 0
    };
    vr.getNormal(Qf, Kf, Zf, c.normal), u.face = c;
  }
  return u;
}
var li = /*#__PURE__*/function (_we) {
  _inherits(li, _we);
  var _super14 = _createSuper(li);
  function li() {
    var _this11;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
    var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;
    var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;
    _classCallCheck(this, li);
    _this11 = _super14.call(this), _this11.type = "BoxGeometry", _this11.parameters = {
      width: t,
      height: e,
      depth: r,
      widthSegments: i,
      heightSegments: s,
      depthSegments: o
    };
    var a = _assertThisInitialized(_this11);
    i = Math.floor(i), s = Math.floor(s), o = Math.floor(o);
    var l = [],
      u = [],
      c = [],
      d = [],
      h = 0,
      f = 0;
    p("z", "y", "x", -1, -1, r, e, t, o, s, 0), p("z", "y", "x", 1, -1, r, e, -t, o, s, 1), p("x", "z", "y", 1, 1, t, r, e, i, o, 2), p("x", "z", "y", 1, -1, t, r, -e, i, o, 3), p("x", "y", "z", 1, -1, t, e, r, i, s, 4), p("x", "y", "z", -1, -1, t, e, -r, i, s, 5), _this11.setIndex(l), _this11.setAttribute("position", new be(u, 3)), _this11.setAttribute("normal", new be(c, 3)), _this11.setAttribute("uv", new be(d, 2));
    function p(m, g, y, v, x, S, w, A, E, b, T) {
      var M = S / E,
        C = w / b,
        P = S / 2,
        D = w / 2,
        O = A / 2,
        I = E + 1,
        z = b + 1,
        B = 0,
        V = 0,
        U = new _();
      for (var j = 0; j < z; j++) {
        var W = j * C - D;
        for (var k = 0; k < I; k++) {
          var H = k * M - P;
          U[m] = H * v, U[g] = W * x, U[y] = O, u.push(U.x, U.y, U.z), U[m] = 0, U[g] = 0, U[y] = A > 0 ? 1 : -1, c.push(U.x, U.y, U.z), d.push(k / E), d.push(1 - j / b), B += 1;
        }
      }
      for (var _j2 = 0; _j2 < b; _j2++) for (var _W2 = 0; _W2 < E; _W2++) {
        var _k2 = h + _W2 + I * _j2,
          _H2 = h + _W2 + I * (_j2 + 1),
          X = h + (_W2 + 1) + I * (_j2 + 1),
          q = h + (_W2 + 1) + I * _j2;
        l.push(_k2, _H2, q), l.push(_H2, X, q), V += 6;
      }
      a.addGroup(f, V, T), f += V, h += B;
    }
    return _this11;
  }
  _createClass(li, null, [{
    key: "fromJSON",
    value: function fromJSON(t) {
      return new li(t.width, t.height, t.depth, t.widthSegments, t.heightSegments, t.depthSegments);
    }
  }]);
  return li;
}(we);
function Pu(n) {
  var t = {};
  for (var e in n) {
    t[e] = {};
    for (var r in n[e]) {
      var i = n[e][r];
      i && (i.isColor || i.isMatrix3 || i.isMatrix4 || i.isVector2 || i.isVector3 || i.isVector4 || i.isTexture || i.isQuaternion) ? t[e][r] = i.clone() : Array.isArray(i) ? t[e][r] = i.slice() : t[e][r] = i;
    }
  }
  return t;
}
function un(n) {
  var t = {};
  for (var e = 0; e < n.length; e++) {
    var r = Pu(n[e]);
    for (var i in r) t[i] = r[i];
  }
  return t;
}
function ik(n) {
  var t = [];
  for (var e = 0; e < n.length; e++) t.push(n[e].clone());
  return t;
}
function OM(n) {
  return n.getRenderTarget() === null && n.outputEncoding === tt ? ao : ap;
}
var Ns = {
    clone: Pu,
    merge: un
  },
  nk = "void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
  sk = "void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",
  rt = /*#__PURE__*/function (_hc2) {
    _inherits(rt, _hc2);
    var _super15 = _createSuper(rt);
    function rt(t) {
      var _this12;
      _classCallCheck(this, rt);
      _this12 = _super15.call(this), _this12.isShaderMaterial = !0, _this12.type = "ShaderMaterial", _this12.defines = {}, _this12.uniforms = {}, _this12.uniformsGroups = [], _this12.vertexShader = nk, _this12.fragmentShader = sk, _this12.linewidth = 1, _this12.wireframe = !1, _this12.wireframeLinewidth = 1, _this12.fog = !1, _this12.lights = !1, _this12.clipping = !1, _this12.extensions = {
        derivatives: !1,
        fragDepth: !1,
        drawBuffers: !1,
        shaderTextureLOD: !1
      }, _this12.defaultAttributeValues = {
        color: [1, 1, 1],
        uv: [0, 0],
        uv2: [0, 0]
      }, _this12.index0AttributeName = void 0, _this12.uniformsNeedUpdate = !1, _this12.glslVersion = null, t !== void 0 && _this12.setValues(t);
      return _this12;
    }
    _createClass(rt, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(rt.prototype), "copy", this).call(this, t), this.fragmentShader = t.fragmentShader, this.vertexShader = t.vertexShader, this.uniforms = Pu(t.uniforms), this.uniformsGroups = ik(t.uniformsGroups), this.defines = Object.assign({}, t.defines), this.wireframe = t.wireframe, this.wireframeLinewidth = t.wireframeLinewidth, this.fog = t.fog, this.lights = t.lights, this.clipping = t.clipping, this.extensions = Object.assign({}, t.extensions), this.glslVersion = t.glslVersion, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = _get(_getPrototypeOf(rt.prototype), "toJSON", this).call(this, t);
        e.glslVersion = this.glslVersion, e.uniforms = {};
        for (var i in this.uniforms) {
          var o = this.uniforms[i].value;
          o && o.isTexture ? e.uniforms[i] = {
            type: "t",
            value: o.toJSON(t).uuid
          } : o && o.isColor ? e.uniforms[i] = {
            type: "c",
            value: o.getHex()
          } : o && o.isVector2 ? e.uniforms[i] = {
            type: "v2",
            value: o.toArray()
          } : o && o.isVector3 ? e.uniforms[i] = {
            type: "v3",
            value: o.toArray()
          } : o && o.isVector4 ? e.uniforms[i] = {
            type: "v4",
            value: o.toArray()
          } : o && o.isMatrix3 ? e.uniforms[i] = {
            type: "m3",
            value: o.toArray()
          } : o && o.isMatrix4 ? e.uniforms[i] = {
            type: "m4",
            value: o.toArray()
          } : e.uniforms[i] = {
            value: o
          };
        }
        Object.keys(this.defines).length > 0 && (e.defines = this.defines), e.vertexShader = this.vertexShader, e.fragmentShader = this.fragmentShader;
        var r = {};
        for (var _i2 in this.extensions) this.extensions[_i2] === !0 && (r[_i2] = !0);
        return Object.keys(r).length > 0 && (e.extensions = r), e;
      }
    }]);
    return rt;
  }(hc),
  Hn = /*#__PURE__*/function (_mt2) {
    _inherits(Hn, _mt2);
    var _super16 = _createSuper(Hn);
    function Hn() {
      var _this13;
      _classCallCheck(this, Hn);
      _this13 = _super16.call(this), _this13.isCamera = !0, _this13.type = "Camera", _this13.matrixWorldInverse = new te(), _this13.projectionMatrix = new te(), _this13.projectionMatrixInverse = new te();
      return _this13;
    }
    _createClass(Hn, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(Hn.prototype), "copy", this).call(this, t, e), this.matrixWorldInverse.copy(t.matrixWorldInverse), this.projectionMatrix.copy(t.projectionMatrix), this.projectionMatrixInverse.copy(t.projectionMatrixInverse), this;
      }
    }, {
      key: "getWorldDirection",
      value: function getWorldDirection(t) {
        this.updateWorldMatrix(!0, !1);
        var e = this.matrixWorld.elements;
        return t.set(-e[8], -e[9], -e[10]).normalize();
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(t) {
        _get(_getPrototypeOf(Hn.prototype), "updateMatrixWorld", this).call(this, t), this.matrixWorldInverse.copy(this.matrixWorld).invert();
      }
    }, {
      key: "updateWorldMatrix",
      value: function updateWorldMatrix(t, e) {
        _get(_getPrototypeOf(Hn.prototype), "updateWorldMatrix", this).call(this, t, e), this.matrixWorldInverse.copy(this.matrixWorld).invert();
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return Hn;
  }(mt),
  Wr = /*#__PURE__*/function (_Hn) {
    _inherits(Wr, _Hn);
    var _super17 = _createSuper(Wr);
    function Wr() {
      var _this14;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 50;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : .1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 2e3;
      _classCallCheck(this, Wr);
      _this14 = _super17.call(this), _this14.isPerspectiveCamera = !0, _this14.type = "PerspectiveCamera", _this14.fov = t, _this14.zoom = 1, _this14.near = r, _this14.far = i, _this14.focus = 10, _this14.aspect = e, _this14.view = null, _this14.filmGauge = 35, _this14.filmOffset = 0, _this14.updateProjectionMatrix();
      return _this14;
    }
    _createClass(Wr, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(Wr.prototype), "copy", this).call(this, t, e), this.fov = t.fov, this.zoom = t.zoom, this.near = t.near, this.far = t.far, this.focus = t.focus, this.aspect = t.aspect, this.view = t.view === null ? null : Object.assign({}, t.view), this.filmGauge = t.filmGauge, this.filmOffset = t.filmOffset, this;
      }
    }, {
      key: "setFocalLength",
      value: function setFocalLength(t) {
        var e = .5 * this.getFilmHeight() / t;
        this.fov = lp * 2 * Math.atan(e), this.updateProjectionMatrix();
      }
    }, {
      key: "getFocalLength",
      value: function getFocalLength() {
        var t = Math.tan(rp * .5 * this.fov);
        return .5 * this.getFilmHeight() / t;
      }
    }, {
      key: "getEffectiveFOV",
      value: function getEffectiveFOV() {
        return lp * 2 * Math.atan(Math.tan(rp * .5 * this.fov) / this.zoom);
      }
    }, {
      key: "getFilmWidth",
      value: function getFilmWidth() {
        return this.filmGauge * Math.min(this.aspect, 1);
      }
    }, {
      key: "getFilmHeight",
      value: function getFilmHeight() {
        return this.filmGauge / Math.max(this.aspect, 1);
      }
    }, {
      key: "setViewOffset",
      value: function setViewOffset(t, e, r, i, s, o) {
        this.aspect = t / e, this.view === null && (this.view = {
          enabled: !0,
          fullWidth: 1,
          fullHeight: 1,
          offsetX: 0,
          offsetY: 0,
          width: 1,
          height: 1
        }), this.view.enabled = !0, this.view.fullWidth = t, this.view.fullHeight = e, this.view.offsetX = r, this.view.offsetY = i, this.view.width = s, this.view.height = o, this.updateProjectionMatrix();
      }
    }, {
      key: "clearViewOffset",
      value: function clearViewOffset() {
        this.view !== null && (this.view.enabled = !1), this.updateProjectionMatrix();
      }
    }, {
      key: "updateProjectionMatrix",
      value: function updateProjectionMatrix() {
        var t = this.near,
          e = t * Math.tan(rp * .5 * this.fov) / this.zoom,
          r = 2 * e,
          i = this.aspect * r,
          s = -.5 * i,
          o = this.view;
        if (this.view !== null && this.view.enabled) {
          var l = o.fullWidth,
            u = o.fullHeight;
          s += o.offsetX * i / l, e -= o.offsetY * r / u, i *= o.width / l, r *= o.height / u;
        }
        var a = this.filmOffset;
        a !== 0 && (s += t * a / this.getFilmWidth()), this.projectionMatrix.makePerspective(s, s + i, e, e - r, t, this.far), this.projectionMatrixInverse.copy(this.projectionMatrix).invert();
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = _get(_getPrototypeOf(Wr.prototype), "toJSON", this).call(this, t);
        return e.object.fov = this.fov, e.object.zoom = this.zoom, e.object.near = this.near, e.object.far = this.far, e.object.focus = this.focus, e.object.aspect = this.aspect, this.view !== null && (e.object.view = Object.assign({}, this.view)), e.object.filmGauge = this.filmGauge, e.object.filmOffset = this.filmOffset, e;
      }
    }]);
    return Wr;
  }(Hn),
  xu = -90,
  bu = 1,
  PS = /*#__PURE__*/function (_mt3) {
    _inherits(PS, _mt3);
    var _super18 = _createSuper(PS);
    function PS(t, e, r) {
      var _this15;
      _classCallCheck(this, PS);
      _this15 = _super18.call(this), _this15.type = "CubeCamera", _this15.renderTarget = r;
      var i = new Wr(xu, bu, t, e);
      i.layers = _this15.layers, i.up.set(0, 1, 0), i.lookAt(1, 0, 0), _this15.add(i);
      var s = new Wr(xu, bu, t, e);
      s.layers = _this15.layers, s.up.set(0, 1, 0), s.lookAt(-1, 0, 0), _this15.add(s);
      var o = new Wr(xu, bu, t, e);
      o.layers = _this15.layers, o.up.set(0, 0, -1), o.lookAt(0, 1, 0), _this15.add(o);
      var a = new Wr(xu, bu, t, e);
      a.layers = _this15.layers, a.up.set(0, 0, 1), a.lookAt(0, -1, 0), _this15.add(a);
      var l = new Wr(xu, bu, t, e);
      l.layers = _this15.layers, l.up.set(0, 1, 0), l.lookAt(0, 0, 1), _this15.add(l);
      var u = new Wr(xu, bu, t, e);
      u.layers = _this15.layers, u.up.set(0, 1, 0), u.lookAt(0, 0, -1), _this15.add(u);
      return _this15;
    }
    _createClass(PS, [{
      key: "update",
      value: function update(t, e) {
        this.parent === null && this.updateMatrixWorld();
        var r = this.renderTarget,
          _this$children = _slicedToArray(this.children, 6),
          i = _this$children[0],
          s = _this$children[1],
          o = _this$children[2],
          a = _this$children[3],
          l = _this$children[4],
          u = _this$children[5],
          c = t.getRenderTarget(),
          d = t.toneMapping,
          h = t.xr.enabled;
        t.toneMapping = Os, t.xr.enabled = !1;
        var f = r.texture.generateMipmaps;
        r.texture.generateMipmaps = !1, t.setRenderTarget(r, 0), t.render(e, i), t.setRenderTarget(r, 1), t.render(e, s), t.setRenderTarget(r, 2), t.render(e, o), t.setRenderTarget(r, 3), t.render(e, a), t.setRenderTarget(r, 4), t.render(e, l), r.texture.generateMipmaps = f, t.setRenderTarget(r, 5), t.render(e, u), t.setRenderTarget(c), t.toneMapping = d, t.xr.enabled = h, r.texture.needsPMREMUpdate = !0;
      }
    }]);
    return PS;
  }(mt),
  Du = /*#__PURE__*/function (_qt3) {
    _inherits(Du, _qt3);
    var _super19 = _createSuper(Du);
    function Du(t, e, r, i, s, o, a, l, u, c) {
      var _this16;
      _classCallCheck(this, Du);
      t = t !== void 0 ? t : [], e = e !== void 0 ? e : Xa, _this16 = _super19.call(this, t, e, r, i, s, o, a, l, u, c), _this16.isCubeTexture = !0, _this16.flipY = !1;
      return _this16;
    }
    _createClass(Du, [{
      key: "images",
      get: function get() {
        return this.image;
      },
      set: function set(t) {
        this.image = t;
      }
    }]);
    return Du;
  }(qt),
  DS = /*#__PURE__*/function (_at2) {
    _inherits(DS, _at2);
    var _super20 = _createSuper(DS);
    function DS() {
      var _this17;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      _classCallCheck(this, DS);
      _this17 = _super20.call(this, t, t, e), _this17.isWebGLCubeRenderTarget = !0;
      var r = {
          width: t,
          height: t,
          depth: 1
        },
        i = [r, r, r, r, r, r];
      _this17.texture = new Du(i, e.mapping, e.wrapS, e.wrapT, e.magFilter, e.minFilter, e.format, e.type, e.anisotropy, e.encoding), _this17.texture.isRenderTargetTexture = !0, _this17.texture.generateMipmaps = e.generateMipmaps !== void 0 ? e.generateMipmaps : !1, _this17.texture.minFilter = e.minFilter !== void 0 ? e.minFilter : Qe;
      return _this17;
    }
    _createClass(DS, [{
      key: "fromEquirectangularTexture",
      value: function fromEquirectangularTexture(t, e) {
        this.texture.type = e.type, this.texture.encoding = e.encoding, this.texture.generateMipmaps = e.generateMipmaps, this.texture.minFilter = e.minFilter, this.texture.magFilter = e.magFilter;
        var r = {
            uniforms: {
              tEquirect: {
                value: null
              }
            },
            vertexShader: "\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",
            fragmentShader: "\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"
          },
          i = new li(5, 5, 5),
          s = new rt({
            name: "CubemapFromEquirect",
            uniforms: Pu(r.uniforms),
            vertexShader: r.vertexShader,
            fragmentShader: r.fragmentShader,
            side: ai,
            blending: Wt
          });
        s.uniforms.tEquirect.value = e;
        var o = new rr(i, s),
          a = e.minFilter;
        return e.minFilter === dc && (e.minFilter = Qe), new PS(1, 10, this).update(t, o), e.minFilter = a, o.geometry.dispose(), o.material.dispose(), this;
      }
    }, {
      key: "clear",
      value: function clear(t, e, r, i) {
        var s = t.getRenderTarget();
        for (var o = 0; o < 6; o++) t.setRenderTarget(this, o), t.clear(e, r, i);
        t.setRenderTarget(s);
      }
    }]);
    return DS;
  }(at),
  hS = new _(),
  ok = new _(),
  ak = new Qt(),
  qr = /*#__PURE__*/function () {
    function qr() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _(1, 0, 0);
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      _classCallCheck(this, qr);
      this.isPlane = !0, this.normal = t, this.constant = e;
    }
    _createClass(qr, [{
      key: "set",
      value: function set(t, e) {
        return this.normal.copy(t), this.constant = e, this;
      }
    }, {
      key: "setComponents",
      value: function setComponents(t, e, r, i) {
        return this.normal.set(t, e, r), this.constant = i, this;
      }
    }, {
      key: "setFromNormalAndCoplanarPoint",
      value: function setFromNormalAndCoplanarPoint(t, e) {
        return this.normal.copy(t), this.constant = -e.dot(this.normal), this;
      }
    }, {
      key: "setFromCoplanarPoints",
      value: function setFromCoplanarPoints(t, e, r) {
        var i = hS.subVectors(r, e).cross(ok.subVectors(t, e)).normalize();
        return this.setFromNormalAndCoplanarPoint(i, t), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.normal.copy(t.normal), this.constant = t.constant, this;
      }
    }, {
      key: "normalize",
      value: function normalize() {
        var t = 1 / this.normal.length();
        return this.normal.multiplyScalar(t), this.constant *= t, this;
      }
    }, {
      key: "negate",
      value: function negate() {
        return this.constant *= -1, this.normal.negate(), this;
      }
    }, {
      key: "distanceToPoint",
      value: function distanceToPoint(t) {
        return this.normal.dot(t) + this.constant;
      }
    }, {
      key: "distanceToSphere",
      value: function distanceToSphere(t) {
        return this.distanceToPoint(t.center) - t.radius;
      }
    }, {
      key: "projectPoint",
      value: function projectPoint(t, e) {
        return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t);
      }
    }, {
      key: "intersectLine",
      value: function intersectLine(t, e) {
        var r = t.delta(hS),
          i = this.normal.dot(r);
        if (i === 0) return this.distanceToPoint(t.start) === 0 ? e.copy(t.start) : null;
        var s = -(t.start.dot(this.normal) + this.constant) / i;
        return s < 0 || s > 1 ? null : e.copy(r).multiplyScalar(s).add(t.start);
      }
    }, {
      key: "intersectsLine",
      value: function intersectsLine(t) {
        var e = this.distanceToPoint(t.start),
          r = this.distanceToPoint(t.end);
        return e < 0 && r > 0 || r < 0 && e > 0;
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return t.intersectsPlane(this);
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        return t.intersectsPlane(this);
      }
    }, {
      key: "coplanarPoint",
      value: function coplanarPoint(t) {
        return t.copy(this.normal).multiplyScalar(-this.constant);
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t, e) {
        var r = e || ak.getNormalMatrix(t),
          i = this.coplanarPoint(hS).applyMatrix4(t),
          s = this.normal.applyMatrix3(r).normalize();
        return this.constant = -i.dot(s), this;
      }
    }, {
      key: "translate",
      value: function translate(t) {
        return this.constant -= t.dot(this.normal), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.normal.equals(this.normal) && t.constant === this.constant;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return qr;
  }(),
  Su = new Er(),
  kg = new _(),
  dp = /*#__PURE__*/function () {
    function dp() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new qr();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new qr();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new qr();
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new qr();
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : new qr();
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : new qr();
      _classCallCheck(this, dp);
      this.planes = [t, e, r, i, s, o];
    }
    _createClass(dp, [{
      key: "set",
      value: function set(t, e, r, i, s, o) {
        var a = this.planes;
        return a[0].copy(t), a[1].copy(e), a[2].copy(r), a[3].copy(i), a[4].copy(s), a[5].copy(o), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        var e = this.planes;
        for (var r = 0; r < 6; r++) e[r].copy(t.planes[r]);
        return this;
      }
    }, {
      key: "setFromProjectionMatrix",
      value: function setFromProjectionMatrix(t) {
        var e = this.planes,
          r = t.elements,
          i = r[0],
          s = r[1],
          o = r[2],
          a = r[3],
          l = r[4],
          u = r[5],
          c = r[6],
          d = r[7],
          h = r[8],
          f = r[9],
          p = r[10],
          m = r[11],
          g = r[12],
          y = r[13],
          v = r[14],
          x = r[15];
        return e[0].setComponents(a - i, d - l, m - h, x - g).normalize(), e[1].setComponents(a + i, d + l, m + h, x + g).normalize(), e[2].setComponents(a + s, d + u, m + f, x + y).normalize(), e[3].setComponents(a - s, d - u, m - f, x - y).normalize(), e[4].setComponents(a - o, d - c, m - p, x - v).normalize(), e[5].setComponents(a + o, d + c, m + p, x + v).normalize(), this;
      }
    }, {
      key: "intersectsObject",
      value: function intersectsObject(t) {
        var e = t.geometry;
        return e.boundingSphere === null && e.computeBoundingSphere(), Su.copy(e.boundingSphere).applyMatrix4(t.matrixWorld), this.intersectsSphere(Su);
      }
    }, {
      key: "intersectsSprite",
      value: function intersectsSprite(t) {
        return Su.center.set(0, 0, 0), Su.radius = .7071067811865476, Su.applyMatrix4(t.matrixWorld), this.intersectsSphere(Su);
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        var e = this.planes,
          r = t.center,
          i = -t.radius;
        for (var s = 0; s < 6; s++) if (e[s].distanceToPoint(r) < i) return !1;
        return !0;
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        var e = this.planes;
        for (var r = 0; r < 6; r++) {
          var i = e[r];
          if (kg.x = i.normal.x > 0 ? t.max.x : t.min.x, kg.y = i.normal.y > 0 ? t.max.y : t.min.y, kg.z = i.normal.z > 0 ? t.max.z : t.min.z, i.distanceToPoint(kg) < 0) return !1;
        }
        return !0;
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        var e = this.planes;
        for (var r = 0; r < 6; r++) if (e[r].distanceToPoint(t) < 0) return !1;
        return !0;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return dp;
  }();
function IM() {
  var n = null,
    t = !1,
    e = null,
    r = null;
  function i(s, o) {
    e(s, o), r = n.requestAnimationFrame(i);
  }
  return {
    start: function start() {
      t !== !0 && e !== null && (r = n.requestAnimationFrame(i), t = !0);
    },
    stop: function stop() {
      n.cancelAnimationFrame(r), t = !1;
    },
    setAnimationLoop: function setAnimationLoop(s) {
      e = s;
    },
    setContext: function setContext(s) {
      n = s;
    }
  };
}
function lk(n, t) {
  var e = t.isWebGL2,
    r = new WeakMap();
  function i(u, c) {
    var d = u.array,
      h = u.usage,
      f = n.createBuffer();
    n.bindBuffer(c, f), n.bufferData(c, d, h), u.onUploadCallback();
    var p;
    if (d instanceof Float32Array) p = 5126;else if (d instanceof Uint16Array) {
      if (u.isFloat16BufferAttribute) {
        if (e) p = 5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");
      } else p = 5123;
    } else if (d instanceof Int16Array) p = 5122;else if (d instanceof Uint32Array) p = 5125;else if (d instanceof Int32Array) p = 5124;else if (d instanceof Int8Array) p = 5120;else if (d instanceof Uint8Array) p = 5121;else if (d instanceof Uint8ClampedArray) p = 5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: " + d);
    return {
      buffer: f,
      type: p,
      bytesPerElement: d.BYTES_PER_ELEMENT,
      version: u.version
    };
  }
  function s(u, c, d) {
    var h = c.array,
      f = c.updateRange;
    n.bindBuffer(d, u), f.count === -1 ? n.bufferSubData(d, 0, h) : (e ? n.bufferSubData(d, f.offset * h.BYTES_PER_ELEMENT, h, f.offset, f.count) : n.bufferSubData(d, f.offset * h.BYTES_PER_ELEMENT, h.subarray(f.offset, f.offset + f.count)), f.count = -1), c.onUploadCallback();
  }
  function o(u) {
    return u.isInterleavedBufferAttribute && (u = u.data), r.get(u);
  }
  function a(u) {
    u.isInterleavedBufferAttribute && (u = u.data);
    var c = r.get(u);
    c && (n.deleteBuffer(c.buffer), r.delete(u));
  }
  function l(u, c) {
    if (u.isGLBufferAttribute) {
      var h = r.get(u);
      (!h || h.version < u.version) && r.set(u, {
        buffer: u.buffer,
        type: u.type,
        bytesPerElement: u.elementSize,
        version: u.version
      });
      return;
    }
    u.isInterleavedBufferAttribute && (u = u.data);
    var d = r.get(u);
    d === void 0 ? r.set(u, i(u, c)) : d.version < u.version && (s(d.buffer, u, c), d.version = u.version);
  }
  return {
    get: o,
    remove: a,
    update: l
  };
}
var hn = /*#__PURE__*/function (_we2) {
    _inherits(hn, _we2);
    var _super21 = _createSuper(hn);
    function hn() {
      var _this18;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, hn);
      _this18 = _super21.call(this), _this18.type = "PlaneGeometry", _this18.parameters = {
        width: t,
        height: e,
        widthSegments: r,
        heightSegments: i
      };
      var s = t / 2,
        o = e / 2,
        a = Math.floor(r),
        l = Math.floor(i),
        u = a + 1,
        c = l + 1,
        d = t / a,
        h = e / l,
        f = [],
        p = [],
        m = [],
        g = [];
      for (var y = 0; y < c; y++) {
        var v = y * h - o;
        for (var x = 0; x < u; x++) {
          var S = x * d - s;
          p.push(S, -v, 0), m.push(0, 0, 1), g.push(x / a), g.push(1 - y / l);
        }
      }
      for (var _y5 = 0; _y5 < l; _y5++) for (var _v5 = 0; _v5 < a; _v5++) {
        var _x5 = _v5 + u * _y5,
          _S3 = _v5 + u * (_y5 + 1),
          w = _v5 + 1 + u * (_y5 + 1),
          A = _v5 + 1 + u * _y5;
        f.push(_x5, _S3, A), f.push(_S3, w, A);
      }
      _this18.setIndex(f), _this18.setAttribute("position", new be(p, 3)), _this18.setAttribute("normal", new be(m, 3)), _this18.setAttribute("uv", new be(g, 2));
      return _this18;
    }
    _createClass(hn, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new hn(t.width, t.height, t.widthSegments, t.heightSegments);
      }
    }]);
    return hn;
  }(we),
  ck = "#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",
  uk = "#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",
  dk = "#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",
  hk = "#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",
  fk = "#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",
  pk = "#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",
  mk = "vec3 transformed = vec3( position );",
  gk = "vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",
  yk = "vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",
  vk = "#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",
  xk = "#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",
  bk = "#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",
  Sk = "#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",
  wk = "#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",
  Ak = "#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",
  _k = "#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",
  Ek = "#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",
  Tk = "#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",
  Mk = "#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",
  Ck = "#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",
  Pk = "#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",
  Dk = "vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",
  Ok = "#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",
  Ik = "#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",
  Rk = "#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",
  Lk = "#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",
  Bk = "gl_FragColor = linearToOutputTexel( gl_FragColor );",
  Nk = "vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",
  Fk = "#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",
  kk = "#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",
  zk = "#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",
  Vk = "#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",
  Uk = "#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",
  Gk = "#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",
  jk = "#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",
  Hk = "#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",
  Wk = "#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
  qk = "#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",
  Yk = "#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",
  Xk = "#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",
  Qk = "LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",
  Kk = "varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",
  Zk = "uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",
  Jk = "#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",
  $k = "ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",
  ez = "varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",
  tz = "BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",
  rz = "varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",
  iz = "PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",
  nz = "struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",
  sz = "\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",
  oz = "#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",
  az = "#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",
  lz = "#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",
  cz = "#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",
  uz = "#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",
  dz = "#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",
  hz = "#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",
  fz = "#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",
  pz = "#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",
  mz = "#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",
  gz = "float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",
  yz = "#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",
  vz = "#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",
  xz = "#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",
  bz = "#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",
  Sz = "#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",
  wz = "float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",
  Az = "#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",
  _z = "#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",
  Ez = "#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",
  Tz = "#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",
  Mz = "#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",
  Cz = "#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",
  Pz = "#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",
  Dz = "#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",
  Oz = "#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",
  Iz = "#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",
  Rz = "vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",
  Lz = "#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",
  Bz = "vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",
  Nz = "#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",
  Fz = "#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",
  kz = "float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",
  zz = "#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",
  Vz = "#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",
  Uz = "#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",
  Gz = "#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",
  jz = "float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",
  Hz = "#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",
  Wz = "#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",
  qz = "#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",
  Yz = "#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",
  Xz = "float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",
  Qz = "#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",
  Kz = "#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",
  Zz = "#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",
  Jz = "#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",
  $z = "#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",
  eV = "#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",
  tV = "#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",
  rV = "#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",
  iV = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",
  nV = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",
  sV = "#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",
  oV = "#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",
  aV = "varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",
  lV = "uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",
  cV = "varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",
  uV = "#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",
  dV = "varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",
  hV = "uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",
  fV = "#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",
  pV = "#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",
  mV = "#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",
  gV = "#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",
  yV = "varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",
  vV = "uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",
  xV = "uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",
  bV = "uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
  SV = "#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",
  wV = "uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  AV = "#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
  _V = "#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  EV = "#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",
  TV = "#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  MV = "#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",
  CV = "#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",
  PV = "#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
  DV = "#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  OV = "#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",
  IV = "#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  RV = "#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
  LV = "#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",
  BV = "uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",
  NV = "uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",
  FV = "#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",
  kV = "uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",
  zV = "uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",
  VV = "uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",
  ht = {
    alphamap_fragment: ck,
    alphamap_pars_fragment: uk,
    alphatest_fragment: dk,
    alphatest_pars_fragment: hk,
    aomap_fragment: fk,
    aomap_pars_fragment: pk,
    begin_vertex: mk,
    beginnormal_vertex: gk,
    bsdfs: yk,
    iridescence_fragment: vk,
    bumpmap_pars_fragment: xk,
    clipping_planes_fragment: bk,
    clipping_planes_pars_fragment: Sk,
    clipping_planes_pars_vertex: wk,
    clipping_planes_vertex: Ak,
    color_fragment: _k,
    color_pars_fragment: Ek,
    color_pars_vertex: Tk,
    color_vertex: Mk,
    common: Ck,
    cube_uv_reflection_fragment: Pk,
    defaultnormal_vertex: Dk,
    displacementmap_pars_vertex: Ok,
    displacementmap_vertex: Ik,
    emissivemap_fragment: Rk,
    emissivemap_pars_fragment: Lk,
    encodings_fragment: Bk,
    encodings_pars_fragment: Nk,
    envmap_fragment: Fk,
    envmap_common_pars_fragment: kk,
    envmap_pars_fragment: zk,
    envmap_pars_vertex: Vk,
    envmap_physical_pars_fragment: Jk,
    envmap_vertex: Uk,
    fog_vertex: Gk,
    fog_pars_vertex: jk,
    fog_fragment: Hk,
    fog_pars_fragment: Wk,
    gradientmap_pars_fragment: qk,
    lightmap_fragment: Yk,
    lightmap_pars_fragment: Xk,
    lights_lambert_fragment: Qk,
    lights_lambert_pars_fragment: Kk,
    lights_pars_begin: Zk,
    lights_toon_fragment: $k,
    lights_toon_pars_fragment: ez,
    lights_phong_fragment: tz,
    lights_phong_pars_fragment: rz,
    lights_physical_fragment: iz,
    lights_physical_pars_fragment: nz,
    lights_fragment_begin: sz,
    lights_fragment_maps: oz,
    lights_fragment_end: az,
    logdepthbuf_fragment: lz,
    logdepthbuf_pars_fragment: cz,
    logdepthbuf_pars_vertex: uz,
    logdepthbuf_vertex: dz,
    map_fragment: hz,
    map_pars_fragment: fz,
    map_particle_fragment: pz,
    map_particle_pars_fragment: mz,
    metalnessmap_fragment: gz,
    metalnessmap_pars_fragment: yz,
    morphcolor_vertex: vz,
    morphnormal_vertex: xz,
    morphtarget_pars_vertex: bz,
    morphtarget_vertex: Sz,
    normal_fragment_begin: wz,
    normal_fragment_maps: Az,
    normal_pars_fragment: _z,
    normal_pars_vertex: Ez,
    normal_vertex: Tz,
    normalmap_pars_fragment: Mz,
    clearcoat_normal_fragment_begin: Cz,
    clearcoat_normal_fragment_maps: Pz,
    clearcoat_pars_fragment: Dz,
    iridescence_pars_fragment: Oz,
    output_fragment: Iz,
    packing: Rz,
    premultiplied_alpha_fragment: Lz,
    project_vertex: Bz,
    dithering_fragment: Nz,
    dithering_pars_fragment: Fz,
    roughnessmap_fragment: kz,
    roughnessmap_pars_fragment: zz,
    shadowmap_pars_fragment: Vz,
    shadowmap_pars_vertex: Uz,
    shadowmap_vertex: Gz,
    shadowmask_pars_fragment: jz,
    skinbase_vertex: Hz,
    skinning_pars_vertex: Wz,
    skinning_vertex: qz,
    skinnormal_vertex: Yz,
    specularmap_fragment: Xz,
    specularmap_pars_fragment: Qz,
    tonemapping_fragment: Kz,
    tonemapping_pars_fragment: Zz,
    transmission_fragment: Jz,
    transmission_pars_fragment: $z,
    uv_pars_fragment: eV,
    uv_pars_vertex: tV,
    uv_vertex: rV,
    uv2_pars_fragment: iV,
    uv2_pars_vertex: nV,
    uv2_vertex: sV,
    worldpos_vertex: oV,
    background_vert: aV,
    background_frag: lV,
    backgroundCube_vert: cV,
    backgroundCube_frag: uV,
    cube_vert: dV,
    cube_frag: hV,
    depth_vert: fV,
    depth_frag: pV,
    distanceRGBA_vert: mV,
    distanceRGBA_frag: gV,
    equirect_vert: yV,
    equirect_frag: vV,
    linedashed_vert: xV,
    linedashed_frag: bV,
    meshbasic_vert: SV,
    meshbasic_frag: wV,
    meshlambert_vert: AV,
    meshlambert_frag: _V,
    meshmatcap_vert: EV,
    meshmatcap_frag: TV,
    meshnormal_vert: MV,
    meshnormal_frag: CV,
    meshphong_vert: PV,
    meshphong_frag: DV,
    meshphysical_vert: OV,
    meshphysical_frag: IV,
    meshtoon_vert: RV,
    meshtoon_frag: LV,
    points_vert: BV,
    points_frag: NV,
    shadow_vert: FV,
    shadow_frag: kV,
    sprite_vert: zV,
    sprite_frag: VV
  },
  Ae = {
    common: {
      diffuse: {
        value: new Le(16777215)
      },
      opacity: {
        value: 1
      },
      map: {
        value: null
      },
      uvTransform: {
        value: new Qt()
      },
      uv2Transform: {
        value: new Qt()
      },
      alphaMap: {
        value: null
      },
      alphaTest: {
        value: 0
      }
    },
    specularmap: {
      specularMap: {
        value: null
      }
    },
    envmap: {
      envMap: {
        value: null
      },
      flipEnvMap: {
        value: -1
      },
      reflectivity: {
        value: 1
      },
      ior: {
        value: 1.5
      },
      refractionRatio: {
        value: .98
      }
    },
    aomap: {
      aoMap: {
        value: null
      },
      aoMapIntensity: {
        value: 1
      }
    },
    lightmap: {
      lightMap: {
        value: null
      },
      lightMapIntensity: {
        value: 1
      }
    },
    emissivemap: {
      emissiveMap: {
        value: null
      }
    },
    bumpmap: {
      bumpMap: {
        value: null
      },
      bumpScale: {
        value: 1
      }
    },
    normalmap: {
      normalMap: {
        value: null
      },
      normalScale: {
        value: new N(1, 1)
      }
    },
    displacementmap: {
      displacementMap: {
        value: null
      },
      displacementScale: {
        value: 1
      },
      displacementBias: {
        value: 0
      }
    },
    roughnessmap: {
      roughnessMap: {
        value: null
      }
    },
    metalnessmap: {
      metalnessMap: {
        value: null
      }
    },
    gradientmap: {
      gradientMap: {
        value: null
      }
    },
    fog: {
      fogDensity: {
        value: 25e-5
      },
      fogNear: {
        value: 1
      },
      fogFar: {
        value: 2e3
      },
      fogColor: {
        value: new Le(16777215)
      }
    },
    lights: {
      ambientLightColor: {
        value: []
      },
      lightProbe: {
        value: []
      },
      directionalLights: {
        value: [],
        properties: {
          direction: {},
          color: {}
        }
      },
      directionalLightShadows: {
        value: [],
        properties: {
          shadowBias: {},
          shadowNormalBias: {},
          shadowRadius: {},
          shadowMapSize: {}
        }
      },
      directionalShadowMap: {
        value: []
      },
      directionalShadowMatrix: {
        value: []
      },
      spotLights: {
        value: [],
        properties: {
          color: {},
          position: {},
          direction: {},
          distance: {},
          coneCos: {},
          penumbraCos: {},
          decay: {}
        }
      },
      spotLightShadows: {
        value: [],
        properties: {
          shadowBias: {},
          shadowNormalBias: {},
          shadowRadius: {},
          shadowMapSize: {}
        }
      },
      spotLightMap: {
        value: []
      },
      spotShadowMap: {
        value: []
      },
      spotLightMatrix: {
        value: []
      },
      pointLights: {
        value: [],
        properties: {
          color: {},
          position: {},
          decay: {},
          distance: {}
        }
      },
      pointLightShadows: {
        value: [],
        properties: {
          shadowBias: {},
          shadowNormalBias: {},
          shadowRadius: {},
          shadowMapSize: {},
          shadowCameraNear: {},
          shadowCameraFar: {}
        }
      },
      pointShadowMap: {
        value: []
      },
      pointShadowMatrix: {
        value: []
      },
      hemisphereLights: {
        value: [],
        properties: {
          direction: {},
          skyColor: {},
          groundColor: {}
        }
      },
      rectAreaLights: {
        value: [],
        properties: {
          color: {},
          position: {},
          width: {},
          height: {}
        }
      },
      ltc_1: {
        value: null
      },
      ltc_2: {
        value: null
      }
    },
    points: {
      diffuse: {
        value: new Le(16777215)
      },
      opacity: {
        value: 1
      },
      size: {
        value: 1
      },
      scale: {
        value: 1
      },
      map: {
        value: null
      },
      alphaMap: {
        value: null
      },
      alphaTest: {
        value: 0
      },
      uvTransform: {
        value: new Qt()
      }
    },
    sprite: {
      diffuse: {
        value: new Le(16777215)
      },
      opacity: {
        value: 1
      },
      center: {
        value: new N(.5, .5)
      },
      rotation: {
        value: 0
      },
      map: {
        value: null
      },
      alphaMap: {
        value: null
      },
      alphaTest: {
        value: 0
      },
      uvTransform: {
        value: new Qt()
      }
    }
  },
  lo = {
    basic: {
      uniforms: un([Ae.common, Ae.specularmap, Ae.envmap, Ae.aomap, Ae.lightmap, Ae.fog]),
      vertexShader: ht.meshbasic_vert,
      fragmentShader: ht.meshbasic_frag
    },
    lambert: {
      uniforms: un([Ae.common, Ae.specularmap, Ae.envmap, Ae.aomap, Ae.lightmap, Ae.emissivemap, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, Ae.fog, Ae.lights, {
        emissive: {
          value: new Le(0)
        }
      }]),
      vertexShader: ht.meshlambert_vert,
      fragmentShader: ht.meshlambert_frag
    },
    phong: {
      uniforms: un([Ae.common, Ae.specularmap, Ae.envmap, Ae.aomap, Ae.lightmap, Ae.emissivemap, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, Ae.fog, Ae.lights, {
        emissive: {
          value: new Le(0)
        },
        specular: {
          value: new Le(1118481)
        },
        shininess: {
          value: 30
        }
      }]),
      vertexShader: ht.meshphong_vert,
      fragmentShader: ht.meshphong_frag
    },
    standard: {
      uniforms: un([Ae.common, Ae.envmap, Ae.aomap, Ae.lightmap, Ae.emissivemap, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, Ae.roughnessmap, Ae.metalnessmap, Ae.fog, Ae.lights, {
        emissive: {
          value: new Le(0)
        },
        roughness: {
          value: 1
        },
        metalness: {
          value: 0
        },
        envMapIntensity: {
          value: 1
        }
      }]),
      vertexShader: ht.meshphysical_vert,
      fragmentShader: ht.meshphysical_frag
    },
    toon: {
      uniforms: un([Ae.common, Ae.aomap, Ae.lightmap, Ae.emissivemap, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, Ae.gradientmap, Ae.fog, Ae.lights, {
        emissive: {
          value: new Le(0)
        }
      }]),
      vertexShader: ht.meshtoon_vert,
      fragmentShader: ht.meshtoon_frag
    },
    matcap: {
      uniforms: un([Ae.common, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, Ae.fog, {
        matcap: {
          value: null
        }
      }]),
      vertexShader: ht.meshmatcap_vert,
      fragmentShader: ht.meshmatcap_frag
    },
    points: {
      uniforms: un([Ae.points, Ae.fog]),
      vertexShader: ht.points_vert,
      fragmentShader: ht.points_frag
    },
    dashed: {
      uniforms: un([Ae.common, Ae.fog, {
        scale: {
          value: 1
        },
        dashSize: {
          value: 1
        },
        totalSize: {
          value: 2
        }
      }]),
      vertexShader: ht.linedashed_vert,
      fragmentShader: ht.linedashed_frag
    },
    depth: {
      uniforms: un([Ae.common, Ae.displacementmap]),
      vertexShader: ht.depth_vert,
      fragmentShader: ht.depth_frag
    },
    normal: {
      uniforms: un([Ae.common, Ae.bumpmap, Ae.normalmap, Ae.displacementmap, {
        opacity: {
          value: 1
        }
      }]),
      vertexShader: ht.meshnormal_vert,
      fragmentShader: ht.meshnormal_frag
    },
    sprite: {
      uniforms: un([Ae.sprite, Ae.fog]),
      vertexShader: ht.sprite_vert,
      fragmentShader: ht.sprite_frag
    },
    background: {
      uniforms: {
        uvTransform: {
          value: new Qt()
        },
        t2D: {
          value: null
        },
        backgroundIntensity: {
          value: 1
        }
      },
      vertexShader: ht.background_vert,
      fragmentShader: ht.background_frag
    },
    backgroundCube: {
      uniforms: {
        envMap: {
          value: null
        },
        flipEnvMap: {
          value: -1
        },
        backgroundBlurriness: {
          value: 0
        },
        backgroundIntensity: {
          value: 1
        }
      },
      vertexShader: ht.backgroundCube_vert,
      fragmentShader: ht.backgroundCube_frag
    },
    cube: {
      uniforms: {
        tCube: {
          value: null
        },
        tFlip: {
          value: -1
        },
        opacity: {
          value: 1
        }
      },
      vertexShader: ht.cube_vert,
      fragmentShader: ht.cube_frag
    },
    equirect: {
      uniforms: {
        tEquirect: {
          value: null
        }
      },
      vertexShader: ht.equirect_vert,
      fragmentShader: ht.equirect_frag
    },
    distanceRGBA: {
      uniforms: un([Ae.common, Ae.displacementmap, {
        referencePosition: {
          value: new _()
        },
        nearDistance: {
          value: 1
        },
        farDistance: {
          value: 1e3
        }
      }]),
      vertexShader: ht.distanceRGBA_vert,
      fragmentShader: ht.distanceRGBA_frag
    },
    shadow: {
      uniforms: un([Ae.lights, Ae.fog, {
        color: {
          value: new Le(0)
        },
        opacity: {
          value: 1
        }
      }]),
      vertexShader: ht.shadow_vert,
      fragmentShader: ht.shadow_frag
    }
  };
lo.physical = {
  uniforms: un([lo.standard.uniforms, {
    clearcoat: {
      value: 0
    },
    clearcoatMap: {
      value: null
    },
    clearcoatRoughness: {
      value: 0
    },
    clearcoatRoughnessMap: {
      value: null
    },
    clearcoatNormalScale: {
      value: new N(1, 1)
    },
    clearcoatNormalMap: {
      value: null
    },
    iridescence: {
      value: 0
    },
    iridescenceMap: {
      value: null
    },
    iridescenceIOR: {
      value: 1.3
    },
    iridescenceThicknessMinimum: {
      value: 100
    },
    iridescenceThicknessMaximum: {
      value: 400
    },
    iridescenceThicknessMap: {
      value: null
    },
    sheen: {
      value: 0
    },
    sheenColor: {
      value: new Le(0)
    },
    sheenColorMap: {
      value: null
    },
    sheenRoughness: {
      value: 1
    },
    sheenRoughnessMap: {
      value: null
    },
    transmission: {
      value: 0
    },
    transmissionMap: {
      value: null
    },
    transmissionSamplerSize: {
      value: new N()
    },
    transmissionSamplerMap: {
      value: null
    },
    thickness: {
      value: 0
    },
    thicknessMap: {
      value: null
    },
    attenuationDistance: {
      value: 0
    },
    attenuationColor: {
      value: new Le(0)
    },
    specularIntensity: {
      value: 1
    },
    specularIntensityMap: {
      value: null
    },
    specularColor: {
      value: new Le(1, 1, 1)
    },
    specularColorMap: {
      value: null
    }
  }]),
  vertexShader: ht.meshphysical_vert,
  fragmentShader: ht.meshphysical_frag
};
var zg = {
  r: 0,
  b: 0,
  g: 0
};
function UV(n, t, e, r, i, s, o) {
  var a = new Le(0),
    l = s === !0 ? 0 : 1,
    u,
    c,
    d = null,
    h = 0,
    f = null;
  function p(g, y) {
    var v = !1,
      x = y.isScene === !0 ? y.background : null;
    x && x.isTexture && (x = (y.backgroundBlurriness > 0 ? e : t).get(x));
    var S = n.xr,
      w = S.getSession && S.getSession();
    w && w.environmentBlendMode === "additive" && (x = null), x === null ? m(a, l) : x && x.isColor && (m(x, 1), v = !0), (n.autoClear || v) && n.clear(n.autoClearColor, n.autoClearDepth, n.autoClearStencil), x && (x.isCubeTexture || x.mapping === Qu) ? (c === void 0 && (c = new rr(new li(1, 1, 1), new rt({
      name: "BackgroundCubeMaterial",
      uniforms: Pu(lo.backgroundCube.uniforms),
      vertexShader: lo.backgroundCube.vertexShader,
      fragmentShader: lo.backgroundCube.fragmentShader,
      side: ai,
      depthTest: !1,
      depthWrite: !1,
      fog: !1
    })), c.geometry.deleteAttribute("normal"), c.geometry.deleteAttribute("uv"), c.onBeforeRender = function (A, E, b) {
      this.matrixWorld.copyPosition(b.matrixWorld);
    }, Object.defineProperty(c.material, "envMap", {
      get: function get() {
        return this.uniforms.envMap.value;
      }
    }), i.update(c)), c.material.uniforms.envMap.value = x, c.material.uniforms.flipEnvMap.value = x.isCubeTexture && x.isRenderTargetTexture === !1 ? -1 : 1, c.material.uniforms.backgroundBlurriness.value = y.backgroundBlurriness, c.material.uniforms.backgroundIntensity.value = y.backgroundIntensity, c.material.toneMapped = x.encoding !== tt, (d !== x || h !== x.version || f !== n.toneMapping) && (c.material.needsUpdate = !0, d = x, h = x.version, f = n.toneMapping), c.layers.enableAll(), g.unshift(c, c.geometry, c.material, 0, 0, null)) : x && x.isTexture && (u === void 0 && (u = new rr(new hn(2, 2), new rt({
      name: "BackgroundMaterial",
      uniforms: Pu(lo.background.uniforms),
      vertexShader: lo.background.vertexShader,
      fragmentShader: lo.background.fragmentShader,
      side: jn,
      depthTest: !1,
      depthWrite: !1,
      fog: !1
    })), u.geometry.deleteAttribute("normal"), Object.defineProperty(u.material, "map", {
      get: function get() {
        return this.uniforms.t2D.value;
      }
    }), i.update(u)), u.material.uniforms.t2D.value = x, u.material.uniforms.backgroundIntensity.value = y.backgroundIntensity, u.material.toneMapped = x.encoding !== tt, x.matrixAutoUpdate === !0 && x.updateMatrix(), u.material.uniforms.uvTransform.value.copy(x.matrix), (d !== x || h !== x.version || f !== n.toneMapping) && (u.material.needsUpdate = !0, d = x, h = x.version, f = n.toneMapping), u.layers.enableAll(), g.unshift(u, u.geometry, u.material, 0, 0, null));
  }
  function m(g, y) {
    g.getRGB(zg, OM(n)), r.buffers.color.setClear(zg.r, zg.g, zg.b, y, o);
  }
  return {
    getClearColor: function getClearColor() {
      return a;
    },
    setClearColor: function setClearColor(g) {
      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      a.set(g), l = y, m(a, l);
    },
    getClearAlpha: function getClearAlpha() {
      return l;
    },
    setClearAlpha: function setClearAlpha(g) {
      l = g, m(a, l);
    },
    render: p
  };
}
function GV(n, t, e, r) {
  var i = n.getParameter(34921),
    s = r.isWebGL2 ? null : t.get("OES_vertex_array_object"),
    o = r.isWebGL2 || s !== null,
    a = {},
    l = g(null),
    u = l,
    c = !1;
  function d(O, I, z, B, V) {
    var U = !1;
    if (o) {
      var j = m(B, z, I);
      u !== j && (u = j, f(u.object)), U = y(O, B, z, V), U && v(O, B, z, V);
    } else {
      var _j3 = I.wireframe === !0;
      (u.geometry !== B.id || u.program !== z.id || u.wireframe !== _j3) && (u.geometry = B.id, u.program = z.id, u.wireframe = _j3, U = !0);
    }
    V !== null && e.update(V, 34963), (U || c) && (c = !1, b(O, I, z, B), V !== null && n.bindBuffer(34963, e.get(V).buffer));
  }
  function h() {
    return r.isWebGL2 ? n.createVertexArray() : s.createVertexArrayOES();
  }
  function f(O) {
    return r.isWebGL2 ? n.bindVertexArray(O) : s.bindVertexArrayOES(O);
  }
  function p(O) {
    return r.isWebGL2 ? n.deleteVertexArray(O) : s.deleteVertexArrayOES(O);
  }
  function m(O, I, z) {
    var B = z.wireframe === !0,
      V = a[O.id];
    V === void 0 && (V = {}, a[O.id] = V);
    var U = V[I.id];
    U === void 0 && (U = {}, V[I.id] = U);
    var j = U[B];
    return j === void 0 && (j = g(h()), U[B] = j), j;
  }
  function g(O) {
    var I = [],
      z = [],
      B = [];
    for (var V = 0; V < i; V++) I[V] = 0, z[V] = 0, B[V] = 0;
    return {
      geometry: null,
      program: null,
      wireframe: !1,
      newAttributes: I,
      enabledAttributes: z,
      attributeDivisors: B,
      object: O,
      attributes: {},
      index: null
    };
  }
  function y(O, I, z, B) {
    var V = u.attributes,
      U = I.attributes,
      j = 0,
      W = z.getAttributes();
    for (var k in W) if (W[k].location >= 0) {
      var X = V[k],
        q = U[k];
      if (q === void 0 && (k === "instanceMatrix" && O.instanceMatrix && (q = O.instanceMatrix), k === "instanceColor" && O.instanceColor && (q = O.instanceColor)), X === void 0 || X.attribute !== q || q && X.data !== q.data) return !0;
      j++;
    }
    return u.attributesNum !== j || u.index !== B;
  }
  function v(O, I, z, B) {
    var V = {},
      U = I.attributes,
      j = 0,
      W = z.getAttributes();
    for (var k in W) if (W[k].location >= 0) {
      var X = U[k];
      X === void 0 && (k === "instanceMatrix" && O.instanceMatrix && (X = O.instanceMatrix), k === "instanceColor" && O.instanceColor && (X = O.instanceColor));
      var q = {};
      q.attribute = X, X && X.data && (q.data = X.data), V[k] = q, j++;
    }
    u.attributes = V, u.attributesNum = j, u.index = B;
  }
  function x() {
    var O = u.newAttributes;
    for (var I = 0, z = O.length; I < z; I++) O[I] = 0;
  }
  function S(O) {
    w(O, 0);
  }
  function w(O, I) {
    var z = u.newAttributes,
      B = u.enabledAttributes,
      V = u.attributeDivisors;
    z[O] = 1, B[O] === 0 && (n.enableVertexAttribArray(O), B[O] = 1), V[O] !== I && ((r.isWebGL2 ? n : t.get("ANGLE_instanced_arrays"))[r.isWebGL2 ? "vertexAttribDivisor" : "vertexAttribDivisorANGLE"](O, I), V[O] = I);
  }
  function A() {
    var O = u.newAttributes,
      I = u.enabledAttributes;
    for (var z = 0, B = I.length; z < B; z++) I[z] !== O[z] && (n.disableVertexAttribArray(z), I[z] = 0);
  }
  function E(O, I, z, B, V, U) {
    r.isWebGL2 === !0 && (z === 5124 || z === 5125) ? n.vertexAttribIPointer(O, I, z, V, U) : n.vertexAttribPointer(O, I, z, B, V, U);
  }
  function b(O, I, z, B) {
    if (r.isWebGL2 === !1 && (O.isInstancedMesh || B.isInstancedBufferGeometry) && t.get("ANGLE_instanced_arrays") === null) return;
    x();
    var V = B.attributes,
      U = z.getAttributes(),
      j = I.defaultAttributeValues;
    for (var W in U) {
      var k = U[W];
      if (k.location >= 0) {
        var H = V[W];
        if (H === void 0 && (W === "instanceMatrix" && O.instanceMatrix && (H = O.instanceMatrix), W === "instanceColor" && O.instanceColor && (H = O.instanceColor)), H !== void 0) {
          var X = H.normalized,
            q = H.itemSize,
            G = e.get(H);
          if (G === void 0) continue;
          var J = G.buffer,
            Z = G.type,
            K = G.bytesPerElement;
          if (H.isInterleavedBufferAttribute) {
            var Y = H.data,
              ye = Y.stride,
              fe = H.offset;
            if (Y.isInstancedInterleavedBuffer) {
              for (var oe = 0; oe < k.locationSize; oe++) w(k.location + oe, Y.meshPerAttribute);
              O.isInstancedMesh !== !0 && B._maxInstanceCount === void 0 && (B._maxInstanceCount = Y.meshPerAttribute * Y.count);
            } else for (var _oe = 0; _oe < k.locationSize; _oe++) S(k.location + _oe);
            n.bindBuffer(34962, J);
            for (var _oe2 = 0; _oe2 < k.locationSize; _oe2++) E(k.location + _oe2, q / k.locationSize, Z, X, ye * K, (fe + q / k.locationSize * _oe2) * K);
          } else {
            if (H.isInstancedBufferAttribute) {
              for (var _Y2 = 0; _Y2 < k.locationSize; _Y2++) w(k.location + _Y2, H.meshPerAttribute);
              O.isInstancedMesh !== !0 && B._maxInstanceCount === void 0 && (B._maxInstanceCount = H.meshPerAttribute * H.count);
            } else for (var _Y3 = 0; _Y3 < k.locationSize; _Y3++) S(k.location + _Y3);
            n.bindBuffer(34962, J);
            for (var _Y4 = 0; _Y4 < k.locationSize; _Y4++) E(k.location + _Y4, q / k.locationSize, Z, X, q * K, q / k.locationSize * _Y4 * K);
          }
        } else if (j !== void 0) {
          var _X2 = j[W];
          if (_X2 !== void 0) switch (_X2.length) {
            case 2:
              n.vertexAttrib2fv(k.location, _X2);
              break;
            case 3:
              n.vertexAttrib3fv(k.location, _X2);
              break;
            case 4:
              n.vertexAttrib4fv(k.location, _X2);
              break;
            default:
              n.vertexAttrib1fv(k.location, _X2);
          }
        }
      }
    }
    A();
  }
  function T() {
    P();
    for (var O in a) {
      var I = a[O];
      for (var z in I) {
        var B = I[z];
        for (var V in B) p(B[V].object), delete B[V];
        delete I[z];
      }
      delete a[O];
    }
  }
  function M(O) {
    if (a[O.id] === void 0) return;
    var I = a[O.id];
    for (var z in I) {
      var B = I[z];
      for (var V in B) p(B[V].object), delete B[V];
      delete I[z];
    }
    delete a[O.id];
  }
  function C(O) {
    for (var I in a) {
      var z = a[I];
      if (z[O.id] === void 0) continue;
      var B = z[O.id];
      for (var V in B) p(B[V].object), delete B[V];
      delete z[O.id];
    }
  }
  function P() {
    D(), c = !0, u !== l && (u = l, f(u.object));
  }
  function D() {
    l.geometry = null, l.program = null, l.wireframe = !1;
  }
  return {
    setup: d,
    reset: P,
    resetDefaultState: D,
    dispose: T,
    releaseStatesOfGeometry: M,
    releaseStatesOfProgram: C,
    initAttributes: x,
    enableAttribute: S,
    disableUnusedAttributes: A
  };
}
function jV(n, t, e, r) {
  var i = r.isWebGL2,
    s;
  function o(u) {
    s = u;
  }
  function a(u, c) {
    n.drawArrays(s, u, c), e.update(c, s, 1);
  }
  function l(u, c, d) {
    if (d === 0) return;
    var h, f;
    if (i) h = n, f = "drawArraysInstanced";else if (h = t.get("ANGLE_instanced_arrays"), f = "drawArraysInstancedANGLE", h === null) {
      console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      return;
    }
    h[f](s, u, c, d), e.update(c, s, d);
  }
  this.setMode = o, this.render = a, this.renderInstances = l;
}
function HV(n, t, e) {
  var r;
  function i() {
    if (r !== void 0) return r;
    if (t.has("EXT_texture_filter_anisotropic") === !0) {
      var E = t.get("EXT_texture_filter_anisotropic");
      r = n.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT);
    } else r = 0;
    return r;
  }
  function s(E) {
    if (E === "highp") {
      if (n.getShaderPrecisionFormat(35633, 36338).precision > 0 && n.getShaderPrecisionFormat(35632, 36338).precision > 0) return "highp";
      E = "mediump";
    }
    return E === "mediump" && n.getShaderPrecisionFormat(35633, 36337).precision > 0 && n.getShaderPrecisionFormat(35632, 36337).precision > 0 ? "mediump" : "lowp";
  }
  var o = (typeof WebGL2RenderingContext === "undefined" ? "undefined" : _typeof(WebGL2RenderingContext)) < "u" && n instanceof WebGL2RenderingContext,
    a = e.precision !== void 0 ? e.precision : "highp",
    l = s(a);
  l !== a && (console.warn("THREE.WebGLRenderer:", a, "not supported, using", l, "instead."), a = l);
  var u = o || t.has("WEBGL_draw_buffers"),
    c = e.logarithmicDepthBuffer === !0,
    d = n.getParameter(34930),
    h = n.getParameter(35660),
    f = n.getParameter(3379),
    p = n.getParameter(34076),
    m = n.getParameter(34921),
    g = n.getParameter(36347),
    y = n.getParameter(36348),
    v = n.getParameter(36349),
    x = h > 0,
    S = o || t.has("OES_texture_float"),
    w = x && S,
    A = o ? n.getParameter(36183) : 0;
  return {
    isWebGL2: o,
    drawBuffers: u,
    getMaxAnisotropy: i,
    getMaxPrecision: s,
    precision: a,
    logarithmicDepthBuffer: c,
    maxTextures: d,
    maxVertexTextures: h,
    maxTextureSize: f,
    maxCubemapSize: p,
    maxAttributes: m,
    maxVertexUniforms: g,
    maxVaryings: y,
    maxFragmentUniforms: v,
    vertexTextures: x,
    floatFragmentTextures: S,
    floatVertexTextures: w,
    maxSamples: A
  };
}
function WV(n) {
  var t = this,
    e = null,
    r = 0,
    i = !1,
    s = !1,
    o = new qr(),
    a = new Qt(),
    l = {
      value: null,
      needsUpdate: !1
    };
  this.uniform = l, this.numPlanes = 0, this.numIntersection = 0, this.init = function (d, h) {
    var f = d.length !== 0 || h || r !== 0 || i;
    return i = h, r = d.length, f;
  }, this.beginShadows = function () {
    s = !0, c(null);
  }, this.endShadows = function () {
    s = !1;
  }, this.setGlobalState = function (d, h) {
    e = c(d, h, 0);
  }, this.setState = function (d, h, f) {
    var p = d.clippingPlanes,
      m = d.clipIntersection,
      g = d.clipShadows,
      y = n.get(d);
    if (!i || p === null || p.length === 0 || s && !g) s ? c(null) : u();else {
      var v = s ? 0 : r,
        x = v * 4,
        S = y.clippingState || null;
      l.value = S, S = c(p, h, x, f);
      for (var w = 0; w !== x; ++w) S[w] = e[w];
      y.clippingState = S, this.numIntersection = m ? this.numPlanes : 0, this.numPlanes += v;
    }
  };
  function u() {
    l.value !== e && (l.value = e, l.needsUpdate = r > 0), t.numPlanes = r, t.numIntersection = 0;
  }
  function c(d, h, f, p) {
    var m = d !== null ? d.length : 0,
      g = null;
    if (m !== 0) {
      if (g = l.value, p !== !0 || g === null) {
        var y = f + m * 4,
          v = h.matrixWorldInverse;
        a.getNormalMatrix(v), (g === null || g.length < y) && (g = new Float32Array(y));
        for (var x = 0, S = f; x !== m; ++x, S += 4) o.copy(d[x]).applyMatrix4(v, a), o.normal.toArray(g, S), g[S + 3] = o.constant;
      }
      l.value = g, l.needsUpdate = !0;
    }
    return t.numPlanes = m, t.numIntersection = 0, g;
  }
}
function qV(n) {
  var t = new WeakMap();
  function e(o, a) {
    return a === AS ? o.mapping = Xa : a === _S && (o.mapping = Qa), o;
  }
  function r(o) {
    if (o && o.isTexture && o.isRenderTargetTexture === !1) {
      var a = o.mapping;
      if (a === AS || a === _S) if (t.has(o)) {
        var l = t.get(o).texture;
        return e(l, o.mapping);
      } else {
        var _l9 = o.image;
        if (_l9 && _l9.height > 0) {
          var u = new DS(_l9.height / 2);
          return u.fromEquirectangularTexture(n, o), t.set(o, u), o.addEventListener("dispose", i), e(u.texture, o.mapping);
        } else return null;
      }
    }
    return o;
  }
  function i(o) {
    var a = o.target;
    a.removeEventListener("dispose", i);
    var l = t.get(a);
    l !== void 0 && (t.delete(a), l.dispose());
  }
  function s() {
    t = new WeakMap();
  }
  return {
    get: r,
    dispose: s
  };
}
var Ou = /*#__PURE__*/function (_Hn2) {
    _inherits(Ou, _Hn2);
    var _super22 = _createSuper(Ou);
    function Ou() {
      var _this19;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : -1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : -1;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : .1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 2e3;
      _classCallCheck(this, Ou);
      _this19 = _super22.call(this), _this19.isOrthographicCamera = !0, _this19.type = "OrthographicCamera", _this19.zoom = 1, _this19.view = null, _this19.left = t, _this19.right = e, _this19.top = r, _this19.bottom = i, _this19.near = s, _this19.far = o, _this19.updateProjectionMatrix();
      return _this19;
    }
    _createClass(Ou, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(Ou.prototype), "copy", this).call(this, t, e), this.left = t.left, this.right = t.right, this.top = t.top, this.bottom = t.bottom, this.near = t.near, this.far = t.far, this.zoom = t.zoom, this.view = t.view === null ? null : Object.assign({}, t.view), this;
      }
    }, {
      key: "setViewOffset",
      value: function setViewOffset(t, e, r, i, s, o) {
        this.view === null && (this.view = {
          enabled: !0,
          fullWidth: 1,
          fullHeight: 1,
          offsetX: 0,
          offsetY: 0,
          width: 1,
          height: 1
        }), this.view.enabled = !0, this.view.fullWidth = t, this.view.fullHeight = e, this.view.offsetX = r, this.view.offsetY = i, this.view.width = s, this.view.height = o, this.updateProjectionMatrix();
      }
    }, {
      key: "clearViewOffset",
      value: function clearViewOffset() {
        this.view !== null && (this.view.enabled = !1), this.updateProjectionMatrix();
      }
    }, {
      key: "updateProjectionMatrix",
      value: function updateProjectionMatrix() {
        var t = (this.right - this.left) / (2 * this.zoom),
          e = (this.top - this.bottom) / (2 * this.zoom),
          r = (this.right + this.left) / 2,
          i = (this.top + this.bottom) / 2,
          s = r - t,
          o = r + t,
          a = i + e,
          l = i - e;
        if (this.view !== null && this.view.enabled) {
          var u = (this.right - this.left) / this.view.fullWidth / this.zoom,
            c = (this.top - this.bottom) / this.view.fullHeight / this.zoom;
          s += u * this.view.offsetX, o = s + u * this.view.width, a -= c * this.view.offsetY, l = a - c * this.view.height;
        }
        this.projectionMatrix.makeOrthographic(s, o, a, l, this.near, this.far), this.projectionMatrixInverse.copy(this.projectionMatrix).invert();
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = _get(_getPrototypeOf(Ou.prototype), "toJSON", this).call(this, t);
        return e.object.zoom = this.zoom, e.object.left = this.left, e.object.right = this.right, e.object.top = this.top, e.object.bottom = this.bottom, e.object.near = this.near, e.object.far = this.far, this.view !== null && (e.object.view = Object.assign({}, this.view)), e;
      }
    }]);
    return Ou;
  }(Hn),
  Tu = 4,
  IT = [.125, .215, .35, .446, .526, .582],
  lc = 20,
  fS = new Ou(),
  RT = new Le(),
  pS = null,
  ac = (1 + Math.sqrt(5)) / 2,
  wu = 1 / ac,
  LT = [new _(1, 1, 1), new _(-1, 1, 1), new _(1, 1, -1), new _(-1, 1, -1), new _(0, ac, wu), new _(0, ac, -wu), new _(wu, 0, ac), new _(-wu, 0, ac), new _(ac, wu, 0), new _(-ac, wu, 0)],
  ay = /*#__PURE__*/function () {
    function ay(t) {
      _classCallCheck(this, ay);
      this._renderer = t, this._pingPongRenderTarget = null, this._lodMax = 0, this._cubeSize = 0, this._lodPlanes = [], this._sizeLods = [], this._sigmas = [], this._blurMaterial = null, this._cubemapMaterial = null, this._equirectMaterial = null, this._compileMaterial(this._blurMaterial);
    }
    _createClass(ay, [{
      key: "fromScene",
      value: function fromScene(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : .1;
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 100;
        pS = this._renderer.getRenderTarget(), this._setSize(256);
        var s = this._allocateTargets();
        return s.depthBuffer = !0, this._sceneToCubeUV(t, r, i, s), e > 0 && this._blur(s, 0, 0, e), this._applyPMREM(s), this._cleanup(s), s;
      }
    }, {
      key: "fromEquirectangular",
      value: function fromEquirectangular(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
        return this._fromTexture(t, e);
      }
    }, {
      key: "fromCubemap",
      value: function fromCubemap(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
        return this._fromTexture(t, e);
      }
    }, {
      key: "compileCubemapShader",
      value: function compileCubemapShader() {
        this._cubemapMaterial === null && (this._cubemapMaterial = FT(), this._compileMaterial(this._cubemapMaterial));
      }
    }, {
      key: "compileEquirectangularShader",
      value: function compileEquirectangularShader() {
        this._equirectMaterial === null && (this._equirectMaterial = NT(), this._compileMaterial(this._equirectMaterial));
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this._dispose(), this._cubemapMaterial !== null && this._cubemapMaterial.dispose(), this._equirectMaterial !== null && this._equirectMaterial.dispose();
      }
    }, {
      key: "_setSize",
      value: function _setSize(t) {
        this._lodMax = Math.floor(Math.log2(t)), this._cubeSize = Math.pow(2, this._lodMax);
      }
    }, {
      key: "_dispose",
      value: function _dispose() {
        this._blurMaterial !== null && this._blurMaterial.dispose(), this._pingPongRenderTarget !== null && this._pingPongRenderTarget.dispose();
        for (var t = 0; t < this._lodPlanes.length; t++) this._lodPlanes[t].dispose();
      }
    }, {
      key: "_cleanup",
      value: function _cleanup(t) {
        this._renderer.setRenderTarget(pS), t.scissorTest = !1, Vg(t, 0, 0, t.width, t.height);
      }
    }, {
      key: "_fromTexture",
      value: function _fromTexture(t, e) {
        t.mapping === Xa || t.mapping === Qa ? this._setSize(t.image.length === 0 ? 16 : t.image[0].width || t.image[0].image.width) : this._setSize(t.image.width / 4), pS = this._renderer.getRenderTarget();
        var r = e || this._allocateTargets();
        return this._textureToCubeUV(t, r), this._applyPMREM(r), this._cleanup(r), r;
      }
    }, {
      key: "_allocateTargets",
      value: function _allocateTargets() {
        var t = 3 * Math.max(this._cubeSize, 112),
          e = 4 * this._cubeSize,
          r = {
            magFilter: Qe,
            minFilter: Qe,
            generateMipmaps: !1,
            type: sa,
            format: Fr,
            encoding: dn,
            depthBuffer: !1
          },
          i = BT(t, e, r);
        if (this._pingPongRenderTarget === null || this._pingPongRenderTarget.width !== t || this._pingPongRenderTarget.height !== e) {
          var _YV;
          this._pingPongRenderTarget !== null && this._dispose(), this._pingPongRenderTarget = BT(t, e, r);
          var s = this._lodMax;
          (_YV = YV(s), this._sizeLods = _YV.sizeLods, this._lodPlanes = _YV.lodPlanes, this._sigmas = _YV.sigmas), this._blurMaterial = XV(s, t, e);
        }
        return i;
      }
    }, {
      key: "_compileMaterial",
      value: function _compileMaterial(t) {
        var e = new rr(this._lodPlanes[0], t);
        this._renderer.compile(e, fS);
      }
    }, {
      key: "_sceneToCubeUV",
      value: function _sceneToCubeUV(t, e, r, i) {
        var a = new Wr(90, 1, e, r),
          l = [1, -1, 1, 1, 1, 1],
          u = [1, 1, 1, -1, -1, -1],
          c = this._renderer,
          d = c.autoClear,
          h = c.toneMapping;
        c.getClearColor(RT), c.toneMapping = Os, c.autoClear = !1;
        var f = new Ls({
            name: "PMREM.Background",
            side: ai,
            depthWrite: !1,
            depthTest: !1
          }),
          p = new rr(new li(), f),
          m = !1,
          g = t.background;
        g ? g.isColor && (f.color.copy(g), t.background = null, m = !0) : (f.color.copy(RT), m = !0);
        for (var y = 0; y < 6; y++) {
          var v = y % 3;
          v === 0 ? (a.up.set(0, l[y], 0), a.lookAt(u[y], 0, 0)) : v === 1 ? (a.up.set(0, 0, l[y]), a.lookAt(0, u[y], 0)) : (a.up.set(0, l[y], 0), a.lookAt(0, 0, u[y]));
          var x = this._cubeSize;
          Vg(i, v * x, y > 2 ? x : 0, x, x), c.setRenderTarget(i), m && c.render(p, a), c.render(t, a);
        }
        p.geometry.dispose(), p.material.dispose(), c.toneMapping = h, c.autoClear = d, t.background = g;
      }
    }, {
      key: "_textureToCubeUV",
      value: function _textureToCubeUV(t, e) {
        var r = this._renderer,
          i = t.mapping === Xa || t.mapping === Qa;
        i ? (this._cubemapMaterial === null && (this._cubemapMaterial = FT()), this._cubemapMaterial.uniforms.flipEnvMap.value = t.isRenderTargetTexture === !1 ? -1 : 1) : this._equirectMaterial === null && (this._equirectMaterial = NT());
        var s = i ? this._cubemapMaterial : this._equirectMaterial,
          o = new rr(this._lodPlanes[0], s),
          a = s.uniforms;
        a.envMap.value = t;
        var l = this._cubeSize;
        Vg(e, 0, 0, 3 * l, 2 * l), r.setRenderTarget(e), r.render(o, fS);
      }
    }, {
      key: "_applyPMREM",
      value: function _applyPMREM(t) {
        var e = this._renderer,
          r = e.autoClear;
        e.autoClear = !1;
        for (var i = 1; i < this._lodPlanes.length; i++) {
          var s = Math.sqrt(this._sigmas[i] * this._sigmas[i] - this._sigmas[i - 1] * this._sigmas[i - 1]),
            o = LT[(i - 1) % LT.length];
          this._blur(t, i - 1, i, s, o);
        }
        e.autoClear = r;
      }
    }, {
      key: "_blur",
      value: function _blur(t, e, r, i, s) {
        var o = this._pingPongRenderTarget;
        this._halfBlur(t, o, e, r, i, "latitudinal", s), this._halfBlur(o, t, r, r, i, "longitudinal", s);
      }
    }, {
      key: "_halfBlur",
      value: function _halfBlur(t, e, r, i, s, o, a) {
        var l = this._renderer,
          u = this._blurMaterial;
        o !== "latitudinal" && o !== "longitudinal" && console.error("blur direction must be either latitudinal or longitudinal!");
        var c = 3,
          d = new rr(this._lodPlanes[i], u),
          h = u.uniforms,
          f = this._sizeLods[r] - 1,
          p = isFinite(s) ? Math.PI / (2 * f) : 2 * Math.PI / (2 * lc - 1),
          m = s / p,
          g = isFinite(s) ? 1 + Math.floor(c * m) : lc;
        g > lc && console.warn("sigmaRadians, ".concat(s, ", is too large and will clip, as it requested ").concat(g, " samples when the maximum is set to ").concat(lc));
        var y = [],
          v = 0;
        for (var E = 0; E < lc; ++E) {
          var b = E / m,
            T = Math.exp(-b * b / 2);
          y.push(T), E === 0 ? v += T : E < g && (v += 2 * T);
        }
        for (var _E3 = 0; _E3 < y.length; _E3++) y[_E3] = y[_E3] / v;
        h.envMap.value = t.texture, h.samples.value = g, h.weights.value = y, h.latitudinal.value = o === "latitudinal", a && (h.poleAxis.value = a);
        var x = this._lodMax;
        h.dTheta.value = p, h.mipInt.value = x - r;
        var S = this._sizeLods[i],
          w = 3 * S * (i > x - Tu ? i - x + Tu : 0),
          A = 4 * (this._cubeSize - S);
        Vg(e, w, A, 3 * S, 2 * S), l.setRenderTarget(e), l.render(d, fS);
      }
    }]);
    return ay;
  }();
function YV(n) {
  var t = [],
    e = [],
    r = [],
    i = n,
    s = n - Tu + 1 + IT.length;
  for (var o = 0; o < s; o++) {
    var a = Math.pow(2, i);
    e.push(a);
    var l = 1 / a;
    o > n - Tu ? l = IT[o - n + Tu - 1] : o === 0 && (l = 0), r.push(l);
    var u = 1 / (a - 2),
      c = -u,
      d = 1 + u,
      h = [c, c, d, c, d, d, c, c, d, d, c, d],
      f = 6,
      p = 6,
      m = 3,
      g = 2,
      y = 1,
      v = new Float32Array(m * p * f),
      x = new Float32Array(g * p * f),
      S = new Float32Array(y * p * f);
    for (var A = 0; A < f; A++) {
      var E = A % 3 * 2 / 3 - 1,
        b = A > 2 ? 0 : -1,
        T = [E, b, 0, E + 2 / 3, b, 0, E + 2 / 3, b + 1, 0, E, b, 0, E + 2 / 3, b + 1, 0, E, b + 1, 0];
      v.set(T, m * p * A), x.set(h, g * p * A);
      var M = [A, A, A, A, A, A];
      S.set(M, y * p * A);
    }
    var w = new we();
    w.setAttribute("position", new Ge(v, m)), w.setAttribute("uv", new Ge(x, g)), w.setAttribute("faceIndex", new Ge(S, y)), t.push(w), i > Tu && i--;
  }
  return {
    lodPlanes: t,
    sizeLods: e,
    sigmas: r
  };
}
function BT(n, t, e) {
  var r = new at(n, t, e);
  return r.texture.mapping = Qu, r.texture.name = "PMREM.cubeUv", r.scissorTest = !0, r;
}
function Vg(n, t, e, r, i) {
  n.viewport.set(t, e, r, i), n.scissor.set(t, e, r, i);
}
function XV(n, t, e) {
  var r = new Float32Array(lc),
    i = new _(0, 1, 0);
  return new rt({
    name: "SphericalGaussianBlur",
    defines: {
      n: lc,
      CUBEUV_TEXEL_WIDTH: 1 / t,
      CUBEUV_TEXEL_HEIGHT: 1 / e,
      CUBEUV_MAX_MIP: "".concat(n, ".0")
    },
    uniforms: {
      envMap: {
        value: null
      },
      samples: {
        value: 1
      },
      weights: {
        value: r
      },
      latitudinal: {
        value: !1
      },
      dTheta: {
        value: 0
      },
      mipInt: {
        value: 0
      },
      poleAxis: {
        value: i
      }
    },
    vertexShader: uw(),
    fragmentShader: "\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",
    blending: Wt,
    depthTest: !1,
    depthWrite: !1
  });
}
function NT() {
  return new rt({
    name: "EquirectangularToCubeUV",
    uniforms: {
      envMap: {
        value: null
      }
    },
    vertexShader: uw(),
    fragmentShader: "\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",
    blending: Wt,
    depthTest: !1,
    depthWrite: !1
  });
}
function FT() {
  return new rt({
    name: "CubemapToCubeUV",
    uniforms: {
      envMap: {
        value: null
      },
      flipEnvMap: {
        value: -1
      }
    },
    vertexShader: uw(),
    fragmentShader: "\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",
    blending: Wt,
    depthTest: !1,
    depthWrite: !1
  });
}
function uw() {
  return "\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t";
}
function QV(n) {
  var t = new WeakMap(),
    e = null;
  function r(a) {
    if (a && a.isTexture) {
      var l = a.mapping,
        u = l === AS || l === _S,
        c = l === Xa || l === Qa;
      if (u || c) if (a.isRenderTargetTexture && a.needsPMREMUpdate === !0) {
        a.needsPMREMUpdate = !1;
        var d = t.get(a);
        return e === null && (e = new ay(n)), d = u ? e.fromEquirectangular(a, d) : e.fromCubemap(a, d), t.set(a, d), d.texture;
      } else {
        if (t.has(a)) return t.get(a).texture;
        {
          var _d4 = a.image;
          if (u && _d4 && _d4.height > 0 || c && _d4 && i(_d4)) {
            e === null && (e = new ay(n));
            var h = u ? e.fromEquirectangular(a) : e.fromCubemap(a);
            return t.set(a, h), a.addEventListener("dispose", s), h.texture;
          } else return null;
        }
      }
    }
    return a;
  }
  function i(a) {
    var l = 0,
      u = 6;
    for (var c = 0; c < u; c++) a[c] !== void 0 && l++;
    return l === u;
  }
  function s(a) {
    var l = a.target;
    l.removeEventListener("dispose", s);
    var u = t.get(l);
    u !== void 0 && (t.delete(l), u.dispose());
  }
  function o() {
    t = new WeakMap(), e !== null && (e.dispose(), e = null);
  }
  return {
    get: r,
    dispose: o
  };
}
function KV(n) {
  var t = {};
  function e(r) {
    if (t[r] !== void 0) return t[r];
    var i;
    switch (r) {
      case "WEBGL_depth_texture":
        i = n.getExtension("WEBGL_depth_texture") || n.getExtension("MOZ_WEBGL_depth_texture") || n.getExtension("WEBKIT_WEBGL_depth_texture");
        break;
      case "EXT_texture_filter_anisotropic":
        i = n.getExtension("EXT_texture_filter_anisotropic") || n.getExtension("MOZ_EXT_texture_filter_anisotropic") || n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");
        break;
      case "WEBGL_compressed_texture_s3tc":
        i = n.getExtension("WEBGL_compressed_texture_s3tc") || n.getExtension("MOZ_WEBGL_compressed_texture_s3tc") || n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");
        break;
      case "WEBGL_compressed_texture_pvrtc":
        i = n.getExtension("WEBGL_compressed_texture_pvrtc") || n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");
        break;
      default:
        i = n.getExtension(r);
    }
    return t[r] = i, i;
  }
  return {
    has: function has(r) {
      return e(r) !== null;
    },
    init: function init(r) {
      r.isWebGL2 ? e("EXT_color_buffer_float") : (e("WEBGL_depth_texture"), e("OES_texture_float"), e("OES_texture_half_float"), e("OES_texture_half_float_linear"), e("OES_standard_derivatives"), e("OES_element_index_uint"), e("OES_vertex_array_object"), e("ANGLE_instanced_arrays")), e("OES_texture_float_linear"), e("EXT_color_buffer_half_float"), e("WEBGL_multisampled_render_to_texture");
    },
    get: function get(r) {
      var i = e(r);
      return i === null && console.warn("THREE.WebGLRenderer: " + r + " extension not supported."), i;
    }
  };
}
function ZV(n, t, e, r) {
  var i = {},
    s = new WeakMap();
  function o(d) {
    var h = d.target;
    h.index !== null && t.remove(h.index);
    for (var p in h.attributes) t.remove(h.attributes[p]);
    h.removeEventListener("dispose", o), delete i[h.id];
    var f = s.get(h);
    f && (t.remove(f), s.delete(h)), r.releaseStatesOfGeometry(h), h.isInstancedBufferGeometry === !0 && delete h._maxInstanceCount, e.memory.geometries--;
  }
  function a(d, h) {
    return i[h.id] === !0 || (h.addEventListener("dispose", o), i[h.id] = !0, e.memory.geometries++), h;
  }
  function l(d) {
    var h = d.attributes;
    for (var p in h) t.update(h[p], 34962);
    var f = d.morphAttributes;
    for (var _p10 in f) {
      var m = f[_p10];
      for (var g = 0, y = m.length; g < y; g++) t.update(m[g], 34962);
    }
  }
  function u(d) {
    var h = [],
      f = d.index,
      p = d.attributes.position,
      m = 0;
    if (f !== null) {
      var v = f.array;
      m = f.version;
      for (var x = 0, S = v.length; x < S; x += 3) {
        var w = v[x + 0],
          A = v[x + 1],
          E = v[x + 2];
        h.push(w, A, A, E, E, w);
      }
    } else {
      var _v6 = p.array;
      m = p.version;
      for (var _x6 = 0, _S4 = _v6.length / 3 - 1; _x6 < _S4; _x6 += 3) {
        var _w4 = _x6 + 0,
          _A3 = _x6 + 1,
          _E4 = _x6 + 2;
        h.push(_w4, _A3, _A3, _E4, _E4, _w4);
      }
    }
    var g = new (PM(h) ? co : oy)(h, 1);
    g.version = m;
    var y = s.get(d);
    y && t.remove(y), s.set(d, g);
  }
  function c(d) {
    var h = s.get(d);
    if (h) {
      var f = d.index;
      f !== null && h.version < f.version && u(d);
    } else u(d);
    return s.get(d);
  }
  return {
    get: a,
    update: l,
    getWireframeAttribute: c
  };
}
function JV(n, t, e, r) {
  var i = r.isWebGL2,
    s;
  function o(h) {
    s = h;
  }
  var a, l;
  function u(h) {
    a = h.type, l = h.bytesPerElement;
  }
  function c(h, f) {
    n.drawElements(s, f, a, h * l), e.update(f, s, 1);
  }
  function d(h, f, p) {
    if (p === 0) return;
    var m, g;
    if (i) m = n, g = "drawElementsInstanced";else if (m = t.get("ANGLE_instanced_arrays"), g = "drawElementsInstancedANGLE", m === null) {
      console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
      return;
    }
    m[g](s, f, a, h * l, p), e.update(f, s, p);
  }
  this.setMode = o, this.setIndex = u, this.render = c, this.renderInstances = d;
}
function $V(n) {
  var t = {
      geometries: 0,
      textures: 0
    },
    e = {
      frame: 0,
      calls: 0,
      triangles: 0,
      points: 0,
      lines: 0
    };
  function r(s, o, a) {
    switch (e.calls++, o) {
      case 4:
        e.triangles += a * (s / 3);
        break;
      case 1:
        e.lines += a * (s / 2);
        break;
      case 3:
        e.lines += a * (s - 1);
        break;
      case 2:
        e.lines += a * s;
        break;
      case 0:
        e.points += a * s;
        break;
      default:
        console.error("THREE.WebGLInfo: Unknown draw mode:", o);
        break;
    }
  }
  function i() {
    e.frame++, e.calls = 0, e.triangles = 0, e.points = 0, e.lines = 0;
  }
  return {
    memory: t,
    render: e,
    programs: null,
    autoReset: !0,
    reset: i,
    update: r
  };
}
function eU(n, t) {
  return n[0] - t[0];
}
function tU(n, t) {
  return Math.abs(t[1]) - Math.abs(n[1]);
}
function rU(n, t, e) {
  var r = {},
    i = new Float32Array(8),
    s = new WeakMap(),
    o = new He(),
    a = [];
  for (var u = 0; u < 8; u++) a[u] = [u, 0];
  function l(u, c, d, h) {
    var f = u.morphTargetInfluences;
    if (t.isWebGL2 === !0) {
      var p = c.morphAttributes.position || c.morphAttributes.normal || c.morphAttributes.color,
        m = p !== void 0 ? p.length : 0,
        g = s.get(c);
      if (g === void 0 || g.count !== m) {
        var I = function I() {
          D.dispose(), s.delete(c), c.removeEventListener("dispose", I);
        };
        g !== void 0 && g.texture.dispose();
        var x = c.morphAttributes.position !== void 0,
          S = c.morphAttributes.normal !== void 0,
          w = c.morphAttributes.color !== void 0,
          A = c.morphAttributes.position || [],
          E = c.morphAttributes.normal || [],
          b = c.morphAttributes.color || [],
          T = 0;
        x === !0 && (T = 1), S === !0 && (T = 2), w === !0 && (T = 3);
        var M = c.attributes.position.count * T,
          C = 1;
        M > t.maxTextureSize && (C = Math.ceil(M / t.maxTextureSize), M = t.maxTextureSize);
        var P = new Float32Array(M * C * 4 * m),
          D = new iy(P, M, C, m);
        D.type = dr, D.needsUpdate = !0;
        var O = T * 4;
        for (var z = 0; z < m; z++) {
          var B = A[z],
            V = E[z],
            U = b[z],
            j = M * C * 4 * z;
          for (var W = 0; W < B.count; W++) {
            var k = W * O;
            x === !0 && (o.fromBufferAttribute(B, W), P[j + k + 0] = o.x, P[j + k + 1] = o.y, P[j + k + 2] = o.z, P[j + k + 3] = 0), S === !0 && (o.fromBufferAttribute(V, W), P[j + k + 4] = o.x, P[j + k + 5] = o.y, P[j + k + 6] = o.z, P[j + k + 7] = 0), w === !0 && (o.fromBufferAttribute(U, W), P[j + k + 8] = o.x, P[j + k + 9] = o.y, P[j + k + 10] = o.z, P[j + k + 11] = U.itemSize === 4 ? o.w : 1);
          }
        }
        g = {
          count: m,
          texture: D,
          size: new N(M, C)
        }, s.set(c, g), c.addEventListener("dispose", I);
      }
      var y = 0;
      for (var _x7 = 0; _x7 < f.length; _x7++) y += f[_x7];
      var v = c.morphTargetsRelative ? 1 : 1 - y;
      h.getUniforms().setValue(n, "morphTargetBaseInfluence", v), h.getUniforms().setValue(n, "morphTargetInfluences", f), h.getUniforms().setValue(n, "morphTargetsTexture", g.texture, e), h.getUniforms().setValue(n, "morphTargetsTextureSize", g.size);
    } else {
      var _p11 = f === void 0 ? 0 : f.length,
        _m10 = r[c.id];
      if (_m10 === void 0 || _m10.length !== _p11) {
        _m10 = [];
        for (var _S5 = 0; _S5 < _p11; _S5++) _m10[_S5] = [_S5, 0];
        r[c.id] = _m10;
      }
      for (var _S6 = 0; _S6 < _p11; _S6++) {
        var _w5 = _m10[_S6];
        _w5[0] = _S6, _w5[1] = f[_S6];
      }
      _m10.sort(tU);
      for (var _S7 = 0; _S7 < 8; _S7++) _S7 < _p11 && _m10[_S7][1] ? (a[_S7][0] = _m10[_S7][0], a[_S7][1] = _m10[_S7][1]) : (a[_S7][0] = Number.MAX_SAFE_INTEGER, a[_S7][1] = 0);
      a.sort(eU);
      var _g5 = c.morphAttributes.position,
        _y6 = c.morphAttributes.normal,
        _v7 = 0;
      for (var _S8 = 0; _S8 < 8; _S8++) {
        var _w6 = a[_S8],
          _A4 = _w6[0],
          _E5 = _w6[1];
        _A4 !== Number.MAX_SAFE_INTEGER && _E5 ? (_g5 && c.getAttribute("morphTarget" + _S8) !== _g5[_A4] && c.setAttribute("morphTarget" + _S8, _g5[_A4]), _y6 && c.getAttribute("morphNormal" + _S8) !== _y6[_A4] && c.setAttribute("morphNormal" + _S8, _y6[_A4]), i[_S8] = _E5, _v7 += _E5) : (_g5 && c.hasAttribute("morphTarget" + _S8) === !0 && c.deleteAttribute("morphTarget" + _S8), _y6 && c.hasAttribute("morphNormal" + _S8) === !0 && c.deleteAttribute("morphNormal" + _S8), i[_S8] = 0);
      }
      var _x8 = c.morphTargetsRelative ? 1 : 1 - _v7;
      h.getUniforms().setValue(n, "morphTargetBaseInfluence", _x8), h.getUniforms().setValue(n, "morphTargetInfluences", i);
    }
  }
  return {
    update: l
  };
}
function iU(n, t, e, r) {
  var i = new WeakMap();
  function s(l) {
    var u = r.render.frame,
      c = l.geometry,
      d = t.get(l, c);
    return i.get(d) !== u && (t.update(d), i.set(d, u)), l.isInstancedMesh && (l.hasEventListener("dispose", a) === !1 && l.addEventListener("dispose", a), e.update(l.instanceMatrix, 34962), l.instanceColor !== null && e.update(l.instanceColor, 34962)), d;
  }
  function o() {
    i = new WeakMap();
  }
  function a(l) {
    var u = l.target;
    u.removeEventListener("dispose", a), e.remove(u.instanceMatrix), u.instanceColor !== null && e.remove(u.instanceColor);
  }
  return {
    update: s,
    dispose: o
  };
}
var RM = new qt(),
  LM = new iy(),
  BM = new ny(),
  NM = new Du(),
  kT = [],
  zT = [],
  VT = new Float32Array(16),
  UT = new Float32Array(9),
  GT = new Float32Array(4);
function Zu(n, t, e) {
  var r = n[0];
  if (r <= 0 || r > 0) return n;
  var i = t * e,
    s = kT[i];
  if (s === void 0 && (s = new Float32Array(i), kT[i] = s), t !== 0) {
    r.toArray(s, 0);
    for (var o = 1, a = 0; o !== t; ++o) a += e, n[o].toArray(s, a);
  }
  return s;
}
function gi(n, t) {
  if (n.length !== t.length) return !1;
  for (var e = 0, r = n.length; e < r; e++) if (n[e] !== t[e]) return !1;
  return !0;
}
function yi(n, t) {
  for (var e = 0, r = t.length; e < r; e++) n[e] = t[e];
}
function My(n, t) {
  var e = zT[t];
  e === void 0 && (e = new Int32Array(t), zT[t] = e);
  for (var r = 0; r !== t; ++r) e[r] = n.allocateTextureUnit();
  return e;
}
function nU(n, t) {
  var e = this.cache;
  e[0] !== t && (n.uniform1f(this.addr, t), e[0] = t);
}
function sU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y) && (n.uniform2f(this.addr, t.x, t.y), e[0] = t.x, e[1] = t.y);else {
    if (gi(e, t)) return;
    n.uniform2fv(this.addr, t), yi(e, t);
  }
}
function oU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z) && (n.uniform3f(this.addr, t.x, t.y, t.z), e[0] = t.x, e[1] = t.y, e[2] = t.z);else if (t.r !== void 0) (e[0] !== t.r || e[1] !== t.g || e[2] !== t.b) && (n.uniform3f(this.addr, t.r, t.g, t.b), e[0] = t.r, e[1] = t.g, e[2] = t.b);else {
    if (gi(e, t)) return;
    n.uniform3fv(this.addr, t), yi(e, t);
  }
}
function aU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z || e[3] !== t.w) && (n.uniform4f(this.addr, t.x, t.y, t.z, t.w), e[0] = t.x, e[1] = t.y, e[2] = t.z, e[3] = t.w);else {
    if (gi(e, t)) return;
    n.uniform4fv(this.addr, t), yi(e, t);
  }
}
function lU(n, t) {
  var e = this.cache,
    r = t.elements;
  if (r === void 0) {
    if (gi(e, t)) return;
    n.uniformMatrix2fv(this.addr, !1, t), yi(e, t);
  } else {
    if (gi(e, r)) return;
    GT.set(r), n.uniformMatrix2fv(this.addr, !1, GT), yi(e, r);
  }
}
function cU(n, t) {
  var e = this.cache,
    r = t.elements;
  if (r === void 0) {
    if (gi(e, t)) return;
    n.uniformMatrix3fv(this.addr, !1, t), yi(e, t);
  } else {
    if (gi(e, r)) return;
    UT.set(r), n.uniformMatrix3fv(this.addr, !1, UT), yi(e, r);
  }
}
function uU(n, t) {
  var e = this.cache,
    r = t.elements;
  if (r === void 0) {
    if (gi(e, t)) return;
    n.uniformMatrix4fv(this.addr, !1, t), yi(e, t);
  } else {
    if (gi(e, r)) return;
    VT.set(r), n.uniformMatrix4fv(this.addr, !1, VT), yi(e, r);
  }
}
function dU(n, t) {
  var e = this.cache;
  e[0] !== t && (n.uniform1i(this.addr, t), e[0] = t);
}
function hU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y) && (n.uniform2i(this.addr, t.x, t.y), e[0] = t.x, e[1] = t.y);else {
    if (gi(e, t)) return;
    n.uniform2iv(this.addr, t), yi(e, t);
  }
}
function fU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z) && (n.uniform3i(this.addr, t.x, t.y, t.z), e[0] = t.x, e[1] = t.y, e[2] = t.z);else {
    if (gi(e, t)) return;
    n.uniform3iv(this.addr, t), yi(e, t);
  }
}
function pU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z || e[3] !== t.w) && (n.uniform4i(this.addr, t.x, t.y, t.z, t.w), e[0] = t.x, e[1] = t.y, e[2] = t.z, e[3] = t.w);else {
    if (gi(e, t)) return;
    n.uniform4iv(this.addr, t), yi(e, t);
  }
}
function mU(n, t) {
  var e = this.cache;
  e[0] !== t && (n.uniform1ui(this.addr, t), e[0] = t);
}
function gU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y) && (n.uniform2ui(this.addr, t.x, t.y), e[0] = t.x, e[1] = t.y);else {
    if (gi(e, t)) return;
    n.uniform2uiv(this.addr, t), yi(e, t);
  }
}
function yU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z) && (n.uniform3ui(this.addr, t.x, t.y, t.z), e[0] = t.x, e[1] = t.y, e[2] = t.z);else {
    if (gi(e, t)) return;
    n.uniform3uiv(this.addr, t), yi(e, t);
  }
}
function vU(n, t) {
  var e = this.cache;
  if (t.x !== void 0) (e[0] !== t.x || e[1] !== t.y || e[2] !== t.z || e[3] !== t.w) && (n.uniform4ui(this.addr, t.x, t.y, t.z, t.w), e[0] = t.x, e[1] = t.y, e[2] = t.z, e[3] = t.w);else {
    if (gi(e, t)) return;
    n.uniform4uiv(this.addr, t), yi(e, t);
  }
}
function xU(n, t, e) {
  var r = this.cache,
    i = e.allocateTextureUnit();
  r[0] !== i && (n.uniform1i(this.addr, i), r[0] = i), e.setTexture2D(t || RM, i);
}
function bU(n, t, e) {
  var r = this.cache,
    i = e.allocateTextureUnit();
  r[0] !== i && (n.uniform1i(this.addr, i), r[0] = i), e.setTexture3D(t || BM, i);
}
function SU(n, t, e) {
  var r = this.cache,
    i = e.allocateTextureUnit();
  r[0] !== i && (n.uniform1i(this.addr, i), r[0] = i), e.setTextureCube(t || NM, i);
}
function wU(n, t, e) {
  var r = this.cache,
    i = e.allocateTextureUnit();
  r[0] !== i && (n.uniform1i(this.addr, i), r[0] = i), e.setTexture2DArray(t || LM, i);
}
function AU(n) {
  switch (n) {
    case 5126:
      return nU;
    case 35664:
      return sU;
    case 35665:
      return oU;
    case 35666:
      return aU;
    case 35674:
      return lU;
    case 35675:
      return cU;
    case 35676:
      return uU;
    case 5124:
    case 35670:
      return dU;
    case 35667:
    case 35671:
      return hU;
    case 35668:
    case 35672:
      return fU;
    case 35669:
    case 35673:
      return pU;
    case 5125:
      return mU;
    case 36294:
      return gU;
    case 36295:
      return yU;
    case 36296:
      return vU;
    case 35678:
    case 36198:
    case 36298:
    case 36306:
    case 35682:
      return xU;
    case 35679:
    case 36299:
    case 36307:
      return bU;
    case 35680:
    case 36300:
    case 36308:
    case 36293:
      return SU;
    case 36289:
    case 36303:
    case 36311:
    case 36292:
      return wU;
  }
}
function _U(n, t) {
  n.uniform1fv(this.addr, t);
}
function EU(n, t) {
  var e = Zu(t, this.size, 2);
  n.uniform2fv(this.addr, e);
}
function TU(n, t) {
  var e = Zu(t, this.size, 3);
  n.uniform3fv(this.addr, e);
}
function MU(n, t) {
  var e = Zu(t, this.size, 4);
  n.uniform4fv(this.addr, e);
}
function CU(n, t) {
  var e = Zu(t, this.size, 4);
  n.uniformMatrix2fv(this.addr, !1, e);
}
function PU(n, t) {
  var e = Zu(t, this.size, 9);
  n.uniformMatrix3fv(this.addr, !1, e);
}
function DU(n, t) {
  var e = Zu(t, this.size, 16);
  n.uniformMatrix4fv(this.addr, !1, e);
}
function OU(n, t) {
  n.uniform1iv(this.addr, t);
}
function IU(n, t) {
  n.uniform2iv(this.addr, t);
}
function RU(n, t) {
  n.uniform3iv(this.addr, t);
}
function LU(n, t) {
  n.uniform4iv(this.addr, t);
}
function BU(n, t) {
  n.uniform1uiv(this.addr, t);
}
function NU(n, t) {
  n.uniform2uiv(this.addr, t);
}
function FU(n, t) {
  n.uniform3uiv(this.addr, t);
}
function kU(n, t) {
  n.uniform4uiv(this.addr, t);
}
function zU(n, t, e) {
  var r = this.cache,
    i = t.length,
    s = My(e, i);
  gi(r, s) || (n.uniform1iv(this.addr, s), yi(r, s));
  for (var o = 0; o !== i; ++o) e.setTexture2D(t[o] || RM, s[o]);
}
function VU(n, t, e) {
  var r = this.cache,
    i = t.length,
    s = My(e, i);
  gi(r, s) || (n.uniform1iv(this.addr, s), yi(r, s));
  for (var o = 0; o !== i; ++o) e.setTexture3D(t[o] || BM, s[o]);
}
function UU(n, t, e) {
  var r = this.cache,
    i = t.length,
    s = My(e, i);
  gi(r, s) || (n.uniform1iv(this.addr, s), yi(r, s));
  for (var o = 0; o !== i; ++o) e.setTextureCube(t[o] || NM, s[o]);
}
function GU(n, t, e) {
  var r = this.cache,
    i = t.length,
    s = My(e, i);
  gi(r, s) || (n.uniform1iv(this.addr, s), yi(r, s));
  for (var o = 0; o !== i; ++o) e.setTexture2DArray(t[o] || LM, s[o]);
}
function jU(n) {
  switch (n) {
    case 5126:
      return _U;
    case 35664:
      return EU;
    case 35665:
      return TU;
    case 35666:
      return MU;
    case 35674:
      return CU;
    case 35675:
      return PU;
    case 35676:
      return DU;
    case 5124:
    case 35670:
      return OU;
    case 35667:
    case 35671:
      return IU;
    case 35668:
    case 35672:
      return RU;
    case 35669:
    case 35673:
      return LU;
    case 5125:
      return BU;
    case 36294:
      return NU;
    case 36295:
      return FU;
    case 36296:
      return kU;
    case 35678:
    case 36198:
    case 36298:
    case 36306:
    case 35682:
      return zU;
    case 35679:
    case 36299:
    case 36307:
      return VU;
    case 35680:
    case 36300:
    case 36308:
    case 36293:
      return UU;
    case 36289:
    case 36303:
    case 36311:
    case 36292:
      return GU;
  }
}
var OS = /*#__PURE__*/_createClass(function OS(t, e, r) {
    _classCallCheck(this, OS);
    this.id = t, this.addr = r, this.cache = [], this.setValue = AU(e.type);
  }),
  IS = /*#__PURE__*/_createClass(function IS(t, e, r) {
    _classCallCheck(this, IS);
    this.id = t, this.addr = r, this.cache = [], this.size = e.size, this.setValue = jU(e.type);
  }),
  RS = /*#__PURE__*/function () {
    function RS(t) {
      _classCallCheck(this, RS);
      this.id = t, this.seq = [], this.map = {};
    }
    _createClass(RS, [{
      key: "setValue",
      value: function setValue(t, e, r) {
        var i = this.seq;
        for (var s = 0, o = i.length; s !== o; ++s) {
          var a = i[s];
          a.setValue(t, e[a.id], r);
        }
      }
    }]);
    return RS;
  }(),
  mS = /(\w+)(\])?(\[|\.)?/g;
function jT(n, t) {
  n.seq.push(t), n.map[t.id] = t;
}
function HU(n, t, e) {
  var r = n.name,
    i = r.length;
  for (mS.lastIndex = 0;;) {
    var s = mS.exec(r),
      o = mS.lastIndex,
      a = s[1],
      l = s[2] === "]",
      u = s[3];
    if (l && (a = a | 0), u === void 0 || u === "[" && o + 2 === i) {
      jT(e, u === void 0 ? new OS(a, n, t) : new IS(a, n, t));
      break;
    } else {
      var d = e.map[a];
      d === void 0 && (d = new RS(a), jT(e, d)), e = d;
    }
  }
}
var Cu = /*#__PURE__*/function () {
  function Cu(t, e) {
    _classCallCheck(this, Cu);
    this.seq = [], this.map = {};
    var r = t.getProgramParameter(e, 35718);
    for (var i = 0; i < r; ++i) {
      var s = t.getActiveUniform(e, i),
        o = t.getUniformLocation(e, s.name);
      HU(s, o, this);
    }
  }
  _createClass(Cu, [{
    key: "setValue",
    value: function setValue(t, e, r, i) {
      var s = this.map[e];
      s !== void 0 && s.setValue(t, r, i);
    }
  }, {
    key: "setOptional",
    value: function setOptional(t, e, r) {
      var i = e[r];
      i !== void 0 && this.setValue(t, r, i);
    }
  }], [{
    key: "upload",
    value: function upload(t, e, r, i) {
      for (var s = 0, o = e.length; s !== o; ++s) {
        var a = e[s],
          l = r[a.id];
        l.needsUpdate !== !1 && a.setValue(t, l.value, i);
      }
    }
  }, {
    key: "seqWithValue",
    value: function seqWithValue(t, e) {
      var r = [];
      for (var i = 0, s = t.length; i !== s; ++i) {
        var o = t[i];
        o.id in e && r.push(o);
      }
      return r;
    }
  }]);
  return Cu;
}();
function HT(n, t, e) {
  var r = n.createShader(t);
  return n.shaderSource(r, e), n.compileShader(r), r;
}
var WU = 0;
function qU(n, t) {
  var e = n.split("\n"),
    r = [],
    i = Math.max(t - 6, 0),
    s = Math.min(t + 6, e.length);
  for (var o = i; o < s; o++) {
    var a = o + 1;
    r.push("".concat(a === t ? ">" : " ", " ").concat(a, ": ").concat(e[o]));
  }
  return r.join("\n");
}
function YU(n) {
  switch (n) {
    case dn:
      return ["Linear", "( value )"];
    case tt:
      return ["sRGB", "( value )"];
    default:
      return console.warn("THREE.WebGLProgram: Unsupported encoding:", n), ["Linear", "( value )"];
  }
}
function WT(n, t, e) {
  var r = n.getShaderParameter(t, 35713),
    i = n.getShaderInfoLog(t).trim();
  if (r && i === "") return "";
  var s = /ERROR: 0:(\d+)/.exec(i);
  if (s) {
    var o = parseInt(s[1]);
    return e.toUpperCase() + "\n\n" + i + "\n\n" + qU(n.getShaderSource(t), o);
  } else return i;
}
function XU(n, t) {
  var e = YU(t);
  return "vec4 " + n + "( vec4 value ) { return LinearTo" + e[0] + e[1] + "; }";
}
function QU(n, t) {
  var e;
  switch (t) {
    case cF:
      e = "Linear";
      break;
    case uF:
      e = "Reinhard";
      break;
    case dF:
      e = "OptimizedCineon";
      break;
    case hF:
      e = "ACESFilmic";
      break;
    case fF:
      e = "Custom";
      break;
    default:
      console.warn("THREE.WebGLProgram: Unsupported toneMapping:", t), e = "Linear";
  }
  return "vec3 " + n + "( vec3 color ) { return " + e + "ToneMapping( color ); }";
}
function KU(n) {
  return [n.extensionDerivatives || !!n.envMapCubeUVHeight || n.bumpMap || n.tangentSpaceNormalMap || n.clearcoatNormalMap || n.flatShading || n.shaderID === "physical" ? "#extension GL_OES_standard_derivatives : enable" : "", (n.extensionFragDepth || n.logarithmicDepthBuffer) && n.rendererExtensionFragDepth ? "#extension GL_EXT_frag_depth : enable" : "", n.extensionDrawBuffers && n.rendererExtensionDrawBuffers ? "#extension GL_EXT_draw_buffers : require" : "", (n.extensionShaderTextureLOD || n.envMap || n.transmission) && n.rendererExtensionShaderTextureLod ? "#extension GL_EXT_shader_texture_lod : enable" : ""].filter(tp).join("\n");
}
function ZU(n) {
  var t = [];
  for (var e in n) {
    var r = n[e];
    r !== !1 && t.push("#define " + e + " " + r);
  }
  return t.join("\n");
}
function JU(n, t) {
  var e = {},
    r = n.getProgramParameter(t, 35721);
  for (var i = 0; i < r; i++) {
    var s = n.getActiveAttrib(t, i),
      o = s.name,
      a = 1;
    s.type === 35674 && (a = 2), s.type === 35675 && (a = 3), s.type === 35676 && (a = 4), e[o] = {
      type: s.type,
      location: n.getAttribLocation(t, o),
      locationSize: a
    };
  }
  return e;
}
function tp(n) {
  return n !== "";
}
function qT(n, t) {
  var e = t.numSpotLightShadows + t.numSpotLightMaps - t.numSpotLightShadowsWithMaps;
  return n.replace(/NUM_DIR_LIGHTS/g, t.numDirLights).replace(/NUM_SPOT_LIGHTS/g, t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g, t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g, e).replace(/NUM_RECT_AREA_LIGHTS/g, t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g, t.numPointLights).replace(/NUM_HEMI_LIGHTS/g, t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g, t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g, t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g, t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g, t.numPointLightShadows);
}
function YT(n, t) {
  return n.replace(/NUM_CLIPPING_PLANES/g, t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g, t.numClippingPlanes - t.numClipIntersection);
}
var $U = /^[ \t]*#include +<([\w\d./]+)>/gm;
function LS(n) {
  return n.replace($U, eG);
}
function eG(n, t) {
  var e = ht[t];
  if (e === void 0) throw new Error("Can not resolve #include <" + t + ">");
  return LS(e);
}
var tG = /#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;
function XT(n) {
  return n.replace(tG, rG);
}
function rG(n, t, e, r) {
  var i = "";
  for (var s = parseInt(t); s < parseInt(e); s++) i += r.replace(/\[\s*i\s*\]/g, "[ " + s + " ]").replace(/UNROLLED_LOOP_INDEX/g, s);
  return i;
}
function QT(n) {
  var t = "precision " + n.precision + " float;\nprecision " + n.precision + " int;";
  return n.precision === "highp" ? t += "\n#define HIGH_PRECISION" : n.precision === "mediump" ? t += "\n#define MEDIUM_PRECISION" : n.precision === "lowp" && (t += "\n#define LOW_PRECISION"), t;
}
function iG(n) {
  var t = "SHADOWMAP_TYPE_BASIC";
  return n.shadowMapType === Ty ? t = "SHADOWMAP_TYPE_PCF" : n.shadowMapType === UN ? t = "SHADOWMAP_TYPE_PCF_SOFT" : n.shadowMapType === ep && (t = "SHADOWMAP_TYPE_VSM"), t;
}
function nG(n) {
  var t = "ENVMAP_TYPE_CUBE";
  if (n.envMap) switch (n.envMapMode) {
    case Xa:
    case Qa:
      t = "ENVMAP_TYPE_CUBE";
      break;
    case Qu:
      t = "ENVMAP_TYPE_CUBE_UV";
      break;
  }
  return t;
}
function sG(n) {
  var t = "ENVMAP_MODE_REFLECTION";
  if (n.envMap) switch (n.envMapMode) {
    case Qa:
      t = "ENVMAP_MODE_REFRACTION";
      break;
  }
  return t;
}
function oG(n) {
  var t = "ENVMAP_BLENDING_NONE";
  if (n.envMap) switch (n.combine) {
    case _M:
      t = "ENVMAP_BLENDING_MULTIPLY";
      break;
    case aF:
      t = "ENVMAP_BLENDING_MIX";
      break;
    case lF:
      t = "ENVMAP_BLENDING_ADD";
      break;
  }
  return t;
}
function aG(n) {
  var t = n.envMapCubeUVHeight;
  if (t === null) return null;
  var e = Math.log2(t) - 2,
    r = 1 / t;
  return {
    texelWidth: 1 / (3 * Math.max(Math.pow(2, e), 7 * 16)),
    texelHeight: r,
    maxMip: e
  };
}
function lG(n, t, e, r) {
  var i = n.getContext(),
    s = e.defines,
    o = e.vertexShader,
    a = e.fragmentShader,
    l = iG(e),
    u = nG(e),
    c = sG(e),
    d = oG(e),
    h = aG(e),
    f = e.isWebGL2 ? "" : KU(e),
    p = ZU(s),
    m = i.createProgram(),
    g,
    y,
    v = e.glslVersion ? "#version " + e.glslVersion + "\n" : "";
  e.isRawShaderMaterial ? (g = [p].filter(tp).join("\n"), g.length > 0 && (g += "\n"), y = [f, p].filter(tp).join("\n"), y.length > 0 && (y += "\n")) : (g = [QT(e), "#define SHADER_NAME " + e.shaderName, p, e.instancing ? "#define USE_INSTANCING" : "", e.instancingColor ? "#define USE_INSTANCING_COLOR" : "", e.supportsVertexTextures ? "#define VERTEX_TEXTURES" : "", e.useFog && e.fog ? "#define USE_FOG" : "", e.useFog && e.fogExp2 ? "#define FOG_EXP2" : "", e.map ? "#define USE_MAP" : "", e.envMap ? "#define USE_ENVMAP" : "", e.envMap ? "#define " + c : "", e.lightMap ? "#define USE_LIGHTMAP" : "", e.aoMap ? "#define USE_AOMAP" : "", e.emissiveMap ? "#define USE_EMISSIVEMAP" : "", e.bumpMap ? "#define USE_BUMPMAP" : "", e.normalMap ? "#define USE_NORMALMAP" : "", e.normalMap && e.objectSpaceNormalMap ? "#define OBJECTSPACE_NORMALMAP" : "", e.normalMap && e.tangentSpaceNormalMap ? "#define TANGENTSPACE_NORMALMAP" : "", e.clearcoatMap ? "#define USE_CLEARCOATMAP" : "", e.clearcoatRoughnessMap ? "#define USE_CLEARCOAT_ROUGHNESSMAP" : "", e.clearcoatNormalMap ? "#define USE_CLEARCOAT_NORMALMAP" : "", e.iridescenceMap ? "#define USE_IRIDESCENCEMAP" : "", e.iridescenceThicknessMap ? "#define USE_IRIDESCENCE_THICKNESSMAP" : "", e.displacementMap && e.supportsVertexTextures ? "#define USE_DISPLACEMENTMAP" : "", e.specularMap ? "#define USE_SPECULARMAP" : "", e.specularIntensityMap ? "#define USE_SPECULARINTENSITYMAP" : "", e.specularColorMap ? "#define USE_SPECULARCOLORMAP" : "", e.roughnessMap ? "#define USE_ROUGHNESSMAP" : "", e.metalnessMap ? "#define USE_METALNESSMAP" : "", e.alphaMap ? "#define USE_ALPHAMAP" : "", e.transmission ? "#define USE_TRANSMISSION" : "", e.transmissionMap ? "#define USE_TRANSMISSIONMAP" : "", e.thicknessMap ? "#define USE_THICKNESSMAP" : "", e.sheenColorMap ? "#define USE_SHEENCOLORMAP" : "", e.sheenRoughnessMap ? "#define USE_SHEENROUGHNESSMAP" : "", e.vertexTangents ? "#define USE_TANGENT" : "", e.vertexColors ? "#define USE_COLOR" : "", e.vertexAlphas ? "#define USE_COLOR_ALPHA" : "", e.vertexUvs ? "#define USE_UV" : "", e.uvsVertexOnly ? "#define UVS_VERTEX_ONLY" : "", e.flatShading ? "#define FLAT_SHADED" : "", e.skinning ? "#define USE_SKINNING" : "", e.morphTargets ? "#define USE_MORPHTARGETS" : "", e.morphNormals && e.flatShading === !1 ? "#define USE_MORPHNORMALS" : "", e.morphColors && e.isWebGL2 ? "#define USE_MORPHCOLORS" : "", e.morphTargetsCount > 0 && e.isWebGL2 ? "#define MORPHTARGETS_TEXTURE" : "", e.morphTargetsCount > 0 && e.isWebGL2 ? "#define MORPHTARGETS_TEXTURE_STRIDE " + e.morphTextureStride : "", e.morphTargetsCount > 0 && e.isWebGL2 ? "#define MORPHTARGETS_COUNT " + e.morphTargetsCount : "", e.doubleSided ? "#define DOUBLE_SIDED" : "", e.flipSided ? "#define FLIP_SIDED" : "", e.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", e.shadowMapEnabled ? "#define " + l : "", e.sizeAttenuation ? "#define USE_SIZEATTENUATION" : "", e.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "", e.logarithmicDepthBuffer && e.rendererExtensionFragDepth ? "#define USE_LOGDEPTHBUF_EXT" : "", "uniform mat4 modelMatrix;", "uniform mat4 modelViewMatrix;", "uniform mat4 projectionMatrix;", "uniform mat4 viewMatrix;", "uniform mat3 normalMatrix;", "uniform vec3 cameraPosition;", "uniform bool isOrthographic;", "#ifdef USE_INSTANCING", "	attribute mat4 instanceMatrix;", "#endif", "#ifdef USE_INSTANCING_COLOR", "	attribute vec3 instanceColor;", "#endif", "attribute vec3 position;", "attribute vec3 normal;", "attribute vec2 uv;", "#ifdef USE_TANGENT", "	attribute vec4 tangent;", "#endif", "#if defined( USE_COLOR_ALPHA )", "	attribute vec4 color;", "#elif defined( USE_COLOR )", "	attribute vec3 color;", "#endif", "#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )", "	attribute vec3 morphTarget0;", "	attribute vec3 morphTarget1;", "	attribute vec3 morphTarget2;", "	attribute vec3 morphTarget3;", "	#ifdef USE_MORPHNORMALS", "		attribute vec3 morphNormal0;", "		attribute vec3 morphNormal1;", "		attribute vec3 morphNormal2;", "		attribute vec3 morphNormal3;", "	#else", "		attribute vec3 morphTarget4;", "		attribute vec3 morphTarget5;", "		attribute vec3 morphTarget6;", "		attribute vec3 morphTarget7;", "	#endif", "#endif", "#ifdef USE_SKINNING", "	attribute vec4 skinIndex;", "	attribute vec4 skinWeight;", "#endif", "\n"].filter(tp).join("\n"), y = [f, QT(e), "#define SHADER_NAME " + e.shaderName, p, e.useFog && e.fog ? "#define USE_FOG" : "", e.useFog && e.fogExp2 ? "#define FOG_EXP2" : "", e.map ? "#define USE_MAP" : "", e.matcap ? "#define USE_MATCAP" : "", e.envMap ? "#define USE_ENVMAP" : "", e.envMap ? "#define " + u : "", e.envMap ? "#define " + c : "", e.envMap ? "#define " + d : "", h ? "#define CUBEUV_TEXEL_WIDTH " + h.texelWidth : "", h ? "#define CUBEUV_TEXEL_HEIGHT " + h.texelHeight : "", h ? "#define CUBEUV_MAX_MIP " + h.maxMip + ".0" : "", e.lightMap ? "#define USE_LIGHTMAP" : "", e.aoMap ? "#define USE_AOMAP" : "", e.emissiveMap ? "#define USE_EMISSIVEMAP" : "", e.bumpMap ? "#define USE_BUMPMAP" : "", e.normalMap ? "#define USE_NORMALMAP" : "", e.normalMap && e.objectSpaceNormalMap ? "#define OBJECTSPACE_NORMALMAP" : "", e.normalMap && e.tangentSpaceNormalMap ? "#define TANGENTSPACE_NORMALMAP" : "", e.clearcoat ? "#define USE_CLEARCOAT" : "", e.clearcoatMap ? "#define USE_CLEARCOATMAP" : "", e.clearcoatRoughnessMap ? "#define USE_CLEARCOAT_ROUGHNESSMAP" : "", e.clearcoatNormalMap ? "#define USE_CLEARCOAT_NORMALMAP" : "", e.iridescence ? "#define USE_IRIDESCENCE" : "", e.iridescenceMap ? "#define USE_IRIDESCENCEMAP" : "", e.iridescenceThicknessMap ? "#define USE_IRIDESCENCE_THICKNESSMAP" : "", e.specularMap ? "#define USE_SPECULARMAP" : "", e.specularIntensityMap ? "#define USE_SPECULARINTENSITYMAP" : "", e.specularColorMap ? "#define USE_SPECULARCOLORMAP" : "", e.roughnessMap ? "#define USE_ROUGHNESSMAP" : "", e.metalnessMap ? "#define USE_METALNESSMAP" : "", e.alphaMap ? "#define USE_ALPHAMAP" : "", e.alphaTest ? "#define USE_ALPHATEST" : "", e.sheen ? "#define USE_SHEEN" : "", e.sheenColorMap ? "#define USE_SHEENCOLORMAP" : "", e.sheenRoughnessMap ? "#define USE_SHEENROUGHNESSMAP" : "", e.transmission ? "#define USE_TRANSMISSION" : "", e.transmissionMap ? "#define USE_TRANSMISSIONMAP" : "", e.thicknessMap ? "#define USE_THICKNESSMAP" : "", e.decodeVideoTexture ? "#define DECODE_VIDEO_TEXTURE" : "", e.vertexTangents ? "#define USE_TANGENT" : "", e.vertexColors || e.instancingColor ? "#define USE_COLOR" : "", e.vertexAlphas ? "#define USE_COLOR_ALPHA" : "", e.vertexUvs ? "#define USE_UV" : "", e.uvsVertexOnly ? "#define UVS_VERTEX_ONLY" : "", e.gradientMap ? "#define USE_GRADIENTMAP" : "", e.flatShading ? "#define FLAT_SHADED" : "", e.doubleSided ? "#define DOUBLE_SIDED" : "", e.flipSided ? "#define FLIP_SIDED" : "", e.shadowMapEnabled ? "#define USE_SHADOWMAP" : "", e.shadowMapEnabled ? "#define " + l : "", e.premultipliedAlpha ? "#define PREMULTIPLIED_ALPHA" : "", e.physicallyCorrectLights ? "#define PHYSICALLY_CORRECT_LIGHTS" : "", e.logarithmicDepthBuffer ? "#define USE_LOGDEPTHBUF" : "", e.logarithmicDepthBuffer && e.rendererExtensionFragDepth ? "#define USE_LOGDEPTHBUF_EXT" : "", "uniform mat4 viewMatrix;", "uniform vec3 cameraPosition;", "uniform bool isOrthographic;", e.toneMapping !== Os ? "#define TONE_MAPPING" : "", e.toneMapping !== Os ? ht.tonemapping_pars_fragment : "", e.toneMapping !== Os ? QU("toneMapping", e.toneMapping) : "", e.dithering ? "#define DITHERING" : "", e.opaque ? "#define OPAQUE" : "", ht.encodings_pars_fragment, XU("linearToOutputTexel", e.outputEncoding), e.useDepthPacking ? "#define DEPTH_PACKING " + e.depthPacking : "", "\n"].filter(tp).join("\n")), o = LS(o), o = qT(o, e), o = YT(o, e), a = LS(a), a = qT(a, e), a = YT(a, e), o = XT(o), a = XT(a), e.isWebGL2 && e.isRawShaderMaterial !== !0 && (v = "#version 300 es\n", g = ["precision mediump sampler2DArray;", "#define attribute in", "#define varying out", "#define texture2D texture"].join("\n") + "\n" + g, y = ["#define varying in", e.glslVersion === bT ? "" : "layout(location = 0) out highp vec4 pc_fragColor;", e.glslVersion === bT ? "" : "#define gl_FragColor pc_fragColor", "#define gl_FragDepthEXT gl_FragDepth", "#define texture2D texture", "#define textureCube texture", "#define texture2DProj textureProj", "#define texture2DLodEXT textureLod", "#define texture2DProjLodEXT textureProjLod", "#define textureCubeLodEXT textureLod", "#define texture2DGradEXT textureGrad", "#define texture2DProjGradEXT textureProjGrad", "#define textureCubeGradEXT textureGrad"].join("\n") + "\n" + y);
  var x = v + g + o,
    S = v + y + a,
    w = HT(i, 35633, x),
    A = HT(i, 35632, S);
  if (i.attachShader(m, w), i.attachShader(m, A), e.index0AttributeName !== void 0 ? i.bindAttribLocation(m, 0, e.index0AttributeName) : e.morphTargets === !0 && i.bindAttribLocation(m, 0, "position"), i.linkProgram(m), n.debug.checkShaderErrors) {
    var T = i.getProgramInfoLog(m).trim(),
      M = i.getShaderInfoLog(w).trim(),
      C = i.getShaderInfoLog(A).trim(),
      P = !0,
      D = !0;
    if (i.getProgramParameter(m, 35714) === !1) {
      P = !1;
      var O = WT(i, w, "vertex"),
        I = WT(i, A, "fragment");
      console.error("THREE.WebGLProgram: Shader Error " + i.getError() + " - VALIDATE_STATUS " + i.getProgramParameter(m, 35715) + "\n\nProgram Info Log: " + T + "\n" + O + "\n" + I);
    } else T !== "" ? console.warn("THREE.WebGLProgram: Program Info Log:", T) : (M === "" || C === "") && (D = !1);
    D && (this.diagnostics = {
      runnable: P,
      programLog: T,
      vertexShader: {
        log: M,
        prefix: g
      },
      fragmentShader: {
        log: C,
        prefix: y
      }
    });
  }
  i.deleteShader(w), i.deleteShader(A);
  var E;
  this.getUniforms = function () {
    return E === void 0 && (E = new Cu(i, m)), E;
  };
  var b;
  return this.getAttributes = function () {
    return b === void 0 && (b = JU(i, m)), b;
  }, this.destroy = function () {
    r.releaseStatesOfProgram(this), i.deleteProgram(m), this.program = void 0;
  }, this.name = e.shaderName, this.id = WU++, this.cacheKey = t, this.usedTimes = 1, this.program = m, this.vertexShader = w, this.fragmentShader = A, this;
}
var cG = 0,
  BS = /*#__PURE__*/function () {
    function BS() {
      _classCallCheck(this, BS);
      this.shaderCache = new Map(), this.materialCache = new Map();
    }
    _createClass(BS, [{
      key: "update",
      value: function update(t) {
        var e = t.vertexShader,
          r = t.fragmentShader,
          i = this._getShaderStage(e),
          s = this._getShaderStage(r),
          o = this._getShaderCacheForMaterial(t);
        return o.has(i) === !1 && (o.add(i), i.usedTimes++), o.has(s) === !1 && (o.add(s), s.usedTimes++), this;
      }
    }, {
      key: "remove",
      value: function remove(t) {
        var e = this.materialCache.get(t);
        var _iterator2 = _createForOfIteratorHelper(e),
          _step2;
        try {
          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
            var r = _step2.value;
            r.usedTimes--, r.usedTimes === 0 && this.shaderCache.delete(r.code);
          }
        } catch (err) {
          _iterator2.e(err);
        } finally {
          _iterator2.f();
        }
        return this.materialCache.delete(t), this;
      }
    }, {
      key: "getVertexShaderID",
      value: function getVertexShaderID(t) {
        return this._getShaderStage(t.vertexShader).id;
      }
    }, {
      key: "getFragmentShaderID",
      value: function getFragmentShaderID(t) {
        return this._getShaderStage(t.fragmentShader).id;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.shaderCache.clear(), this.materialCache.clear();
      }
    }, {
      key: "_getShaderCacheForMaterial",
      value: function _getShaderCacheForMaterial(t) {
        var e = this.materialCache,
          r = e.get(t);
        return r === void 0 && (r = new Set(), e.set(t, r)), r;
      }
    }, {
      key: "_getShaderStage",
      value: function _getShaderStage(t) {
        var e = this.shaderCache,
          r = e.get(t);
        return r === void 0 && (r = new NS(t), e.set(t, r)), r;
      }
    }]);
    return BS;
  }(),
  NS = /*#__PURE__*/_createClass(function NS(t) {
    _classCallCheck(this, NS);
    this.id = cG++, this.code = t, this.usedTimes = 0;
  });
function uG(n, t, e, r, i, s, o) {
  var a = new up(),
    l = new BS(),
    u = [],
    c = i.isWebGL2,
    d = i.logarithmicDepthBuffer,
    h = i.vertexTextures,
    f = i.precision,
    p = {
      MeshDepthMaterial: "depth",
      MeshDistanceMaterial: "distanceRGBA",
      MeshNormalMaterial: "normal",
      MeshBasicMaterial: "basic",
      MeshLambertMaterial: "lambert",
      MeshPhongMaterial: "phong",
      MeshToonMaterial: "toon",
      MeshStandardMaterial: "physical",
      MeshPhysicalMaterial: "physical",
      MeshMatcapMaterial: "matcap",
      LineBasicMaterial: "basic",
      LineDashedMaterial: "dashed",
      PointsMaterial: "points",
      ShadowMaterial: "shadow",
      SpriteMaterial: "sprite"
    };
  function m(b, T, M, C, P) {
    var D = C.fog,
      O = P.geometry,
      I = b.isMeshStandardMaterial ? C.environment : null,
      z = (b.isMeshStandardMaterial ? e : t).get(b.envMap || I),
      B = !!z && z.mapping === Qu ? z.image.height : null,
      V = p[b.type];
    b.precision !== null && (f = i.getMaxPrecision(b.precision), f !== b.precision && console.warn("THREE.WebGLProgram.getParameters:", b.precision, "not supported, using", f, "instead."));
    var U = O.morphAttributes.position || O.morphAttributes.normal || O.morphAttributes.color,
      j = U !== void 0 ? U.length : 0,
      W = 0;
    O.morphAttributes.position !== void 0 && (W = 1), O.morphAttributes.normal !== void 0 && (W = 2), O.morphAttributes.color !== void 0 && (W = 3);
    var k, H, X, q;
    if (V) {
      var ye = lo[V];
      k = ye.vertexShader, H = ye.fragmentShader;
    } else k = b.vertexShader, H = b.fragmentShader, l.update(b), X = l.getVertexShaderID(b), q = l.getFragmentShaderID(b);
    var G = n.getRenderTarget(),
      J = b.alphaTest > 0,
      Z = b.clearcoat > 0,
      K = b.iridescence > 0;
    return {
      isWebGL2: c,
      shaderID: V,
      shaderName: b.type,
      vertexShader: k,
      fragmentShader: H,
      defines: b.defines,
      customVertexShaderID: X,
      customFragmentShaderID: q,
      isRawShaderMaterial: b.isRawShaderMaterial === !0,
      glslVersion: b.glslVersion,
      precision: f,
      instancing: P.isInstancedMesh === !0,
      instancingColor: P.isInstancedMesh === !0 && P.instanceColor !== null,
      supportsVertexTextures: h,
      outputEncoding: G === null ? n.outputEncoding : G.isXRRenderTarget === !0 ? G.texture.encoding : dn,
      map: !!b.map,
      matcap: !!b.matcap,
      envMap: !!z,
      envMapMode: z && z.mapping,
      envMapCubeUVHeight: B,
      lightMap: !!b.lightMap,
      aoMap: !!b.aoMap,
      emissiveMap: !!b.emissiveMap,
      bumpMap: !!b.bumpMap,
      normalMap: !!b.normalMap,
      objectSpaceNormalMap: b.normalMapType === DF,
      tangentSpaceNormalMap: b.normalMapType === PF,
      decodeVideoTexture: !!b.map && b.map.isVideoTexture === !0 && b.map.encoding === tt,
      clearcoat: Z,
      clearcoatMap: Z && !!b.clearcoatMap,
      clearcoatRoughnessMap: Z && !!b.clearcoatRoughnessMap,
      clearcoatNormalMap: Z && !!b.clearcoatNormalMap,
      iridescence: K,
      iridescenceMap: K && !!b.iridescenceMap,
      iridescenceThicknessMap: K && !!b.iridescenceThicknessMap,
      displacementMap: !!b.displacementMap,
      roughnessMap: !!b.roughnessMap,
      metalnessMap: !!b.metalnessMap,
      specularMap: !!b.specularMap,
      specularIntensityMap: !!b.specularIntensityMap,
      specularColorMap: !!b.specularColorMap,
      opaque: b.transparent === !1 && b.blending === qa,
      alphaMap: !!b.alphaMap,
      alphaTest: J,
      gradientMap: !!b.gradientMap,
      sheen: b.sheen > 0,
      sheenColorMap: !!b.sheenColorMap,
      sheenRoughnessMap: !!b.sheenRoughnessMap,
      transmission: b.transmission > 0,
      transmissionMap: !!b.transmissionMap,
      thicknessMap: !!b.thicknessMap,
      combine: b.combine,
      vertexTangents: !!b.normalMap && !!O.attributes.tangent,
      vertexColors: b.vertexColors,
      vertexAlphas: b.vertexColors === !0 && !!O.attributes.color && O.attributes.color.itemSize === 4,
      vertexUvs: !!b.map || !!b.bumpMap || !!b.normalMap || !!b.specularMap || !!b.alphaMap || !!b.emissiveMap || !!b.roughnessMap || !!b.metalnessMap || !!b.clearcoatMap || !!b.clearcoatRoughnessMap || !!b.clearcoatNormalMap || !!b.iridescenceMap || !!b.iridescenceThicknessMap || !!b.displacementMap || !!b.transmissionMap || !!b.thicknessMap || !!b.specularIntensityMap || !!b.specularColorMap || !!b.sheenColorMap || !!b.sheenRoughnessMap,
      uvsVertexOnly: !(!!b.map || !!b.bumpMap || !!b.normalMap || !!b.specularMap || !!b.alphaMap || !!b.emissiveMap || !!b.roughnessMap || !!b.metalnessMap || !!b.clearcoatNormalMap || !!b.iridescenceMap || !!b.iridescenceThicknessMap || b.transmission > 0 || !!b.transmissionMap || !!b.thicknessMap || !!b.specularIntensityMap || !!b.specularColorMap || b.sheen > 0 || !!b.sheenColorMap || !!b.sheenRoughnessMap) && !!b.displacementMap,
      fog: !!D,
      useFog: b.fog === !0,
      fogExp2: D && D.isFogExp2,
      flatShading: !!b.flatShading,
      sizeAttenuation: b.sizeAttenuation,
      logarithmicDepthBuffer: d,
      skinning: P.isSkinnedMesh === !0,
      morphTargets: O.morphAttributes.position !== void 0,
      morphNormals: O.morphAttributes.normal !== void 0,
      morphColors: O.morphAttributes.color !== void 0,
      morphTargetsCount: j,
      morphTextureStride: W,
      numDirLights: T.directional.length,
      numPointLights: T.point.length,
      numSpotLights: T.spot.length,
      numSpotLightMaps: T.spotLightMap.length,
      numRectAreaLights: T.rectArea.length,
      numHemiLights: T.hemi.length,
      numDirLightShadows: T.directionalShadowMap.length,
      numPointLightShadows: T.pointShadowMap.length,
      numSpotLightShadows: T.spotShadowMap.length,
      numSpotLightShadowsWithMaps: T.numSpotLightShadowsWithMaps,
      numClippingPlanes: o.numPlanes,
      numClipIntersection: o.numIntersection,
      dithering: b.dithering,
      shadowMapEnabled: n.shadowMap.enabled && M.length > 0,
      shadowMapType: n.shadowMap.type,
      toneMapping: b.toneMapped ? n.toneMapping : Os,
      physicallyCorrectLights: n.physicallyCorrectLights,
      premultipliedAlpha: b.premultipliedAlpha,
      doubleSided: b.side === qi,
      flipSided: b.side === ai,
      useDepthPacking: !!b.depthPacking,
      depthPacking: b.depthPacking || 0,
      index0AttributeName: b.index0AttributeName,
      extensionDerivatives: b.extensions && b.extensions.derivatives,
      extensionFragDepth: b.extensions && b.extensions.fragDepth,
      extensionDrawBuffers: b.extensions && b.extensions.drawBuffers,
      extensionShaderTextureLOD: b.extensions && b.extensions.shaderTextureLOD,
      rendererExtensionFragDepth: c || r.has("EXT_frag_depth"),
      rendererExtensionDrawBuffers: c || r.has("WEBGL_draw_buffers"),
      rendererExtensionShaderTextureLod: c || r.has("EXT_shader_texture_lod"),
      customProgramCacheKey: b.customProgramCacheKey()
    };
  }
  function g(b) {
    var T = [];
    if (b.shaderID ? T.push(b.shaderID) : (T.push(b.customVertexShaderID), T.push(b.customFragmentShaderID)), b.defines !== void 0) for (var M in b.defines) T.push(M), T.push(b.defines[M]);
    return b.isRawShaderMaterial === !1 && (y(T, b), v(T, b), T.push(n.outputEncoding)), T.push(b.customProgramCacheKey), T.join();
  }
  function y(b, T) {
    b.push(T.precision), b.push(T.outputEncoding), b.push(T.envMapMode), b.push(T.envMapCubeUVHeight), b.push(T.combine), b.push(T.vertexUvs), b.push(T.fogExp2), b.push(T.sizeAttenuation), b.push(T.morphTargetsCount), b.push(T.morphAttributeCount), b.push(T.numDirLights), b.push(T.numPointLights), b.push(T.numSpotLights), b.push(T.numSpotLightMaps), b.push(T.numHemiLights), b.push(T.numRectAreaLights), b.push(T.numDirLightShadows), b.push(T.numPointLightShadows), b.push(T.numSpotLightShadows), b.push(T.numSpotLightShadowsWithMaps), b.push(T.shadowMapType), b.push(T.toneMapping), b.push(T.numClippingPlanes), b.push(T.numClipIntersection), b.push(T.depthPacking);
  }
  function v(b, T) {
    a.disableAll(), T.isWebGL2 && a.enable(0), T.supportsVertexTextures && a.enable(1), T.instancing && a.enable(2), T.instancingColor && a.enable(3), T.map && a.enable(4), T.matcap && a.enable(5), T.envMap && a.enable(6), T.lightMap && a.enable(7), T.aoMap && a.enable(8), T.emissiveMap && a.enable(9), T.bumpMap && a.enable(10), T.normalMap && a.enable(11), T.objectSpaceNormalMap && a.enable(12), T.tangentSpaceNormalMap && a.enable(13), T.clearcoat && a.enable(14), T.clearcoatMap && a.enable(15), T.clearcoatRoughnessMap && a.enable(16), T.clearcoatNormalMap && a.enable(17), T.iridescence && a.enable(18), T.iridescenceMap && a.enable(19), T.iridescenceThicknessMap && a.enable(20), T.displacementMap && a.enable(21), T.specularMap && a.enable(22), T.roughnessMap && a.enable(23), T.metalnessMap && a.enable(24), T.gradientMap && a.enable(25), T.alphaMap && a.enable(26), T.alphaTest && a.enable(27), T.vertexColors && a.enable(28), T.vertexAlphas && a.enable(29), T.vertexUvs && a.enable(30), T.vertexTangents && a.enable(31), T.uvsVertexOnly && a.enable(32), b.push(a.mask), a.disableAll(), T.fog && a.enable(0), T.useFog && a.enable(1), T.flatShading && a.enable(2), T.logarithmicDepthBuffer && a.enable(3), T.skinning && a.enable(4), T.morphTargets && a.enable(5), T.morphNormals && a.enable(6), T.morphColors && a.enable(7), T.premultipliedAlpha && a.enable(8), T.shadowMapEnabled && a.enable(9), T.physicallyCorrectLights && a.enable(10), T.doubleSided && a.enable(11), T.flipSided && a.enable(12), T.useDepthPacking && a.enable(13), T.dithering && a.enable(14), T.specularIntensityMap && a.enable(15), T.specularColorMap && a.enable(16), T.transmission && a.enable(17), T.transmissionMap && a.enable(18), T.thicknessMap && a.enable(19), T.sheen && a.enable(20), T.sheenColorMap && a.enable(21), T.sheenRoughnessMap && a.enable(22), T.decodeVideoTexture && a.enable(23), T.opaque && a.enable(24), b.push(a.mask);
  }
  function x(b) {
    var T = p[b.type],
      M;
    if (T) {
      var C = lo[T];
      M = Ns.clone(C.uniforms);
    } else M = b.uniforms;
    return M;
  }
  function S(b, T) {
    var M;
    for (var C = 0, P = u.length; C < P; C++) {
      var D = u[C];
      if (D.cacheKey === T) {
        M = D, ++M.usedTimes;
        break;
      }
    }
    return M === void 0 && (M = new lG(n, T, b, s), u.push(M)), M;
  }
  function w(b) {
    if (--b.usedTimes === 0) {
      var T = u.indexOf(b);
      u[T] = u[u.length - 1], u.pop(), b.destroy();
    }
  }
  function A(b) {
    l.remove(b);
  }
  function E() {
    l.dispose();
  }
  return {
    getParameters: m,
    getProgramCacheKey: g,
    getUniforms: x,
    acquireProgram: S,
    releaseProgram: w,
    releaseShaderCache: A,
    programs: u,
    dispose: E
  };
}
function dG() {
  var n = new WeakMap();
  function t(s) {
    var o = n.get(s);
    return o === void 0 && (o = {}, n.set(s, o)), o;
  }
  function e(s) {
    n.delete(s);
  }
  function r(s, o, a) {
    n.get(s)[o] = a;
  }
  function i() {
    n = new WeakMap();
  }
  return {
    get: t,
    remove: e,
    update: r,
    dispose: i
  };
}
function hG(n, t) {
  return n.groupOrder !== t.groupOrder ? n.groupOrder - t.groupOrder : n.renderOrder !== t.renderOrder ? n.renderOrder - t.renderOrder : n.material.id !== t.material.id ? n.material.id - t.material.id : n.z !== t.z ? n.z - t.z : n.id - t.id;
}
function KT(n, t) {
  return n.groupOrder !== t.groupOrder ? n.groupOrder - t.groupOrder : n.renderOrder !== t.renderOrder ? n.renderOrder - t.renderOrder : n.z !== t.z ? t.z - n.z : n.id - t.id;
}
function ZT() {
  var n = [],
    t = 0,
    e = [],
    r = [],
    i = [];
  function s() {
    t = 0, e.length = 0, r.length = 0, i.length = 0;
  }
  function o(d, h, f, p, m, g) {
    var y = n[t];
    return y === void 0 ? (y = {
      id: d.id,
      object: d,
      geometry: h,
      material: f,
      groupOrder: p,
      renderOrder: d.renderOrder,
      z: m,
      group: g
    }, n[t] = y) : (y.id = d.id, y.object = d, y.geometry = h, y.material = f, y.groupOrder = p, y.renderOrder = d.renderOrder, y.z = m, y.group = g), t++, y;
  }
  function a(d, h, f, p, m, g) {
    var y = o(d, h, f, p, m, g);
    f.transmission > 0 ? r.push(y) : f.transparent === !0 ? i.push(y) : e.push(y);
  }
  function l(d, h, f, p, m, g) {
    var y = o(d, h, f, p, m, g);
    f.transmission > 0 ? r.unshift(y) : f.transparent === !0 ? i.unshift(y) : e.unshift(y);
  }
  function u(d, h) {
    e.length > 1 && e.sort(d || hG), r.length > 1 && r.sort(h || KT), i.length > 1 && i.sort(h || KT);
  }
  function c() {
    for (var d = t, h = n.length; d < h; d++) {
      var f = n[d];
      if (f.id === null) break;
      f.id = null, f.object = null, f.geometry = null, f.material = null, f.group = null;
    }
  }
  return {
    opaque: e,
    transmissive: r,
    transparent: i,
    init: s,
    push: a,
    unshift: l,
    finish: c,
    sort: u
  };
}
function fG() {
  var n = new WeakMap();
  function t(r, i) {
    var s = n.get(r),
      o;
    return s === void 0 ? (o = new ZT(), n.set(r, [o])) : i >= s.length ? (o = new ZT(), s.push(o)) : o = s[i], o;
  }
  function e() {
    n = new WeakMap();
  }
  return {
    get: t,
    dispose: e
  };
}
function pG() {
  var n = {};
  return {
    get: function get(t) {
      if (n[t.id] !== void 0) return n[t.id];
      var e;
      switch (t.type) {
        case "DirectionalLight":
          e = {
            direction: new _(),
            color: new Le()
          };
          break;
        case "SpotLight":
          e = {
            position: new _(),
            direction: new _(),
            color: new Le(),
            distance: 0,
            coneCos: 0,
            penumbraCos: 0,
            decay: 0
          };
          break;
        case "PointLight":
          e = {
            position: new _(),
            color: new Le(),
            distance: 0,
            decay: 0
          };
          break;
        case "HemisphereLight":
          e = {
            direction: new _(),
            skyColor: new Le(),
            groundColor: new Le()
          };
          break;
        case "RectAreaLight":
          e = {
            color: new Le(),
            position: new _(),
            halfWidth: new _(),
            halfHeight: new _()
          };
          break;
      }
      return n[t.id] = e, e;
    }
  };
}
function mG() {
  var n = {};
  return {
    get: function get(t) {
      if (n[t.id] !== void 0) return n[t.id];
      var e;
      switch (t.type) {
        case "DirectionalLight":
          e = {
            shadowBias: 0,
            shadowNormalBias: 0,
            shadowRadius: 1,
            shadowMapSize: new N()
          };
          break;
        case "SpotLight":
          e = {
            shadowBias: 0,
            shadowNormalBias: 0,
            shadowRadius: 1,
            shadowMapSize: new N()
          };
          break;
        case "PointLight":
          e = {
            shadowBias: 0,
            shadowNormalBias: 0,
            shadowRadius: 1,
            shadowMapSize: new N(),
            shadowCameraNear: 1,
            shadowCameraFar: 1e3
          };
          break;
      }
      return n[t.id] = e, e;
    }
  };
}
var gG = 0;
function yG(n, t) {
  return (t.castShadow ? 2 : 0) - (n.castShadow ? 2 : 0) + (t.map ? 1 : 0) - (n.map ? 1 : 0);
}
function vG(n, t) {
  var e = new pG(),
    r = mG(),
    i = {
      version: 0,
      hash: {
        directionalLength: -1,
        pointLength: -1,
        spotLength: -1,
        rectAreaLength: -1,
        hemiLength: -1,
        numDirectionalShadows: -1,
        numPointShadows: -1,
        numSpotShadows: -1,
        numSpotMaps: -1
      },
      ambient: [0, 0, 0],
      probe: [],
      directional: [],
      directionalShadow: [],
      directionalShadowMap: [],
      directionalShadowMatrix: [],
      spot: [],
      spotLightMap: [],
      spotShadow: [],
      spotShadowMap: [],
      spotLightMatrix: [],
      rectArea: [],
      rectAreaLTC1: null,
      rectAreaLTC2: null,
      point: [],
      pointShadow: [],
      pointShadowMap: [],
      pointShadowMatrix: [],
      hemi: [],
      numSpotLightShadowsWithMaps: 0
    };
  for (var c = 0; c < 9; c++) i.probe.push(new _());
  var s = new _(),
    o = new te(),
    a = new te();
  function l(c, d) {
    var h = 0,
      f = 0,
      p = 0;
    for (var C = 0; C < 9; C++) i.probe[C].set(0, 0, 0);
    var m = 0,
      g = 0,
      y = 0,
      v = 0,
      x = 0,
      S = 0,
      w = 0,
      A = 0,
      E = 0,
      b = 0;
    c.sort(yG);
    var T = d !== !0 ? Math.PI : 1;
    for (var _C3 = 0, P = c.length; _C3 < P; _C3++) {
      var D = c[_C3],
        O = D.color,
        I = D.intensity,
        z = D.distance,
        B = D.shadow && D.shadow.map ? D.shadow.map.texture : null;
      if (D.isAmbientLight) h += O.r * I * T, f += O.g * I * T, p += O.b * I * T;else if (D.isLightProbe) for (var V = 0; V < 9; V++) i.probe[V].addScaledVector(D.sh.coefficients[V], I);else if (D.isDirectionalLight) {
        var _V2 = e.get(D);
        if (_V2.color.copy(D.color).multiplyScalar(D.intensity * T), D.castShadow) {
          var U = D.shadow,
            j = r.get(D);
          j.shadowBias = U.bias, j.shadowNormalBias = U.normalBias, j.shadowRadius = U.radius, j.shadowMapSize = U.mapSize, i.directionalShadow[m] = j, i.directionalShadowMap[m] = B, i.directionalShadowMatrix[m] = D.shadow.matrix, S++;
        }
        i.directional[m] = _V2, m++;
      } else if (D.isSpotLight) {
        var _V3 = e.get(D);
        _V3.position.setFromMatrixPosition(D.matrixWorld), _V3.color.copy(O).multiplyScalar(I * T), _V3.distance = z, _V3.coneCos = Math.cos(D.angle), _V3.penumbraCos = Math.cos(D.angle * (1 - D.penumbra)), _V3.decay = D.decay, i.spot[y] = _V3;
        var _U2 = D.shadow;
        if (D.map && (i.spotLightMap[E] = D.map, E++, _U2.updateMatrices(D), D.castShadow && b++), i.spotLightMatrix[y] = _U2.matrix, D.castShadow) {
          var _j4 = r.get(D);
          _j4.shadowBias = _U2.bias, _j4.shadowNormalBias = _U2.normalBias, _j4.shadowRadius = _U2.radius, _j4.shadowMapSize = _U2.mapSize, i.spotShadow[y] = _j4, i.spotShadowMap[y] = B, A++;
        }
        y++;
      } else if (D.isRectAreaLight) {
        var _V4 = e.get(D);
        _V4.color.copy(O).multiplyScalar(I), _V4.halfWidth.set(D.width * .5, 0, 0), _V4.halfHeight.set(0, D.height * .5, 0), i.rectArea[v] = _V4, v++;
      } else if (D.isPointLight) {
        var _V5 = e.get(D);
        if (_V5.color.copy(D.color).multiplyScalar(D.intensity * T), _V5.distance = D.distance, _V5.decay = D.decay, D.castShadow) {
          var _U3 = D.shadow,
            _j5 = r.get(D);
          _j5.shadowBias = _U3.bias, _j5.shadowNormalBias = _U3.normalBias, _j5.shadowRadius = _U3.radius, _j5.shadowMapSize = _U3.mapSize, _j5.shadowCameraNear = _U3.camera.near, _j5.shadowCameraFar = _U3.camera.far, i.pointShadow[g] = _j5, i.pointShadowMap[g] = B, i.pointShadowMatrix[g] = D.shadow.matrix, w++;
        }
        i.point[g] = _V5, g++;
      } else if (D.isHemisphereLight) {
        var _V6 = e.get(D);
        _V6.skyColor.copy(D.color).multiplyScalar(I * T), _V6.groundColor.copy(D.groundColor).multiplyScalar(I * T), i.hemi[x] = _V6, x++;
      }
    }
    v > 0 && (t.isWebGL2 || n.has("OES_texture_float_linear") === !0 ? (i.rectAreaLTC1 = Ae.LTC_FLOAT_1, i.rectAreaLTC2 = Ae.LTC_FLOAT_2) : n.has("OES_texture_half_float_linear") === !0 ? (i.rectAreaLTC1 = Ae.LTC_HALF_1, i.rectAreaLTC2 = Ae.LTC_HALF_2) : console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")), i.ambient[0] = h, i.ambient[1] = f, i.ambient[2] = p;
    var M = i.hash;
    (M.directionalLength !== m || M.pointLength !== g || M.spotLength !== y || M.rectAreaLength !== v || M.hemiLength !== x || M.numDirectionalShadows !== S || M.numPointShadows !== w || M.numSpotShadows !== A || M.numSpotMaps !== E) && (i.directional.length = m, i.spot.length = y, i.rectArea.length = v, i.point.length = g, i.hemi.length = x, i.directionalShadow.length = S, i.directionalShadowMap.length = S, i.pointShadow.length = w, i.pointShadowMap.length = w, i.spotShadow.length = A, i.spotShadowMap.length = A, i.directionalShadowMatrix.length = S, i.pointShadowMatrix.length = w, i.spotLightMatrix.length = A + E - b, i.spotLightMap.length = E, i.numSpotLightShadowsWithMaps = b, M.directionalLength = m, M.pointLength = g, M.spotLength = y, M.rectAreaLength = v, M.hemiLength = x, M.numDirectionalShadows = S, M.numPointShadows = w, M.numSpotShadows = A, M.numSpotMaps = E, i.version = gG++);
  }
  function u(c, d) {
    var h = 0,
      f = 0,
      p = 0,
      m = 0,
      g = 0,
      y = d.matrixWorldInverse;
    for (var v = 0, x = c.length; v < x; v++) {
      var S = c[v];
      if (S.isDirectionalLight) {
        var w = i.directional[h];
        w.direction.setFromMatrixPosition(S.matrixWorld), s.setFromMatrixPosition(S.target.matrixWorld), w.direction.sub(s), w.direction.transformDirection(y), h++;
      } else if (S.isSpotLight) {
        var _w7 = i.spot[p];
        _w7.position.setFromMatrixPosition(S.matrixWorld), _w7.position.applyMatrix4(y), _w7.direction.setFromMatrixPosition(S.matrixWorld), s.setFromMatrixPosition(S.target.matrixWorld), _w7.direction.sub(s), _w7.direction.transformDirection(y), p++;
      } else if (S.isRectAreaLight) {
        var _w8 = i.rectArea[m];
        _w8.position.setFromMatrixPosition(S.matrixWorld), _w8.position.applyMatrix4(y), a.identity(), o.copy(S.matrixWorld), o.premultiply(y), a.extractRotation(o), _w8.halfWidth.set(S.width * .5, 0, 0), _w8.halfHeight.set(0, S.height * .5, 0), _w8.halfWidth.applyMatrix4(a), _w8.halfHeight.applyMatrix4(a), m++;
      } else if (S.isPointLight) {
        var _w9 = i.point[f];
        _w9.position.setFromMatrixPosition(S.matrixWorld), _w9.position.applyMatrix4(y), f++;
      } else if (S.isHemisphereLight) {
        var _w10 = i.hemi[g];
        _w10.direction.setFromMatrixPosition(S.matrixWorld), _w10.direction.transformDirection(y), g++;
      }
    }
  }
  return {
    setup: l,
    setupView: u,
    state: i
  };
}
function JT(n, t) {
  var e = new vG(n, t),
    r = [],
    i = [];
  function s() {
    r.length = 0, i.length = 0;
  }
  function o(d) {
    r.push(d);
  }
  function a(d) {
    i.push(d);
  }
  function l(d) {
    e.setup(r, d);
  }
  function u(d) {
    e.setupView(r, d);
  }
  return {
    init: s,
    state: {
      lightsArray: r,
      shadowsArray: i,
      lights: e
    },
    setupLights: l,
    setupLightsView: u,
    pushLight: o,
    pushShadow: a
  };
}
function xG(n, t) {
  var e = new WeakMap();
  function r(s) {
    var o = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var a = e.get(s),
      l;
    return a === void 0 ? (l = new JT(n, t), e.set(s, [l])) : o >= a.length ? (l = new JT(n, t), a.push(l)) : l = a[o], l;
  }
  function i() {
    e = new WeakMap();
  }
  return {
    get: r,
    dispose: i
  };
}
var hp = /*#__PURE__*/function (_hc3) {
    _inherits(hp, _hc3);
    var _super23 = _createSuper(hp);
    function hp(t) {
      var _this20;
      _classCallCheck(this, hp);
      _this20 = _super23.call(this), _this20.isMeshDepthMaterial = !0, _this20.type = "MeshDepthMaterial", _this20.depthPacking = Ii, _this20.map = null, _this20.alphaMap = null, _this20.displacementMap = null, _this20.displacementScale = 1, _this20.displacementBias = 0, _this20.wireframe = !1, _this20.wireframeLinewidth = 1, _this20.setValues(t);
      return _this20;
    }
    _createClass(hp, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(hp.prototype), "copy", this).call(this, t), this.depthPacking = t.depthPacking, this.map = t.map, this.alphaMap = t.alphaMap, this.displacementMap = t.displacementMap, this.displacementScale = t.displacementScale, this.displacementBias = t.displacementBias, this.wireframe = t.wireframe, this.wireframeLinewidth = t.wireframeLinewidth, this;
      }
    }]);
    return hp;
  }(hc),
  FS = /*#__PURE__*/function (_hc4) {
    _inherits(FS, _hc4);
    var _super24 = _createSuper(FS);
    function FS(t) {
      var _this21;
      _classCallCheck(this, FS);
      _this21 = _super24.call(this), _this21.isMeshDistanceMaterial = !0, _this21.type = "MeshDistanceMaterial", _this21.referencePosition = new _(), _this21.nearDistance = 1, _this21.farDistance = 1e3, _this21.map = null, _this21.alphaMap = null, _this21.displacementMap = null, _this21.displacementScale = 1, _this21.displacementBias = 0, _this21.setValues(t);
      return _this21;
    }
    _createClass(FS, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(FS.prototype), "copy", this).call(this, t), this.referencePosition.copy(t.referencePosition), this.nearDistance = t.nearDistance, this.farDistance = t.farDistance, this.map = t.map, this.alphaMap = t.alphaMap, this.displacementMap = t.displacementMap, this.displacementScale = t.displacementScale, this.displacementBias = t.displacementBias, this;
      }
    }]);
    return FS;
  }(hc),
  bG = "void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",
  SG = "uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";
function wG(n, t, e) {
  var r = new dp(),
    i = new N(),
    s = new N(),
    o = new He(),
    a = new hp({
      depthPacking: lw
    }),
    l = new FS(),
    u = {},
    c = e.maxTextureSize,
    d = _defineProperty(_defineProperty(_defineProperty({}, jn, ai), ai, jn), qi, qi),
    h = new rt({
      defines: {
        VSM_SAMPLES: 8
      },
      uniforms: {
        shadow_pass: {
          value: null
        },
        resolution: {
          value: new N()
        },
        radius: {
          value: 4
        }
      },
      vertexShader: bG,
      fragmentShader: SG
    }),
    f = h.clone();
  f.defines.HORIZONTAL_PASS = 1;
  var p = new we();
  p.setAttribute("position", new Ge(new Float32Array([-1, -1, .5, 3, -1, .5, -1, 3, .5]), 3));
  var m = new rr(p, h),
    g = this;
  this.enabled = !1, this.autoUpdate = !0, this.needsUpdate = !1, this.type = Ty, this.render = function (S, w, A) {
    if (g.enabled === !1 || g.autoUpdate === !1 && g.needsUpdate === !1 || S.length === 0) return;
    var E = n.getRenderTarget(),
      b = n.getActiveCubeFace(),
      T = n.getActiveMipmapLevel(),
      M = n.state;
    M.setBlending(Wt), M.buffers.color.setClear(1, 1, 1, 1), M.buffers.depth.setTest(!0), M.setScissorTest(!1);
    for (var C = 0, P = S.length; C < P; C++) {
      var D = S[C],
        O = D.shadow;
      if (O === void 0) {
        console.warn("THREE.WebGLShadowMap:", D, "has no shadow.");
        continue;
      }
      if (O.autoUpdate === !1 && O.needsUpdate === !1) continue;
      i.copy(O.mapSize);
      var I = O.getFrameExtents();
      if (i.multiply(I), s.copy(O.mapSize), (i.x > c || i.y > c) && (i.x > c && (s.x = Math.floor(c / I.x), i.x = s.x * I.x, O.mapSize.x = s.x), i.y > c && (s.y = Math.floor(c / I.y), i.y = s.y * I.y, O.mapSize.y = s.y)), O.map === null) {
        var B = this.type !== ep ? {
          minFilter: Et,
          magFilter: Et
        } : {};
        O.map = new at(i.x, i.y, B), O.map.texture.name = D.name + ".shadowMap", O.camera.updateProjectionMatrix();
      }
      n.setRenderTarget(O.map), n.clear();
      var z = O.getViewportCount();
      for (var _B2 = 0; _B2 < z; _B2++) {
        var V = O.getViewport(_B2);
        o.set(s.x * V.x, s.y * V.y, s.x * V.z, s.y * V.w), M.viewport(o), O.updateMatrices(D, _B2), r = O.getFrustum(), x(w, A, O.camera, D, this.type);
      }
      O.isPointLightShadow !== !0 && this.type === ep && y(O, A), O.needsUpdate = !1;
    }
    g.needsUpdate = !1, n.setRenderTarget(E, b, T);
  };
  function y(S, w) {
    var A = t.update(m);
    h.defines.VSM_SAMPLES !== S.blurSamples && (h.defines.VSM_SAMPLES = S.blurSamples, f.defines.VSM_SAMPLES = S.blurSamples, h.needsUpdate = !0, f.needsUpdate = !0), S.mapPass === null && (S.mapPass = new at(i.x, i.y)), h.uniforms.shadow_pass.value = S.map.texture, h.uniforms.resolution.value = S.mapSize, h.uniforms.radius.value = S.radius, n.setRenderTarget(S.mapPass), n.clear(), n.renderBufferDirect(w, null, A, h, m, null), f.uniforms.shadow_pass.value = S.mapPass.texture, f.uniforms.resolution.value = S.mapSize, f.uniforms.radius.value = S.radius, n.setRenderTarget(S.map), n.clear(), n.renderBufferDirect(w, null, A, f, m, null);
  }
  function v(S, w, A, E, b, T) {
    var M = null,
      C = A.isPointLight === !0 ? S.customDistanceMaterial : S.customDepthMaterial;
    if (C !== void 0) M = C;else if (M = A.isPointLight === !0 ? l : a, n.localClippingEnabled && w.clipShadows === !0 && Array.isArray(w.clippingPlanes) && w.clippingPlanes.length !== 0 || w.displacementMap && w.displacementScale !== 0 || w.alphaMap && w.alphaTest > 0 || w.map && w.alphaTest > 0) {
      var P = M.uuid,
        D = w.uuid,
        O = u[P];
      O === void 0 && (O = {}, u[P] = O);
      var I = O[D];
      I === void 0 && (I = M.clone(), O[D] = I), M = I;
    }
    return M.visible = w.visible, M.wireframe = w.wireframe, T === ep ? M.side = w.shadowSide !== null ? w.shadowSide : w.side : M.side = w.shadowSide !== null ? w.shadowSide : d[w.side], M.alphaMap = w.alphaMap, M.alphaTest = w.alphaTest, M.map = w.map, M.clipShadows = w.clipShadows, M.clippingPlanes = w.clippingPlanes, M.clipIntersection = w.clipIntersection, M.displacementMap = w.displacementMap, M.displacementScale = w.displacementScale, M.displacementBias = w.displacementBias, M.wireframeLinewidth = w.wireframeLinewidth, M.linewidth = w.linewidth, A.isPointLight === !0 && M.isMeshDistanceMaterial === !0 && (M.referencePosition.setFromMatrixPosition(A.matrixWorld), M.nearDistance = E, M.farDistance = b), M;
  }
  function x(S, w, A, E, b) {
    if (S.visible === !1) return;
    if (S.layers.test(w.layers) && (S.isMesh || S.isLine || S.isPoints) && (S.castShadow || S.receiveShadow && b === ep) && (!S.frustumCulled || r.intersectsObject(S))) {
      S.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse, S.matrixWorld);
      var C = t.update(S),
        P = S.material;
      if (Array.isArray(P)) {
        var D = C.groups;
        for (var O = 0, I = D.length; O < I; O++) {
          var z = D[O],
            B = P[z.materialIndex];
          if (B && B.visible) {
            var V = v(S, B, E, A.near, A.far, b);
            n.renderBufferDirect(A, null, C, V, S, z);
          }
        }
      } else if (P.visible) {
        var _D3 = v(S, P, E, A.near, A.far, b);
        n.renderBufferDirect(A, null, C, _D3, S, null);
      }
    }
    var M = S.children;
    for (var _C4 = 0, _P3 = M.length; _C4 < _P3; _C4++) x(M[_C4], w, A, E, b);
  }
}
function AG(n, t, e) {
  var _oe3;
  var r = e.isWebGL2;
  function i() {
    var Q = !1,
      ce = new He(),
      ve = null,
      ze = new He(0, 0, 0, 0);
    return {
      setMask: function setMask(Fe) {
        ve !== Fe && !Q && (n.colorMask(Fe, Fe, Fe, Fe), ve = Fe);
      },
      setLocked: function setLocked(Fe) {
        Q = Fe;
      },
      setClear: function setClear(Fe, Ot, ri, jr, ec) {
        ec === !0 && (Fe *= jr, Ot *= jr, ri *= jr), ce.set(Fe, Ot, ri, jr), ze.equals(ce) === !1 && (n.clearColor(Fe, Ot, ri, jr), ze.copy(ce));
      },
      reset: function reset() {
        Q = !1, ve = null, ze.set(-1, 0, 0, 0);
      }
    };
  }
  function s() {
    var Q = !1,
      ce = null,
      ve = null,
      ze = null;
    return {
      setTest: function setTest(Fe) {
        Fe ? J(2929) : Z(2929);
      },
      setMask: function setMask(Fe) {
        ce !== Fe && !Q && (n.depthMask(Fe), ce = Fe);
      },
      setFunc: function setFunc(Fe) {
        if (ve !== Fe) {
          switch (Fe) {
            case eF:
              n.depthFunc(512);
              break;
            case tF:
              n.depthFunc(519);
              break;
            case rF:
              n.depthFunc(513);
              break;
            case wS:
              n.depthFunc(515);
              break;
            case iF:
              n.depthFunc(514);
              break;
            case nF:
              n.depthFunc(518);
              break;
            case sF:
              n.depthFunc(516);
              break;
            case oF:
              n.depthFunc(517);
              break;
            default:
              n.depthFunc(515);
          }
          ve = Fe;
        }
      },
      setLocked: function setLocked(Fe) {
        Q = Fe;
      },
      setClear: function setClear(Fe) {
        ze !== Fe && (n.clearDepth(Fe), ze = Fe);
      },
      reset: function reset() {
        Q = !1, ce = null, ve = null, ze = null;
      }
    };
  }
  function o() {
    var Q = !1,
      ce = null,
      ve = null,
      ze = null,
      Fe = null,
      Ot = null,
      ri = null,
      jr = null,
      ec = null;
    return {
      setTest: function setTest(_r) {
        Q || (_r ? J(2960) : Z(2960));
      },
      setMask: function setMask(_r) {
        ce !== _r && !Q && (n.stencilMask(_r), ce = _r);
      },
      setFunc: function setFunc(_r, Qo, $n) {
        (ve !== _r || ze !== Qo || Fe !== $n) && (n.stencilFunc(_r, Qo, $n), ve = _r, ze = Qo, Fe = $n);
      },
      setOp: function setOp(_r, Qo, $n) {
        (Ot !== _r || ri !== Qo || jr !== $n) && (n.stencilOp(_r, Qo, $n), Ot = _r, ri = Qo, jr = $n);
      },
      setLocked: function setLocked(_r) {
        Q = _r;
      },
      setClear: function setClear(_r) {
        ec !== _r && (n.clearStencil(_r), ec = _r);
      },
      reset: function reset() {
        Q = !1, ce = null, ve = null, ze = null, Fe = null, Ot = null, ri = null, jr = null, ec = null;
      }
    };
  }
  var a = new i(),
    l = new s(),
    u = new o(),
    c = new WeakMap(),
    d = new WeakMap(),
    h = {},
    f = {},
    p = new WeakMap(),
    m = [],
    g = null,
    y = !1,
    v = null,
    x = null,
    S = null,
    w = null,
    A = null,
    E = null,
    b = null,
    T = !1,
    M = null,
    C = null,
    P = null,
    D = null,
    O = null,
    I = n.getParameter(35661),
    z = !1,
    B = 0,
    V = n.getParameter(7938);
  V.indexOf("WebGL") !== -1 ? (B = parseFloat(/^WebGL (\d)/.exec(V)[1]), z = B >= 1) : V.indexOf("OpenGL ES") !== -1 && (B = parseFloat(/^OpenGL ES (\d)/.exec(V)[1]), z = B >= 2);
  var U = null,
    j = {},
    W = n.getParameter(3088),
    k = n.getParameter(2978),
    H = new He().fromArray(W),
    X = new He().fromArray(k);
  function q(Q, ce, ve) {
    var ze = new Uint8Array(4),
      Fe = n.createTexture();
    n.bindTexture(Q, Fe), n.texParameteri(Q, 10241, 9728), n.texParameteri(Q, 10240, 9728);
    for (var Ot = 0; Ot < ve; Ot++) n.texImage2D(ce + Ot, 0, 6408, 1, 1, 0, 6408, 5121, ze);
    return Fe;
  }
  var G = {};
  G[3553] = q(3553, 3553, 1), G[34067] = q(34067, 34069, 6), a.setClear(0, 0, 0, 1), l.setClear(1), u.setClear(0), J(2929), l.setFunc(wS), Ie(!1), Oe(HE), J(2884), _e(Wt);
  function J(Q) {
    h[Q] !== !0 && (n.enable(Q), h[Q] = !0);
  }
  function Z(Q) {
    h[Q] !== !1 && (n.disable(Q), h[Q] = !1);
  }
  function K(Q, ce) {
    return f[Q] !== ce ? (n.bindFramebuffer(Q, ce), f[Q] = ce, r && (Q === 36009 && (f[36160] = ce), Q === 36160 && (f[36009] = ce)), !0) : !1;
  }
  function Y(Q, ce) {
    var ve = m,
      ze = !1;
    if (Q) {
      if (ve = p.get(ce), ve === void 0 && (ve = [], p.set(ce, ve)), Q.isWebGLMultipleRenderTargets) {
        var Fe = Q.texture;
        if (ve.length !== Fe.length || ve[0] !== 36064) {
          for (var Ot = 0, ri = Fe.length; Ot < ri; Ot++) ve[Ot] = 36064 + Ot;
          ve.length = Fe.length, ze = !0;
        }
      } else ve[0] !== 36064 && (ve[0] = 36064, ze = !0);
    } else ve[0] !== 1029 && (ve[0] = 1029, ze = !0);
    ze && (e.isWebGL2 ? n.drawBuffers(ve) : t.get("WEBGL_draw_buffers").drawBuffersWEBGL(ve));
  }
  function ye(Q) {
    return g !== Q ? (n.useProgram(Q), g = Q, !0) : !1;
  }
  var fe = _defineProperty(_defineProperty(_defineProperty({}, Au, 32774), jN, 32778), HN, 32779);
  if (r) fe[XE] = 32775, fe[QE] = 32776;else {
    var Q = t.get("EXT_blend_minmax");
    Q !== null && (fe[XE] = Q.MIN_EXT, fe[QE] = Q.MAX_EXT);
  }
  var oe = (_oe3 = {}, _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_oe3, WN, 0), qN, 1), YN, 768), wM, 770), $N, 776), ZN, 774), QN, 772), XN, 769), AM, 771), JN, 775), _defineProperty(_oe3, KN, 773));
  function _e(Q, ce, ve, ze, Fe, Ot, ri, jr) {
    if (Q === Wt) {
      y === !0 && (Z(3042), y = !1);
      return;
    }
    if (y === !1 && (J(3042), y = !0), Q !== GN) {
      if (Q !== v || jr !== T) {
        if ((x !== Au || A !== Au) && (n.blendEquation(32774), x = Au, A = Au), jr) switch (Q) {
          case qa:
            n.blendFuncSeparate(1, 771, 1, 771);
            break;
          case WE:
            n.blendFunc(1, 1);
            break;
          case qE:
            n.blendFuncSeparate(0, 769, 0, 1);
            break;
          case YE:
            n.blendFuncSeparate(0, 768, 0, 770);
            break;
          default:
            console.error("THREE.WebGLState: Invalid blending: ", Q);
            break;
        } else switch (Q) {
          case qa:
            n.blendFuncSeparate(770, 771, 1, 771);
            break;
          case WE:
            n.blendFunc(770, 1);
            break;
          case qE:
            n.blendFuncSeparate(0, 769, 0, 1);
            break;
          case YE:
            n.blendFunc(0, 768);
            break;
          default:
            console.error("THREE.WebGLState: Invalid blending: ", Q);
            break;
        }
        S = null, w = null, E = null, b = null, v = Q, T = jr;
      }
      return;
    }
    Fe = Fe || ce, Ot = Ot || ve, ri = ri || ze, (ce !== x || Fe !== A) && (n.blendEquationSeparate(fe[ce], fe[Fe]), x = ce, A = Fe), (ve !== S || ze !== w || Ot !== E || ri !== b) && (n.blendFuncSeparate(oe[ve], oe[ze], oe[Ot], oe[ri]), S = ve, w = ze, E = Ot, b = ri), v = Q, T = !1;
  }
  function xe(Q, ce) {
    Q.side === qi ? Z(2884) : J(2884);
    var ve = Q.side === ai;
    ce && (ve = !ve), Ie(ve), Q.blending === qa && Q.transparent === !1 ? _e(Wt) : _e(Q.blending, Q.blendEquation, Q.blendSrc, Q.blendDst, Q.blendEquationAlpha, Q.blendSrcAlpha, Q.blendDstAlpha, Q.premultipliedAlpha), l.setFunc(Q.depthFunc), l.setTest(Q.depthTest), l.setMask(Q.depthWrite), a.setMask(Q.colorWrite);
    var ze = Q.stencilWrite;
    u.setTest(ze), ze && (u.setMask(Q.stencilWriteMask), u.setFunc(Q.stencilFunc, Q.stencilRef, Q.stencilFuncMask), u.setOp(Q.stencilFail, Q.stencilZFail, Q.stencilZPass)), Te(Q.polygonOffset, Q.polygonOffsetFactor, Q.polygonOffsetUnits), Q.alphaToCoverage === !0 ? J(32926) : Z(32926);
  }
  function Ie(Q) {
    M !== Q && (Q ? n.frontFace(2304) : n.frontFace(2305), M = Q);
  }
  function Oe(Q) {
    Q !== zN ? (J(2884), Q !== C && (Q === HE ? n.cullFace(1029) : Q === VN ? n.cullFace(1028) : n.cullFace(1032))) : Z(2884), C = Q;
  }
  function Pe(Q) {
    Q !== P && (z && n.lineWidth(Q), P = Q);
  }
  function Te(Q, ce, ve) {
    Q ? (J(32823), (D !== ce || O !== ve) && (n.polygonOffset(ce, ve), D = ce, O = ve)) : Z(32823);
  }
  function Ve(Q) {
    Q ? J(3089) : Z(3089);
  }
  function Ue(Q) {
    Q === void 0 && (Q = 33984 + I - 1), U !== Q && (n.activeTexture(Q), U = Q);
  }
  function L(Q, ce, ve) {
    ve === void 0 && (U === null ? ve = 33984 + I - 1 : ve = U);
    var ze = j[ve];
    ze === void 0 && (ze = {
      type: void 0,
      texture: void 0
    }, j[ve] = ze), (ze.type !== Q || ze.texture !== ce) && (U !== ve && (n.activeTexture(ve), U = ve), n.bindTexture(Q, ce || G[Q]), ze.type = Q, ze.texture = ce);
  }
  function R() {
    var Q = j[U];
    Q !== void 0 && Q.type !== void 0 && (n.bindTexture(Q.type, null), Q.type = void 0, Q.texture = void 0);
  }
  function ie() {
    try {
      n.compressedTexImage2D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function ue() {
    try {
      n.compressedTexImage3D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function me() {
    try {
      n.texSubImage2D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function De() {
    try {
      n.texSubImage3D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function Me() {
    try {
      n.compressedTexSubImage2D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function Ee() {
    try {
      n.compressedTexSubImage3D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function le() {
    try {
      n.texStorage2D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function Je() {
    try {
      n.texStorage3D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function ke() {
    try {
      n.texImage2D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function Be() {
    try {
      n.texImage3D.apply(n, arguments);
    } catch (Q) {
      console.error("THREE.WebGLState:", Q);
    }
  }
  function qe(Q) {
    H.equals(Q) === !1 && (n.scissor(Q.x, Q.y, Q.z, Q.w), H.copy(Q));
  }
  function et(Q) {
    X.equals(Q) === !1 && (n.viewport(Q.x, Q.y, Q.z, Q.w), X.copy(Q));
  }
  function Dt(Q, ce) {
    var ve = d.get(ce);
    ve === void 0 && (ve = new WeakMap(), d.set(ce, ve));
    var ze = ve.get(Q);
    ze === void 0 && (ze = n.getUniformBlockIndex(ce, Q.name), ve.set(Q, ze));
  }
  function yr(Q, ce) {
    var ze = d.get(ce).get(Q);
    c.get(ce) !== ze && (n.uniformBlockBinding(ce, ze, Q.__bindingPointIndex), c.set(ce, ze));
  }
  function ti() {
    n.disable(3042), n.disable(2884), n.disable(2929), n.disable(32823), n.disable(3089), n.disable(2960), n.disable(32926), n.blendEquation(32774), n.blendFunc(1, 0), n.blendFuncSeparate(1, 0, 1, 0), n.colorMask(!0, !0, !0, !0), n.clearColor(0, 0, 0, 0), n.depthMask(!0), n.depthFunc(513), n.clearDepth(1), n.stencilMask(4294967295), n.stencilFunc(519, 0, 4294967295), n.stencilOp(7680, 7680, 7680), n.clearStencil(0), n.cullFace(1029), n.frontFace(2305), n.polygonOffset(0, 0), n.activeTexture(33984), n.bindFramebuffer(36160, null), r === !0 && (n.bindFramebuffer(36009, null), n.bindFramebuffer(36008, null)), n.useProgram(null), n.lineWidth(1), n.scissor(0, 0, n.canvas.width, n.canvas.height), n.viewport(0, 0, n.canvas.width, n.canvas.height), h = {}, U = null, j = {}, f = {}, p = new WeakMap(), m = [], g = null, y = !1, v = null, x = null, S = null, w = null, A = null, E = null, b = null, T = !1, M = null, C = null, P = null, D = null, O = null, H.set(0, 0, n.canvas.width, n.canvas.height), X.set(0, 0, n.canvas.width, n.canvas.height), a.reset(), l.reset(), u.reset();
  }
  return {
    buffers: {
      color: a,
      depth: l,
      stencil: u
    },
    enable: J,
    disable: Z,
    bindFramebuffer: K,
    drawBuffers: Y,
    useProgram: ye,
    setBlending: _e,
    setMaterial: xe,
    setFlipSided: Ie,
    setCullFace: Oe,
    setLineWidth: Pe,
    setPolygonOffset: Te,
    setScissorTest: Ve,
    activeTexture: Ue,
    bindTexture: L,
    unbindTexture: R,
    compressedTexImage2D: ie,
    compressedTexImage3D: ue,
    texImage2D: ke,
    texImage3D: Be,
    updateUBOMapping: Dt,
    uniformBlockBinding: yr,
    texStorage2D: le,
    texStorage3D: Je,
    texSubImage2D: me,
    texSubImage3D: De,
    compressedTexSubImage2D: Me,
    compressedTexSubImage3D: Ee,
    scissor: qe,
    viewport: et,
    reset: ti
  };
}
function _G(n, t, e, r, i, s, o) {
  var a = i.isWebGL2,
    l = i.maxTextures,
    u = i.maxCubemapSize,
    c = i.maxTextureSize,
    d = i.maxSamples,
    h = t.has("WEBGL_multisampled_render_to_texture") ? t.get("WEBGL_multisampled_render_to_texture") : null,
    f = (typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) > "u" ? !1 : /OculusBrowser/g.test(navigator.userAgent),
    p = new WeakMap(),
    m,
    g = new WeakMap(),
    y = !1;
  try {
    y = (typeof OffscreenCanvas === "undefined" ? "undefined" : _typeof(OffscreenCanvas)) < "u" && new OffscreenCanvas(1, 1).getContext("2d") !== null;
  } catch (_unused8) {}
  function v(L, R) {
    return y ? new OffscreenCanvas(L, R) : cp("canvas");
  }
  function x(L, R, ie, ue) {
    var me = 1;
    if ((L.width > ue || L.height > ue) && (me = ue / Math.max(L.width, L.height)), me < 1 || R === !0) if ((typeof HTMLImageElement === "undefined" ? "undefined" : _typeof(HTMLImageElement)) < "u" && L instanceof HTMLImageElement || (typeof HTMLCanvasElement === "undefined" ? "undefined" : _typeof(HTMLCanvasElement)) < "u" && L instanceof HTMLCanvasElement || (typeof ImageBitmap === "undefined" ? "undefined" : _typeof(ImageBitmap)) < "u" && L instanceof ImageBitmap) {
      var De = R ? ey : Math.floor,
        Me = De(me * L.width),
        Ee = De(me * L.height);
      m === void 0 && (m = v(Me, Ee));
      var le = ie ? v(Me, Ee) : m;
      return le.width = Me, le.height = Ee, le.getContext("2d").drawImage(L, 0, 0, Me, Ee), console.warn("THREE.WebGLRenderer: Texture has been resized from (" + L.width + "x" + L.height + ") to (" + Me + "x" + Ee + ")."), le;
    } else return "data" in L && console.warn("THREE.WebGLRenderer: Image in DataTexture is too big (" + L.width + "x" + L.height + ")."), L;
    return L;
  }
  function S(L) {
    return CS(L.width) && CS(L.height);
  }
  function w(L) {
    return a ? !1 : L.wrapS !== Ut || L.wrapT !== Ut || L.minFilter !== Et && L.minFilter !== Qe;
  }
  function A(L, R) {
    return L.generateMipmaps && R && L.minFilter !== Et && L.minFilter !== Qe;
  }
  function E(L) {
    n.generateMipmap(L);
  }
  function b(L, R, ie, ue) {
    var me = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
    if (a === !1) return R;
    if (L !== null) {
      if (n[L] !== void 0) return n[L];
      console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '" + L + "'");
    }
    var De = R;
    return R === 6403 && (ie === 5126 && (De = 33326), ie === 5131 && (De = 33325), ie === 5121 && (De = 33321)), R === 33319 && (ie === 5126 && (De = 33328), ie === 5131 && (De = 33327), ie === 5121 && (De = 33323)), R === 6408 && (ie === 5126 && (De = 34836), ie === 5131 && (De = 34842), ie === 5121 && (De = ue === tt && me === !1 ? 35907 : 32856), ie === 32819 && (De = 32854), ie === 32820 && (De = 32855)), (De === 33325 || De === 33326 || De === 33327 || De === 33328 || De === 34842 || De === 34836) && t.get("EXT_color_buffer_float"), De;
  }
  function T(L, R, ie) {
    return A(L, ie) === !0 || L.isFramebufferTexture && L.minFilter !== Et && L.minFilter !== Qe ? Math.log2(Math.max(R.width, R.height)) + 1 : L.mipmaps !== void 0 && L.mipmaps.length > 0 ? L.mipmaps.length : L.isCompressedTexture && Array.isArray(L.image) ? R.mipmaps.length : 1;
  }
  function M(L) {
    return L === Et || L === KE || L === zb ? 9728 : 9729;
  }
  function C(L) {
    var R = L.target;
    R.removeEventListener("dispose", C), D(R), R.isVideoTexture && p.delete(R);
  }
  function P(L) {
    var R = L.target;
    R.removeEventListener("dispose", P), I(R);
  }
  function D(L) {
    var R = r.get(L);
    if (R.__webglInit === void 0) return;
    var ie = L.source,
      ue = g.get(ie);
    if (ue) {
      var me = ue[R.__cacheKey];
      me.usedTimes--, me.usedTimes === 0 && O(L), Object.keys(ue).length === 0 && g.delete(ie);
    }
    r.remove(L);
  }
  function O(L) {
    var R = r.get(L);
    n.deleteTexture(R.__webglTexture);
    var ie = L.source,
      ue = g.get(ie);
    delete ue[R.__cacheKey], o.memory.textures--;
  }
  function I(L) {
    var R = L.texture,
      ie = r.get(L),
      ue = r.get(R);
    if (ue.__webglTexture !== void 0 && (n.deleteTexture(ue.__webglTexture), o.memory.textures--), L.depthTexture && L.depthTexture.dispose(), L.isWebGLCubeRenderTarget) for (var me = 0; me < 6; me++) n.deleteFramebuffer(ie.__webglFramebuffer[me]), ie.__webglDepthbuffer && n.deleteRenderbuffer(ie.__webglDepthbuffer[me]);else {
      if (n.deleteFramebuffer(ie.__webglFramebuffer), ie.__webglDepthbuffer && n.deleteRenderbuffer(ie.__webglDepthbuffer), ie.__webglMultisampledFramebuffer && n.deleteFramebuffer(ie.__webglMultisampledFramebuffer), ie.__webglColorRenderbuffer) for (var _me = 0; _me < ie.__webglColorRenderbuffer.length; _me++) ie.__webglColorRenderbuffer[_me] && n.deleteRenderbuffer(ie.__webglColorRenderbuffer[_me]);
      ie.__webglDepthRenderbuffer && n.deleteRenderbuffer(ie.__webglDepthRenderbuffer);
    }
    if (L.isWebGLMultipleRenderTargets) for (var _me2 = 0, De = R.length; _me2 < De; _me2++) {
      var Me = r.get(R[_me2]);
      Me.__webglTexture && (n.deleteTexture(Me.__webglTexture), o.memory.textures--), r.remove(R[_me2]);
    }
    r.remove(R), r.remove(L);
  }
  var z = 0;
  function B() {
    z = 0;
  }
  function V() {
    var L = z;
    return L >= l && console.warn("THREE.WebGLTextures: Trying to use " + L + " texture units while this GPU supports only " + l), z += 1, L;
  }
  function U(L) {
    var R = [];
    return R.push(L.wrapS), R.push(L.wrapT), R.push(L.wrapR || 0), R.push(L.magFilter), R.push(L.minFilter), R.push(L.anisotropy), R.push(L.internalFormat), R.push(L.format), R.push(L.type), R.push(L.generateMipmaps), R.push(L.premultiplyAlpha), R.push(L.flipY), R.push(L.unpackAlignment), R.push(L.encoding), R.join();
  }
  function j(L, R) {
    var ie = r.get(L);
    if (L.isVideoTexture && Ve(L), L.isRenderTargetTexture === !1 && L.version > 0 && ie.__version !== L.version) {
      var ue = L.image;
      if (ue === null) console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if (ue.complete === !1) console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else {
        Z(ie, L, R);
        return;
      }
    }
    e.bindTexture(3553, ie.__webglTexture, 33984 + R);
  }
  function W(L, R) {
    var ie = r.get(L);
    if (L.version > 0 && ie.__version !== L.version) {
      Z(ie, L, R);
      return;
    }
    e.bindTexture(35866, ie.__webglTexture, 33984 + R);
  }
  function k(L, R) {
    var ie = r.get(L);
    if (L.version > 0 && ie.__version !== L.version) {
      Z(ie, L, R);
      return;
    }
    e.bindTexture(32879, ie.__webglTexture, 33984 + R);
  }
  function H(L, R) {
    var ie = r.get(L);
    if (L.version > 0 && ie.__version !== L.version) {
      K(ie, L, R);
      return;
    }
    e.bindTexture(34067, ie.__webglTexture, 33984 + R);
  }
  var X = _defineProperty(_defineProperty(_defineProperty({}, Is, 10497), Ut, 33071), ES, 33648),
    q = _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({}, Et, 9728), KE, 9984), zb, 9986), Qe, 9729), pF, 9985), dc, 9987);
  function G(L, R, ie) {
    if (ie ? (n.texParameteri(L, 10242, X[R.wrapS]), n.texParameteri(L, 10243, X[R.wrapT]), (L === 32879 || L === 35866) && n.texParameteri(L, 32882, X[R.wrapR]), n.texParameteri(L, 10240, q[R.magFilter]), n.texParameteri(L, 10241, q[R.minFilter])) : (n.texParameteri(L, 10242, 33071), n.texParameteri(L, 10243, 33071), (L === 32879 || L === 35866) && n.texParameteri(L, 32882, 33071), (R.wrapS !== Ut || R.wrapT !== Ut) && console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."), n.texParameteri(L, 10240, M(R.magFilter)), n.texParameteri(L, 10241, M(R.minFilter)), R.minFilter !== Et && R.minFilter !== Qe && console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")), t.has("EXT_texture_filter_anisotropic") === !0) {
      var ue = t.get("EXT_texture_filter_anisotropic");
      if (R.magFilter === Et || R.minFilter !== zb && R.minFilter !== dc || R.type === dr && t.has("OES_texture_float_linear") === !1 || a === !1 && R.type === sa && t.has("OES_texture_half_float_linear") === !1) return;
      (R.anisotropy > 1 || r.get(R).__currentAnisotropy) && (n.texParameterf(L, ue.TEXTURE_MAX_ANISOTROPY_EXT, Math.min(R.anisotropy, i.getMaxAnisotropy())), r.get(R).__currentAnisotropy = R.anisotropy);
    }
  }
  function J(L, R) {
    var ie = !1;
    L.__webglInit === void 0 && (L.__webglInit = !0, R.addEventListener("dispose", C));
    var ue = R.source,
      me = g.get(ue);
    me === void 0 && (me = {}, g.set(ue, me));
    var De = U(R);
    if (De !== L.__cacheKey) {
      me[De] === void 0 && (me[De] = {
        texture: n.createTexture(),
        usedTimes: 0
      }, o.memory.textures++, ie = !0), me[De].usedTimes++;
      var Me = me[L.__cacheKey];
      Me !== void 0 && (me[L.__cacheKey].usedTimes--, Me.usedTimes === 0 && O(R)), L.__cacheKey = De, L.__webglTexture = me[De].texture;
    }
    return ie;
  }
  function Z(L, R, ie) {
    var ue = 3553;
    (R.isDataArrayTexture || R.isCompressedArrayTexture) && (ue = 35866), R.isData3DTexture && (ue = 32879);
    var me = J(L, R),
      De = R.source;
    e.bindTexture(ue, L.__webglTexture, 33984 + ie);
    var Me = r.get(De);
    if (De.version !== Me.__version || me === !0) {
      e.activeTexture(33984 + ie), n.pixelStorei(37440, R.flipY), n.pixelStorei(37441, R.premultiplyAlpha), n.pixelStorei(3317, R.unpackAlignment), n.pixelStorei(37443, 0);
      var Ee = w(R) && S(R.image) === !1,
        le = x(R.image, Ee, !1, c);
      le = Ue(R, le);
      var Je = S(le) || a,
        ke = s.convert(R.format, R.encoding),
        Be = s.convert(R.type),
        qe = b(R.internalFormat, ke, Be, R.encoding, R.isVideoTexture);
      G(ue, R, Je);
      var et,
        Dt = R.mipmaps,
        yr = a && R.isVideoTexture !== !0,
        ti = Me.__version === void 0 || me === !0,
        Q = T(R, le, Je);
      if (R.isDepthTexture) qe = 6402, a ? R.type === dr ? qe = 36012 : R.type === Ds ? qe = 33190 : R.type === Ya ? qe = 35056 : qe = 33189 : R.type === dr && console.error("WebGLRenderer: Floating point depth texture requires WebGL2."), R.format === cc && qe === 6402 && R.type !== TM && R.type !== Ds && (console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."), R.type = Ds, Be = s.convert(R.type)), R.format === Ka && qe === 6402 && (qe = 34041, R.type !== Ya && (console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."), R.type = Ya, Be = s.convert(R.type))), ti && (yr ? e.texStorage2D(3553, 1, qe, le.width, le.height) : e.texImage2D(3553, 0, qe, le.width, le.height, 0, ke, Be, null));else if (R.isDataTexture) {
        if (Dt.length > 0 && Je) {
          yr && ti && e.texStorage2D(3553, Q, qe, Dt[0].width, Dt[0].height);
          for (var ce = 0, ve = Dt.length; ce < ve; ce++) et = Dt[ce], yr ? e.texSubImage2D(3553, ce, 0, 0, et.width, et.height, ke, Be, et.data) : e.texImage2D(3553, ce, qe, et.width, et.height, 0, ke, Be, et.data);
          R.generateMipmaps = !1;
        } else yr ? (ti && e.texStorage2D(3553, Q, qe, le.width, le.height), e.texSubImage2D(3553, 0, 0, 0, le.width, le.height, ke, Be, le.data)) : e.texImage2D(3553, 0, qe, le.width, le.height, 0, ke, Be, le.data);
      } else if (R.isCompressedTexture) {
        if (R.isCompressedArrayTexture) {
          yr && ti && e.texStorage3D(35866, Q, qe, Dt[0].width, Dt[0].height, le.depth);
          for (var _ce = 0, _ve = Dt.length; _ce < _ve; _ce++) et = Dt[_ce], R.format !== Fr ? ke !== null ? yr ? e.compressedTexSubImage3D(35866, _ce, 0, 0, 0, et.width, et.height, le.depth, ke, et.data, 0, 0) : e.compressedTexImage3D(35866, _ce, qe, et.width, et.height, le.depth, 0, et.data, 0, 0) : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()") : yr ? e.texSubImage3D(35866, _ce, 0, 0, 0, et.width, et.height, le.depth, ke, Be, et.data) : e.texImage3D(35866, _ce, qe, et.width, et.height, le.depth, 0, ke, Be, et.data);
        } else {
          yr && ti && e.texStorage2D(3553, Q, qe, Dt[0].width, Dt[0].height);
          for (var _ce2 = 0, _ve2 = Dt.length; _ce2 < _ve2; _ce2++) et = Dt[_ce2], R.format !== Fr ? ke !== null ? yr ? e.compressedTexSubImage2D(3553, _ce2, 0, 0, et.width, et.height, ke, et.data) : e.compressedTexImage2D(3553, _ce2, qe, et.width, et.height, 0, et.data) : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()") : yr ? e.texSubImage2D(3553, _ce2, 0, 0, et.width, et.height, ke, Be, et.data) : e.texImage2D(3553, _ce2, qe, et.width, et.height, 0, ke, Be, et.data);
        }
      } else if (R.isDataArrayTexture) yr ? (ti && e.texStorage3D(35866, Q, qe, le.width, le.height, le.depth), e.texSubImage3D(35866, 0, 0, 0, 0, le.width, le.height, le.depth, ke, Be, le.data)) : e.texImage3D(35866, 0, qe, le.width, le.height, le.depth, 0, ke, Be, le.data);else if (R.isData3DTexture) yr ? (ti && e.texStorage3D(32879, Q, qe, le.width, le.height, le.depth), e.texSubImage3D(32879, 0, 0, 0, 0, le.width, le.height, le.depth, ke, Be, le.data)) : e.texImage3D(32879, 0, qe, le.width, le.height, le.depth, 0, ke, Be, le.data);else if (R.isFramebufferTexture) {
        if (ti) if (yr) e.texStorage2D(3553, Q, qe, le.width, le.height);else {
          var _ce3 = le.width,
            _ve3 = le.height;
          for (var ze = 0; ze < Q; ze++) e.texImage2D(3553, ze, qe, _ce3, _ve3, 0, ke, Be, null), _ce3 >>= 1, _ve3 >>= 1;
        }
      } else if (Dt.length > 0 && Je) {
        yr && ti && e.texStorage2D(3553, Q, qe, Dt[0].width, Dt[0].height);
        for (var _ce4 = 0, _ve4 = Dt.length; _ce4 < _ve4; _ce4++) et = Dt[_ce4], yr ? e.texSubImage2D(3553, _ce4, 0, 0, ke, Be, et) : e.texImage2D(3553, _ce4, qe, ke, Be, et);
        R.generateMipmaps = !1;
      } else yr ? (ti && e.texStorage2D(3553, Q, qe, le.width, le.height), e.texSubImage2D(3553, 0, 0, 0, ke, Be, le)) : e.texImage2D(3553, 0, qe, ke, Be, le);
      A(R, Je) && E(ue), Me.__version = De.version, R.onUpdate && R.onUpdate(R);
    }
    L.__version = R.version;
  }
  function K(L, R, ie) {
    if (R.image.length !== 6) return;
    var ue = J(L, R),
      me = R.source;
    e.bindTexture(34067, L.__webglTexture, 33984 + ie);
    var De = r.get(me);
    if (me.version !== De.__version || ue === !0) {
      e.activeTexture(33984 + ie), n.pixelStorei(37440, R.flipY), n.pixelStorei(37441, R.premultiplyAlpha), n.pixelStorei(3317, R.unpackAlignment), n.pixelStorei(37443, 0);
      var Me = R.isCompressedTexture || R.image[0].isCompressedTexture,
        Ee = R.image[0] && R.image[0].isDataTexture,
        le = [];
      for (var ce = 0; ce < 6; ce++) !Me && !Ee ? le[ce] = x(R.image[ce], !1, !0, u) : le[ce] = Ee ? R.image[ce].image : R.image[ce], le[ce] = Ue(R, le[ce]);
      var Je = le[0],
        ke = S(Je) || a,
        Be = s.convert(R.format, R.encoding),
        qe = s.convert(R.type),
        et = b(R.internalFormat, Be, qe, R.encoding),
        Dt = a && R.isVideoTexture !== !0,
        yr = De.__version === void 0 || ue === !0,
        ti = T(R, Je, ke);
      G(34067, R, ke);
      var Q;
      if (Me) {
        Dt && yr && e.texStorage2D(34067, ti, et, Je.width, Je.height);
        for (var _ce5 = 0; _ce5 < 6; _ce5++) {
          Q = le[_ce5].mipmaps;
          for (var ve = 0; ve < Q.length; ve++) {
            var ze = Q[ve];
            R.format !== Fr ? Be !== null ? Dt ? e.compressedTexSubImage2D(34069 + _ce5, ve, 0, 0, ze.width, ze.height, Be, ze.data) : e.compressedTexImage2D(34069 + _ce5, ve, et, ze.width, ze.height, 0, ze.data) : console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()") : Dt ? e.texSubImage2D(34069 + _ce5, ve, 0, 0, ze.width, ze.height, Be, qe, ze.data) : e.texImage2D(34069 + _ce5, ve, et, ze.width, ze.height, 0, Be, qe, ze.data);
          }
        }
      } else {
        Q = R.mipmaps, Dt && yr && (Q.length > 0 && ti++, e.texStorage2D(34067, ti, et, le[0].width, le[0].height));
        for (var _ce6 = 0; _ce6 < 6; _ce6++) if (Ee) {
          Dt ? e.texSubImage2D(34069 + _ce6, 0, 0, 0, le[_ce6].width, le[_ce6].height, Be, qe, le[_ce6].data) : e.texImage2D(34069 + _ce6, 0, et, le[_ce6].width, le[_ce6].height, 0, Be, qe, le[_ce6].data);
          for (var _ve5 = 0; _ve5 < Q.length; _ve5++) {
            var Fe = Q[_ve5].image[_ce6].image;
            Dt ? e.texSubImage2D(34069 + _ce6, _ve5 + 1, 0, 0, Fe.width, Fe.height, Be, qe, Fe.data) : e.texImage2D(34069 + _ce6, _ve5 + 1, et, Fe.width, Fe.height, 0, Be, qe, Fe.data);
          }
        } else {
          Dt ? e.texSubImage2D(34069 + _ce6, 0, 0, 0, Be, qe, le[_ce6]) : e.texImage2D(34069 + _ce6, 0, et, Be, qe, le[_ce6]);
          for (var _ve6 = 0; _ve6 < Q.length; _ve6++) {
            var _ze = Q[_ve6];
            Dt ? e.texSubImage2D(34069 + _ce6, _ve6 + 1, 0, 0, Be, qe, _ze.image[_ce6]) : e.texImage2D(34069 + _ce6, _ve6 + 1, et, Be, qe, _ze.image[_ce6]);
          }
        }
      }
      A(R, ke) && E(34067), De.__version = me.version, R.onUpdate && R.onUpdate(R);
    }
    L.__version = R.version;
  }
  function Y(L, R, ie, ue, me) {
    var De = s.convert(ie.format, ie.encoding),
      Me = s.convert(ie.type),
      Ee = b(ie.internalFormat, De, Me, ie.encoding);
    r.get(R).__hasExternalTextures || (me === 32879 || me === 35866 ? e.texImage3D(me, 0, Ee, R.width, R.height, R.depth, 0, De, Me, null) : e.texImage2D(me, 0, Ee, R.width, R.height, 0, De, Me, null)), e.bindFramebuffer(36160, L), Te(R) ? h.framebufferTexture2DMultisampleEXT(36160, ue, me, r.get(ie).__webglTexture, 0, Pe(R)) : (me === 3553 || me >= 34069 && me <= 34074) && n.framebufferTexture2D(36160, ue, me, r.get(ie).__webglTexture, 0), e.bindFramebuffer(36160, null);
  }
  function ye(L, R, ie) {
    if (n.bindRenderbuffer(36161, L), R.depthBuffer && !R.stencilBuffer) {
      var ue = 33189;
      if (ie || Te(R)) {
        var me = R.depthTexture;
        me && me.isDepthTexture && (me.type === dr ? ue = 36012 : me.type === Ds && (ue = 33190));
        var De = Pe(R);
        Te(R) ? h.renderbufferStorageMultisampleEXT(36161, De, ue, R.width, R.height) : n.renderbufferStorageMultisample(36161, De, ue, R.width, R.height);
      } else n.renderbufferStorage(36161, ue, R.width, R.height);
      n.framebufferRenderbuffer(36160, 36096, 36161, L);
    } else if (R.depthBuffer && R.stencilBuffer) {
      var _ue = Pe(R);
      ie && Te(R) === !1 ? n.renderbufferStorageMultisample(36161, _ue, 35056, R.width, R.height) : Te(R) ? h.renderbufferStorageMultisampleEXT(36161, _ue, 35056, R.width, R.height) : n.renderbufferStorage(36161, 34041, R.width, R.height), n.framebufferRenderbuffer(36160, 33306, 36161, L);
    } else {
      var _ue2 = R.isWebGLMultipleRenderTargets === !0 ? R.texture : [R.texture];
      for (var _me3 = 0; _me3 < _ue2.length; _me3++) {
        var _De = _ue2[_me3],
          Me = s.convert(_De.format, _De.encoding),
          Ee = s.convert(_De.type),
          le = b(_De.internalFormat, Me, Ee, _De.encoding),
          Je = Pe(R);
        ie && Te(R) === !1 ? n.renderbufferStorageMultisample(36161, Je, le, R.width, R.height) : Te(R) ? h.renderbufferStorageMultisampleEXT(36161, Je, le, R.width, R.height) : n.renderbufferStorage(36161, le, R.width, R.height);
      }
    }
    n.bindRenderbuffer(36161, null);
  }
  function fe(L, R) {
    if (R && R.isWebGLCubeRenderTarget) throw new Error("Depth Texture with cube render targets is not supported");
    if (e.bindFramebuffer(36160, L), !(R.depthTexture && R.depthTexture.isDepthTexture)) throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");
    (!r.get(R.depthTexture).__webglTexture || R.depthTexture.image.width !== R.width || R.depthTexture.image.height !== R.height) && (R.depthTexture.image.width = R.width, R.depthTexture.image.height = R.height, R.depthTexture.needsUpdate = !0), j(R.depthTexture, 0);
    var ue = r.get(R.depthTexture).__webglTexture,
      me = Pe(R);
    if (R.depthTexture.format === cc) Te(R) ? h.framebufferTexture2DMultisampleEXT(36160, 36096, 3553, ue, 0, me) : n.framebufferTexture2D(36160, 36096, 3553, ue, 0);else if (R.depthTexture.format === Ka) Te(R) ? h.framebufferTexture2DMultisampleEXT(36160, 33306, 3553, ue, 0, me) : n.framebufferTexture2D(36160, 33306, 3553, ue, 0);else throw new Error("Unknown depthTexture format");
  }
  function oe(L) {
    var R = r.get(L),
      ie = L.isWebGLCubeRenderTarget === !0;
    if (L.depthTexture && !R.__autoAllocateDepthBuffer) {
      if (ie) throw new Error("target.depthTexture not supported in Cube render targets");
      fe(R.__webglFramebuffer, L);
    } else if (ie) {
      R.__webglDepthbuffer = [];
      for (var ue = 0; ue < 6; ue++) e.bindFramebuffer(36160, R.__webglFramebuffer[ue]), R.__webglDepthbuffer[ue] = n.createRenderbuffer(), ye(R.__webglDepthbuffer[ue], L, !1);
    } else e.bindFramebuffer(36160, R.__webglFramebuffer), R.__webglDepthbuffer = n.createRenderbuffer(), ye(R.__webglDepthbuffer, L, !1);
    e.bindFramebuffer(36160, null);
  }
  function _e(L, R, ie) {
    var ue = r.get(L);
    R !== void 0 && Y(ue.__webglFramebuffer, L, L.texture, 36064, 3553), ie !== void 0 && oe(L);
  }
  function xe(L) {
    var R = L.texture,
      ie = r.get(L),
      ue = r.get(R);
    L.addEventListener("dispose", P), L.isWebGLMultipleRenderTargets !== !0 && (ue.__webglTexture === void 0 && (ue.__webglTexture = n.createTexture()), ue.__version = R.version, o.memory.textures++);
    var me = L.isWebGLCubeRenderTarget === !0,
      De = L.isWebGLMultipleRenderTargets === !0,
      Me = S(L) || a;
    if (me) {
      ie.__webglFramebuffer = [];
      for (var Ee = 0; Ee < 6; Ee++) ie.__webglFramebuffer[Ee] = n.createFramebuffer();
    } else {
      if (ie.__webglFramebuffer = n.createFramebuffer(), De) if (i.drawBuffers) {
        var _Ee = L.texture;
        for (var le = 0, Je = _Ee.length; le < Je; le++) {
          var ke = r.get(_Ee[le]);
          ke.__webglTexture === void 0 && (ke.__webglTexture = n.createTexture(), o.memory.textures++);
        }
      } else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");
      if (a && L.samples > 0 && Te(L) === !1) {
        var _Ee2 = De ? R : [R];
        ie.__webglMultisampledFramebuffer = n.createFramebuffer(), ie.__webglColorRenderbuffer = [], e.bindFramebuffer(36160, ie.__webglMultisampledFramebuffer);
        for (var _le = 0; _le < _Ee2.length; _le++) {
          var _Je = _Ee2[_le];
          ie.__webglColorRenderbuffer[_le] = n.createRenderbuffer(), n.bindRenderbuffer(36161, ie.__webglColorRenderbuffer[_le]);
          var _ke = s.convert(_Je.format, _Je.encoding),
            Be = s.convert(_Je.type),
            qe = b(_Je.internalFormat, _ke, Be, _Je.encoding, L.isXRRenderTarget === !0),
            et = Pe(L);
          n.renderbufferStorageMultisample(36161, et, qe, L.width, L.height), n.framebufferRenderbuffer(36160, 36064 + _le, 36161, ie.__webglColorRenderbuffer[_le]);
        }
        n.bindRenderbuffer(36161, null), L.depthBuffer && (ie.__webglDepthRenderbuffer = n.createRenderbuffer(), ye(ie.__webglDepthRenderbuffer, L, !0)), e.bindFramebuffer(36160, null);
      }
    }
    if (me) {
      e.bindTexture(34067, ue.__webglTexture), G(34067, R, Me);
      for (var _Ee3 = 0; _Ee3 < 6; _Ee3++) Y(ie.__webglFramebuffer[_Ee3], L, R, 36064, 34069 + _Ee3);
      A(R, Me) && E(34067), e.unbindTexture();
    } else if (De) {
      var _Ee4 = L.texture;
      for (var _le2 = 0, _Je2 = _Ee4.length; _le2 < _Je2; _le2++) {
        var _ke2 = _Ee4[_le2],
          _Be = r.get(_ke2);
        e.bindTexture(3553, _Be.__webglTexture), G(3553, _ke2, Me), Y(ie.__webglFramebuffer, L, _ke2, 36064 + _le2, 3553), A(_ke2, Me) && E(3553);
      }
      e.unbindTexture();
    } else {
      var _Ee5 = 3553;
      (L.isWebGL3DRenderTarget || L.isWebGLArrayRenderTarget) && (a ? _Ee5 = L.isWebGL3DRenderTarget ? 32879 : 35866 : console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")), e.bindTexture(_Ee5, ue.__webglTexture), G(_Ee5, R, Me), Y(ie.__webglFramebuffer, L, R, 36064, _Ee5), A(R, Me) && E(_Ee5), e.unbindTexture();
    }
    L.depthBuffer && oe(L);
  }
  function Ie(L) {
    var R = S(L) || a,
      ie = L.isWebGLMultipleRenderTargets === !0 ? L.texture : [L.texture];
    for (var ue = 0, me = ie.length; ue < me; ue++) {
      var De = ie[ue];
      if (A(De, R)) {
        var Me = L.isWebGLCubeRenderTarget ? 34067 : 3553,
          Ee = r.get(De).__webglTexture;
        e.bindTexture(Me, Ee), E(Me), e.unbindTexture();
      }
    }
  }
  function Oe(L) {
    if (a && L.samples > 0 && Te(L) === !1) {
      var R = L.isWebGLMultipleRenderTargets ? L.texture : [L.texture],
        ie = L.width,
        ue = L.height,
        me = 16384,
        De = [],
        Me = L.stencilBuffer ? 33306 : 36096,
        Ee = r.get(L),
        le = L.isWebGLMultipleRenderTargets === !0;
      if (le) for (var Je = 0; Je < R.length; Je++) e.bindFramebuffer(36160, Ee.__webglMultisampledFramebuffer), n.framebufferRenderbuffer(36160, 36064 + Je, 36161, null), e.bindFramebuffer(36160, Ee.__webglFramebuffer), n.framebufferTexture2D(36009, 36064 + Je, 3553, null, 0);
      e.bindFramebuffer(36008, Ee.__webglMultisampledFramebuffer), e.bindFramebuffer(36009, Ee.__webglFramebuffer);
      for (var _Je3 = 0; _Je3 < R.length; _Je3++) {
        De.push(36064 + _Je3), L.depthBuffer && De.push(Me);
        var ke = Ee.__ignoreDepthValues !== void 0 ? Ee.__ignoreDepthValues : !1;
        if (ke === !1 && (L.depthBuffer && (me |= 256), L.stencilBuffer && (me |= 1024)), le && n.framebufferRenderbuffer(36008, 36064, 36161, Ee.__webglColorRenderbuffer[_Je3]), ke === !0 && (n.invalidateFramebuffer(36008, [Me]), n.invalidateFramebuffer(36009, [Me])), le) {
          var Be = r.get(R[_Je3]).__webglTexture;
          n.framebufferTexture2D(36009, 36064, 3553, Be, 0);
        }
        n.blitFramebuffer(0, 0, ie, ue, 0, 0, ie, ue, me, 9728), f && n.invalidateFramebuffer(36008, De);
      }
      if (e.bindFramebuffer(36008, null), e.bindFramebuffer(36009, null), le) for (var _Je4 = 0; _Je4 < R.length; _Je4++) {
        e.bindFramebuffer(36160, Ee.__webglMultisampledFramebuffer), n.framebufferRenderbuffer(36160, 36064 + _Je4, 36161, Ee.__webglColorRenderbuffer[_Je4]);
        var _ke3 = r.get(R[_Je4]).__webglTexture;
        e.bindFramebuffer(36160, Ee.__webglFramebuffer), n.framebufferTexture2D(36009, 36064 + _Je4, 3553, _ke3, 0);
      }
      e.bindFramebuffer(36009, Ee.__webglMultisampledFramebuffer);
    }
  }
  function Pe(L) {
    return Math.min(d, L.samples);
  }
  function Te(L) {
    var R = r.get(L);
    return a && L.samples > 0 && t.has("WEBGL_multisampled_render_to_texture") === !0 && R.__useRenderToTexture !== !1;
  }
  function Ve(L) {
    var R = o.render.frame;
    p.get(L) !== R && (p.set(L, R), L.update());
  }
  function Ue(L, R) {
    var ie = L.encoding,
      ue = L.format,
      me = L.type;
    return L.isCompressedTexture === !0 || L.isVideoTexture === !0 || L.format === MS || ie !== dn && (ie === tt ? a === !1 ? t.has("EXT_sRGB") === !0 && ue === Fr ? (L.format = MS, L.minFilter = Qe, L.generateMipmaps = !1) : R = ty.sRGBToLinear(R) : (ue !== Fr || me !== br) && console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType.") : console.error("THREE.WebGLTextures: Unsupported texture encoding:", ie)), R;
  }
  this.allocateTextureUnit = V, this.resetTextureUnits = B, this.setTexture2D = j, this.setTexture2DArray = W, this.setTexture3D = k, this.setTextureCube = H, this.rebindTextures = _e, this.setupRenderTarget = xe, this.updateRenderTargetMipmap = Ie, this.updateMultisampleRenderTarget = Oe, this.setupDepthRenderbuffer = oe, this.setupFrameBufferTexture = Y, this.useMultisampledRTT = Te;
}
function EG(n, t, e) {
  var r = e.isWebGL2;
  function i(s) {
    var o = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var a;
    if (s === br) return 5121;
    if (s === vF) return 32819;
    if (s === xF) return 32820;
    if (s === mF) return 5120;
    if (s === gF) return 5122;
    if (s === TM) return 5123;
    if (s === yF) return 5124;
    if (s === Ds) return 5125;
    if (s === dr) return 5126;
    if (s === sa) return r ? 5131 : (a = t.get("OES_texture_half_float"), a !== null ? a.HALF_FLOAT_OES : null);
    if (s === bF) return 6406;
    if (s === Fr) return 6408;
    if (s === SF) return 6409;
    if (s === wF) return 6410;
    if (s === cc) return 6402;
    if (s === Ka) return 34041;
    if (s === MS) return a = t.get("EXT_sRGB"), a !== null ? a.SRGB_ALPHA_EXT : null;
    if (s === AF) return 6403;
    if (s === _F) return 36244;
    if (s === Ku) return 33319;
    if (s === EF) return 33320;
    if (s === nw) return 36249;
    if (s === Vb || s === Ub || s === Gb || s === jb) if (o === tt) {
      if (a = t.get("WEBGL_compressed_texture_s3tc_srgb"), a !== null) {
        if (s === Vb) return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;
        if (s === Ub) return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;
        if (s === Gb) return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;
        if (s === jb) return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;
      } else return null;
    } else if (a = t.get("WEBGL_compressed_texture_s3tc"), a !== null) {
      if (s === Vb) return a.COMPRESSED_RGB_S3TC_DXT1_EXT;
      if (s === Ub) return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;
      if (s === Gb) return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;
      if (s === jb) return a.COMPRESSED_RGBA_S3TC_DXT5_EXT;
    } else return null;
    if (s === ZE || s === JE || s === $E || s === eT) if (a = t.get("WEBGL_compressed_texture_pvrtc"), a !== null) {
      if (s === ZE) return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;
      if (s === JE) return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
      if (s === $E) return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
      if (s === eT) return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;
    } else return null;
    if (s === TF) return a = t.get("WEBGL_compressed_texture_etc1"), a !== null ? a.COMPRESSED_RGB_ETC1_WEBGL : null;
    if (s === tT || s === rT) if (a = t.get("WEBGL_compressed_texture_etc"), a !== null) {
      if (s === tT) return o === tt ? a.COMPRESSED_SRGB8_ETC2 : a.COMPRESSED_RGB8_ETC2;
      if (s === rT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC : a.COMPRESSED_RGBA8_ETC2_EAC;
    } else return null;
    if (s === iT || s === nT || s === sT || s === oT || s === aT || s === lT || s === cT || s === uT || s === dT || s === hT || s === fT || s === pT || s === mT || s === gT) if (a = t.get("WEBGL_compressed_texture_astc"), a !== null) {
      if (s === iT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR : a.COMPRESSED_RGBA_ASTC_4x4_KHR;
      if (s === nT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR : a.COMPRESSED_RGBA_ASTC_5x4_KHR;
      if (s === sT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR : a.COMPRESSED_RGBA_ASTC_5x5_KHR;
      if (s === oT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR : a.COMPRESSED_RGBA_ASTC_6x5_KHR;
      if (s === aT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR : a.COMPRESSED_RGBA_ASTC_6x6_KHR;
      if (s === lT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR : a.COMPRESSED_RGBA_ASTC_8x5_KHR;
      if (s === cT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR : a.COMPRESSED_RGBA_ASTC_8x6_KHR;
      if (s === uT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR : a.COMPRESSED_RGBA_ASTC_8x8_KHR;
      if (s === dT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR : a.COMPRESSED_RGBA_ASTC_10x5_KHR;
      if (s === hT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR : a.COMPRESSED_RGBA_ASTC_10x6_KHR;
      if (s === fT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR : a.COMPRESSED_RGBA_ASTC_10x8_KHR;
      if (s === pT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR : a.COMPRESSED_RGBA_ASTC_10x10_KHR;
      if (s === mT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR : a.COMPRESSED_RGBA_ASTC_12x10_KHR;
      if (s === gT) return o === tt ? a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR : a.COMPRESSED_RGBA_ASTC_12x12_KHR;
    } else return null;
    if (s === Hb) if (a = t.get("EXT_texture_compression_bptc"), a !== null) {
      if (s === Hb) return o === tt ? a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT : a.COMPRESSED_RGBA_BPTC_UNORM_EXT;
    } else return null;
    if (s === MF || s === yT || s === vT || s === xT) if (a = t.get("EXT_texture_compression_rgtc"), a !== null) {
      if (s === Hb) return a.COMPRESSED_RED_RGTC1_EXT;
      if (s === yT) return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;
      if (s === vT) return a.COMPRESSED_RED_GREEN_RGTC2_EXT;
      if (s === xT) return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;
    } else return null;
    return s === Ya ? r ? 34042 : (a = t.get("WEBGL_depth_texture"), a !== null ? a.UNSIGNED_INT_24_8_WEBGL : null) : n[s] !== void 0 ? n[s] : null;
  }
  return {
    convert: i
  };
}
var kS = /*#__PURE__*/function (_Wr) {
    _inherits(kS, _Wr);
    var _super25 = _createSuper(kS);
    function kS() {
      var _this22;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      _classCallCheck(this, kS);
      _this22 = _super25.call(this), _this22.isArrayCamera = !0, _this22.cameras = t;
      return _this22;
    }
    return _createClass(kS);
  }(Wr),
  ts = /*#__PURE__*/function (_mt4) {
    _inherits(ts, _mt4);
    var _super26 = _createSuper(ts);
    function ts() {
      var _this23;
      _classCallCheck(this, ts);
      _this23 = _super26.call(this), _this23.isGroup = !0, _this23.type = "Group";
      return _this23;
    }
    return _createClass(ts);
  }(mt),
  TG = {
    type: "move"
  },
  np = /*#__PURE__*/function () {
    function np() {
      _classCallCheck(this, np);
      this._targetRay = null, this._grip = null, this._hand = null;
    }
    _createClass(np, [{
      key: "getHandSpace",
      value: function getHandSpace() {
        return this._hand === null && (this._hand = new ts(), this._hand.matrixAutoUpdate = !1, this._hand.visible = !1, this._hand.joints = {}, this._hand.inputState = {
          pinching: !1
        }), this._hand;
      }
    }, {
      key: "getTargetRaySpace",
      value: function getTargetRaySpace() {
        return this._targetRay === null && (this._targetRay = new ts(), this._targetRay.matrixAutoUpdate = !1, this._targetRay.visible = !1, this._targetRay.hasLinearVelocity = !1, this._targetRay.linearVelocity = new _(), this._targetRay.hasAngularVelocity = !1, this._targetRay.angularVelocity = new _()), this._targetRay;
      }
    }, {
      key: "getGripSpace",
      value: function getGripSpace() {
        return this._grip === null && (this._grip = new ts(), this._grip.matrixAutoUpdate = !1, this._grip.visible = !1, this._grip.hasLinearVelocity = !1, this._grip.linearVelocity = new _(), this._grip.hasAngularVelocity = !1, this._grip.angularVelocity = new _()), this._grip;
      }
    }, {
      key: "dispatchEvent",
      value: function dispatchEvent(t) {
        return this._targetRay !== null && this._targetRay.dispatchEvent(t), this._grip !== null && this._grip.dispatchEvent(t), this._hand !== null && this._hand.dispatchEvent(t), this;
      }
    }, {
      key: "connect",
      value: function connect(t) {
        if (t && t.hand) {
          var e = this._hand;
          if (e) {
            var _iterator3 = _createForOfIteratorHelper(t.hand.values()),
              _step3;
            try {
              for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
                var r = _step3.value;
                this._getHandJoint(e, r);
              }
            } catch (err) {
              _iterator3.e(err);
            } finally {
              _iterator3.f();
            }
          }
        }
        return this.dispatchEvent({
          type: "connected",
          data: t
        }), this;
      }
    }, {
      key: "disconnect",
      value: function disconnect(t) {
        return this.dispatchEvent({
          type: "disconnected",
          data: t
        }), this._targetRay !== null && (this._targetRay.visible = !1), this._grip !== null && (this._grip.visible = !1), this._hand !== null && (this._hand.visible = !1), this;
      }
    }, {
      key: "update",
      value: function update(t, e, r) {
        var i = null,
          s = null,
          o = null,
          a = this._targetRay,
          l = this._grip,
          u = this._hand;
        if (t && e.session.visibilityState !== "visible-blurred") {
          if (u && t.hand) {
            o = !0;
            var _iterator4 = _createForOfIteratorHelper(t.hand.values()),
              _step4;
            try {
              for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
                var m = _step4.value;
                var g = e.getJointPose(m, r),
                  y = this._getHandJoint(u, m);
                g !== null && (y.matrix.fromArray(g.transform.matrix), y.matrix.decompose(y.position, y.rotation, y.scale), y.jointRadius = g.radius), y.visible = g !== null;
              }
            } catch (err) {
              _iterator4.e(err);
            } finally {
              _iterator4.f();
            }
            var c = u.joints["index-finger-tip"],
              d = u.joints["thumb-tip"],
              h = c.position.distanceTo(d.position),
              f = .02,
              p = .005;
            u.inputState.pinching && h > f + p ? (u.inputState.pinching = !1, this.dispatchEvent({
              type: "pinchend",
              handedness: t.handedness,
              target: this
            })) : !u.inputState.pinching && h <= f - p && (u.inputState.pinching = !0, this.dispatchEvent({
              type: "pinchstart",
              handedness: t.handedness,
              target: this
            }));
          } else l !== null && t.gripSpace && (s = e.getPose(t.gripSpace, r), s !== null && (l.matrix.fromArray(s.transform.matrix), l.matrix.decompose(l.position, l.rotation, l.scale), s.linearVelocity ? (l.hasLinearVelocity = !0, l.linearVelocity.copy(s.linearVelocity)) : l.hasLinearVelocity = !1, s.angularVelocity ? (l.hasAngularVelocity = !0, l.angularVelocity.copy(s.angularVelocity)) : l.hasAngularVelocity = !1));
          a !== null && (i = e.getPose(t.targetRaySpace, r), i === null && s !== null && (i = s), i !== null && (a.matrix.fromArray(i.transform.matrix), a.matrix.decompose(a.position, a.rotation, a.scale), i.linearVelocity ? (a.hasLinearVelocity = !0, a.linearVelocity.copy(i.linearVelocity)) : a.hasLinearVelocity = !1, i.angularVelocity ? (a.hasAngularVelocity = !0, a.angularVelocity.copy(i.angularVelocity)) : a.hasAngularVelocity = !1, this.dispatchEvent(TG)));
        }
        return a !== null && (a.visible = i !== null), l !== null && (l.visible = s !== null), u !== null && (u.visible = o !== null), this;
      }
    }, {
      key: "_getHandJoint",
      value: function _getHandJoint(t, e) {
        if (t.joints[e.jointName] === void 0) {
          var r = new ts();
          r.matrixAutoUpdate = !1, r.visible = !1, t.joints[e.jointName] = r, t.add(r);
        }
        return t.joints[e.jointName];
      }
    }]);
    return np;
  }(),
  is = /*#__PURE__*/function (_qt4) {
    _inherits(is, _qt4);
    var _super27 = _createSuper(is);
    function is(t, e, r, i, s, o, a, l, u, c) {
      var _this24;
      _classCallCheck(this, is);
      if (c = c !== void 0 ? c : cc, c !== cc && c !== Ka) throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");
      r === void 0 && c === cc && (r = Ds), r === void 0 && c === Ka && (r = Ya), _this24 = _super27.call(this, null, i, s, o, a, l, c, r, u), _this24.isDepthTexture = !0, _this24.image = {
        width: t,
        height: e
      }, _this24.magFilter = a !== void 0 ? a : Et, _this24.minFilter = l !== void 0 ? l : Et, _this24.flipY = !1, _this24.generateMipmaps = !1;
      return _this24;
    }
    return _createClass(is);
  }(qt),
  zS = /*#__PURE__*/function (_ir6) {
    _inherits(zS, _ir6);
    var _super28 = _createSuper(zS);
    function zS(t, e) {
      var _this25;
      _classCallCheck(this, zS);
      _this25 = _super28.call(this);
      var r = _assertThisInitialized(_this25),
        i = null,
        s = 1,
        o = null,
        a = "local-floor",
        l = 1,
        u = null,
        c = null,
        d = null,
        h = null,
        f = null,
        p = null,
        m = e.getContextAttributes(),
        g = null,
        y = null,
        v = [],
        x = [],
        S = new Set(),
        w = new Map(),
        A = new Wr();
      A.layers.enable(1), A.viewport = new He();
      var E = new Wr();
      E.layers.enable(2), E.viewport = new He();
      var b = [A, E],
        T = new kS();
      T.layers.enable(1), T.layers.enable(2);
      var M = null,
        C = null;
      _this25.cameraAutoUpdate = !0, _this25.enabled = !1, _this25.isPresenting = !1, _this25.getController = function (k) {
        var H = v[k];
        return H === void 0 && (H = new np(), v[k] = H), H.getTargetRaySpace();
      }, _this25.getControllerGrip = function (k) {
        var H = v[k];
        return H === void 0 && (H = new np(), v[k] = H), H.getGripSpace();
      }, _this25.getHand = function (k) {
        var H = v[k];
        return H === void 0 && (H = new np(), v[k] = H), H.getHandSpace();
      };
      function P(k) {
        var H = x.indexOf(k.inputSource);
        if (H === -1) return;
        var X = v[H];
        X !== void 0 && X.dispatchEvent({
          type: k.type,
          data: k.inputSource
        });
      }
      function D() {
        i.removeEventListener("select", P), i.removeEventListener("selectstart", P), i.removeEventListener("selectend", P), i.removeEventListener("squeeze", P), i.removeEventListener("squeezestart", P), i.removeEventListener("squeezeend", P), i.removeEventListener("end", D), i.removeEventListener("inputsourceschange", O);
        for (var k = 0; k < v.length; k++) {
          var H = x[k];
          H !== null && (x[k] = null, v[k].disconnect(H));
        }
        M = null, C = null, t.setRenderTarget(g), f = null, h = null, d = null, i = null, y = null, W.stop(), r.isPresenting = !1, r.dispatchEvent({
          type: "sessionend"
        });
      }
      _this25.setFramebufferScaleFactor = function (k) {
        s = k, r.isPresenting === !0 && console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.");
      }, _this25.setReferenceSpaceType = function (k) {
        a = k, r.isPresenting === !0 && console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.");
      }, _this25.getReferenceSpace = function () {
        return u || o;
      }, _this25.setReferenceSpace = function (k) {
        u = k;
      }, _this25.getBaseLayer = function () {
        return h !== null ? h : f;
      }, _this25.getBinding = function () {
        return d;
      }, _this25.getFrame = function () {
        return p;
      }, _this25.getSession = function () {
        return i;
      }, _this25.setSession = /*#__PURE__*/function () {
        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(k) {
          var H, _H3, X, q, G, J;
          return _regeneratorRuntime().wrap(function _callee$(_context7) {
            while (1) switch (_context7.prev = _context7.next) {
              case 0:
                if (!(i = k, i !== null)) {
                  _context7.next = 35;
                  break;
                }
                g = t.getRenderTarget();
                i.addEventListener("select", P);
                i.addEventListener("selectstart", P);
                i.addEventListener("selectend", P);
                i.addEventListener("squeeze", P);
                i.addEventListener("squeezestart", P);
                i.addEventListener("squeezeend", P);
                i.addEventListener("end", D);
                i.addEventListener("inputsourceschange", O);
                _context7.t0 = m.xrCompatible !== !0;
                if (!_context7.t0) {
                  _context7.next = 14;
                  break;
                }
                _context7.next = 14;
                return e.makeXRCompatible();
              case 14:
                if (!(i.renderState.layers === void 0 || t.capabilities.isWebGL2 === !1)) {
                  _context7.next = 19;
                  break;
                }
                H = {
                  antialias: i.renderState.layers === void 0 ? m.antialias : !0,
                  alpha: m.alpha,
                  depth: m.depth,
                  stencil: m.stencil,
                  framebufferScaleFactor: s
                };
                f = new XRWebGLLayer(i, e, H), i.updateRenderState({
                  baseLayer: f
                }), y = new at(f.framebufferWidth, f.framebufferHeight, {
                  format: Fr,
                  type: br,
                  encoding: t.outputEncoding,
                  stencilBuffer: m.stencil
                });
                _context7.next = 25;
                break;
              case 19:
                _H3 = null, X = null, q = null;
                m.depth && (q = m.stencil ? 35056 : 33190, _H3 = m.stencil ? Ka : cc, X = m.stencil ? Ya : Ds);
                G = {
                  colorFormat: 32856,
                  depthFormat: q,
                  scaleFactor: s
                };
                d = new XRWebGLBinding(i, e), h = d.createProjectionLayer(G), i.updateRenderState({
                  layers: [h]
                }), y = new at(h.textureWidth, h.textureHeight, {
                  format: Fr,
                  type: br,
                  depthTexture: new is(h.textureWidth, h.textureHeight, X, void 0, void 0, void 0, void 0, void 0, void 0, _H3),
                  stencilBuffer: m.stencil,
                  encoding: t.outputEncoding,
                  samples: m.antialias ? 4 : 0
                });
                J = t.properties.get(y);
                J.__ignoreDepthValues = h.ignoreDepthValues;
              case 25:
                y.isXRRenderTarget = !0;
                this.setFoveation(l);
                u = null;
                _context7.next = 30;
                return i.requestReferenceSpace(a);
              case 30:
                o = _context7.sent;
                W.setContext(i);
                W.start();
                r.isPresenting = !0;
                r.dispatchEvent({
                  type: "sessionstart"
                });
              case 35:
              case "end":
                return _context7.stop();
            }
          }, _callee, this);
        }));
        return function (_x9) {
          return _ref.apply(this, arguments);
        };
      }();
      function O(k) {
        for (var H = 0; H < k.removed.length; H++) {
          var X = k.removed[H],
            q = x.indexOf(X);
          q >= 0 && (x[q] = null, v[q].disconnect(X));
        }
        for (var _H4 = 0; _H4 < k.added.length; _H4++) {
          var _X4 = k.added[_H4],
            _q3 = x.indexOf(_X4);
          if (_q3 === -1) {
            for (var J = 0; J < v.length; J++) if (J >= x.length) {
              x.push(_X4), _q3 = J;
              break;
            } else if (x[J] === null) {
              x[J] = _X4, _q3 = J;
              break;
            }
            if (_q3 === -1) break;
          }
          var G = v[_q3];
          G && G.connect(_X4);
        }
      }
      var I = new _(),
        z = new _();
      function B(k, H, X) {
        I.setFromMatrixPosition(H.matrixWorld), z.setFromMatrixPosition(X.matrixWorld);
        var q = I.distanceTo(z),
          G = H.projectionMatrix.elements,
          J = X.projectionMatrix.elements,
          Z = G[14] / (G[10] - 1),
          K = G[14] / (G[10] + 1),
          Y = (G[9] + 1) / G[5],
          ye = (G[9] - 1) / G[5],
          fe = (G[8] - 1) / G[0],
          oe = (J[8] + 1) / J[0],
          _e = Z * fe,
          xe = Z * oe,
          Ie = q / (-fe + oe),
          Oe = Ie * -fe;
        H.matrixWorld.decompose(k.position, k.quaternion, k.scale), k.translateX(Oe), k.translateZ(Ie), k.matrixWorld.compose(k.position, k.quaternion, k.scale), k.matrixWorldInverse.copy(k.matrixWorld).invert();
        var Pe = Z + Ie,
          Te = K + Ie,
          Ve = _e - Oe,
          Ue = xe + (q - Oe),
          L = Y * K / Te * Pe,
          R = ye * K / Te * Pe;
        k.projectionMatrix.makePerspective(Ve, Ue, L, R, Pe, Te);
      }
      function V(k, H) {
        H === null ? k.matrixWorld.copy(k.matrix) : k.matrixWorld.multiplyMatrices(H.matrixWorld, k.matrix), k.matrixWorldInverse.copy(k.matrixWorld).invert();
      }
      _this25.updateCamera = function (k) {
        if (i === null) return;
        T.near = E.near = A.near = k.near, T.far = E.far = A.far = k.far, (M !== T.near || C !== T.far) && (i.updateRenderState({
          depthNear: T.near,
          depthFar: T.far
        }), M = T.near, C = T.far);
        var H = k.parent,
          X = T.cameras;
        V(T, H);
        for (var G = 0; G < X.length; G++) V(X[G], H);
        T.matrixWorld.decompose(T.position, T.quaternion, T.scale), k.matrix.copy(T.matrix), k.matrix.decompose(k.position, k.quaternion, k.scale);
        var q = k.children;
        for (var _G2 = 0, J = q.length; _G2 < J; _G2++) q[_G2].updateMatrixWorld(!0);
        X.length === 2 ? B(T, A, E) : T.projectionMatrix.copy(A.projectionMatrix);
      }, _this25.getCamera = function () {
        return T;
      }, _this25.getFoveation = function () {
        if (!(h === null && f === null)) return l;
      }, _this25.setFoveation = function (k) {
        l = k, h !== null && (h.fixedFoveation = k), f !== null && f.fixedFoveation !== void 0 && (f.fixedFoveation = k);
      }, _this25.getPlanes = function () {
        return S;
      };
      var U = null;
      function j(k, H) {
        if (c = H.getViewerPose(u || o), p = H, c !== null) {
          var X = c.views;
          f !== null && (t.setRenderTargetFramebuffer(y, f.framebuffer), t.setRenderTarget(y));
          var q = !1;
          X.length !== T.cameras.length && (T.cameras.length = 0, q = !0);
          for (var G = 0; G < X.length; G++) {
            var J = X[G],
              Z = null;
            if (f !== null) Z = f.getViewport(J);else {
              var Y = d.getViewSubImage(h, J);
              Z = Y.viewport, G === 0 && (t.setRenderTargetTextures(y, Y.colorTexture, h.ignoreDepthValues ? void 0 : Y.depthStencilTexture), t.setRenderTarget(y));
            }
            var K = b[G];
            K === void 0 && (K = new Wr(), K.layers.enable(G), K.viewport = new He(), b[G] = K), K.matrix.fromArray(J.transform.matrix), K.projectionMatrix.fromArray(J.projectionMatrix), K.viewport.set(Z.x, Z.y, Z.width, Z.height), G === 0 && T.matrix.copy(K.matrix), q === !0 && T.cameras.push(K);
          }
        }
        for (var _X5 = 0; _X5 < v.length; _X5++) {
          var _q4 = x[_X5],
            _G3 = v[_X5];
          _q4 !== null && _G3 !== void 0 && _G3.update(_q4, H, u || o);
        }
        if (U && U(k, H), H.detectedPlanes) {
          r.dispatchEvent({
            type: "planesdetected",
            data: H.detectedPlanes
          });
          var _X6 = null;
          var _iterator5 = _createForOfIteratorHelper(S),
            _step5;
          try {
            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
              var _q6 = _step5.value;
              H.detectedPlanes.has(_q6) || (_X6 === null && (_X6 = []), _X6.push(_q6));
            }
          } catch (err) {
            _iterator5.e(err);
          } finally {
            _iterator5.f();
          }
          if (_X6 !== null) {
            var _iterator6 = _createForOfIteratorHelper(_X6),
              _step6;
            try {
              for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
                var _q5 = _step6.value;
                S.delete(_q5), w.delete(_q5), r.dispatchEvent({
                  type: "planeremoved",
                  data: _q5
                });
              }
            } catch (err) {
              _iterator6.e(err);
            } finally {
              _iterator6.f();
            }
          }
          var _iterator7 = _createForOfIteratorHelper(H.detectedPlanes),
            _step7;
          try {
            for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
              var _q7 = _step7.value;
              if (!S.has(_q7)) S.add(_q7), w.set(_q7, H.lastChangedTime), r.dispatchEvent({
                type: "planeadded",
                data: _q7
              });else {
                var _G4 = w.get(_q7);
                _q7.lastChangedTime > _G4 && (w.set(_q7, _q7.lastChangedTime), r.dispatchEvent({
                  type: "planechanged",
                  data: _q7
                }));
              }
            }
          } catch (err) {
            _iterator7.e(err);
          } finally {
            _iterator7.f();
          }
        }
        p = null;
      }
      var W = new IM();
      W.setAnimationLoop(j), _this25.setAnimationLoop = function (k) {
        U = k;
      }, _this25.dispose = function () {};
      return _this25;
    }
    return _createClass(zS);
  }(ir);
function MG(n, t) {
  function e(m, g) {
    g.color.getRGB(m.fogColor.value, OM(n)), g.isFog ? (m.fogNear.value = g.near, m.fogFar.value = g.far) : g.isFogExp2 && (m.fogDensity.value = g.density);
  }
  function r(m, g, y, v, x) {
    g.isMeshBasicMaterial || g.isMeshLambertMaterial ? i(m, g) : g.isMeshToonMaterial ? (i(m, g), c(m, g)) : g.isMeshPhongMaterial ? (i(m, g), u(m, g)) : g.isMeshStandardMaterial ? (i(m, g), d(m, g), g.isMeshPhysicalMaterial && h(m, g, x)) : g.isMeshMatcapMaterial ? (i(m, g), f(m, g)) : g.isMeshDepthMaterial ? i(m, g) : g.isMeshDistanceMaterial ? (i(m, g), p(m, g)) : g.isMeshNormalMaterial ? i(m, g) : g.isLineBasicMaterial ? (s(m, g), g.isLineDashedMaterial && o(m, g)) : g.isPointsMaterial ? a(m, g, y, v) : g.isSpriteMaterial ? l(m, g) : g.isShadowMaterial ? (m.color.value.copy(g.color), m.opacity.value = g.opacity) : g.isShaderMaterial && (g.uniformsNeedUpdate = !1);
  }
  function i(m, g) {
    m.opacity.value = g.opacity, g.color && m.diffuse.value.copy(g.color), g.emissive && m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity), g.map && (m.map.value = g.map), g.alphaMap && (m.alphaMap.value = g.alphaMap), g.bumpMap && (m.bumpMap.value = g.bumpMap, m.bumpScale.value = g.bumpScale, g.side === ai && (m.bumpScale.value *= -1)), g.displacementMap && (m.displacementMap.value = g.displacementMap, m.displacementScale.value = g.displacementScale, m.displacementBias.value = g.displacementBias), g.emissiveMap && (m.emissiveMap.value = g.emissiveMap), g.normalMap && (m.normalMap.value = g.normalMap, m.normalScale.value.copy(g.normalScale), g.side === ai && m.normalScale.value.negate()), g.specularMap && (m.specularMap.value = g.specularMap), g.alphaTest > 0 && (m.alphaTest.value = g.alphaTest);
    var y = t.get(g).envMap;
    if (y && (m.envMap.value = y, m.flipEnvMap.value = y.isCubeTexture && y.isRenderTargetTexture === !1 ? -1 : 1, m.reflectivity.value = g.reflectivity, m.ior.value = g.ior, m.refractionRatio.value = g.refractionRatio), g.lightMap) {
      m.lightMap.value = g.lightMap;
      var S = n.physicallyCorrectLights !== !0 ? Math.PI : 1;
      m.lightMapIntensity.value = g.lightMapIntensity * S;
    }
    g.aoMap && (m.aoMap.value = g.aoMap, m.aoMapIntensity.value = g.aoMapIntensity);
    var v;
    g.map ? v = g.map : g.specularMap ? v = g.specularMap : g.displacementMap ? v = g.displacementMap : g.normalMap ? v = g.normalMap : g.bumpMap ? v = g.bumpMap : g.roughnessMap ? v = g.roughnessMap : g.metalnessMap ? v = g.metalnessMap : g.alphaMap ? v = g.alphaMap : g.emissiveMap ? v = g.emissiveMap : g.clearcoatMap ? v = g.clearcoatMap : g.clearcoatNormalMap ? v = g.clearcoatNormalMap : g.clearcoatRoughnessMap ? v = g.clearcoatRoughnessMap : g.iridescenceMap ? v = g.iridescenceMap : g.iridescenceThicknessMap ? v = g.iridescenceThicknessMap : g.specularIntensityMap ? v = g.specularIntensityMap : g.specularColorMap ? v = g.specularColorMap : g.transmissionMap ? v = g.transmissionMap : g.thicknessMap ? v = g.thicknessMap : g.sheenColorMap ? v = g.sheenColorMap : g.sheenRoughnessMap && (v = g.sheenRoughnessMap), v !== void 0 && (v.isWebGLRenderTarget && (v = v.texture), v.matrixAutoUpdate === !0 && v.updateMatrix(), m.uvTransform.value.copy(v.matrix));
    var x;
    g.aoMap ? x = g.aoMap : g.lightMap && (x = g.lightMap), x !== void 0 && (x.isWebGLRenderTarget && (x = x.texture), x.matrixAutoUpdate === !0 && x.updateMatrix(), m.uv2Transform.value.copy(x.matrix));
  }
  function s(m, g) {
    m.diffuse.value.copy(g.color), m.opacity.value = g.opacity;
  }
  function o(m, g) {
    m.dashSize.value = g.dashSize, m.totalSize.value = g.dashSize + g.gapSize, m.scale.value = g.scale;
  }
  function a(m, g, y, v) {
    m.diffuse.value.copy(g.color), m.opacity.value = g.opacity, m.size.value = g.size * y, m.scale.value = v * .5, g.map && (m.map.value = g.map), g.alphaMap && (m.alphaMap.value = g.alphaMap), g.alphaTest > 0 && (m.alphaTest.value = g.alphaTest);
    var x;
    g.map ? x = g.map : g.alphaMap && (x = g.alphaMap), x !== void 0 && (x.matrixAutoUpdate === !0 && x.updateMatrix(), m.uvTransform.value.copy(x.matrix));
  }
  function l(m, g) {
    m.diffuse.value.copy(g.color), m.opacity.value = g.opacity, m.rotation.value = g.rotation, g.map && (m.map.value = g.map), g.alphaMap && (m.alphaMap.value = g.alphaMap), g.alphaTest > 0 && (m.alphaTest.value = g.alphaTest);
    var y;
    g.map ? y = g.map : g.alphaMap && (y = g.alphaMap), y !== void 0 && (y.matrixAutoUpdate === !0 && y.updateMatrix(), m.uvTransform.value.copy(y.matrix));
  }
  function u(m, g) {
    m.specular.value.copy(g.specular), m.shininess.value = Math.max(g.shininess, 1e-4);
  }
  function c(m, g) {
    g.gradientMap && (m.gradientMap.value = g.gradientMap);
  }
  function d(m, g) {
    m.roughness.value = g.roughness, m.metalness.value = g.metalness, g.roughnessMap && (m.roughnessMap.value = g.roughnessMap), g.metalnessMap && (m.metalnessMap.value = g.metalnessMap), t.get(g).envMap && (m.envMapIntensity.value = g.envMapIntensity);
  }
  function h(m, g, y) {
    m.ior.value = g.ior, g.sheen > 0 && (m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen), m.sheenRoughness.value = g.sheenRoughness, g.sheenColorMap && (m.sheenColorMap.value = g.sheenColorMap), g.sheenRoughnessMap && (m.sheenRoughnessMap.value = g.sheenRoughnessMap)), g.clearcoat > 0 && (m.clearcoat.value = g.clearcoat, m.clearcoatRoughness.value = g.clearcoatRoughness, g.clearcoatMap && (m.clearcoatMap.value = g.clearcoatMap), g.clearcoatRoughnessMap && (m.clearcoatRoughnessMap.value = g.clearcoatRoughnessMap), g.clearcoatNormalMap && (m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale), m.clearcoatNormalMap.value = g.clearcoatNormalMap, g.side === ai && m.clearcoatNormalScale.value.negate())), g.iridescence > 0 && (m.iridescence.value = g.iridescence, m.iridescenceIOR.value = g.iridescenceIOR, m.iridescenceThicknessMinimum.value = g.iridescenceThicknessRange[0], m.iridescenceThicknessMaximum.value = g.iridescenceThicknessRange[1], g.iridescenceMap && (m.iridescenceMap.value = g.iridescenceMap), g.iridescenceThicknessMap && (m.iridescenceThicknessMap.value = g.iridescenceThicknessMap)), g.transmission > 0 && (m.transmission.value = g.transmission, m.transmissionSamplerMap.value = y.texture, m.transmissionSamplerSize.value.set(y.width, y.height), g.transmissionMap && (m.transmissionMap.value = g.transmissionMap), m.thickness.value = g.thickness, g.thicknessMap && (m.thicknessMap.value = g.thicknessMap), m.attenuationDistance.value = g.attenuationDistance, m.attenuationColor.value.copy(g.attenuationColor)), m.specularIntensity.value = g.specularIntensity, m.specularColor.value.copy(g.specularColor), g.specularIntensityMap && (m.specularIntensityMap.value = g.specularIntensityMap), g.specularColorMap && (m.specularColorMap.value = g.specularColorMap);
  }
  function f(m, g) {
    g.matcap && (m.matcap.value = g.matcap);
  }
  function p(m, g) {
    m.referencePosition.value.copy(g.referencePosition), m.nearDistance.value = g.nearDistance, m.farDistance.value = g.farDistance;
  }
  return {
    refreshFogUniforms: e,
    refreshMaterialUniforms: r
  };
}
function CG(n, t, e, r) {
  var i = {},
    s = {},
    o = [],
    a = e.isWebGL2 ? n.getParameter(35375) : 0;
  function l(v, x) {
    var S = x.program;
    r.uniformBlockBinding(v, S);
  }
  function u(v, x) {
    var S = i[v.id];
    S === void 0 && (p(v), S = c(v), i[v.id] = S, v.addEventListener("dispose", g));
    var w = x.program;
    r.updateUBOMapping(v, w);
    var A = t.render.frame;
    s[v.id] !== A && (h(v), s[v.id] = A);
  }
  function c(v) {
    var x = d();
    v.__bindingPointIndex = x;
    var S = n.createBuffer(),
      w = v.__size,
      A = v.usage;
    return n.bindBuffer(35345, S), n.bufferData(35345, w, A), n.bindBuffer(35345, null), n.bindBufferBase(35345, x, S), S;
  }
  function d() {
    for (var v = 0; v < a; v++) if (o.indexOf(v) === -1) return o.push(v), v;
    return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."), 0;
  }
  function h(v) {
    var x = i[v.id],
      S = v.uniforms,
      w = v.__cache;
    n.bindBuffer(35345, x);
    for (var A = 0, E = S.length; A < E; A++) {
      var b = S[A];
      if (f(b, A, w) === !0) {
        var T = b.__offset,
          M = Array.isArray(b.value) ? b.value : [b.value],
          C = 0;
        for (var P = 0; P < M.length; P++) {
          var D = M[P],
            _O3 = m(D);
          typeof D == "number" ? (b.__data[0] = D, n.bufferSubData(35345, T + C, b.__data)) : D.isMatrix3 ? (b.__data[0] = D.elements[0], b.__data[1] = D.elements[1], b.__data[2] = D.elements[2], b.__data[3] = D.elements[0], b.__data[4] = D.elements[3], b.__data[5] = D.elements[4], b.__data[6] = D.elements[5], b.__data[7] = D.elements[0], b.__data[8] = D.elements[6], b.__data[9] = D.elements[7], b.__data[10] = D.elements[8], b.__data[11] = D.elements[0]) : (D.toArray(b.__data, C), C += _O3.storage / Float32Array.BYTES_PER_ELEMENT);
        }
        n.bufferSubData(35345, T, b.__data);
      }
    }
    n.bindBuffer(35345, null);
  }
  function f(v, x, S) {
    var w = v.value;
    if (S[x] === void 0) {
      if (typeof w == "number") S[x] = w;else {
        var A = Array.isArray(w) ? w : [w],
          E = [];
        for (var b = 0; b < A.length; b++) E.push(A[b].clone());
        S[x] = E;
      }
      return !0;
    } else if (typeof w == "number") {
      if (S[x] !== w) return S[x] = w, !0;
    } else {
      var _A5 = Array.isArray(S[x]) ? S[x] : [S[x]],
        _E6 = Array.isArray(w) ? w : [w];
      for (var _b2 = 0; _b2 < _A5.length; _b2++) {
        var T = _A5[_b2];
        if (T.equals(_E6[_b2]) === !1) return T.copy(_E6[_b2]), !0;
      }
    }
    return !1;
  }
  function p(v) {
    var x = v.uniforms,
      S = 0,
      w = 16,
      A = 0;
    for (var E = 0, b = x.length; E < b; E++) {
      var T = x[E],
        M = {
          boundary: 0,
          storage: 0
        },
        C = Array.isArray(T.value) ? T.value : [T.value];
      for (var P = 0, D = C.length; P < D; P++) {
        var _O4 = C[P],
          I = m(_O4);
        M.boundary += I.boundary, M.storage += I.storage;
      }
      if (T.__data = new Float32Array(M.storage / Float32Array.BYTES_PER_ELEMENT), T.__offset = S, E > 0) {
        A = S % w;
        var _P4 = w - A;
        A !== 0 && _P4 - M.boundary < 0 && (S += w - A, T.__offset = S);
      }
      S += M.storage;
    }
    return A = S % w, A > 0 && (S += w - A), v.__size = S, v.__cache = {}, this;
  }
  function m(v) {
    var x = {
      boundary: 0,
      storage: 0
    };
    return typeof v == "number" ? (x.boundary = 4, x.storage = 4) : v.isVector2 ? (x.boundary = 8, x.storage = 8) : v.isVector3 || v.isColor ? (x.boundary = 16, x.storage = 12) : v.isVector4 ? (x.boundary = 16, x.storage = 16) : v.isMatrix3 ? (x.boundary = 48, x.storage = 48) : v.isMatrix4 ? (x.boundary = 64, x.storage = 64) : v.isTexture ? console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group.") : console.warn("THREE.WebGLRenderer: Unsupported uniform value type.", v), x;
  }
  function g(v) {
    var x = v.target;
    x.removeEventListener("dispose", g);
    var S = o.indexOf(x.__bindingPointIndex);
    o.splice(S, 1), n.deleteBuffer(i[x.id]), delete i[x.id], delete s[x.id];
  }
  function y() {
    for (var v in i) n.deleteBuffer(i[v]);
    o = [], i = {}, s = {};
  }
  return {
    bind: l,
    update: u,
    dispose: y
  };
}
function PG() {
  var n = cp("canvas");
  return n.style.display = "block", n;
}
function dw() {
  var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  this.isWebGLRenderer = !0;
  var t = n.canvas !== void 0 ? n.canvas : PG(),
    e = n.context !== void 0 ? n.context : null,
    r = n.depth !== void 0 ? n.depth : !0,
    i = n.stencil !== void 0 ? n.stencil : !0,
    s = n.antialias !== void 0 ? n.antialias : !1,
    o = n.premultipliedAlpha !== void 0 ? n.premultipliedAlpha : !0,
    a = n.preserveDrawingBuffer !== void 0 ? n.preserveDrawingBuffer : !1,
    l = n.powerPreference !== void 0 ? n.powerPreference : "default",
    u = n.failIfMajorPerformanceCaveat !== void 0 ? n.failIfMajorPerformanceCaveat : !1,
    c;
  e !== null ? c = e.getContextAttributes().alpha : c = n.alpha !== void 0 ? n.alpha : !1;
  var d = null,
    h = null,
    f = [],
    p = [];
  this.domElement = t, this.debug = {
    checkShaderErrors: !0
  }, this.autoClear = !0, this.autoClearColor = !0, this.autoClearDepth = !0, this.autoClearStencil = !0, this.sortObjects = !0, this.clippingPlanes = [], this.localClippingEnabled = !1, this.outputEncoding = dn, this.physicallyCorrectLights = !1, this.toneMapping = Os, this.toneMappingExposure = 1;
  var m = this,
    g = !1,
    y = 0,
    v = 0,
    x = null,
    S = -1,
    w = null,
    A = new He(),
    E = new He(),
    b = null,
    T = t.width,
    M = t.height,
    C = 1,
    P = null,
    D = null,
    O = new He(0, 0, T, M),
    I = new He(0, 0, T, M),
    z = !1,
    B = new dp(),
    V = !1,
    U = !1,
    j = null,
    W = new te(),
    k = new N(),
    H = new _(),
    X = {
      background: null,
      fog: null,
      environment: null,
      overrideMaterial: null,
      isScene: !0
    };
  function q() {
    return x === null ? C : 1;
  }
  var G = e;
  function J(F, re) {
    for (var de = 0; de < F.length; de++) {
      var ee = F[de],
        pe = t.getContext(ee, re);
      if (pe !== null) return pe;
    }
    return null;
  }
  try {
    var F = {
      alpha: !0,
      depth: r,
      stencil: i,
      antialias: s,
      premultipliedAlpha: o,
      preserveDrawingBuffer: a,
      powerPreference: l,
      failIfMajorPerformanceCaveat: u
    };
    if ("setAttribute" in t && t.setAttribute("data-engine", "three.js r".concat(aa)), t.addEventListener("webglcontextlost", qe, !1), t.addEventListener("webglcontextrestored", et, !1), t.addEventListener("webglcontextcreationerror", Dt, !1), G === null) {
      var re = ["webgl2", "webgl", "experimental-webgl"];
      if (m.isWebGL1Renderer === !0 && re.shift(), G = J(re, F), G === null) throw J(re) ? new Error("Error creating WebGL context with your selected attributes.") : new Error("Error creating WebGL context.");
    }
    G.getShaderPrecisionFormat === void 0 && (G.getShaderPrecisionFormat = function () {
      return {
        rangeMin: 1,
        rangeMax: 1,
        precision: 1
      };
    });
  } catch (F) {
    throw console.error("THREE.WebGLRenderer: " + F.message), F;
  }
  var Z, K, Y, ye, fe, oe, _e, xe, Ie, Oe, Pe, Te, Ve, Ue, L, R, ie, ue, me, De, Me, Ee, le, Je;
  function ke() {
    Z = new KV(G), K = new HV(G, Z, n), Z.init(K), Ee = new EG(G, Z, K), Y = new AG(G, Z, K), ye = new $V(), fe = new dG(), oe = new _G(G, Z, Y, fe, K, Ee, ye), _e = new qV(m), xe = new QV(m), Ie = new lk(G, K), le = new GV(G, Z, Ie, K), Oe = new ZV(G, Ie, ye, le), Pe = new iU(G, Oe, Ie, ye), me = new rU(G, K, oe), R = new WV(fe), Te = new uG(m, _e, xe, Z, K, le, R), Ve = new MG(m, fe), Ue = new fG(), L = new xG(Z, K), ue = new UV(m, _e, xe, Y, Pe, c, o), ie = new wG(m, Pe, K), Je = new CG(G, ye, K, Y), De = new jV(G, Z, ye, K), Me = new JV(G, Z, ye, K), ye.programs = Te.programs, m.capabilities = K, m.extensions = Z, m.properties = fe, m.renderLists = Ue, m.shadowMap = ie, m.state = Y, m.info = ye;
  }
  ke();
  var Be = new zS(m, G);
  this.xr = Be, this.getContext = function () {
    return G;
  }, this.getContextAttributes = function () {
    return G.getContextAttributes();
  }, this.forceContextLoss = function () {
    var F = Z.get("WEBGL_lose_context");
    F && F.loseContext();
  }, this.forceContextRestore = function () {
    var F = Z.get("WEBGL_lose_context");
    F && F.restoreContext();
  }, this.getPixelRatio = function () {
    return C;
  }, this.setPixelRatio = function (F) {
    F !== void 0 && (C = F, this.setSize(T, M, !1));
  }, this.getSize = function (F) {
    return F.set(T, M);
  }, this.setSize = function (F, re, de) {
    if (Be.isPresenting) {
      console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");
      return;
    }
    T = F, M = re, t.width = Math.floor(F * C), t.height = Math.floor(re * C), de !== !1 && (t.style.width = F + "px", t.style.height = re + "px"), this.setViewport(0, 0, F, re);
  }, this.getDrawingBufferSize = function (F) {
    return F.set(T * C, M * C).floor();
  }, this.setDrawingBufferSize = function (F, re, de) {
    T = F, M = re, C = de, t.width = Math.floor(F * de), t.height = Math.floor(re * de), this.setViewport(0, 0, F, re);
  }, this.getCurrentViewport = function (F) {
    return F.copy(A);
  }, this.getViewport = function (F) {
    return F.copy(O);
  }, this.setViewport = function (F, re, de, ee) {
    F.isVector4 ? O.set(F.x, F.y, F.z, F.w) : O.set(F, re, de, ee), Y.viewport(A.copy(O).multiplyScalar(C).floor());
  }, this.getScissor = function (F) {
    return F.copy(I);
  }, this.setScissor = function (F, re, de, ee) {
    F.isVector4 ? I.set(F.x, F.y, F.z, F.w) : I.set(F, re, de, ee), Y.scissor(E.copy(I).multiplyScalar(C).floor());
  }, this.getScissorTest = function () {
    return z;
  }, this.setScissorTest = function (F) {
    Y.setScissorTest(z = F);
  }, this.setOpaqueSort = function (F) {
    P = F;
  }, this.setTransparentSort = function (F) {
    D = F;
  }, this.getClearColor = function (F) {
    return F.copy(ue.getClearColor());
  }, this.setClearColor = function () {
    ue.setClearColor.apply(ue, arguments);
  }, this.getClearAlpha = function () {
    return ue.getClearAlpha();
  }, this.setClearAlpha = function () {
    ue.setClearAlpha.apply(ue, arguments);
  }, this.clear = function () {
    var F = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
    var re = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
    var de = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
    var ee = 0;
    F && (ee |= 16384), re && (ee |= 256), de && (ee |= 1024), G.clear(ee);
  }, this.clearColor = function () {
    this.clear(!0, !1, !1);
  }, this.clearDepth = function () {
    this.clear(!1, !0, !1);
  }, this.clearStencil = function () {
    this.clear(!1, !1, !0);
  }, this.dispose = function () {
    t.removeEventListener("webglcontextlost", qe, !1), t.removeEventListener("webglcontextrestored", et, !1), t.removeEventListener("webglcontextcreationerror", Dt, !1), Ue.dispose(), L.dispose(), fe.dispose(), _e.dispose(), xe.dispose(), Pe.dispose(), le.dispose(), Je.dispose(), Te.dispose(), Be.dispose(), Be.removeEventListener("sessionstart", ze), Be.removeEventListener("sessionend", Fe), j && (j.dispose(), j = null), Ot.stop();
  };
  function qe(F) {
    F.preventDefault(), console.log("THREE.WebGLRenderer: Context Lost."), g = !0;
  }
  function et() {
    console.log("THREE.WebGLRenderer: Context Restored."), g = !1;
    var F = ye.autoReset,
      re = ie.enabled,
      de = ie.autoUpdate,
      ee = ie.needsUpdate,
      pe = ie.type;
    ke(), ye.autoReset = F, ie.enabled = re, ie.autoUpdate = de, ie.needsUpdate = ee, ie.type = pe;
  }
  function Dt(F) {
    console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ", F.statusMessage);
  }
  function yr(F) {
    var re = F.target;
    re.removeEventListener("dispose", yr), ti(re);
  }
  function ti(F) {
    Q(F), fe.remove(F);
  }
  function Q(F) {
    var re = fe.get(F).programs;
    re !== void 0 && (re.forEach(function (de) {
      Te.releaseProgram(de);
    }), F.isShaderMaterial && Te.releaseShaderCache(F));
  }
  this.renderBufferDirect = function (F, re, de, ee, pe, ot) {
    re === null && (re = X);
    var ft = pe.isMesh && pe.matrixWorld.determinant() < 0,
      vt = MN(F, re, de, ee, pe);
    Y.setMaterial(ee, ft);
    var St = de.index,
      Vt = 1;
    ee.wireframe === !0 && (St = Oe.getWireframeAttribute(de), Vt = 2);
    var It = de.drawRange,
      Rt = de.attributes.position,
      ii = It.start * Vt,
      zn = (It.start + It.count) * Vt;
    ot !== null && (ii = Math.max(ii, ot.start * Vt), zn = Math.min(zn, (ot.start + ot.count) * Vt)), St !== null ? (ii = Math.max(ii, 0), zn = Math.min(zn, St.count)) : Rt != null && (ii = Math.max(ii, 0), zn = Math.min(zn, Rt.count));
    var Ko = zn - ii;
    if (Ko < 0 || Ko === 1 / 0) return;
    le.setup(pe, ee, vt, de, St);
    var tc,
      ni = De;
    if (St !== null && (tc = Ie.get(St), ni = Me, ni.setIndex(tc)), pe.isMesh) ee.wireframe === !0 ? (Y.setLineWidth(ee.wireframeLinewidth * q()), ni.setMode(1)) : ni.setMode(4);else if (pe.isLine) {
      var Lt = ee.linewidth;
      Lt === void 0 && (Lt = 1), Y.setLineWidth(Lt * q()), pe.isLineSegments ? ni.setMode(1) : pe.isLineLoop ? ni.setMode(2) : ni.setMode(3);
    } else pe.isPoints ? ni.setMode(0) : pe.isSprite && ni.setMode(4);
    if (pe.isInstancedMesh) ni.renderInstances(ii, Ko, pe.count);else if (de.isInstancedBufferGeometry) {
      var _Lt = de._maxInstanceCount !== void 0 ? de._maxInstanceCount : 1 / 0,
        Bb = Math.min(de.instanceCount, _Lt);
      ni.renderInstances(ii, Ko, Bb);
    } else ni.render(ii, Ko);
  }, this.compile = function (F, re) {
    function de(ee, pe, ot) {
      ee.transparent === !0 && ee.side === qi && ee.forceSinglePass === !1 ? (ee.side = ai, ee.needsUpdate = !0, $n(ee, pe, ot), ee.side = jn, ee.needsUpdate = !0, $n(ee, pe, ot), ee.side = qi) : $n(ee, pe, ot);
    }
    h = L.get(F), h.init(), p.push(h), F.traverseVisible(function (ee) {
      ee.isLight && ee.layers.test(re.layers) && (h.pushLight(ee), ee.castShadow && h.pushShadow(ee));
    }), h.setupLights(m.physicallyCorrectLights), F.traverse(function (ee) {
      var pe = ee.material;
      if (pe) if (Array.isArray(pe)) for (var ot = 0; ot < pe.length; ot++) {
        var ft = pe[ot];
        de(ft, F, ee);
      } else de(pe, F, ee);
    }), p.pop(), h = null;
  };
  var ce = null;
  function ve(F) {
    ce && ce(F);
  }
  function ze() {
    Ot.stop();
  }
  function Fe() {
    Ot.start();
  }
  var Ot = new IM();
  Ot.setAnimationLoop(ve), (typeof self === "undefined" ? "undefined" : _typeof(self)) < "u" && Ot.setContext(self), this.setAnimationLoop = function (F) {
    ce = F, Be.setAnimationLoop(F), F === null ? Ot.stop() : Ot.start();
  }, Be.addEventListener("sessionstart", ze), Be.addEventListener("sessionend", Fe), this.render = function (F, re) {
    if (re !== void 0 && re.isCamera !== !0) {
      console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");
      return;
    }
    if (g === !0) return;
    F.matrixWorldAutoUpdate === !0 && F.updateMatrixWorld(), re.parent === null && re.matrixWorldAutoUpdate === !0 && re.updateMatrixWorld(), Be.enabled === !0 && Be.isPresenting === !0 && (Be.cameraAutoUpdate === !0 && Be.updateCamera(re), re = Be.getCamera()), F.isScene === !0 && F.onBeforeRender(m, F, re, x), h = L.get(F, p.length), h.init(), p.push(h), W.multiplyMatrices(re.projectionMatrix, re.matrixWorldInverse), B.setFromProjectionMatrix(W), U = this.localClippingEnabled, V = R.init(this.clippingPlanes, U), d = Ue.get(F, f.length), d.init(), f.push(d), ri(F, re, 0, m.sortObjects), d.finish(), m.sortObjects === !0 && d.sort(P, D), V === !0 && R.beginShadows();
    var de = h.state.shadowsArray;
    if (ie.render(de, F, re), V === !0 && R.endShadows(), this.info.autoReset === !0 && this.info.reset(), ue.render(d, F), h.setupLights(m.physicallyCorrectLights), re.isArrayCamera) {
      var ee = re.cameras;
      for (var pe = 0, ot = ee.length; pe < ot; pe++) {
        var ft = ee[pe];
        jr(d, F, ft, ft.viewport);
      }
    } else jr(d, F, re);
    x !== null && (oe.updateMultisampleRenderTarget(x), oe.updateRenderTargetMipmap(x)), F.isScene === !0 && F.onAfterRender(m, F, re), le.resetDefaultState(), S = -1, w = null, p.pop(), p.length > 0 ? h = p[p.length - 1] : h = null, f.pop(), f.length > 0 ? d = f[f.length - 1] : d = null;
  };
  function ri(F, re, de, ee) {
    if (F.visible === !1) return;
    if (F.layers.test(re.layers)) {
      if (F.isGroup) de = F.renderOrder;else if (F.isLOD) F.autoUpdate === !0 && F.update(re);else if (F.isLight) h.pushLight(F), F.castShadow && h.pushShadow(F);else if (F.isSprite) {
        if (!F.frustumCulled || B.intersectsSprite(F)) {
          ee && H.setFromMatrixPosition(F.matrixWorld).applyMatrix4(W);
          var ft = Pe.update(F),
            vt = F.material;
          vt.visible && d.push(F, ft, vt, de, H.z, null);
        }
      } else if ((F.isMesh || F.isLine || F.isPoints) && (F.isSkinnedMesh && F.skeleton.frame !== ye.render.frame && (F.skeleton.update(), F.skeleton.frame = ye.render.frame), !F.frustumCulled || B.intersectsObject(F))) {
        ee && H.setFromMatrixPosition(F.matrixWorld).applyMatrix4(W);
        var _ft = Pe.update(F),
          _vt = F.material;
        if (Array.isArray(_vt)) {
          var St = _ft.groups;
          for (var Vt = 0, It = St.length; Vt < It; Vt++) {
            var Rt = St[Vt],
              ii = _vt[Rt.materialIndex];
            ii && ii.visible && d.push(F, _ft, ii, de, H.z, Rt);
          }
        } else _vt.visible && d.push(F, _ft, _vt, de, H.z, null);
      }
    }
    var ot = F.children;
    for (var _ft2 = 0, _vt2 = ot.length; _ft2 < _vt2; _ft2++) ri(ot[_ft2], re, de, ee);
  }
  function jr(F, re, de, ee) {
    var pe = F.opaque,
      ot = F.transmissive,
      ft = F.transparent;
    h.setupLightsView(de), V === !0 && R.setGlobalState(m.clippingPlanes, de), ot.length > 0 && ec(pe, re, de), ee && Y.viewport(A.copy(ee)), pe.length > 0 && _r(pe, re, de), ot.length > 0 && _r(ot, re, de), ft.length > 0 && _r(ft, re, de), Y.buffers.depth.setTest(!0), Y.buffers.depth.setMask(!0), Y.buffers.color.setMask(!0), Y.setPolygonOffset(!1);
  }
  function ec(F, re, de) {
    var ee = K.isWebGL2;
    j === null && (j = new at(1, 1, {
      generateMipmaps: !0,
      type: Z.has("EXT_color_buffer_half_float") ? sa : br,
      minFilter: dc,
      samples: ee && s === !0 ? 4 : 0
    })), m.getDrawingBufferSize(k), ee ? j.setSize(k.x, k.y) : j.setSize(ey(k.x), ey(k.y));
    var pe = m.getRenderTarget();
    m.setRenderTarget(j), m.clear();
    var ot = m.toneMapping;
    m.toneMapping = Os, _r(F, re, de), m.toneMapping = ot, oe.updateMultisampleRenderTarget(j), oe.updateRenderTargetMipmap(j), m.setRenderTarget(pe);
  }
  function _r(F, re, de) {
    var ee = re.isScene === !0 ? re.overrideMaterial : null;
    for (var pe = 0, ot = F.length; pe < ot; pe++) {
      var ft = F[pe],
        vt = ft.object,
        St = ft.geometry,
        Vt = ee === null ? ft.material : ee,
        It = ft.group;
      vt.layers.test(de.layers) && Qo(vt, re, de, St, Vt, It);
    }
  }
  function Qo(F, re, de, ee, pe, ot) {
    F.onBeforeRender(m, re, de, ee, pe, ot), F.modelViewMatrix.multiplyMatrices(de.matrixWorldInverse, F.matrixWorld), F.normalMatrix.getNormalMatrix(F.modelViewMatrix), pe.onBeforeRender(m, re, de, ee, F, ot), pe.transparent === !0 && pe.side === qi && pe.forceSinglePass === !1 ? (pe.side = ai, pe.needsUpdate = !0, m.renderBufferDirect(de, re, ee, pe, F, ot), pe.side = jn, pe.needsUpdate = !0, m.renderBufferDirect(de, re, ee, pe, F, ot), pe.side = qi) : m.renderBufferDirect(de, re, ee, pe, F, ot), F.onAfterRender(m, re, de, ee, pe, ot);
  }
  function $n(F, re, de) {
    re.isScene !== !0 && (re = X);
    var ee = fe.get(F),
      pe = h.state.lights,
      ot = h.state.shadowsArray,
      ft = pe.state.version,
      vt = Te.getParameters(F, pe.state, ot, re, de),
      St = Te.getProgramCacheKey(vt),
      Vt = ee.programs;
    ee.environment = F.isMeshStandardMaterial ? re.environment : null, ee.fog = re.fog, ee.envMap = (F.isMeshStandardMaterial ? xe : _e).get(F.envMap || ee.environment), Vt === void 0 && (F.addEventListener("dispose", yr), Vt = new Map(), ee.programs = Vt);
    var It = Vt.get(St);
    if (It !== void 0) {
      if (ee.currentProgram === It && ee.lightsStateVersion === ft) return UE(F, vt), It;
    } else vt.uniforms = Te.getUniforms(F), F.onBuild(de, vt, m), F.onBeforeCompile(vt, m), It = Te.acquireProgram(vt, St), Vt.set(St, It), ee.uniforms = vt.uniforms;
    var Rt = ee.uniforms;
    (!F.isShaderMaterial && !F.isRawShaderMaterial || F.clipping === !0) && (Rt.clippingPlanes = R.uniform), UE(F, vt), ee.needsLights = PN(F), ee.lightsStateVersion = ft, ee.needsLights && (Rt.ambientLightColor.value = pe.state.ambient, Rt.lightProbe.value = pe.state.probe, Rt.directionalLights.value = pe.state.directional, Rt.directionalLightShadows.value = pe.state.directionalShadow, Rt.spotLights.value = pe.state.spot, Rt.spotLightShadows.value = pe.state.spotShadow, Rt.rectAreaLights.value = pe.state.rectArea, Rt.ltc_1.value = pe.state.rectAreaLTC1, Rt.ltc_2.value = pe.state.rectAreaLTC2, Rt.pointLights.value = pe.state.point, Rt.pointLightShadows.value = pe.state.pointShadow, Rt.hemisphereLights.value = pe.state.hemi, Rt.directionalShadowMap.value = pe.state.directionalShadowMap, Rt.directionalShadowMatrix.value = pe.state.directionalShadowMatrix, Rt.spotShadowMap.value = pe.state.spotShadowMap, Rt.spotLightMatrix.value = pe.state.spotLightMatrix, Rt.spotLightMap.value = pe.state.spotLightMap, Rt.pointShadowMap.value = pe.state.pointShadowMap, Rt.pointShadowMatrix.value = pe.state.pointShadowMatrix);
    var ii = It.getUniforms(),
      zn = Cu.seqWithValue(ii.seq, Rt);
    return ee.currentProgram = It, ee.uniformsList = zn, It;
  }
  function UE(F, re) {
    var de = fe.get(F);
    de.outputEncoding = re.outputEncoding, de.instancing = re.instancing, de.skinning = re.skinning, de.morphTargets = re.morphTargets, de.morphNormals = re.morphNormals, de.morphColors = re.morphColors, de.morphTargetsCount = re.morphTargetsCount, de.numClippingPlanes = re.numClippingPlanes, de.numIntersection = re.numClipIntersection, de.vertexAlphas = re.vertexAlphas, de.vertexTangents = re.vertexTangents, de.toneMapping = re.toneMapping;
  }
  function MN(F, re, de, ee, pe) {
    re.isScene !== !0 && (re = X), oe.resetTextureUnits();
    var ot = re.fog,
      ft = ee.isMeshStandardMaterial ? re.environment : null,
      vt = x === null ? m.outputEncoding : x.isXRRenderTarget === !0 ? x.texture.encoding : dn,
      St = (ee.isMeshStandardMaterial ? xe : _e).get(ee.envMap || ft),
      Vt = ee.vertexColors === !0 && !!de.attributes.color && de.attributes.color.itemSize === 4,
      It = !!ee.normalMap && !!de.attributes.tangent,
      Rt = !!de.morphAttributes.position,
      ii = !!de.morphAttributes.normal,
      zn = !!de.morphAttributes.color,
      Ko = ee.toneMapped ? m.toneMapping : Os,
      tc = de.morphAttributes.position || de.morphAttributes.normal || de.morphAttributes.color,
      ni = tc !== void 0 ? tc.length : 0,
      Lt = fe.get(ee),
      Bb = h.state.lights;
    if (V === !0 && (U === !0 || F !== w)) {
      var Vn = F === w && ee.id === S;
      R.setState(ee, F, Vn);
    }
    var Ci = !1;
    ee.version === Lt.__version ? (Lt.needsLights && Lt.lightsStateVersion !== Bb.state.version || Lt.outputEncoding !== vt || pe.isInstancedMesh && Lt.instancing === !1 || !pe.isInstancedMesh && Lt.instancing === !0 || pe.isSkinnedMesh && Lt.skinning === !1 || !pe.isSkinnedMesh && Lt.skinning === !0 || Lt.envMap !== St || ee.fog === !0 && Lt.fog !== ot || Lt.numClippingPlanes !== void 0 && (Lt.numClippingPlanes !== R.numPlanes || Lt.numIntersection !== R.numIntersection) || Lt.vertexAlphas !== Vt || Lt.vertexTangents !== It || Lt.morphTargets !== Rt || Lt.morphNormals !== ii || Lt.morphColors !== zn || Lt.toneMapping !== Ko || K.isWebGL2 === !0 && Lt.morphTargetsCount !== ni) && (Ci = !0) : (Ci = !0, Lt.__version = ee.version);
    var rc = Lt.currentProgram;
    Ci === !0 && (rc = $n(ee, re, pe));
    var GE = !1,
      Hf = !1,
      Nb = !1,
      Wi = rc.getUniforms(),
      ic = Lt.uniforms;
    if (Y.useProgram(rc.program) && (GE = !0, Hf = !0, Nb = !0), ee.id !== S && (S = ee.id, Hf = !0), GE || w !== F) {
      if (Wi.setValue(G, "projectionMatrix", F.projectionMatrix), K.logarithmicDepthBuffer && Wi.setValue(G, "logDepthBufFC", 2 / (Math.log(F.far + 1) / Math.LN2)), w !== F && (w = F, Hf = !0, Nb = !0), ee.isShaderMaterial || ee.isMeshPhongMaterial || ee.isMeshToonMaterial || ee.isMeshStandardMaterial || ee.envMap) {
        var _Vn = Wi.map.cameraPosition;
        _Vn !== void 0 && _Vn.setValue(G, H.setFromMatrixPosition(F.matrixWorld));
      }
      (ee.isMeshPhongMaterial || ee.isMeshToonMaterial || ee.isMeshLambertMaterial || ee.isMeshBasicMaterial || ee.isMeshStandardMaterial || ee.isShaderMaterial) && Wi.setValue(G, "isOrthographic", F.isOrthographicCamera === !0), (ee.isMeshPhongMaterial || ee.isMeshToonMaterial || ee.isMeshLambertMaterial || ee.isMeshBasicMaterial || ee.isMeshStandardMaterial || ee.isShaderMaterial || ee.isShadowMaterial || pe.isSkinnedMesh) && Wi.setValue(G, "viewMatrix", F.matrixWorldInverse);
    }
    if (pe.isSkinnedMesh) {
      Wi.setOptional(G, pe, "bindMatrix"), Wi.setOptional(G, pe, "bindMatrixInverse");
      var _Vn2 = pe.skeleton;
      _Vn2 && (K.floatVertexTextures ? (_Vn2.boneTexture === null && _Vn2.computeBoneTexture(), Wi.setValue(G, "boneTexture", _Vn2.boneTexture, oe), Wi.setValue(G, "boneTextureSize", _Vn2.boneTextureSize)) : console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."));
    }
    var Fb = de.morphAttributes;
    if ((Fb.position !== void 0 || Fb.normal !== void 0 || Fb.color !== void 0 && K.isWebGL2 === !0) && me.update(pe, de, ee, rc), (Hf || Lt.receiveShadow !== pe.receiveShadow) && (Lt.receiveShadow = pe.receiveShadow, Wi.setValue(G, "receiveShadow", pe.receiveShadow)), ee.isMeshGouraudMaterial && ee.envMap !== null && (ic.envMap.value = St, ic.flipEnvMap.value = St.isCubeTexture && St.isRenderTargetTexture === !1 ? -1 : 1), Hf && (Wi.setValue(G, "toneMappingExposure", m.toneMappingExposure), Lt.needsLights && CN(ic, Nb), ot && ee.fog === !0 && Ve.refreshFogUniforms(ic, ot), Ve.refreshMaterialUniforms(ic, ee, C, M, j), Cu.upload(G, Lt.uniformsList, ic, oe)), ee.isShaderMaterial && ee.uniformsNeedUpdate === !0 && (Cu.upload(G, Lt.uniformsList, ic, oe), ee.uniformsNeedUpdate = !1), ee.isSpriteMaterial && Wi.setValue(G, "center", pe.center), Wi.setValue(G, "modelViewMatrix", pe.modelViewMatrix), Wi.setValue(G, "normalMatrix", pe.normalMatrix), Wi.setValue(G, "modelMatrix", pe.matrixWorld), pe.previousModelViewMatrix && Wi.setValue(G, "previousModelViewMatrix", pe.previousModelViewMatrix), F.previousProjectionMatrix && Wi.setValue(G, "previousProjectionMatrix", F.previousProjectionMatrix), ee.isShaderMaterial || ee.isRawShaderMaterial) {
      var _Vn3 = ee.uniformsGroups;
      for (var kb = 0, DN = _Vn3.length; kb < DN; kb++) if (K.isWebGL2) {
        var jE = _Vn3[kb];
        Je.update(jE, rc), Je.bind(jE, rc);
      } else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");
    }
    return rc;
  }
  function CN(F, re) {
    F.ambientLightColor.needsUpdate = re, F.lightProbe.needsUpdate = re, F.directionalLights.needsUpdate = re, F.directionalLightShadows.needsUpdate = re, F.pointLights.needsUpdate = re, F.pointLightShadows.needsUpdate = re, F.spotLights.needsUpdate = re, F.spotLightShadows.needsUpdate = re, F.rectAreaLights.needsUpdate = re, F.hemisphereLights.needsUpdate = re;
  }
  function PN(F) {
    return F.isMeshLambertMaterial || F.isMeshToonMaterial || F.isMeshPhongMaterial || F.isMeshStandardMaterial || F.isShadowMaterial || F.isShaderMaterial && F.lights === !0;
  }
  this.getActiveCubeFace = function () {
    return y;
  }, this.getActiveMipmapLevel = function () {
    return v;
  }, this.getRenderTarget = function () {
    return x;
  }, this.setRenderTargetTextures = function (F, re, de) {
    fe.get(F.texture).__webglTexture = re, fe.get(F.depthTexture).__webglTexture = de;
    var ee = fe.get(F);
    ee.__hasExternalTextures = !0, ee.__hasExternalTextures && (ee.__autoAllocateDepthBuffer = de === void 0, ee.__autoAllocateDepthBuffer || Z.has("WEBGL_multisampled_render_to_texture") === !0 && (console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"), ee.__useRenderToTexture = !1));
  }, this.setRenderTargetFramebuffer = function (F, re) {
    var de = fe.get(F);
    de.__webglFramebuffer = re, de.__useDefaultFramebuffer = re === void 0;
  }, this.setRenderTarget = function (F) {
    var re = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var de = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    x = F, y = re, v = de;
    var ee = !0,
      pe = null,
      ot = !1,
      ft = !1;
    if (F) {
      var St = fe.get(F);
      St.__useDefaultFramebuffer !== void 0 ? (Y.bindFramebuffer(36160, null), ee = !1) : St.__webglFramebuffer === void 0 ? oe.setupRenderTarget(F) : St.__hasExternalTextures && oe.rebindTextures(F, fe.get(F.texture).__webglTexture, fe.get(F.depthTexture).__webglTexture);
      var Vt = F.texture;
      (Vt.isData3DTexture || Vt.isDataArrayTexture || Vt.isCompressedArrayTexture) && (ft = !0);
      var It = fe.get(F).__webglFramebuffer;
      F.isWebGLCubeRenderTarget ? (pe = It[re], ot = !0) : K.isWebGL2 && F.samples > 0 && oe.useMultisampledRTT(F) === !1 ? pe = fe.get(F).__webglMultisampledFramebuffer : pe = It, A.copy(F.viewport), E.copy(F.scissor), b = F.scissorTest;
    } else A.copy(O).multiplyScalar(C).floor(), E.copy(I).multiplyScalar(C).floor(), b = z;
    if (Y.bindFramebuffer(36160, pe) && K.drawBuffers && ee && Y.drawBuffers(F, pe), Y.viewport(A), Y.scissor(E), Y.setScissorTest(b), ot) {
      var _St = fe.get(F.texture);
      G.framebufferTexture2D(36160, 36064, 34069 + re, _St.__webglTexture, de);
    } else if (ft) {
      var _St2 = fe.get(F.texture),
        _Vt = re || 0;
      G.framebufferTextureLayer(36160, 36064, _St2.__webglTexture, de || 0, _Vt);
    }
    S = -1;
  }, this.readRenderTargetPixels = function (F, re, de, ee, pe, ot, ft) {
    if (!(F && F.isWebGLRenderTarget)) {
      console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
      return;
    }
    var vt = fe.get(F).__webglFramebuffer;
    if (F.isWebGLCubeRenderTarget && ft !== void 0 && (vt = vt[ft]), vt) {
      Y.bindFramebuffer(36160, vt);
      try {
        var St = F.texture,
          Vt = St.format,
          It = St.type;
        if (Vt !== Fr && Ee.convert(Vt) !== G.getParameter(35739)) {
          console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");
          return;
        }
        var Rt = It === sa && (Z.has("EXT_color_buffer_half_float") || K.isWebGL2 && Z.has("EXT_color_buffer_float"));
        if (It !== br && Ee.convert(It) !== G.getParameter(35738) && !(It === dr && (K.isWebGL2 || Z.has("OES_texture_float") || Z.has("WEBGL_color_buffer_float"))) && !Rt) {
          console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");
          return;
        }
        re >= 0 && re <= F.width - ee && de >= 0 && de <= F.height - pe && G.readPixels(re, de, ee, pe, Ee.convert(Vt), Ee.convert(It), ot);
      } finally {
        var _St3 = x !== null ? fe.get(x).__webglFramebuffer : null;
        Y.bindFramebuffer(36160, _St3);
      }
    }
  }, this.copyFramebufferToTexture = function (F, re) {
    var de = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var ee = Math.pow(2, -de),
      pe = Math.floor(re.image.width * ee),
      ot = Math.floor(re.image.height * ee);
    oe.setTexture2D(re, 0), G.copyTexSubImage2D(3553, de, 0, 0, F.x, F.y, pe, ot), Y.unbindTexture();
  }, this.copyTextureToTexture = function (F, re, de) {
    var ee = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    var pe = re.image.width,
      ot = re.image.height,
      ft = Ee.convert(de.format),
      vt = Ee.convert(de.type);
    oe.setTexture2D(de, 0), G.pixelStorei(37440, de.flipY), G.pixelStorei(37441, de.premultiplyAlpha), G.pixelStorei(3317, de.unpackAlignment), re.isDataTexture ? G.texSubImage2D(3553, ee, F.x, F.y, pe, ot, ft, vt, re.image.data) : re.isCompressedTexture ? G.compressedTexSubImage2D(3553, ee, F.x, F.y, re.mipmaps[0].width, re.mipmaps[0].height, ft, re.mipmaps[0].data) : G.texSubImage2D(3553, ee, F.x, F.y, ft, vt, re.image), ee === 0 && de.generateMipmaps && G.generateMipmap(3553), Y.unbindTexture();
  }, this.copyTextureToTexture3D = function (F, re, de, ee) {
    var pe = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
    if (m.isWebGL1Renderer) {
      console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");
      return;
    }
    var ot = F.max.x - F.min.x + 1,
      ft = F.max.y - F.min.y + 1,
      vt = F.max.z - F.min.z + 1,
      St = Ee.convert(ee.format),
      Vt = Ee.convert(ee.type),
      It;
    if (ee.isData3DTexture) oe.setTexture3D(ee, 0), It = 32879;else if (ee.isDataArrayTexture) oe.setTexture2DArray(ee, 0), It = 35866;else {
      console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");
      return;
    }
    G.pixelStorei(37440, ee.flipY), G.pixelStorei(37441, ee.premultiplyAlpha), G.pixelStorei(3317, ee.unpackAlignment);
    var Rt = G.getParameter(3314),
      ii = G.getParameter(32878),
      zn = G.getParameter(3316),
      Ko = G.getParameter(3315),
      tc = G.getParameter(32877),
      ni = de.isCompressedTexture ? de.mipmaps[0] : de.image;
    G.pixelStorei(3314, ni.width), G.pixelStorei(32878, ni.height), G.pixelStorei(3316, F.min.x), G.pixelStorei(3315, F.min.y), G.pixelStorei(32877, F.min.z), de.isDataTexture || de.isData3DTexture ? G.texSubImage3D(It, pe, re.x, re.y, re.z, ot, ft, vt, St, Vt, ni.data) : de.isCompressedArrayTexture ? (console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."), G.compressedTexSubImage3D(It, pe, re.x, re.y, re.z, ot, ft, vt, St, ni.data)) : G.texSubImage3D(It, pe, re.x, re.y, re.z, ot, ft, vt, St, Vt, ni), G.pixelStorei(3314, Rt), G.pixelStorei(32878, ii), G.pixelStorei(3316, zn), G.pixelStorei(3315, Ko), G.pixelStorei(32877, tc), pe === 0 && ee.generateMipmaps && G.generateMipmap(It), Y.unbindTexture();
  }, this.initTexture = function (F) {
    F.isCubeTexture ? oe.setTextureCube(F, 0) : F.isData3DTexture ? oe.setTexture3D(F, 0) : F.isDataArrayTexture || F.isCompressedArrayTexture ? oe.setTexture2DArray(F, 0) : oe.setTexture2D(F, 0), Y.unbindTexture();
  }, this.resetState = function () {
    y = 0, v = 0, x = null, Y.reset(), le.reset();
  }, (typeof __THREE_DEVTOOLS__ === "undefined" ? "undefined" : _typeof(__THREE_DEVTOOLS__)) < "u" && __THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe", {
    detail: this
  }));
}
var VS = /*#__PURE__*/function (_dw) {
  _inherits(VS, _dw);
  var _super29 = _createSuper(VS);
  function VS() {
    _classCallCheck(this, VS);
    return _super29.apply(this, arguments);
  }
  return _createClass(VS);
}(dw);
VS.prototype.isWebGL1Renderer = !0;
var Iu = /*#__PURE__*/function () {
    function Iu(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1e3;
      _classCallCheck(this, Iu);
      this.isFog = !0, this.name = "", this.color = new Le(t), this.near = e, this.far = r;
    }
    _createClass(Iu, [{
      key: "clone",
      value: function clone() {
        return new Iu(this.color, this.near, this.far);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        return {
          type: "Fog",
          color: this.color.getHex(),
          near: this.near,
          far: this.far
        };
      }
    }]);
    return Iu;
  }(),
  vi = /*#__PURE__*/function (_mt5) {
    _inherits(vi, _mt5);
    var _super30 = _createSuper(vi);
    function vi() {
      var _this26;
      _classCallCheck(this, vi);
      _this26 = _super30.call(this), _this26.isScene = !0, _this26.type = "Scene", _this26.background = null, _this26.environment = null, _this26.fog = null, _this26.backgroundBlurriness = 0, _this26.backgroundIntensity = 1, _this26.overrideMaterial = null, (typeof __THREE_DEVTOOLS__ === "undefined" ? "undefined" : _typeof(__THREE_DEVTOOLS__)) < "u" && __THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe", {
        detail: _assertThisInitialized(_this26)
      }));
      return _this26;
    }
    _createClass(vi, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(vi.prototype), "copy", this).call(this, t, e), t.background !== null && (this.background = t.background.clone()), t.environment !== null && (this.environment = t.environment.clone()), t.fog !== null && (this.fog = t.fog.clone()), this.backgroundBlurriness = t.backgroundBlurriness, this.backgroundIntensity = t.backgroundIntensity, t.overrideMaterial !== null && (this.overrideMaterial = t.overrideMaterial.clone()), this.matrixAutoUpdate = t.matrixAutoUpdate, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = _get(_getPrototypeOf(vi.prototype), "toJSON", this).call(this, t);
        return this.fog !== null && (e.object.fog = this.fog.toJSON()), this.backgroundBlurriness > 0 && (e.object.backgroundBlurriness = this.backgroundBlurriness), this.backgroundIntensity !== 1 && (e.object.backgroundIntensity = this.backgroundIntensity), e;
      }
    }, {
      key: "autoUpdate",
      get: function get() {
        return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."), this.matrixWorldAutoUpdate;
      },
      set: function set(t) {
        console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."), this.matrixWorldAutoUpdate = t;
      }
    }]);
    return vi;
  }(mt),
  ly = /*#__PURE__*/function () {
    function ly(t, e) {
      _classCallCheck(this, ly);
      this.isInterleavedBuffer = !0, this.array = t, this.stride = e, this.count = t !== void 0 ? t.length / e : 0, this.usage = TS, this.updateRange = {
        offset: 0,
        count: -1
      }, this.version = 0, this.uuid = rs();
    }
    _createClass(ly, [{
      key: "onUploadCallback",
      value: function onUploadCallback() {}
    }, {
      key: "needsUpdate",
      set: function set(t) {
        t === !0 && this.version++;
      }
    }, {
      key: "setUsage",
      value: function setUsage(t) {
        return this.usage = t, this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.array = new t.array.constructor(t.array), this.count = t.count, this.stride = t.stride, this.usage = t.usage, this;
      }
    }, {
      key: "copyAt",
      value: function copyAt(t, e, r) {
        t *= this.stride, r *= e.stride;
        for (var i = 0, s = this.stride; i < s; i++) this.array[t + i] = e.array[r + i];
        return this;
      }
    }, {
      key: "set",
      value: function set(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        return this.array.set(t, e), this;
      }
    }, {
      key: "clone",
      value: function clone(t) {
        t.arrayBuffers === void 0 && (t.arrayBuffers = {}), this.array.buffer._uuid === void 0 && (this.array.buffer._uuid = rs()), t.arrayBuffers[this.array.buffer._uuid] === void 0 && (t.arrayBuffers[this.array.buffer._uuid] = this.array.slice(0).buffer);
        var e = new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),
          r = new this.constructor(e, this.stride);
        return r.setUsage(this.usage), r;
      }
    }, {
      key: "onUpload",
      value: function onUpload(t) {
        return this.onUploadCallback = t, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        return t.arrayBuffers === void 0 && (t.arrayBuffers = {}), this.array.buffer._uuid === void 0 && (this.array.buffer._uuid = rs()), t.arrayBuffers[this.array.buffer._uuid] === void 0 && (t.arrayBuffers[this.array.buffer._uuid] = Array.from(new Uint32Array(this.array.buffer))), {
          uuid: this.uuid,
          buffer: this.array.buffer._uuid,
          type: this.array.constructor.name,
          stride: this.stride
        };
      }
    }]);
    return ly;
  }(),
  cn = new _(),
  fc = /*#__PURE__*/function () {
    function fc(t, e, r) {
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
      _classCallCheck(this, fc);
      this.isInterleavedBufferAttribute = !0, this.name = "", this.data = t, this.itemSize = e, this.offset = r, this.normalized = i;
    }
    _createClass(fc, [{
      key: "count",
      get: function get() {
        return this.data.count;
      }
    }, {
      key: "array",
      get: function get() {
        return this.data.array;
      }
    }, {
      key: "needsUpdate",
      set: function set(t) {
        this.data.needsUpdate = t;
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        for (var e = 0, r = this.data.count; e < r; e++) cn.fromBufferAttribute(this, e), cn.applyMatrix4(t), this.setXYZ(e, cn.x, cn.y, cn.z);
        return this;
      }
    }, {
      key: "applyNormalMatrix",
      value: function applyNormalMatrix(t) {
        for (var e = 0, r = this.count; e < r; e++) cn.fromBufferAttribute(this, e), cn.applyNormalMatrix(t), this.setXYZ(e, cn.x, cn.y, cn.z);
        return this;
      }
    }, {
      key: "transformDirection",
      value: function transformDirection(t) {
        for (var e = 0, r = this.count; e < r; e++) cn.fromBufferAttribute(this, e), cn.transformDirection(t), this.setXYZ(e, cn.x, cn.y, cn.z);
        return this;
      }
    }, {
      key: "setX",
      value: function setX(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.data.array[t * this.data.stride + this.offset] = e, this;
      }
    }, {
      key: "setY",
      value: function setY(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.data.array[t * this.data.stride + this.offset + 1] = e, this;
      }
    }, {
      key: "setZ",
      value: function setZ(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.data.array[t * this.data.stride + this.offset + 2] = e, this;
      }
    }, {
      key: "setW",
      value: function setW(t, e) {
        return this.normalized && (e = ur(e, this.array)), this.data.array[t * this.data.stride + this.offset + 3] = e, this;
      }
    }, {
      key: "getX",
      value: function getX(t) {
        var e = this.data.array[t * this.data.stride + this.offset];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "getY",
      value: function getY(t) {
        var e = this.data.array[t * this.data.stride + this.offset + 1];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "getZ",
      value: function getZ(t) {
        var e = this.data.array[t * this.data.stride + this.offset + 2];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "getW",
      value: function getW(t) {
        var e = this.data.array[t * this.data.stride + this.offset + 3];
        return this.normalized && (e = na(e, this.array)), e;
      }
    }, {
      key: "setXY",
      value: function setXY(t, e, r) {
        return t = t * this.data.stride + this.offset, this.normalized && (e = ur(e, this.array), r = ur(r, this.array)), this.data.array[t + 0] = e, this.data.array[t + 1] = r, this;
      }
    }, {
      key: "setXYZ",
      value: function setXYZ(t, e, r, i) {
        return t = t * this.data.stride + this.offset, this.normalized && (e = ur(e, this.array), r = ur(r, this.array), i = ur(i, this.array)), this.data.array[t + 0] = e, this.data.array[t + 1] = r, this.data.array[t + 2] = i, this;
      }
    }, {
      key: "setXYZW",
      value: function setXYZW(t, e, r, i, s) {
        return t = t * this.data.stride + this.offset, this.normalized && (e = ur(e, this.array), r = ur(r, this.array), i = ur(i, this.array), s = ur(s, this.array)), this.data.array[t + 0] = e, this.data.array[t + 1] = r, this.data.array[t + 2] = i, this.data.array[t + 3] = s, this;
      }
    }, {
      key: "clone",
      value: function clone(t) {
        if (t === void 0) {
          console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");
          var e = [];
          for (var r = 0; r < this.count; r++) {
            var i = r * this.data.stride + this.offset;
            for (var s = 0; s < this.itemSize; s++) e.push(this.data.array[i + s]);
          }
          return new Ge(new this.array.constructor(e), this.itemSize, this.normalized);
        } else return t.interleavedBuffers === void 0 && (t.interleavedBuffers = {}), t.interleavedBuffers[this.data.uuid] === void 0 && (t.interleavedBuffers[this.data.uuid] = this.data.clone(t)), new fc(t.interleavedBuffers[this.data.uuid], this.itemSize, this.offset, this.normalized);
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        if (t === void 0) {
          console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");
          var e = [];
          for (var r = 0; r < this.count; r++) {
            var i = r * this.data.stride + this.offset;
            for (var s = 0; s < this.itemSize; s++) e.push(this.data.array[i + s]);
          }
          return {
            itemSize: this.itemSize,
            type: this.array.constructor.name,
            array: e,
            normalized: this.normalized
          };
        } else return t.interleavedBuffers === void 0 && (t.interleavedBuffers = {}), t.interleavedBuffers[this.data.uuid] === void 0 && (t.interleavedBuffers[this.data.uuid] = this.data.toJSON(t)), {
          isInterleavedBufferAttribute: !0,
          itemSize: this.itemSize,
          data: this.data.uuid,
          offset: this.offset,
          normalized: this.normalized
        };
      }
    }]);
    return fc;
  }();
var fp = /*#__PURE__*/function (_mt6) {
    _inherits(fp, _mt6);
    var _super31 = _createSuper(fp);
    function fp() {
      var _this27;
      _classCallCheck(this, fp);
      _this27 = _super31.call(this), _this27.isBone = !0, _this27.type = "Bone";
      return _this27;
    }
    return _createClass(fp);
  }(mt),
  ci = /*#__PURE__*/function (_qt5) {
    _inherits(ci, _qt5);
    var _super32 = _createSuper(ci);
    function ci() {
      var _this28;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 ? arguments[3] : undefined;
      var s = arguments.length > 4 ? arguments[4] : undefined;
      var o = arguments.length > 5 ? arguments[5] : undefined;
      var a = arguments.length > 6 ? arguments[6] : undefined;
      var l = arguments.length > 7 ? arguments[7] : undefined;
      var u = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : Et;
      var c = arguments.length > 9 && arguments[9] !== undefined ? arguments[9] : Et;
      var d = arguments.length > 10 ? arguments[10] : undefined;
      var h = arguments.length > 11 ? arguments[11] : undefined;
      _classCallCheck(this, ci);
      _this28 = _super32.call(this, null, o, a, l, u, c, i, s, d, h), _this28.isDataTexture = !0, _this28.image = {
        data: t,
        width: e,
        height: r
      }, _this28.generateMipmaps = !1, _this28.flipY = !1, _this28.unpackAlignment = 1;
      return _this28;
    }
    return _createClass(ci);
  }(qt),
  $T = new te(),
  DG = new te(),
  Za = /*#__PURE__*/function () {
    function Za() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      _classCallCheck(this, Za);
      this.uuid = rs(), this.bones = t.slice(0), this.boneInverses = e, this.boneMatrices = null, this.boneTexture = null, this.boneTextureSize = 0, this.frame = -1, this.init();
    }
    _createClass(Za, [{
      key: "init",
      value: function init() {
        var t = this.bones,
          e = this.boneInverses;
        if (this.boneMatrices = new Float32Array(t.length * 16), e.length === 0) this.calculateInverses();else if (t.length !== e.length) {
          console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."), this.boneInverses = [];
          for (var r = 0, i = this.bones.length; r < i; r++) this.boneInverses.push(new te());
        }
      }
    }, {
      key: "calculateInverses",
      value: function calculateInverses() {
        this.boneInverses.length = 0;
        for (var t = 0, e = this.bones.length; t < e; t++) {
          var r = new te();
          this.bones[t] && r.copy(this.bones[t].matrixWorld).invert(), this.boneInverses.push(r);
        }
      }
    }, {
      key: "pose",
      value: function pose() {
        for (var t = 0, e = this.bones.length; t < e; t++) {
          var r = this.bones[t];
          r && r.matrixWorld.copy(this.boneInverses[t]).invert();
        }
        for (var _t2 = 0, _e4 = this.bones.length; _t2 < _e4; _t2++) {
          var _r4 = this.bones[_t2];
          _r4 && (_r4.parent && _r4.parent.isBone ? (_r4.matrix.copy(_r4.parent.matrixWorld).invert(), _r4.matrix.multiply(_r4.matrixWorld)) : _r4.matrix.copy(_r4.matrixWorld), _r4.matrix.decompose(_r4.position, _r4.quaternion, _r4.scale));
        }
      }
    }, {
      key: "update",
      value: function update() {
        var t = this.bones,
          e = this.boneInverses,
          r = this.boneMatrices,
          i = this.boneTexture;
        for (var s = 0, o = t.length; s < o; s++) {
          var a = t[s] ? t[s].matrixWorld : DG;
          $T.multiplyMatrices(a, e[s]), $T.toArray(r, s * 16);
        }
        i !== null && (i.needsUpdate = !0);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new Za(this.bones, this.boneInverses);
      }
    }, {
      key: "computeBoneTexture",
      value: function computeBoneTexture() {
        var t = Math.sqrt(this.bones.length * 4);
        t = CM(t), t = Math.max(t, 4);
        var e = new Float32Array(t * t * 4);
        e.set(this.boneMatrices);
        var r = new ci(e, t, t, Fr, dr);
        return r.needsUpdate = !0, this.boneMatrices = e, this.boneTexture = r, this.boneTextureSize = t, this;
      }
    }, {
      key: "getBoneByName",
      value: function getBoneByName(t) {
        for (var e = 0, r = this.bones.length; e < r; e++) {
          var i = this.bones[e];
          if (i.name === t) return i;
        }
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.boneTexture !== null && (this.boneTexture.dispose(), this.boneTexture = null);
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t, e) {
        this.uuid = t.uuid;
        for (var r = 0, i = t.bones.length; r < i; r++) {
          var s = t.bones[r],
            o = e[s];
          o === void 0 && (console.warn("THREE.Skeleton: No bone found with UUID:", s), o = new fp()), this.bones.push(o), this.boneInverses.push(new te().fromArray(t.boneInverses[r]));
        }
        return this.init(), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {
          metadata: {
            version: 4.5,
            type: "Skeleton",
            generator: "Skeleton.toJSON"
          },
          bones: [],
          boneInverses: []
        };
        t.uuid = this.uuid;
        var e = this.bones,
          r = this.boneInverses;
        for (var i = 0, s = e.length; i < s; i++) {
          var o = e[i];
          t.bones.push(o.uuid);
          var a = r[i];
          t.boneInverses.push(a.toArray());
        }
        return t;
      }
    }]);
    return Za;
  }(),
  uo = /*#__PURE__*/function (_Ge4) {
    _inherits(uo, _Ge4);
    var _super33 = _createSuper(uo);
    function uo(t, e, r) {
      var _this29;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, uo);
      _this29 = _super33.call(this, t, e, r), _this29.isInstancedBufferAttribute = !0, _this29.meshPerAttribute = i;
      return _this29;
    }
    _createClass(uo, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(uo.prototype), "copy", this).call(this, t), this.meshPerAttribute = t.meshPerAttribute, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(uo.prototype), "toJSON", this).call(this);
        return t.meshPerAttribute = this.meshPerAttribute, t.isInstancedBufferAttribute = !0, t;
      }
    }]);
    return uo;
  }(Ge),
  eM = new te(),
  tM = new te(),
  Ug = [],
  OG = new te(),
  Jf = new rr(),
  cy = /*#__PURE__*/function (_rr) {
    _inherits(cy, _rr);
    var _super34 = _createSuper(cy);
    function cy(t, e, r) {
      var _this30;
      _classCallCheck(this, cy);
      _this30 = _super34.call(this, t, e), _this30.isInstancedMesh = !0, _this30.instanceMatrix = new uo(new Float32Array(r * 16), 16), _this30.instanceColor = null, _this30.count = r, _this30.frustumCulled = !1;
      for (var i = 0; i < r; i++) _this30.setMatrixAt(i, OG);
      return _this30;
    }
    _createClass(cy, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(cy.prototype), "copy", this).call(this, t, e), this.instanceMatrix.copy(t.instanceMatrix), t.instanceColor !== null && (this.instanceColor = t.instanceColor.clone()), this.count = t.count, this;
      }
    }, {
      key: "getColorAt",
      value: function getColorAt(t, e) {
        e.fromArray(this.instanceColor.array, t * 3);
      }
    }, {
      key: "getMatrixAt",
      value: function getMatrixAt(t, e) {
        e.fromArray(this.instanceMatrix.array, t * 16);
      }
    }, {
      key: "raycast",
      value: function raycast(t, e) {
        var r = this.matrixWorld,
          i = this.count;
        if (Jf.geometry = this.geometry, Jf.material = this.material, Jf.material !== void 0) for (var s = 0; s < i; s++) {
          this.getMatrixAt(s, eM), tM.multiplyMatrices(r, eM), Jf.matrixWorld = tM, Jf.raycast(t, Ug);
          for (var o = 0, a = Ug.length; o < a; o++) {
            var l = Ug[o];
            l.instanceId = s, l.object = this, e.push(l);
          }
          Ug.length = 0;
        }
      }
    }, {
      key: "setColorAt",
      value: function setColorAt(t, e) {
        this.instanceColor === null && (this.instanceColor = new uo(new Float32Array(this.instanceMatrix.count * 3), 3)), e.toArray(this.instanceColor.array, t * 3);
      }
    }, {
      key: "setMatrixAt",
      value: function setMatrixAt(t, e) {
        e.toArray(this.instanceMatrix.array, t * 16);
      }
    }, {
      key: "updateMorphTargets",
      value: function updateMorphTargets() {}
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }]);
    return cy;
  }(rr),
  ns = /*#__PURE__*/function (_hc5) {
    _inherits(ns, _hc5);
    var _super35 = _createSuper(ns);
    function ns(t) {
      var _this31;
      _classCallCheck(this, ns);
      _this31 = _super35.call(this), _this31.isLineBasicMaterial = !0, _this31.type = "LineBasicMaterial", _this31.color = new Le(16777215), _this31.linewidth = 1, _this31.linecap = "round", _this31.linejoin = "round", _this31.fog = !0, _this31.setValues(t);
      return _this31;
    }
    _createClass(ns, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(ns.prototype), "copy", this).call(this, t), this.color.copy(t.color), this.linewidth = t.linewidth, this.linecap = t.linecap, this.linejoin = t.linejoin, this.fog = t.fog, this;
      }
    }]);
    return ns;
  }(hc),
  rM = new _(),
  iM = new _(),
  nM = new te(),
  gS = new Rs(),
  Gg = new Er(),
  pc = /*#__PURE__*/function (_mt7) {
    _inherits(pc, _mt7);
    var _super36 = _createSuper(pc);
    function pc() {
      var _this32;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new we();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new ns();
      _classCallCheck(this, pc);
      _this32 = _super36.call(this), _this32.isLine = !0, _this32.type = "Line", _this32.geometry = t, _this32.material = e, _this32.updateMorphTargets();
      return _this32;
    }
    _createClass(pc, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(pc.prototype), "copy", this).call(this, t, e), this.material = t.material, this.geometry = t.geometry, this;
      }
    }, {
      key: "computeLineDistances",
      value: function computeLineDistances() {
        var t = this.geometry;
        if (t.index === null) {
          var e = t.attributes.position,
            r = [0];
          for (var i = 1, s = e.count; i < s; i++) rM.fromBufferAttribute(e, i - 1), iM.fromBufferAttribute(e, i), r[i] = r[i - 1], r[i] += rM.distanceTo(iM);
          t.setAttribute("lineDistance", new be(r, 1));
        } else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
        return this;
      }
    }, {
      key: "raycast",
      value: function raycast(t, e) {
        var r = this.geometry,
          i = this.matrixWorld,
          s = t.params.Line.threshold,
          o = r.drawRange;
        if (r.boundingSphere === null && r.computeBoundingSphere(), Gg.copy(r.boundingSphere), Gg.applyMatrix4(i), Gg.radius += s, t.ray.intersectsSphere(Gg) === !1) return;
        nM.copy(i).invert(), gS.copy(t.ray).applyMatrix4(nM);
        var a = s / ((this.scale.x + this.scale.y + this.scale.z) / 3),
          l = a * a,
          u = new _(),
          c = new _(),
          d = new _(),
          h = new _(),
          f = this.isLineSegments ? 2 : 1,
          p = r.index,
          g = r.attributes.position;
        if (p !== null) {
          var y = Math.max(0, o.start),
            v = Math.min(p.count, o.start + o.count);
          for (var x = y, S = v - 1; x < S; x += f) {
            var w = p.getX(x),
              A = p.getX(x + 1);
            if (u.fromBufferAttribute(g, w), c.fromBufferAttribute(g, A), gS.distanceSqToSegment(u, c, h, d) > l) continue;
            h.applyMatrix4(this.matrixWorld);
            var b = t.ray.origin.distanceTo(h);
            b < t.near || b > t.far || e.push({
              distance: b,
              point: d.clone().applyMatrix4(this.matrixWorld),
              index: x,
              face: null,
              faceIndex: null,
              object: this
            });
          }
        } else {
          var _y7 = Math.max(0, o.start),
            _v8 = Math.min(g.count, o.start + o.count);
          for (var _x10 = _y7, _S9 = _v8 - 1; _x10 < _S9; _x10 += f) {
            if (u.fromBufferAttribute(g, _x10), c.fromBufferAttribute(g, _x10 + 1), gS.distanceSqToSegment(u, c, h, d) > l) continue;
            h.applyMatrix4(this.matrixWorld);
            var _A6 = t.ray.origin.distanceTo(h);
            _A6 < t.near || _A6 > t.far || e.push({
              distance: _A6,
              point: d.clone().applyMatrix4(this.matrixWorld),
              index: _x10,
              face: null,
              faceIndex: null,
              object: this
            });
          }
        }
      }
    }, {
      key: "updateMorphTargets",
      value: function updateMorphTargets() {
        var e = this.geometry.morphAttributes,
          r = Object.keys(e);
        if (r.length > 0) {
          var i = e[r[0]];
          if (i !== void 0) {
            this.morphTargetInfluences = [], this.morphTargetDictionary = {};
            for (var s = 0, o = i.length; s < o; s++) {
              var a = i[s].name || String(s);
              this.morphTargetInfluences.push(0), this.morphTargetDictionary[a] = s;
            }
          }
        }
      }
    }]);
    return pc;
  }(mt),
  sM = new _(),
  oM = new _(),
  Ja = /*#__PURE__*/function (_pc) {
    _inherits(Ja, _pc);
    var _super37 = _createSuper(Ja);
    function Ja(t, e) {
      var _this33;
      _classCallCheck(this, Ja);
      _this33 = _super37.call(this, t, e), _this33.isLineSegments = !0, _this33.type = "LineSegments";
      return _this33;
    }
    _createClass(Ja, [{
      key: "computeLineDistances",
      value: function computeLineDistances() {
        var t = this.geometry;
        if (t.index === null) {
          var e = t.attributes.position,
            r = [];
          for (var i = 0, s = e.count; i < s; i += 2) sM.fromBufferAttribute(e, i), oM.fromBufferAttribute(e, i + 1), r[i] = i === 0 ? 0 : r[i - 1], r[i + 1] = r[i] + sM.distanceTo(oM);
          t.setAttribute("lineDistance", new be(r, 1));
        } else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");
        return this;
      }
    }]);
    return Ja;
  }(pc);
var uy = /*#__PURE__*/function (_qt6) {
  _inherits(uy, _qt6);
  var _super38 = _createSuper(uy);
  function uy(t, e, r, i, s, o, a, l, u) {
    var _this34;
    _classCallCheck(this, uy);
    _this34 = _super38.call(this, t, e, r, i, s, o, a, l, u), _this34.isVideoTexture = !0, _this34.minFilter = o !== void 0 ? o : Qe, _this34.magFilter = s !== void 0 ? s : Qe, _this34.generateMipmaps = !1;
    var c = _assertThisInitialized(_this34);
    function d() {
      c.needsUpdate = !0, t.requestVideoFrameCallback(d);
    }
    "requestVideoFrameCallback" in t && t.requestVideoFrameCallback(d);
    return _this34;
  }
  _createClass(uy, [{
    key: "clone",
    value: function clone() {
      return new this.constructor(this.image).copy(this);
    }
  }, {
    key: "update",
    value: function update() {
      var t = this.image;
      "requestVideoFrameCallback" in t === !1 && t.readyState >= t.HAVE_CURRENT_DATA && (this.needsUpdate = !0);
    }
  }]);
  return uy;
}(qt);
var dy = /*#__PURE__*/function (_qt7) {
    _inherits(dy, _qt7);
    var _super39 = _createSuper(dy);
    function dy(t, e, r, i, s, o, a, l, u) {
      var _this35;
      _classCallCheck(this, dy);
      _this35 = _super39.call(this, t, e, r, i, s, o, a, l, u), _this35.isCanvasTexture = !0, _this35.needsUpdate = !0;
      return _this35;
    }
    return _createClass(dy);
  }(qt),
  ss = /*#__PURE__*/function () {
    function ss() {
      _classCallCheck(this, ss);
      this.type = "Curve", this.arcLengthDivisions = 200;
    }
    _createClass(ss, [{
      key: "getPoint",
      value: function getPoint() {
        return console.warn("THREE.Curve: .getPoint() not implemented."), null;
      }
    }, {
      key: "getPointAt",
      value: function getPointAt(t, e) {
        var r = this.getUtoTmapping(t);
        return this.getPoint(r, e);
      }
    }, {
      key: "getPoints",
      value: function getPoints() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;
        var e = [];
        for (var r = 0; r <= t; r++) e.push(this.getPoint(r / t));
        return e;
      }
    }, {
      key: "getSpacedPoints",
      value: function getSpacedPoints() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;
        var e = [];
        for (var r = 0; r <= t; r++) e.push(this.getPointAt(r / t));
        return e;
      }
    }, {
      key: "getLength",
      value: function getLength() {
        var t = this.getLengths();
        return t[t.length - 1];
      }
    }, {
      key: "getLengths",
      value: function getLengths() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.arcLengthDivisions;
        if (this.cacheArcLengths && this.cacheArcLengths.length === t + 1 && !this.needsUpdate) return this.cacheArcLengths;
        this.needsUpdate = !1;
        var e = [],
          r,
          i = this.getPoint(0),
          s = 0;
        e.push(0);
        for (var o = 1; o <= t; o++) r = this.getPoint(o / t), s += r.distanceTo(i), e.push(s), i = r;
        return this.cacheArcLengths = e, e;
      }
    }, {
      key: "updateArcLengths",
      value: function updateArcLengths() {
        this.needsUpdate = !0, this.getLengths();
      }
    }, {
      key: "getUtoTmapping",
      value: function getUtoTmapping(t, e) {
        var r = this.getLengths(),
          i = 0,
          s = r.length,
          o;
        e ? o = e : o = t * r[s - 1];
        var a = 0,
          l = s - 1,
          u;
        for (; a <= l;) if (i = Math.floor(a + (l - a) / 2), u = r[i] - o, u < 0) a = i + 1;else if (u > 0) l = i - 1;else {
          l = i;
          break;
        }
        if (i = l, r[i] === o) return i / (s - 1);
        var c = r[i],
          h = r[i + 1] - c,
          f = (o - c) / h;
        return (i + f) / (s - 1);
      }
    }, {
      key: "getTangent",
      value: function getTangent(t, e) {
        var i = t - 1e-4,
          s = t + 1e-4;
        i < 0 && (i = 0), s > 1 && (s = 1);
        var o = this.getPoint(i),
          a = this.getPoint(s),
          l = e || (o.isVector2 ? new N() : new _());
        return l.copy(a).sub(o).normalize(), l;
      }
    }, {
      key: "getTangentAt",
      value: function getTangentAt(t, e) {
        var r = this.getUtoTmapping(t);
        return this.getTangent(r, e);
      }
    }, {
      key: "computeFrenetFrames",
      value: function computeFrenetFrames(t, e) {
        var r = new _(),
          i = [],
          s = [],
          o = [],
          a = new _(),
          l = new te();
        for (var f = 0; f <= t; f++) {
          var p = f / t;
          i[f] = this.getTangentAt(p, new _());
        }
        s[0] = new _(), o[0] = new _();
        var u = Number.MAX_VALUE,
          c = Math.abs(i[0].x),
          d = Math.abs(i[0].y),
          h = Math.abs(i[0].z);
        c <= u && (u = c, r.set(1, 0, 0)), d <= u && (u = d, r.set(0, 1, 0)), h <= u && r.set(0, 0, 1), a.crossVectors(i[0], r).normalize(), s[0].crossVectors(i[0], a), o[0].crossVectors(i[0], s[0]);
        for (var _f15 = 1; _f15 <= t; _f15++) {
          if (s[_f15] = s[_f15 - 1].clone(), o[_f15] = o[_f15 - 1].clone(), a.crossVectors(i[_f15 - 1], i[_f15]), a.length() > Number.EPSILON) {
            a.normalize();
            var _p12 = Math.acos(oi(i[_f15 - 1].dot(i[_f15]), -1, 1));
            s[_f15].applyMatrix4(l.makeRotationAxis(a, _p12));
          }
          o[_f15].crossVectors(i[_f15], s[_f15]);
        }
        if (e === !0) {
          var _f16 = Math.acos(oi(s[0].dot(s[t]), -1, 1));
          _f16 /= t, i[0].dot(a.crossVectors(s[0], s[t])) > 0 && (_f16 = -_f16);
          for (var _p13 = 1; _p13 <= t; _p13++) s[_p13].applyMatrix4(l.makeRotationAxis(i[_p13], _f16 * _p13)), o[_p13].crossVectors(i[_p13], s[_p13]);
        }
        return {
          tangents: i,
          normals: s,
          binormals: o
        };
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.arcLengthDivisions = t.arcLengthDivisions, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {
          metadata: {
            version: 4.5,
            type: "Curve",
            generator: "Curve.toJSON"
          }
        };
        return t.arcLengthDivisions = this.arcLengthDivisions, t.type = this.type, t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return this.arcLengthDivisions = t.arcLengthDivisions, this;
      }
    }]);
    return ss;
  }(),
  mc = /*#__PURE__*/function (_ss) {
    _inherits(mc, _ss);
    var _super40 = _createSuper(mc);
    function mc() {
      var _this36;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : Math.PI * 2;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : !1;
      var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 0;
      _classCallCheck(this, mc);
      _this36 = _super40.call(this), _this36.isEllipseCurve = !0, _this36.type = "EllipseCurve", _this36.aX = t, _this36.aY = e, _this36.xRadius = r, _this36.yRadius = i, _this36.aStartAngle = s, _this36.aEndAngle = o, _this36.aClockwise = a, _this36.aRotation = l;
      return _this36;
    }
    _createClass(mc, [{
      key: "getPoint",
      value: function getPoint(t, e) {
        var r = e || new N(),
          i = Math.PI * 2,
          s = this.aEndAngle - this.aStartAngle,
          o = Math.abs(s) < Number.EPSILON;
        for (; s < 0;) s += i;
        for (; s > i;) s -= i;
        s < Number.EPSILON && (o ? s = 0 : s = i), this.aClockwise === !0 && !o && (s === i ? s = -i : s = s - i);
        var a = this.aStartAngle + t * s,
          l = this.aX + this.xRadius * Math.cos(a),
          u = this.aY + this.yRadius * Math.sin(a);
        if (this.aRotation !== 0) {
          var c = Math.cos(this.aRotation),
            d = Math.sin(this.aRotation),
            h = l - this.aX,
            f = u - this.aY;
          l = h * c - f * d + this.aX, u = h * d + f * c + this.aY;
        }
        return r.set(l, u);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(mc.prototype), "copy", this).call(this, t), this.aX = t.aX, this.aY = t.aY, this.xRadius = t.xRadius, this.yRadius = t.yRadius, this.aStartAngle = t.aStartAngle, this.aEndAngle = t.aEndAngle, this.aClockwise = t.aClockwise, this.aRotation = t.aRotation, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(mc.prototype), "toJSON", this).call(this);
        return t.aX = this.aX, t.aY = this.aY, t.xRadius = this.xRadius, t.yRadius = this.yRadius, t.aStartAngle = this.aStartAngle, t.aEndAngle = this.aEndAngle, t.aClockwise = this.aClockwise, t.aRotation = this.aRotation, t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(mc.prototype), "fromJSON", this).call(this, t), this.aX = t.aX, this.aY = t.aY, this.xRadius = t.xRadius, this.yRadius = t.yRadius, this.aStartAngle = t.aStartAngle, this.aEndAngle = t.aEndAngle, this.aClockwise = t.aClockwise, this.aRotation = t.aRotation, this;
      }
    }]);
    return mc;
  }(ss),
  US = /*#__PURE__*/function (_mc) {
    _inherits(US, _mc);
    var _super41 = _createSuper(US);
    function US(t, e, r, i, s, o) {
      var _this37;
      _classCallCheck(this, US);
      _this37 = _super41.call(this, t, e, r, r, i, s, o), _this37.isArcCurve = !0, _this37.type = "ArcCurve";
      return _this37;
    }
    return _createClass(US);
  }(mc);
function hw() {
  var n = 0,
    t = 0,
    e = 0,
    r = 0;
  function i(s, o, a, l) {
    n = s, t = a, e = -3 * s + 3 * o - 2 * a - l, r = 2 * s - 2 * o + a + l;
  }
  return {
    initCatmullRom: function initCatmullRom(s, o, a, l, u) {
      i(o, a, u * (a - s), u * (l - o));
    },
    initNonuniformCatmullRom: function initNonuniformCatmullRom(s, o, a, l, u, c, d) {
      var h = (o - s) / u - (a - s) / (u + c) + (a - o) / c,
        f = (a - o) / c - (l - o) / (c + d) + (l - a) / d;
      h *= c, f *= c, i(o, a, h, f);
    },
    calc: function calc(s) {
      var o = s * s,
        a = o * s;
      return n + t * s + e * o + r * a;
    }
  };
}
var jg = new _(),
  yS = new hw(),
  vS = new hw(),
  xS = new hw(),
  GS = /*#__PURE__*/function (_ss2) {
    _inherits(GS, _ss2);
    var _super42 = _createSuper(GS);
    function GS() {
      var _this38;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "centripetal";
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : .5;
      _classCallCheck(this, GS);
      _this38 = _super42.call(this), _this38.isCatmullRomCurve3 = !0, _this38.type = "CatmullRomCurve3", _this38.points = t, _this38.closed = e, _this38.curveType = r, _this38.tension = i;
      return _this38;
    }
    _createClass(GS, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
        var r = e,
          i = this.points,
          s = i.length,
          o = (s - (this.closed ? 0 : 1)) * t,
          a = Math.floor(o),
          l = o - a;
        this.closed ? a += a > 0 ? 0 : (Math.floor(Math.abs(a) / s) + 1) * s : l === 0 && a === s - 1 && (a = s - 2, l = 1);
        var u, c;
        this.closed || a > 0 ? u = i[(a - 1) % s] : (jg.subVectors(i[0], i[1]).add(i[0]), u = jg);
        var d = i[a % s],
          h = i[(a + 1) % s];
        if (this.closed || a + 2 < s ? c = i[(a + 2) % s] : (jg.subVectors(i[s - 1], i[s - 2]).add(i[s - 1]), c = jg), this.curveType === "centripetal" || this.curveType === "chordal") {
          var f = this.curveType === "chordal" ? .5 : .25,
            p = Math.pow(u.distanceToSquared(d), f),
            m = Math.pow(d.distanceToSquared(h), f),
            g = Math.pow(h.distanceToSquared(c), f);
          m < 1e-4 && (m = 1), p < 1e-4 && (p = m), g < 1e-4 && (g = m), yS.initNonuniformCatmullRom(u.x, d.x, h.x, c.x, p, m, g), vS.initNonuniformCatmullRom(u.y, d.y, h.y, c.y, p, m, g), xS.initNonuniformCatmullRom(u.z, d.z, h.z, c.z, p, m, g);
        } else this.curveType === "catmullrom" && (yS.initCatmullRom(u.x, d.x, h.x, c.x, this.tension), vS.initCatmullRom(u.y, d.y, h.y, c.y, this.tension), xS.initCatmullRom(u.z, d.z, h.z, c.z, this.tension));
        return r.set(yS.calc(l), vS.calc(l), xS.calc(l)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        _get(_getPrototypeOf(GS.prototype), "copy", this).call(this, t), this.points = [];
        for (var e = 0, r = t.points.length; e < r; e++) {
          var i = t.points[e];
          this.points.push(i.clone());
        }
        return this.closed = t.closed, this.curveType = t.curveType, this.tension = t.tension, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(GS.prototype), "toJSON", this).call(this);
        t.points = [];
        for (var e = 0, r = this.points.length; e < r; e++) {
          var i = this.points[e];
          t.points.push(i.toArray());
        }
        return t.closed = this.closed, t.curveType = this.curveType, t.tension = this.tension, t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        _get(_getPrototypeOf(GS.prototype), "fromJSON", this).call(this, t), this.points = [];
        for (var e = 0, r = t.points.length; e < r; e++) {
          var i = t.points[e];
          this.points.push(new _().fromArray(i));
        }
        return this.closed = t.closed, this.curveType = t.curveType, this.tension = t.tension, this;
      }
    }]);
    return GS;
  }(ss);
function aM(n, t, e, r, i) {
  var s = (r - t) * .5,
    o = (i - e) * .5,
    a = n * n,
    l = n * a;
  return (2 * e - 2 * r + s + o) * l + (-3 * e + 3 * r - 2 * s - o) * a + s * n + e;
}
function IG(n, t) {
  var e = 1 - n;
  return e * e * t;
}
function RG(n, t) {
  return 2 * (1 - n) * n * t;
}
function LG(n, t) {
  return n * n * t;
}
function sp(n, t, e, r) {
  return IG(n, t) + RG(n, e) + LG(n, r);
}
function BG(n, t) {
  var e = 1 - n;
  return e * e * e * t;
}
function NG(n, t) {
  var e = 1 - n;
  return 3 * e * e * n * t;
}
function FG(n, t) {
  return 3 * (1 - n) * n * n * t;
}
function kG(n, t) {
  return n * n * n * t;
}
function op(n, t, e, r, i) {
  return BG(n, t) + NG(n, e) + FG(n, r) + kG(n, i);
}
var rn = /*#__PURE__*/function (_ss3) {
    _inherits(rn, _ss3);
    var _super43 = _createSuper(rn);
    function rn() {
      var _this39;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new N();
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new N();
      _classCallCheck(this, rn);
      _this39 = _super43.call(this), _this39.isCubicBezierCurve = !0, _this39.type = "CubicBezierCurve", _this39.v0 = t, _this39.v1 = e, _this39.v2 = r, _this39.v3 = i;
      return _this39;
    }
    _createClass(rn, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
        var r = e,
          i = this.v0,
          s = this.v1,
          o = this.v2,
          a = this.v3;
        return r.set(op(t, i.x, s.x, o.x, a.x), op(t, i.y, s.y, o.y, a.y)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(rn.prototype), "copy", this).call(this, t), this.v0.copy(t.v0), this.v1.copy(t.v1), this.v2.copy(t.v2), this.v3.copy(t.v3), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(rn.prototype), "toJSON", this).call(this);
        return t.v0 = this.v0.toArray(), t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t.v3 = this.v3.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(rn.prototype), "fromJSON", this).call(this, t), this.v0.fromArray(t.v0), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this.v3.fromArray(t.v3), this;
      }
    }]);
    return rn;
  }(ss),
  gc = /*#__PURE__*/function (_ss4) {
    _inherits(gc, _ss4);
    var _super44 = _createSuper(gc);
    function gc() {
      var _this40;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new _();
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new _();
      _classCallCheck(this, gc);
      _this40 = _super44.call(this), _this40.isCubicBezierCurve3 = !0, _this40.type = "CubicBezierCurve3", _this40.v0 = t, _this40.v1 = e, _this40.v2 = r, _this40.v3 = i;
      return _this40;
    }
    _createClass(gc, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
        var r = e,
          i = this.v0,
          s = this.v1,
          o = this.v2,
          a = this.v3;
        return r.set(op(t, i.x, s.x, o.x, a.x), op(t, i.y, s.y, o.y, a.y), op(t, i.z, s.z, o.z, a.z)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(gc.prototype), "copy", this).call(this, t), this.v0.copy(t.v0), this.v1.copy(t.v1), this.v2.copy(t.v2), this.v3.copy(t.v3), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(gc.prototype), "toJSON", this).call(this);
        return t.v0 = this.v0.toArray(), t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t.v3 = this.v3.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(gc.prototype), "fromJSON", this).call(this, t), this.v0.fromArray(t.v0), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this.v3.fromArray(t.v3), this;
      }
    }]);
    return gc;
  }(ss),
  nn = /*#__PURE__*/function (_ss5) {
    _inherits(nn, _ss5);
    var _super45 = _createSuper(nn);
    function nn() {
      var _this41;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
      _classCallCheck(this, nn);
      _this41 = _super45.call(this), _this41.isLineCurve = !0, _this41.type = "LineCurve", _this41.v1 = t, _this41.v2 = e;
      return _this41;
    }
    _createClass(nn, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
        var r = e;
        return t === 1 ? r.copy(this.v2) : (r.copy(this.v2).sub(this.v1), r.multiplyScalar(t).add(this.v1)), r;
      }
    }, {
      key: "getPointAt",
      value: function getPointAt(t, e) {
        return this.getPoint(t, e);
      }
    }, {
      key: "getTangent",
      value: function getTangent(t, e) {
        var r = e || new N();
        return r.copy(this.v2).sub(this.v1).normalize(), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(nn.prototype), "copy", this).call(this, t), this.v1.copy(t.v1), this.v2.copy(t.v2), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(nn.prototype), "toJSON", this).call(this);
        return t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(nn.prototype), "fromJSON", this).call(this, t), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this;
      }
    }]);
    return nn;
  }(ss),
  pp = /*#__PURE__*/function (_ss6) {
    _inherits(pp, _ss6);
    var _super46 = _createSuper(pp);
    function pp() {
      var _this42;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
      _classCallCheck(this, pp);
      _this42 = _super46.call(this), _this42.isLineCurve3 = !0, _this42.type = "LineCurve3", _this42.v1 = t, _this42.v2 = e;
      return _this42;
    }
    _createClass(pp, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
        var r = e;
        return t === 1 ? r.copy(this.v2) : (r.copy(this.v2).sub(this.v1), r.multiplyScalar(t).add(this.v1)), r;
      }
    }, {
      key: "getPointAt",
      value: function getPointAt(t, e) {
        return this.getPoint(t, e);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(pp.prototype), "copy", this).call(this, t), this.v1.copy(t.v1), this.v2.copy(t.v2), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(pp.prototype), "toJSON", this).call(this);
        return t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(pp.prototype), "fromJSON", this).call(this, t), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this;
      }
    }]);
    return pp;
  }(ss),
  Wn = /*#__PURE__*/function (_ss7) {
    _inherits(Wn, _ss7);
    var _super47 = _createSuper(Wn);
    function Wn() {
      var _this43;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new N();
      _classCallCheck(this, Wn);
      _this43 = _super47.call(this), _this43.isQuadraticBezierCurve = !0, _this43.type = "QuadraticBezierCurve", _this43.v0 = t, _this43.v1 = e, _this43.v2 = r;
      return _this43;
    }
    _createClass(Wn, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
        var r = e,
          i = this.v0,
          s = this.v1,
          o = this.v2;
        return r.set(sp(t, i.x, s.x, o.x), sp(t, i.y, s.y, o.y)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(Wn.prototype), "copy", this).call(this, t), this.v0.copy(t.v0), this.v1.copy(t.v1), this.v2.copy(t.v2), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(Wn.prototype), "toJSON", this).call(this);
        return t.v0 = this.v0.toArray(), t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(Wn.prototype), "fromJSON", this).call(this, t), this.v0.fromArray(t.v0), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this;
      }
    }]);
    return Wn;
  }(ss),
  jS = /*#__PURE__*/function (_ss8) {
    _inherits(jS, _ss8);
    var _super48 = _createSuper(jS);
    function jS() {
      var _this44;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new _();
      _classCallCheck(this, jS);
      _this44 = _super48.call(this), _this44.isQuadraticBezierCurve3 = !0, _this44.type = "QuadraticBezierCurve3", _this44.v0 = t, _this44.v1 = e, _this44.v2 = r;
      return _this44;
    }
    _createClass(jS, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
        var r = e,
          i = this.v0,
          s = this.v1,
          o = this.v2;
        return r.set(sp(t, i.x, s.x, o.x), sp(t, i.y, s.y, o.y), sp(t, i.z, s.z, o.z)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(jS.prototype), "copy", this).call(this, t), this.v0.copy(t.v0), this.v1.copy(t.v1), this.v2.copy(t.v2), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(jS.prototype), "toJSON", this).call(this);
        return t.v0 = this.v0.toArray(), t.v1 = this.v1.toArray(), t.v2 = this.v2.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(jS.prototype), "fromJSON", this).call(this, t), this.v0.fromArray(t.v0), this.v1.fromArray(t.v1), this.v2.fromArray(t.v2), this;
      }
    }]);
    return jS;
  }(ss),
  Ru = /*#__PURE__*/function (_ss9) {
    _inherits(Ru, _ss9);
    var _super49 = _createSuper(Ru);
    function Ru() {
      var _this45;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      _classCallCheck(this, Ru);
      _this45 = _super49.call(this), _this45.isSplineCurve = !0, _this45.type = "SplineCurve", _this45.points = t;
      return _this45;
    }
    _createClass(Ru, [{
      key: "getPoint",
      value: function getPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
        var r = e,
          i = this.points,
          s = (i.length - 1) * t,
          o = Math.floor(s),
          a = s - o,
          l = i[o === 0 ? o : o - 1],
          u = i[o],
          c = i[o > i.length - 2 ? i.length - 1 : o + 1],
          d = i[o > i.length - 3 ? i.length - 1 : o + 2];
        return r.set(aM(a, l.x, u.x, c.x, d.x), aM(a, l.y, u.y, c.y, d.y)), r;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        _get(_getPrototypeOf(Ru.prototype), "copy", this).call(this, t), this.points = [];
        for (var e = 0, r = t.points.length; e < r; e++) {
          var i = t.points[e];
          this.points.push(i.clone());
        }
        return this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(Ru.prototype), "toJSON", this).call(this);
        t.points = [];
        for (var e = 0, r = this.points.length; e < r; e++) {
          var i = this.points[e];
          t.points.push(i.toArray());
        }
        return t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        _get(_getPrototypeOf(Ru.prototype), "fromJSON", this).call(this, t), this.points = [];
        for (var e = 0, r = t.points.length; e < r; e++) {
          var i = t.points[e];
          this.points.push(new N().fromArray(i));
        }
        return this;
      }
    }]);
    return Ru;
  }(ss),
  zG = Object.freeze({
    __proto__: null,
    ArcCurve: US,
    CatmullRomCurve3: GS,
    CubicBezierCurve: rn,
    CubicBezierCurve3: gc,
    EllipseCurve: mc,
    LineCurve: nn,
    LineCurve3: pp,
    QuadraticBezierCurve: Wn,
    QuadraticBezierCurve3: jS,
    SplineCurve: Ru
  }),
  mp = /*#__PURE__*/function (_ss10) {
    _inherits(mp, _ss10);
    var _super50 = _createSuper(mp);
    function mp() {
      var _this46;
      _classCallCheck(this, mp);
      _this46 = _super50.call(this), _this46.type = "CurvePath", _this46.curves = [], _this46.autoClose = !1;
      return _this46;
    }
    _createClass(mp, [{
      key: "add",
      value: function add(t) {
        this.curves.push(t);
      }
    }, {
      key: "closePath",
      value: function closePath() {
        var t = this.curves[0].getPoint(0),
          e = this.curves[this.curves.length - 1].getPoint(1);
        t.equals(e) || this.curves.push(new nn(e, t));
      }
    }, {
      key: "getPoint",
      value: function getPoint(t, e) {
        var r = t * this.getLength(),
          i = this.getCurveLengths(),
          s = 0;
        for (; s < i.length;) {
          if (i[s] >= r) {
            var o = i[s] - r,
              a = this.curves[s],
              l = a.getLength(),
              u = l === 0 ? 0 : 1 - o / l;
            return a.getPointAt(u, e);
          }
          s++;
        }
        return null;
      }
    }, {
      key: "getLength",
      value: function getLength() {
        var t = this.getCurveLengths();
        return t[t.length - 1];
      }
    }, {
      key: "updateArcLengths",
      value: function updateArcLengths() {
        this.needsUpdate = !0, this.cacheLengths = null, this.getCurveLengths();
      }
    }, {
      key: "getCurveLengths",
      value: function getCurveLengths() {
        if (this.cacheLengths && this.cacheLengths.length === this.curves.length) return this.cacheLengths;
        var t = [],
          e = 0;
        for (var r = 0, i = this.curves.length; r < i; r++) e += this.curves[r].getLength(), t.push(e);
        return this.cacheLengths = t, t;
      }
    }, {
      key: "getSpacedPoints",
      value: function getSpacedPoints() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 40;
        var e = [];
        for (var r = 0; r <= t; r++) e.push(this.getPoint(r / t));
        return this.autoClose && e.push(e[0]), e;
      }
    }, {
      key: "getPoints",
      value: function getPoints() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 12;
        var e = [],
          r;
        for (var i = 0, s = this.curves; i < s.length; i++) {
          var o = s[i],
            a = o.isEllipseCurve ? t * 2 : o.isLineCurve || o.isLineCurve3 ? 1 : o.isSplineCurve ? t * o.points.length : t,
            l = o.getPoints(a);
          for (var u = 0; u < l.length; u++) {
            var c = l[u];
            r && r.equals(c) || (e.push(c), r = c);
          }
        }
        return this.autoClose && e.length > 1 && !e[e.length - 1].equals(e[0]) && e.push(e[0]), e;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        _get(_getPrototypeOf(mp.prototype), "copy", this).call(this, t), this.curves = [];
        for (var e = 0, r = t.curves.length; e < r; e++) {
          var i = t.curves[e];
          this.curves.push(i.clone());
        }
        return this.autoClose = t.autoClose, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(mp.prototype), "toJSON", this).call(this);
        t.autoClose = this.autoClose, t.curves = [];
        for (var e = 0, r = this.curves.length; e < r; e++) {
          var i = this.curves[e];
          t.curves.push(i.toJSON());
        }
        return t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        _get(_getPrototypeOf(mp.prototype), "fromJSON", this).call(this, t), this.autoClose = t.autoClose, this.curves = [];
        for (var e = 0, r = t.curves.length; e < r; e++) {
          var i = t.curves[e];
          this.curves.push(new zG[i.type]().fromJSON(i));
        }
        return this;
      }
    }]);
    return mp;
  }(ss),
  yc = /*#__PURE__*/function (_mp) {
    _inherits(yc, _mp);
    var _super51 = _createSuper(yc);
    function yc(t) {
      var _this47;
      _classCallCheck(this, yc);
      _this47 = _super51.call(this), _this47.type = "Path", _this47.currentPoint = new N(), t && _this47.setFromPoints(t);
      return _this47;
    }
    _createClass(yc, [{
      key: "setFromPoints",
      value: function setFromPoints(t) {
        this.moveTo(t[0].x, t[0].y);
        for (var e = 1, r = t.length; e < r; e++) this.lineTo(t[e].x, t[e].y);
        return this;
      }
    }, {
      key: "moveTo",
      value: function moveTo(t, e) {
        return this.currentPoint.set(t, e), this;
      }
    }, {
      key: "lineTo",
      value: function lineTo(t, e) {
        var r = new nn(this.currentPoint.clone(), new N(t, e));
        return this.curves.push(r), this.currentPoint.set(t, e), this;
      }
    }, {
      key: "quadraticCurveTo",
      value: function quadraticCurveTo(t, e, r, i) {
        var s = new Wn(this.currentPoint.clone(), new N(t, e), new N(r, i));
        return this.curves.push(s), this.currentPoint.set(r, i), this;
      }
    }, {
      key: "bezierCurveTo",
      value: function bezierCurveTo(t, e, r, i, s, o) {
        var a = new rn(this.currentPoint.clone(), new N(t, e), new N(r, i), new N(s, o));
        return this.curves.push(a), this.currentPoint.set(s, o), this;
      }
    }, {
      key: "splineThru",
      value: function splineThru(t) {
        var e = [this.currentPoint.clone()].concat(t),
          r = new Ru(e);
        return this.curves.push(r), this.currentPoint.copy(t[t.length - 1]), this;
      }
    }, {
      key: "arc",
      value: function arc(t, e, r, i, s, o) {
        var a = this.currentPoint.x,
          l = this.currentPoint.y;
        return this.absarc(t + a, e + l, r, i, s, o), this;
      }
    }, {
      key: "absarc",
      value: function absarc(t, e, r, i, s, o) {
        return this.absellipse(t, e, r, r, i, s, o), this;
      }
    }, {
      key: "ellipse",
      value: function ellipse(t, e, r, i, s, o, a, l) {
        var u = this.currentPoint.x,
          c = this.currentPoint.y;
        return this.absellipse(t + u, e + c, r, i, s, o, a, l), this;
      }
    }, {
      key: "absellipse",
      value: function absellipse(t, e, r, i, s, o, a, l) {
        var u = new mc(t, e, r, i, s, o, a, l);
        if (this.curves.length > 0) {
          var d = u.getPoint(0);
          d.equals(this.currentPoint) || this.lineTo(d.x, d.y);
        }
        this.curves.push(u);
        var c = u.getPoint(1);
        return this.currentPoint.copy(c), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(yc.prototype), "copy", this).call(this, t), this.currentPoint.copy(t.currentPoint), this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(yc.prototype), "toJSON", this).call(this);
        return t.currentPoint = this.currentPoint.toArray(), t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        return _get(_getPrototypeOf(yc.prototype), "fromJSON", this).call(this, t), this.currentPoint.fromArray(t.currentPoint), this;
      }
    }]);
    return yc;
  }(mp),
  Lu = /*#__PURE__*/function (_we3) {
    _inherits(Lu, _we3);
    var _super52 = _createSuper(Lu);
    function Lu() {
      var _this48;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [new N(0, -.5), new N(.5, 0), new N(0, .5)];
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.PI * 2;
      _classCallCheck(this, Lu);
      _this48 = _super52.call(this), _this48.type = "LatheGeometry", _this48.parameters = {
        points: t,
        segments: e,
        phiStart: r,
        phiLength: i
      }, e = Math.floor(e), i = oi(i, 0, Math.PI * 2);
      var s = [],
        o = [],
        a = [],
        l = [],
        u = [],
        c = 1 / e,
        d = new _(),
        h = new N(),
        f = new _(),
        p = new _(),
        m = new _(),
        g = 0,
        y = 0;
      for (var v = 0; v <= t.length - 1; v++) switch (v) {
        case 0:
          g = t[v + 1].x - t[v].x, y = t[v + 1].y - t[v].y, f.x = y * 1, f.y = -g, f.z = y * 0, m.copy(f), f.normalize(), l.push(f.x, f.y, f.z);
          break;
        case t.length - 1:
          l.push(m.x, m.y, m.z);
          break;
        default:
          g = t[v + 1].x - t[v].x, y = t[v + 1].y - t[v].y, f.x = y * 1, f.y = -g, f.z = y * 0, p.copy(f), f.x += m.x, f.y += m.y, f.z += m.z, f.normalize(), l.push(f.x, f.y, f.z), m.copy(p);
      }
      for (var _v9 = 0; _v9 <= e; _v9++) {
        var x = r + _v9 * c * i,
          S = Math.sin(x),
          w = Math.cos(x);
        for (var A = 0; A <= t.length - 1; A++) {
          d.x = t[A].x * S, d.y = t[A].y, d.z = t[A].x * w, o.push(d.x, d.y, d.z), h.x = _v9 / e, h.y = A / (t.length - 1), a.push(h.x, h.y);
          var E = l[3 * A + 0] * S,
            b = l[3 * A + 1],
            T = l[3 * A + 0] * w;
          u.push(E, b, T);
        }
      }
      for (var _v10 = 0; _v10 < e; _v10++) for (var _x11 = 0; _x11 < t.length - 1; _x11++) {
        var _S10 = _x11 + _v10 * t.length,
          _w11 = _S10,
          _A7 = _S10 + t.length,
          _E7 = _S10 + t.length + 1,
          _b3 = _S10 + 1;
        s.push(_w11, _A7, _b3), s.push(_E7, _b3, _A7);
      }
      _this48.setIndex(s), _this48.setAttribute("position", new be(o, 3)), _this48.setAttribute("uv", new be(a, 2)), _this48.setAttribute("normal", new be(u, 3));
      return _this48;
    }
    _createClass(Lu, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new Lu(t.points, t.segments, t.phiStart, t.phiLength);
      }
    }]);
    return Lu;
  }(we);
var vc = /*#__PURE__*/function (_we4) {
    _inherits(vc, _we4);
    var _super53 = _createSuper(vc);
    function vc() {
      var _this49;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 32;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 0;
      var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : Math.PI * 2;
      _classCallCheck(this, vc);
      _this49 = _super53.call(this), _this49.type = "CylinderGeometry", _this49.parameters = {
        radiusTop: t,
        radiusBottom: e,
        height: r,
        radialSegments: i,
        heightSegments: s,
        openEnded: o,
        thetaStart: a,
        thetaLength: l
      };
      var u = _assertThisInitialized(_this49);
      i = Math.floor(i), s = Math.floor(s);
      var c = [],
        d = [],
        h = [],
        f = [],
        p = 0,
        m = [],
        g = r / 2,
        y = 0;
      v(), o === !1 && (t > 0 && x(!0), e > 0 && x(!1)), _this49.setIndex(c), _this49.setAttribute("position", new be(d, 3)), _this49.setAttribute("normal", new be(h, 3)), _this49.setAttribute("uv", new be(f, 2));
      function v() {
        var S = new _(),
          w = new _(),
          A = 0,
          E = (e - t) / r;
        for (var b = 0; b <= s; b++) {
          var T = [],
            M = b / s,
            C = M * (e - t) + t;
          for (var P = 0; P <= i; P++) {
            var D = P / i,
              _O5 = D * l + a,
              I = Math.sin(_O5),
              z = Math.cos(_O5);
            w.x = C * I, w.y = -M * r + g, w.z = C * z, d.push(w.x, w.y, w.z), S.set(I, E, z).normalize(), h.push(S.x, S.y, S.z), f.push(D, 1 - M), T.push(p++);
          }
          m.push(T);
        }
        for (var _b4 = 0; _b4 < i; _b4++) for (var _T2 = 0; _T2 < s; _T2++) {
          var _M4 = m[_T2][_b4],
            _C5 = m[_T2 + 1][_b4],
            _P5 = m[_T2 + 1][_b4 + 1],
            _D4 = m[_T2][_b4 + 1];
          c.push(_M4, _C5, _D4), c.push(_C5, _P5, _D4), A += 6;
        }
        u.addGroup(y, A, 0), y += A;
      }
      function x(S) {
        var w = p,
          A = new N(),
          E = new _(),
          b = 0,
          T = S === !0 ? t : e,
          M = S === !0 ? 1 : -1;
        for (var P = 1; P <= i; P++) d.push(0, g * M, 0), h.push(0, M, 0), f.push(.5, .5), p++;
        var C = p;
        for (var _P6 = 0; _P6 <= i; _P6++) {
          var _O6 = _P6 / i * l + a,
            I = Math.cos(_O6),
            z = Math.sin(_O6);
          E.x = T * z, E.y = g * M, E.z = T * I, d.push(E.x, E.y, E.z), h.push(0, M, 0), A.x = I * .5 + .5, A.y = z * .5 * M + .5, f.push(A.x, A.y), p++;
        }
        for (var _P7 = 0; _P7 < i; _P7++) {
          var D = w + _P7,
            _O7 = C + _P7;
          S === !0 ? c.push(_O7, _O7 + 1, D) : c.push(_O7 + 1, _O7, D), b += 3;
        }
        u.addGroup(y, b, S === !0 ? 1 : 2), y += b;
      }
      return _this49;
    }
    _createClass(vc, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new vc(t.radiusTop, t.radiusBottom, t.height, t.radialSegments, t.heightSegments, t.openEnded, t.thetaStart, t.thetaLength);
      }
    }]);
    return vc;
  }(we),
  $a = /*#__PURE__*/function (_vc) {
    _inherits($a, _vc);
    var _super54 = _createSuper($a);
    function $a() {
      var _this50;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 32;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : Math.PI * 2;
      _classCallCheck(this, $a);
      _this50 = _super54.call(this, 0, t, e, r, i, s, o, a), _this50.type = "ConeGeometry", _this50.parameters = {
        radius: t,
        height: e,
        radialSegments: r,
        heightSegments: i,
        openEnded: s,
        thetaStart: o,
        thetaLength: a
      };
      return _this50;
    }
    _createClass($a, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new $a(t.radius, t.height, t.radialSegments, t.heightSegments, t.openEnded, t.thetaStart, t.thetaLength);
      }
    }]);
    return $a;
  }(vc),
  Bu = /*#__PURE__*/function (_we5) {
    _inherits(Bu, _we5);
    var _super55 = _createSuper(Bu);
    function Bu() {
      var _this51;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
      _classCallCheck(this, Bu);
      _this51 = _super55.call(this), _this51.type = "PolyhedronGeometry", _this51.parameters = {
        vertices: t,
        indices: e,
        radius: r,
        detail: i
      };
      var s = [],
        o = [];
      a(i), u(r), c(), _this51.setAttribute("position", new be(s, 3)), _this51.setAttribute("normal", new be(s.slice(), 3)), _this51.setAttribute("uv", new be(o, 2)), i === 0 ? _this51.computeVertexNormals() : _this51.normalizeNormals();
      function a(v) {
        var x = new _(),
          S = new _(),
          w = new _();
        for (var A = 0; A < e.length; A += 3) f(e[A + 0], x), f(e[A + 1], S), f(e[A + 2], w), l(x, S, w, v);
      }
      function l(v, x, S, w) {
        var A = w + 1,
          E = [];
        for (var b = 0; b <= A; b++) {
          E[b] = [];
          var T = v.clone().lerp(S, b / A),
            M = x.clone().lerp(S, b / A),
            C = A - b;
          for (var P = 0; P <= C; P++) P === 0 && b === A ? E[b][P] = T : E[b][P] = T.clone().lerp(M, P / C);
        }
        for (var _b5 = 0; _b5 < A; _b5++) for (var _T3 = 0; _T3 < 2 * (A - _b5) - 1; _T3++) {
          var _M5 = Math.floor(_T3 / 2);
          _T3 % 2 === 0 ? (h(E[_b5][_M5 + 1]), h(E[_b5 + 1][_M5]), h(E[_b5][_M5])) : (h(E[_b5][_M5 + 1]), h(E[_b5 + 1][_M5 + 1]), h(E[_b5 + 1][_M5]));
        }
      }
      function u(v) {
        var x = new _();
        for (var S = 0; S < s.length; S += 3) x.x = s[S + 0], x.y = s[S + 1], x.z = s[S + 2], x.normalize().multiplyScalar(v), s[S + 0] = x.x, s[S + 1] = x.y, s[S + 2] = x.z;
      }
      function c() {
        var v = new _();
        for (var x = 0; x < s.length; x += 3) {
          v.x = s[x + 0], v.y = s[x + 1], v.z = s[x + 2];
          var S = g(v) / 2 / Math.PI + .5,
            w = y(v) / Math.PI + .5;
          o.push(S, 1 - w);
        }
        p(), d();
      }
      function d() {
        for (var v = 0; v < o.length; v += 6) {
          var x = o[v + 0],
            S = o[v + 2],
            w = o[v + 4],
            A = Math.max(x, S, w),
            E = Math.min(x, S, w);
          A > .9 && E < .1 && (x < .2 && (o[v + 0] += 1), S < .2 && (o[v + 2] += 1), w < .2 && (o[v + 4] += 1));
        }
      }
      function h(v) {
        s.push(v.x, v.y, v.z);
      }
      function f(v, x) {
        var S = v * 3;
        x.x = t[S + 0], x.y = t[S + 1], x.z = t[S + 2];
      }
      function p() {
        var v = new _(),
          x = new _(),
          S = new _(),
          w = new _(),
          A = new N(),
          E = new N(),
          b = new N();
        for (var T = 0, M = 0; T < s.length; T += 9, M += 6) {
          v.set(s[T + 0], s[T + 1], s[T + 2]), x.set(s[T + 3], s[T + 4], s[T + 5]), S.set(s[T + 6], s[T + 7], s[T + 8]), A.set(o[M + 0], o[M + 1]), E.set(o[M + 2], o[M + 3]), b.set(o[M + 4], o[M + 5]), w.copy(v).add(x).add(S).divideScalar(3);
          var C = g(w);
          m(A, M + 0, v, C), m(E, M + 2, x, C), m(b, M + 4, S, C);
        }
      }
      function m(v, x, S, w) {
        w < 0 && v.x === 1 && (o[x] = v.x - 1), S.x === 0 && S.z === 0 && (o[x] = w / 2 / Math.PI + .5);
      }
      function g(v) {
        return Math.atan2(v.z, -v.x);
      }
      function y(v) {
        return Math.atan2(-v.y, Math.sqrt(v.x * v.x + v.z * v.z));
      }
      return _this51;
    }
    _createClass(Bu, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new Bu(t.vertices, t.indices, t.radius, t.details);
      }
    }]);
    return Bu;
  }(we),
  Nu = /*#__PURE__*/function (_Bu) {
    _inherits(Nu, _Bu);
    var _super56 = _createSuper(Nu);
    function Nu() {
      var _this52;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
      _classCallCheck(this, Nu);
      var r = (1 + Math.sqrt(5)) / 2,
        i = 1 / r,
        s = [-1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1, 0, -i, -r, 0, -i, r, 0, i, -r, 0, i, r, -i, -r, 0, -i, r, 0, i, -r, 0, i, r, 0, -r, 0, -i, r, 0, -i, -r, 0, i, r, 0, i],
        o = [3, 11, 7, 3, 7, 15, 3, 15, 13, 7, 19, 17, 7, 17, 6, 7, 6, 15, 17, 4, 8, 17, 8, 10, 17, 10, 6, 8, 0, 16, 8, 16, 2, 8, 2, 10, 0, 12, 1, 0, 1, 18, 0, 18, 16, 6, 10, 2, 6, 2, 13, 6, 13, 15, 2, 16, 18, 2, 18, 3, 2, 3, 13, 18, 1, 9, 18, 9, 11, 18, 11, 3, 4, 14, 12, 4, 12, 0, 4, 0, 8, 11, 9, 5, 11, 5, 19, 11, 19, 7, 19, 5, 14, 19, 14, 4, 19, 4, 17, 1, 12, 14, 1, 14, 5, 1, 5, 9];
      _this52 = _super56.call(this, s, o, t, e), _this52.type = "DodecahedronGeometry", _this52.parameters = {
        radius: t,
        detail: e
      };
      return _this52;
    }
    _createClass(Nu, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new Nu(t.radius, t.detail);
      }
    }]);
    return Nu;
  }(Bu);
var oa = /*#__PURE__*/function (_yc) {
    _inherits(oa, _yc);
    var _super57 = _createSuper(oa);
    function oa(t) {
      var _this53;
      _classCallCheck(this, oa);
      _this53 = _super57.call(this, t), _this53.uuid = rs(), _this53.type = "Shape", _this53.holes = [];
      return _this53;
    }
    _createClass(oa, [{
      key: "getPointsHoles",
      value: function getPointsHoles(t) {
        var e = [];
        for (var r = 0, i = this.holes.length; r < i; r++) e[r] = this.holes[r].getPoints(t);
        return e;
      }
    }, {
      key: "extractPoints",
      value: function extractPoints(t) {
        return {
          shape: this.getPoints(t),
          holes: this.getPointsHoles(t)
        };
      }
    }, {
      key: "copy",
      value: function copy(t) {
        _get(_getPrototypeOf(oa.prototype), "copy", this).call(this, t), this.holes = [];
        for (var e = 0, r = t.holes.length; e < r; e++) {
          var i = t.holes[e];
          this.holes.push(i.clone());
        }
        return this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(oa.prototype), "toJSON", this).call(this);
        t.uuid = this.uuid, t.holes = [];
        for (var e = 0, r = this.holes.length; e < r; e++) {
          var i = this.holes[e];
          t.holes.push(i.toJSON());
        }
        return t;
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(t) {
        _get(_getPrototypeOf(oa.prototype), "fromJSON", this).call(this, t), this.uuid = t.uuid, this.holes = [];
        for (var e = 0, r = t.holes.length; e < r; e++) {
          var i = t.holes[e];
          this.holes.push(new yc().fromJSON(i));
        }
        return this;
      }
    }]);
    return oa;
  }(yc),
  VG = {
    triangulate: function triangulate(n, t) {
      var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2;
      var r = t && t.length,
        i = r ? t[0] * e : n.length,
        s = FM(n, 0, i, e, !0),
        o = [];
      if (!s || s.next === s.prev) return o;
      var a, l, u, c, d, h, f;
      if (r && (s = WG(n, t, s, e)), n.length > 80 * e) {
        a = u = n[0], l = c = n[1];
        for (var _p14 = e; _p14 < i; _p14 += e) d = n[_p14], h = n[_p14 + 1], d < a && (a = d), h < l && (l = h), d > u && (u = d), h > c && (c = h);
        f = Math.max(u - a, c - l), f = f !== 0 ? 32767 / f : 0;
      }
      return gp(s, o, e, a, l, f, 0), o;
    }
  };
function FM(n, t, e, r, i) {
  var s, o;
  if (i === r4(n, t, e, r) > 0) for (s = t; s < e; s += r) o = lM(s, n[s], n[s + 1], o);else for (s = e - r; s >= t; s -= r) o = lM(s, n[s], n[s + 1], o);
  return o && Cy(o, o.next) && (vp(o), o = o.next), o;
}
function xc(n, t) {
  if (!n) return n;
  t || (t = n);
  var e = n,
    r;
  do if (r = !1, !e.steiner && (Cy(e, e.next) || Or(e.prev, e, e.next) === 0)) {
    if (vp(e), e = t = e.prev, e === e.next) break;
    r = !0;
  } else e = e.next; while (r || e !== t);
  return t;
}
function gp(n, t, e, r, i, s, o) {
  if (!n) return;
  !o && s && KG(n, r, i, s);
  var a = n,
    l,
    u;
  for (; n.prev !== n.next;) {
    if (l = n.prev, u = n.next, s ? GG(n, r, i, s) : UG(n)) {
      t.push(l.i / e | 0), t.push(n.i / e | 0), t.push(u.i / e | 0), vp(n), n = u.next, a = u.next;
      continue;
    }
    if (n = u, n === a) {
      o ? o === 1 ? (n = jG(xc(n), t, e), gp(n, t, e, r, i, s, 2)) : o === 2 && HG(n, t, e, r, i, s) : gp(xc(n), t, e, r, i, s, 1);
      break;
    }
  }
}
function UG(n) {
  var t = n.prev,
    e = n,
    r = n.next;
  if (Or(t, e, r) >= 0) return !1;
  var i = t.x,
    s = e.x,
    o = r.x,
    a = t.y,
    l = e.y,
    u = r.y,
    c = i < s ? i < o ? i : o : s < o ? s : o,
    d = a < l ? a < u ? a : u : l < u ? l : u,
    h = i > s ? i > o ? i : o : s > o ? s : o,
    f = a > l ? a > u ? a : u : l > u ? l : u,
    p = r.next;
  for (; p !== t;) {
    if (p.x >= c && p.x <= h && p.y >= d && p.y <= f && Mu(i, a, s, l, o, u, p.x, p.y) && Or(p.prev, p, p.next) >= 0) return !1;
    p = p.next;
  }
  return !0;
}
function GG(n, t, e, r) {
  var i = n.prev,
    s = n,
    o = n.next;
  if (Or(i, s, o) >= 0) return !1;
  var a = i.x,
    l = s.x,
    u = o.x,
    c = i.y,
    d = s.y,
    h = o.y,
    f = a < l ? a < u ? a : u : l < u ? l : u,
    p = c < d ? c < h ? c : h : d < h ? d : h,
    m = a > l ? a > u ? a : u : l > u ? l : u,
    g = c > d ? c > h ? c : h : d > h ? d : h,
    y = HS(f, p, t, e, r),
    v = HS(m, g, t, e, r),
    x = n.prevZ,
    S = n.nextZ;
  for (; x && x.z >= y && S && S.z <= v;) {
    if (x.x >= f && x.x <= m && x.y >= p && x.y <= g && x !== i && x !== o && Mu(a, c, l, d, u, h, x.x, x.y) && Or(x.prev, x, x.next) >= 0 || (x = x.prevZ, S.x >= f && S.x <= m && S.y >= p && S.y <= g && S !== i && S !== o && Mu(a, c, l, d, u, h, S.x, S.y) && Or(S.prev, S, S.next) >= 0)) return !1;
    S = S.nextZ;
  }
  for (; x && x.z >= y;) {
    if (x.x >= f && x.x <= m && x.y >= p && x.y <= g && x !== i && x !== o && Mu(a, c, l, d, u, h, x.x, x.y) && Or(x.prev, x, x.next) >= 0) return !1;
    x = x.prevZ;
  }
  for (; S && S.z <= v;) {
    if (S.x >= f && S.x <= m && S.y >= p && S.y <= g && S !== i && S !== o && Mu(a, c, l, d, u, h, S.x, S.y) && Or(S.prev, S, S.next) >= 0) return !1;
    S = S.nextZ;
  }
  return !0;
}
function jG(n, t, e) {
  var r = n;
  do {
    var i = r.prev,
      s = r.next.next;
    !Cy(i, s) && kM(i, r, r.next, s) && yp(i, s) && yp(s, i) && (t.push(i.i / e | 0), t.push(r.i / e | 0), t.push(s.i / e | 0), vp(r), vp(r.next), r = n = s), r = r.next;
  } while (r !== n);
  return xc(r);
}
function HG(n, t, e, r, i, s) {
  var o = n;
  do {
    var a = o.next.next;
    for (; a !== o.prev;) {
      if (o.i !== a.i && $G(o, a)) {
        var _l10 = zM(o, a);
        o = xc(o, o.next), _l10 = xc(_l10, _l10.next), gp(o, t, e, r, i, s, 0), gp(_l10, t, e, r, i, s, 0);
        return;
      }
      a = a.next;
    }
    o = o.next;
  } while (o !== n);
}
function WG(n, t, e, r) {
  var i = [],
    s,
    o,
    a,
    l,
    u;
  for (s = 0, o = t.length; s < o; s++) a = t[s] * r, l = s < o - 1 ? t[s + 1] * r : n.length, u = FM(n, a, l, r, !1), u === u.next && (u.steiner = !0), i.push(JG(u));
  for (i.sort(qG), s = 0; s < i.length; s++) e = YG(i[s], e);
  return e;
}
function qG(n, t) {
  return n.x - t.x;
}
function YG(n, t) {
  var e = XG(n, t);
  if (!e) return t;
  var r = zM(e, n);
  return xc(r, r.next), xc(e, e.next);
}
function XG(n, t) {
  var e = t,
    r = -1 / 0,
    i,
    s = n.x,
    o = n.y;
  do {
    if (o <= e.y && o >= e.next.y && e.next.y !== e.y) {
      var _h9 = e.x + (o - e.y) * (e.next.x - e.x) / (e.next.y - e.y);
      if (_h9 <= s && _h9 > r && (r = _h9, i = e.x < e.next.x ? e : e.next, _h9 === s)) return i;
    }
    e = e.next;
  } while (e !== t);
  if (!i) return null;
  var a = i,
    l = i.x,
    u = i.y,
    c = 1 / 0,
    d;
  e = i;
  do s >= e.x && e.x >= l && s !== e.x && Mu(o < u ? s : r, o, l, u, o < u ? r : s, o, e.x, e.y) && (d = Math.abs(o - e.y) / (s - e.x), yp(e, n) && (d < c || d === c && (e.x > i.x || e.x === i.x && QG(i, e))) && (i = e, c = d)), e = e.next; while (e !== a);
  return i;
}
function QG(n, t) {
  return Or(n.prev, n, t.prev) < 0 && Or(t.next, n, n.next) < 0;
}
function KG(n, t, e, r) {
  var i = n;
  do i.z === 0 && (i.z = HS(i.x, i.y, t, e, r)), i.prevZ = i.prev, i.nextZ = i.next, i = i.next; while (i !== n);
  i.prevZ.nextZ = null, i.prevZ = null, ZG(i);
}
function ZG(n) {
  var t,
    e,
    r,
    i,
    s,
    o,
    a,
    l,
    u = 1;
  do {
    for (e = n, n = null, s = null, o = 0; e;) {
      for (o++, r = e, a = 0, t = 0; t < u && (a++, r = r.nextZ, !!r); t++);
      for (l = u; a > 0 || l > 0 && r;) a !== 0 && (l === 0 || !r || e.z <= r.z) ? (i = e, e = e.nextZ, a--) : (i = r, r = r.nextZ, l--), s ? s.nextZ = i : n = i, i.prevZ = s, s = i;
      e = r;
    }
    s.nextZ = null, u *= 2;
  } while (o > 1);
  return n;
}
function HS(n, t, e, r, i) {
  return n = (n - e) * i | 0, t = (t - r) * i | 0, n = (n | n << 8) & 16711935, n = (n | n << 4) & 252645135, n = (n | n << 2) & 858993459, n = (n | n << 1) & 1431655765, t = (t | t << 8) & 16711935, t = (t | t << 4) & 252645135, t = (t | t << 2) & 858993459, t = (t | t << 1) & 1431655765, n | t << 1;
}
function JG(n) {
  var t = n,
    e = n;
  do (t.x < e.x || t.x === e.x && t.y < e.y) && (e = t), t = t.next; while (t !== n);
  return e;
}
function Mu(n, t, e, r, i, s, o, a) {
  return (i - o) * (t - a) >= (n - o) * (s - a) && (n - o) * (r - a) >= (e - o) * (t - a) && (e - o) * (s - a) >= (i - o) * (r - a);
}
function $G(n, t) {
  return n.next.i !== t.i && n.prev.i !== t.i && !e4(n, t) && (yp(n, t) && yp(t, n) && t4(n, t) && (Or(n.prev, n, t.prev) || Or(n, t.prev, t)) || Cy(n, t) && Or(n.prev, n, n.next) > 0 && Or(t.prev, t, t.next) > 0);
}
function Or(n, t, e) {
  return (t.y - n.y) * (e.x - t.x) - (t.x - n.x) * (e.y - t.y);
}
function Cy(n, t) {
  return n.x === t.x && n.y === t.y;
}
function kM(n, t, e, r) {
  var i = Wg(Or(n, t, e)),
    s = Wg(Or(n, t, r)),
    o = Wg(Or(e, r, n)),
    a = Wg(Or(e, r, t));
  return !!(i !== s && o !== a || i === 0 && Hg(n, e, t) || s === 0 && Hg(n, r, t) || o === 0 && Hg(e, n, r) || a === 0 && Hg(e, t, r));
}
function Hg(n, t, e) {
  return t.x <= Math.max(n.x, e.x) && t.x >= Math.min(n.x, e.x) && t.y <= Math.max(n.y, e.y) && t.y >= Math.min(n.y, e.y);
}
function Wg(n) {
  return n > 0 ? 1 : n < 0 ? -1 : 0;
}
function e4(n, t) {
  var e = n;
  do {
    if (e.i !== n.i && e.next.i !== n.i && e.i !== t.i && e.next.i !== t.i && kM(e, e.next, n, t)) return !0;
    e = e.next;
  } while (e !== n);
  return !1;
}
function yp(n, t) {
  return Or(n.prev, n, n.next) < 0 ? Or(n, t, n.next) >= 0 && Or(n, n.prev, t) >= 0 : Or(n, t, n.prev) < 0 || Or(n, n.next, t) < 0;
}
function t4(n, t) {
  var e = n,
    r = !1,
    i = (n.x + t.x) / 2,
    s = (n.y + t.y) / 2;
  do e.y > s != e.next.y > s && e.next.y !== e.y && i < (e.next.x - e.x) * (s - e.y) / (e.next.y - e.y) + e.x && (r = !r), e = e.next; while (e !== n);
  return r;
}
function zM(n, t) {
  var e = new WS(n.i, n.x, n.y),
    r = new WS(t.i, t.x, t.y),
    i = n.next,
    s = t.prev;
  return n.next = t, t.prev = n, e.next = i, i.prev = e, r.next = e, e.prev = r, s.next = r, r.prev = s, r;
}
function lM(n, t, e, r) {
  var i = new WS(n, t, e);
  return r ? (i.next = r.next, i.prev = r, r.next.prev = i, r.next = i) : (i.prev = i, i.next = i), i;
}
function vp(n) {
  n.next.prev = n.prev, n.prev.next = n.next, n.prevZ && (n.prevZ.nextZ = n.nextZ), n.nextZ && (n.nextZ.prevZ = n.prevZ);
}
function WS(n, t, e) {
  this.i = n, this.x = t, this.y = e, this.prev = null, this.next = null, this.z = 0, this.prevZ = null, this.nextZ = null, this.steiner = !1;
}
function r4(n, t, e, r) {
  var i = 0;
  for (var s = t, o = e - r; s < e; s += r) i += (n[o] - n[s]) * (n[s + 1] + n[o + 1]), o = s;
  return i;
}
var Fu = /*#__PURE__*/function () {
  function Fu() {
    _classCallCheck(this, Fu);
  }
  _createClass(Fu, null, [{
    key: "area",
    value: function area(t) {
      var e = t.length,
        r = 0;
      for (var i = e - 1, s = 0; s < e; i = s++) r += t[i].x * t[s].y - t[s].x * t[i].y;
      return r * .5;
    }
  }, {
    key: "isClockWise",
    value: function isClockWise(t) {
      return Fu.area(t) < 0;
    }
  }, {
    key: "triangulateShape",
    value: function triangulateShape(t, e) {
      var r = [],
        i = [],
        s = [];
      cM(t), uM(r, t);
      var o = t.length;
      e.forEach(cM);
      for (var _l11 = 0; _l11 < e.length; _l11++) i.push(o), o += e[_l11].length, uM(r, e[_l11]);
      var a = VG.triangulate(r, i);
      for (var _l12 = 0; _l12 < a.length; _l12 += 3) s.push(a.slice(_l12, _l12 + 3));
      return s;
    }
  }]);
  return Fu;
}();
function cM(n) {
  var t = n.length;
  t > 2 && n[t - 1].equals(n[0]) && n.pop();
}
function uM(n, t) {
  for (var e = 0; e < t.length; e++) n.push(t[e].x), n.push(t[e].y);
}
var ku = /*#__PURE__*/function (_Bu2) {
  _inherits(ku, _Bu2);
  var _super58 = _createSuper(ku);
  function ku() {
    var _this54;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    _classCallCheck(this, ku);
    var r = (1 + Math.sqrt(5)) / 2,
      i = [-1, r, 0, 1, r, 0, -1, -r, 0, 1, -r, 0, 0, -1, r, 0, 1, r, 0, -1, -r, 0, 1, -r, r, 0, -1, r, 0, 1, -r, 0, -1, -r, 0, 1],
      s = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11, 1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8, 3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9, 4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1];
    _this54 = _super58.call(this, i, s, t, e), _this54.type = "IcosahedronGeometry", _this54.parameters = {
      radius: t,
      detail: e
    };
    return _this54;
  }
  _createClass(ku, null, [{
    key: "fromJSON",
    value: function fromJSON(t) {
      return new ku(t.radius, t.detail);
    }
  }]);
  return ku;
}(Bu);
var Bs = /*#__PURE__*/function (_we6) {
  _inherits(Bs, _we6);
  var _super59 = _createSuper(Bs);
  function Bs() {
    var _this55;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 32;
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 16;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Math.PI * 2;
    var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
    var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : Math.PI;
    _classCallCheck(this, Bs);
    _this55 = _super59.call(this), _this55.type = "SphereGeometry", _this55.parameters = {
      radius: t,
      widthSegments: e,
      heightSegments: r,
      phiStart: i,
      phiLength: s,
      thetaStart: o,
      thetaLength: a
    }, e = Math.max(3, Math.floor(e)), r = Math.max(2, Math.floor(r));
    var l = Math.min(o + a, Math.PI),
      u = 0,
      c = [],
      d = new _(),
      h = new _(),
      f = [],
      p = [],
      m = [],
      g = [];
    for (var _y8 = 0; _y8 <= r; _y8++) {
      var v = [],
        x = _y8 / r,
        S = 0;
      _y8 == 0 && o == 0 ? S = .5 / e : _y8 == r && l == Math.PI && (S = -.5 / e);
      for (var w = 0; w <= e; w++) {
        var A = w / e;
        d.x = -t * Math.cos(i + A * s) * Math.sin(o + x * a), d.y = t * Math.cos(o + x * a), d.z = t * Math.sin(i + A * s) * Math.sin(o + x * a), p.push(d.x, d.y, d.z), h.copy(d).normalize(), m.push(h.x, h.y, h.z), g.push(A + S, 1 - x), v.push(u++);
      }
      c.push(v);
    }
    for (var _y9 = 0; _y9 < r; _y9++) for (var _v11 = 0; _v11 < e; _v11++) {
      var _x12 = c[_y9][_v11 + 1],
        _S11 = c[_y9][_v11],
        _w12 = c[_y9 + 1][_v11],
        _A8 = c[_y9 + 1][_v11 + 1];
      (_y9 !== 0 || o > 0) && f.push(_x12, _S11, _A8), (_y9 !== r - 1 || l < Math.PI) && f.push(_S11, _w12, _A8);
    }
    _this55.setIndex(f), _this55.setAttribute("position", new be(p, 3)), _this55.setAttribute("normal", new be(m, 3)), _this55.setAttribute("uv", new be(g, 2));
    return _this55;
  }
  _createClass(Bs, null, [{
    key: "fromJSON",
    value: function fromJSON(t) {
      return new Bs(t.radius, t.widthSegments, t.heightSegments, t.phiStart, t.phiLength, t.thetaStart, t.thetaLength);
    }
  }]);
  return Bs;
}(we);
var zu = /*#__PURE__*/function (_we7) {
    _inherits(zu, _we7);
    var _super60 = _createSuper(zu);
    function zu() {
      var _this56;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : .4;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 12;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 48;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Math.PI * 2;
      _classCallCheck(this, zu);
      _this56 = _super60.call(this), _this56.type = "TorusGeometry", _this56.parameters = {
        radius: t,
        tube: e,
        radialSegments: r,
        tubularSegments: i,
        arc: s
      }, r = Math.floor(r), i = Math.floor(i);
      var o = [],
        a = [],
        l = [],
        u = [],
        c = new _(),
        d = new _(),
        h = new _();
      for (var _f17 = 0; _f17 <= r; _f17++) for (var _p15 = 0; _p15 <= i; _p15++) {
        var _m11 = _p15 / i * s,
          _g6 = _f17 / r * Math.PI * 2;
        d.x = (t + e * Math.cos(_g6)) * Math.cos(_m11), d.y = (t + e * Math.cos(_g6)) * Math.sin(_m11), d.z = e * Math.sin(_g6), a.push(d.x, d.y, d.z), c.x = t * Math.cos(_m11), c.y = t * Math.sin(_m11), h.subVectors(d, c).normalize(), l.push(h.x, h.y, h.z), u.push(_p15 / i), u.push(_f17 / r);
      }
      for (var _f18 = 1; _f18 <= r; _f18++) for (var _p16 = 1; _p16 <= i; _p16++) {
        var _m12 = (i + 1) * _f18 + _p16 - 1,
          _g7 = (i + 1) * (_f18 - 1) + _p16 - 1,
          _y10 = (i + 1) * (_f18 - 1) + _p16,
          v = (i + 1) * _f18 + _p16;
        o.push(_m12, _g7, v), o.push(_g7, _y10, v);
      }
      _this56.setIndex(o), _this56.setAttribute("position", new be(a, 3)), _this56.setAttribute("normal", new be(l, 3)), _this56.setAttribute("uv", new be(u, 2));
      return _this56;
    }
    _createClass(zu, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new zu(t.radius, t.tube, t.radialSegments, t.tubularSegments, t.arc);
      }
    }]);
    return zu;
  }(we),
  Vu = /*#__PURE__*/function (_we8) {
    _inherits(Vu, _we8);
    var _super61 = _createSuper(Vu);
    function Vu() {
      var _this57;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : .4;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 64;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 8;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 2;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 3;
      _classCallCheck(this, Vu);
      _this57 = _super61.call(this), _this57.type = "TorusKnotGeometry", _this57.parameters = {
        radius: t,
        tube: e,
        tubularSegments: r,
        radialSegments: i,
        p: s,
        q: o
      }, r = Math.floor(r), i = Math.floor(i);
      var a = [],
        l = [],
        u = [],
        c = [],
        d = new _(),
        h = new _(),
        f = new _(),
        p = new _(),
        m = new _(),
        g = new _(),
        y = new _();
      for (var x = 0; x <= r; ++x) {
        var S = x / r * s * Math.PI * 2;
        v(S, s, o, t, f), v(S + .01, s, o, t, p), g.subVectors(p, f), y.addVectors(p, f), m.crossVectors(g, y), y.crossVectors(m, g), m.normalize(), y.normalize();
        for (var w = 0; w <= i; ++w) {
          var A = w / i * Math.PI * 2,
            E = -e * Math.cos(A),
            b = e * Math.sin(A);
          d.x = f.x + (E * y.x + b * m.x), d.y = f.y + (E * y.y + b * m.y), d.z = f.z + (E * y.z + b * m.z), l.push(d.x, d.y, d.z), h.subVectors(d, f).normalize(), u.push(h.x, h.y, h.z), c.push(x / r), c.push(w / i);
        }
      }
      for (var _x13 = 1; _x13 <= r; _x13++) for (var _S12 = 1; _S12 <= i; _S12++) {
        var _w13 = (i + 1) * (_x13 - 1) + (_S12 - 1),
          _A9 = (i + 1) * _x13 + (_S12 - 1),
          _E8 = (i + 1) * _x13 + _S12,
          _b6 = (i + 1) * (_x13 - 1) + _S12;
        a.push(_w13, _A9, _b6), a.push(_A9, _E8, _b6);
      }
      _this57.setIndex(a), _this57.setAttribute("position", new be(l, 3)), _this57.setAttribute("normal", new be(u, 3)), _this57.setAttribute("uv", new be(c, 2));
      function v(x, S, w, A, E) {
        var b = Math.cos(x),
          T = Math.sin(x),
          M = w / S * x,
          C = Math.cos(M);
        E.x = A * (2 + C) * .5 * b, E.y = A * (2 + C) * T * .5, E.z = A * Math.sin(M) * .5;
      }
      return _this57;
    }
    _createClass(Vu, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new Vu(t.radius, t.tube, t.tubularSegments, t.radialSegments, t.p, t.q);
      }
    }]);
    return Vu;
  }(we);
function Wa(n, t, e) {
  return VM(n) ? new n.constructor(n.subarray(t, e !== void 0 ? e : n.length)) : n.slice(t, e);
}
function qg(n, t, e) {
  return !n || !e && n.constructor === t ? n : typeof t.BYTES_PER_ELEMENT == "number" ? new t(n) : Array.prototype.slice.call(n);
}
function VM(n) {
  return ArrayBuffer.isView(n) && !(n instanceof DataView);
}
function i4(n) {
  function t(i, s) {
    return n[i] - n[s];
  }
  var e = n.length,
    r = new Array(e);
  for (var i = 0; i !== e; ++i) r[i] = i;
  return r.sort(t), r;
}
function dM(n, t, e) {
  var r = n.length,
    i = new n.constructor(r);
  for (var s = 0, o = 0; o !== r; ++s) {
    var a = e[s] * t;
    for (var _l13 = 0; _l13 !== t; ++_l13) i[o++] = n[a + _l13];
  }
  return i;
}
function UM(n, t, e, r) {
  var i = 1,
    s = n[0];
  for (; s !== void 0 && s[r] === void 0;) s = n[i++];
  if (s === void 0) return;
  var o = s[r];
  if (o !== void 0) if (Array.isArray(o)) do o = s[r], o !== void 0 && (t.push(s.time), e.push.apply(e, o)), s = n[i++]; while (s !== void 0);else if (o.toArray !== void 0) do o = s[r], o !== void 0 && (t.push(s.time), o.toArray(e, e.length)), s = n[i++]; while (s !== void 0);else do o = s[r], o !== void 0 && (t.push(s.time), e.push(o)), s = n[i++]; while (s !== void 0);
}
var Uu = /*#__PURE__*/function () {
    function Uu(t, e, r, i) {
      _classCallCheck(this, Uu);
      this.parameterPositions = t, this._cachedIndex = 0, this.resultBuffer = i !== void 0 ? i : new e.constructor(r), this.sampleValues = e, this.valueSize = r, this.settings = null, this.DefaultSettings_ = {};
    }
    _createClass(Uu, [{
      key: "evaluate",
      value: function evaluate(t) {
        var e = this.parameterPositions,
          r = this._cachedIndex,
          i = e[r],
          s = e[r - 1];
        e: {
          t: {
            var o;
            r: {
              i: if (!(t < i)) {
                for (var a = r + 2;;) {
                  if (i === void 0) {
                    if (t < s) break i;
                    return r = e.length, this._cachedIndex = r, this.copySampleValue_(r - 1);
                  }
                  if (r === a) break;
                  if (s = i, i = e[++r], t < i) break t;
                }
                o = e.length;
                break r;
              }
              if (!(t >= s)) {
                var _a9 = e[1];
                t < _a9 && (r = 2, s = _a9);
                for (var _l14 = r - 2;;) {
                  if (s === void 0) return this._cachedIndex = 0, this.copySampleValue_(0);
                  if (r === _l14) break;
                  if (i = s, s = e[--r - 1], t >= s) break t;
                }
                o = r, r = 0;
                break r;
              }
              break e;
            }
            for (; r < o;) {
              var _a10 = r + o >>> 1;
              t < e[_a10] ? o = _a10 : r = _a10 + 1;
            }
            if (i = e[r], s = e[r - 1], s === void 0) return this._cachedIndex = 0, this.copySampleValue_(0);
            if (i === void 0) return r = e.length, this._cachedIndex = r, this.copySampleValue_(r - 1);
          }
          this._cachedIndex = r, this.intervalChanged_(r, s, i);
        }
        return this.interpolate_(r, s, t, i);
      }
    }, {
      key: "getSettings_",
      value: function getSettings_() {
        return this.settings || this.DefaultSettings_;
      }
    }, {
      key: "copySampleValue_",
      value: function copySampleValue_(t) {
        var e = this.resultBuffer,
          r = this.sampleValues,
          i = this.valueSize,
          s = t * i;
        for (var o = 0; o !== i; ++o) e[o] = r[s + o];
        return e;
      }
    }, {
      key: "interpolate_",
      value: function interpolate_() {
        throw new Error("call to abstract method");
      }
    }, {
      key: "intervalChanged_",
      value: function intervalChanged_() {}
    }]);
    return Uu;
  }(),
  qS = /*#__PURE__*/function (_Uu) {
    _inherits(qS, _Uu);
    var _super62 = _createSuper(qS);
    function qS(t, e, r, i) {
      var _this58;
      _classCallCheck(this, qS);
      _this58 = _super62.call(this, t, e, r, i), _this58._weightPrev = -0, _this58._offsetPrev = -0, _this58._weightNext = -0, _this58._offsetNext = -0, _this58.DefaultSettings_ = {
        endingStart: _u,
        endingEnd: _u
      };
      return _this58;
    }
    _createClass(qS, [{
      key: "intervalChanged_",
      value: function intervalChanged_(t, e, r) {
        var i = this.parameterPositions,
          s = t - 2,
          o = t + 1,
          a = i[s],
          l = i[o];
        if (a === void 0) switch (this.getSettings_().endingStart) {
          case Eu:
            s = t, a = 2 * e - r;
            break;
          case $g:
            s = i.length - 2, a = e + i[s] - i[s + 1];
            break;
          default:
            s = t, a = r;
        }
        if (l === void 0) switch (this.getSettings_().endingEnd) {
          case Eu:
            o = t, l = 2 * r - e;
            break;
          case $g:
            o = 1, l = r + i[1] - i[0];
            break;
          default:
            o = t - 1, l = e;
        }
        var u = (r - e) * .5,
          c = this.valueSize;
        this._weightPrev = u / (e - a), this._weightNext = u / (l - r), this._offsetPrev = s * c, this._offsetNext = o * c;
      }
    }, {
      key: "interpolate_",
      value: function interpolate_(t, e, r, i) {
        var s = this.resultBuffer,
          o = this.sampleValues,
          a = this.valueSize,
          l = t * a,
          u = l - a,
          c = this._offsetPrev,
          d = this._offsetNext,
          h = this._weightPrev,
          f = this._weightNext,
          p = (r - e) / (i - e),
          m = p * p,
          g = m * p,
          y = -h * g + 2 * h * m - h * p,
          v = (1 + h) * g + (-1.5 - 2 * h) * m + (-.5 + h) * p + 1,
          x = (-1 - f) * g + (1.5 + f) * m + .5 * p,
          S = f * g - f * m;
        for (var w = 0; w !== a; ++w) s[w] = y * o[c + w] + v * o[u + w] + x * o[l + w] + S * o[d + w];
        return s;
      }
    }]);
    return qS;
  }(Uu),
  hy = /*#__PURE__*/function (_Uu2) {
    _inherits(hy, _Uu2);
    var _super63 = _createSuper(hy);
    function hy(t, e, r, i) {
      _classCallCheck(this, hy);
      return _super63.call(this, t, e, r, i);
    }
    _createClass(hy, [{
      key: "interpolate_",
      value: function interpolate_(t, e, r, i) {
        var s = this.resultBuffer,
          o = this.sampleValues,
          a = this.valueSize,
          l = t * a,
          u = l - a,
          c = (r - e) / (i - e),
          d = 1 - c;
        for (var _h10 = 0; _h10 !== a; ++_h10) s[_h10] = o[u + _h10] * d + o[l + _h10] * c;
        return s;
      }
    }]);
    return hy;
  }(Uu),
  YS = /*#__PURE__*/function (_Uu3) {
    _inherits(YS, _Uu3);
    var _super64 = _createSuper(YS);
    function YS(t, e, r, i) {
      _classCallCheck(this, YS);
      return _super64.call(this, t, e, r, i);
    }
    _createClass(YS, [{
      key: "interpolate_",
      value: function interpolate_(t) {
        return this.copySampleValue_(t - 1);
      }
    }]);
    return YS;
  }(Uu),
  os = /*#__PURE__*/function () {
    function os(t, e, r, i) {
      _classCallCheck(this, os);
      if (t === void 0) throw new Error("THREE.KeyframeTrack: track name is undefined");
      if (e === void 0 || e.length === 0) throw new Error("THREE.KeyframeTrack: no keyframes in track named " + t);
      this.name = t, this.times = qg(e, this.TimeBufferType), this.values = qg(r, this.ValueBufferType), this.setInterpolation(i || this.DefaultInterpolation);
    }
    _createClass(os, [{
      key: "InterpolantFactoryMethodDiscrete",
      value: function InterpolantFactoryMethodDiscrete(t) {
        return new YS(this.times, this.values, this.getValueSize(), t);
      }
    }, {
      key: "InterpolantFactoryMethodLinear",
      value: function InterpolantFactoryMethodLinear(t) {
        return new hy(this.times, this.values, this.getValueSize(), t);
      }
    }, {
      key: "InterpolantFactoryMethodSmooth",
      value: function InterpolantFactoryMethodSmooth(t) {
        return new qS(this.times, this.values, this.getValueSize(), t);
      }
    }, {
      key: "setInterpolation",
      value: function setInterpolation(t) {
        var e;
        switch (t) {
          case Zg:
            e = this.InterpolantFactoryMethodDiscrete;
            break;
          case Jg:
            e = this.InterpolantFactoryMethodLinear;
            break;
          case Wb:
            e = this.InterpolantFactoryMethodSmooth;
            break;
        }
        if (e === void 0) {
          var r = "unsupported interpolation for " + this.ValueTypeName + " keyframe track named " + this.name;
          if (this.createInterpolant === void 0) if (t !== this.DefaultInterpolation) this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);
          return console.warn("THREE.KeyframeTrack:", r), this;
        }
        return this.createInterpolant = e, this;
      }
    }, {
      key: "getInterpolation",
      value: function getInterpolation() {
        switch (this.createInterpolant) {
          case this.InterpolantFactoryMethodDiscrete:
            return Zg;
          case this.InterpolantFactoryMethodLinear:
            return Jg;
          case this.InterpolantFactoryMethodSmooth:
            return Wb;
        }
      }
    }, {
      key: "getValueSize",
      value: function getValueSize() {
        return this.values.length / this.times.length;
      }
    }, {
      key: "shift",
      value: function shift(t) {
        if (t !== 0) {
          var e = this.times;
          for (var r = 0, i = e.length; r !== i; ++r) e[r] += t;
        }
        return this;
      }
    }, {
      key: "scale",
      value: function scale(t) {
        if (t !== 1) {
          var e = this.times;
          for (var r = 0, i = e.length; r !== i; ++r) e[r] *= t;
        }
        return this;
      }
    }, {
      key: "trim",
      value: function trim(t, e) {
        var r = this.times,
          i = r.length,
          s = 0,
          o = i - 1;
        for (; s !== i && r[s] < t;) ++s;
        for (; o !== -1 && r[o] > e;) --o;
        if (++o, s !== 0 || o !== i) {
          s >= o && (o = Math.max(o, 1), s = o - 1);
          var a = this.getValueSize();
          this.times = Wa(r, s, o), this.values = Wa(this.values, s * a, o * a);
        }
        return this;
      }
    }, {
      key: "validate",
      value: function validate() {
        var t = !0,
          e = this.getValueSize();
        e - Math.floor(e) !== 0 && (console.error("THREE.KeyframeTrack: Invalid value size in track.", this), t = !1);
        var r = this.times,
          i = this.values,
          s = r.length;
        s === 0 && (console.error("THREE.KeyframeTrack: Track is empty.", this), t = !1);
        var o = null;
        for (var a = 0; a !== s; a++) {
          var _l15 = r[a];
          if (typeof _l15 == "number" && isNaN(_l15)) {
            console.error("THREE.KeyframeTrack: Time is not a valid number.", this, a, _l15), t = !1;
            break;
          }
          if (o !== null && o > _l15) {
            console.error("THREE.KeyframeTrack: Out of order keys.", this, a, _l15, o), t = !1;
            break;
          }
          o = _l15;
        }
        if (i !== void 0 && VM(i)) for (var _a11 = 0, _l16 = i.length; _a11 !== _l16; ++_a11) {
          var u = i[_a11];
          if (isNaN(u)) {
            console.error("THREE.KeyframeTrack: Value is not a valid number.", this, _a11, u), t = !1;
            break;
          }
        }
        return t;
      }
    }, {
      key: "optimize",
      value: function optimize() {
        var t = Wa(this.times),
          e = Wa(this.values),
          r = this.getValueSize(),
          i = this.getInterpolation() === Wb,
          s = t.length - 1,
          o = 1;
        for (var a = 1; a < s; ++a) {
          var _l17 = !1,
            u = t[a],
            c = t[a + 1];
          if (u !== c && (a !== 1 || u !== t[0])) if (i) _l17 = !0;else {
            var _d6 = a * r,
              _h11 = _d6 - r,
              _f19 = _d6 + r;
            for (var _p17 = 0; _p17 !== r; ++_p17) {
              var _m13 = e[_d6 + _p17];
              if (_m13 !== e[_h11 + _p17] || _m13 !== e[_f19 + _p17]) {
                _l17 = !0;
                break;
              }
            }
          }
          if (_l17) {
            if (a !== o) {
              t[o] = t[a];
              var _d7 = a * r,
                _h12 = o * r;
              for (var _f20 = 0; _f20 !== r; ++_f20) e[_h12 + _f20] = e[_d7 + _f20];
            }
            ++o;
          }
        }
        if (s > 0) {
          t[o] = t[s];
          for (var _a12 = s * r, _l18 = o * r, _u11 = 0; _u11 !== r; ++_u11) e[_l18 + _u11] = e[_a12 + _u11];
          ++o;
        }
        return o !== t.length ? (this.times = Wa(t, 0, o), this.values = Wa(e, 0, o * r)) : (this.times = t, this.values = e), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        var t = Wa(this.times, 0),
          e = Wa(this.values, 0),
          r = this.constructor,
          i = new r(this.name, t, e);
        return i.createInterpolant = this.createInterpolant, i;
      }
    }], [{
      key: "toJSON",
      value: function toJSON(t) {
        var e = t.constructor,
          r;
        if (e.toJSON !== this.toJSON) r = e.toJSON(t);else {
          r = {
            name: t.name,
            times: qg(t.times, Array),
            values: qg(t.values, Array)
          };
          var i = t.getInterpolation();
          i !== t.DefaultInterpolation && (r.interpolation = i);
        }
        return r.type = t.ValueTypeName, r;
      }
    }]);
    return os;
  }();
os.prototype.TimeBufferType = Float32Array;
os.prototype.ValueBufferType = Float32Array;
os.prototype.DefaultInterpolation = Jg;
var el = /*#__PURE__*/function (_os) {
  _inherits(el, _os);
  var _super65 = _createSuper(el);
  function el() {
    _classCallCheck(this, el);
    return _super65.apply(this, arguments);
  }
  return _createClass(el);
}(os);
el.prototype.ValueTypeName = "bool";
el.prototype.ValueBufferType = Array;
el.prototype.DefaultInterpolation = Zg;
el.prototype.InterpolantFactoryMethodLinear = void 0;
el.prototype.InterpolantFactoryMethodSmooth = void 0;
var fy = /*#__PURE__*/function (_os2) {
  _inherits(fy, _os2);
  var _super66 = _createSuper(fy);
  function fy() {
    _classCallCheck(this, fy);
    return _super66.apply(this, arguments);
  }
  return _createClass(fy);
}(os);
fy.prototype.ValueTypeName = "color";
var Gu = /*#__PURE__*/function (_os3) {
  _inherits(Gu, _os3);
  var _super67 = _createSuper(Gu);
  function Gu() {
    _classCallCheck(this, Gu);
    return _super67.apply(this, arguments);
  }
  return _createClass(Gu);
}(os);
Gu.prototype.ValueTypeName = "number";
var XS = /*#__PURE__*/function (_Uu4) {
    _inherits(XS, _Uu4);
    var _super68 = _createSuper(XS);
    function XS(t, e, r, i) {
      _classCallCheck(this, XS);
      return _super68.call(this, t, e, r, i);
    }
    _createClass(XS, [{
      key: "interpolate_",
      value: function interpolate_(t, e, r, i) {
        var s = this.resultBuffer,
          o = this.sampleValues,
          a = this.valueSize,
          l = (r - e) / (i - e),
          u = t * a;
        for (var c = u + a; u !== c; u += 4) je.slerpFlat(s, 0, o, u - a, o, u, l);
        return s;
      }
    }]);
    return XS;
  }(Uu),
  bc = /*#__PURE__*/function (_os4) {
    _inherits(bc, _os4);
    var _super69 = _createSuper(bc);
    function bc() {
      _classCallCheck(this, bc);
      return _super69.apply(this, arguments);
    }
    _createClass(bc, [{
      key: "InterpolantFactoryMethodLinear",
      value: function InterpolantFactoryMethodLinear(t) {
        return new XS(this.times, this.values, this.getValueSize(), t);
      }
    }]);
    return bc;
  }(os);
bc.prototype.ValueTypeName = "quaternion";
bc.prototype.DefaultInterpolation = Jg;
bc.prototype.InterpolantFactoryMethodSmooth = void 0;
var tl = /*#__PURE__*/function (_os5) {
  _inherits(tl, _os5);
  var _super70 = _createSuper(tl);
  function tl() {
    _classCallCheck(this, tl);
    return _super70.apply(this, arguments);
  }
  return _createClass(tl);
}(os);
tl.prototype.ValueTypeName = "string";
tl.prototype.ValueBufferType = Array;
tl.prototype.DefaultInterpolation = Zg;
tl.prototype.InterpolantFactoryMethodLinear = void 0;
tl.prototype.InterpolantFactoryMethodSmooth = void 0;
var ju = /*#__PURE__*/function (_os6) {
  _inherits(ju, _os6);
  var _super71 = _createSuper(ju);
  function ju() {
    _classCallCheck(this, ju);
    return _super71.apply(this, arguments);
  }
  return _createClass(ju);
}(os);
ju.prototype.ValueTypeName = "vector";
var Hu = /*#__PURE__*/function () {
  function Hu(t) {
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;
    var r = arguments.length > 2 ? arguments[2] : undefined;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : aw;
    _classCallCheck(this, Hu);
    this.name = t, this.tracks = r, this.duration = e, this.blendMode = i, this.uuid = rs(), this.duration < 0 && this.resetDuration();
  }
  _createClass(Hu, [{
    key: "resetDuration",
    value: function resetDuration() {
      var t = this.tracks,
        e = 0;
      for (var r = 0, i = t.length; r !== i; ++r) {
        var s = this.tracks[r];
        e = Math.max(e, s.times[s.times.length - 1]);
      }
      return this.duration = e, this;
    }
  }, {
    key: "trim",
    value: function trim() {
      for (var t = 0; t < this.tracks.length; t++) this.tracks[t].trim(0, this.duration);
      return this;
    }
  }, {
    key: "validate",
    value: function validate() {
      var t = !0;
      for (var e = 0; e < this.tracks.length; e++) t = t && this.tracks[e].validate();
      return t;
    }
  }, {
    key: "optimize",
    value: function optimize() {
      for (var t = 0; t < this.tracks.length; t++) this.tracks[t].optimize();
      return this;
    }
  }, {
    key: "clone",
    value: function clone() {
      var t = [];
      for (var e = 0; e < this.tracks.length; e++) t.push(this.tracks[e].clone());
      return new this.constructor(this.name, this.duration, t, this.blendMode);
    }
  }, {
    key: "toJSON",
    value: function toJSON() {
      return this.constructor.toJSON(this);
    }
  }], [{
    key: "parse",
    value: function parse(t) {
      var e = [],
        r = t.tracks,
        i = 1 / (t.fps || 1);
      for (var o = 0, a = r.length; o !== a; ++o) e.push(s4(r[o]).scale(i));
      var s = new this(t.name, t.duration, e, t.blendMode);
      return s.uuid = t.uuid, s;
    }
  }, {
    key: "toJSON",
    value: function toJSON(t) {
      var e = [],
        r = t.tracks,
        i = {
          name: t.name,
          duration: t.duration,
          tracks: e,
          uuid: t.uuid,
          blendMode: t.blendMode
        };
      for (var s = 0, o = r.length; s !== o; ++s) e.push(os.toJSON(r[s]));
      return i;
    }
  }, {
    key: "CreateFromMorphTargetSequence",
    value: function CreateFromMorphTargetSequence(t, e, r, i) {
      var s = e.length,
        o = [];
      for (var a = 0; a < s; a++) {
        var _l19 = [],
          u = [];
        _l19.push((a + s - 1) % s, a, (a + 1) % s), u.push(0, 1, 0);
        var c = i4(_l19);
        _l19 = dM(_l19, 1, c), u = dM(u, 1, c), !i && _l19[0] === 0 && (_l19.push(s), u.push(u[0])), o.push(new Gu(".morphTargetInfluences[" + e[a].name + "]", _l19, u).scale(1 / r));
      }
      return new this(t, -1, o);
    }
  }, {
    key: "findByName",
    value: function findByName(t, e) {
      var r = t;
      if (!Array.isArray(t)) {
        var i = t;
        r = i.geometry && i.geometry.animations || i.animations;
      }
      for (var _i3 = 0; _i3 < r.length; _i3++) if (r[_i3].name === e) return r[_i3];
      return null;
    }
  }, {
    key: "CreateClipsFromMorphTargetSequences",
    value: function CreateClipsFromMorphTargetSequences(t, e, r) {
      var i = {},
        s = /^([\w-]*?)([\d]+)$/;
      for (var a = 0, _l20 = t.length; a < _l20; a++) {
        var u = t[a],
          c = u.name.match(s);
        if (c && c.length > 1) {
          var _d8 = c[1],
            _h13 = i[_d8];
          _h13 || (i[_d8] = _h13 = []), _h13.push(u);
        }
      }
      var o = [];
      for (var _a13 in i) o.push(this.CreateFromMorphTargetSequence(_a13, i[_a13], e, r));
      return o;
    }
  }, {
    key: "parseAnimation",
    value: function parseAnimation(t, e) {
      if (!t) return console.error("THREE.AnimationClip: No animation in JSONLoader data."), null;
      var r = function r(d, h, f, p, m) {
          if (f.length !== 0) {
            var _g8 = [],
              _y11 = [];
            UM(f, _g8, _y11, p), _g8.length !== 0 && m.push(new d(h, _g8, _y11));
          }
        },
        i = [],
        s = t.name || "default",
        o = t.fps || 30,
        a = t.blendMode,
        l = t.length || -1,
        u = t.hierarchy || [];
      for (var _d9 = 0; _d9 < u.length; _d9++) {
        var _h14 = u[_d9].keys;
        if (!(!_h14 || _h14.length === 0)) if (_h14[0].morphTargets) {
          var _f21 = {},
            _p18 = void 0;
          for (_p18 = 0; _p18 < _h14.length; _p18++) if (_h14[_p18].morphTargets) for (var _m14 = 0; _m14 < _h14[_p18].morphTargets.length; _m14++) _f21[_h14[_p18].morphTargets[_m14]] = -1;
          for (var _m15 in _f21) {
            var _g9 = [],
              _y12 = [];
            for (var _v12 = 0; _v12 !== _h14[_p18].morphTargets.length; ++_v12) {
              var x = _h14[_p18];
              _g9.push(x.time), _y12.push(x.morphTarget === _m15 ? 1 : 0);
            }
            i.push(new Gu(".morphTargetInfluence[" + _m15 + "]", _g9, _y12));
          }
          l = _f21.length * o;
        } else {
          var _f22 = ".bones[" + e[_d9].name + "]";
          r(ju, _f22 + ".position", _h14, "pos", i), r(bc, _f22 + ".quaternion", _h14, "rot", i), r(ju, _f22 + ".scale", _h14, "scl", i);
        }
      }
      return i.length === 0 ? null : new this(s, l, i, a);
    }
  }]);
  return Hu;
}();
function n4(n) {
  switch (n.toLowerCase()) {
    case "scalar":
    case "double":
    case "float":
    case "number":
    case "integer":
      return Gu;
    case "vector":
    case "vector2":
    case "vector3":
    case "vector4":
      return ju;
    case "color":
      return fy;
    case "quaternion":
      return bc;
    case "bool":
    case "boolean":
      return el;
    case "string":
      return tl;
  }
  throw new Error("THREE.KeyframeTrack: Unsupported typeName: " + n);
}
function s4(n) {
  if (n.type === void 0) throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");
  var t = n4(n.type);
  if (n.times === void 0) {
    var e = [],
      r = [];
    UM(n.keys, e, r, "value"), n.times = e, n.values = r;
  }
  return t.parse !== void 0 ? t.parse(n) : new t(n.name, n.times, n.values, n.interpolation);
}
var py = {
    enabled: !1,
    files: {},
    add: function add(n, t) {
      this.enabled !== !1 && (this.files[n] = t);
    },
    get: function get(n) {
      if (this.enabled !== !1) return this.files[n];
    },
    remove: function remove(n) {
      delete this.files[n];
    },
    clear: function clear() {
      this.files = {};
    }
  },
  xp = /*#__PURE__*/_createClass(function xp(t, e, r) {
    _classCallCheck(this, xp);
    var i = this,
      s = !1,
      o = 0,
      a = 0,
      l,
      u = [];
    this.onStart = void 0, this.onLoad = t, this.onProgress = e, this.onError = r, this.itemStart = function (c) {
      a++, s === !1 && i.onStart !== void 0 && i.onStart(c, o, a), s = !0;
    }, this.itemEnd = function (c) {
      o++, i.onProgress !== void 0 && i.onProgress(c, o, a), o === a && (s = !1, i.onLoad !== void 0 && i.onLoad());
    }, this.itemError = function (c) {
      i.onError !== void 0 && i.onError(c);
    }, this.resolveURL = function (c) {
      return l ? l(c) : c;
    }, this.setURLModifier = function (c) {
      return l = c, this;
    }, this.addHandler = function (c, d) {
      return u.push(c, d), this;
    }, this.removeHandler = function (c) {
      var d = u.indexOf(c);
      return d !== -1 && u.splice(d, 2), this;
    }, this.getHandler = function (c) {
      for (var _d10 = 0, _h15 = u.length; _d10 < _h15; _d10 += 2) {
        var _f23 = u[_d10],
          _p19 = u[_d10 + 1];
        if (_f23.global && (_f23.lastIndex = 0), _f23.test(c)) return _p19;
      }
      return null;
    };
  }),
  o4 = new xp(),
  rl = /*#__PURE__*/function () {
    function rl(t) {
      _classCallCheck(this, rl);
      this.manager = t !== void 0 ? t : o4, this.crossOrigin = "anonymous", this.withCredentials = !1, this.path = "", this.resourcePath = "", this.requestHeader = {};
    }
    _createClass(rl, [{
      key: "load",
      value: function load() {}
    }, {
      key: "loadAsync",
      value: function loadAsync(t, e) {
        var r = this;
        return new Promise(function (i, s) {
          r.load(t, i, e, s);
        });
      }
    }, {
      key: "parse",
      value: function parse() {}
    }, {
      key: "setCrossOrigin",
      value: function setCrossOrigin(t) {
        return this.crossOrigin = t, this;
      }
    }, {
      key: "setWithCredentials",
      value: function setWithCredentials(t) {
        return this.withCredentials = t, this;
      }
    }, {
      key: "setPath",
      value: function setPath(t) {
        return this.path = t, this;
      }
    }, {
      key: "setResourcePath",
      value: function setResourcePath(t) {
        return this.resourcePath = t, this;
      }
    }, {
      key: "setRequestHeader",
      value: function setRequestHeader(t) {
        return this.requestHeader = t, this;
      }
    }]);
    return rl;
  }(),
  ra = {},
  QS = /*#__PURE__*/function (_Error) {
    _inherits(QS, _Error);
    var _super72 = _createSuper(QS);
    function QS(t, e) {
      var _this59;
      _classCallCheck(this, QS);
      _this59 = _super72.call(this, t), _this59.response = e;
      return _this59;
    }
    return _createClass(QS);
  }( /*#__PURE__*/_wrapNativeSuper(Error)),
  Wu = /*#__PURE__*/function (_rl) {
    _inherits(Wu, _rl);
    var _super73 = _createSuper(Wu);
    function Wu(t) {
      _classCallCheck(this, Wu);
      return _super73.call(this, t);
    }
    _createClass(Wu, [{
      key: "load",
      value: function load(t, e, r, i) {
        var _this60 = this;
        t === void 0 && (t = ""), this.path !== void 0 && (t = this.path + t), t = this.manager.resolveURL(t);
        var s = py.get(t);
        if (s !== void 0) return this.manager.itemStart(t), setTimeout(function () {
          e && e(s), _this60.manager.itemEnd(t);
        }, 0), s;
        if (ra[t] !== void 0) {
          ra[t].push({
            onLoad: e,
            onProgress: r,
            onError: i
          });
          return;
        }
        ra[t] = [], ra[t].push({
          onLoad: e,
          onProgress: r,
          onError: i
        });
        var o = new Request(t, {
            headers: new Headers(this.requestHeader),
            credentials: this.withCredentials ? "include" : "same-origin"
          }),
          a = this.mimeType,
          l = this.responseType;
        fetch(o).then(function (u) {
          if (u.status === 200 || u.status === 0) {
            if (u.status === 0 && console.warn("THREE.FileLoader: HTTP Status 0 received."), (typeof ReadableStream === "undefined" ? "undefined" : _typeof(ReadableStream)) > "u" || u.body === void 0 || u.body.getReader === void 0) return u;
            var c = ra[t],
              _d11 = u.body.getReader(),
              _h16 = u.headers.get("Content-Length") || u.headers.get("X-File-Size"),
              _f24 = _h16 ? parseInt(_h16) : 0,
              _p20 = _f24 !== 0,
              _m16 = 0,
              _g10 = new ReadableStream({
                start: function start(y) {
                  v();
                  function v() {
                    _d11.read().then(function (_ref2) {
                      var x = _ref2.done,
                        S = _ref2.value;
                      if (x) y.close();else {
                        _m16 += S.byteLength;
                        var w = new ProgressEvent("progress", {
                          lengthComputable: _p20,
                          loaded: _m16,
                          total: _f24
                        });
                        for (var A = 0, E = c.length; A < E; A++) {
                          var b = c[A];
                          b.onProgress && b.onProgress(w);
                        }
                        y.enqueue(S), v();
                      }
                    });
                  }
                }
              });
            return new Response(_g10);
          } else throw new QS("fetch for \"".concat(u.url, "\" responded with ").concat(u.status, ": ").concat(u.statusText), u);
        }).then(function (u) {
          switch (l) {
            case "arraybuffer":
              return u.arrayBuffer();
            case "blob":
              return u.blob();
            case "document":
              return u.text().then(function (c) {
                return new DOMParser().parseFromString(c, a);
              });
            case "json":
              return u.json();
            default:
              if (a === void 0) return u.text();
              {
                var _d12 = /charset="?([^;"\s]*)"?/i.exec(a),
                  _h17 = _d12 && _d12[1] ? _d12[1].toLowerCase() : void 0,
                  _f25 = new TextDecoder(_h17);
                return u.arrayBuffer().then(function (p) {
                  return _f25.decode(p);
                });
              }
          }
        }).then(function (u) {
          py.add(t, u);
          var c = ra[t];
          delete ra[t];
          for (var _d13 = 0, _h18 = c.length; _d13 < _h18; _d13++) {
            var _f26 = c[_d13];
            _f26.onLoad && _f26.onLoad(u);
          }
        }).catch(function (u) {
          var c = ra[t];
          if (c === void 0) throw _this60.manager.itemError(t), u;
          delete ra[t];
          for (var _d14 = 0, _h19 = c.length; _d14 < _h19; _d14++) {
            var _f27 = c[_d14];
            _f27.onError && _f27.onError(u);
          }
          _this60.manager.itemError(t);
        }).finally(function () {
          _this60.manager.itemEnd(t);
        }), this.manager.itemStart(t);
      }
    }, {
      key: "setResponseType",
      value: function setResponseType(t) {
        return this.responseType = t, this;
      }
    }, {
      key: "setMimeType",
      value: function setMimeType(t) {
        return this.mimeType = t, this;
      }
    }]);
    return Wu;
  }(rl);
var KS = /*#__PURE__*/function (_rl2) {
  _inherits(KS, _rl2);
  var _super74 = _createSuper(KS);
  function KS(t) {
    _classCallCheck(this, KS);
    return _super74.call(this, t);
  }
  _createClass(KS, [{
    key: "load",
    value: function load(t, e, r, i) {
      this.path !== void 0 && (t = this.path + t), t = this.manager.resolveURL(t);
      var s = this,
        o = py.get(t);
      if (o !== void 0) return s.manager.itemStart(t), setTimeout(function () {
        e && e(o), s.manager.itemEnd(t);
      }, 0), o;
      var a = cp("img");
      function l() {
        c(), py.add(t, this), e && e(this), s.manager.itemEnd(t);
      }
      function u(d) {
        c(), i && i(d), s.manager.itemError(t), s.manager.itemEnd(t);
      }
      function c() {
        a.removeEventListener("load", l, !1), a.removeEventListener("error", u, !1);
      }
      return a.addEventListener("load", l, !1), a.addEventListener("error", u, !1), t.slice(0, 5) !== "data:" && this.crossOrigin !== void 0 && (a.crossOrigin = this.crossOrigin), s.manager.itemStart(t), a.src = t, a;
    }
  }]);
  return KS;
}(rl);
var my = /*#__PURE__*/function (_rl3) {
    _inherits(my, _rl3);
    var _super75 = _createSuper(my);
    function my(t) {
      _classCallCheck(this, my);
      return _super75.call(this, t);
    }
    _createClass(my, [{
      key: "load",
      value: function load(t, e, r, i) {
        var s = new qt(),
          o = new KS(this.manager);
        return o.setCrossOrigin(this.crossOrigin), o.setPath(this.path), o.load(t, function (a) {
          s.image = a, s.needsUpdate = !0, e !== void 0 && e(s);
        }, r, i), s;
      }
    }]);
    return my;
  }(rl),
  il = /*#__PURE__*/function (_mt8) {
    _inherits(il, _mt8);
    var _super76 = _createSuper(il);
    function il(t) {
      var _this61;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      _classCallCheck(this, il);
      _this61 = _super76.call(this), _this61.isLight = !0, _this61.type = "Light", _this61.color = new Le(t), _this61.intensity = e;
      return _this61;
    }
    _createClass(il, [{
      key: "dispose",
      value: function dispose() {}
    }, {
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(il.prototype), "copy", this).call(this, t, e), this.color.copy(t.color), this.intensity = t.intensity, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON(t) {
        var e = _get(_getPrototypeOf(il.prototype), "toJSON", this).call(this, t);
        return e.object.color = this.color.getHex(), e.object.intensity = this.intensity, this.groundColor !== void 0 && (e.object.groundColor = this.groundColor.getHex()), this.distance !== void 0 && (e.object.distance = this.distance), this.angle !== void 0 && (e.object.angle = this.angle), this.decay !== void 0 && (e.object.decay = this.decay), this.penumbra !== void 0 && (e.object.penumbra = this.penumbra), this.shadow !== void 0 && (e.object.shadow = this.shadow.toJSON()), e;
      }
    }]);
    return il;
  }(mt),
  gy = /*#__PURE__*/function (_il) {
    _inherits(gy, _il);
    var _super77 = _createSuper(gy);
    function gy(t, e, r) {
      var _this62;
      _classCallCheck(this, gy);
      _this62 = _super77.call(this, t, r), _this62.isHemisphereLight = !0, _this62.type = "HemisphereLight", _this62.position.copy(mt.DEFAULT_UP), _this62.updateMatrix(), _this62.groundColor = new Le(e);
      return _this62;
    }
    _createClass(gy, [{
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(gy.prototype), "copy", this).call(this, t, e), this.groundColor.copy(t.groundColor), this;
      }
    }]);
    return gy;
  }(il),
  bS = new te(),
  hM = new _(),
  fM = new _(),
  bp = /*#__PURE__*/function () {
    function bp(t) {
      _classCallCheck(this, bp);
      this.camera = t, this.bias = 0, this.normalBias = 0, this.radius = 1, this.blurSamples = 8, this.mapSize = new N(512, 512), this.map = null, this.mapPass = null, this.matrix = new te(), this.autoUpdate = !0, this.needsUpdate = !1, this._frustum = new dp(), this._frameExtents = new N(1, 1), this._viewportCount = 1, this._viewports = [new He(0, 0, 1, 1)];
    }
    _createClass(bp, [{
      key: "getViewportCount",
      value: function getViewportCount() {
        return this._viewportCount;
      }
    }, {
      key: "getFrustum",
      value: function getFrustum() {
        return this._frustum;
      }
    }, {
      key: "updateMatrices",
      value: function updateMatrices(t) {
        var e = this.camera,
          r = this.matrix;
        hM.setFromMatrixPosition(t.matrixWorld), e.position.copy(hM), fM.setFromMatrixPosition(t.target.matrixWorld), e.lookAt(fM), e.updateMatrixWorld(), bS.multiplyMatrices(e.projectionMatrix, e.matrixWorldInverse), this._frustum.setFromProjectionMatrix(bS), r.set(.5, 0, 0, .5, 0, .5, 0, .5, 0, 0, .5, .5, 0, 0, 0, 1), r.multiply(bS);
      }
    }, {
      key: "getViewport",
      value: function getViewport(t) {
        return this._viewports[t];
      }
    }, {
      key: "getFrameExtents",
      value: function getFrameExtents() {
        return this._frameExtents;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.map && this.map.dispose(), this.mapPass && this.mapPass.dispose();
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.camera = t.camera.clone(), this.bias = t.bias, this.radius = t.radius, this.mapSize.copy(t.mapSize), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {};
        return this.bias !== 0 && (t.bias = this.bias), this.normalBias !== 0 && (t.normalBias = this.normalBias), this.radius !== 1 && (t.radius = this.radius), (this.mapSize.x !== 512 || this.mapSize.y !== 512) && (t.mapSize = this.mapSize.toArray()), t.camera = this.camera.toJSON(!1).object, delete t.camera.matrix, t;
      }
    }]);
    return bp;
  }(),
  ZS = /*#__PURE__*/function (_bp) {
    _inherits(ZS, _bp);
    var _super78 = _createSuper(ZS);
    function ZS() {
      var _this63;
      _classCallCheck(this, ZS);
      _this63 = _super78.call(this, new Wr(50, 1, .5, 500)), _this63.isSpotLightShadow = !0, _this63.focus = 1;
      return _this63;
    }
    _createClass(ZS, [{
      key: "updateMatrices",
      value: function updateMatrices(t) {
        var e = this.camera,
          r = lp * 2 * t.angle * this.focus,
          i = this.mapSize.width / this.mapSize.height,
          s = t.distance || e.far;
        (r !== e.fov || i !== e.aspect || s !== e.far) && (e.fov = r, e.aspect = i, e.far = s, e.updateProjectionMatrix()), _get(_getPrototypeOf(ZS.prototype), "updateMatrices", this).call(this, t);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(ZS.prototype), "copy", this).call(this, t), this.focus = t.focus, this;
      }
    }]);
    return ZS;
  }(bp),
  yy = /*#__PURE__*/function (_il2) {
    _inherits(yy, _il2);
    var _super79 = _createSuper(yy);
    function yy(t, e) {
      var _this64;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.PI / 3;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 2;
      _classCallCheck(this, yy);
      _this64 = _super79.call(this, t, e), _this64.isSpotLight = !0, _this64.type = "SpotLight", _this64.position.copy(mt.DEFAULT_UP), _this64.updateMatrix(), _this64.target = new mt(), _this64.distance = r, _this64.angle = i, _this64.penumbra = s, _this64.decay = o, _this64.map = null, _this64.shadow = new ZS();
      return _this64;
    }
    _createClass(yy, [{
      key: "power",
      get: function get() {
        return this.intensity * Math.PI;
      },
      set: function set(t) {
        this.intensity = t / Math.PI;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.shadow.dispose();
      }
    }, {
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(yy.prototype), "copy", this).call(this, t, e), this.distance = t.distance, this.angle = t.angle, this.penumbra = t.penumbra, this.decay = t.decay, this.target = t.target.clone(), this.shadow = t.shadow.clone(), this;
      }
    }]);
    return yy;
  }(il),
  pM = new te(),
  $f = new _(),
  SS = new _(),
  JS = /*#__PURE__*/function (_bp2) {
    _inherits(JS, _bp2);
    var _super80 = _createSuper(JS);
    function JS() {
      var _this65;
      _classCallCheck(this, JS);
      _this65 = _super80.call(this, new Wr(90, 1, .5, 500)), _this65.isPointLightShadow = !0, _this65._frameExtents = new N(4, 2), _this65._viewportCount = 6, _this65._viewports = [new He(2, 1, 1, 1), new He(0, 1, 1, 1), new He(3, 1, 1, 1), new He(1, 1, 1, 1), new He(3, 0, 1, 1), new He(1, 0, 1, 1)], _this65._cubeDirections = [new _(1, 0, 0), new _(-1, 0, 0), new _(0, 0, 1), new _(0, 0, -1), new _(0, 1, 0), new _(0, -1, 0)], _this65._cubeUps = [new _(0, 1, 0), new _(0, 1, 0), new _(0, 1, 0), new _(0, 1, 0), new _(0, 0, 1), new _(0, 0, -1)];
      return _this65;
    }
    _createClass(JS, [{
      key: "updateMatrices",
      value: function updateMatrices(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = this.camera,
          i = this.matrix,
          s = t.distance || r.far;
        s !== r.far && (r.far = s, r.updateProjectionMatrix()), $f.setFromMatrixPosition(t.matrixWorld), r.position.copy($f), SS.copy(r.position), SS.add(this._cubeDirections[e]), r.up.copy(this._cubeUps[e]), r.lookAt(SS), r.updateMatrixWorld(), i.makeTranslation(-$f.x, -$f.y, -$f.z), pM.multiplyMatrices(r.projectionMatrix, r.matrixWorldInverse), this._frustum.setFromProjectionMatrix(pM);
      }
    }]);
    return JS;
  }(bp),
  vy = /*#__PURE__*/function (_il3) {
    _inherits(vy, _il3);
    var _super81 = _createSuper(vy);
    function vy(t, e) {
      var _this66;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 2;
      _classCallCheck(this, vy);
      _this66 = _super81.call(this, t, e), _this66.isPointLight = !0, _this66.type = "PointLight", _this66.distance = r, _this66.decay = i, _this66.shadow = new JS();
      return _this66;
    }
    _createClass(vy, [{
      key: "power",
      get: function get() {
        return this.intensity * 4 * Math.PI;
      },
      set: function set(t) {
        this.intensity = t / (4 * Math.PI);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.shadow.dispose();
      }
    }, {
      key: "copy",
      value: function copy(t, e) {
        return _get(_getPrototypeOf(vy.prototype), "copy", this).call(this, t, e), this.distance = t.distance, this.decay = t.decay, this.shadow = t.shadow.clone(), this;
      }
    }]);
    return vy;
  }(il),
  $S = /*#__PURE__*/function (_bp3) {
    _inherits($S, _bp3);
    var _super82 = _createSuper($S);
    function $S() {
      var _this67;
      _classCallCheck(this, $S);
      _this67 = _super82.call(this, new Ou(-5, 5, 5, -5, .5, 500)), _this67.isDirectionalLightShadow = !0;
      return _this67;
    }
    return _createClass($S);
  }(bp),
  xy = /*#__PURE__*/function (_il4) {
    _inherits(xy, _il4);
    var _super83 = _createSuper(xy);
    function xy(t, e) {
      var _this68;
      _classCallCheck(this, xy);
      _this68 = _super83.call(this, t, e), _this68.isDirectionalLight = !0, _this68.type = "DirectionalLight", _this68.position.copy(mt.DEFAULT_UP), _this68.updateMatrix(), _this68.target = new mt(), _this68.shadow = new $S();
      return _this68;
    }
    _createClass(xy, [{
      key: "dispose",
      value: function dispose() {
        this.shadow.dispose();
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(xy.prototype), "copy", this).call(this, t), this.target = t.target.clone(), this.shadow = t.shadow.clone(), this;
      }
    }]);
    return xy;
  }(il);
var Sp = /*#__PURE__*/function (_we9) {
    _inherits(Sp, _we9);
    var _super84 = _createSuper(Sp);
    function Sp() {
      var _this69;
      _classCallCheck(this, Sp);
      _this69 = _super84.call(this), _this69.isInstancedBufferGeometry = !0, _this69.type = "InstancedBufferGeometry", _this69.instanceCount = 1 / 0;
      return _this69;
    }
    _createClass(Sp, [{
      key: "copy",
      value: function copy(t) {
        return _get(_getPrototypeOf(Sp.prototype), "copy", this).call(this, t), this.instanceCount = t.instanceCount, this;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = _get(_getPrototypeOf(Sp.prototype), "toJSON", this).call(this);
        return t.instanceCount = this.instanceCount, t.isInstancedBufferGeometry = !0, t;
      }
    }]);
    return Sp;
  }(we),
  qu = /*#__PURE__*/function (_rl4) {
    _inherits(qu, _rl4);
    var _super85 = _createSuper(qu);
    function qu(t) {
      _classCallCheck(this, qu);
      return _super85.call(this, t);
    }
    _createClass(qu, [{
      key: "load",
      value: function load(t, e, r, i) {
        var s = this,
          o = new Wu(s.manager);
        o.setPath(s.path), o.setRequestHeader(s.requestHeader), o.setWithCredentials(s.withCredentials), o.load(t, function (a) {
          try {
            e(s.parse(JSON.parse(a)));
          } catch (l) {
            i ? i(l) : console.error(l), s.manager.itemError(t);
          }
        }, r, i);
      }
    }, {
      key: "parse",
      value: function parse(t) {
        var e = {},
          r = {};
        function i(f, p) {
          if (e[p] !== void 0) return e[p];
          var g = f.interleavedBuffers[p],
            y = s(f, g.buffer),
            v = wg(g.type, y),
            x = new ly(v, g.stride);
          return x.uuid = g.uuid, e[p] = x, x;
        }
        function s(f, p) {
          if (r[p] !== void 0) return r[p];
          var g = f.arrayBuffers[p],
            y = new Uint32Array(g).buffer;
          return r[p] = y, y;
        }
        var o = t.isInstancedBufferGeometry ? new Sp() : new we(),
          a = t.data.index;
        if (a !== void 0) {
          var _f28 = wg(a.type, a.array);
          o.setIndex(new Ge(_f28, 1));
        }
        var l = t.data.attributes;
        for (var _f29 in l) {
          var _p21 = l[_f29],
            _m17 = void 0;
          if (_p21.isInterleavedBufferAttribute) {
            var _g11 = i(t.data, _p21.data);
            _m17 = new fc(_g11, _p21.itemSize, _p21.offset, _p21.normalized);
          } else {
            var _g12 = wg(_p21.type, _p21.array),
              _y13 = _p21.isInstancedBufferAttribute ? uo : Ge;
            _m17 = new _y13(_g12, _p21.itemSize, _p21.normalized);
          }
          _p21.name !== void 0 && (_m17.name = _p21.name), _p21.usage !== void 0 && _m17.setUsage(_p21.usage), _p21.updateRange !== void 0 && (_m17.updateRange.offset = _p21.updateRange.offset, _m17.updateRange.count = _p21.updateRange.count), o.setAttribute(_f29, _m17);
        }
        var u = t.data.morphAttributes;
        if (u) for (var _f30 in u) {
          var _p22 = u[_f30],
            _m18 = [];
          for (var _g13 = 0, _y14 = _p22.length; _g13 < _y14; _g13++) {
            var _v13 = _p22[_g13],
              x = void 0;
            if (_v13.isInterleavedBufferAttribute) {
              var S = i(t.data, _v13.data);
              x = new fc(S, _v13.itemSize, _v13.offset, _v13.normalized);
            } else {
              var _S13 = wg(_v13.type, _v13.array);
              x = new Ge(_S13, _v13.itemSize, _v13.normalized);
            }
            _v13.name !== void 0 && (x.name = _v13.name), _m18.push(x);
          }
          o.morphAttributes[_f30] = _m18;
        }
        t.data.morphTargetsRelative && (o.morphTargetsRelative = !0);
        var d = t.data.groups || t.data.drawcalls || t.data.offsets;
        if (d !== void 0) for (var _f31 = 0, _p23 = d.length; _f31 !== _p23; ++_f31) {
          var _m19 = d[_f31];
          o.addGroup(_m19.start, _m19.count, _m19.materialIndex);
        }
        var h = t.data.boundingSphere;
        if (h !== void 0) {
          var _f32 = new _();
          h.center !== void 0 && _f32.fromArray(h.center), o.boundingSphere = new Er(_f32, h.radius);
        }
        return t.name && (o.name = t.name), t.userData && (o.userData = t.userData), o;
      }
    }]);
    return qu;
  }(rl);
var by = /*#__PURE__*/function () {
  function by() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
    _classCallCheck(this, by);
    this.autoStart = t, this.startTime = 0, this.oldTime = 0, this.elapsedTime = 0, this.running = !1;
  }
  _createClass(by, [{
    key: "start",
    value: function start() {
      this.startTime = mM(), this.oldTime = this.startTime, this.elapsedTime = 0, this.running = !0;
    }
  }, {
    key: "stop",
    value: function stop() {
      this.getElapsedTime(), this.running = !1, this.autoStart = !1;
    }
  }, {
    key: "getElapsedTime",
    value: function getElapsedTime() {
      return this.getDelta(), this.elapsedTime;
    }
  }, {
    key: "getDelta",
    value: function getDelta() {
      var t = 0;
      if (this.autoStart && !this.running) return this.start(), 0;
      if (this.running) {
        var e = mM();
        t = (e - this.oldTime) / 1e3, this.oldTime = e, this.elapsedTime += t;
      }
      return t;
    }
  }]);
  return by;
}();
function mM() {
  return ((typeof performance === "undefined" ? "undefined" : _typeof(performance)) > "u" ? Date : performance).now();
}
var ew = /*#__PURE__*/function () {
    function ew(t, e, r) {
      _classCallCheck(this, ew);
      this.binding = t, this.valueSize = r;
      var i, s, o;
      switch (e) {
        case "quaternion":
          i = this._slerp, s = this._slerpAdditive, o = this._setAdditiveIdentityQuaternion, this.buffer = new Float64Array(r * 6), this._workIndex = 5;
          break;
        case "string":
        case "bool":
          i = this._select, s = this._select, o = this._setAdditiveIdentityOther, this.buffer = new Array(r * 5);
          break;
        default:
          i = this._lerp, s = this._lerpAdditive, o = this._setAdditiveIdentityNumeric, this.buffer = new Float64Array(r * 5);
      }
      this._mixBufferRegion = i, this._mixBufferRegionAdditive = s, this._setIdentity = o, this._origIndex = 3, this._addIndex = 4, this.cumulativeWeight = 0, this.cumulativeWeightAdditive = 0, this.useCount = 0, this.referenceCount = 0;
    }
    _createClass(ew, [{
      key: "accumulate",
      value: function accumulate(t, e) {
        var r = this.buffer,
          i = this.valueSize,
          s = t * i + i,
          o = this.cumulativeWeight;
        if (o === 0) {
          for (var a = 0; a !== i; ++a) r[s + a] = r[a];
          o = e;
        } else {
          o += e;
          var _a14 = e / o;
          this._mixBufferRegion(r, s, 0, _a14, i);
        }
        this.cumulativeWeight = o;
      }
    }, {
      key: "accumulateAdditive",
      value: function accumulateAdditive(t) {
        var e = this.buffer,
          r = this.valueSize,
          i = r * this._addIndex;
        this.cumulativeWeightAdditive === 0 && this._setIdentity(), this._mixBufferRegionAdditive(e, i, 0, t, r), this.cumulativeWeightAdditive += t;
      }
    }, {
      key: "apply",
      value: function apply(t) {
        var e = this.valueSize,
          r = this.buffer,
          i = t * e + e,
          s = this.cumulativeWeight,
          o = this.cumulativeWeightAdditive,
          a = this.binding;
        if (this.cumulativeWeight = 0, this.cumulativeWeightAdditive = 0, s < 1) {
          var _l21 = e * this._origIndex;
          this._mixBufferRegion(r, i, _l21, 1 - s, e);
        }
        o > 0 && this._mixBufferRegionAdditive(r, i, this._addIndex * e, 1, e);
        for (var _l22 = e, u = e + e; _l22 !== u; ++_l22) if (r[_l22] !== r[_l22 + e]) {
          a.setValue(r, i);
          break;
        }
      }
    }, {
      key: "saveOriginalState",
      value: function saveOriginalState() {
        var t = this.binding,
          e = this.buffer,
          r = this.valueSize,
          i = r * this._origIndex;
        t.getValue(e, i);
        for (var s = r, o = i; s !== o; ++s) e[s] = e[i + s % r];
        this._setIdentity(), this.cumulativeWeight = 0, this.cumulativeWeightAdditive = 0;
      }
    }, {
      key: "restoreOriginalState",
      value: function restoreOriginalState() {
        var t = this.valueSize * 3;
        this.binding.setValue(this.buffer, t);
      }
    }, {
      key: "_setAdditiveIdentityNumeric",
      value: function _setAdditiveIdentityNumeric() {
        var t = this._addIndex * this.valueSize,
          e = t + this.valueSize;
        for (var r = t; r < e; r++) this.buffer[r] = 0;
      }
    }, {
      key: "_setAdditiveIdentityQuaternion",
      value: function _setAdditiveIdentityQuaternion() {
        this._setAdditiveIdentityNumeric(), this.buffer[this._addIndex * this.valueSize + 3] = 1;
      }
    }, {
      key: "_setAdditiveIdentityOther",
      value: function _setAdditiveIdentityOther() {
        var t = this._origIndex * this.valueSize,
          e = this._addIndex * this.valueSize;
        for (var r = 0; r < this.valueSize; r++) this.buffer[e + r] = this.buffer[t + r];
      }
    }, {
      key: "_select",
      value: function _select(t, e, r, i, s) {
        if (i >= .5) for (var o = 0; o !== s; ++o) t[e + o] = t[r + o];
      }
    }, {
      key: "_slerp",
      value: function _slerp(t, e, r, i) {
        je.slerpFlat(t, e, t, e, t, r, i);
      }
    }, {
      key: "_slerpAdditive",
      value: function _slerpAdditive(t, e, r, i, s) {
        var o = this._workIndex * s;
        je.multiplyQuaternionsFlat(t, o, t, e, t, r), je.slerpFlat(t, e, t, e, t, o, i);
      }
    }, {
      key: "_lerp",
      value: function _lerp(t, e, r, i, s) {
        var o = 1 - i;
        for (var a = 0; a !== s; ++a) {
          var _l23 = e + a;
          t[_l23] = t[_l23] * o + t[r + a] * i;
        }
      }
    }, {
      key: "_lerpAdditive",
      value: function _lerpAdditive(t, e, r, i, s) {
        for (var o = 0; o !== s; ++o) {
          var a = e + o;
          t[a] = t[a] + t[r + o] * i;
        }
      }
    }]);
    return ew;
  }(),
  fw = "\\[\\]\\.:\\/",
  a4 = new RegExp("[" + fw + "]", "g"),
  pw = "[^" + fw + "]",
  l4 = "[^" + fw.replace("\\.", "") + "]",
  c4 = /((?:WC+[\/:])*)/.source.replace("WC", pw),
  u4 = /(WCOD+)?/.source.replace("WCOD", l4),
  d4 = /(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC", pw),
  h4 = /\.(WC+)(?:\[(.+)\])?/.source.replace("WC", pw),
  f4 = new RegExp("^" + c4 + u4 + d4 + h4 + "$"),
  p4 = ["material", "materials", "bones", "map"],
  tw = /*#__PURE__*/function () {
    function tw(t, e, r) {
      _classCallCheck(this, tw);
      var i = r || Ht.parseTrackName(e);
      this._targetGroup = t, this._bindings = t.subscribe_(e, i);
    }
    _createClass(tw, [{
      key: "getValue",
      value: function getValue(t, e) {
        this.bind();
        var r = this._targetGroup.nCachedObjects_,
          i = this._bindings[r];
        i !== void 0 && i.getValue(t, e);
      }
    }, {
      key: "setValue",
      value: function setValue(t, e) {
        var r = this._bindings;
        for (var i = this._targetGroup.nCachedObjects_, s = r.length; i !== s; ++i) r[i].setValue(t, e);
      }
    }, {
      key: "bind",
      value: function bind() {
        var t = this._bindings;
        for (var e = this._targetGroup.nCachedObjects_, r = t.length; e !== r; ++e) t[e].bind();
      }
    }, {
      key: "unbind",
      value: function unbind() {
        var t = this._bindings;
        for (var e = this._targetGroup.nCachedObjects_, r = t.length; e !== r; ++e) t[e].unbind();
      }
    }]);
    return tw;
  }(),
  Ht = /*#__PURE__*/function () {
    function Ht(t, e, r) {
      _classCallCheck(this, Ht);
      this.path = e, this.parsedPath = r || Ht.parseTrackName(e), this.node = Ht.findNode(t, this.parsedPath.nodeName) || t, this.rootNode = t, this.getValue = this._getValue_unbound, this.setValue = this._setValue_unbound;
    }
    _createClass(Ht, [{
      key: "_getValue_unavailable",
      value: function _getValue_unavailable() {}
    }, {
      key: "_setValue_unavailable",
      value: function _setValue_unavailable() {}
    }, {
      key: "_getValue_direct",
      value: function _getValue_direct(t, e) {
        t[e] = this.targetObject[this.propertyName];
      }
    }, {
      key: "_getValue_array",
      value: function _getValue_array(t, e) {
        var r = this.resolvedProperty;
        for (var i = 0, s = r.length; i !== s; ++i) t[e++] = r[i];
      }
    }, {
      key: "_getValue_arrayElement",
      value: function _getValue_arrayElement(t, e) {
        t[e] = this.resolvedProperty[this.propertyIndex];
      }
    }, {
      key: "_getValue_toArray",
      value: function _getValue_toArray(t, e) {
        this.resolvedProperty.toArray(t, e);
      }
    }, {
      key: "_setValue_direct",
      value: function _setValue_direct(t, e) {
        this.targetObject[this.propertyName] = t[e];
      }
    }, {
      key: "_setValue_direct_setNeedsUpdate",
      value: function _setValue_direct_setNeedsUpdate(t, e) {
        this.targetObject[this.propertyName] = t[e], this.targetObject.needsUpdate = !0;
      }
    }, {
      key: "_setValue_direct_setMatrixWorldNeedsUpdate",
      value: function _setValue_direct_setMatrixWorldNeedsUpdate(t, e) {
        this.targetObject[this.propertyName] = t[e], this.targetObject.matrixWorldNeedsUpdate = !0;
      }
    }, {
      key: "_setValue_array",
      value: function _setValue_array(t, e) {
        var r = this.resolvedProperty;
        for (var i = 0, s = r.length; i !== s; ++i) r[i] = t[e++];
      }
    }, {
      key: "_setValue_array_setNeedsUpdate",
      value: function _setValue_array_setNeedsUpdate(t, e) {
        var r = this.resolvedProperty;
        for (var i = 0, s = r.length; i !== s; ++i) r[i] = t[e++];
        this.targetObject.needsUpdate = !0;
      }
    }, {
      key: "_setValue_array_setMatrixWorldNeedsUpdate",
      value: function _setValue_array_setMatrixWorldNeedsUpdate(t, e) {
        var r = this.resolvedProperty;
        for (var i = 0, s = r.length; i !== s; ++i) r[i] = t[e++];
        this.targetObject.matrixWorldNeedsUpdate = !0;
      }
    }, {
      key: "_setValue_arrayElement",
      value: function _setValue_arrayElement(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e];
      }
    }, {
      key: "_setValue_arrayElement_setNeedsUpdate",
      value: function _setValue_arrayElement_setNeedsUpdate(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e], this.targetObject.needsUpdate = !0;
      }
    }, {
      key: "_setValue_arrayElement_setMatrixWorldNeedsUpdate",
      value: function _setValue_arrayElement_setMatrixWorldNeedsUpdate(t, e) {
        this.resolvedProperty[this.propertyIndex] = t[e], this.targetObject.matrixWorldNeedsUpdate = !0;
      }
    }, {
      key: "_setValue_fromArray",
      value: function _setValue_fromArray(t, e) {
        this.resolvedProperty.fromArray(t, e);
      }
    }, {
      key: "_setValue_fromArray_setNeedsUpdate",
      value: function _setValue_fromArray_setNeedsUpdate(t, e) {
        this.resolvedProperty.fromArray(t, e), this.targetObject.needsUpdate = !0;
      }
    }, {
      key: "_setValue_fromArray_setMatrixWorldNeedsUpdate",
      value: function _setValue_fromArray_setMatrixWorldNeedsUpdate(t, e) {
        this.resolvedProperty.fromArray(t, e), this.targetObject.matrixWorldNeedsUpdate = !0;
      }
    }, {
      key: "_getValue_unbound",
      value: function _getValue_unbound(t, e) {
        this.bind(), this.getValue(t, e);
      }
    }, {
      key: "_setValue_unbound",
      value: function _setValue_unbound(t, e) {
        this.bind(), this.setValue(t, e);
      }
    }, {
      key: "bind",
      value: function bind() {
        var t = this.node,
          e = this.parsedPath,
          r = e.objectName,
          i = e.propertyName,
          s = e.propertyIndex;
        if (t || (t = Ht.findNode(this.rootNode, e.nodeName) || this.rootNode, this.node = t), this.getValue = this._getValue_unavailable, this.setValue = this._setValue_unavailable, !t) {
          console.error("THREE.PropertyBinding: Trying to update node for track: " + this.path + " but it wasn't found.");
          return;
        }
        if (r) {
          var u = e.objectIndex;
          switch (r) {
            case "materials":
              if (!t.material) {
                console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.", this);
                return;
              }
              if (!t.material.materials) {
                console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.", this);
                return;
              }
              t = t.material.materials;
              break;
            case "bones":
              if (!t.skeleton) {
                console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.", this);
                return;
              }
              t = t.skeleton.bones;
              for (var c = 0; c < t.length; c++) if (t[c].name === u) {
                u = c;
                break;
              }
              break;
            case "map":
              if ("map" in t) {
                t = t.map;
                break;
              }
              if (!t.material) {
                console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.", this);
                return;
              }
              if (!t.material.map) {
                console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.", this);
                return;
              }
              t = t.material.map;
              break;
            default:
              if (t[r] === void 0) {
                console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.", this);
                return;
              }
              t = t[r];
          }
          if (u !== void 0) {
            if (t[u] === void 0) {
              console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.", this, t);
              return;
            }
            t = t[u];
          }
        }
        var o = t[i];
        if (o === void 0) {
          var _u12 = e.nodeName;
          console.error("THREE.PropertyBinding: Trying to update property for track: " + _u12 + "." + i + " but it wasn't found.", t);
          return;
        }
        var a = this.Versioning.None;
        this.targetObject = t, t.needsUpdate !== void 0 ? a = this.Versioning.NeedsUpdate : t.matrixWorldNeedsUpdate !== void 0 && (a = this.Versioning.MatrixWorldNeedsUpdate);
        var l = this.BindingType.Direct;
        if (s !== void 0) {
          if (i === "morphTargetInfluences") {
            if (!t.geometry) {
              console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.", this);
              return;
            }
            if (!t.geometry.morphAttributes) {
              console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.", this);
              return;
            }
            t.morphTargetDictionary[s] !== void 0 && (s = t.morphTargetDictionary[s]);
          }
          l = this.BindingType.ArrayElement, this.resolvedProperty = o, this.propertyIndex = s;
        } else o.fromArray !== void 0 && o.toArray !== void 0 ? (l = this.BindingType.HasFromToArray, this.resolvedProperty = o) : Array.isArray(o) ? (l = this.BindingType.EntireArray, this.resolvedProperty = o) : this.propertyName = i;
        this.getValue = this.GetterByBindingType[l], this.setValue = this.SetterByBindingTypeAndVersioning[l][a];
      }
    }, {
      key: "unbind",
      value: function unbind() {
        this.node = null, this.getValue = this._getValue_unbound, this.setValue = this._setValue_unbound;
      }
    }], [{
      key: "create",
      value: function create(t, e, r) {
        return t && t.isAnimationObjectGroup ? new Ht.Composite(t, e, r) : new Ht(t, e, r);
      }
    }, {
      key: "sanitizeNodeName",
      value: function sanitizeNodeName(t) {
        return t.replace(/\s/g, "_").replace(a4, "");
      }
    }, {
      key: "parseTrackName",
      value: function parseTrackName(t) {
        var e = f4.exec(t);
        if (e === null) throw new Error("PropertyBinding: Cannot parse trackName: " + t);
        var r = {
            nodeName: e[2],
            objectName: e[3],
            objectIndex: e[4],
            propertyName: e[5],
            propertyIndex: e[6]
          },
          i = r.nodeName && r.nodeName.lastIndexOf(".");
        if (i !== void 0 && i !== -1) {
          var s = r.nodeName.substring(i + 1);
          p4.indexOf(s) !== -1 && (r.nodeName = r.nodeName.substring(0, i), r.objectName = s);
        }
        if (r.propertyName === null || r.propertyName.length === 0) throw new Error("PropertyBinding: can not parse propertyName from trackName: " + t);
        return r;
      }
    }, {
      key: "findNode",
      value: function findNode(t, e) {
        if (e === void 0 || e === "" || e === "." || e === -1 || e === t.name || e === t.uuid) return t;
        if (t.skeleton) {
          var r = t.skeleton.getBoneByName(e);
          if (r !== void 0) return r;
        }
        if (t.children) {
          var _r5 = function _r5(s) {
              for (var o = 0; o < s.length; o++) {
                var a = s[o];
                if (a.name === e || a.uuid === e) return a;
                var _l24 = _r5(a.children);
                if (_l24) return _l24;
              }
              return null;
            },
            i = _r5(t.children);
          if (i) return i;
        }
        return null;
      }
    }]);
    return Ht;
  }();
Ht.Composite = tw;
Ht.prototype.BindingType = {
  Direct: 0,
  EntireArray: 1,
  ArrayElement: 2,
  HasFromToArray: 3
};
Ht.prototype.Versioning = {
  None: 0,
  NeedsUpdate: 1,
  MatrixWorldNeedsUpdate: 2
};
Ht.prototype.GetterByBindingType = [Ht.prototype._getValue_direct, Ht.prototype._getValue_array, Ht.prototype._getValue_arrayElement, Ht.prototype._getValue_toArray];
Ht.prototype.SetterByBindingTypeAndVersioning = [[Ht.prototype._setValue_direct, Ht.prototype._setValue_direct_setNeedsUpdate, Ht.prototype._setValue_direct_setMatrixWorldNeedsUpdate], [Ht.prototype._setValue_array, Ht.prototype._setValue_array_setNeedsUpdate, Ht.prototype._setValue_array_setMatrixWorldNeedsUpdate], [Ht.prototype._setValue_arrayElement, Ht.prototype._setValue_arrayElement_setNeedsUpdate, Ht.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate], [Ht.prototype._setValue_fromArray, Ht.prototype._setValue_fromArray_setNeedsUpdate, Ht.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];
var rw = /*#__PURE__*/function () {
    function rw(t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : e.blendMode;
      _classCallCheck(this, rw);
      this._mixer = t, this._clip = e, this._localRoot = r, this.blendMode = i;
      var s = e.tracks,
        o = s.length,
        a = new Array(o),
        l = {
          endingStart: _u,
          endingEnd: _u
        };
      for (var u = 0; u !== o; ++u) {
        var c = s[u].createInterpolant(null);
        a[u] = c, c.settings = l;
      }
      this._interpolantSettings = l, this._interpolants = a, this._propertyBindings = new Array(o), this._cacheIndex = null, this._byClipCacheIndex = null, this._timeScaleInterpolant = null, this._weightInterpolant = null, this.loop = ow, this._loopCount = -1, this._startTime = null, this.time = 0, this.timeScale = 1, this._effectiveTimeScale = 1, this.weight = 1, this._effectiveWeight = 1, this.repetitions = 1 / 0, this.paused = !1, this.enabled = !0, this.clampWhenFinished = !1, this.zeroSlopeAtStart = !0, this.zeroSlopeAtEnd = !0;
    }
    _createClass(rw, [{
      key: "play",
      value: function play() {
        return this._mixer._activateAction(this), this;
      }
    }, {
      key: "stop",
      value: function stop() {
        return this._mixer._deactivateAction(this), this.reset();
      }
    }, {
      key: "reset",
      value: function reset() {
        return this.paused = !1, this.enabled = !0, this.time = 0, this._loopCount = -1, this._startTime = null, this.stopFading().stopWarping();
      }
    }, {
      key: "isRunning",
      value: function isRunning() {
        return this.enabled && !this.paused && this.timeScale !== 0 && this._startTime === null && this._mixer._isActiveAction(this);
      }
    }, {
      key: "isScheduled",
      value: function isScheduled() {
        return this._mixer._isActiveAction(this);
      }
    }, {
      key: "startAt",
      value: function startAt(t) {
        return this._startTime = t, this;
      }
    }, {
      key: "setLoop",
      value: function setLoop(t, e) {
        return this.loop = t, this.repetitions = e, this;
      }
    }, {
      key: "setEffectiveWeight",
      value: function setEffectiveWeight(t) {
        return this.weight = t, this._effectiveWeight = this.enabled ? t : 0, this.stopFading();
      }
    }, {
      key: "getEffectiveWeight",
      value: function getEffectiveWeight() {
        return this._effectiveWeight;
      }
    }, {
      key: "fadeIn",
      value: function fadeIn(t) {
        return this._scheduleFading(t, 0, 1);
      }
    }, {
      key: "fadeOut",
      value: function fadeOut(t) {
        return this._scheduleFading(t, 1, 0);
      }
    }, {
      key: "crossFadeFrom",
      value: function crossFadeFrom(t, e, r) {
        if (t.fadeOut(e), this.fadeIn(e), r) {
          var i = this._clip.duration,
            s = t._clip.duration,
            o = s / i,
            a = i / s;
          t.warp(1, o, e), this.warp(a, 1, e);
        }
        return this;
      }
    }, {
      key: "crossFadeTo",
      value: function crossFadeTo(t, e, r) {
        return t.crossFadeFrom(this, e, r);
      }
    }, {
      key: "stopFading",
      value: function stopFading() {
        var t = this._weightInterpolant;
        return t !== null && (this._weightInterpolant = null, this._mixer._takeBackControlInterpolant(t)), this;
      }
    }, {
      key: "setEffectiveTimeScale",
      value: function setEffectiveTimeScale(t) {
        return this.timeScale = t, this._effectiveTimeScale = this.paused ? 0 : t, this.stopWarping();
      }
    }, {
      key: "getEffectiveTimeScale",
      value: function getEffectiveTimeScale() {
        return this._effectiveTimeScale;
      }
    }, {
      key: "setDuration",
      value: function setDuration(t) {
        return this.timeScale = this._clip.duration / t, this.stopWarping();
      }
    }, {
      key: "syncWith",
      value: function syncWith(t) {
        return this.time = t.time, this.timeScale = t.timeScale, this.stopWarping();
      }
    }, {
      key: "halt",
      value: function halt(t) {
        return this.warp(this._effectiveTimeScale, 0, t);
      }
    }, {
      key: "warp",
      value: function warp(t, e, r) {
        var i = this._mixer,
          s = i.time,
          o = this.timeScale,
          a = this._timeScaleInterpolant;
        a === null && (a = i._lendControlInterpolant(), this._timeScaleInterpolant = a);
        var l = a.parameterPositions,
          u = a.sampleValues;
        return l[0] = s, l[1] = s + r, u[0] = t / o, u[1] = e / o, this;
      }
    }, {
      key: "stopWarping",
      value: function stopWarping() {
        var t = this._timeScaleInterpolant;
        return t !== null && (this._timeScaleInterpolant = null, this._mixer._takeBackControlInterpolant(t)), this;
      }
    }, {
      key: "getMixer",
      value: function getMixer() {
        return this._mixer;
      }
    }, {
      key: "getClip",
      value: function getClip() {
        return this._clip;
      }
    }, {
      key: "getRoot",
      value: function getRoot() {
        return this._localRoot || this._mixer._root;
      }
    }, {
      key: "_update",
      value: function _update(t, e, r, i) {
        if (!this.enabled) {
          this._updateWeight(t);
          return;
        }
        var s = this._startTime;
        if (s !== null) {
          var _l25 = (t - s) * r;
          _l25 < 0 || r === 0 ? e = 0 : (this._startTime = null, e = r * _l25);
        }
        e *= this._updateTimeScale(t);
        var o = this._updateTime(e),
          a = this._updateWeight(t);
        if (a > 0) {
          var _l26 = this._interpolants,
            u = this._propertyBindings;
          switch (this.blendMode) {
            case CF:
              for (var c = 0, _d15 = _l26.length; c !== _d15; ++c) _l26[c].evaluate(o), u[c].accumulateAdditive(a);
              break;
            case aw:
            default:
              for (var _c6 = 0, _d16 = _l26.length; _c6 !== _d16; ++_c6) _l26[_c6].evaluate(o), u[_c6].accumulate(i, a);
          }
        }
      }
    }, {
      key: "_updateWeight",
      value: function _updateWeight(t) {
        var e = 0;
        if (this.enabled) {
          e = this.weight;
          var r = this._weightInterpolant;
          if (r !== null) {
            var i = r.evaluate(t)[0];
            e *= i, t > r.parameterPositions[1] && (this.stopFading(), i === 0 && (this.enabled = !1));
          }
        }
        return this._effectiveWeight = e, e;
      }
    }, {
      key: "_updateTimeScale",
      value: function _updateTimeScale(t) {
        var e = 0;
        if (!this.paused) {
          e = this.timeScale;
          var r = this._timeScaleInterpolant;
          if (r !== null) {
            var i = r.evaluate(t)[0];
            e *= i, t > r.parameterPositions[1] && (this.stopWarping(), e === 0 ? this.paused = !0 : this.timeScale = e);
          }
        }
        return this._effectiveTimeScale = e, e;
      }
    }, {
      key: "_updateTime",
      value: function _updateTime(t) {
        var e = this._clip.duration,
          r = this.loop,
          i = this.time + t,
          s = this._loopCount,
          o = r === Ap;
        if (t === 0) return s === -1 ? i : o && (s & 1) === 1 ? e - i : i;
        if (r === sw) {
          s === -1 && (this._loopCount = 0, this._setEndings(!0, !0, !1));
          e: {
            if (i >= e) i = e;else if (i < 0) i = 0;else {
              this.time = i;
              break e;
            }
            this.clampWhenFinished ? this.paused = !0 : this.enabled = !1, this.time = i, this._mixer.dispatchEvent({
              type: "finished",
              action: this,
              direction: t < 0 ? -1 : 1
            });
          }
        } else {
          if (s === -1 && (t >= 0 ? (s = 0, this._setEndings(!0, this.repetitions === 0, o)) : this._setEndings(this.repetitions === 0, !0, o)), i >= e || i < 0) {
            var a = Math.floor(i / e);
            i -= e * a, s += Math.abs(a);
            var _l27 = this.repetitions - s;
            if (_l27 <= 0) this.clampWhenFinished ? this.paused = !0 : this.enabled = !1, i = t > 0 ? e : 0, this.time = i, this._mixer.dispatchEvent({
              type: "finished",
              action: this,
              direction: t > 0 ? 1 : -1
            });else {
              if (_l27 === 1) {
                var u = t < 0;
                this._setEndings(u, !u, o);
              } else this._setEndings(!1, !1, o);
              this._loopCount = s, this.time = i, this._mixer.dispatchEvent({
                type: "loop",
                action: this,
                loopDelta: a
              });
            }
          } else this.time = i;
          if (o && (s & 1) === 1) return e - i;
        }
        return i;
      }
    }, {
      key: "_setEndings",
      value: function _setEndings(t, e, r) {
        var i = this._interpolantSettings;
        r ? (i.endingStart = Eu, i.endingEnd = Eu) : (t ? i.endingStart = this.zeroSlopeAtStart ? Eu : _u : i.endingStart = $g, e ? i.endingEnd = this.zeroSlopeAtEnd ? Eu : _u : i.endingEnd = $g);
      }
    }, {
      key: "_scheduleFading",
      value: function _scheduleFading(t, e, r) {
        var i = this._mixer,
          s = i.time,
          o = this._weightInterpolant;
        o === null && (o = i._lendControlInterpolant(), this._weightInterpolant = o);
        var a = o.parameterPositions,
          l = o.sampleValues;
        return a[0] = s, l[0] = e, a[1] = s + t, l[1] = r, this;
      }
    }]);
    return rw;
  }(),
  m4 = new Float32Array(1),
  Sy = /*#__PURE__*/function (_ir7) {
    _inherits(Sy, _ir7);
    var _super86 = _createSuper(Sy);
    function Sy(t) {
      var _this70;
      _classCallCheck(this, Sy);
      _this70 = _super86.call(this), _this70._root = t, _this70._initMemoryManager(), _this70._accuIndex = 0, _this70.time = 0, _this70.timeScale = 1;
      return _this70;
    }
    _createClass(Sy, [{
      key: "_bindAction",
      value: function _bindAction(t, e) {
        var r = t._localRoot || this._root,
          i = t._clip.tracks,
          s = i.length,
          o = t._propertyBindings,
          a = t._interpolants,
          l = r.uuid,
          u = this._bindingsByRootAndName,
          c = u[l];
        c === void 0 && (c = {}, u[l] = c);
        for (var _d17 = 0; _d17 !== s; ++_d17) {
          var _h20 = i[_d17],
            _f33 = _h20.name,
            _p24 = c[_f33];
          if (_p24 !== void 0) ++_p24.referenceCount, o[_d17] = _p24;else {
            if (_p24 = o[_d17], _p24 !== void 0) {
              _p24._cacheIndex === null && (++_p24.referenceCount, this._addInactiveBinding(_p24, l, _f33));
              continue;
            }
            var _m20 = e && e._propertyBindings[_d17].binding.parsedPath;
            _p24 = new ew(Ht.create(r, _f33, _m20), _h20.ValueTypeName, _h20.getValueSize()), ++_p24.referenceCount, this._addInactiveBinding(_p24, l, _f33), o[_d17] = _p24;
          }
          a[_d17].resultBuffer = _p24.buffer;
        }
      }
    }, {
      key: "_activateAction",
      value: function _activateAction(t) {
        if (!this._isActiveAction(t)) {
          if (t._cacheIndex === null) {
            var r = (t._localRoot || this._root).uuid,
              i = t._clip.uuid,
              s = this._actionsByClip[i];
            this._bindAction(t, s && s.knownActions[0]), this._addInactiveAction(t, i, r);
          }
          var _e5 = t._propertyBindings;
          for (var _r6 = 0, _i4 = _e5.length; _r6 !== _i4; ++_r6) {
            var _s6 = _e5[_r6];
            _s6.useCount++ === 0 && (this._lendBinding(_s6), _s6.saveOriginalState());
          }
          this._lendAction(t);
        }
      }
    }, {
      key: "_deactivateAction",
      value: function _deactivateAction(t) {
        if (this._isActiveAction(t)) {
          var _e6 = t._propertyBindings;
          for (var r = 0, i = _e6.length; r !== i; ++r) {
            var s = _e6[r];
            --s.useCount === 0 && (s.restoreOriginalState(), this._takeBackBinding(s));
          }
          this._takeBackAction(t);
        }
      }
    }, {
      key: "_initMemoryManager",
      value: function _initMemoryManager() {
        this._actions = [], this._nActiveActions = 0, this._actionsByClip = {}, this._bindings = [], this._nActiveBindings = 0, this._bindingsByRootAndName = {}, this._controlInterpolants = [], this._nActiveControlInterpolants = 0;
        var t = this;
        this.stats = {
          actions: {
            get total() {
              return t._actions.length;
            },
            get inUse() {
              return t._nActiveActions;
            }
          },
          bindings: {
            get total() {
              return t._bindings.length;
            },
            get inUse() {
              return t._nActiveBindings;
            }
          },
          controlInterpolants: {
            get total() {
              return t._controlInterpolants.length;
            },
            get inUse() {
              return t._nActiveControlInterpolants;
            }
          }
        };
      }
    }, {
      key: "_isActiveAction",
      value: function _isActiveAction(t) {
        var e = t._cacheIndex;
        return e !== null && e < this._nActiveActions;
      }
    }, {
      key: "_addInactiveAction",
      value: function _addInactiveAction(t, e, r) {
        var i = this._actions,
          s = this._actionsByClip,
          o = s[e];
        if (o === void 0) o = {
          knownActions: [t],
          actionByRoot: {}
        }, t._byClipCacheIndex = 0, s[e] = o;else {
          var a = o.knownActions;
          t._byClipCacheIndex = a.length, a.push(t);
        }
        t._cacheIndex = i.length, i.push(t), o.actionByRoot[r] = t;
      }
    }, {
      key: "_removeInactiveAction",
      value: function _removeInactiveAction(t) {
        var e = this._actions,
          r = e[e.length - 1],
          i = t._cacheIndex;
        r._cacheIndex = i, e[i] = r, e.pop(), t._cacheIndex = null;
        var s = t._clip.uuid,
          o = this._actionsByClip,
          a = o[s],
          l = a.knownActions,
          u = l[l.length - 1],
          c = t._byClipCacheIndex;
        u._byClipCacheIndex = c, l[c] = u, l.pop(), t._byClipCacheIndex = null;
        var d = a.actionByRoot,
          h = (t._localRoot || this._root).uuid;
        delete d[h], l.length === 0 && delete o[s], this._removeInactiveBindingsForAction(t);
      }
    }, {
      key: "_removeInactiveBindingsForAction",
      value: function _removeInactiveBindingsForAction(t) {
        var e = t._propertyBindings;
        for (var r = 0, i = e.length; r !== i; ++r) {
          var s = e[r];
          --s.referenceCount === 0 && this._removeInactiveBinding(s);
        }
      }
    }, {
      key: "_lendAction",
      value: function _lendAction(t) {
        var e = this._actions,
          r = t._cacheIndex,
          i = this._nActiveActions++,
          s = e[i];
        t._cacheIndex = i, e[i] = t, s._cacheIndex = r, e[r] = s;
      }
    }, {
      key: "_takeBackAction",
      value: function _takeBackAction(t) {
        var e = this._actions,
          r = t._cacheIndex,
          i = --this._nActiveActions,
          s = e[i];
        t._cacheIndex = i, e[i] = t, s._cacheIndex = r, e[r] = s;
      }
    }, {
      key: "_addInactiveBinding",
      value: function _addInactiveBinding(t, e, r) {
        var i = this._bindingsByRootAndName,
          s = this._bindings,
          o = i[e];
        o === void 0 && (o = {}, i[e] = o), o[r] = t, t._cacheIndex = s.length, s.push(t);
      }
    }, {
      key: "_removeInactiveBinding",
      value: function _removeInactiveBinding(t) {
        var e = this._bindings,
          r = t.binding,
          i = r.rootNode.uuid,
          s = r.path,
          o = this._bindingsByRootAndName,
          a = o[i],
          l = e[e.length - 1],
          u = t._cacheIndex;
        l._cacheIndex = u, e[u] = l, e.pop(), delete a[s], Object.keys(a).length === 0 && delete o[i];
      }
    }, {
      key: "_lendBinding",
      value: function _lendBinding(t) {
        var e = this._bindings,
          r = t._cacheIndex,
          i = this._nActiveBindings++,
          s = e[i];
        t._cacheIndex = i, e[i] = t, s._cacheIndex = r, e[r] = s;
      }
    }, {
      key: "_takeBackBinding",
      value: function _takeBackBinding(t) {
        var e = this._bindings,
          r = t._cacheIndex,
          i = --this._nActiveBindings,
          s = e[i];
        t._cacheIndex = i, e[i] = t, s._cacheIndex = r, e[r] = s;
      }
    }, {
      key: "_lendControlInterpolant",
      value: function _lendControlInterpolant() {
        var t = this._controlInterpolants,
          e = this._nActiveControlInterpolants++,
          r = t[e];
        return r === void 0 && (r = new hy(new Float32Array(2), new Float32Array(2), 1, m4), r.__cacheIndex = e, t[e] = r), r;
      }
    }, {
      key: "_takeBackControlInterpolant",
      value: function _takeBackControlInterpolant(t) {
        var e = this._controlInterpolants,
          r = t.__cacheIndex,
          i = --this._nActiveControlInterpolants,
          s = e[i];
        t.__cacheIndex = i, e[i] = t, s.__cacheIndex = r, e[r] = s;
      }
    }, {
      key: "clipAction",
      value: function clipAction(t, e, r) {
        var i = e || this._root,
          s = i.uuid,
          o = typeof t == "string" ? Hu.findByName(i, t) : t,
          a = o !== null ? o.uuid : t,
          l = this._actionsByClip[a],
          u = null;
        if (r === void 0 && (o !== null ? r = o.blendMode : r = aw), l !== void 0) {
          var _d18 = l.actionByRoot[s];
          if (_d18 !== void 0 && _d18.blendMode === r) return _d18;
          u = l.knownActions[0], o === null && (o = u._clip);
        }
        if (o === null) return null;
        var c = new rw(this, o, e, r);
        return this._bindAction(c, u), this._addInactiveAction(c, a, s), c;
      }
    }, {
      key: "existingAction",
      value: function existingAction(t, e) {
        var r = e || this._root,
          i = r.uuid,
          s = typeof t == "string" ? Hu.findByName(r, t) : t,
          o = s ? s.uuid : t,
          a = this._actionsByClip[o];
        return a !== void 0 && a.actionByRoot[i] || null;
      }
    }, {
      key: "stopAllAction",
      value: function stopAllAction() {
        var t = this._actions,
          e = this._nActiveActions;
        for (var r = e - 1; r >= 0; --r) t[r].stop();
        return this;
      }
    }, {
      key: "update",
      value: function update(t) {
        t *= this.timeScale;
        var e = this._actions,
          r = this._nActiveActions,
          i = this.time += t,
          s = Math.sign(t),
          o = this._accuIndex ^= 1;
        for (var u = 0; u !== r; ++u) e[u]._update(i, t, s, o);
        var a = this._bindings,
          l = this._nActiveBindings;
        for (var _u13 = 0; _u13 !== l; ++_u13) a[_u13].apply(o);
        return this;
      }
    }, {
      key: "setTime",
      value: function setTime(t) {
        this.time = 0;
        for (var _e7 = 0; _e7 < this._actions.length; _e7++) this._actions[_e7].time = 0;
        return this.update(t);
      }
    }, {
      key: "getRoot",
      value: function getRoot() {
        return this._root;
      }
    }, {
      key: "uncacheClip",
      value: function uncacheClip(t) {
        var e = this._actions,
          r = t.uuid,
          i = this._actionsByClip,
          s = i[r];
        if (s !== void 0) {
          var o = s.knownActions;
          for (var a = 0, _l28 = o.length; a !== _l28; ++a) {
            var u = o[a];
            this._deactivateAction(u);
            var c = u._cacheIndex,
              _d19 = e[e.length - 1];
            u._cacheIndex = null, u._byClipCacheIndex = null, _d19._cacheIndex = c, e[c] = _d19, e.pop(), this._removeInactiveBindingsForAction(u);
          }
          delete i[r];
        }
      }
    }, {
      key: "uncacheRoot",
      value: function uncacheRoot(t) {
        var e = t.uuid,
          r = this._actionsByClip;
        for (var o in r) {
          var a = r[o].actionByRoot,
            _l29 = a[e];
          _l29 !== void 0 && (this._deactivateAction(_l29), this._removeInactiveAction(_l29));
        }
        var i = this._bindingsByRootAndName,
          s = i[e];
        if (s !== void 0) for (var _o6 in s) {
          var _a15 = s[_o6];
          _a15.restoreOriginalState(), this._removeInactiveBinding(_a15);
        }
      }
    }, {
      key: "uncacheAction",
      value: function uncacheAction(t, e) {
        var r = this.existingAction(t, e);
        r !== null && (this._deactivateAction(r), this._removeInactiveAction(r));
      }
    }]);
    return Sy;
  }(ir),
  se = /*#__PURE__*/function () {
    function se(t) {
      _classCallCheck(this, se);
      this.value = t;
    }
    _createClass(se, [{
      key: "clone",
      value: function clone() {
        return new se(this.value.clone === void 0 ? this.value : this.value.clone());
      }
    }]);
    return se;
  }();
var Yu = /*#__PURE__*/function () {
  function Yu(t, e) {
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1 / 0;
    _classCallCheck(this, Yu);
    this.ray = new Rs(t, e), this.near = r, this.far = i, this.camera = null, this.layers = new up(), this.params = {
      Mesh: {},
      Line: {
        threshold: 1
      },
      LOD: {},
      Points: {
        threshold: 1
      },
      Sprite: {}
    };
  }
  _createClass(Yu, [{
    key: "set",
    value: function set(t, e) {
      this.ray.set(t, e);
    }
  }, {
    key: "setFromCamera",
    value: function setFromCamera(t, e) {
      e.isPerspectiveCamera ? (this.ray.origin.setFromMatrixPosition(e.matrixWorld), this.ray.direction.set(t.x, t.y, .5).unproject(e).sub(this.ray.origin).normalize(), this.camera = e) : e.isOrthographicCamera ? (this.ray.origin.set(t.x, t.y, (e.near + e.far) / (e.near - e.far)).unproject(e), this.ray.direction.set(0, 0, -1).transformDirection(e.matrixWorld), this.camera = e) : console.error("THREE.Raycaster: Unsupported camera type: " + e.type);
    }
  }, {
    key: "intersectObject",
    value: function intersectObject(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      return iw(t, this, r, e), r.sort(gM), r;
    }
  }, {
    key: "intersectObjects",
    value: function intersectObjects(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      for (var i = 0, s = t.length; i < s; i++) iw(t[i], this, r, e);
      return r.sort(gM), r;
    }
  }]);
  return Yu;
}();
function gM(n, t) {
  return n.distance - t.distance;
}
function iw(n, t, e, r) {
  if (n.layers.test(t.layers) && n.raycast(t, e), r === !0) {
    var i = n.children;
    for (var s = 0, o = i.length; s < o; s++) iw(i[s], t, e, !0);
  }
}
var wp = /*#__PURE__*/function () {
  function wp() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    _classCallCheck(this, wp);
    return this.radius = t, this.phi = e, this.theta = r, this;
  }
  _createClass(wp, [{
    key: "set",
    value: function set(t, e, r) {
      return this.radius = t, this.phi = e, this.theta = r, this;
    }
  }, {
    key: "copy",
    value: function copy(t) {
      return this.radius = t.radius, this.phi = t.phi, this.theta = t.theta, this;
    }
  }, {
    key: "makeSafe",
    value: function makeSafe() {
      return this.phi = Math.max(1e-6, Math.min(Math.PI - 1e-6, this.phi)), this;
    }
  }, {
    key: "setFromVector3",
    value: function setFromVector3(t) {
      return this.setFromCartesianCoords(t.x, t.y, t.z);
    }
  }, {
    key: "setFromCartesianCoords",
    value: function setFromCartesianCoords(t, e, r) {
      return this.radius = Math.sqrt(t * t + e * e + r * r), this.radius === 0 ? (this.theta = 0, this.phi = 0) : (this.theta = Math.atan2(t, r), this.phi = Math.acos(oi(e / this.radius, -1, 1))), this;
    }
  }, {
    key: "clone",
    value: function clone() {
      return new this.constructor().copy(this);
    }
  }]);
  return wp;
}();
var yM = new N(),
  Xu = /*#__PURE__*/function () {
    function Xu() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N(1 / 0, 1 / 0);
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N(-1 / 0, -1 / 0);
      _classCallCheck(this, Xu);
      this.isBox2 = !0, this.min = t, this.max = e;
    }
    _createClass(Xu, [{
      key: "set",
      value: function set(t, e) {
        return this.min.copy(t), this.max.copy(e), this;
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t) {
        this.makeEmpty();
        for (var _e8 = 0, r = t.length; _e8 < r; _e8++) this.expandByPoint(t[_e8]);
        return this;
      }
    }, {
      key: "setFromCenterAndSize",
      value: function setFromCenterAndSize(t, e) {
        var r = yM.copy(e).multiplyScalar(.5);
        return this.min.copy(t).sub(r), this.max.copy(t).add(r), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.min.copy(t.min), this.max.copy(t.max), this;
      }
    }, {
      key: "makeEmpty",
      value: function makeEmpty() {
        return this.min.x = this.min.y = 1 / 0, this.max.x = this.max.y = -1 / 0, this;
      }
    }, {
      key: "isEmpty",
      value: function isEmpty() {
        return this.max.x < this.min.x || this.max.y < this.min.y;
      }
    }, {
      key: "getCenter",
      value: function getCenter(t) {
        return this.isEmpty() ? t.set(0, 0) : t.addVectors(this.min, this.max).multiplyScalar(.5);
      }
    }, {
      key: "getSize",
      value: function getSize(t) {
        return this.isEmpty() ? t.set(0, 0) : t.subVectors(this.max, this.min);
      }
    }, {
      key: "expandByPoint",
      value: function expandByPoint(t) {
        return this.min.min(t), this.max.max(t), this;
      }
    }, {
      key: "expandByVector",
      value: function expandByVector(t) {
        return this.min.sub(t), this.max.add(t), this;
      }
    }, {
      key: "expandByScalar",
      value: function expandByScalar(t) {
        return this.min.addScalar(-t), this.max.addScalar(t), this;
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        return !(t.x < this.min.x || t.x > this.max.x || t.y < this.min.y || t.y > this.max.y);
      }
    }, {
      key: "containsBox",
      value: function containsBox(t) {
        return this.min.x <= t.min.x && t.max.x <= this.max.x && this.min.y <= t.min.y && t.max.y <= this.max.y;
      }
    }, {
      key: "getParameter",
      value: function getParameter(t, e) {
        return e.set((t.x - this.min.x) / (this.max.x - this.min.x), (t.y - this.min.y) / (this.max.y - this.min.y));
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t) {
        return !(t.max.x < this.min.x || t.min.x > this.max.x || t.max.y < this.min.y || t.min.y > this.max.y);
      }
    }, {
      key: "clampPoint",
      value: function clampPoint(t, e) {
        return e.copy(t).clamp(this.min, this.max);
      }
    }, {
      key: "distanceToPoint",
      value: function distanceToPoint(t) {
        return yM.copy(t).clamp(this.min, this.max).sub(t).length();
      }
    }, {
      key: "intersect",
      value: function intersect(t) {
        return this.min.max(t.min), this.max.min(t.max), this;
      }
    }, {
      key: "union",
      value: function union(t) {
        return this.min.min(t.min), this.max.max(t.max), this;
      }
    }, {
      key: "translate",
      value: function translate(t) {
        return this.min.add(t), this.max.add(t), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.min.equals(this.min) && t.max.equals(this.max);
      }
    }]);
    return Xu;
  }(),
  vM = new _(),
  Yg = new _(),
  xi = /*#__PURE__*/function () {
    function xi() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new _();
      _classCallCheck(this, xi);
      this.start = t, this.end = e;
    }
    _createClass(xi, [{
      key: "set",
      value: function set(t, e) {
        return this.start.copy(t), this.end.copy(e), this;
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.start.copy(t.start), this.end.copy(t.end), this;
      }
    }, {
      key: "getCenter",
      value: function getCenter(t) {
        return t.addVectors(this.start, this.end).multiplyScalar(.5);
      }
    }, {
      key: "delta",
      value: function delta(t) {
        return t.subVectors(this.end, this.start);
      }
    }, {
      key: "distanceSq",
      value: function distanceSq() {
        return this.start.distanceToSquared(this.end);
      }
    }, {
      key: "distance",
      value: function distance() {
        return this.start.distanceTo(this.end);
      }
    }, {
      key: "at",
      value: function at(t, e) {
        return this.delta(e).multiplyScalar(t).add(this.start);
      }
    }, {
      key: "closestPointToPointParameter",
      value: function closestPointToPointParameter(t, e) {
        vM.subVectors(t, this.start), Yg.subVectors(this.end, this.start);
        var r = Yg.dot(Yg),
          s = Yg.dot(vM) / r;
        return e && (s = oi(s, 0, 1)), s;
      }
    }, {
      key: "closestPointToPoint",
      value: function closestPointToPoint(t, e, r) {
        var i = this.closestPointToPointParameter(t, e);
        return this.delta(r).multiplyScalar(i).add(this.start);
      }
    }, {
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        return this.start.applyMatrix4(t), this.end.applyMatrix4(t), this;
      }
    }, {
      key: "equals",
      value: function equals(t) {
        return t.start.equals(this.start) && t.end.equals(this.end);
      }
    }, {
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }]);
    return xi;
  }(),
  xM = new _(),
  wy = /*#__PURE__*/function (_mt9) {
    _inherits(wy, _mt9);
    var _super87 = _createSuper(wy);
    function wy(t, e) {
      var _this71;
      _classCallCheck(this, wy);
      _this71 = _super87.call(this), _this71.light = t, _this71.matrix = t.matrixWorld, _this71.matrixAutoUpdate = !1, _this71.color = e, _this71.type = "SpotLightHelper";
      var r = new we(),
        i = [0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, -1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, -1, 1];
      for (var o = 0, a = 1, _l30 = 32; o < _l30; o++, a++) {
        var u = o / _l30 * Math.PI * 2,
          c = a / _l30 * Math.PI * 2;
        i.push(Math.cos(u), Math.sin(u), 1, Math.cos(c), Math.sin(c), 1);
      }
      r.setAttribute("position", new be(i, 3));
      var s = new ns({
        fog: !1,
        toneMapped: !1
      });
      _this71.cone = new Ja(r, s), _this71.add(_this71.cone), _this71.update();
      return _this71;
    }
    _createClass(wy, [{
      key: "dispose",
      value: function dispose() {
        this.cone.geometry.dispose(), this.cone.material.dispose();
      }
    }, {
      key: "update",
      value: function update() {
        this.light.updateWorldMatrix(!0, !1), this.light.target.updateWorldMatrix(!0, !1);
        var t = this.light.distance ? this.light.distance : 1e3,
          e = t * Math.tan(this.light.angle);
        this.cone.scale.set(e, e, t), xM.setFromMatrixPosition(this.light.target.matrixWorld), this.cone.lookAt(xM), this.color !== void 0 ? this.cone.material.color.set(this.color) : this.cone.material.color.copy(this.light.color);
      }
    }]);
    return wy;
  }(mt);
var Ay = /*#__PURE__*/function (_rr2) {
  _inherits(Ay, _rr2);
  var _super88 = _createSuper(Ay);
  function Ay(t, e, r) {
    var _this72;
    _classCallCheck(this, Ay);
    var i = new Bs(e, 4, 2),
      s = new Ls({
        wireframe: !0,
        fog: !1,
        toneMapped: !1
      });
    _this72 = _super88.call(this, i, s), _this72.light = t, _this72.color = r, _this72.type = "PointLightHelper", _this72.matrix = _this72.light.matrixWorld, _this72.matrixAutoUpdate = !1, _this72.update();
    return _this72;
  }
  _createClass(Ay, [{
    key: "dispose",
    value: function dispose() {
      this.geometry.dispose(), this.material.dispose();
    }
  }, {
    key: "update",
    value: function update() {
      this.light.updateWorldMatrix(!0, !1), this.color !== void 0 ? this.material.color.set(this.color) : this.material.color.copy(this.light.color);
    }
  }]);
  return Ay;
}(rr);
var bM = new _(),
  Xg = new _(),
  SM = new _(),
  _y = /*#__PURE__*/function (_mt10) {
    _inherits(_y, _mt10);
    var _super89 = _createSuper(_y);
    function _y(t, e, r) {
      var _this73;
      _classCallCheck(this, _y);
      _this73 = _super89.call(this), _this73.light = t, _this73.matrix = t.matrixWorld, _this73.matrixAutoUpdate = !1, _this73.color = r, _this73.type = "DirectionalLightHelper", e === void 0 && (e = 1);
      var i = new we();
      i.setAttribute("position", new be([-e, e, 0, e, e, 0, e, -e, 0, -e, -e, 0, -e, e, 0], 3));
      var s = new ns({
        fog: !1,
        toneMapped: !1
      });
      _this73.lightPlane = new pc(i, s), _this73.add(_this73.lightPlane), i = new we(), i.setAttribute("position", new be([0, 0, 0, 0, 0, 1], 3)), _this73.targetLine = new pc(i, s), _this73.add(_this73.targetLine), _this73.update();
      return _this73;
    }
    _createClass(_y, [{
      key: "dispose",
      value: function dispose() {
        this.lightPlane.geometry.dispose(), this.lightPlane.material.dispose(), this.targetLine.geometry.dispose(), this.targetLine.material.dispose();
      }
    }, {
      key: "update",
      value: function update() {
        this.light.updateWorldMatrix(!0, !1), this.light.target.updateWorldMatrix(!0, !1), bM.setFromMatrixPosition(this.light.matrixWorld), Xg.setFromMatrixPosition(this.light.target.matrixWorld), SM.subVectors(Xg, bM), this.lightPlane.lookAt(Xg), this.color !== void 0 ? (this.lightPlane.material.color.set(this.color), this.targetLine.material.color.set(this.color)) : (this.lightPlane.material.color.copy(this.light.color), this.targetLine.material.color.copy(this.light.color)), this.targetLine.lookAt(Xg), this.targetLine.scale.z = SM.length();
      }
    }]);
    return _y;
  }(mt),
  Qg = new _(),
  Nr = new Hn(),
  nl = /*#__PURE__*/function (_Ja) {
    _inherits(nl, _Ja);
    var _super90 = _createSuper(nl);
    function nl(t) {
      var _this74;
      _classCallCheck(this, nl);
      var e = new we(),
        r = new ns({
          color: 16777215,
          vertexColors: !0,
          toneMapped: !1
        }),
        i = [],
        s = [],
        o = {};
      a("n1", "n2"), a("n2", "n4"), a("n4", "n3"), a("n3", "n1"), a("f1", "f2"), a("f2", "f4"), a("f4", "f3"), a("f3", "f1"), a("n1", "f1"), a("n2", "f2"), a("n3", "f3"), a("n4", "f4"), a("p", "n1"), a("p", "n2"), a("p", "n3"), a("p", "n4"), a("u1", "u2"), a("u2", "u3"), a("u3", "u1"), a("c", "t"), a("p", "c"), a("cn1", "cn2"), a("cn3", "cn4"), a("cf1", "cf2"), a("cf3", "cf4");
      function a(p, m) {
        l(p), l(m);
      }
      function l(p) {
        i.push(0, 0, 0), s.push(0, 0, 0), o[p] === void 0 && (o[p] = []), o[p].push(i.length / 3 - 1);
      }
      e.setAttribute("position", new be(i, 3)), e.setAttribute("color", new be(s, 3)), _this74 = _super90.call(this, e, r), _this74.type = "CameraHelper", _this74.camera = t, _this74.camera.updateProjectionMatrix && _this74.camera.updateProjectionMatrix(), _this74.matrix = t.matrixWorld, _this74.matrixAutoUpdate = !1, _this74.pointMap = o, _this74.update();
      var u = new Le(16755200),
        c = new Le(16711680),
        d = new Le(43775),
        h = new Le(16777215),
        f = new Le(3355443);
      _this74.setColors(u, c, d, h, f);
      return _this74;
    }
    _createClass(nl, [{
      key: "setColors",
      value: function setColors(t, e, r, i, s) {
        var a = this.geometry.getAttribute("color");
        a.setXYZ(0, t.r, t.g, t.b), a.setXYZ(1, t.r, t.g, t.b), a.setXYZ(2, t.r, t.g, t.b), a.setXYZ(3, t.r, t.g, t.b), a.setXYZ(4, t.r, t.g, t.b), a.setXYZ(5, t.r, t.g, t.b), a.setXYZ(6, t.r, t.g, t.b), a.setXYZ(7, t.r, t.g, t.b), a.setXYZ(8, t.r, t.g, t.b), a.setXYZ(9, t.r, t.g, t.b), a.setXYZ(10, t.r, t.g, t.b), a.setXYZ(11, t.r, t.g, t.b), a.setXYZ(12, t.r, t.g, t.b), a.setXYZ(13, t.r, t.g, t.b), a.setXYZ(14, t.r, t.g, t.b), a.setXYZ(15, t.r, t.g, t.b), a.setXYZ(16, t.r, t.g, t.b), a.setXYZ(17, t.r, t.g, t.b), a.setXYZ(18, t.r, t.g, t.b), a.setXYZ(19, t.r, t.g, t.b), a.setXYZ(20, t.r, t.g, t.b), a.setXYZ(21, t.r, t.g, t.b), a.setXYZ(22, t.r, t.g, t.b), a.setXYZ(23, t.r, t.g, t.b), a.setXYZ(24, e.r, e.g, e.b), a.setXYZ(25, e.r, e.g, e.b), a.setXYZ(26, e.r, e.g, e.b), a.setXYZ(27, e.r, e.g, e.b), a.setXYZ(28, e.r, e.g, e.b), a.setXYZ(29, e.r, e.g, e.b), a.setXYZ(30, e.r, e.g, e.b), a.setXYZ(31, e.r, e.g, e.b), a.setXYZ(32, r.r, r.g, r.b), a.setXYZ(33, r.r, r.g, r.b), a.setXYZ(34, r.r, r.g, r.b), a.setXYZ(35, r.r, r.g, r.b), a.setXYZ(36, r.r, r.g, r.b), a.setXYZ(37, r.r, r.g, r.b), a.setXYZ(38, i.r, i.g, i.b), a.setXYZ(39, i.r, i.g, i.b), a.setXYZ(40, s.r, s.g, s.b), a.setXYZ(41, s.r, s.g, s.b), a.setXYZ(42, s.r, s.g, s.b), a.setXYZ(43, s.r, s.g, s.b), a.setXYZ(44, s.r, s.g, s.b), a.setXYZ(45, s.r, s.g, s.b), a.setXYZ(46, s.r, s.g, s.b), a.setXYZ(47, s.r, s.g, s.b), a.setXYZ(48, s.r, s.g, s.b), a.setXYZ(49, s.r, s.g, s.b), a.needsUpdate = !0;
      }
    }, {
      key: "update",
      value: function update() {
        var t = this.geometry,
          e = this.pointMap,
          r = 1,
          i = 1;
        Nr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse), Hr("c", e, t, Nr, 0, 0, -1), Hr("t", e, t, Nr, 0, 0, 1), Hr("n1", e, t, Nr, -r, -i, -1), Hr("n2", e, t, Nr, r, -i, -1), Hr("n3", e, t, Nr, -r, i, -1), Hr("n4", e, t, Nr, r, i, -1), Hr("f1", e, t, Nr, -r, -i, 1), Hr("f2", e, t, Nr, r, -i, 1), Hr("f3", e, t, Nr, -r, i, 1), Hr("f4", e, t, Nr, r, i, 1), Hr("u1", e, t, Nr, r * .7, i * 1.1, -1), Hr("u2", e, t, Nr, -r * .7, i * 1.1, -1), Hr("u3", e, t, Nr, 0, i * 2, -1), Hr("cf1", e, t, Nr, -r, 0, 1), Hr("cf2", e, t, Nr, r, 0, 1), Hr("cf3", e, t, Nr, 0, -i, 1), Hr("cf4", e, t, Nr, 0, i, 1), Hr("cn1", e, t, Nr, -r, 0, -1), Hr("cn2", e, t, Nr, r, 0, -1), Hr("cn3", e, t, Nr, 0, -i, -1), Hr("cn4", e, t, Nr, 0, i, -1), t.getAttribute("position").needsUpdate = !0;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.geometry.dispose(), this.material.dispose();
      }
    }]);
    return nl;
  }(Ja);
function Hr(n, t, e, r, i, s, o) {
  Qg.set(i, s, o).unproject(r);
  var a = t[n];
  if (a !== void 0) {
    var _l31 = e.getAttribute("position");
    for (var u = 0, c = a.length; u < c; u++) _l31.setXYZ(a[u], Qg.x, Qg.y, Qg.z);
  }
}
var sl = /*#__PURE__*/function (_Ja2) {
  _inherits(sl, _Ja2);
  var _super91 = _createSuper(sl);
  function sl(t) {
    var _this75;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 16776960;
    _classCallCheck(this, sl);
    var r = new Uint16Array([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7]),
      i = [1, 1, 1, -1, 1, 1, -1, -1, 1, 1, -1, 1, 1, 1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1],
      s = new we();
    s.setIndex(new Ge(r, 1)), s.setAttribute("position", new be(i, 3)), _this75 = _super91.call(this, s, new ns({
      color: e,
      toneMapped: !1
    })), _this75.box = t, _this75.type = "Box3Helper", _this75.geometry.computeBoundingSphere();
    return _this75;
  }
  _createClass(sl, [{
    key: "updateMatrixWorld",
    value: function updateMatrixWorld(t) {
      var e = this.box;
      e.isEmpty() || (e.getCenter(this.position), e.getSize(this.scale), this.scale.multiplyScalar(.5), _get(_getPrototypeOf(sl.prototype), "updateMatrixWorld", this).call(this, t));
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.geometry.dispose(), this.material.dispose();
    }
  }]);
  return sl;
}(Ja);
var Ey = /*#__PURE__*/function (_Ja3) {
  _inherits(Ey, _Ja3);
  var _super92 = _createSuper(Ey);
  function Ey() {
    var _this76;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    _classCallCheck(this, Ey);
    var e = [0, 0, 0, t, 0, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, 0, t],
      r = [1, 0, 0, 1, .6, 0, 0, 1, 0, .6, 1, 0, 0, 0, 1, 0, .6, 1],
      i = new we();
    i.setAttribute("position", new be(e, 3)), i.setAttribute("color", new be(r, 3));
    var s = new ns({
      vertexColors: !0,
      toneMapped: !1
    });
    _this76 = _super92.call(this, i, s), _this76.type = "AxesHelper";
    return _this76;
  }
  _createClass(Ey, [{
    key: "setColors",
    value: function setColors(t, e, r) {
      var i = new Le(),
        s = this.geometry.attributes.color.array;
      return i.set(t), i.toArray(s, 0), i.toArray(s, 3), i.set(e), i.toArray(s, 6), i.toArray(s, 9), i.set(r), i.toArray(s, 12), i.toArray(s, 15), this.geometry.attributes.color.needsUpdate = !0, this;
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.geometry.dispose(), this.material.dispose();
    }
  }]);
  return Ey;
}(Ja);
var ia = g4();
function g4() {
  var n = new ArrayBuffer(4),
    t = new Float32Array(n),
    e = new Uint32Array(n),
    r = new Uint32Array(512),
    i = new Uint32Array(512);
  for (var _l32 = 0; _l32 < 256; ++_l32) {
    var u = _l32 - 127;
    u < -27 ? (r[_l32] = 0, r[_l32 | 256] = 32768, i[_l32] = 24, i[_l32 | 256] = 24) : u < -14 ? (r[_l32] = 1024 >> -u - 14, r[_l32 | 256] = 1024 >> -u - 14 | 32768, i[_l32] = -u - 1, i[_l32 | 256] = -u - 1) : u <= 15 ? (r[_l32] = u + 15 << 10, r[_l32 | 256] = u + 15 << 10 | 32768, i[_l32] = 13, i[_l32 | 256] = 13) : u < 128 ? (r[_l32] = 31744, r[_l32 | 256] = 64512, i[_l32] = 24, i[_l32 | 256] = 24) : (r[_l32] = 31744, r[_l32 | 256] = 64512, i[_l32] = 13, i[_l32 | 256] = 13);
  }
  var s = new Uint32Array(2048),
    o = new Uint32Array(64),
    a = new Uint32Array(64);
  for (var _l33 = 1; _l33 < 1024; ++_l33) {
    var _u14 = _l33 << 13,
      c = 0;
    for (; (_u14 & 8388608) === 0;) _u14 <<= 1, c -= 8388608;
    _u14 &= -8388609, c += 947912704, s[_l33] = _u14 | c;
  }
  for (var _l34 = 1024; _l34 < 2048; ++_l34) s[_l34] = 939524096 + (_l34 - 1024 << 13);
  for (var _l35 = 1; _l35 < 31; ++_l35) o[_l35] = _l35 << 23;
  o[31] = 1199570944, o[32] = 2147483648;
  for (var _l36 = 33; _l36 < 63; ++_l36) o[_l36] = 2147483648 + (_l36 - 32 << 23);
  o[63] = 3347054592;
  for (var _l37 = 1; _l37 < 64; ++_l37) _l37 !== 32 && (a[_l37] = 1024);
  return {
    floatView: t,
    uint32View: e,
    baseTable: r,
    shiftTable: i,
    mantissaTable: s,
    exponentTable: o,
    offsetTable: a
  };
}
function y4(n) {
  Math.abs(n) > 65504 && console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."), n = oi(n, -65504, 65504), ia.floatView[0] = n;
  var t = ia.uint32View[0],
    e = t >> 23 & 511;
  return ia.baseTable[e] + ((t & 8388607) >> ia.shiftTable[e]);
}
function v4(n) {
  var t = n >> 10;
  return ia.uint32View[0] = ia.mantissaTable[ia.offsetTable[t] + (n & 1023)] + ia.exponentTable[t], ia.floatView[0];
}
var GM = Object.freeze({
  __proto__: null,
  fromHalfFloat: v4,
  toHalfFloat: y4
});
(typeof __THREE_DEVTOOLS__ === "undefined" ? "undefined" : _typeof(__THREE_DEVTOOLS__)) < "u" && __THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register", {
  detail: {
    revision: aa
  }
}));
(typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && (window.__THREE__ ? console.warn("WARNING: Multiple instances of Three.js being imported.") : window.__THREE__ = aa);
var Ju = ".",
  _p = Symbol("target"),
  mw = Symbol("unsubscribe");
function Ep(n) {
  return n instanceof Date || n instanceof Set || n instanceof Map || n instanceof WeakSet || n instanceof WeakMap || ArrayBuffer.isView(n);
}
function jM(n) {
  return (_typeof(n) == "object" ? n === null : typeof n != "function") || n instanceof RegExp;
}
var Yn = Array.isArray;
function Sc(n) {
  return _typeof(n) == "symbol";
}
var x4 = {
    after: function after(n, t) {
      return Yn(n) ? n.slice(t.length) : t === "" ? n : n.slice(t.length + 1);
    },
    concat: function concat(n, t) {
      return Yn(n) ? (n = _toConsumableArray(n), t && n.push(t), n) : t && t.toString !== void 0 ? (n !== "" && (n += Ju), Sc(t) ? n + t.toString() : n + t) : n;
    },
    initial: function initial(n) {
      if (Yn(n)) return n.slice(0, -1);
      if (n === "") return n;
      var t = n.lastIndexOf(Ju);
      return t === -1 ? "" : n.slice(0, t);
    },
    last: function last(n) {
      if (Yn(n)) return n[n.length - 1] || "";
      if (n === "") return n;
      var t = n.lastIndexOf(Ju);
      return t === -1 ? n : n.slice(t + 1);
    },
    walk: function walk(n, t) {
      if (Yn(n)) {
        var _iterator8 = _createForOfIteratorHelper(n),
          _step8;
        try {
          for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
            var _e9 = _step8.value;
            t(_e9);
          }
        } catch (err) {
          _iterator8.e(err);
        } finally {
          _iterator8.f();
        }
      } else if (n !== "") {
        var _e10 = 0,
          r = n.indexOf(Ju);
        if (r === -1) t(n);else for (; _e10 < n.length;) r === -1 && (r = n.length), t(n.slice(_e10, r)), _e10 = r + 1, r = n.indexOf(Ju, _e10);
      }
    },
    get: function get(n, t) {
      return this.walk(t, function (e) {
        n && (n = n[e]);
      }), n;
    }
  },
  fn = x4;
function gw(n) {
  return _typeof(n) == "object" && typeof n.next == "function";
}
function yw(n, t, e, r, i) {
  var s = n.next;
  if (t.name === "entries") n.next = function () {
    var o = s.call(this);
    return o.done === !1 && (o.value[0] = i(o.value[0], t, o.value[0], r), o.value[1] = i(o.value[1], t, o.value[0], r)), o;
  };else if (t.name === "values") {
    var o = e[_p].keys();
    n.next = function () {
      var a = s.call(this);
      return a.done === !1 && (a.value = i(a.value, t, o.next().value, r)), a;
    };
  } else n.next = function () {
    var o = s.call(this);
    return o.done === !1 && (o.value = i(o.value, t, o.value, r)), o;
  };
  return n;
}
function Py(n, t, e) {
  return n.isUnsubscribed || t.ignoreSymbols && Sc(e) || t.ignoreUnderscores && e.charAt(0) === "_" || "ignoreKeys" in t && t.ignoreKeys.includes(e);
}
var Tp = /*#__PURE__*/function () {
  function Tp(t) {
    _classCallCheck(this, Tp);
    this._equals = t, this._proxyCache = new WeakMap(), this._pathCache = new WeakMap(), this.isUnsubscribed = !1;
  }
  _createClass(Tp, [{
    key: "_getDescriptorCache",
    value: function _getDescriptorCache() {
      return this._descriptorCache === void 0 && (this._descriptorCache = new WeakMap()), this._descriptorCache;
    }
  }, {
    key: "_getProperties",
    value: function _getProperties(t) {
      var e = this._getDescriptorCache(),
        r = e.get(t);
      return r === void 0 && (r = {}, e.set(t, r)), r;
    }
  }, {
    key: "_getOwnPropertyDescriptor",
    value: function _getOwnPropertyDescriptor(t, e) {
      if (this.isUnsubscribed) return Reflect.getOwnPropertyDescriptor(t, e);
      var r = this._getProperties(t),
        i = r[e];
      return i === void 0 && (i = Reflect.getOwnPropertyDescriptor(t, e), r[e] = i), i;
    }
  }, {
    key: "getProxy",
    value: function getProxy(t, e, r, i) {
      if (this.isUnsubscribed) return t;
      var s = t[i],
        o = s || t;
      this._pathCache.set(o, e);
      var a = this._proxyCache.get(o);
      return a === void 0 && (a = s === void 0 ? new Proxy(t, r) : t, this._proxyCache.set(o, a)), a;
    }
  }, {
    key: "getPath",
    value: function getPath(t) {
      return this.isUnsubscribed ? void 0 : this._pathCache.get(t);
    }
  }, {
    key: "isDetached",
    value: function isDetached(t, e) {
      return !Object.is(t, fn.get(e, this.getPath(t)));
    }
  }, {
    key: "defineProperty",
    value: function defineProperty(t, e, r) {
      return Reflect.defineProperty(t, e, r) ? (this.isUnsubscribed || (this._getProperties(t)[e] = r), !0) : !1;
    }
  }, {
    key: "setProperty",
    value: function setProperty(t, e, r, i, s) {
      if (!this._equals(s, r) || !(e in t)) {
        var o = this._getOwnPropertyDescriptor(t, e);
        return o !== void 0 && "set" in o ? Reflect.set(t, e, r, i) : Reflect.set(t, e, r);
      }
      return !0;
    }
  }, {
    key: "deleteProperty",
    value: function deleteProperty(t, e, r) {
      if (Reflect.deleteProperty(t, e)) {
        if (!this.isUnsubscribed) {
          var i = this._getDescriptorCache().get(t);
          i && (delete i[e], this._pathCache.delete(r));
        }
        return !0;
      }
      return !1;
    }
  }, {
    key: "isSameDescriptor",
    value: function isSameDescriptor(t, e, r) {
      var i = this._getOwnPropertyDescriptor(e, r);
      return t !== void 0 && i !== void 0 && Object.is(t.value, i.value) && (t.writable || !1) === (i.writable || !1) && (t.enumerable || !1) === (i.enumerable || !1) && (t.configurable || !1) === (i.configurable || !1) && t.get === i.get && t.set === i.set;
    }
  }, {
    key: "isGetInvariant",
    value: function isGetInvariant(t, e) {
      var r = this._getOwnPropertyDescriptor(t, e);
      return r !== void 0 && r.configurable !== !0 && r.writable !== !0;
    }
  }, {
    key: "unsubscribe",
    value: function unsubscribe() {
      this._descriptorCache = null, this._pathCache = null, this._proxyCache = null, this.isUnsubscribed = !0;
    }
  }]);
  return Tp;
}();
function $u(n) {
  return toString.call(n) === "[object Object]";
}
function ed() {
  return !0;
}
function ol(n, t) {
  return n.length !== t.length || n.some(function (e, r) {
    return t[r] !== e;
  });
}
var Dy = new Set(["hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "toLocaleString", "toString", "valueOf"]);
var b4 = new Set(["concat", "includes", "indexOf", "join", "keys", "lastIndexOf"]),
  vw = {
    push: ed,
    pop: ed,
    shift: ed,
    unshift: ed,
    copyWithin: ol,
    reverse: ol,
    sort: ol,
    splice: ol,
    flat: ol,
    fill: ol
  },
  HM = new Set([].concat(_toConsumableArray(Dy), _toConsumableArray(b4), _toConsumableArray(Object.keys(vw))));
function td(n, t) {
  if (n.size !== t.size) return !0;
  var _iterator9 = _createForOfIteratorHelper(n),
    _step9;
  try {
    for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
      var _e11 = _step9.value;
      if (!t.has(_e11)) return !0;
    }
  } catch (err) {
    _iterator9.e(err);
  } finally {
    _iterator9.f();
  }
  return !1;
}
var xw = ["keys", "values", "entries"],
  bw = new Set(["has", "toString"]),
  Sw = {
    add: td,
    clear: td,
    delete: td,
    forEach: td
  },
  WM = new Set([].concat(_toConsumableArray(bw), _toConsumableArray(Object.keys(Sw)), xw));
function rd(n, t) {
  if (n.size !== t.size) return !0;
  var e;
  var _iterator10 = _createForOfIteratorHelper(n),
    _step10;
  try {
    for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
      var _step10$value = _slicedToArray(_step10.value, 2),
        r = _step10$value[0],
        i = _step10$value[1];
      if (e = t.get(r), e !== i || e === void 0 && !t.has(r)) return !0;
    }
  } catch (err) {
    _iterator10.e(err);
  } finally {
    _iterator10.f();
  }
  return !1;
}
var S4 = new Set([].concat(_toConsumableArray(bw), ["get"])),
  ww = {
    set: rd,
    clear: rd,
    delete: rd,
    forEach: rd
  },
  qM = new Set([].concat(_toConsumableArray(S4), _toConsumableArray(Object.keys(ww)), xw));
var Ri = /*#__PURE__*/function () {
  function Ri(t, e, r, i) {
    _classCallCheck(this, Ri);
    this._path = e, this._isChanged = !1, this._clonedCache = new Set(), this._hasOnValidate = i, this._changes = i ? [] : null, this.clone = e === void 0 ? t : this._shallowClone(t);
  }
  _createClass(Ri, [{
    key: "_shallowClone",
    value: function _shallowClone(t) {
      var _this77 = this;
      var e = t;
      if ($u(t)) e = _objectSpread({}, t);else if (Yn(t)) e = _toConsumableArray(t);else if (t instanceof Date) e = new Date(t);else if (t instanceof Set) e = new Set(_toConsumableArray(t).map(function (r) {
        return _this77._shallowClone(r);
      }));else if (t instanceof Map) {
        e = new Map();
        var _iterator11 = _createForOfIteratorHelper(t.entries()),
          _step11;
        try {
          for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
            var _step11$value = _slicedToArray(_step11.value, 2),
              r = _step11$value[0],
              i = _step11$value[1];
            e.set(r, this._shallowClone(i));
          }
        } catch (err) {
          _iterator11.e(err);
        } finally {
          _iterator11.f();
        }
      }
      return this._clonedCache.add(e), e;
    }
  }, {
    key: "preferredThisArg",
    value: function preferredThisArg(t, e, r, i) {
      return t ? (Yn(i) ? this._onIsChanged = vw[e] : i instanceof Set ? this._onIsChanged = Sw[e] : i instanceof Map && (this._onIsChanged = ww[e]), i) : r;
    }
  }, {
    key: "update",
    value: function update(t, e, r) {
      var _this78 = this;
      var i = fn.after(t, this._path);
      if (e !== "length") {
        var s = this.clone;
        fn.walk(i, function (o) {
          s && s[o] && (_this78._clonedCache.has(s[o]) || (s[o] = _this78._shallowClone(s[o])), s = s[o]);
        }), this._hasOnValidate && this._changes.push({
          path: i,
          property: e,
          previous: r
        }), s && s[e] && (s[e] = r);
      }
      this._isChanged = !0;
    }
  }, {
    key: "undo",
    value: function undo(t) {
      var e;
      for (var r = this._changes.length - 1; r !== -1; r--) e = this._changes[r], fn.get(t, e.path)[e.property] = e.previous;
    }
  }, {
    key: "isChanged",
    value: function isChanged(t) {
      return this._onIsChanged === void 0 ? this._isChanged : this._onIsChanged(this.clone, t);
    }
  }], [{
    key: "isHandledMethod",
    value: function isHandledMethod(t) {
      return Dy.has(t);
    }
  }]);
  return Ri;
}();
var id = /*#__PURE__*/function (_Ri) {
  _inherits(id, _Ri);
  var _super93 = _createSuper(id);
  function id() {
    _classCallCheck(this, id);
    return _super93.apply(this, arguments);
  }
  _createClass(id, null, [{
    key: "isHandledMethod",
    value: function isHandledMethod(t) {
      return HM.has(t);
    }
  }]);
  return id;
}(Ri);
var Mp = /*#__PURE__*/function (_Ri2) {
  _inherits(Mp, _Ri2);
  var _super94 = _createSuper(Mp);
  function Mp() {
    _classCallCheck(this, Mp);
    return _super94.apply(this, arguments);
  }
  _createClass(Mp, [{
    key: "undo",
    value: function undo(t) {
      t.setTime(this.clone.getTime());
    }
  }, {
    key: "isChanged",
    value: function isChanged(t, e) {
      return !e(this.clone.valueOf(), t.valueOf());
    }
  }]);
  return Mp;
}(Ri);
var nd = /*#__PURE__*/function (_Ri3) {
  _inherits(nd, _Ri3);
  var _super95 = _createSuper(nd);
  function nd() {
    _classCallCheck(this, nd);
    return _super95.apply(this, arguments);
  }
  _createClass(nd, [{
    key: "undo",
    value: function undo(t) {
      var _iterator12 = _createForOfIteratorHelper(this.clone),
        _step12;
      try {
        for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {
          var _e12 = _step12.value;
          t.add(_e12);
        }
      } catch (err) {
        _iterator12.e(err);
      } finally {
        _iterator12.f();
      }
      var _iterator13 = _createForOfIteratorHelper(t),
        _step13;
      try {
        for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {
          var _e13 = _step13.value;
          this.clone.has(_e13) || t.delete(_e13);
        }
      } catch (err) {
        _iterator13.e(err);
      } finally {
        _iterator13.f();
      }
    }
  }], [{
    key: "isHandledMethod",
    value: function isHandledMethod(t) {
      return WM.has(t);
    }
  }]);
  return nd;
}(Ri);
var sd = /*#__PURE__*/function (_Ri4) {
  _inherits(sd, _Ri4);
  var _super96 = _createSuper(sd);
  function sd() {
    _classCallCheck(this, sd);
    return _super96.apply(this, arguments);
  }
  _createClass(sd, [{
    key: "undo",
    value: function undo(t) {
      var _iterator14 = _createForOfIteratorHelper(this.clone.entries()),
        _step14;
      try {
        for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {
          var _step14$value = _slicedToArray(_step14.value, 2),
            _e14 = _step14$value[0],
            r = _step14$value[1];
          t.set(_e14, r);
        }
      } catch (err) {
        _iterator14.e(err);
      } finally {
        _iterator14.f();
      }
      var _iterator15 = _createForOfIteratorHelper(t.keys()),
        _step15;
      try {
        for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {
          var _e15 = _step15.value;
          this.clone.has(_e15) || t.delete(_e15);
        }
      } catch (err) {
        _iterator15.e(err);
      } finally {
        _iterator15.f();
      }
    }
  }], [{
    key: "isHandledMethod",
    value: function isHandledMethod(t) {
      return qM.has(t);
    }
  }]);
  return sd;
}(Ri);
var Cp = /*#__PURE__*/function (_Ri5) {
  _inherits(Cp, _Ri5);
  var _super97 = _createSuper(Cp);
  function Cp(t, e, r, i) {
    var _this79;
    _classCallCheck(this, Cp);
    _this79 = _super97.call(this, void 0, e, r, i), _this79._arg1 = r[0], _this79._weakValue = t.has(_this79._arg1);
    return _this79;
  }
  _createClass(Cp, [{
    key: "isChanged",
    value: function isChanged(t) {
      return this._weakValue !== t.has(this._arg1);
    }
  }, {
    key: "undo",
    value: function undo(t) {
      this._weakValue && !t.has(this._arg1) ? t.add(this._arg1) : t.delete(this._arg1);
    }
  }]);
  return Cp;
}(Ri);
var Pp = /*#__PURE__*/function (_Ri6) {
  _inherits(Pp, _Ri6);
  var _super98 = _createSuper(Pp);
  function Pp(t, e, r, i) {
    var _this80;
    _classCallCheck(this, Pp);
    _this80 = _super98.call(this, void 0, e, r, i), _this80._weakKey = r[0], _this80._weakHas = t.has(_this80._weakKey), _this80._weakValue = t.get(_this80._weakKey);
    return _this80;
  }
  _createClass(Pp, [{
    key: "isChanged",
    value: function isChanged(t) {
      return this._weakValue !== t.get(this._weakKey);
    }
  }, {
    key: "undo",
    value: function undo(t) {
      var e = t.has(this._weakKey);
      this._weakHas && !e ? t.set(this._weakKey, this._weakValue) : !this._weakHas && e ? t.delete(this._weakKey) : this._weakValue !== t.get(this._weakKey) && t.set(this._weakKey, this._weakValue);
    }
  }]);
  return Pp;
}(Ri);
var Fs = /*#__PURE__*/function () {
  function Fs(t) {
    _classCallCheck(this, Fs);
    this._stack = [], this._hasOnValidate = t;
  }
  _createClass(Fs, [{
    key: "isCloning",
    get: function get() {
      return this._stack.length > 0;
    }
  }, {
    key: "start",
    value: function start(t, e, r) {
      var i = Ri;
      Yn(t) ? i = id : t instanceof Date ? i = Mp : t instanceof Set ? i = nd : t instanceof Map ? i = sd : t instanceof WeakSet ? i = Cp : t instanceof WeakMap && (i = Pp), this._stack.push(new i(t, e, r, this._hasOnValidate));
    }
  }, {
    key: "update",
    value: function update(t, e, r) {
      this._stack[this._stack.length - 1].update(t, e, r);
    }
  }, {
    key: "preferredThisArg",
    value: function preferredThisArg(t, e, r) {
      var i = t.name,
        s = Fs.isHandledMethod(r, i);
      return this._stack[this._stack.length - 1].preferredThisArg(s, i, e, r);
    }
  }, {
    key: "isChanged",
    value: function isChanged(t, e, r) {
      return this._stack[this._stack.length - 1].isChanged(t, e, r);
    }
  }, {
    key: "undo",
    value: function undo(t) {
      this._previousClone !== void 0 && this._previousClone.undo(t);
    }
  }, {
    key: "stop",
    value: function stop() {
      return this._previousClone = this._stack.pop(), this._previousClone.clone;
    }
  }], [{
    key: "isHandledType",
    value: function isHandledType(t) {
      return $u(t) || Yn(t) || Ep(t);
    }
  }, {
    key: "isHandledMethod",
    value: function isHandledMethod(t, e) {
      return $u(t) ? Ri.isHandledMethod(e) : Yn(t) ? id.isHandledMethod(e) : t instanceof Set ? nd.isHandledMethod(e) : t instanceof Map ? sd.isHandledMethod(e) : Ep(t);
    }
  }]);
  return Fs;
}();
var w4 = {
    equals: Object.is,
    isShallow: !1,
    pathAsArray: !1,
    ignoreSymbols: !1,
    ignoreUnderscores: !1,
    ignoreDetached: !1,
    details: !1
  },
  Aw = function Aw(n, t) {
    var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    e = _objectSpread(_objectSpread({}, w4), e);
    var r = Symbol("ProxyTarget"),
      _e16 = e,
      i = _e16.equals,
      s = _e16.isShallow,
      o = _e16.ignoreDetached,
      a = _e16.details,
      l = new Tp(i),
      u = typeof e.onValidate == "function",
      c = new Fs(u),
      d = function d(v, x, S, w, A) {
        return !u || c.isCloning || e.onValidate(fn.concat(l.getPath(v), x), S, w, A) === !0;
      },
      h = function h(v, x, S, w) {
        !Py(l, e, x) && !(o && l.isDetached(v, n)) && f(l.getPath(v), x, S, w);
      },
      f = function f(v, x, S, w, A) {
        c.isCloning ? c.update(v, x, w) : t(fn.concat(v, x), S, w, A);
      },
      p = function p(v) {
        return v && (v[r] || v);
      },
      m = function m(v, x, S, w) {
        return jM(v) || S === "constructor" || s && !Fs.isHandledMethod(x, S) || Py(l, e, S) || l.isGetInvariant(x, S) || o && l.isDetached(x, n) ? v : (w === void 0 && (w = l.getPath(x)), l.getProxy(v, fn.concat(w, S), g, r));
      },
      g = {
        get: function get(v, x, S) {
          if (Sc(x)) {
            if (x === r || x === _p) return v;
            if (x === mw && !l.isUnsubscribed && l.getPath(v).length === 0) return l.unsubscribe(), v;
          }
          var w = Ep(v) ? Reflect.get(v, x) : Reflect.get(v, x, S);
          return m(w, v, x);
        },
        set: function set(v, x, S, w) {
          S = p(S);
          var A = v[r] || v,
            E = A[x];
          if (i(E, S) && x in v) return !0;
          var b = d(v, x, S, E);
          return b && l.setProperty(A, x, S, w, E) ? (h(v, x, v[x], E), !0) : !b;
        },
        defineProperty: function defineProperty(v, x, S) {
          if (!l.isSameDescriptor(S, v, x)) {
            var w = v[x];
            d(v, x, S.value, w) && l.defineProperty(v, x, S, w) && h(v, x, S.value, w);
          }
          return !0;
        },
        deleteProperty: function deleteProperty(v, x) {
          if (!Reflect.has(v, x)) return !0;
          var S = Reflect.get(v, x),
            w = d(v, x, void 0, S);
          return w && l.deleteProperty(v, x, S) ? (h(v, x, void 0, S), !0) : !w;
        },
        apply: function apply(v, x, S) {
          var w = x[r] || x;
          if (l.isUnsubscribed) return Reflect.apply(v, w, S);
          if ((a === !1 || a !== !0 && !a.includes(v.name)) && Fs.isHandledType(w)) {
            var A = fn.initial(l.getPath(v)),
              E = Fs.isHandledMethod(w, v.name);
            c.start(w, A, S);
            var b = Reflect.apply(v, c.preferredThisArg(v, x, w), E ? S.map(function (C) {
                return p(C);
              }) : S),
              T = c.isChanged(w, i),
              M = c.stop();
            if (Fs.isHandledType(b) && E && (x instanceof Map && v.name === "get" && (A = fn.concat(A, S[0])), b = l.getProxy(b, A, g)), T) {
              var C = {
                  name: v.name,
                  args: S,
                  result: b
                },
                P = c.isCloning ? fn.initial(A) : A,
                D = c.isCloning ? fn.last(A) : "";
              d(fn.get(n, P), D, w, M, C) ? f(P, D, w, M, C) : c.undo(w);
            }
            return (x instanceof Map || x instanceof Set) && gw(b) ? yw(b, v, x, A, m) : b;
          }
          return Reflect.apply(v, x, S);
        }
      },
      y = l.getProxy(n, e.pathAsArray ? [] : "", g);
    return t = t.bind(y), u && (e.onValidate = e.onValidate.bind(y)), y;
  };
Aw.target = function (n) {
  return n && n[_p] || n;
};
Aw.unsubscribe = function (n) {
  return n[mw] || n;
};
var _w = Aw;
var A4 = (typeof global === "undefined" ? "undefined" : _typeof(global)) == "object" && global && global.Object === Object && global,
  Oy = A4;
var _4 = (typeof self === "undefined" ? "undefined" : _typeof(self)) == "object" && self && self.Object === Object && self,
  E4 = Oy || _4 || Function("return this")(),
  kr = E4;
var T4 = kr.Symbol,
  Li = T4;
var YM = Object.prototype,
  M4 = YM.hasOwnProperty,
  C4 = YM.toString,
  Dp = Li ? Li.toStringTag : void 0;
function P4(n) {
  var t = M4.call(n, Dp),
    e = n[Dp];
  try {
    n[Dp] = void 0;
    var r = !0;
  } catch (_unused9) {}
  var i = C4.call(n);
  return r && (t ? n[Dp] = e : delete n[Dp]), i;
}
var XM = P4;
var D4 = Object.prototype,
  O4 = D4.toString;
function I4(n) {
  return O4.call(n);
}
var QM = I4;
var R4 = "[object Null]",
  L4 = "[object Undefined]",
  KM = Li ? Li.toStringTag : void 0;
function B4(n) {
  return n == null ? n === void 0 ? L4 : R4 : KM && KM in Object(n) ? XM(n) : QM(n);
}
var Xn = B4;
function N4(n) {
  return n != null && _typeof(n) == "object";
}
var Yi = N4;
var F4 = "[object Symbol]";
function k4(n) {
  return _typeof(n) == "symbol" || Yi(n) && Xn(n) == F4;
}
var al = k4;
function z4(n, t) {
  for (var e = -1, r = n == null ? 0 : n.length, i = Array(r); ++e < r;) i[e] = t(n[e], e, n);
  return i;
}
var Iy = z4;
var V4 = Array.isArray,
  bi = V4;
var U4 = 1 / 0,
  ZM = Li ? Li.prototype : void 0,
  JM = ZM ? ZM.toString : void 0;
function $M(n) {
  if (typeof n == "string") return n;
  if (bi(n)) return Iy(n, $M) + "";
  if (al(n)) return JM ? JM.call(n) : "";
  var t = n + "";
  return t == "0" && 1 / n == -U4 ? "-0" : t;
}
var eC = $M;
var G4 = /\s/;
function j4(n) {
  for (var t = n.length; t-- && G4.test(n.charAt(t)););
  return t;
}
var tC = j4;
var H4 = /^\s+/;
function W4(n) {
  return n && n.slice(0, tC(n) + 1).replace(H4, "");
}
var rC = W4;
function q4(n) {
  var t = _typeof(n);
  return n != null && (t == "object" || t == "function");
}
var ui = q4;
var iC = 0 / 0,
  Y4 = /^[-+]0x[0-9a-f]+$/i,
  X4 = /^0b[01]+$/i,
  Q4 = /^0o[0-7]+$/i,
  K4 = parseInt;
function Z4(n) {
  if (typeof n == "number") return n;
  if (al(n)) return iC;
  if (ui(n)) {
    var t = typeof n.valueOf == "function" ? n.valueOf() : n;
    n = ui(t) ? t + "" : t;
  }
  if (typeof n != "string") return n === 0 ? n : +n;
  n = rC(n);
  var e = X4.test(n);
  return e || Q4.test(n) ? K4(n.slice(2), e ? 2 : 8) : Y4.test(n) ? iC : +n;
}
var Ew = Z4;
function J4(n) {
  return n;
}
var nC = J4;
var $4 = "[object AsyncFunction]",
  ej = "[object Function]",
  tj = "[object GeneratorFunction]",
  rj = "[object Proxy]";
function ij(n) {
  if (!ui(n)) return !1;
  var t = Xn(n);
  return t == ej || t == tj || t == $4 || t == rj;
}
var Ry = ij;
var nj = kr["__core-js_shared__"],
  Ly = nj;
var sC = function () {
  var n = /[^.]+$/.exec(Ly && Ly.keys && Ly.keys.IE_PROTO || "");
  return n ? "Symbol(src)_1." + n : "";
}();
function sj(n) {
  return !!sC && sC in n;
}
var oC = sj;
var oj = Function.prototype,
  aj = oj.toString;
function lj(n) {
  if (n != null) {
    try {
      return aj.call(n);
    } catch (_unused10) {}
    try {
      return n + "";
    } catch (_unused11) {}
  }
  return "";
}
var la = lj;
var cj = /[\\^$.*+?()[\]{}|]/g,
  uj = /^\[object .+?Constructor\]$/,
  dj = Function.prototype,
  hj = Object.prototype,
  fj = dj.toString,
  pj = hj.hasOwnProperty,
  mj = RegExp("^" + fj.call(pj).replace(cj, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$");
function gj(n) {
  if (!ui(n) || oC(n)) return !1;
  var t = Ry(n) ? mj : uj;
  return t.test(la(n));
}
var aC = gj;
function yj(n, t) {
  return n === null || n === void 0 ? void 0 : n[t];
}
var lC = yj;
function vj(n, t) {
  var e = lC(n, t);
  return aC(e) ? e : void 0;
}
var En = vj;
var xj = En(kr, "WeakMap"),
  By = xj;
var cC = Object.create,
  bj = function () {
    function n() {}
    return function (t) {
      if (!ui(t)) return {};
      if (cC) return cC(t);
      n.prototype = t;
      var e = new n();
      return n.prototype = void 0, e;
    };
  }(),
  uC = bj;
function Sj(n, t, e) {
  switch (e.length) {
    case 0:
      return n.call(t);
    case 1:
      return n.call(t, e[0]);
    case 2:
      return n.call(t, e[0], e[1]);
    case 3:
      return n.call(t, e[0], e[1], e[2]);
  }
  return n.apply(t, e);
}
var dC = Sj;
function wj(n, t) {
  var e = -1,
    r = n.length;
  for (t || (t = Array(r)); ++e < r;) t[e] = n[e];
  return t;
}
var hC = wj;
var Aj = 800,
  _j = 16,
  Ej = Date.now;
function Tj(n) {
  var t = 0,
    e = 0;
  return function () {
    var r = Ej(),
      i = _j - (r - e);
    if (e = r, i > 0) {
      if (++t >= Aj) return arguments[0];
    } else t = 0;
    return n.apply(void 0, arguments);
  };
}
var fC = Tj;
function Mj(n) {
  return function () {
    return n;
  };
}
var pC = Mj;
var Cj = function () {
    try {
      var n = En(Object, "defineProperty");
      return n({}, "", {}), n;
    } catch (_unused12) {}
  }(),
  od = Cj;
var Pj = od ? function (n, t) {
    return od(n, "toString", {
      configurable: !0,
      enumerable: !1,
      value: pC(t),
      writable: !0
    });
  } : nC,
  mC = Pj;
var Dj = fC(mC),
  gC = Dj;
function Oj(n, t) {
  for (var e = -1, r = n == null ? 0 : n.length; ++e < r && t(n[e], e, n) !== !1;);
  return n;
}
var yC = Oj;
var Ij = 9007199254740991,
  Rj = /^(?:0|[1-9]\d*)$/;
function Lj(n, t) {
  var _t3;
  var e = _typeof(n);
  return t = (_t3 = t) !== null && _t3 !== void 0 ? _t3 : Ij, !!t && (e == "number" || e != "symbol" && Rj.test(n)) && n > -1 && n % 1 == 0 && n < t;
}
var ad = Lj;
function Bj(n, t, e) {
  t == "__proto__" && od ? od(n, t, {
    configurable: !0,
    enumerable: !0,
    value: e,
    writable: !0
  }) : n[t] = e;
}
var Ny = Bj;
function Nj(n, t) {
  return n === t || n !== n && t !== t;
}
var ld = Nj;
var Fj = Object.prototype,
  kj = Fj.hasOwnProperty;
function zj(n, t, e) {
  var r = n[t];
  (!(kj.call(n, t) && ld(r, e)) || e === void 0 && !(t in n)) && Ny(n, t, e);
}
var cd = zj;
function Vj(n, t, e, r) {
  var i = !e;
  e || (e = {});
  for (var s = -1, o = t.length; ++s < o;) {
    var a = t[s],
      l = r ? r(e[a], n[a], a, e, n) : void 0;
    l === void 0 && (l = n[a]), i ? Ny(e, a, l) : cd(e, a, l);
  }
  return e;
}
var ho = Vj;
var vC = Math.max;
function Uj(n, t, e) {
  return t = vC(t === void 0 ? n.length - 1 : t, 0), function () {
    for (var r = arguments, i = -1, s = vC(r.length - t, 0), o = Array(s); ++i < s;) o[i] = r[t + i];
    i = -1;
    for (var a = Array(t + 1); ++i < t;) a[i] = r[i];
    return a[t] = e(o), dC(n, this, a);
  };
}
var xC = Uj;
var Gj = 9007199254740991;
function jj(n) {
  return typeof n == "number" && n > -1 && n % 1 == 0 && n <= Gj;
}
var ud = jj;
function Hj(n) {
  return n != null && ud(n.length) && !Ry(n);
}
var Fy = Hj;
var Wj = Object.prototype;
function qj(n) {
  var t = n && n.constructor,
    e = typeof t == "function" && t.prototype || Wj;
  return n === e;
}
var dd = qj;
function Yj(n, t) {
  for (var e = -1, r = Array(n); ++e < n;) r[e] = t(e);
  return r;
}
var bC = Yj;
var Xj = "[object Arguments]";
function Qj(n) {
  return Yi(n) && Xn(n) == Xj;
}
var Tw = Qj;
var SC = Object.prototype,
  Kj = SC.hasOwnProperty,
  Zj = SC.propertyIsEnumerable,
  Jj = Tw(function () {
    return arguments;
  }()) ? Tw : function (n) {
    return Yi(n) && Kj.call(n, "callee") && !Zj.call(n, "callee");
  },
  hd = Jj;
function $j() {
  return !1;
}
var wC = $j;
var EC = (typeof exports === "undefined" ? "undefined" : _typeof(exports)) == "object" && exports && !exports.nodeType && exports,
  AC = EC && (typeof module === "undefined" ? "undefined" : _typeof(module)) == "object" && module && !module.nodeType && module,
  eH = AC && AC.exports === EC,
  _C = eH ? kr.Buffer : void 0,
  tH = _C ? _C.isBuffer : void 0,
  rH = tH || wC,
  wc = rH;
var iH = "[object Arguments]",
  nH = "[object Array]",
  sH = "[object Boolean]",
  oH = "[object Date]",
  aH = "[object Error]",
  lH = "[object Function]",
  cH = "[object Map]",
  uH = "[object Number]",
  dH = "[object Object]",
  hH = "[object RegExp]",
  fH = "[object Set]",
  pH = "[object String]",
  mH = "[object WeakMap]",
  gH = "[object ArrayBuffer]",
  yH = "[object DataView]",
  vH = "[object Float32Array]",
  xH = "[object Float64Array]",
  bH = "[object Int8Array]",
  SH = "[object Int16Array]",
  wH = "[object Int32Array]",
  AH = "[object Uint8Array]",
  _H = "[object Uint8ClampedArray]",
  EH = "[object Uint16Array]",
  TH = "[object Uint32Array]",
  Sr = {};
Sr[vH] = Sr[xH] = Sr[bH] = Sr[SH] = Sr[wH] = Sr[AH] = Sr[_H] = Sr[EH] = Sr[TH] = !0;
Sr[iH] = Sr[nH] = Sr[gH] = Sr[sH] = Sr[yH] = Sr[oH] = Sr[aH] = Sr[lH] = Sr[cH] = Sr[uH] = Sr[dH] = Sr[hH] = Sr[fH] = Sr[pH] = Sr[mH] = !1;
function MH(n) {
  return Yi(n) && ud(n.length) && !!Sr[Xn(n)];
}
var TC = MH;
function CH(n) {
  return function (t) {
    return n(t);
  };
}
var fd = CH;
var MC = (typeof exports === "undefined" ? "undefined" : _typeof(exports)) == "object" && exports && !exports.nodeType && exports,
  Op = MC && (typeof module === "undefined" ? "undefined" : _typeof(module)) == "object" && module && !module.nodeType && module,
  PH = Op && Op.exports === MC,
  Mw = PH && Oy.process,
  DH = function () {
    try {
      var n = Op && Op.require && Op.require("util").types;
      return n || Mw && Mw.binding && Mw.binding("util");
    } catch (_unused13) {}
  }(),
  ca = DH;
var CC = ca && ca.isTypedArray,
  OH = CC ? fd(CC) : TC,
  ky = OH;
var IH = Object.prototype,
  RH = IH.hasOwnProperty;
function LH(n, t) {
  var e = bi(n),
    r = !e && hd(n),
    i = !e && !r && wc(n),
    s = !e && !r && !i && ky(n),
    o = e || r || i || s,
    a = o ? bC(n.length, String) : [],
    l = a.length;
  for (var u in n) (t || RH.call(n, u)) && !(o && (u == "length" || i && (u == "offset" || u == "parent") || s && (u == "buffer" || u == "byteLength" || u == "byteOffset") || ad(u, l))) && a.push(u);
  return a;
}
var zy = LH;
function BH(n, t) {
  return function (e) {
    return n(t(e));
  };
}
var Vy = BH;
var NH = Vy(Object.keys, Object),
  PC = NH;
var FH = Object.prototype,
  kH = FH.hasOwnProperty;
function zH(n) {
  if (!dd(n)) return PC(n);
  var t = [];
  for (var e in Object(n)) kH.call(n, e) && e != "constructor" && t.push(e);
  return t;
}
var DC = zH;
function VH(n) {
  return Fy(n) ? zy(n) : DC(n);
}
var pd = VH;
function UH(n) {
  var t = [];
  if (n != null) for (var e in Object(n)) t.push(e);
  return t;
}
var OC = UH;
var GH = Object.prototype,
  jH = GH.hasOwnProperty;
function HH(n) {
  if (!ui(n)) return OC(n);
  var t = dd(n),
    e = [];
  for (var r in n) r == "constructor" && (t || !jH.call(n, r)) || e.push(r);
  return e;
}
var IC = HH;
function WH(n) {
  return Fy(n) ? zy(n, !0) : IC(n);
}
var as = WH;
var qH = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,
  YH = /^\w*$/;
function XH(n, t) {
  if (bi(n)) return !1;
  var e = _typeof(n);
  return e == "number" || e == "symbol" || e == "boolean" || n == null || al(n) ? !0 : YH.test(n) || !qH.test(n) || t != null && n in Object(t);
}
var RC = XH;
var QH = En(Object, "create"),
  ua = QH;
function KH() {
  this.__data__ = ua ? ua(null) : {}, this.size = 0;
}
var LC = KH;
function ZH(n) {
  var t = this.has(n) && delete this.__data__[n];
  return this.size -= t ? 1 : 0, t;
}
var BC = ZH;
var JH = "__lodash_hash_undefined__",
  $H = Object.prototype,
  e5 = $H.hasOwnProperty;
function t5(n) {
  var t = this.__data__;
  if (ua) {
    var e = t[n];
    return e === JH ? void 0 : e;
  }
  return e5.call(t, n) ? t[n] : void 0;
}
var NC = t5;
var r5 = Object.prototype,
  i5 = r5.hasOwnProperty;
function n5(n) {
  var t = this.__data__;
  return ua ? t[n] !== void 0 : i5.call(t, n);
}
var FC = n5;
var s5 = "__lodash_hash_undefined__";
function o5(n, t) {
  var e = this.__data__;
  return this.size += this.has(n) ? 0 : 1, e[n] = ua && t === void 0 ? s5 : t, this;
}
var kC = o5;
function md(n) {
  var t = -1,
    e = n == null ? 0 : n.length;
  for (this.clear(); ++t < e;) {
    var r = n[t];
    this.set(r[0], r[1]);
  }
}
md.prototype.clear = LC;
md.prototype.delete = BC;
md.prototype.get = NC;
md.prototype.has = FC;
md.prototype.set = kC;
var Cw = md;
function a5() {
  this.__data__ = [], this.size = 0;
}
var zC = a5;
function l5(n, t) {
  for (var e = n.length; e--;) if (ld(n[e][0], t)) return e;
  return -1;
}
var ll = l5;
var c5 = Array.prototype,
  u5 = c5.splice;
function d5(n) {
  var t = this.__data__,
    e = ll(t, n);
  if (e < 0) return !1;
  var r = t.length - 1;
  return e == r ? t.pop() : u5.call(t, e, 1), --this.size, !0;
}
var VC = d5;
function h5(n) {
  var t = this.__data__,
    e = ll(t, n);
  return e < 0 ? void 0 : t[e][1];
}
var UC = h5;
function f5(n) {
  return ll(this.__data__, n) > -1;
}
var GC = f5;
function p5(n, t) {
  var e = this.__data__,
    r = ll(e, n);
  return r < 0 ? (++this.size, e.push([n, t])) : e[r][1] = t, this;
}
var jC = p5;
function gd(n) {
  var t = -1,
    e = n == null ? 0 : n.length;
  for (this.clear(); ++t < e;) {
    var r = n[t];
    this.set(r[0], r[1]);
  }
}
gd.prototype.clear = zC;
gd.prototype.delete = VC;
gd.prototype.get = UC;
gd.prototype.has = GC;
gd.prototype.set = jC;
var cl = gd;
var m5 = En(kr, "Map"),
  ul = m5;
function g5() {
  this.size = 0, this.__data__ = {
    hash: new Cw(),
    map: new (ul || cl)(),
    string: new Cw()
  };
}
var HC = g5;
function y5(n) {
  var t = _typeof(n);
  return t == "string" || t == "number" || t == "symbol" || t == "boolean" ? n !== "__proto__" : n === null;
}
var WC = y5;
function v5(n, t) {
  var e = n.__data__;
  return WC(t) ? e[typeof t == "string" ? "string" : "hash"] : e.map;
}
var dl = v5;
function x5(n) {
  var t = dl(this, n).delete(n);
  return this.size -= t ? 1 : 0, t;
}
var qC = x5;
function b5(n) {
  return dl(this, n).get(n);
}
var YC = b5;
function S5(n) {
  return dl(this, n).has(n);
}
var XC = S5;
function w5(n, t) {
  var e = dl(this, n),
    r = e.size;
  return e.set(n, t), this.size += e.size == r ? 0 : 1, this;
}
var QC = w5;
function yd(n) {
  var t = -1,
    e = n == null ? 0 : n.length;
  for (this.clear(); ++t < e;) {
    var r = n[t];
    this.set(r[0], r[1]);
  }
}
yd.prototype.clear = HC;
yd.prototype.delete = qC;
yd.prototype.get = YC;
yd.prototype.has = XC;
yd.prototype.set = QC;
var Ac = yd;
var A5 = "Expected a function";
function Pw(n, t) {
  if (typeof n != "function" || t != null && typeof t != "function") throw new TypeError(A5);
  var e = function e() {
    var r = arguments,
      i = t ? t.apply(this, r) : r[0],
      s = e.cache;
    if (s.has(i)) return s.get(i);
    var o = n.apply(this, r);
    return e.cache = s.set(i, o) || s, o;
  };
  return e.cache = new (Pw.Cache || Ac)(), e;
}
Pw.Cache = Ac;
var KC = Pw;
var _5 = 500;
function E5(n) {
  var t = KC(n, function (r) {
      return e.size === _5 && e.clear(), r;
    }),
    e = t.cache;
  return t;
}
var ZC = E5;
var T5 = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,
  M5 = /\\(\\)?/g,
  C5 = ZC(function (n) {
    var t = [];
    return n.charCodeAt(0) === 46 && t.push(""), n.replace(T5, function (e, r, i, s) {
      t.push(i ? s.replace(M5, "$1") : r || e);
    }), t;
  }),
  JC = C5;
function P5(n) {
  return n == null ? "" : eC(n);
}
var $C = P5;
function D5(n, t) {
  return bi(n) ? n : RC(n, t) ? [n] : JC($C(n));
}
var ls = D5;
var O5 = 1 / 0;
function I5(n) {
  if (typeof n == "string" || al(n)) return n;
  var t = n + "";
  return t == "0" && 1 / n == -O5 ? "-0" : t;
}
var hl = I5;
function R5(n, t) {
  t = ls(t, n);
  for (var e = 0, r = t.length; n != null && e < r;) n = n[hl(t[e++])];
  return e && e == r ? n : void 0;
}
var Uy = R5;
function L5(n, t) {
  for (var e = -1, r = t.length, i = n.length; ++e < r;) n[i + e] = t[e];
  return n;
}
var vd = L5;
var eP = Li ? Li.isConcatSpreadable : void 0;
function B5(n) {
  return bi(n) || hd(n) || !!(eP && n && n[eP]);
}
var tP = B5;
function rP(n, t, e, r, i) {
  var s = -1,
    o = n.length;
  for (e || (e = tP), i || (i = []); ++s < o;) {
    var a = n[s];
    t > 0 && e(a) ? t > 1 ? rP(a, t - 1, e, r, i) : vd(i, a) : r || (i[i.length] = a);
  }
  return i;
}
var iP = rP;
function N5(n) {
  var t = n == null ? 0 : n.length;
  return t ? iP(n, 1) : [];
}
var nP = N5;
function F5(n) {
  return gC(xC(n, void 0, nP), n + "");
}
var Gy = F5;
var k5 = Vy(Object.getPrototypeOf, Object),
  xd = k5;
var z5 = "[object Object]",
  V5 = Function.prototype,
  U5 = Object.prototype,
  sP = V5.toString,
  G5 = U5.hasOwnProperty,
  j5 = sP.call(Object);
function H5(n) {
  if (!Yi(n) || Xn(n) != z5) return !1;
  var t = xd(n);
  if (t === null) return !0;
  var e = G5.call(t, "constructor") && t.constructor;
  return typeof e == "function" && e instanceof e && sP.call(e) == j5;
}
var oP = H5;
function W5(n, t, e) {
  var r = -1,
    i = n.length;
  t < 0 && (t = -t > i ? 0 : i + t), e = e > i ? i : e, e < 0 && (e += i), i = t > e ? 0 : e - t >>> 0, t >>>= 0;
  for (var s = Array(i); ++r < i;) s[r] = n[r + t];
  return s;
}
var aP = W5;
function q5() {
  this.__data__ = new cl(), this.size = 0;
}
var lP = q5;
function Y5(n) {
  var t = this.__data__,
    e = t.delete(n);
  return this.size = t.size, e;
}
var cP = Y5;
function X5(n) {
  return this.__data__.get(n);
}
var uP = X5;
function Q5(n) {
  return this.__data__.has(n);
}
var dP = Q5;
var K5 = 200;
function Z5(n, t) {
  var e = this.__data__;
  if (e instanceof cl) {
    var r = e.__data__;
    if (!ul || r.length < K5 - 1) return r.push([n, t]), this.size = ++e.size, this;
    e = this.__data__ = new Ac(r);
  }
  return e.set(n, t), this.size = e.size, this;
}
var hP = Z5;
function bd(n) {
  var t = this.__data__ = new cl(n);
  this.size = t.size;
}
bd.prototype.clear = lP;
bd.prototype.delete = cP;
bd.prototype.get = uP;
bd.prototype.has = dP;
bd.prototype.set = hP;
var Sd = bd;
function J5(n, t) {
  return n && ho(t, pd(t), n);
}
var fP = J5;
function $5(n, t) {
  return n && ho(t, as(t), n);
}
var pP = $5;
var vP = (typeof exports === "undefined" ? "undefined" : _typeof(exports)) == "object" && exports && !exports.nodeType && exports,
  mP = vP && (typeof module === "undefined" ? "undefined" : _typeof(module)) == "object" && module && !module.nodeType && module,
  eW = mP && mP.exports === vP,
  gP = eW ? kr.Buffer : void 0,
  yP = gP ? gP.allocUnsafe : void 0;
function tW(n, t) {
  if (t) return n.slice();
  var e = n.length,
    r = yP ? yP(e) : new n.constructor(e);
  return n.copy(r), r;
}
var xP = tW;
function rW(n, t) {
  for (var e = -1, r = n == null ? 0 : n.length, i = 0, s = []; ++e < r;) {
    var o = n[e];
    t(o, e, n) && (s[i++] = o);
  }
  return s;
}
var bP = rW;
function iW() {
  return [];
}
var jy = iW;
var nW = Object.prototype,
  sW = nW.propertyIsEnumerable,
  SP = Object.getOwnPropertySymbols,
  oW = SP ? function (n) {
    return n == null ? [] : (n = Object(n), bP(SP(n), function (t) {
      return sW.call(n, t);
    }));
  } : jy,
  wd = oW;
function aW(n, t) {
  return ho(n, wd(n), t);
}
var wP = aW;
var lW = Object.getOwnPropertySymbols,
  cW = lW ? function (n) {
    for (var t = []; n;) vd(t, wd(n)), n = xd(n);
    return t;
  } : jy,
  Hy = cW;
function uW(n, t) {
  return ho(n, Hy(n), t);
}
var AP = uW;
function dW(n, t, e) {
  var r = t(n);
  return bi(n) ? r : vd(r, e(n));
}
var Wy = dW;
function hW(n) {
  return Wy(n, pd, wd);
}
var Ip = hW;
function fW(n) {
  return Wy(n, as, Hy);
}
var qy = fW;
var pW = En(kr, "DataView"),
  Yy = pW;
var mW = En(kr, "Promise"),
  Xy = mW;
var gW = En(kr, "Set"),
  Qy = gW;
var _P = "[object Map]",
  yW = "[object Object]",
  EP = "[object Promise]",
  TP = "[object Set]",
  MP = "[object WeakMap]",
  CP = "[object DataView]",
  vW = la(Yy),
  xW = la(ul),
  bW = la(Xy),
  SW = la(Qy),
  wW = la(By),
  _c = Xn;
(Yy && _c(new Yy(new ArrayBuffer(1))) != CP || ul && _c(new ul()) != _P || Xy && _c(Xy.resolve()) != EP || Qy && _c(new Qy()) != TP || By && _c(new By()) != MP) && (_c = function _c(n) {
  var t = Xn(n),
    e = t == yW ? n.constructor : void 0,
    r = e ? la(e) : "";
  if (r) switch (r) {
    case vW:
      return CP;
    case xW:
      return _P;
    case bW:
      return EP;
    case SW:
      return TP;
    case wW:
      return MP;
  }
  return t;
});
var da = _c;
var AW = Object.prototype,
  _W = AW.hasOwnProperty;
function EW(n) {
  var t = n.length,
    e = new n.constructor(t);
  return t && typeof n[0] == "string" && _W.call(n, "index") && (e.index = n.index, e.input = n.input), e;
}
var PP = EW;
var TW = kr.Uint8Array,
  Ad = TW;
function MW(n) {
  var t = new n.constructor(n.byteLength);
  return new Ad(t).set(new Ad(n)), t;
}
var _d = MW;
function CW(n, t) {
  var e = t ? _d(n.buffer) : n.buffer;
  return new n.constructor(e, n.byteOffset, n.byteLength);
}
var DP = CW;
var PW = /\w*$/;
function DW(n) {
  var t = new n.constructor(n.source, PW.exec(n));
  return t.lastIndex = n.lastIndex, t;
}
var OP = DW;
var IP = Li ? Li.prototype : void 0,
  RP = IP ? IP.valueOf : void 0;
function OW(n) {
  return RP ? Object(RP.call(n)) : {};
}
var LP = OW;
function IW(n, t) {
  var e = t ? _d(n.buffer) : n.buffer;
  return new n.constructor(e, n.byteOffset, n.length);
}
var BP = IW;
var RW = "[object Boolean]",
  LW = "[object Date]",
  BW = "[object Map]",
  NW = "[object Number]",
  FW = "[object RegExp]",
  kW = "[object Set]",
  zW = "[object String]",
  VW = "[object Symbol]",
  UW = "[object ArrayBuffer]",
  GW = "[object DataView]",
  jW = "[object Float32Array]",
  HW = "[object Float64Array]",
  WW = "[object Int8Array]",
  qW = "[object Int16Array]",
  YW = "[object Int32Array]",
  XW = "[object Uint8Array]",
  QW = "[object Uint8ClampedArray]",
  KW = "[object Uint16Array]",
  ZW = "[object Uint32Array]";
function JW(n, t, e) {
  var r = n.constructor;
  switch (t) {
    case UW:
      return _d(n);
    case RW:
    case LW:
      return new r(+n);
    case GW:
      return DP(n, e);
    case jW:
    case HW:
    case WW:
    case qW:
    case YW:
    case XW:
    case QW:
    case KW:
    case ZW:
      return BP(n, e);
    case BW:
      return new r();
    case NW:
    case zW:
      return new r(n);
    case FW:
      return OP(n);
    case kW:
      return new r();
    case VW:
      return LP(n);
  }
}
var NP = JW;
function $W(n) {
  return typeof n.constructor == "function" && !dd(n) ? uC(xd(n)) : {};
}
var FP = $W;
var e6 = "[object Map]";
function t6(n) {
  return Yi(n) && da(n) == e6;
}
var kP = t6;
var zP = ca && ca.isMap,
  r6 = zP ? fd(zP) : kP,
  VP = r6;
var i6 = "[object Set]";
function n6(n) {
  return Yi(n) && da(n) == i6;
}
var UP = n6;
var GP = ca && ca.isSet,
  s6 = GP ? fd(GP) : UP,
  jP = s6;
var o6 = 1,
  a6 = 2,
  l6 = 4,
  HP = "[object Arguments]",
  c6 = "[object Array]",
  u6 = "[object Boolean]",
  d6 = "[object Date]",
  h6 = "[object Error]",
  WP = "[object Function]",
  f6 = "[object GeneratorFunction]",
  p6 = "[object Map]",
  m6 = "[object Number]",
  qP = "[object Object]",
  g6 = "[object RegExp]",
  y6 = "[object Set]",
  v6 = "[object String]",
  x6 = "[object Symbol]",
  b6 = "[object WeakMap]",
  S6 = "[object ArrayBuffer]",
  w6 = "[object DataView]",
  A6 = "[object Float32Array]",
  _6 = "[object Float64Array]",
  E6 = "[object Int8Array]",
  T6 = "[object Int16Array]",
  M6 = "[object Int32Array]",
  C6 = "[object Uint8Array]",
  P6 = "[object Uint8ClampedArray]",
  D6 = "[object Uint16Array]",
  O6 = "[object Uint32Array]",
  xr = {};
xr[HP] = xr[c6] = xr[S6] = xr[w6] = xr[u6] = xr[d6] = xr[A6] = xr[_6] = xr[E6] = xr[T6] = xr[M6] = xr[p6] = xr[m6] = xr[qP] = xr[g6] = xr[y6] = xr[v6] = xr[x6] = xr[C6] = xr[P6] = xr[D6] = xr[O6] = !0;
xr[h6] = xr[WP] = xr[b6] = !1;
function Ky(n, t, e, r, i, s) {
  var o,
    a = t & o6,
    l = t & a6,
    u = t & l6;
  if (e && (o = i ? e(n, r, i, s) : e(n)), o !== void 0) return o;
  if (!ui(n)) return n;
  var c = bi(n);
  if (c) {
    if (o = PP(n), !a) return hC(n, o);
  } else {
    var d = da(n),
      h = d == WP || d == f6;
    if (wc(n)) return xP(n, a);
    if (d == qP || d == HP || h && !i) {
      if (o = l || h ? {} : FP(n), !a) return l ? AP(n, pP(o, n)) : wP(n, fP(o, n));
    } else {
      if (!xr[d]) return i ? n : {};
      o = NP(n, d, a);
    }
  }
  s || (s = new Sd());
  var f = s.get(n);
  if (f) return f;
  s.set(n, o), jP(n) ? n.forEach(function (g) {
    o.add(Ky(g, t, e, g, n, s));
  }) : VP(n) && n.forEach(function (g, y) {
    o.set(y, Ky(g, t, e, y, n, s));
  });
  var p = u ? l ? qy : Ip : l ? as : pd,
    m = c ? void 0 : p(n);
  return yC(m || n, function (g, y) {
    m && (y = g, g = n[y]), cd(o, y, Ky(g, t, e, y, n, s));
  }), o;
}
var Zy = Ky;
var I6 = 1,
  R6 = 4;
function L6(n) {
  return Zy(n, I6 | R6);
}
var ha = L6;
var B6 = "__lodash_hash_undefined__";
function N6(n) {
  return this.__data__.set(n, B6), this;
}
var YP = N6;
function F6(n) {
  return this.__data__.has(n);
}
var XP = F6;
function Jy(n) {
  var t = -1,
    e = n == null ? 0 : n.length;
  for (this.__data__ = new Ac(); ++t < e;) this.add(n[t]);
}
Jy.prototype.add = Jy.prototype.push = YP;
Jy.prototype.has = XP;
var QP = Jy;
function k6(n, t) {
  for (var e = -1, r = n == null ? 0 : n.length; ++e < r;) if (t(n[e], e, n)) return !0;
  return !1;
}
var KP = k6;
function z6(n, t) {
  return n.has(t);
}
var ZP = z6;
var V6 = 1,
  U6 = 2;
function G6(n, t, e, r, i, s) {
  var o = e & V6,
    a = n.length,
    l = t.length;
  if (a != l && !(o && l > a)) return !1;
  var u = s.get(n),
    c = s.get(t);
  if (u && c) return u == t && c == n;
  var d = -1,
    h = !0,
    f = e & U6 ? new QP() : void 0;
  for (s.set(n, t), s.set(t, n); ++d < a;) {
    var p = n[d],
      m = t[d];
    if (r) var g = o ? r(m, p, d, t, n, s) : r(p, m, d, n, t, s);
    if (g !== void 0) {
      if (g) continue;
      h = !1;
      break;
    }
    if (f) {
      if (!KP(t, function (y, v) {
        if (!ZP(f, v) && (p === y || i(p, y, e, r, s))) return f.push(v);
      })) {
        h = !1;
        break;
      }
    } else if (!(p === m || i(p, m, e, r, s))) {
      h = !1;
      break;
    }
  }
  return s.delete(n), s.delete(t), h;
}
var $y = G6;
function j6(n) {
  var t = -1,
    e = Array(n.size);
  return n.forEach(function (r, i) {
    e[++t] = [i, r];
  }), e;
}
var JP = j6;
function H6(n) {
  var t = -1,
    e = Array(n.size);
  return n.forEach(function (r) {
    e[++t] = r;
  }), e;
}
var $P = H6;
var W6 = 1,
  q6 = 2,
  Y6 = "[object Boolean]",
  X6 = "[object Date]",
  Q6 = "[object Error]",
  K6 = "[object Map]",
  Z6 = "[object Number]",
  J6 = "[object RegExp]",
  $6 = "[object Set]",
  e8 = "[object String]",
  t8 = "[object Symbol]",
  r8 = "[object ArrayBuffer]",
  i8 = "[object DataView]",
  e2 = Li ? Li.prototype : void 0,
  Dw = e2 ? e2.valueOf : void 0;
function n8(n, t, e, r, i, s, o) {
  switch (e) {
    case i8:
      if (n.byteLength != t.byteLength || n.byteOffset != t.byteOffset) return !1;
      n = n.buffer, t = t.buffer;
    case r8:
      return !(n.byteLength != t.byteLength || !s(new Ad(n), new Ad(t)));
    case Y6:
    case X6:
    case Z6:
      return ld(+n, +t);
    case Q6:
      return n.name == t.name && n.message == t.message;
    case J6:
    case e8:
      return n == t + "";
    case K6:
      var a = JP;
    case $6:
      var l = r & W6;
      if (a || (a = $P), n.size != t.size && !l) return !1;
      var u = o.get(n);
      if (u) return u == t;
      r |= q6, o.set(n, t);
      var c = $y(a(n), a(t), r, i, s, o);
      return o.delete(n), c;
    case t8:
      if (Dw) return Dw.call(n) == Dw.call(t);
  }
  return !1;
}
var t2 = n8;
var s8 = 1,
  o8 = Object.prototype,
  a8 = o8.hasOwnProperty;
function l8(n, t, e, r, i, s) {
  var o = e & s8,
    a = Ip(n),
    l = a.length,
    u = Ip(t),
    c = u.length;
  if (l != c && !o) return !1;
  for (var d = l; d--;) {
    var h = a[d];
    if (!(o ? h in t : a8.call(t, h))) return !1;
  }
  var f = s.get(n),
    p = s.get(t);
  if (f && p) return f == t && p == n;
  var m = !0;
  s.set(n, t), s.set(t, n);
  for (var g = o; ++d < l;) {
    h = a[d];
    var y = n[h],
      v = t[h];
    if (r) var x = o ? r(v, y, h, t, n, s) : r(y, v, h, n, t, s);
    if (!(x === void 0 ? y === v || i(y, v, e, r, s) : x)) {
      m = !1;
      break;
    }
    g || (g = h == "constructor");
  }
  if (m && !g) {
    var S = n.constructor,
      w = t.constructor;
    S != w && "constructor" in n && "constructor" in t && !(typeof S == "function" && S instanceof S && typeof w == "function" && w instanceof w) && (m = !1);
  }
  return s.delete(n), s.delete(t), m;
}
var r2 = l8;
var c8 = 1,
  i2 = "[object Arguments]",
  n2 = "[object Array]",
  ev = "[object Object]",
  u8 = Object.prototype,
  s2 = u8.hasOwnProperty;
function d8(n, t, e, r, i, s) {
  var o = bi(n),
    a = bi(t),
    l = o ? n2 : da(n),
    u = a ? n2 : da(t);
  l = l == i2 ? ev : l, u = u == i2 ? ev : u;
  var c = l == ev,
    d = u == ev,
    h = l == u;
  if (h && wc(n)) {
    if (!wc(t)) return !1;
    o = !0, c = !1;
  }
  if (h && !c) return s || (s = new Sd()), o || ky(n) ? $y(n, t, e, r, i, s) : t2(n, t, l, e, r, i, s);
  if (!(e & c8)) {
    var f = c && s2.call(n, "__wrapped__"),
      p = d && s2.call(t, "__wrapped__");
    if (f || p) {
      var m = f ? n.value() : n,
        g = p ? t.value() : t;
      return s || (s = new Sd()), i(m, g, e, r, s);
    }
  }
  return h ? (s || (s = new Sd()), r2(n, t, e, r, i, s)) : !1;
}
var o2 = d8;
function a2(n, t, e, r, i) {
  return n === t ? !0 : n == null || t == null || !Yi(n) && !Yi(t) ? n !== n && t !== t : o2(n, t, e, r, a2, i);
}
var l2 = a2;
function h8(n, t) {
  return n != null && t in Object(n);
}
var c2 = h8;
function f8(n, t, e) {
  t = ls(t, n);
  for (var r = -1, i = t.length, s = !1; ++r < i;) {
    var o = hl(t[r]);
    if (!(s = n != null && e(n, o))) break;
    n = n[o];
  }
  return s || ++r != i ? s : (i = n == null ? 0 : n.length, !!i && ud(i) && ad(o, i) && (bi(n) || hd(n)));
}
var u2 = f8;
function p8(n, t) {
  return n != null && u2(n, t, c2);
}
var d2 = p8;
var m8 = function m8() {
    return kr.Date.now();
  },
  tv = m8;
var g8 = "Expected a function",
  y8 = Math.max,
  v8 = Math.min;
function x8(n, t, e) {
  var r,
    i,
    s,
    o,
    a,
    l,
    u = 0,
    c = !1,
    d = !1,
    h = !0;
  if (typeof n != "function") throw new TypeError(g8);
  t = Ew(t) || 0, ui(e) && (c = !!e.leading, d = "maxWait" in e, s = d ? y8(Ew(e.maxWait) || 0, t) : s, h = "trailing" in e ? !!e.trailing : h);
  function f(A) {
    var E = r,
      b = i;
    return r = i = void 0, u = A, o = n.apply(b, E), o;
  }
  function p(A) {
    return u = A, a = setTimeout(y, t), c ? f(A) : o;
  }
  function m(A) {
    var E = A - l,
      b = A - u,
      T = t - E;
    return d ? v8(T, s - b) : T;
  }
  function g(A) {
    var E = A - l,
      b = A - u;
    return l === void 0 || E >= t || E < 0 || d && b >= s;
  }
  function y() {
    var A = tv();
    if (g(A)) return v(A);
    a = setTimeout(y, m(A));
  }
  function v(A) {
    return a = void 0, h && r ? f(A) : (r = i = void 0, o);
  }
  function x() {
    a !== void 0 && clearTimeout(a), u = 0, r = l = i = a = void 0;
  }
  function S() {
    return a === void 0 ? o : v(tv());
  }
  function w() {
    var A = tv(),
      E = g(A);
    if (r = arguments, i = this, l = A, E) {
      if (a === void 0) return p(l);
      if (d) return clearTimeout(a), a = setTimeout(y, t), f(l);
    }
    return a === void 0 && (a = setTimeout(y, t)), o;
  }
  return w.cancel = x, w.flush = S, w;
}
var Ec = x8;
function b8(n) {
  var t = n == null ? 0 : n.length;
  return t ? n[t - 1] : void 0;
}
var h2 = b8;
function S8(n, t) {
  return t.length < 2 ? n : Uy(n, aP(t, 0, -1));
}
var f2 = S8;
function w8(n, t) {
  return l2(n, t);
}
var Rp = w8;
function A8(n, t) {
  return t = ls(t, n), n = f2(n, t), n == null || delete n[hl(h2(t))];
}
var p2 = A8;
function _8(n) {
  return oP(n) ? void 0 : n;
}
var m2 = _8;
var E8 = 1,
  T8 = 2,
  M8 = 4,
  C8 = Gy(function (n, t) {
    var e = {};
    if (n == null) return e;
    var r = !1;
    t = Iy(t, function (s) {
      return s = ls(s, n), r || (r = s.length > 1), s;
    }), ho(n, qy(n), e), r && (e = Zy(e, E8 | T8 | M8, m2));
    for (var i = t.length; i--;) p2(e, t[i]);
    return e;
  }),
  Ed = C8;
function P8(n, t, e, r) {
  if (!ui(n)) return n;
  t = ls(t, n);
  for (var i = -1, s = t.length, o = s - 1, a = n; a != null && ++i < s;) {
    var l = hl(t[i]),
      u = e;
    if (l === "__proto__" || l === "constructor" || l === "prototype") return n;
    if (i != o) {
      var c = a[l];
      u = r ? r(c, l, a) : void 0, u === void 0 && (u = ui(c) ? c : ad(t[i + 1]) ? [] : {});
    }
    cd(a, l, u), a = a[l];
  }
  return n;
}
var g2 = P8;
function D8(n, t, e) {
  for (var r = -1, i = t.length, s = {}; ++r < i;) {
    var o = t[r],
      a = Uy(n, o);
    e(a, o) && g2(s, ls(o, n), a);
  }
  return s;
}
var y2 = D8;
function O8(n, t) {
  return y2(n, t, function (e, r) {
    return d2(n, r);
  });
}
var v2 = O8;
var I8 = Gy(function (n, t) {
    return n == null ? {} : v2(n, t);
  }),
  Qn = I8;
var R8 = "Expected a function";
function L8(n, t, e) {
  var r = !0,
    i = !0;
  if (typeof n != "function") throw new TypeError(R8);
  return ui(e) && (r = "leading" in e ? !!e.leading : r, i = "trailing" in e ? !!e.trailing : i), Ec(n, t, {
    leading: r,
    maxWait: t,
    trailing: i
  });
}
var Ow = L8;
function rv(n) {
  for (var _i5 = 0, _Object$keys = Object.keys(n); _i5 < _Object$keys.length; _i5++) {
    var t = _Object$keys[_i5];
    n[t] === void 0 && delete n[t];
  }
  return n;
}
function pn(n, t) {
  return Object.setPrototypeOf(n, t), n;
}
var B8 = function B8() {
    return (typeof window === "undefined" ? "undefined" : _typeof(window)) > "u" ? !1 : window.navigator.userAgent.toLowerCase().includes(" electron/");
  },
  N8 = function N8() {
    return (typeof window === "undefined" ? "undefined" : _typeof(window)) > "u" ? !1 : window.navigator.platform.toUpperCase().includes("MAC");
  },
  F8 = function F8() {
    return (typeof window === "undefined" ? "undefined" : _typeof(window)) > "u" ? !1 : /iPad|iPhone|iPod/.test(window.navigator.userAgent) || Td && "ontouchend" in document;
  },
  k8 = function k8() {
    return (typeof window === "undefined" ? "undefined" : _typeof(window)) > "u" ? !1 : window.navigator.userAgent.toLowerCase().indexOf("firefox") > -1;
  },
  z8 = function z8() {
    return (typeof window === "undefined" ? "undefined" : _typeof(window)) > "u" ? !1 : "ontouchstart" in window || navigator.maxTouchPoints > 0;
  },
  V8 = function V8() {
    if ((typeof window === "undefined" ? "undefined" : _typeof(window)) > "u") return !1;
    var n = navigator.userAgent,
      t = navigator.vendor;
    return /Safari/i.test(n) && /Apple Computer/.test(t);
  },
  U8 = function U8() {
    if ((typeof window === "undefined" ? "undefined" : _typeof(window)) > "u") return null;
    var t = navigator.userAgent.match(/Version\/(\d+\.\d)/);
    return t && t[1];
  },
  G8 = function G8() {
    var _window$localStorage$;
    if ((typeof window === "undefined" ? "undefined" : _typeof(window)) > "u") return;
    var t = new URLSearchParams(window.location.search).get("desktop-app-version");
    return t ? (window.localStorage.setItem("desktop-app-version", t), t) : (_window$localStorage$ = window.localStorage.getItem("desktop-app-version")) !== null && _window$localStorage$ !== void 0 ? _window$localStorage$ : "0.0.6";
  },
  j8 = B8(),
  Sle = j8 ? G8() : void 0,
  Td = N8(),
  Md = F8(),
  x2 = k8(),
  Si = z8(),
  Iw = V8(),
  Rw = Number(U8());
function iv(n) {
  return Array.isArray(n) ? n : [n];
}
function nv(n, t) {
  var e = 0;
  for (; e < n.length && e < t.length;) {
    if (n[e] < t[e]) return -1;
    if (n[e] > t[e]) return 1;
    e += 1;
  }
  return e !== t.length ? -1 : e !== n.length ? 1 : 0;
}
function Lp(n) {
  return Td ? n.metaKey : n.ctrlKey;
}
function b2(n) {
  return n.wheelDeltaY === 0 || n.deltaY === 0 ? Td && n.shiftKey && Math.abs(n.wheelDeltaX) >= 120 ? !1 : n.wheelDeltaX ? n.wheelDeltaX === -3 * n.deltaX || n.wheelDeltaX === -3 * window.devicePixelRatio * n.deltaX : n.deltaMode === 0 : n.wheelDeltaY ? n.wheelDeltaY === -3 * n.deltaY || n.wheelDeltaY === -3 * window.devicePixelRatio * n.deltaY : n.deltaMode === 0;
}
var Ye = [],
  ov = {},
  Bp = {},
  sv = {};
function S2(n) {
  Ye.includes(n) || Ye.push(n);
}
function Cd(n) {
  delete ov[n.pointerId];
  for (var t = 0; t < Ye.length; t++) if (Ye[t].pointerId === n.pointerId) {
    Ye.splice(t, 1);
    break;
  }
}
function w2() {
  Ye.splice(0, Ye.length);
}
function av(n) {
  if (n.pointerType !== "touch") return;
  var t = ov[n.pointerId];
  t === void 0 && (t = {
    x: 0,
    y: 0
  }, ov[n.pointerId] = t), t.x = n.pageX, t.y = n.pageY;
}
function lv(n) {
  var t = n.pointerId === Ye[0].pointerId ? Ye[1] : Ye[0];
  return ov[t.pointerId];
}
function A2(n) {
  Bp[n.key] = !0, sv[n.key] = sv[n.key] === void 0 ? 1 : sv[n.key] + 1;
}
function _2(n) {
  if (Td && Bp.Meta) for (var t in Bp) Bp[t] = !1;else Bp[n.key] = !1;
  sv = {};
}
function E2(n) {
  n.addEventListener("pointerdown", S2, !0), n.addEventListener("pointerdown", av, !0), n.addEventListener("pointermove", av, !0), n.addEventListener("pointerup", Cd, !0), n.addEventListener("pointercancel", Cd, !0), n.addEventListener("pointerleave", Cd, !0), window.addEventListener("keydown", A2, !0), window.addEventListener("keyup", _2, !0);
}
function T2(n) {
  n.removeEventListener("pointerdown", S2, !0), n.removeEventListener("pointerdown", av, !0), n.removeEventListener("pointermove", av, !0), n.removeEventListener("pointerup", Cd, !0), n.removeEventListener("pointercancel", Cd, !0), n.removeEventListener("pointerleave", Cd, !0), window.removeEventListener("keydown", A2, !0), window.removeEventListener("keyup", _2, !0);
}
var M2,
  C2 = new Promise(function (n) {
    M2 = n;
  });
var cv;
function P2() {
  if (cv) return cv;
  function n() {
    return _n2.apply(this, arguments);
  }
  function _n2() {
    _n2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {
      var e, i, _yield$Promise$all, _yield$Promise$all2, s, o, a, l;
      return _regeneratorRuntime().wrap(function _callee2$(_context8) {
        while (1) switch (_context8.prev = _context8.next) {
          case 0:
            e = !1 ? "." : "https://unpkg.com/@splinetool/navmesh-wasm@1.0.17/build";
            i = require("_bundle_loader")(require.resolve("./navmesh.js"));
            _context8.next = 4;
            return Promise.all([i, fetch("".concat(e, "/navmesh.wasm")).then(function (u) {
              return u.arrayBuffer();
            })]);
          case 4:
            _yield$Promise$all = _context8.sent;
            _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);
            s = _yield$Promise$all2[0];
            o = _yield$Promise$all2[1];
            a = s.default;
            _context8.next = 11;
            return a({
              wasmBinary: o
            });
          case 11:
            l = _context8.sent;
            M2(l);
          case 13:
          case "end":
            return _context8.stop();
        }
      }, _callee2);
    }));
    return _n2.apply(this, arguments);
  }
  return cv = n(), cv;
}
var D2,
  O2 = new Promise(function (n) {
    D2 = n;
  });
var uv;
function I2() {
  if (uv) return uv;
  function n() {
    return _n3.apply(this, arguments);
  }
  function _n3() {
    _n3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {
      var e;
      return _regeneratorRuntime().wrap(function _callee3$(_context9) {
        while (1) switch (_context9.prev = _context9.next) {
          case 0:
            _context9.next = 2;
            return require("_bundle_loader")(require.resolve("./physics.js"));
          case 2:
            e = _context9.sent;
            _context9.next = 5;
            return e.init();
          case 5:
            D2(e);
          case 6:
          case "end":
            return _context9.stop();
        }
      }, _callee3);
    }));
    return _n3.apply(this, arguments);
  }
  return uv = n(), uv;
}
var Ke = /*#__PURE__*/function () {
  function Ke() {
    _classCallCheck(this, Ke);
  }
  _createClass(Ke, [{
    key: "modifyById",
    value: function modifyById(t, e) {
      var r = this;
      if (r[t] === void 0) throw new Error("not expected");
      {
        var s = _objectSpread(_objectSpread({}, r), {}, _defineProperty({}, t, e));
        return Object.setPrototypeOf(s, Ke.prototype), s;
      }
    }
  }, {
    key: "add",
    value: function add(t, e) {
      var _this$runOp$data, _this$runOp;
      return (_this$runOp$data = (_this$runOp = this.runOp({
        type: 1,
        id: t,
        data: e
      })) === null || _this$runOp === void 0 ? void 0 : _this$runOp.data) !== null && _this$runOp$data !== void 0 ? _this$runOp$data : this;
    }
  }, {
    key: "runOp",
    value: function runOp(t) {
      var e = this;
      if (t.type === 1) {
        var r = e[t.id],
          i;
        r === void 0 ? i = {
          type: 2,
          id: t.id
        } : i = {
          type: 1,
          id: t.id,
          data: r
        };
        var s = t.id,
          o = t.data,
          a = _objectSpread(_objectSpread({}, e), {}, _defineProperty({}, s, o));
        return Object.setPrototypeOf(a, Ke.prototype), {
          data: a,
          actual: t,
          reverse: i
        };
      } else if (t.type === 2) {
        var _r7 = t.id,
          _i6 = e[_r7];
        if (_i6 === void 0) return null;
        {
          var _s7 = _objectSpread({}, e);
          return Object.setPrototypeOf(_s7, Ke.prototype), delete _s7[_r7], {
            data: _s7,
            actual: t,
            reverse: {
              type: 1,
              id: _r7,
              data: _i6
            }
          };
        }
      }
      return null;
    }
  }]);
  return Ke;
}();
function Np(n) {
  if (n.deepFreeze !== void 0) {
    n.deepFreeze(n);
    return;
  }
  var t = Object.getOwnPropertyNames(n);
  var _iterator16 = _createForOfIteratorHelper(t),
    _step16;
  try {
    for (_iterator16.s(); !(_step16 = _iterator16.n()).done;) {
      var _e17 = _step16.value;
      var r = n[_e17];
      r && _typeof(r) == "object" && Np(r);
    }
  } catch (err) {
    _iterator16.e(err);
  } finally {
    _iterator16.f();
  }
  return Object.freeze(n);
}
function R2(n, t) {
  var e = 0;
  for (; e < n.length && e < t.length;) {
    if (n[e] < t[e]) return -1;
    if (n[e] > t[e]) return 1;
    e += 1;
  }
  return e !== t.length ? -1 : e !== n.length ? 1 : 0;
}
var Pd = /*#__PURE__*/function (_Error2) {
  _inherits(Pd, _Error2);
  var _super99 = _createSuper(Pd);
  function Pd() {
    _classCallCheck(this, Pd);
    return _super99.apply(this, arguments);
  }
  return _createClass(Pd);
}( /*#__PURE__*/_wrapNativeSuper(Error));
function dv(n) {
  var t = _objectSpread({}, n);
  return Object.setPrototypeOf(t, Object.getPrototypeOf(n)), t;
}
function fo(n, t, e) {
  if (n === void 0 ? t === void 0 ? (n = 0, t = 10) : n = t - 10 : t === void 0 && (t = n + 10), n > t) {
    var s = n;
    n = t, t = s;
  }
  var r = [],
    i = 1 / (e + 1);
  for (var _s8 = 0; _s8 < e; _s8++) {
    var o = n + (t - n) * (_s8 + .75 + Math.random() * .5) * i;
    r.push(o);
  }
  return r;
}
function Dd(n) {
  return n instanceof Uint8Array || n instanceof Uint16Array || n instanceof Uint32Array || n instanceof Int8Array || n instanceof Int16Array || n instanceof Int32Array || n instanceof Float32Array || n instanceof Float64Array;
}
function L2() {
  return (typeof process === "undefined" ? "undefined" : _typeof(process)) < "u";
}
function B2(n, t) {
  var _iterator17 = _createForOfIteratorHelper(n),
    _step17;
  try {
    for (_iterator17.s(); !(_step17 = _iterator17.n()).done;) {
      var _e18 = _step17.value;
      t(_e18.id, _e18.data) !== !0 && B2(_e18.children, t);
    }
  } catch (err) {
    _iterator17.e(err);
  } finally {
    _iterator17.f();
  }
}
function N2(n, t) {
  if (t(n.id, n.data) !== !0) {
    var _iterator18 = _createForOfIteratorHelper(n.children),
      _step18;
    try {
      for (_iterator18.s(); !(_step18 = _iterator18.n()).done;) {
        var _e19 = _step18.value;
        N2(_e19, t);
      }
    } catch (err) {
      _iterator18.e(err);
    } finally {
      _iterator18.f();
    }
  }
}
var ar = /*#__PURE__*/function (_Array) {
  _inherits(ar, _Array);
  var _super100 = _createSuper(ar);
  function ar() {
    var _this81;
    _classCallCheck(this, ar);
    for (var _len = arguments.length, e = new Array(_len), _key = 0; _key < _len; _key++) {
      e[_key] = arguments[_key];
    }
    _this81 = _super100.call.apply(_super100, [this].concat(e));
    Object.setPrototypeOf(_assertThisInitialized(_this81), ar.prototype);
    return _this81;
  }
  _createClass(ar, [{
    key: "deepFreeze",
    value: function deepFreeze() {
      var e = 0;
      for (; e < this.length;) Np(this[e]), e++;
    }
  }, {
    key: "fillCaches0",
    value: function fillCaches0(e, r) {
      this.objCaches.set(e.id, e), this.parentCaches.set(e.id, r);
      var _iterator19 = _createForOfIteratorHelper(e.children),
        _step19;
      try {
        for (_iterator19.s(); !(_step19 = _iterator19.n()).done;) {
          var i = _step19.value;
          this.fillCaches0(i, e.id);
        }
      } catch (err) {
        _iterator19.e(err);
      } finally {
        _iterator19.f();
      }
    }
  }, {
    key: "fillCaches",
    value: function fillCaches() {
      if (this.objCaches === void 0) {
        this.objCaches = new Map(), this.parentCaches = new Map();
        var _iterator20 = _createForOfIteratorHelper(this),
          _step20;
        try {
          for (_iterator20.s(); !(_step20 = _iterator20.n()).done;) {
            var _e20 = _step20.value;
            this.fillCaches0(_e20, null);
          }
        } catch (err) {
          _iterator20.e(err);
        } finally {
          _iterator20.f();
        }
      }
    }
  }, {
    key: "randomId",
    value: function randomId() {
      this.fillCaches();
      var e = Array.from(this.objCaches.keys());
      if (e.length !== 0) return e[Math.max(0, Math.floor(Math.random() * e.length) - 1)];
    }
  }, {
    key: "nonExistOrDescendantOf",
    value: function nonExistOrDescendantOf(e, r) {
      if (!this.has(e)) return !0;
      for (; e;) {
        var i = this.parent(e);
        if (i === r) return !0;
        e = i;
      }
      return !1;
    }
  }, {
    key: "rootAcestor",
    value: function rootAcestor(e) {
      for (; e;) {
        var r = this.parent(e);
        if (r) e = r;else return e;
      }
      return e;
    }
  }, {
    key: "isDescendantOf",
    value: function isDescendantOf(e, r) {
      for (; e;) {
        var i = this.parent(e);
        if (i === r) return !0;
        e = i;
      }
      return !1;
    }
  }, {
    key: "data",
    value: function data(e) {
      var _this$get;
      return (_this$get = this.get(e)) === null || _this$get === void 0 ? void 0 : _this$get.data;
    }
  }, {
    key: "has",
    value: function has(e) {
      return this.childrenOf(e) !== void 0;
    }
  }, {
    key: "get",
    value: function get(e) {
      return this.fillCaches(), this.objCaches.get(e);
    }
  }, {
    key: "childrenOf",
    value: function childrenOf(e) {
      var _this$get2;
      return e === null ? this : (_this$get2 = this.get(e)) === null || _this$get2 === void 0 ? void 0 : _this$get2.children;
    }
  }, {
    key: "traverseFrom",
    value: function traverseFrom(e, r) {
      if (e === null) this.traverse(r);else {
        var i = this.get(e);
        i && N2(i, r);
      }
    }
  }, {
    key: "traverse",
    value: function traverse(e) {
      B2(this, e);
    }
  }, {
    key: "totalSize",
    value: function totalSize() {
      return this.fillCaches(), this.objCaches.size;
    }
  }, {
    key: "parent",
    value: function parent(e) {
      return this.fillCaches(), this.parentCaches.get(e);
    }
  }, {
    key: "childrenArray",
    value: function childrenArray(e) {
      return e === null ? this : this.get(e).children;
    }
  }, {
    key: "modifyById",
    value: function modifyById(e, r) {
      if (this.get(e) === void 0) throw new Error("not expected");
      {
        var s = this.parent(e),
          o = this.childrenArray(s),
          a = o.findIndex(function (c) {
            return c.id === e;
          });
        if (a < 0) throw new Error("not expected");
        var _l38 = o[a];
        return o = _toConsumableArray(o), o[a] = _objectSpread(_objectSpread({}, _l38), {}, {
          data: r
        }), this.modifyArrayBy(s, o);
      }
    }
  }, {
    key: "modifyArrayBy",
    value: function modifyArrayBy(e, r) {
      var _this82 = this;
      var i = e,
        s = r;
      var _loop2 = function _loop2() {
        var a = s,
          l = i;
        if (i = _this82.parent(i), i === void 0) throw new Error();
        s = _this82.childrenArray(i);
        var u = s.findIndex(function (c) {
          return c.id === l;
        });
        if (u < 0) throw new Error();
        s = _toConsumableArray(s), s[u] = _objectSpread(_objectSpread({}, s[u]), {}, {
          children: a
        });
      };
      for (; i !== null;) {
        _loop2();
      }
      Object.setPrototypeOf(s, ar.prototype);
      var o = s;
      return o.fillCaches(), o;
    }
  }, {
    key: "runOp",
    value: function runOp(e) {
      switch (e.type) {
        case 7:
          return this.addOp(e);
        case 8:
          return this.deleteOp(e);
        case 9:
          return this.moveOp(e);
      }
      return null;
    }
  }, {
    key: "checkDuplicatedIdRec",
    value: function checkDuplicatedIdRec(_ref3) {
      var e = _ref3.id,
        r = _ref3.children;
      if (this.get(e) !== void 0) return !0;
      var _iterator21 = _createForOfIteratorHelper(r),
        _step21;
      try {
        for (_iterator21.s(); !(_step21 = _iterator21.n()).done;) {
          var i = _step21.value;
          if (this.checkDuplicatedIdRec(i)) return !0;
        }
      } catch (err) {
        _iterator21.e(err);
      } finally {
        _iterator21.f();
      }
      return !1;
    }
  }, {
    key: "addOp",
    value: function addOp(e) {
      var r = e.parent,
        i = e.fi,
        s = e.id,
        o = e.data,
        a = e.children;
      if (r !== null && this.get(r) === void 0) return null;
      if (this.checkDuplicatedIdRec(e)) return null;
      {
        var _l39 = r,
          u = this.childrenArray(_l39),
          c = {
            fi: i,
            id: s,
            data: o,
            children: a
          };
        return u = [].concat(_toConsumableArray(u), [c]), u.sort(function (h, f) {
          return h.fi - f.fi;
        }), e.localIndex = u.indexOf(c), {
          data: this.modifyArrayBy(_l39, u),
          actual: e,
          reverse: {
            type: 8,
            id: s
          }
        };
      }
    }
  }, {
    key: "deleteOp",
    value: function deleteOp(e) {
      var r = e.id;
      if (this.get(r) === null) return null;
      {
        var i = this.parent(r);
        if (i === void 0) return null;
        var s = this.childrenArray(i),
          o = s.findIndex(function (u) {
            return u.id === r;
          });
        e.localIndex = o, s = _toConsumableArray(s);
        var a = s.splice(o, 1)[0];
        return {
          data: this.modifyArrayBy(i, s),
          actual: e,
          reverse: _objectSpread(_objectSpread({
            type: 7
          }, a), {}, {
            parent: i
          })
        };
      }
    }
  }, {
    key: "moveOp",
    value: function moveOp(e) {
      var r = e.parent,
        i = e.fi,
        s = e.id;
      if (r !== null && this.get(r) === void 0) return this.deleteOp({
        type: 8,
        id: s
      });
      if (r !== null) {
        var _f34 = r;
        for (; _f34 !== null;) {
          if (_f34 === void 0) throw new Error();
          if (_f34 === s) throw new Pd("cyclic tree");
          _f34 = this.parent(_f34);
        }
      }
      var o = this.parent(s);
      if (o === void 0) return null;
      var a = o,
        l = this.childrenArray(o),
        u = l.findIndex(function (f) {
          return f.id === s;
        });
      l = _toConsumableArray(l);
      var c = l.splice(u, 1)[0],
        d = this.modifyArrayBy(o, l);
      o = r, l = d.childrenArray(o);
      var h = c.fi;
      return c = _objectSpread(_objectSpread({}, c), {}, {
        fi: i
      }), l = [].concat(_toConsumableArray(l), [c]), l.sort(function (f, p) {
        return f.fi - p.fi;
      }), e.localIndex = l.indexOf(c), d = d.modifyArrayBy(o, l), {
        data: d,
        actual: e,
        reverse: {
          type: 9,
          parent: a,
          fi: h,
          id: s
        }
      };
    }
  }, {
    key: "previous",
    value: function previous(e, r) {
      if (r === null) {
        var s = this.childrenArray(e);
        return s.length === 0 ? null : s[s.length - 1].id;
      }
      var i = null;
      var _iterator22 = _createForOfIteratorHelper(this.childrenArray(e)),
        _step22;
      try {
        for (_iterator22.s(); !(_step22 = _iterator22.n()).done;) {
          var _s9 = _step22.value;
          if (_s9.id === r) return i;
          i = _s9.id;
        }
      } catch (err) {
        _iterator22.e(err);
      } finally {
        _iterator22.f();
      }
      return null;
    }
  }, {
    key: "traverseSortNext",
    value: function traverseSortNext(e) {
      var r = this.parent(e);
      if (r !== void 0) {
        var i = this.childrenArray(r),
          s = i.findIndex(function (o) {
            return o.id === e;
          }) + 1;
        if (s < i.length) return i[s].id;
        if (r) return this.traverseSortNext(r);
      }
    }
  }, {
    key: "sortNext",
    value: function sortNext(e) {
      var r = this.childrenArray(e);
      return r.length > 0 ? r[0].id : this.traverseSortNext(e);
    }
  }, {
    key: "traverseSortPrevious",
    value: function traverseSortPrevious(e) {
      var r = this.childrenArray(e);
      return r.length > 0 ? this.traverseSortPrevious(r[r.length - 1].id) : e;
    }
  }, {
    key: "sortPrevious",
    value: function sortPrevious(e) {
      var r = this.parent(e);
      if (r !== void 0) {
        var i = this.childrenArray(r),
          s = i.findIndex(function (o) {
            return o.id === e;
          }) - 1;
        return s >= 0 ? this.traverseSortPrevious(i[s].id) : r;
      }
    }
  }, {
    key: "getAllSorted",
    value: function getAllSorted(e) {
      var r = [];
      var _iterator23 = _createForOfIteratorHelper(e),
        _step23;
      try {
        for (_iterator23.s(); !(_step23 = _iterator23.n()).done;) {
          var _i8 = _step23.value;
          var s = this.getWithSortKey(_i8.id);
          s !== void 0 && r.push(_objectSpread(_objectSpread({}, _i8), s));
        }
      } catch (err) {
        _iterator23.e(err);
      } finally {
        _iterator23.f();
      }
      r.sort(function (i, s) {
        return R2(i.sortKey, s.sortKey);
      });
      for (var _i7 = 0, _r8 = r; _i7 < _r8.length; _i7++) {
        var i = _r8[_i7];
        delete i.sortKey;
      }
      return r;
    }
  }, {
    key: "getWithSortKey",
    value: function getWithSortKey(e) {
      var r = e;
      var i = [],
        s = this.get(r),
        o = s;
      if (s !== void 0) {
        for (; r;) i.splice(0, 0, s.fi), r = this.parent(r), r !== null && (s = this.get(r));
        return _objectSpread(_objectSpread({}, o), {}, {
          sortKey: i
        });
      }
    }
  }, {
    key: "insertBeforeHelper",
    value: function insertBeforeHelper(e, r, i) {
      return this.insertAfterHelper(e, this.previous(e, r), i);
    }
  }, {
    key: "insertAfterHelper",
    value: function insertAfterHelper(e, r, i) {
      var s = this.childrenArray(e);
      if (r === null) {
        if (s.length === 0) return fo(0, i, i);
        {
          var o = s[0].fi;
          return fo(o - i, o, i);
        }
      } else {
        var _o7 = this.get(r);
        if (_o7 === void 0 || this.parent(r) !== e) throw new Error("illegal args");
        var a = s.find(function (l) {
          return l.fi > _o7.fi;
        });
        if (a === void 0) {
          var _l40 = s[s.length - 1].fi;
          return fo(_l40, _l40 + i, i);
        } else return fo(_o7.fi, a.fi, i);
      }
    }
  }]);
  return ar;
}( /*#__PURE__*/_wrapNativeSuper(Array));
var Od;
(function (t) {
  function n(e, r) {
    if (r.type !== 0) return null;
    if (Array.isArray(e)) {
      var i = r.props,
        s = {},
        o = _toConsumableArray(e),
        a = !1;
      if (i) for (var _i9 = 0, _Object$keys2 = Object.keys(i); _i9 < _Object$keys2.length; _i9++) {
        var _l41 = _Object$keys2[_i9];
        var u = parseInt(_l41);
        if (isNaN(u)) throw new Error("wrong index");
        s[_l41] = o[u], o[u] = i[_l41], a = !0;
      }
      return a ? {
        data: o,
        actual: r,
        reverse: {
          type: 0,
          props: s
        }
      } : null;
    } else {
      var _i10 = r.props,
        _s10 = {},
        _o8 = _objectSpread({}, e),
        _a16 = !1;
      if (_i10) for (var _i11 = 0, _Object$keys3 = Object.keys(_i10); _i11 < _Object$keys3.length; _i11++) {
        var _l42 = _Object$keys3[_i11];
        _s10[_l42] = _o8[_l42];
        var _u15 = _i10[_l42];
        _u15 === void 0 ? delete _o8[_l42] : _o8[_l42] = _u15, _a16 = !0;
      }
      return _a16 ? {
        data: _o8,
        actual: r,
        reverse: {
          type: 0,
          props: _s10
        }
      } : null;
    }
  }
  t.runOp = n;
})(Od || (Od = {}));
var Re = /*#__PURE__*/function (_Array2) {
  _inherits(Re, _Array2);
  var _super101 = _createSuper(Re);
  function Re() {
    var _this83;
    _classCallCheck(this, Re);
    for (var _len2 = arguments.length, e = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
      e[_key2] = arguments[_key2];
    }
    _this83 = _super101.call.apply(_super101, [this].concat(e));
    Object.setPrototypeOf(_assertThisInitialized(_this83), Re.prototype);
    return _this83;
  }
  _createClass(Re, [{
    key: "deepFreeze",
    value: function deepFreeze() {
      var e = 0;
      for (; e < this.length;) Np(this[e]), e++;
    }
  }, {
    key: "fillCaches0",
    value: function fillCaches0(e) {
      this.objCaches.set(e.id, e);
    }
  }, {
    key: "fillCaches",
    value: function fillCaches() {
      if (this.objCaches === void 0) {
        this.objCaches = new Map(), Object.getOwnPropertyDescriptor(this, "objCaches").enumerable = !1;
        var _iterator24 = _createForOfIteratorHelper(this),
          _step24;
        try {
          for (_iterator24.s(); !(_step24 = _iterator24.n()).done;) {
            var _e21 = _step24.value;
            this.fillCaches0(_e21);
          }
        } catch (err) {
          _iterator24.e(err);
        } finally {
          _iterator24.f();
        }
      }
    }
  }, {
    key: "randomId",
    value: function randomId() {
      this.fillCaches();
      var e = Array.from(this.objCaches.keys());
      if (e.length !== 0) return e[Math.max(0, Math.floor(Math.random() * e.length) - 1)];
    }
  }, {
    key: "data",
    value: function data(e) {
      var _this$get3;
      return (_this$get3 = this.get(e)) === null || _this$get3 === void 0 ? void 0 : _this$get3.data;
    }
  }, {
    key: "get",
    value: function get(e) {
      return this.fillCaches(), this.objCaches.get(e);
    }
  }, {
    key: "modifyById",
    value: function modifyById(e, r) {
      if (this.get(e) === void 0) throw new Error("not expected");
      {
        var s = this,
          o = s.findIndex(function (u) {
            return u.id === e;
          });
        if (o < 0) throw new Error("not expected");
        var a = s[o];
        return s = _toConsumableArray(s), s[o] = _objectSpread(_objectSpread({}, a), {}, {
          data: r
        }), this.modifyArrayBy(s);
      }
    }
  }, {
    key: "modifyArrayBy",
    value: function modifyArrayBy(e) {
      Object.setPrototypeOf(e, Re.prototype);
      var r = e;
      return L2() || r.fillCaches(), r;
    }
  }, {
    key: "runOp",
    value: function runOp(e) {
      switch (e.type) {
        case 4:
          return this.addOp(e);
        case 5:
          return this.deleteOp(e);
        case 6:
          return this.moveOp(e);
      }
      return null;
    }
  }, {
    key: "addOp",
    value: function addOp(e) {
      var r = e.fi,
        i = e.id,
        s = e.data,
        o = this,
        a = {
          fi: r,
          id: i,
          data: s
        };
      return o = [].concat(_toConsumableArray(o), [a]), o.sort(function (u, c) {
        return u.fi - c.fi;
      }), e.localIndex = o.indexOf(a), {
        data: this.modifyArrayBy(o),
        actual: e,
        reverse: {
          type: 5,
          id: i
        }
      };
    }
  }, {
    key: "deleteOp",
    value: function deleteOp(e) {
      var r = e.id,
        i = this,
        s = i.findIndex(function (l) {
          return l.id === r;
        });
      if (s === -1) return null;
      e.localIndex = s, i = _toConsumableArray(i);
      var o = i.splice(s, 1)[0];
      return {
        data: this.modifyArrayBy(i),
        actual: e,
        reverse: _objectSpread({
          type: 4
        }, o)
      };
    }
  }, {
    key: "moveOp",
    value: function moveOp(e) {
      var r = e.fi,
        i = e.id,
        s = this;
      s = _toConsumableArray(s);
      var o = s.findIndex(function (c) {
        return c.id === i;
      });
      if (o === -1) return null;
      var a = s[o].fi,
        l = _objectSpread(_objectSpread({}, s[o]), {}, {
          fi: r
        });
      return s[o] = l, s.sort(function (c, d) {
        return c.fi - d.fi;
      }), e.localIndex = s.indexOf(l), {
        data: this.modifyArrayBy(s),
        actual: e,
        reverse: {
          type: 6,
          fi: a,
          id: i
        }
      };
    }
  }, {
    key: "previous",
    value: function previous(e) {
      if (e === null) return this.length === 0 ? null : this[this.length - 1].id;
      var r = null;
      var _iterator25 = _createForOfIteratorHelper(this),
        _step25;
      try {
        for (_iterator25.s(); !(_step25 = _iterator25.n()).done;) {
          var i = _step25.value;
          if (i.id === e) return r;
          r = i.id;
        }
      } catch (err) {
        _iterator25.e(err);
      } finally {
        _iterator25.f();
      }
      return null;
    }
  }, {
    key: "insertBeforeHelper",
    value: function insertBeforeHelper(e, r) {
      return this.insertAfterHelper(this.previous(e), r);
    }
  }, {
    key: "insertAfterHelper",
    value: function insertAfterHelper(e, r) {
      var i = this;
      if (e === null) {
        if (i.length === 0) return fo(0, r, r);
        {
          var s = i[0].fi;
          return fo(s - r, s, r);
        }
      } else {
        var _s11 = this.get(e);
        if (_s11 === void 0) throw new Error("illegal args");
        var o = i.find(function (a) {
          return a.fi > _s11.fi;
        });
        if (o === void 0) {
          var a = i[i.length - 1].fi;
          return fo(a, a + r, r);
        } else return fo(_s11.fi, o.fi, r);
      }
    }
  }]);
  return Re;
}( /*#__PURE__*/_wrapNativeSuper(Array));
function Id(n) {
  return n && _typeof(n) == "object" && n instanceof lr;
}
var lr = /*#__PURE__*/function () {
    function lr() {
      _classCallCheck(this, lr);
    }
    _createClass(lr, [{
      key: "unusedFunOverridesTable",
      value: function unusedFunOverridesTable(t) {}
    }, {
      key: "runOp",
      value: function runOp(t) {
        var e = [],
          r = this,
          i = 0,
          s = {};
        for (; i < t.path.length;) {
          if (e.push(r), r = r === void 0 ? void 0 : r[t.path[i]], r !== void 0 && !Id(r)) return null;
          i += 1;
        }
        r = r ? dv(r) : new lr();
        for (var _i12 = 0, _Object$entries = Object.entries(t.props); _i12 < _Object$entries.length; _i12++) {
          var _Object$entries$_i = _slicedToArray(_Object$entries[_i12], 2),
            _l43 = _Object$entries$_i[0],
            u = _Object$entries$_i[1];
          var c = r[_l43];
          s[_l43] = c, u === void 0 ? delete r[_l43] : r[_l43] = u;
        }
        for (; i > 0;) {
          if (Object.keys(r).length === 0) {
            var _l44 = e[i - 1];
            _l44 && (r = dv(_l44), delete r[t.path[i - 1]]);
          } else {
            var _l45 = e[i - 1];
            if (_l45) {
              var _u16 = dv(_l45);
              _u16[t.path[i - 1]] = r, r = _u16;
            } else {
              var _u17 = new lr();
              _u17[t.path[i - 1]] = r, r = _u17;
            }
          }
          i -= 1;
        }
        var o = Object.setPrototypeOf(r, lr.prototype),
          a = _objectSpread(_objectSpread({}, t), {}, {
            props: s
          });
        return {
          data: o,
          actual: t,
          reverse: a
        };
      }
    }]);
    return lr;
  }(),
  po;
(function (r) {
  function n(i, s) {
    var _Fp;
    return (_Fp = Fp(i, s)) !== null && _Fp !== void 0 ? _Fp : i;
  }
  r.apply = n;
  function t(i, s) {
    return Bw(i, s);
  }
  r.merge = t;
  function e(i, s) {
    var o = 0,
      a = s.path,
      l = i;
    for (; o < a.length && l !== void 0;) {
      if (l = Tr.zoomOnce(l, a[o]), l === void 0) return s;
      if (!Id(l)) return;
      o += 1;
    }
    if (l === void 0) return s;
    if (!!Id(l)) if (s.type === 0) {
      var u = _objectSpread({}, s.props);
      for (var _i13 = 0, _Object$keys4 = Object.keys(l); _i13 < _Object$keys4.length; _i13++) {
        var c = _Object$keys4[_i13];
        delete u[c];
      }
      return _objectSpread(_objectSpread({}, s), {}, {
        props: u
      });
    } else if (s.type === 1 || s.type === 4 || s.type === 7) {
      var _u18 = Lw([s], l);
      return _u18 ? (console.log(_u18), _u18) : s;
    } else return s;
  }
  r.filterOp = e;
})(po || (po = {}));
function Lw(n, t) {
  if (t === void 0) return;
  var e = !1,
    r = n.map(function (i) {
      var s = i.id,
        o = Fp(i.data, t[s]);
      if (e = e || o !== void 0, o === void 0 && (o = i.data), i.children) {
        var a = Lw(i.children, t);
        return a !== void 0 ? e = !0 : a = i.children, _objectSpread(_objectSpread({}, i), {}, {
          id: s,
          data: o,
          children: a
        });
      } else return _objectSpread(_objectSpread({}, i), {}, {
        id: s,
        data: o
      });
    });
  if (e) return r;
}
function H8(n, t) {
  if (t === void 0) return;
  var e = !1,
    r = n.map(function (i) {
      var s = i.id,
        o = Fp(i.data, t[s]);
      return e = e || o !== void 0, o === void 0 && (o = i.data), _objectSpread(_objectSpread({}, i), {}, {
        id: s,
        data: o
      });
    });
  if (e) return Object.setPrototypeOf(r, Object.getPrototypeOf(n)), r;
}
function Fp(n, t) {
  if (!Id(t)) return t;
  if (n instanceof ar) {
    var _e22 = Lw(n, t);
    return _e22 !== void 0 && Object.setPrototypeOf(_e22, Object.getPrototypeOf(n)), _e22;
  } else {
    if (n instanceof Re) return H8(n, t);
    if (Array.isArray(n)) {
      var _e23 = !1,
        r = n.map(function (i, s) {
          var o = Fp(i, t[s]);
          return _e23 = _e23 || o !== void 0, o === void 0 && (o = i), o;
        });
      return _e23 ? (Object.setPrototypeOf(r, Object.getPrototypeOf(n)), r) : void 0;
    } else {
      if (n instanceof lr) return Bw(n, t);
      if (n && _typeof(n) == "object") {
        var _e24 = {},
          _r9 = !1;
        for (var _i14 = 0, _Object$entries2 = Object.entries(n); _i14 < _Object$entries2.length; _i14++) {
          var _Object$entries2$_i = _slicedToArray(_Object$entries2[_i14], 2),
            i = _Object$entries2$_i[0],
            s = _Object$entries2$_i[1];
          var o = Fp(s, t[i]);
          _r9 = _r9 || o !== void 0, o === void 0 && (o = s), _e24[i] = o;
        }
        return _r9 ? (Object.setPrototypeOf(_e24, Object.getPrototypeOf(n)), _e24) : void 0;
      }
    }
  }
}
function Bw(n, t) {
  if (n === void 0) return t;
  if (t === void 0) return n;
  if (!Id(t)) return t;
  if (!Id(n)) return po.apply(n, t);
  var e = new Set();
  for (var _i15 = 0, _Object$keys5 = Object.keys(n); _i15 < _Object$keys5.length; _i15++) {
    var i = _Object$keys5[_i15];
    e.add(i);
  }
  for (var _i16 = 0, _Object$keys6 = Object.keys(t); _i16 < _Object$keys6.length; _i16++) {
    var _i17 = _Object$keys6[_i16];
    e.add(_i17);
  }
  var r = new lr();
  var _iterator26 = _createForOfIteratorHelper(e),
    _step26;
  try {
    for (_iterator26.s(); !(_step26 = _iterator26.n()).done;) {
      var _i18 = _step26.value;
      var s = Bw(n === void 0 ? void 0 : n[_i18], t === void 0 ? void 0 : t[_i18]);
      r[_i18] = s;
    }
  } catch (err) {
    _iterator26.e(err);
  } finally {
    _iterator26.f();
  }
  return r;
}
function F2(n, t) {
  var _kp;
  var e = {
    cur: [],
    result: [],
    len: 0
  };
  return n = (_kp = kp(n, t, e)) !== null && _kp !== void 0 ? _kp : n, [n, e.result];
}
function hv(n, t) {
  return n === null ? null : (n.cur[n.len] = t, n.len += 1, n);
}
function fv(n) {
  n && (n.len -= 1);
}
function W8(n) {
  if (n === null) return null;
  n.result.push(n.cur.slice(0, n.len));
}
function k2(n, t, e) {
  var r = !1,
    i = n.map(function (s) {
      var o = s.id,
        a = t[o];
      if (a !== void 0 && typeof a == "string" && (r = !0, o = a, e !== null)) throw new Error("not supported");
      var l = kp(s.data, t, hv(e, o));
      fv(e), r = r || l !== void 0, l === void 0 && (l = s.data);
      var u = k2(s.children, t, e);
      return u !== void 0 ? r = !0 : u = s.children, _objectSpread(_objectSpread({}, s), {}, {
        id: o,
        data: l,
        children: u
      });
    });
  if (r) return i;
}
function q8(n, t, e) {
  var r = !1,
    i = n.map(function (s) {
      var o = s.id,
        a = t[o];
      if (a !== void 0 && typeof a == "string" && (r = !0, o = a, e !== null)) throw new Error("not supported");
      var l = kp(s.data, t, hv(e, o));
      return fv(e), r = r || l !== void 0, l === void 0 && (l = s.data), _objectSpread(_objectSpread({}, s), {}, {
        id: o,
        data: l
      });
    });
  if (r) return Object.setPrototypeOf(i, Object.getPrototypeOf(n)), i;
}
function kp(n, t, e) {
  if (n instanceof ar) {
    var r = k2(n, t, e);
    return r !== void 0 && Object.setPrototypeOf(r, Object.getPrototypeOf(n)), r;
  } else {
    if (n instanceof Re) return q8(n, t, e);
    if (Array.isArray(n)) {
      var _r10 = !1,
        i = n.map(function (s, o) {
          var a = kp(s, t, hv(e, o));
          return fv(e), _r10 = _r10 || a !== void 0, a === void 0 && (a = s), a;
        });
      return _r10 ? (Object.setPrototypeOf(i, Object.getPrototypeOf(n)), i) : void 0;
    } else if (n && _typeof(n) == "object" && !Dd(n)) {
      var _r11 = {},
        _i19 = !1;
      for (var _i20 = 0, _Object$entries3 = Object.entries(n); _i20 < _Object$entries3.length; _i20++) {
        var _Object$entries3$_i = _slicedToArray(_Object$entries3[_i20], 2),
          s = _Object$entries3$_i[0],
          o = _Object$entries3$_i[1];
        if (s !== "name") {
          var a = t[s];
          if (typeof a == "string") {
            if (e !== null) throw new Error("not supported");
            _i19 = !0, s = a;
          }
          var _l46 = kp(o, t, hv(e, s));
          fv(e), _i19 = _i19 || _l46 !== void 0, _l46 === void 0 && (_l46 = o), _r11[s] = _l46;
        } else _r11[s] = o;
      }
      return _i19 ? (Object.setPrototypeOf(_r11, Object.getPrototypeOf(n)), _r11) : void 0;
    } else if (typeof n == "string") {
      var _r12 = t[n];
      return _r12 !== void 0 && W8(e), _r12;
    } else return;
  }
}
var Rd;
(function (t) {
  function n(e, r) {
    var i = Tr.zoom(r, e.path);
    if (_typeof(i) == "object") {
      var s = {};
      for (var _i21 = 0, _Object$keys7 = Object.keys(e.props); _i21 < _Object$keys7.length; _i21++) {
        var o = _Object$keys7[_i21];
        s[o] = i[o];
      }
      return _objectSpread(_objectSpread({}, e), {}, {
        props: s
      });
    } else return _objectSpread(_objectSpread({}, e), {}, {
      props: {}
    });
  }
  t.replaceProps = n;
})(Rd || (Rd = {}));
var Mr;
(function (a) {
  function n(l, u) {
    return _objectSpread(_objectSpread({}, l), {}, {
      path: l.path.slice(u)
    });
  }
  a.drop = n;
  function t(l, u) {
    var _e$data, _e25;
    return (_e$data = (_e25 = e(l, u)) === null || _e25 === void 0 ? void 0 : _e25.data) !== null && _e$data !== void 0 ? _e$data : l;
  }
  a.applySimple = t;
  function e(l, u) {
    var c = u.path;
    for (var d = [];;) {
      var _h21 = void 0;
      if (l instanceof lr && u.type === 0 && (_h21 = l.runOp(_objectSpread(_objectSpread({}, u), {}, {
        path: c.slice(d.length)
      })), _h21 === null && (_h21 = void 0)), _h21 === void 0 && d.length === c.length && (l instanceof ar || l instanceof Re || l instanceof Ke ? _h21 = l.runOp(u) : _h21 = Od.runOp(l, u)), _h21 !== void 0) if (_h21 !== null) {
        var _m21 = _h21.data;
        for (var _g14 = d.length - 1; _g14 >= 0; _g14--) {
          var _y15 = c[_g14],
            _v14 = d[_g14];
          if (_v14 instanceof ar) {
            if (typeof _y15 == "number") throw new Error("illegal arg");
            _m21 = _v14.modifyById(_y15, _m21);
          } else if (_v14 instanceof Re) {
            if (typeof _y15 == "number") throw new Error("illegal arg");
            _m21 = _v14.modifyById(_y15, _m21);
          } else if (_v14 instanceof Ke) {
            if (typeof _y15 == "number") throw new Error("illegal arg");
            _m21 = _v14.modifyById(_y15, _m21);
          } else if (_v14 instanceof lr) {
            var x = _objectSpread(_objectSpread({}, _v14), {}, _defineProperty({}, _y15, _m21));
            _m21 = Object.setPrototypeOf(x, lr.prototype);
          } else if (_typeof(_v14) == "object") {
            if (Array.isArray(_v14)) {
              if (typeof _y15 == "string" && (_y15 = parseInt(_y15), isNaN(_y15))) throw new Error("Invalid path");
              var _x14 = _m21;
              _m21 = _toConsumableArray(_v14), _m21[_y15] = _x14;
            } else _m21 = _objectSpread(_objectSpread({}, _v14), {}, _defineProperty({}, _y15, _m21));
          } else return null;
        }
        return {
          data: _m21,
          actual: _objectSpread(_objectSpread({}, _h21.actual), {}, {
            path: c
          }),
          reverse: _objectSpread(_objectSpread({}, _h21.reverse), {}, {
            path: c
          })
        };
      } else return null;
      var _f35 = c[d.length],
        _p25 = void 0;
      if (l instanceof ar) {
        var _l$get;
        if (typeof _f35 == "number") throw new Error("");
        _p25 = (_l$get = l.get(_f35)) === null || _l$get === void 0 ? void 0 : _l$get.data;
      } else if (l instanceof Re) {
        var _l$get2;
        if (typeof _f35 == "number") throw new Error("");
        _p25 = (_l$get2 = l.get(_f35)) === null || _l$get2 === void 0 ? void 0 : _l$get2.data;
      } else l !== null && (_p25 = l[_f35]);
      if (_p25 !== void 0) d.push(l), l = _p25;else return null;
    }
  }
  a.apply = e;
  function r(l, u) {
    for (var c = 0; c < l.length && c < u.length; c++) if (l[c] !== u[c]) return !0;
    return !1;
  }
  a.pathDisjoint = r;
  function i(l, u) {
    if (l.length !== u.length) return !1;
    for (var c = 0; c < l.length; c++) if (l[c] !== u[c]) return !1;
    return !0;
  }
  a.pathEq = i;
  function s(l, u) {
    return r(l.path, u.path);
  }
  a.commutative = s;
  function o(l, u) {
    return l.type === 0 && u.type === 0 && i(l.path, u.path) ? Object.keys(l.props).every(function (c) {
      return u.props[c] !== void 0;
    }) : !1;
  }
  a.subsumed = o;
})(Mr || (Mr = {}));
var zp;
(function (l) {
  function n() {
    return [];
  }
  l.empty = n;
  function t(u, c) {
    var d = [];
    var _iterator27 = _createForOfIteratorHelper(u),
      _step27;
    try {
      for (_iterator27.s(); !(_step27 = _iterator27.n()).done;) {
        var _h22 = _step27.value;
        var _h22$path = _toArray(_h22.path),
          _f36 = _h22$path[0],
          _p26 = _h22$path.slice(1);
        _f36 === c && d.push(_objectSpread(_objectSpread({}, _h22), {}, {
          path: _p26
        }));
      }
    } catch (err) {
      _iterator27.e(err);
    } finally {
      _iterator27.f();
    }
    return d;
  }
  l.removePrefix = t;
  function e(u, c) {
    return u.map(function (d) {
      return _objectSpread(_objectSpread({}, d), {}, {
        path: [c].concat(_toConsumableArray(d.path))
      });
    });
  }
  l.addPrefix = e;
  function r(u, c) {
    return [].concat(_toConsumableArray(u), _toConsumableArray(c));
  }
  l.concat = r;
  function i(u, c) {
    return [].concat(_toConsumableArray(u.filter(function (h) {
      return !c.some(function (f) {
        return Mr.subsumed(h, f);
      });
    })), _toConsumableArray(c));
  }
  l.compress = i;
  function s(u, c) {
    return u.every(function (d) {
      return c.every(function (h) {
        return Mr.commutative(d, h);
      });
    });
  }
  l.commutative = s;
  function o(u, c) {
    var _iterator28 = _createForOfIteratorHelper(c),
      _step28;
    try {
      for (_iterator28.s(); !(_step28 = _iterator28.n()).done;) {
        var _d20 = _step28.value;
        var _h23 = a(u, _d20);
        _h23 !== null && (u = _h23.data);
      }
    } catch (err) {
      _iterator28.e(err);
    } finally {
      _iterator28.f();
    }
    return u;
  }
  l.applyAll = o;
  function a(u, c) {
    var d = u;
    var h = [],
      f = [];
    var _iterator29 = _createForOfIteratorHelper(c),
      _step29;
    try {
      var _loop3 = function _loop3() {
          var p = _step29.value;
          try {
            if (p.type === 3 || p.type === 5 && p.path[p.path.length - 1] === "variables") {
              var _m22, _g15, _y16;
              if (p.type === 3 ? (_m22 = Tr.zoom(d, [].concat(_toConsumableArray(p.path), [p.id])), _y16 = Mr.apply(d, _objectSpread(_objectSpread({}, p), {}, {
                type: 2
              }))) : (_m22 = Tr.zoom(d, [].concat(_toConsumableArray(p.path), [p.id, "value"])), _y16 = Mr.apply(d, p)), _y16 !== null) {
                d = _y16.data;
                var _F2 = F2(d, _defineProperty({}, p.id, _m22)),
                  _F3 = _slicedToArray(_F2, 2),
                  _v15 = _F3[0],
                  x = _F3[1];
                d = _v15;
                var _loop4 = function _loop4() {
                  var w = x[S],
                    A = w.pop();
                  if (typeof A == "number") {
                    var E = [A];
                    for (var T = S + 1; T < x.length; T++) {
                      var M = x[T],
                        C = M[M.length - 1];
                      if (typeof C == "number" && Tr.equal(w, M.slice(0, M.length - 1))) E.push(C), x.splice(T, 1);else break;
                    }
                    var b = Tr.zoom(d, w);
                    _g15 = b.map(function (T, M) {
                      return E.includes(M) ? p.id : T;
                    }), _m22 = b, A = w.pop();
                  } else {
                    if (A === "alphaOverride" || A === "alpha") {
                      _m22 /= 100;
                      var _E9 = _m22,
                        _b7 = Tr.zoom(d, w.slice(0, w.length - 2)),
                        _T4 = _b7.layers.map(function (M) {
                          return M.id === w[w.length - 1] ? _objectSpread(_objectSpread({}, M), {}, {
                            data: _objectSpread(_objectSpread({}, M.data), {}, _defineProperty({}, A, _E9))
                          }) : M;
                        });
                      Object.setPrototypeOf(_T4, Object.getPrototypeOf(_b7.layers)), _b7.layers = _T4;
                    }
                    _g15 = p.id;
                  }
                  h.push({
                    type: 0,
                    path: w,
                    props: _defineProperty({}, A, _m22)
                  }), f.push({
                    type: 0,
                    path: w,
                    props: _defineProperty({}, A, _g15)
                  });
                };
                for (var S = 0; S < x.length; S++) {
                  _loop4();
                }
                f.push(_y16.reverse), h.push(_y16.actual);
              }
            } else {
              var _m23 = Mr.apply(d, p);
              _m23 !== null && (h.push(_m23.actual), d = _m23.data, f.push(_m23.reverse));
            }
          } catch (m) {
            if (m instanceof Pd) return {
              v: null
            };
            throw m;
          }
        },
        _ret;
      for (_iterator29.s(); !(_step29 = _iterator29.n()).done;) {
        _ret = _loop3();
        if (_ret) return _ret.v;
      }
    } catch (err) {
      _iterator29.e(err);
    } finally {
      _iterator29.f();
    }
    return {
      data: d,
      actual: h,
      reverse: f.reverse()
    };
  }
  l.apply = a;
})(zp || (zp = {}));
var z2 = Symbol(),
  Y8 = Symbol(),
  mv = Symbol(),
  Tc = /*#__PURE__*/function () {
    function Tc() {
      _classCallCheck(this, Tc);
    }
    _createClass(Tc, [{
      key: "reportOp",
      value: function reportOp(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
        var i = this;
        if (e === null) return;
        i._current = e.data;
        var s = r;
        for (; !(i instanceof pv);) {
          var o = i._path,
            a = i._current;
          if (o !== "" && s.splice(0, 0, o), i = i._parent, i === null) return;
          i.update(o, a);
        }
        i.push(s, t, e.actual, e.reverse);
      }
    }, {
      key: "deleteChildren",
      value: function deleteChildren(t) {
        if (this._children) {
          var _e26 = this._children[t];
          if (_e26) {
            var r = _e26[mv];
            r && r(), delete this._children[t];
          }
        }
      }
    }]);
    return Tc;
  }(),
  Fw = /*#__PURE__*/function (_Tc) {
    _inherits(Fw, _Tc);
    var _super102 = _createSuper(Fw);
    function Fw(t, e, r) {
      var _this84;
      _classCallCheck(this, Fw);
      _this84 = _super102.call(this), _this84._parent = t, _this84._path = e, _this84._current = r;
      return _this84;
    }
    _createClass(Fw, [{
      key: "update",
      value: function update(t, e) {
        if (Array.isArray(this._current)) {
          if (typeof t == "string" && (t = parseInt(t), isNaN(t))) throw new Error("Invalid path");
          this._current = _toConsumableArray(this._current), this._current[t] = e;
        } else this._current = _objectSpread(_objectSpread({}, this._current), {}, _defineProperty({}, t, e));
      }
    }, {
      key: "runOp",
      value: function runOp(t) {
        this.reportOp(t, Od.runOp(this._current, t), t.path);
      }
    }]);
    return Fw;
  }(Tc),
  kw = /*#__PURE__*/function (_Tc2) {
    _inherits(kw, _Tc2);
    var _super103 = _createSuper(kw);
    function kw(t, e, r) {
      var _this85;
      _classCallCheck(this, kw);
      _this85 = _super103.call(this), _this85._parent = t, _this85._path = e, _this85._current = r;
      return _this85;
    }
    _createClass(kw, [{
      key: "update",
      value: function update(t, e) {
        this._current = _objectSpread(_objectSpread({}, this._current), {}, _defineProperty({}, t, e)), Object.setPrototypeOf(this._current, Ke.prototype);
      }
    }, {
      key: "runOp",
      value: function runOp(t) {
        this.reportOp(t, this._current.runOp(t));
      }
    }]);
    return kw;
  }(Tc),
  V2 = {
    get: function get(n, t) {
      if (t === mv) return function () {
        n._parent = null;
      };
      if (t === z2) return n._current;
      if (t === Y8) return n;
      var e = n._current,
        r = n._children;
      if (t === "push" && Array.isArray(e)) throw new Error("not supported to expand array");
      var i = r === void 0 ? void 0 : r[t];
      if (i !== void 0) return i;
      var s = e[t],
        o = gv(n, t, s);
      return o !== s ? (r === void 0 && (r = {}, n._children = r), r[t] = o, o) : s;
    },
    has: function has(n, t) {
      return t in n._current;
    },
    ownKeys: function ownKeys(n) {
      return Reflect.ownKeys(n._current);
    },
    defineProperty: function defineProperty() {
      throw Error("not supported");
    },
    getPrototypeOf: function getPrototypeOf(n) {
      return Object.getPrototypeOf(n._current);
    },
    setPrototypeOf: function setPrototypeOf() {
      throw Error("not supported");
    },
    getOwnPropertyDescriptor: function getOwnPropertyDescriptor(n, t) {
      var e = n._current,
        r = Reflect.getOwnPropertyDescriptor(e, t);
      return r && {
        writable: !0,
        configurable: !0,
        enumerable: r.enumerable,
        value: e[t]
      };
    }
  },
  X8 = _objectSpread(_objectSpread({}, V2), {}, {
    set: function set(n, t, e) {
      var _Cr;
      var r = {
        type: 0,
        props: _defineProperty({}, t, (_Cr = Cr(e)) !== null && _Cr !== void 0 ? _Cr : e)
      };
      return n.deleteChildren(t), n.runOp(r), !0;
    },
    deleteProperty: function deleteProperty(n, t) {
      var e = {
        type: 0,
        props: _defineProperty({}, t, void 0)
      };
      return n.deleteChildren(t), n.runOp(e), !0;
    }
  }),
  Q8 = _objectSpread(_objectSpread({}, V2), {}, {
    set: function set(n, t, e) {
      return e === void 0 ? this.deleteProperty(n, t) : (n.deleteChildren(t), n.runOp({
        type: 1,
        id: t,
        data: e
      })), !0;
    },
    deleteProperty: function deleteProperty(n, t) {
      return n.runOp({
        type: 2,
        id: t
      }), !0;
    }
  }),
  Ld = /*#__PURE__*/function (_Tc3) {
    _inherits(Ld, _Tc3);
    var _super104 = _createSuper(Ld);
    function Ld(t, e, r) {
      var _this86;
      _classCallCheck(this, Ld);
      _this86 = _super104.call(this), _this86._children = {}, _this86._parent = t, _this86._path = e, _this86._current = r, _this86[mv] = function () {
        _this86._parent = null;
      };
      return _this86;
    }
    _createClass(Ld, [{
      key: "unproxy",
      value: function unproxy() {
        return this._current;
      }
    }, {
      key: "update",
      value: function update(t, e) {
        this._current = this._current.modifyById(t, e);
      }
    }, {
      key: "runOp",
      value: function runOp(t) {
        this.reportOp(t, this._current.runOp(t));
      }
    }, {
      key: "randomId",
      value: function randomId() {
        return this._current.randomId();
      }
    }, {
      key: "isDescendantOf",
      value: function isDescendantOf(t, e) {
        return this._current.isDescendantOf(t, e);
      }
    }, {
      key: "childrenOf",
      value: function childrenOf(t) {
        return this._current.childrenOf(t);
      }
    }, {
      key: "traverse",
      value: function traverse(t) {
        var _this87 = this;
        this._current.traverse(function (e, r) {
          t(e, _this87.data(e));
        });
      }
    }, {
      key: "get",
      value: function get(t) {
        return this._current.get(t);
      }
    }, {
      key: "parent",
      value: function parent(t) {
        return this._current.parent(t);
      }
    }, {
      key: "data",
      value: function data(t) {
        var _e$get;
        var e = this._current,
          r = this._children,
          i = r === void 0 ? void 0 : r[t];
        if (i !== void 0) return i;
        var s = (_e$get = e.get(t)) === null || _e$get === void 0 ? void 0 : _e$get.data,
          o = gv(this, t, s);
        return o !== s ? (r === void 0 && (r = {}, this._children = r), r[t] = o, o) : s;
      }
    }, {
      key: "add",
      value: function add(t, e, r, i, s) {
        this.runOp({
          type: 7,
          parent: t,
          fi: e,
          id: r,
          data: i,
          children: s
        });
      }
    }, {
      key: "move",
      value: function move(t, e, r) {
        this.runOp({
          type: 9,
          parent: t,
          fi: e,
          id: r
        });
      }
    }, {
      key: "insertAfter",
      value: function insertAfter(t, e, r) {
        var i = this._current.insertAfterHelper(t, e, r.length);
        for (var s = 0; s < r.length; s++) {
          var o = r[s];
          this.add(t, i[s], o.id, o.data, o.children);
        }
      }
    }, {
      key: "insertBefore",
      value: function insertBefore(t, e, r) {
        var i = this._current.insertBeforeHelper(t, e, r.length);
        for (var s = 0; s < r.length; s++) {
          var o = r[s];
          this.add(t, i[s], o.id, o.data, o.children);
        }
      }
    }, {
      key: "moveAfter",
      value: function moveAfter(t, e, r) {
        var i = this._current.insertAfterHelper(t, e, r.length);
        for (var s = 0; s < r.length; s++) {
          var o = r[s];
          this.move(t, i[s], o);
        }
      }
    }, {
      key: "moveBefore",
      value: function moveBefore(t, e, r) {
        var i = this._current.insertBeforeHelper(t, e, r.length);
        for (var s = 0; s < r.length; s++) {
          var o = r[s];
          this.move(t, i[s], o);
        }
      }
    }, {
      key: "delete",
      value: function _delete(t) {
        this.deleteChildren(t), this.runOp({
          type: 8,
          id: t
        });
      }
    }, {
      key: "sortNext",
      value: function sortNext(t) {
        return this._current.sortNext(t);
      }
    }, {
      key: "sortPrevious",
      value: function sortPrevious(t) {
        return this._current.sortPrevious(t);
      }
    }, {
      key: "getAllSorted",
      value: function getAllSorted(t) {
        return this._current.getAllSorted(t);
      }
    }]);
    return Ld;
  }(Tc),
  Bd = /*#__PURE__*/function (_Tc4) {
    _inherits(Bd, _Tc4);
    var _super105 = _createSuper(Bd);
    function Bd(t, e, r) {
      var _this88;
      _classCallCheck(this, Bd);
      _this88 = _super105.call(this), _this88._children = {}, _this88._parent = t, _this88._path = e, _this88._current = r, _this88[mv] = function () {
        _this88._parent = null;
      };
      return _this88;
    }
    _createClass(Bd, [{
      key: "unproxy",
      value: function unproxy() {
        return this._current;
      }
    }, {
      key: "length",
      get: function get() {
        return this._current.length;
      }
    }, {
      key: "forEach",
      value: function forEach(t) {
        var e = this.length;
        for (var r = 0; r < e; r++) {
          var i = this._current[r].id,
            s = this._current[r].fi;
          t(this.data(this._current[r].id), i, s);
        }
      }
    }, {
      key: "find",
      value: function find(t) {
        var e = this.length;
        for (var r = 0; r < e; r++) {
          var i = this._current[r].id;
          if (t(this.data(i), i)) return this.get(i);
        }
      }
    }, {
      key: "update",
      value: function update(t, e) {
        this._current = this._current.modifyById(t, e);
      }
    }, {
      key: "randomId",
      value: function randomId() {
        return this._current.randomId();
      }
    }, {
      key: "get",
      value: function get(t) {
        return _objectSpread(_objectSpread({}, this._current.get(t)), {}, {
          data: this.data(t)
        });
      }
    }, {
      key: "data",
      value: function data(t) {
        var _e$get2;
        var e = this._current,
          r = this._children,
          i = r === void 0 ? void 0 : r[t];
        if (i !== void 0) return i;
        var s = (_e$get2 = e.get(t)) === null || _e$get2 === void 0 ? void 0 : _e$get2.data,
          o = gv(this, t, s);
        return o !== s ? (r === void 0 && (r = {}, this._children = r), r[t] = o, o) : s;
      }
    }, {
      key: "runOp",
      value: function runOp(t) {
        this.reportOp(t, this._current.runOp(t));
      }
    }, {
      key: "add",
      value: function add(t, e, r) {
        this.runOp({
          type: 4,
          fi: t,
          id: e,
          data: r
        });
      }
    }, {
      key: "move",
      value: function move(t, e) {
        this.runOp({
          type: 6,
          fi: t,
          id: e
        });
      }
    }, {
      key: "insertAfter",
      value: function insertAfter(t, e) {
        var r = this._current.insertAfterHelper(t, e.length);
        for (var i = 0; i < e.length; i++) {
          var s = e[i];
          this.add(r[i], s.id, s.data);
        }
      }
    }, {
      key: "insertBefore",
      value: function insertBefore(t, e) {
        var r = this._current.insertBeforeHelper(t, e.length);
        for (var i = 0; i < e.length; i++) {
          var s = e[i];
          this.add(r[i], s.id, s.data);
        }
      }
    }, {
      key: "moveAfter",
      value: function moveAfter(t, e) {
        var r = this._current.insertAfterHelper(t, e.length);
        for (var i = 0; i < e.length; i++) {
          var s = e[i];
          this.move(r[i], s);
        }
      }
    }, {
      key: "moveBefore",
      value: function moveBefore(t, e) {
        var r = this._current.insertBeforeHelper(t, e.length);
        for (var i = 0; i < e.length; i++) {
          var s = e[i];
          this.move(r[i], s);
        }
      }
    }, {
      key: "delete",
      value: function _delete(t) {
        this.deleteChildren(t), this.runOp({
          type: 5,
          id: t
        });
      }
    }]);
    return Bd;
  }(Tc);
function Nw(n, t, e) {
  if (n.length > 0) {
    var r = n[n.length - 1];
    if (r.type === 0 && t.type === 0 && Tr.equal(r.path, e)) {
      Object.assign(r.props, t.props);
      return;
    }
  }
  n.push(_objectSpread(_objectSpread({}, t), {}, {
    path: e
  }));
}
var pv = /*#__PURE__*/function (_Tc5) {
  _inherits(pv, _Tc5);
  var _super106 = _createSuper(pv);
  function pv(t) {
    var _this89;
    _classCallCheck(this, pv);
    _this89 = _super106.call(this), _this89.ts = [], _this89.actual = [], _this89.reverse = [], _this89._current = t;
    return _this89;
  }
  _createClass(pv, [{
    key: "update",
    value: function update(t, e) {
      if (t !== "") throw new Error("");
      this._current = e;
    }
  }, {
    key: "push",
    value: function push(t, e, r, i) {
      Nw(this.ts, e, t), Nw(this.actual, r, t), Nw(this.reverse, i, t);
    }
  }, {
    key: "result",
    value: function result() {
      return {
        data: this._current,
        ts: this.ts,
        actual: this.actual,
        reverse: this.reverse.reverse()
      };
    }
  }]);
  return pv;
}(Tc);
function gv(n, t, e) {
  return e instanceof ar ? new Ld(n, t, e) : e instanceof Re ? new Bd(n, t, e) : e instanceof Ke ? new Proxy(new kw(n, t, e), Q8) : e !== null && _typeof(e) == "object" ? Dd(e) ? e : new Proxy(new Fw(n, t, e), X8) : e;
}
function zw(n) {
  var t = new pv(n);
  return [gv(t, "", n), t];
}
function fl(n, t) {
  var _zw = zw(n),
    _zw2 = _slicedToArray(_zw, 2),
    e = _zw2[0],
    r = _zw2[1];
  return t(e), r.result();
}
function Cr(n) {
  return n instanceof Ld || n instanceof Bd ? n._current : n !== null && _typeof(n) == "object" ? n[z2] : n;
}
var Tr;
(function (i) {
  function n(s, o) {
    if (o.length === s.length) for (var a = 0; a < s.length;) {
      if (s[a] !== o[a]) return !1;
      a += 1;
    } else return !1;
    return !0;
  }
  i.equal = n;
  function t(s, o, a) {
    var l = r(a, s);
    if (l !== void 0 && _typeof(l) == "object" && l !== null) {
      var u = _objectSpread({}, o);
      return Object.keys(l).forEach(function (c) {
        delete u[c];
      }), u;
    } else return o;
  }
  i.removeOverridden = t;
  function e(s, o) {
    if ((s instanceof ar || s instanceof Ld) && typeof o == "string") return s.data(o);
    if ((s instanceof Re || s instanceof Bd) && typeof o == "string") return s.data(o);
    if (typeof o == "number" && Array.isArray(s)) return s[o];
    if (typeof o == "string" && _typeof(s) == "object" && s !== null) return s[o];
  }
  i.zoomOnce = e;
  function r(s, o) {
    var a = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    for (; a < o.length && s !== void 0;) s = e(s, o[a]), a += 1;
    return s;
  }
  i.zoom = r;
})(Tr || (Tr = {}));
function U2(n, t) {
  var e = [];
  if (t.length === n.length) for (var r = 0; r < n.length;) {
    if (t[r] === "*") e.push(n[r]);else if (n[r] !== t[r]) return null;
    r += 1;
  } else return null;
  return e;
}
function wt(n, t) {
  var e = [];
  if (t.length <= n.length) for (var r = 0; r < t.length;) {
    if (t[r] === "*") e.push(n[r]);else if (n[r] !== t[r]) return null;
    r += 1;
  } else return null;
  return e;
}
var yv = /*#__PURE__*/_createClass(function yv() {
    _classCallCheck(this, yv);
  }),
  Vp = /*#__PURE__*/function (_yv) {
    _inherits(Vp, _yv);
    var _super107 = _createSuper(Vp);
    function Vp(e) {
      var _this90;
      _classCallCheck(this, Vp);
      _this90 = _super107.call(this);
      _this90.id = e;
      return _this90;
    }
    return _createClass(Vp);
  }(yv),
  Up = /*#__PURE__*/function (_yv2) {
    _inherits(Up, _yv2);
    var _super108 = _createSuper(Up);
    function Up(e) {
      var _this91;
      _classCallCheck(this, Up);
      _this91 = _super108.call(this);
      _this91.data = e;
      return _this91;
    }
    return _createClass(Up);
  }(yv);
var Uw;
try {
  Uw = new TextDecoder();
} catch (_unused14) {}
var Ne,
  ml,
  $ = 0;
var Q2 = [],
  Gw = Q2,
  jw = 0,
  Tn = {},
  Gt,
  pl,
  cs = 0,
  mo = 0,
  Kn,
  fa,
  mn = [],
  Zt,
  G2 = {
    useRecords: !1,
    mapsAsObjects: !0
  },
  Gp = /*#__PURE__*/_createClass(function Gp() {
    _classCallCheck(this, Gp);
  }),
  Ww = new Gp();
Ww.name = "MessagePack 0xC1";
var Nd = !1,
  go = /*#__PURE__*/function () {
    function go(t) {
      _classCallCheck(this, go);
      t && (t.useRecords === !1 && t.mapsAsObjects === void 0 && (t.mapsAsObjects = !0), t.structures ? t.structures.sharedLength = t.structures.length : t.getStructures && ((t.structures = []).uninitialized = !0, t.structures.sharedLength = 0)), Object.assign(this, t);
    }
    _createClass(go, [{
      key: "unpack",
      value: function unpack(t, e) {
        var _this92 = this;
        if (Ne) return eD(function () {
          return xv(), _this92 ? _this92.unpack(t, e) : go.prototype.unpack.call(G2, t, e);
        });
        ml = e > -1 ? e : t.length, $ = 0, jw = 0, mo = 0, pl = null, Gw = Q2, Kn = null, Ne = t;
        try {
          Zt = t.dataView || (t.dataView = new DataView(t.buffer, t.byteOffset, t.byteLength));
        } catch (r) {
          throw Ne = null, t instanceof Uint8Array ? r : new Error("Source must be a Uint8Array or Buffer but was a " + (t && _typeof(t) == "object" ? t.constructor.name : _typeof(t)));
        }
        if (this instanceof go) {
          if (Tn = this, this.structures) return Gt = this.structures, vv();
          (!Gt || Gt.length > 0) && (Gt = []);
        } else Tn = G2, (!Gt || Gt.length > 0) && (Gt = []);
        return vv();
      }
    }, {
      key: "unpackMultiple",
      value: function unpackMultiple(t, e) {
        var r,
          i = 0;
        try {
          Nd = !0;
          var s = t.length,
            o = this ? this.unpack(t, s) : wv.unpack(t, s);
          if (e) {
            for (e(o); $ < s;) if (i = $, e(vv()) === !1) return;
          } else {
            for (r = [o]; $ < s;) i = $, r.push(vv());
            return r;
          }
        } catch (s) {
          throw s.lastPosition = i, s.values = r, s;
        } finally {
          Nd = !1, xv();
        }
      }
    }, {
      key: "_mergeStructures",
      value: function _mergeStructures(t, e) {
        t = t || [];
        for (var r = 0, i = t.length; r < i; r++) {
          var s = t[r];
          s && (s.isShared = !0, r >= 32 && (s.highByte = r - 32 >> 5));
        }
        t.sharedLength = t.length;
        for (var _r13 in e || []) if (_r13 >= 0) {
          var _i22 = t[_r13],
            _s12 = e[_r13];
          _s12 && (_i22 && ((t.restoreStructures || (t.restoreStructures = []))[_r13] = _i22), t[_r13] = _s12);
        }
        return this.structures = t;
      }
    }, {
      key: "decode",
      value: function decode(t, e) {
        return this.unpack(t, e);
      }
    }]);
    return go;
  }();
function vv() {
  try {
    if (!Tn.trusted && !Nd) {
      var t = Gt.sharedLength || 0;
      t < Gt.length && (Gt.length = t);
    }
    var n = zr();
    if ($ == ml) Gt.restoreStructures && j2(), Gt = null, Ne = null, fa && (fa = null);else if ($ > ml) {
      var _t4 = new Error("Unexpected end of MessagePack data");
      throw _t4.incomplete = !0, _t4;
    } else if (!Nd) throw new Error("Data read, but end of buffer not reached");
    return n;
  } catch (n) {
    throw Gt.restoreStructures && j2(), xv(), (n instanceof RangeError || n.message.startsWith("Unexpected end of buffer")) && (n.incomplete = !0), n;
  }
}
function j2() {
  for (var n in Gt.restoreStructures) Gt[n] = Gt.restoreStructures[n];
  Gt.restoreStructures = null;
}
function zr() {
  var n = Ne[$++];
  if (n < 160) {
    if (n < 128) {
      if (n < 64) return n;
      {
        var t = Gt[n & 63] || Tn.getStructures && K2()[n & 63];
        return t ? (t.read || (t.read = qw(t, n & 63)), t.read()) : n;
      }
    } else if (n < 144) {
      if (n -= 128, Tn.mapsAsObjects) {
        var _t5 = {};
        for (var _e27 = 0; _e27 < n; _e27++) _t5[J2()] = zr();
        return _t5;
      } else {
        var _t6 = new Map();
        for (var _e28 = 0; _e28 < n; _e28++) _t6.set(zr(), zr());
        return _t6;
      }
    } else {
      n -= 144;
      var _t7 = new Array(n);
      for (var _e29 = 0; _e29 < n; _e29++) _t7[_e29] = zr();
      return _t7;
    }
  } else if (n < 192) {
    var _t8 = n - 160;
    if (mo >= $) return pl.slice($ - cs, ($ += _t8) - cs);
    if (mo == 0 && ml < 140) {
      var _e30 = _t8 < 16 ? Yw(_t8) : Z2(_t8);
      if (_e30 != null) return _e30;
    }
    return Hw(_t8);
  } else {
    var _t9;
    switch (n) {
      case 192:
        return null;
      case 193:
        return Kn ? (_t9 = zr(), _t9 > 0 ? Kn[1].slice(Kn.position1, Kn.position1 += _t9) : Kn[0].slice(Kn.position0, Kn.position0 -= _t9)) : Ww;
      case 194:
        return !1;
      case 195:
        return !0;
      case 196:
        return Vw(Ne[$++]);
      case 197:
        return _t9 = Zt.getUint16($), $ += 2, Vw(_t9);
      case 198:
        return _t9 = Zt.getUint32($), $ += 4, Vw(_t9);
      case 199:
        return Mc(Ne[$++]);
      case 200:
        return _t9 = Zt.getUint16($), $ += 2, Mc(_t9);
      case 201:
        return _t9 = Zt.getUint32($), $ += 4, Mc(_t9);
      case 202:
        if (_t9 = Zt.getFloat32($), Tn.useFloat32 > 2) {
          var _e31 = Sv[(Ne[$] & 127) << 1 | Ne[$ + 1] >> 7];
          return $ += 4, (_e31 * _t9 + (_t9 > 0 ? .5 : -.5) >> 0) / _e31;
        }
        return $ += 4, _t9;
      case 203:
        return _t9 = Zt.getFloat64($), $ += 8, _t9;
      case 204:
        return Ne[$++];
      case 205:
        return _t9 = Zt.getUint16($), $ += 2, _t9;
      case 206:
        return _t9 = Zt.getUint32($), $ += 4, _t9;
      case 207:
        return Tn.int64AsNumber ? (_t9 = Zt.getUint32($) * 4294967296, _t9 += Zt.getUint32($ + 4)) : _t9 = Zt.getBigUint64($), $ += 8, _t9;
      case 208:
        return Zt.getInt8($++);
      case 209:
        return _t9 = Zt.getInt16($), $ += 2, _t9;
      case 210:
        return _t9 = Zt.getInt32($), $ += 4, _t9;
      case 211:
        return Tn.int64AsNumber ? (_t9 = Zt.getInt32($) * 4294967296, _t9 += Zt.getUint32($ + 4)) : _t9 = Zt.getBigInt64($), $ += 8, _t9;
      case 212:
        if (_t9 = Ne[$++], _t9 == 114) return X2(Ne[$++] & 63);
        {
          var _e32 = mn[_t9];
          if (_e32) return _e32.read ? ($++, _e32.read(zr())) : _e32.noBuffer ? ($++, _e32()) : _e32(Ne.subarray($, ++$));
          throw new Error("Unknown extension " + _t9);
        }
      case 213:
        return _t9 = Ne[$], _t9 == 114 ? ($++, X2(Ne[$++] & 63, Ne[$++])) : Mc(2);
      case 214:
        return Mc(4);
      case 215:
        return Mc(8);
      case 216:
        return Mc(16);
      case 217:
        return _t9 = Ne[$++], mo >= $ ? pl.slice($ - cs, ($ += _t9) - cs) : Z8(_t9);
      case 218:
        return _t9 = Zt.getUint16($), $ += 2, mo >= $ ? pl.slice($ - cs, ($ += _t9) - cs) : J8(_t9);
      case 219:
        return _t9 = Zt.getUint32($), $ += 4, mo >= $ ? pl.slice($ - cs, ($ += _t9) - cs) : $8(_t9);
      case 220:
        return _t9 = Zt.getUint16($), $ += 2, W2(_t9);
      case 221:
        return _t9 = Zt.getUint32($), $ += 4, W2(_t9);
      case 222:
        return _t9 = Zt.getUint16($), $ += 2, q2(_t9);
      case 223:
        return _t9 = Zt.getUint32($), $ += 4, q2(_t9);
      default:
        if (n >= 224) return n - 256;
        if (n === void 0) {
          var _e33 = new Error("Unexpected end of MessagePack data");
          throw _e33.incomplete = !0, _e33;
        }
        throw new Error("Unknown MessagePack token " + n);
    }
  }
}
var K8 = /^[a-zA-Z_$][a-zA-Z\d_$]*$/;
function qw(n, t) {
  function e() {
    if (e.count++ > 2) {
      var i = n.read = new Function("r", "return function(){return {" + n.map(function (s) {
        return K8.test(s) ? s + ":r()" : "[" + JSON.stringify(s) + "]:r()";
      }).join(",") + "}}")(zr);
      return n.highByte === 0 && (n.read = H2(t, n.read)), i();
    }
    var r = {};
    for (var _i23 = 0, s = n.length; _i23 < s; _i23++) {
      var o = n[_i23];
      r[o] = zr();
    }
    return r;
  }
  return e.count = 0, n.highByte === 0 ? H2(t, e) : e;
}
var H2 = function H2(n, t) {
  return function () {
    var e = Ne[$++];
    if (e === 0) return t();
    var r = n < 32 ? -(n + (e << 5)) : n + (e << 5),
      i = Gt[r] || K2()[r];
    if (!i) throw new Error("Record id is not defined for " + r);
    return i.read || (i.read = qw(i, n)), i.read();
  };
};
function K2() {
  var n = eD(function () {
    return Ne = null, Tn.getStructures();
  });
  return Gt = Tn._mergeStructures(n, Gt);
}
var Hw = bv,
  Z8 = bv,
  J8 = bv,
  $8 = bv;
function bv(n) {
  var t;
  if (n < 16 && (t = Yw(n))) return t;
  if (n > 64 && Uw) return Uw.decode(Ne.subarray($, $ += n));
  var e = $ + n,
    r = [];
  for (t = ""; $ < e;) {
    var i = Ne[$++];
    if ((i & 128) === 0) r.push(i);else if ((i & 224) === 192) {
      var s = Ne[$++] & 63;
      r.push((i & 31) << 6 | s);
    } else if ((i & 240) === 224) {
      var _s13 = Ne[$++] & 63,
        o = Ne[$++] & 63;
      r.push((i & 31) << 12 | _s13 << 6 | o);
    } else if ((i & 248) === 240) {
      var _s14 = Ne[$++] & 63,
        _o9 = Ne[$++] & 63,
        a = Ne[$++] & 63,
        _l47 = (i & 7) << 18 | _s14 << 12 | _o9 << 6 | a;
      _l47 > 65535 && (_l47 -= 65536, r.push(_l47 >>> 10 & 1023 | 55296), _l47 = 56320 | _l47 & 1023), r.push(_l47);
    } else r.push(i);
    r.length >= 4096 && (t += Bi.apply(String, r), r.length = 0);
  }
  return r.length > 0 && (t += Bi.apply(String, r)), t;
}
function W2(n) {
  var t = new Array(n);
  for (var _e34 = 0; _e34 < n; _e34++) t[_e34] = zr();
  return t;
}
function q2(n) {
  if (Tn.mapsAsObjects) {
    var t = {};
    for (var _e35 = 0; _e35 < n; _e35++) t[J2()] = zr();
    return t;
  } else {
    var _t10 = new Map();
    for (var _e36 = 0; _e36 < n; _e36++) _t10.set(zr(), zr());
    return _t10;
  }
}
var Bi = String.fromCharCode;
function Z2(n) {
  var t = $,
    e = new Array(n);
  for (var r = 0; r < n; r++) {
    var i = Ne[$++];
    if ((i & 128) > 0) {
      $ = t;
      return;
    }
    e[r] = i;
  }
  return Bi.apply(String, e);
}
function Yw(n) {
  if (n < 4) {
    if (n < 2) {
      if (n === 0) return "";
      {
        var t = Ne[$++];
        if ((t & 128) > 1) {
          $ -= 1;
          return;
        }
        return Bi(t);
      }
    } else {
      var _t11 = Ne[$++],
        _e37 = Ne[$++];
      if ((_t11 & 128) > 0 || (_e37 & 128) > 0) {
        $ -= 2;
        return;
      }
      if (n < 3) return Bi(_t11, _e37);
      var r = Ne[$++];
      if ((r & 128) > 0) {
        $ -= 3;
        return;
      }
      return Bi(_t11, _e37, r);
    }
  } else {
    var _t12 = Ne[$++],
      _e38 = Ne[$++],
      _r14 = Ne[$++],
      i = Ne[$++];
    if ((_t12 & 128) > 0 || (_e38 & 128) > 0 || (_r14 & 128) > 0 || (i & 128) > 0) {
      $ -= 4;
      return;
    }
    if (n < 6) {
      if (n === 4) return Bi(_t12, _e38, _r14, i);
      {
        var s = Ne[$++];
        if ((s & 128) > 0) {
          $ -= 5;
          return;
        }
        return Bi(_t12, _e38, _r14, i, s);
      }
    } else if (n < 8) {
      var _s15 = Ne[$++],
        o = Ne[$++];
      if ((_s15 & 128) > 0 || (o & 128) > 0) {
        $ -= 6;
        return;
      }
      if (n < 7) return Bi(_t12, _e38, _r14, i, _s15, o);
      var a = Ne[$++];
      if ((a & 128) > 0) {
        $ -= 7;
        return;
      }
      return Bi(_t12, _e38, _r14, i, _s15, o, a);
    } else {
      var _s16 = Ne[$++],
        _o10 = Ne[$++],
        _a17 = Ne[$++],
        _l48 = Ne[$++];
      if ((_s16 & 128) > 0 || (_o10 & 128) > 0 || (_a17 & 128) > 0 || (_l48 & 128) > 0) {
        $ -= 8;
        return;
      }
      if (n < 10) {
        if (n === 8) return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48);
        {
          var u = Ne[$++];
          if ((u & 128) > 0) {
            $ -= 9;
            return;
          }
          return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, u);
        }
      } else if (n < 12) {
        var _u19 = Ne[$++],
          c = Ne[$++];
        if ((_u19 & 128) > 0 || (c & 128) > 0) {
          $ -= 10;
          return;
        }
        if (n < 11) return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u19, c);
        var _d21 = Ne[$++];
        if ((_d21 & 128) > 0) {
          $ -= 11;
          return;
        }
        return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u19, c, _d21);
      } else {
        var _u20 = Ne[$++],
          _c7 = Ne[$++],
          _d22 = Ne[$++],
          _h24 = Ne[$++];
        if ((_u20 & 128) > 0 || (_c7 & 128) > 0 || (_d22 & 128) > 0 || (_h24 & 128) > 0) {
          $ -= 12;
          return;
        }
        if (n < 14) {
          if (n === 12) return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u20, _c7, _d22, _h24);
          {
            var _f37 = Ne[$++];
            if ((_f37 & 128) > 0) {
              $ -= 13;
              return;
            }
            return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u20, _c7, _d22, _h24, _f37);
          }
        } else {
          var _f38 = Ne[$++],
            _p27 = Ne[$++];
          if ((_f38 & 128) > 0 || (_p27 & 128) > 0) {
            $ -= 14;
            return;
          }
          if (n < 15) return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u20, _c7, _d22, _h24, _f38, _p27);
          var _m24 = Ne[$++];
          if ((_m24 & 128) > 0) {
            $ -= 15;
            return;
          }
          return Bi(_t12, _e38, _r14, i, _s16, _o10, _a17, _l48, _u20, _c7, _d22, _h24, _f38, _p27, _m24);
        }
      }
    }
  }
}
function Vw(n) {
  return Tn.copyBuffers ? Uint8Array.prototype.slice.call(Ne, $, $ += n) : Ne.subarray($, $ += n);
}
function Mc(n) {
  var t = Ne[$++];
  if (mn[t]) return mn[t](Ne.subarray($, $ += n));
  throw new Error("Unknown extension type " + t);
}
var Y2 = new Array(4096);
function J2() {
  var n = Ne[$++];
  if (n >= 160 && n < 192) {
    if (n = n - 160, mo >= $) return pl.slice($ - cs, ($ += n) - cs);
    if (!(mo == 0 && ml < 180)) return Hw(n);
  } else return $--, zr();
  var t = (n << 5 ^ (n > 1 ? Zt.getUint16($) : n > 0 ? Ne[$] : 0)) & 4095,
    e = Y2[t],
    r = $,
    i = $ + n - 3,
    s,
    o = 0;
  if (e && e.bytes == n) {
    for (; r < i;) {
      if (s = Zt.getUint32(r), s != e[o++]) {
        r = 1879048192;
        break;
      }
      r += 4;
    }
    for (i += 3; r < i;) if (s = Ne[r++], s != e[o++]) {
      r = 1879048192;
      break;
    }
    if (r === i) return $ = r, e.string;
    i -= 3, r = $;
  }
  for (e = [], Y2[t] = e, e.bytes = n; r < i;) s = Zt.getUint32(r), e.push(s), r += 4;
  for (i += 3; r < i;) s = Ne[r++], e.push(s);
  var a = n < 16 ? Yw(n) : Z2(n);
  return a != null ? e.string = a : e.string = Hw(n);
}
var X2 = function X2(n, t) {
    var e = zr();
    var r = n;
    t !== void 0 && (n = n < 32 ? -((t << 5) + n) : (t << 5) + n, e.highByte = t);
    var i = Gt[n];
    return i && i.isShared && ((Gt.restoreStructures || (Gt.restoreStructures = []))[n] = i), Gt[n] = e, e.read = qw(e, r), e.read();
  },
  $2 = (typeof self === "undefined" ? "undefined" : _typeof(self)) == "object" ? self : global;
mn[0] = function () {};
mn[0].noBuffer = !0;
mn[101] = function () {
  var n = zr();
  return ($2[n[0]] || Error)(n[1]);
};
mn[105] = function (n) {
  var t = Zt.getUint32($ - 4);
  fa || (fa = new Map());
  var e = Ne[$],
    r;
  e >= 144 && e < 160 || e == 220 || e == 221 ? r = [] : r = {};
  var i = {
    target: r
  };
  fa.set(t, i);
  var s = zr();
  return i.used ? Object.assign(r, s) : (i.target = s, s);
};
mn[112] = function (n) {
  var t = Zt.getUint32($ - 4),
    e = fa.get(t);
  return e.used = !0, e.target;
};
mn[115] = function () {
  return new Set(zr());
};
var Xw = ["Int8", "Uint8", "Uint8Clamped", "Int16", "Uint16", "Int32", "Uint32", "Float32", "Float64", "BigInt64", "BigUint64"].map(function (n) {
  return n + "Array";
});
mn[116] = function (n) {
  var t = n[0],
    e = Xw[t];
  if (!e) throw new Error("Could not find typed array for code " + t);
  return new $2[e](Uint8Array.prototype.slice.call(n, 1).buffer);
};
mn[120] = function () {
  var n = zr();
  return new RegExp(n[0], n[1]);
};
mn[98] = function (n) {
  var t = (n[0] << 24) + (n[1] << 16) + (n[2] << 8) + n[3],
    e = $;
  $ += t - 4, Kn = [zr(), zr()], Kn.position0 = 0, Kn.position1 = 0;
  var r = $;
  $ = e;
  try {
    return zr();
  } finally {
    $ = r;
  }
};
mn[255] = function (n) {
  return n.length == 4 ? new Date((n[0] * 16777216 + (n[1] << 16) + (n[2] << 8) + n[3]) * 1e3) : n.length == 8 ? new Date(((n[0] << 22) + (n[1] << 14) + (n[2] << 6) + (n[3] >> 2)) / 1e6 + ((n[3] & 3) * 4294967296 + n[4] * 16777216 + (n[5] << 16) + (n[6] << 8) + n[7]) * 1e3) : n.length == 12 ? new Date(((n[0] << 24) + (n[1] << 16) + (n[2] << 8) + n[3]) / 1e6 + ((n[4] & 128 ? -281474976710656 : 0) + n[6] * 1099511627776 + n[7] * 4294967296 + n[8] * 16777216 + (n[9] << 16) + (n[10] << 8) + n[11]) * 1e3) : new Date("invalid");
};
function eD(n) {
  var _Gt;
  var t = ml,
    e = $,
    r = jw,
    i = cs,
    s = mo,
    o = pl,
    a = Gw,
    l = fa,
    u = Kn,
    c = new Uint8Array(Ne.slice(0, ml)),
    d = Gt,
    h = Gt.slice(0, Gt.length),
    f = Tn,
    p = Nd,
    m = n();
  return ml = t, $ = e, jw = r, cs = i, mo = s, pl = o, Gw = a, fa = l, Kn = u, Ne = c, Nd = p, Gt = d, (_Gt = Gt).splice.apply(_Gt, [0, Gt.length].concat(_toConsumableArray(h))), Tn = f, Zt = new DataView(Ne.buffer, Ne.byteOffset, Ne.byteLength), m;
}
function xv() {
  Ne = null, fa = null, Gt = null;
}
function tD(n) {
  n.unpack ? mn[n.type] = n.unpack : mn[n.type] = n;
}
var Sv = new Array(147);
for (var n = 0; n < 256; n++) Sv[n] = +("1e" + Math.floor(45.15 - n * .30103));
var wv = new go({
    useRecords: !1
  }),
  eq = wv.unpack,
  tq = wv.unpackMultiple,
  rq = wv.unpack,
  Av = {
    NEVER: 0,
    ALWAYS: 1,
    DECIMAL_ROUND: 3,
    DECIMAL_FIT: 4
  },
  iq = new Float32Array(1),
  Ice = new Uint8Array(iq.buffer, 0, 4);
var _v;
try {
  _v = new TextEncoder();
} catch (_unused15) {}
var Ev,
  Kw,
  Tv = (typeof Buffer === "undefined" ? "undefined" : _typeof(Buffer)) < "u",
  Qw = Tv ? Buffer.allocUnsafeSlow : Uint8Array,
  sD = Tv ? Buffer : Uint8Array,
  rD = Tv ? 4294967296 : 2144337920,
  he,
  Yr,
  ne = 0,
  yo,
  vo = null,
  nq = /[\u0080-\uFFFF]/,
  jp = Symbol("record-id"),
  Cc = /*#__PURE__*/function (_go) {
    _inherits(Cc, _go);
    var _super109 = _createSuper(Cc);
    function Cc(t) {
      var _this93;
      _classCallCheck(this, Cc);
      _this93 = _super109.call(this, t), _this93.offset = 0;
      var e,
        r,
        i,
        s,
        o,
        a,
        l = 0,
        u = sD.prototype.utf8Write ? function (b, T, M) {
          return he.utf8Write(b, T, M);
        } : _v && _v.encodeInto ? function (b, T) {
          return _v.encodeInto(b, he.subarray(T)).written;
        } : !1,
        c = _assertThisInitialized(_this93);
      t || (t = {});
      var d = t && t.sequential,
        h = t.structures || t.saveStructures,
        f = t.maxSharedStructures;
      if (f == null && (f = h ? 32 : 0), f > 8160) throw new Error("Maximum maxSharedStructure is 8160");
      var p = t.maxOwnStructures;
      p == null && (p = h ? 32 : 64), d && !t.saveStructures && (_this93.structures = []);
      var m = f > 32 || p + f > 64,
        g = f + 64,
        y = f + p + 64;
      if (y > 8256) throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");
      var v = [],
        x = 0,
        S = 0;
      _this93.pack = _this93.encode = function (b, T) {
        if (he || (he = new Qw(8192), Yr = new DataView(he.buffer, 0, 8192), ne = 0), yo = he.length - 10, yo - ne < 2048 ? (he = new Qw(he.length), Yr = new DataView(he.buffer, 0, he.length), yo = he.length - 10, ne = 0) : ne = ne + 7 & 2147483640, r = ne, a = c.structuredClone ? new Map() : null, c.bundleStrings ? (vo = ["", ""], he[ne++] = 214, he[ne++] = 98, vo.position = ne - r, ne += 4) : vo = null, i = c.structures, i) {
          i.uninitialized && (i = c._mergeStructures(c.getStructures()));
          var M = i.sharedLength || 0;
          if (M > f) throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to " + i.sharedLength);
          if (!i.transitions) {
            i.transitions = Object.create(null);
            for (var C = 0; C < M; C++) {
              var P = i[C];
              if (!P) continue;
              var D = void 0,
                _O8 = i.transitions;
              for (var I = 0, z = P.length; I < z; I++) {
                var B = P[I];
                D = _O8[B], D || (D = _O8[B] = Object.create(null)), _O8 = D;
              }
              _O8[jp] = C + 64;
            }
            l = M;
          }
          d || (i.nextId = M + 64);
        }
        s && (s = !1), o = i || [];
        try {
          if (w(b), vo) {
            Yr.setUint32(vo.position + r, ne - vo.position - r);
            var _M6 = vo;
            vo = null, w(_M6[0]), w(_M6[1]);
          }
          if (c.offset = ne, a && a.idsToInsert) {
            ne += a.idsToInsert.length * 6, ne > yo && E(ne), c.offset = ne;
            var _M7 = oq(he.subarray(r, ne), a.idsToInsert);
            return a = null, _M7;
          }
          return T & aD ? (he.start = r, he.end = ne, he) : he.subarray(r, ne);
        } finally {
          if (i) {
            if (S < 10 && S++, x > 1e4) i.transitions = null, S = 0, x = 0, v.length > 0 && (v = []);else if (v.length > 0 && !d) {
              for (var _M8 = 0, _C6 = v.length; _M8 < _C6; _M8++) v[_M8][jp] = 0;
              v = [];
            }
            if (s && c.saveStructures) {
              var _M9 = i.sharedLength || f;
              i.length > _M9 && (i = i.slice(0, _M9));
              var _C7 = he.subarray(r, ne);
              return c.saveStructures(i, l) === !1 ? (c._mergeStructures(c.getStructures()), c.pack(b)) : (l = _M9, _C7);
            }
          }
          T & fq && (ne = r);
        }
      };
      var w = function w(b) {
          ne > yo && (he = E(ne));
          var T = _typeof(b),
            M;
          if (T === "string") {
            var C = b.length;
            if (vo && C >= 8 && C < 4096) {
              var _O9 = nq.test(b);
              vo[_O9 ? 0 : 1] += b, he[ne++] = 193, w(_O9 ? -C : C);
              return;
            }
            var P;
            C < 32 ? P = 1 : C < 256 ? P = 2 : C < 65536 ? P = 3 : P = 5;
            var D = C * 3;
            if (ne + D > yo && (he = E(ne + D)), C < 64 || !u) {
              var _O10,
                I,
                z,
                B = ne + P;
              for (_O10 = 0; _O10 < C; _O10++) I = b.charCodeAt(_O10), I < 128 ? he[B++] = I : I < 2048 ? (he[B++] = I >> 6 | 192, he[B++] = I & 63 | 128) : (I & 64512) === 55296 && ((z = b.charCodeAt(_O10 + 1)) & 64512) === 56320 ? (I = 65536 + ((I & 1023) << 10) + (z & 1023), _O10++, he[B++] = I >> 18 | 240, he[B++] = I >> 12 & 63 | 128, he[B++] = I >> 6 & 63 | 128, he[B++] = I & 63 | 128) : (he[B++] = I >> 12 | 224, he[B++] = I >> 6 & 63 | 128, he[B++] = I & 63 | 128);
              M = B - ne - P;
            } else M = u(b, ne + P, D);
            M < 32 ? he[ne++] = 160 | M : M < 256 ? (P < 2 && he.copyWithin(ne + 2, ne + 1, ne + 1 + M), he[ne++] = 217, he[ne++] = M) : M < 65536 ? (P < 3 && he.copyWithin(ne + 3, ne + 2, ne + 2 + M), he[ne++] = 218, he[ne++] = M >> 8, he[ne++] = M & 255) : (P < 5 && he.copyWithin(ne + 5, ne + 3, ne + 3 + M), he[ne++] = 219, Yr.setUint32(ne, M), ne += 4), ne += M;
          } else if (T === "number") {
            if (b >>> 0 === b) b < 64 ? he[ne++] = b : b < 256 ? (he[ne++] = 204, he[ne++] = b) : b < 65536 ? (he[ne++] = 205, he[ne++] = b >> 8, he[ne++] = b & 255) : (he[ne++] = 206, Yr.setUint32(ne, b), ne += 4);else if (b >> 0 === b) b >= -32 ? he[ne++] = 256 + b : b >= -128 ? (he[ne++] = 208, he[ne++] = b + 256) : b >= -32768 ? (he[ne++] = 209, Yr.setInt16(ne, b), ne += 2) : (he[ne++] = 210, Yr.setInt32(ne, b), ne += 4);else {
              var _C8;
              if ((_C8 = _this93.useFloat32) > 0 && b < 4294967296 && b >= -2147483648) {
                he[ne++] = 202, Yr.setFloat32(ne, b);
                var _P8;
                if (_C8 < 4 || (_P8 = b * Sv[(he[ne] & 127) << 1 | he[ne + 1] >> 7]) >> 0 === _P8) {
                  ne += 4;
                  return;
                } else ne--;
              }
              he[ne++] = 203, Yr.setFloat64(ne, b), ne += 8;
            }
          } else if (T === "object") {
            if (!b) he[ne++] = 192;else {
              if (a) {
                var _P9 = a.get(b);
                if (_P9) {
                  if (!_P9.id) {
                    var _D5 = a.idsToInsert || (a.idsToInsert = []);
                    _P9.id = _D5.push(_P9);
                  }
                  he[ne++] = 214, he[ne++] = 112, Yr.setUint32(ne, _P9.id), ne += 4;
                  return;
                } else a.set(b, {
                  offset: ne - r
                });
              }
              var _C9 = b.constructor;
              if (_C9 === Object) A(b, !0);else if (_C9 === Array) {
                M = b.length, M < 16 ? he[ne++] = 144 | M : M < 65536 ? (he[ne++] = 220, he[ne++] = M >> 8, he[ne++] = M & 255) : (he[ne++] = 221, Yr.setUint32(ne, M), ne += 4);
                for (var _P10 = 0; _P10 < M; _P10++) w(b[_P10]);
              } else if (_C9 === Map) {
                M = b.size, M < 16 ? he[ne++] = 128 | M : M < 65536 ? (he[ne++] = 222, he[ne++] = M >> 8, he[ne++] = M & 255) : (he[ne++] = 223, Yr.setUint32(ne, M), ne += 4);
                var _iterator30 = _createForOfIteratorHelper(b),
                  _step30;
                try {
                  for (_iterator30.s(); !(_step30 = _iterator30.n()).done;) {
                    var _step30$value = _slicedToArray(_step30.value, 2),
                      _P11 = _step30$value[0],
                      _D6 = _step30$value[1];
                    w(_P11), w(_D6);
                  }
                } catch (err) {
                  _iterator30.e(err);
                } finally {
                  _iterator30.f();
                }
              } else {
                var _loop5 = function _loop5() {
                    var O = Kw[_P12];
                    if (b instanceof O) {
                      var _I3 = Ev[_P12];
                      if (_I3.write) {
                        _I3.type && (he[ne++] = 212, he[ne++] = _I3.type, he[ne++] = 0), w(_I3.write.call(_assertThisInitialized(_this93), b));
                        return {
                          v: void 0
                        };
                      }
                      var _z3 = he,
                        _B3 = Yr,
                        V = ne;
                      he = null;
                      var U;
                      try {
                        U = _I3.pack.call(_assertThisInitialized(_this93), b, function (j) {
                          return he = _z3, _z3 = null, ne += j, ne > yo && E(ne), {
                            target: he,
                            targetView: Yr,
                            position: ne - j
                          };
                        }, w);
                      } finally {
                        _z3 && (he = _z3, Yr = _B3, ne = V, yo = he.length - 10);
                      }
                      U && (U.length + ne > yo && E(U.length + ne), ne = sq(U, he, ne, _I3.type));
                      return {
                        v: void 0
                      };
                    }
                  },
                  _ret2;
                for (var _P12 = 0, _D7 = Ev.length; _P12 < _D7; _P12++) {
                  _ret2 = _loop5();
                  if (_ret2) return _ret2.v;
                }
                A(b, !b.hasOwnProperty);
              }
            }
          } else if (T === "boolean") he[ne++] = b ? 195 : 194;else if (T === "bigint") {
            if (b < BigInt(1) << BigInt(63) && b >= -(BigInt(1) << BigInt(63))) he[ne++] = 211, Yr.setBigInt64(ne, b);else if (b < BigInt(1) << BigInt(64) && b > 0) he[ne++] = 207, Yr.setBigUint64(ne, b);else if (_this93.largeBigIntToFloat) he[ne++] = 203, Yr.setFloat64(ne, Number(b));else throw new RangeError(b + " was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");
            ne += 8;
          } else if (T === "undefined") _this93.encodeUndefinedAsNil ? he[ne++] = 192 : (he[ne++] = 212, he[ne++] = 0, he[ne++] = 0);else if (T === "function") w(_this93.writeFunction && _this93.writeFunction());else throw new Error("Unknown type: " + T);
        },
        A = _this93.useRecords === !1 ? _this93.variableMapSize ? function (b) {
          var T = Object.keys(b),
            M = T.length;
          M < 16 ? he[ne++] = 128 | M : M < 65536 ? (he[ne++] = 222, he[ne++] = M >> 8, he[ne++] = M & 255) : (he[ne++] = 223, Yr.setUint32(ne, M), ne += 4);
          var C;
          for (var P = 0; P < M; P++) w(C = T[P]), w(b[C]);
        } : function (b, T) {
          he[ne++] = 222;
          var M = ne - r;
          ne += 2;
          var C = 0;
          for (var P in b) (T || b.hasOwnProperty(P)) && (w(P), w(b[P]), C++);
          he[M++ + r] = C >> 8, he[M + r] = C & 255;
        } : function (b) {
          var T = Object.keys(b),
            M,
            C = o.transitions || (o.transitions = Object.create(null)),
            P = 0;
          for (var _O11 = 0, I = T.length; _O11 < I; _O11++) {
            var z = T[_O11];
            M = C[z], M || (M = C[z] = Object.create(null), P++), C = M;
          }
          var D = C[jp];
          if (D) D >= 96 && m ? (he[ne++] = ((D -= 96) & 31) + 96, he[ne++] = D >> 5) : he[ne++] = D;else {
            D = o.nextId, D || (D = 64), D < g && _this93.shouldShareStructure && !_this93.shouldShareStructure(T) ? (D = o.nextOwnId, D < y || (D = g), o.nextOwnId = D + 1) : (D >= y && (D = g), o.nextId = D + 1);
            var _O12 = T.highByte = D >= 96 && m ? D - 96 >> 5 : -1;
            C[jp] = D, o[D - 64] = T, D < g ? (T.isShared = !0, o.sharedLength = D - 63, s = !0, _O12 >= 0 ? (he[ne++] = (D & 31) + 96, he[ne++] = _O12) : he[ne++] = D) : (_O12 >= 0 ? (he[ne++] = 213, he[ne++] = 114, he[ne++] = (D & 31) + 96, he[ne++] = _O12) : (he[ne++] = 212, he[ne++] = 114, he[ne++] = D), P && (x += S * P), v.length >= p && (v.shift()[jp] = 0), v.push(C), w(T));
          }
          for (var _O13 = 0, _I4 = T.length; _O13 < _I4; _O13++) w(b[T[_O13]]);
        },
        E = function E(b) {
          var T;
          if (b > 16777216) {
            if (b - r > rD) throw new Error("Packed buffer would be larger than maximum buffer size");
            T = Math.min(rD, Math.round(Math.max((b - r) * (b > 67108864 ? 1.25 : 2), 4194304) / 4096) * 4096);
          } else T = (Math.max(b - r << 2, he.length - 1) >> 12) + 1 << 12;
          var M = new Qw(T);
          return Yr = new DataView(M.buffer, 0, T), he.copy ? he.copy(M, 0, r, b) : M.set(he.slice(r, b)), ne -= r, r = 0, yo = M.length - 10, he = M;
        };
      return _this93;
    }
    _createClass(Cc, [{
      key: "useBuffer",
      value: function useBuffer(t) {
        he = t, Yr = new DataView(he.buffer, he.byteOffset, he.byteLength), ne = 0;
      }
    }]);
    return Cc;
  }(go);
Kw = [Date, Set, Error, RegExp, ArrayBuffer, Object.getPrototypeOf(Uint8Array.prototype).constructor, Gp];
Ev = [{
  pack: function pack(n, t, e) {
    var r = n.getTime() / 1e3;
    if ((this.useTimestamp32 || n.getMilliseconds() === 0) && r >= 0 && r < 4294967296) {
      var _t13 = t(6),
        i = _t13.target,
        s = _t13.targetView,
        o = _t13.position;
      i[o++] = 214, i[o++] = 255, s.setUint32(o, r);
    } else if (r > 0 && r < 17179869184) {
      var _t14 = t(10),
        _i24 = _t14.target,
        _s17 = _t14.targetView,
        _o11 = _t14.position;
      _i24[_o11++] = 215, _i24[_o11++] = 255, _s17.setUint32(_o11, n.getMilliseconds() * 4e6 + (r / 1e3 / 4294967296 >> 0)), _s17.setUint32(_o11 + 4, r);
    } else if (isNaN(r)) {
      if (this.onInvalidDate) return t(0), e(this.onInvalidDate());
      var _t15 = t(3),
        _i25 = _t15.target,
        _s18 = _t15.targetView,
        _o12 = _t15.position;
      _i25[_o12++] = 212, _i25[_o12++] = 255, _i25[_o12++] = 255;
    } else {
      var _t16 = t(15),
        _i26 = _t16.target,
        _s19 = _t16.targetView,
        _o13 = _t16.position;
      _i26[_o13++] = 199, _i26[_o13++] = 12, _i26[_o13++] = 255, _s19.setUint32(_o13, n.getMilliseconds() * 1e6), _s19.setBigInt64(_o13 + 4, BigInt(Math.floor(r)));
    }
  }
}, {
  pack: function pack(n, t, e) {
    var r = Array.from(n),
      _t17 = t(this.structuredClone ? 3 : 0),
      i = _t17.target,
      s = _t17.position;
    this.structuredClone && (i[s++] = 212, i[s++] = 115, i[s++] = 0), e(r);
  }
}, {
  pack: function pack(n, t, e) {
    var _t18 = t(this.structuredClone ? 3 : 0),
      r = _t18.target,
      i = _t18.position;
    this.structuredClone && (r[i++] = 212, r[i++] = 101, r[i++] = 0), e([n.name, n.message]);
  }
}, {
  pack: function pack(n, t, e) {
    var _t19 = t(this.structuredClone ? 3 : 0),
      r = _t19.target,
      i = _t19.position;
    this.structuredClone && (r[i++] = 212, r[i++] = 120, r[i++] = 0), e([n.source, n.flags]);
  }
}, {
  pack: function pack(n, t) {
    this.structuredClone ? iD(n, 16, t) : nD(Tv ? Buffer.from(n) : new Uint8Array(n), t);
  }
}, {
  pack: function pack(n, t) {
    var e = n.constructor;
    e !== sD && this.structuredClone ? iD(n, Xw.indexOf(e.name), t) : nD(n, t);
  }
}, {
  pack: function pack(n, t) {
    var _t20 = t(1),
      e = _t20.target,
      r = _t20.position;
    e[r] = 193;
  }
}];
function iD(n, t, e, r) {
  var i = n.byteLength;
  if (i + 1 < 256) {
    var _e39 = e(4 + i),
      s = _e39.target,
      o = _e39.position;
    s[o++] = 199, s[o++] = i + 1;
  } else if (i + 1 < 65536) {
    var _e40 = e(5 + i),
      s = _e40.target,
      o = _e40.position;
    s[o++] = 200, s[o++] = i + 1 >> 8, s[o++] = i + 1 & 255;
  } else {
    var _e41 = e(7 + i),
      s = _e41.target,
      o = _e41.position,
      a = _e41.targetView;
    s[o++] = 201, a.setUint32(o, i + 1), o += 4;
  }
  s[o++] = 116, s[o++] = t, s.set(new Uint8Array(n.buffer, n.byteOffset, n.byteLength), o);
}
function nD(n, t) {
  var e = n.byteLength;
  var r, i;
  if (e < 256) {
    var _t21 = t(e + 2),
      r = _t21.target,
      i = _t21.position;
    r[i++] = 196, r[i++] = e;
  } else if (e < 65536) {
    var _t22 = t(e + 3),
      r = _t22.target,
      i = _t22.position;
    r[i++] = 197, r[i++] = e >> 8, r[i++] = e & 255;
  } else {
    var _t23 = t(e + 5),
      r = _t23.target,
      i = _t23.position,
      s = _t23.targetView;
    r[i++] = 198, s.setUint32(i, e), i += 4;
  }
  r.set(n, i);
}
function sq(n, t, e, r) {
  var i = n.length;
  switch (i) {
    case 1:
      t[e++] = 212;
      break;
    case 2:
      t[e++] = 213;
      break;
    case 4:
      t[e++] = 214;
      break;
    case 8:
      t[e++] = 215;
      break;
    case 16:
      t[e++] = 216;
      break;
    default:
      i < 256 ? (t[e++] = 199, t[e++] = i) : i < 65536 ? (t[e++] = 200, t[e++] = i >> 8, t[e++] = i & 255) : (t[e++] = 201, t[e++] = i >> 24, t[e++] = i >> 16 & 255, t[e++] = i >> 8 & 255, t[e++] = i & 255);
  }
  return t[e++] = r, t.set(n, e), e += i, e;
}
function oq(n, t) {
  var e,
    r = t.length * 6,
    i = n.length - r;
  for (t.sort(function (s, o) {
    return s.offset > o.offset ? 1 : -1;
  }); e = t.pop();) {
    var s = e.offset,
      o = e.id;
    n.copyWithin(s + r, s, i), r -= 6;
    var a = s + r;
    n[a++] = 214, n[a++] = 105, n[a++] = o >> 24, n[a++] = o >> 16 & 255, n[a++] = o >> 8 & 255, n[a++] = o & 255, i = s;
  }
  return n;
}
function gl(n) {
  if (n.Class) {
    if (!n.pack && !n.write) throw new Error("Extension has no pack or write function");
    if (n.pack && !n.type) throw new Error("Extension has no type (numeric code to identify the extension)");
    Kw.unshift(n.Class), Ev.unshift(n);
  }
  tD(n);
}
var oD = new Cc({
    useRecords: !1
  }),
  aq = oD.pack,
  lq = oD.pack;
var cq = Av.NEVER,
  uq = Av.ALWAYS,
  dq = Av.DECIMAL_ROUND,
  hq = Av.DECIMAL_FIT,
  aD = 512,
  fq = 1024;
var lD = new Cc({
  structuredClone: !0
});
gl({
  Class: Ke.prototype.constructor,
  type: 1,
  write: function write(n) {
    return _objectSpread({}, n);
  },
  read: function read(n) {
    return Object.setPrototypeOf(n, Ke.prototype), n;
  }
});
gl({
  Class: Re.prototype.constructor,
  type: 2,
  write: function write(n) {
    return _toConsumableArray(n);
  },
  read: function read(n) {
    return Object.setPrototypeOf(n, Re.prototype), n;
  }
});
gl({
  Class: ar.prototype.constructor,
  type: 3,
  write: function write(n) {
    return _toConsumableArray(n);
  },
  read: function read(n) {
    return Object.setPrototypeOf(n, ar.prototype), n;
  }
});
gl({
  Class: Vp.prototype.constructor,
  type: 4,
  write: function write(n) {
    return n.id;
  },
  read: function read(n) {
    return new Vp(n);
  }
});
gl({
  Class: Up.prototype.constructor,
  type: 5,
  write: function write(n) {
    return n.data;
  },
  read: function read(n) {
    return new Up(n);
  }
});
gl({
  Class: lr.prototype.constructor,
  type: 6,
  write: function write(n) {
    return _objectSpread({}, n);
  },
  read: function read(n) {
    return Object.setPrototypeOf(n, lr.prototype), n;
  }
});
function pq(n) {
  var t = 0;
  if (n.length === 0) return t;
  for (var e = 0; e < n.length; e++) {
    var r = n[e];
    t = (t << 5) - t + r, t = t & t;
  }
  return t;
}
function Zw(n) {
  if (Dd(n)) return n;
  if (Array.isArray(n)) return n.map(Zw);
  if (_typeof(n) == "object" && n !== null) {
    var t = {};
    var _iterator31 = _createForOfIteratorHelper(Object.keys(n).sort()),
      _step31;
    try {
      for (_iterator31.s(); !(_step31 = _iterator31.n()).done;) {
        var e = _step31.value;
        t[e] = Zw(n[e]);
      }
    } catch (err) {
      _iterator31.e(err);
    } finally {
      _iterator31.f();
    }
    return Object.setPrototypeOf(t, Object.getPrototypeOf(n)), t;
  } else return n;
}
var Mv;
(function (r) {
  function n(i) {
    return lD.pack(i);
  }
  r.serialize = n;
  function t(i) {
    return lD.unpack(i);
  }
  r.deserialize = t;
  function e(i) {
    return pq(n(Zw(i))).toString();
  }
  r.checksum = e;
})(Mv || (Mv = {}));
var cD;
(function (e) {
  function n(r) {
    return r.type === "Conditional" ? r.condition.type === "Distance" ? "Distance" : "StateChange" : r.type;
  }
  e.toEventUIType = n;
  function t(r) {
    return r === "Distance" || r === "StateChange" ? "Conditional" : r;
  }
  e.fromEventUIType = t;
})(cD || (cD = {}));
var gn = (_gn = {}, _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_gn, "LookAt", []), "Follow", ["Create"]), "DragDrop", ["Transition", "Animation", "Audio", "Particles", "Create", "SetVariable", "DynamicVariablePlay", "Conditional"]), "MouseHover", ["Transition", "Animation", "Particles", "Create", "Destroy", "SwitchCamera", "SceneTransition", "SetVariable", "DynamicVariablePlay", "Conditional"]), "Scroll", ["Transition", "Animation", "Create", "SetVariable", "DynamicVariablePlay", "Conditional"]), "Start", ["Transition", "Animation", "Audio", "Particles", "Video", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "Conditional", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "MouseDown", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "MouseUp", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "MousePress", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_gn, "KeyDown", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "KeyUp", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "KeyPress", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "SwitchCamera", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "GameControl", ["Transition", "Animation", "Audio", "Particles", "Create", "Conditional"]), "Collision", ["Transition", "Animation", "Audio", "Particles", "Video", "Create", "Destroy", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "Trigger", ["Transition", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "Resize", ["Transition", "Animation", "Audio", "Particles", "Video", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"]), "VariableChange", ["Transition", "Animation", "Audio", "Particles", "Video", "Link", "Create", "Destroy", "SwitchCamera", "SceneTransition", "Reset", "SetVariable", "DynamicVariablePlay", "Conditional"])),
  uD;
(function (e) {
  function n(r) {
    return r.type === "MouseDown" || r.type === "MouseUp" || r.type === "MousePress" || r.type === "KeyDown" || r.type === "KeyUp" || r.type === "KeyPress";
  }
  e.is = n;
  function t(r) {
    return r === "MouseDown" || r === "MouseUp" || r === "MousePress" ? {
      type: r,
      mode: "Object",
      disabled: !1,
      runMode: "Once",
      actions: new Re()
    } : {
      type: r,
      disabled: !1,
      key: void 0,
      runMode: "Once",
      actions: new Re()
    };
  }
  e.defaultData = t;
})(uD || (uD = {}));
var Cv;
(function (e) {
  function n(r) {
    return {
      type: "Property",
      value: [r !== null && r !== void 0 ? r : null, "position", "x"]
    };
  }
  e.propertyDefaultData = n, e.valueDefaultData = {
    type: "Literal",
    value: 0
  };
})(Cv || (Cv = {}));
var Jw;
(function (r) {
  function n(i) {
    return {
      type: "Comparison",
      operator: "==",
      lOperand: Cv.propertyDefaultData(i),
      rOperand: _objectSpread({}, Cv.valueDefaultData)
    };
  }
  r.comparisonDefaultData = n;
  function t(i) {
    return {
      type: "Distance",
      toObject: i !== null && i !== void 0 ? i : null,
      fromObject: i !== null && i !== void 0 ? i : null,
      distance: 200
    };
  }
  r.distanceDefaultData = t;
  function e(i, s) {
    return {
      type: "State",
      object: i !== null && i !== void 0 ? i : null,
      state: s !== null && s !== void 0 ? s : null
    };
  }
  r.stateDefaultData = e;
})(Jw || (Jw = {}));
var dD;
(function (e) {
  function n(r) {
    return r.type === "Conditional";
  }
  e.is = n;
  function t(r) {
    return {
      type: "Conditional",
      disabled: !1,
      inActions: new Re(),
      outActions: new Re(),
      condition: Jw.distanceDefaultData(r)
    };
  }
  e.defaultData = t;
})(dD || (dD = {}));
var hD;
(function (t) {
  return t.defaultData = {
    type: "DragDrop",
    cursor: "hand",
    disabled: !1,
    dampingFactor: 1,
    objects: [],
    snapTo: "center",
    snapSurfaceMode: "bbox",
    snapSurfaceOffset: 0,
    dropOn: "all",
    autoOrient: !0,
    dropDestinations: [],
    plane: "adaptive",
    planeMode: "locked",
    referenceFrame: "global",
    limits: [-1 / 0, 1 / 0, -1 / 0, 1 / 0, -1 / 0, 1 / 0],
    drop: !1,
    resetOnSnapFail: !1,
    snapSpeed: 20,
    resetSpeed: 20,
    dragDropActions: {
      drag: new Re(),
      drop: new Re()
    }
  };
})(hD || (hD = {}));
var Pv;
(function (t) {
  return t.defaultData = {
    type: "Follow",
    disabled: !1,
    maxDelta: 0,
    dampingFactor: 1,
    target: "cursor",
    plane: "custom",
    resetOnPointerLeave: !0,
    resetAfterDistanceLimit: !0,
    enabledTranslation: [!0, !0, !0],
    limitDistanceEnabled: !1,
    limitDistance: 1e3,
    snapDelay: 0,
    resetSpeed: 5,
    actions: new Re()
  };
})(Pv || (Pv = {}));
var Dv;
(function (t) {
  return t.defaultData = {
    type: "LookAt",
    disabled: !1,
    distance: 1e3,
    dampingFactor: 1,
    target: "cursor",
    tilt: "up",
    axis: "z",
    plane: "custom",
    resetOnPointerLeave: !0,
    resetAfterDistanceLimit: !0,
    enabledRotation: [!0, !0, !0],
    limitDistanceEnabled: !1,
    limitDistance: 1e3,
    snapDelay: 0,
    resetSpeed: 5
  };
})(Dv || (Dv = {}));
var fD;
(function (e) {
  function n(r) {
    return r.type === "MouseHover";
  }
  e.is = n;
  function t() {
    return {
      type: "MouseHover",
      disabled: !1,
      actions: new Re()
    };
  }
  e.defaultData = t;
})(fD || (fD = {}));
var pD;
(function (e) {
  function n(r) {
    return r.type === "Scroll";
  }
  e.is = n;
  function t() {
    return {
      type: "Scroll",
      disabled: !1,
      steps: 100,
      trigger: "load",
      startFrom: "enter",
      enterAnchor: "top",
      startOffset: 0,
      endAfter: 400,
      actions: new Re()
    };
  }
  e.defaultData = t;
})(pD || (pD = {}));
var mD;
(function (e) {
  function n(r) {
    return r.type === "Start";
  }
  e.is = n;
  function t() {
    return {
      type: "Start",
      disabled: !1,
      actions: new Re()
    };
  }
  e.defaultData = t;
})(mD || (mD = {}));
var gD;
(function (e) {
  function n(r) {
    return r.type === "Collision";
  }
  e.is = n;
  function t() {
    return {
      type: "Collision",
      disabled: !1,
      runMode: "Once",
      target: "character",
      actions: new Re()
    };
  }
  e.defaultData = t;
})(gD || (gD = {}));
var yD;
(function (e) {
  function n(r) {
    return r.type === "Trigger";
  }
  e.is = n;
  function t(r, i) {
    return {
      type: "Trigger",
      disabled: !1,
      runMode: "Once",
      target: "all",
      triggeringObjects: [],
      actions: new Re(),
      triggerZone: "box",
      position: i.toArray(),
      rotation: [0, 0, 0],
      size: r.toArray(),
      radius: r.length() / 2,
      helperVisible: !0
    };
  }
  e.defaultData = t;
})(yD || (yD = {}));
var Ov;
(function (o) {
  o.defaultSizes = {
    mobile: [480, 480],
    tablet: [768, 768],
    desktop: [1200, 1200],
    custom: [769, 1200]
  };
  function t(a) {
    return a.type === "Resize";
  }
  o.is = t;
  function e(a) {
    return typeof a == "string" ? a : "custom";
  }
  o.sizeToDevice = e;
  function r(a) {
    return typeof a == "string" ? _toConsumableArray(o.defaultSizes[a]) : _toConsumableArray(a);
  }
  o.deviceToSize = r;
  function i() {
    var a = {
        size: "mobile",
        operator: "<",
        actions: new Re()
      },
      l = {
        size: "tablet",
        operator: "<",
        actions: new Re()
      },
      u = {
        size: _toConsumableArray(o.defaultSizes.custom),
        operator: "<>",
        actions: new Re()
      },
      c = new Re();
    return c.push({
      id: Se.generateUUID(),
      fi: 0,
      data: a
    }, {
      id: Se.generateUUID(),
      fi: 1,
      data: l
    }, {
      id: Se.generateUUID(),
      fi: 2,
      data: u
    }), {
      type: "Resize",
      disabled: !1,
      orientation: "horizontal",
      breakpoints: c
    };
  }
  o.defaultData = i;
  function s() {
    return {
      size: _toConsumableArray(o.defaultSizes.custom),
      operator: "<>",
      actions: new Re()
    };
  }
  o.defaultBreakpointData = s;
})(Ov || (Ov = {}));
var Iv;
(function (r) {
  r.propertyPaths = {
    Position: ["position"],
    "Position X": ["position", "x"],
    "Position Y": ["position", "y"],
    "Position Z": ["position", "z"],
    Rotation: ["rotation"],
    "Rotation X": ["rotation", "x"],
    "Rotation Y": ["rotation", "y"],
    "Rotation Z": ["rotation", "z"],
    Scale: ["scale"],
    "Scale X": ["scale", "x"],
    "Scale Y": ["scale", "y"],
    "Scale Z": ["scale", "z"],
    Width: ["width"],
    Height: ["height"],
    Depth: ["depth"],
    "Mouse Position X": ["mouse", "x"],
    "Mouse Position Y": ["mouse", "y"],
    "Mouse Pressed": ["mouse", "pressed"],
    "Screen Width": ["mouse", "width"],
    "Screen Height": ["mouse", "height"],
    "Hit Position X": ["raycast", "x"],
    "Hit Position Y": ["raycast", "y"],
    "Hit Position Z": ["raycast", "z"],
    "Hit Object Position X": ["raycast", "objX"],
    "Hit Object Position Y": ["raycast", "objY"],
    "Hit Object Position Z": ["raycast", "objZ"]
  };
  function t(i) {
    return i.type === "VariableChange";
  }
  r.is = t;
  function e() {
    return {
      disabled: !1,
      type: "VariableChange",
      actions: new Re(),
      variableId: "",
      objectId: null,
      property: "Position X"
    };
  }
  r.defaultData = e;
})(Iv || (Iv = {}));
var us = "personal camera",
  vl = "a218fcc3-276b-49b9-b485-49037fd14f5f",
  bD = 2960946,
  Xr = 5526619;
var xo;
(function (d) {
  function n(h, f) {
    return h[0] === f[0] && h[1] === f[1];
  }
  d.isEqual = n;
  function t(h, f, p) {
    return [h[0] + (f[0] - h[0]) * p, h[1] + (f[1] - h[1]) * p];
  }
  d.lerp = t;
  function e(h, f) {
    return [h[0] + f[0], h[1] + f[1]];
  }
  d.add = e;
  function r(h, f) {
    return [h[0] - f[0], h[1] - f[1]];
  }
  d.sub = r;
  function i(h, f) {
    return Math.pow(f[0] - h[0], 2) + Math.pow(f[1] - h[1], 2);
  }
  d.distanceSquared = i;
  function s(h, f) {
    return Math.sqrt(i(h, f));
  }
  d.distance = s;
  function o(h, f) {
    return h[0] * f[0] + h[1] * f[1];
  }
  d.dot = o;
  function a(h, f) {
    return [h[0] * f, h[1] * f];
  }
  d.scalarMultiply = a;
  function l(h, f, p) {
    var m = d.sub(f, h),
      g = d.sub(p, h),
      y = d.dot(m, g) / d.dot(m, m),
      v = d.scalarMultiply(m, y);
    return d.add(h, v);
  }
  d.projectionOnto = l;
  function u(h, f, p) {
    return s(h, l(h, f, p));
  }
  d.projectionOntoDistance = u;
  function c(h, f) {
    return [(h[0] + f[0]) * .5, (h[1] + f[1]) * .5];
  }
  d.center = c;
})(xo || (xo = {}));
var bo;
(function (a) {
  function n(l, u) {
    return l[0] === u[0] && l[1] === u[1] && l[2] === u[2];
  }
  a.isEqual = n;
  function t(l, u) {
    return [l[0] + u[0], l[1] + u[1], l[2] + u[2]];
  }
  a.add = t;
  function e(l, u) {
    return [l[0] - u[0], l[1] - u[1], l[2] - u[2]];
  }
  a.sub = e;
  function r(l, u) {
    return [l[0] / u[0], l[1] / u[1], l[2] / u[2]];
  }
  a.div = r;
  function i(l, u) {
    return [l[0] * u[0], l[1] * u[1], l[2] * u[2]];
  }
  a.mul = i;
  function s(l, u) {
    return Math.hypot(l[0] - u[0], l[1] - u[1], l[2] - u[2]);
  }
  a.dist = s;
  function o(l, u, c) {
    return [l[0] + (u[0] - l[0]) * c, l[1] + (u[1] - l[1]) * c, l[2] + (u[2] - l[2]) * c];
  }
  a.lerp = o;
})(bo || (bo = {}));
var Hp;
(function (e) {
  function n(r, i) {
    return r[0] === i[0] && r[1] === i[1] && r[2] === i[2] && r[3] === i[3];
  }
  e.isEqual = n;
  function t(r, i, s) {
    return [r[0] + (i[0] - r[0]) * s, r[1] + (i[1] - r[1]) * s, r[2] + (i[2] - r[2]) * s, r[3] + (i[3] - r[3]) * s];
  }
  e.lerp = t;
})(Hp || (Hp = {}));
var yl;
(function (i) {
  i.identity = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
  function t(s, o) {
    for (var a = 0; a < 16; a++) if (s[a] !== o[a]) return !1;
    return !0;
  }
  i.isEqual = t;
  function e(s) {
    return s !== null && s !== void 0 ? s : i.identity;
  }
  i.simplify = e;
  function r(s, o) {
    var a = o.slice(0);
    for (var l = 0, u = o.length; l < u; l += 3) {
      var c = s[3] * o[l] + s[7] * o[l + 1] + s[11] * o[l + 2] + s[15];
      a[l] = (s[0] * o[l] + s[4] * o[l + 1] + s[8] * o[l + 2] + s[12]) / c, a[l + 1] = (s[1] * o[l] + s[5] * o[l + 1] + s[9] * o[l + 2] + s[13]) / c, a[l + 2] = (s[2] * o[l] + s[6] * o[l + 1] + s[10] * o[l + 2] + s[14]) / c;
    }
    return a;
  }
  i.applyMatrix4 = r;
})(yl || (yl = {}));
var Ni;
(function (c) {
  function n(d) {
    return _typeof(d) == "object" && typeof d.r == "number" && typeof d.g == "number" && typeof d.b == "number";
  }
  c.isRGB = n, c.white = {
    r: 1,
    g: 1,
    b: 1
  }, c.red = {
    r: 1,
    g: 0,
    b: 0
  }, c.black = {
    r: 0,
    g: 0,
    b: 0
  };
  function i(d) {
    return {
      r: Math.round(d.r * 255),
      g: Math.round(d.g * 255),
      b: Math.round(d.b * 255),
      a: 1
    };
  }
  c.toRgb255a1 = i;
  function s(d) {
    return {
      r: d.r,
      g: d.g,
      b: d.b
    };
  }
  c.clone = s;
  function o(d) {
    return d = Math.floor(d), {
      r: (d >> 16 & 255) / 255,
      g: (d >> 8 & 255) / 255,
      b: (d & 255) / 255
    };
  }
  c.fromHex = o;
  function a(d) {
    return Math.round(d.r * 255) * 65536 + Math.round(d.g * 255) * 256 + Math.round(d.b * 255);
  }
  c.toHex = a;
  function l(d, h) {
    return d.r === h.r && d.g === h.g && d.b === h.b;
  }
  c.equals = l;
  function u(d, h, f) {
    return {
      r: d.r + (h.r - d.r) * f,
      g: d.g + (h.g - d.g) * f,
      b: d.b + (h.b - d.b) * f
    };
  }
  c.lerp = u;
})(Ni || (Ni = {}));
var pt;
(function (l) {
  l.white = _objectSpread(_objectSpread({}, Ni.white), {}, {
    a: 1
  }), l.transparent = _objectSpread(_objectSpread({}, Ni.white), {}, {
    a: 0
  });
  function e(u) {
    return {
      r: u[0],
      g: u[1],
      b: u[2],
      a: u[3]
    };
  }
  l.from0to1 = e;
  function r(u, c) {
    return _objectSpread(_objectSpread({}, Ni.fromHex(u)), {}, {
      a: c
    });
  }
  l.fromHexAndA = r;
  function i(u) {
    return {
      r: Math.round(u.r * 255),
      g: Math.round(u.g * 255),
      b: Math.round(u.b * 255),
      a: u.a
    };
  }
  l.toRgb255a1 = i;
  function s(u, c) {
    return Ni.equals(u, c) && u.a === c.a;
  }
  l.equals = s;
  function o(u, c, d) {
    return {
      r: u.r + (c.r - u.r) * d,
      g: u.g + (c.g - u.g) * d,
      b: u.b + (c.b - u.b) * d,
      a: u.a + (c.a - u.a) * d
    };
  }
  l.lerp = o;
  function a() {
    var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : l.white,
      u = _ref4.r,
      c = _ref4.g,
      d = _ref4.b,
      h = _ref4.a;
    return "rgba(".concat(u * 255, ", ").concat(c * 255, ", ").concat(d * 255, ", ").concat(h, ")");
  }
  l.toStyle = a;
})(pt || (pt = {}));
var Rv;
(function (t) {
  return t.identity = {
    position: [0, 0, 0],
    rotation: [0, 0, 0],
    scale: [1, 1, 1]
  };
})(Rv || (Rv = {}));
var vD;
(function (t) {
  return t.defaultData = {
    mass: 1,
    stiffness: 80,
    damping: 10,
    velocity: 0
  };
})(vD || (vD = {}));
var xD;
(function (t) {
  return t.defaultData = {
    control1: [.5, 0],
    control2: [.5, 1]
  };
})(xD || (xD = {}));
var pa;
(function (s) {
  return s.linear = [0, 0, 1, 1], s.ease = [.25, .1, .25, 1], s.easeIn = [.42, 0, 1, 1], s.easeOut = [0, 0, .58, 1], s.easeInOut = [.42, 0, .58, 1];
})(pa || (pa = {}));
function $w(n) {
  return typeof n == "string" && n.length === 36 ? /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n) : !1;
}
var ks;
(function (e) {
  e.all = ["PerspectiveCamera", "OrthographicCamera"];
  function t(r) {
    return e.all.includes(r);
  }
  e.is = t;
})(ks || (ks = {}));
var xl;
(function (i) {
  i.DefaultUp = [0, 1, 0], i.DefaultTargetOffset = 1e3, i.defaultData = {
    far: 1e5,
    type: "OrthographicCamera",
    perspective: {
      near: 70,
      fov: 45,
      zoom: 1
    },
    orthographic: {
      near: -1e5,
      zoom: 1
    },
    up: i.DefaultUp,
    isUpVectorFlipped: !1,
    targetOffset: i.DefaultTargetOffset
  };
  function r(s) {
    return s.type === "PerspectiveCamera" ? s.perspective.zoom : s.orthographic.zoom;
  }
  i.getZoom = r;
})(xl || (xl = {}));
var So;
(function (e) {
  function n(r) {
    var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : .1;
    return {
      disabled: !1,
      type: "linear",
      hideBase: !1,
      count: 3,
      radial: {
        radius: Math.max(r[0], r[1]) * 2,
        start: 0,
        end: 360,
        alignment: !1,
        axis: "y",
        scale: [1, 1, 1],
        rotation: [0, 0, 0],
        position: [0, 0, 0]
      },
      toObject: {
        object: "",
        spreadType: "random",
        scale: [0, 0, 0],
        rotation: [0, 0, 0],
        position: [0, 0, 0],
        axis: "x",
        seed: 0,
        count: 99,
        align: "normal"
      },
      linear: {
        scale: [1, 1, 1],
        rotation: [0, 0, 0],
        position: [r[0] + r[0] * i, 0, 0]
      },
      grid: {
        count: [2, 2, 2],
        size: r.map(function (s) {
          return s * (1 + i);
        }),
        useCenter: !0
      },
      randomness: !1,
      randomnessObject: {
        strength: 100,
        scale: [0, 0, 0],
        rotation: [0, 0, 0],
        position: [0, 0, 0],
        movement: 1,
        seed: 0,
        freqScale: 10,
        noiseType: "perlin"
      }
    };
  }
  e.defaultData = n;
  function t(r, i) {
    var s = _objectSpread({}, r);
    if (e1.forEach(function (o) {
      var _i$o;
      Object.assign(s, _defineProperty({}, o, (_i$o = i[o]) !== null && _i$o !== void 0 ? _i$o : r[o]));
    }), s.radial = _objectSpread({}, r.radial), i.radial) {
      var o = r.radial,
        a = i.radial;
      t1.forEach(function (l) {
        var _a$l;
        Object.assign(s.radial, _defineProperty({}, l, (_a$l = a[l]) !== null && _a$l !== void 0 ? _a$l : o[l]));
      });
    }
    if (s.linear = _objectSpread({}, r.linear), i.linear) {
      var _o14 = r.linear,
        _a18 = i.linear;
      r1.forEach(function (l) {
        var _a18$l;
        Object.assign(s.linear, _defineProperty({}, l, (_a18$l = _a18[l]) !== null && _a18$l !== void 0 ? _a18$l : _o14[l]));
      });
    }
    if (s.grid = _objectSpread({}, r.grid), i.grid) {
      var _o15 = r.grid,
        _a19 = i.grid;
      i1.forEach(function (l) {
        var _a19$l;
        Object.assign(s.grid, _defineProperty({}, l, (_a19$l = _a19[l]) !== null && _a19$l !== void 0 ? _a19$l : _o15[l]));
      });
    }
    if (s.toObject = _objectSpread({}, r.toObject), i.toObject) {
      var _o16 = r.toObject,
        _a20 = i.toObject;
      n1.forEach(function (l) {
        var _a20$l;
        Object.assign(s.toObject, _defineProperty({}, l, (_a20$l = _a20[l]) !== null && _a20$l !== void 0 ? _a20$l : _o16[l]));
      });
    }
    if (s.randomnessObject = _objectSpread({}, r.randomnessObject), i.randomnessObject) {
      var _o17 = r.randomnessObject,
        _a21 = i.randomnessObject;
      s1.forEach(function (l) {
        var _a21$l;
        Object.assign(s.randomnessObject, _defineProperty({}, l, (_a21$l = _a21[l]) !== null && _a21$l !== void 0 ? _a21$l : _o17[l]));
      });
    }
    return s;
  }
  e.merge = t;
})(So || (So = {}));
var Lv;
(function (r) {
  r.defaultData = {
    radial: {},
    linear: {},
    grid: {},
    toObject: {},
    randomnessObject: {}
  };
  var t = ["radial", "linear", "grid", "toObject", "randomnessObject"];
  function e(i, s) {
    var o = [];
    i.count !== void 0 && o.push({
      type: 0,
      path: s,
      props: {
        count: i.count
      }
    });
    var _iterator32 = _createForOfIteratorHelper(t),
      _step32;
    try {
      for (_iterator32.s(); !(_step32 = _iterator32.n()).done;) {
        var a = _step32.value;
        var l = i[a];
        l && Object.keys(l).length > 0 && o.push({
          type: 0,
          path: [].concat(_toConsumableArray(s), [a]),
          props: l
        });
      }
    } catch (err) {
      _iterator32.e(err);
    } finally {
      _iterator32.f();
    }
    return o;
  }
  r.toOps = e;
})(Lv || (Lv = {}));
var e1 = ["count"],
  t1 = ["radius", "start", "end", "position", "scale", "rotation"],
  r1 = ["position", "scale", "rotation"],
  i1 = ["count", "size"],
  n1 = ["count", "position", "scale", "rotation"],
  s1 = ["strength", "scale", "rotation", "position", "movement", "seed", "freqScale"];
var Bv;
(function (e) {
  e.all = ["PointLight", "SpotLight", "DirectionalLight", "HemisphereLight"];
  function t(r) {
    return e.all.includes(r);
  }
  e.is = t;
})(Bv || (Bv = {}));
var Nv;
(function (e) {
  function n(r) {
    return t(r);
  }
  e.defaultData = n;
  function t(r) {
    if (r === "PointLight") return {
      type: r,
      color: pt.white,
      intensity: 1,
      distance: 2e3,
      decay: 1,
      shadows: !0,
      shadowResolution: 1024,
      shadowRadius: 1,
      penumbraSize: .5,
      depth: 1e5
    };
    if (r === "SpotLight") return {
      type: r,
      color: pt.white,
      intensity: 1,
      distance: 2e3,
      decay: 1,
      shadows: !0,
      penumbra: 0,
      angle: 30 / 180 * Math.PI,
      depth: 1e5,
      penumbraSize: .5,
      shadowResolution: 1024,
      shadowRadius: 1
    };
    if (r === "DirectionalLight") return {
      type: r,
      color: pt.white,
      intensity: 1,
      shadows: !0,
      size: 2e3,
      depth: 1e5,
      penumbraSize: .5,
      shadowResolution: 1024,
      shadowRadius: 1
    };
    throw new Error("not implemented");
  }
})(Nv || (Nv = {}));
var Fd;
(function (r) {
  return r.defaultShapeData = {
    type: "PlaneEmitterShape",
    size: [100, 100, 100]
  }, r.defaultCollisionData = {
    colliderEntityId: null,
    collisionBounce: .75
  }, r.defaultData = _objectSpread({
    renderMaterial: {
      type: "particleMaterial",
      color: {
        r: 1,
        g: .2,
        b: .545,
        a: 1
      },
      color2: {
        r: .945,
        g: .714,
        b: .184,
        a: 1
      },
      coloring: "gradient",
      ease: "linearFadeOut",
      easeSize: "linearFadeOut",
      transparent: !0,
      size: [40, 40],
      texture: "pt_default_particle",
      spriteRotation: [0, 0]
    },
    birthRatePerSec: 50,
    gravity: 1,
    noiseStrength: 0,
    noiseScale: 0,
    noiseSeed: 1,
    noiseType: "curl",
    randomRotation: 0,
    randomScale: .2,
    randomMass: .5,
    rootObjectType: "instancedMesh",
    life: 1,
    direction: [0, 0, 0],
    directionMode: "axis",
    speed: 10,
    shape: r.defaultShapeData,
    autoPlay: !0,
    emitTimeDelay: 0,
    emitTimeCycle: "infinity",
    emitTimeLoopDelayStart: "end",
    emitTimeDuration: 1
  }, r.defaultCollisionData);
})(Fd || (Fd = {}));
var bl;
(function (t) {
  return t.defaultData = {
    enabled: "visibility",
    fusedBody: !0,
    rigidBody: "positioned",
    density: 1,
    pointMass: 0,
    gravityScale: 1,
    friction: .5,
    damping: 0,
    restitution: .2,
    colliderType: "convex",
    enabledRotation: [!0, !0, !0],
    enabledTranslation: [!0, !0, !0]
  };
})(bl || (bl = {}));
var o1;
(function (e) {
  e.defaultData = {
    castShadow: !0,
    receiveShadow: !0
  };
  function t(r, i) {
    return r.castShadow === i.castShadow && r.receiveShadow === i.receiveShadow;
  }
  e.equals = t;
})(o1 || (o1 = {}));
var a1;
(function (e) {
  e.defaultData = {
    flatShading: !1,
    wireframe: !1,
    side: 0
  };
  function t(r, i) {
    return r.flatShading === i.flatShading && r.side === i.side && r.wireframe === i.wireframe;
  }
  e.equals = t;
})(a1 || (a1 = {}));
var Fv;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({}, a1.defaultData), o1.defaultData);
})(Fv || (Fv = {}));
var SD;
(function (t) {
  function n(e, r) {
    var i = [];
    if ("material" in e) {
      var _r$materials$e$materi, _r$lib$materials$e$ma;
      var s = typeof e.material == "string" ? (_r$materials$e$materi = r.materials[e.material]) !== null && _r$materials$e$materi !== void 0 ? _r$materials$e$materi : (_r$lib$materials$e$ma = r.lib.materials[e.material]) === null || _r$lib$materials$e$ma === void 0 ? void 0 : _r$lib$materials$e$ma.asset : e.material;
      s && i.push(s);
    } else if ("materials" in e) {
      var _iterator33 = _createForOfIteratorHelper(e.materials),
        _step33;
      try {
        for (_iterator33.s(); !(_step33 = _iterator33.n()).done;) {
          var _r$materials$_s, _r$lib$materials$_s;
          var _s20 = _step33.value;
          var o = typeof _s20 == "string" ? (_r$materials$_s = r.materials[_s20]) !== null && _r$materials$_s !== void 0 ? _r$materials$_s : (_r$lib$materials$_s = r.lib.materials[_s20]) === null || _r$lib$materials$_s === void 0 ? void 0 : _r$lib$materials$_s.asset : _s20;
          o && i.push(o);
        }
      } catch (err) {
        _iterator33.e(err);
      } finally {
        _iterator33.f();
      }
    }
    return i;
  }
  t.getMaterialData = n;
})(SD || (SD = {}));
var kd;
(function (e) {
  return e.defaultVideo = {
    data: "",
    thumb: "/_assets/_videos/catThumb.png",
    type: "video",
    name: "Cat video"
  }, e.maxSize = 3e7;
})(kd || (kd = {}));
var wD;
(function (t) {
  function n(e) {
    return e === "texture" || e === "video" || e === "color" || e === "depth" || e === "normal" || e === "gradient" || e === "noise" || e === "fresnel" || e === "rainbow" || e === "toon" || e === "outline" || e === "particle" || e === "transmission" || e === "matcap" || e === "displace" || e === "pattern" || e === "light";
  }
  t.is = n;
})(wD || (wD = {}));
function _D(n) {
  return n.type !== "displace";
}
var AD;
(function (t) {
  function n(e) {
    return e === "phong" || e === "toon" || e === "lambert" || e === "physical";
  }
  t.is = n;
})(AD || (AD = {}));
var kv = ["mode", "gradientType", "noiseType", "displacementType", "projection", "cnormal", "crop", "axis", "side"],
  ED = ["wrapping", "image", "video", "name"],
  Ir;
(function (i) {
  function n(s, o) {
    var a = o.texture,
      l = _objectWithoutProperties(o, _excluded);
    if (Object.assign(s, l), a) {
      var u = s.texture;
      u && Object.assign(u, a);
    }
  }
  i.patch = n;
  function t(s, o) {
    return s === "light" && o ? e(o) : r(s);
  }
  i.defaultData = t;
  function e(s) {
    var o = {
      mode: 0,
      isMask: !1,
      visible: !0,
      bumpMap: void 0,
      bumpMapIntensity: 5,
      roughnessMap: void 0,
      alphaOverride: 1
    };
    switch (s) {
      case "phong":
        return _objectSpread(_objectSpread({}, o), {}, {
          category: "phong",
          specular: {
            r: .2,
            g: .2,
            b: .2
          },
          shininess: 5,
          type: "light",
          visible: !0,
          mode: 0,
          occlusion: !0,
          alpha: .6
        });
      case "toon":
        return _objectSpread(_objectSpread({}, o), {}, {
          category: "toon",
          specular: {
            r: .2,
            g: .2,
            b: .2
          },
          shininess: 10,
          type: "light",
          alpha: 1
        });
      case "lambert":
        return _objectSpread(_objectSpread({}, o), {}, {
          category: "lambert",
          emissive: {
            r: 0,
            g: 0,
            b: 0
          },
          type: "light",
          alpha: 1,
          visible: !0,
          mode: 0,
          occlusion: !0
        });
      case "physical":
        return _objectSpread(_objectSpread({}, o), {}, {
          category: "physical",
          roughness: .2,
          metalness: .2,
          reflectivity: .2,
          type: "light",
          alpha: 1,
          visible: !0,
          mode: 0,
          occlusion: !0
        });
    }
  }
  function r(s) {
    var o = {
      alpha: 1,
      mode: 0,
      isMask: !1,
      visible: !0
    };
    switch (s) {
      case "texture":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "texture",
          size: [128, 128],
          blending: 0,
          axis: "x",
          side: 2,
          projection: 0,
          texture: {
            image: "image_0",
            wrapping: 1e3,
            repeat: [1, 1],
            offset: [0, 0]
          },
          crop: !1
        });
      case "video":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "video",
          size: [128, 128],
          blending: 0,
          axis: "x",
          side: 2,
          projection: 0,
          texture: {
            video: kd.defaultVideo,
            wrapping: 1001,
            repeat: [1, 1],
            offset: [0, 0]
          },
          crop: !1
        });
      case "color":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "color",
          color: Ni.fromHex(Xr)
        });
      case "depth":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "depth",
          gradientType: 1,
          smooth: !1,
          isVector: !0,
          isWorldSpace: !1,
          origin: [0, 0, 0],
          direction: [1, 0, 0],
          colors: [[1, 1, 1, 1], [0, 0, 0, 1]],
          steps: [0, 1],
          near: 50,
          far: 200
        });
      case "normal":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "normal",
          cnormal: [1, 1, 1]
        });
      case "gradient":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "gradient",
          gradientType: 0,
          smooth: !1,
          colors: [[0, 0, 0, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],
          steps: [0, 1, 1, 1, 1, 1, 1, 1, 1, 1],
          num: 2,
          angle: 0,
          offset: [0, 0],
          morph: [0, 0]
        });
      case "noise":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "noise",
          size: [100, 100, 100],
          noiseType: 0,
          scale: 1,
          move: 1,
          colorA: _objectSpread(_objectSpread({}, Ni.fromHex(6710886)), {}, {
            a: 1
          }),
          colorB: _objectSpread(_objectSpread({}, Ni.fromHex(6710886)), {}, {
            a: 1
          }),
          colorC: _objectSpread(_objectSpread({}, Ni.fromHex(16777215)), {}, {
            a: 1
          }),
          colorD: _objectSpread(_objectSpread({}, Ni.fromHex(16777215)), {}, {
            a: 1
          }),
          distortion: [1, 1],
          fA: [1.7, 9.2],
          fB: [8.3, 2.8],
          voronoiStyle: 0,
          highCut: 1,
          lowCut: 0,
          smoothness: .3,
          seed: 0,
          quality: 1
        });
      case "fresnel":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "fresnel",
          color: pt.fromHexAndA(16777215, 1),
          bias: .1,
          scale: 1,
          intensity: 2,
          factor: 1
        });
      case "rainbow":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "rainbow",
          filmThickness: 30,
          movement: 0,
          wavelengths: [0, 0, 0],
          noiseStrength: 0,
          noiseScale: 1,
          offset: [0, 0, 0]
        });
      case "toon":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "toon",
          positioning: 2,
          colors: [[0, 0, 0, 1], [.5, .5, .5, 1], [.5, .5, .5, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],
          steps: [0, .475, .525, 1, 1, 1, 1, 1, 1, 1],
          num: 4,
          source: [0, 1e3, 0],
          isWorldSpace: !0,
          noiseStrength: 0,
          noiseScale: 1,
          shadowColor: pt.fromHexAndA(0, 0),
          offset: [0, 0, 0]
        });
      case "outline":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "outline",
          outlineColor: pt.fromHexAndA(0, 1),
          contourColor: pt.fromHexAndA(0, 1),
          outlineWidth: 2,
          contourWidth: 5,
          outlineThreshold: .4,
          contourThreshold: 0,
          outlineSmoothing: 0,
          contourFrequency: 10,
          contourDirection: [0, 1, 0],
          positionalLines: !1,
          compensation: !0
        });
      case "matcap":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "matcap",
          texture: {
            image: "matcap_0",
            wrapping: 1001,
            repeat: [1, 1],
            offset: [0, 0]
          }
        });
      case "transmission":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "transmission",
          thickness: 10,
          ior: 1.5,
          roughness: 1
        });
      case "displace":
        return {
          visible: !0,
          type: "displace",
          displacementType: "noise",
          noiseType: 0,
          scale: 10,
          movement: 1,
          offset: [0, 0, 0],
          intensity: 8,
          voronoiStyle: 0,
          smoothness: .3,
          seed: 0,
          highCut: 1,
          lowCut: 0,
          quality: 1
        };
      case "pattern":
        return _objectSpread(_objectSpread({}, o), {}, {
          type: "pattern",
          style: 0,
          projection: 0,
          axis: "y",
          blending: 0,
          offset: [0, 0],
          colorA: _objectSpread(_objectSpread({}, Ni.fromHex(0)), {}, {
            a: 1
          }),
          colorB: _objectSpread(_objectSpread({}, Ni.fromHex(16777215)), {}, {
            a: 1
          }),
          frequency: [10, 10],
          size: .5,
          variation: 0,
          smoothness: .5,
          zigzag: 0,
          rotation: 0,
          vertical: [0, 1],
          horizontal: [0, 1],
          sides: 6
        });
    }
  }
})(Ir || (Ir = {}));
var Qr;
(function (u) {
  function n(c) {
    return !c.layers.some(function (h) {
      return h.data.type === "texture" && h.data.projection !== 0 || h.data.type === "depth" && !h.data.isWorldSpace || h.data.type === "noise" || h.data.type === "displace";
    });
  }
  u.isMergable = n;
  function t(c) {
    var d = "";
    return c.layers.forEach(function (h) {
      Object.entries(h.data).forEach(function (_ref5) {
        var _ref6 = _slicedToArray(_ref5, 2),
          f = _ref6[0],
          p = _ref6[1];
        d += "".concat(f).concat(p), Array.isArray(p) ? p.forEach(function (m) {
          return d += "".concat(m);
        }) : _typeof(p) == "object" ? Object.values(p).forEach(function (m) {
          typeof m == "number" ? d += "".concat(m.toFixed(4)) : d += "".concat(m);
        }) : d += "".concat(p);
      });
    }), d;
  }
  u.getHash = t;
  function e() {
    return {
      layers: new Re()
    };
  }
  u.defaultEmptyData = e;
  function r() {
    var c = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "layer1";
    var d = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "layer2";
    return s("phong", c, d);
  }
  u.defaultData = r;
  function i(c, d) {
    return _objectSpread(_objectSpread({}, c), {}, {
      name: d
    });
  }
  u.withName = i;
  function s(c) {
    var d = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "layer1";
    var h = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "layer2";
    var f = new Re();
    return f.push({
      fi: 0,
      data: Ir.defaultData("light", c),
      id: d
    }), f.push({
      fi: 1,
      data: Ir.defaultData("color"),
      id: h
    }), {
      layers: f
    };
  }
  u.defaultTwoLayerData = s;
  function o(c) {
    var d = Ir.defaultData("texture");
    c && Object.assign(d.texture, {
      image: c
    });
    var h = new Re();
    return h.push({
      fi: 0,
      data: d,
      id: "layer1"
    }), h.push({
      fi: 1,
      data: _objectSpread(_objectSpread({}, Ir.defaultData("transmission")), {}, {
        alpha: 1
      }),
      id: "layer2"
    }), h.push({
      fi: 2,
      data: _objectSpread(_objectSpread({}, Ir.defaultData("light", "lambert")), {}, {
        alpha: 0
      }),
      id: "layer3"
    }), {
      layers: h
    };
  }
  u.defaultUIObjectMaterial = o;
  function a(c) {
    var d = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "phong";
    var h = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "layer1";
    var f = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "layer2";
    var p = Ir.defaultData("texture");
    Object.assign(p.texture, {
      image: c
    });
    var m = new Re();
    return m.push({
      fi: 0,
      data: p,
      id: h
    }), m.push({
      fi: 1,
      data: Ir.defaultData("light", d),
      id: f
    }), {
      layers: m
    };
  }
  u.defaultTwoLayerTextureData = a;
  function l(c) {
    var d = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "phong";
    var h = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "layer1";
    var f = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "layer2";
    var p = Ir.defaultData("video");
    Object.assign(p.texture, {
      video: c
    });
    var m = new Re();
    return m.push({
      fi: 0,
      data: p,
      id: h
    }), m.push({
      fi: 1,
      data: Ir.defaultData("light", d),
      id: f
    }), {
      layers: m
    };
  }
  u.defaultTwoLayerVideoTextureData = l;
})(Qr || (Qr = {}));
var zd;
(function (t) {
  function n() {
    return {
      points: new Re(),
      roundness: 0,
      shapeHoles: [],
      isClosed: !1
    };
  }
  t.defaultData = n;
})(zd || (zd = {}));
var Vd;
(function (t) {
  function n() {
    return {
      points: new Re(),
      lastInsertionPlane: null,
      subdivisions: 12,
      isClosed: !1
    };
  }
  t.defaultData = n;
})(Vd || (Vd = {}));
var l1 = {
  type: "Ellipse",
  width: 50,
  height: 50,
  spikes: 16,
  angle: 360,
  innerRadius: 0
};
var zv;
(function (t) {
  function n(e, r) {
    var i = _objectSpread({}, e);
    return c1.forEach(function (s) {
      var _r$s;
      Object.assign(i, _defineProperty({}, s, (_r$s = r[s]) !== null && _r$s !== void 0 ? _r$s : e[s]));
    }), i;
  }
  t.merge = n;
})(zv || (zv = {}));
var Vv = {
    shape: l1,
    depth: 1,
    offset: 0,
    bevel: 50,
    bevelSides: 6,
    angle: 0,
    twist: 0,
    startScale: 1,
    endScale: 1,
    capType: "flat"
  },
  c1 = ["depth", "offset", "angle", "twist", "startScale", "endScale"];
var Wp;
(function (e) {
  function n(r) {
    return r === "PolygonGeometry" || r === "RectangleGeometry" || r === "StarGeometry" || r === "TriangleGeometry" || r === "EllipseGeometry" || r === "UIGeometry";
  }
  e.is2DParametricMesh = n;
  function t(r) {
    return r === "PolygonGeometry" || r === "PolygonGeometry" || r === "RectangleGeometry" || r === "StarGeometry" || r === "TriangleGeometry" || r === "EllipseGeometry" || r === "PathGeometry" || r === "VectorGeometry" || r === "ConeGeometry" || r === "CubeGeometry" || r === "CylinderGeometry" || r === "DodecahedronGeometry" || r === "HelixGeometry" || r === "IcosahedronGeometry" || r === "LatheGeometry" || r === "PyramidGeometry" || r === "SphereGeometry" || r === "PlaneGeometry" || r === "BackdropGeometry" || r === "TorusGeometry" || r === "TorusKnotGeometry" || r === "BooleanGeometry" || r === "TextGeometry";
  }
  e.isParametricMesh = t;
})(Wp || (Wp = {}));
var Uv;
(function (t) {
  function n(e, r) {
    var i = _objectSpread({}, e);
    return Object.assign(i, r), i.type === "PathGeometry" && "extrusion" in r && r.extrusion && (i.extrusion = _objectSpread({}, e.extrusion), Object.assign(i.extrusion, zv.merge(i.extrusion, r.extrusion))), i;
  }
  t.merge = n;
})(Uv || (Uv = {}));
var Sl;
(function (t) {
  function n(e) {
    if (e === "RectangleGeometry") return {
      width: 320,
      height: 320,
      type: e,
      cornerRadius: [0, 0, 0, 0],
      cornerType: 0,
      depth: 0,
      extrudeBevelSize: 0,
      extrudeBevelSegments: 1
    };
    if (e === "UIGeometry") return {
      type: e,
      frame: "",
      cornerRadius: [0, 0, 0, 0],
      cornerType: 0,
      width: 1,
      height: 1
    };
    if (e === "PathGeometry") return {
      type: e,
      width: 1,
      height: 1,
      depth: 1,
      path: Vd.defaultData(),
      extrusion: Vv
    };
    if (e === "VectorGeometry") return {
      width: 1,
      height: 1,
      type: e,
      subdivisions: 12,
      shape: zd.defaultData(),
      depth: 0,
      extrudeBevelSize: 0,
      extrudeBevelSegments: 1
    };
    if (e === "BooleanGeometry") return {
      type: e,
      operation: 2,
      width: 0,
      height: 0,
      depth: 0,
      phongAngle: 35
    };
    if (e === "TextGeometry") return {
      type: e,
      width: 100,
      height: 100,
      depth: 0,
      horizontalAlign: 1,
      verticalAlign: 1,
      fontSize: 16,
      lineHeight: 1.2,
      letterSpacing: 0,
      text: {
        textValue: ""
      },
      textTransform: 1,
      font: "Roboto_regular",
      extrudeBevelSize: 0,
      extrudeBevelSegments: 1
    };
    if (e === "SphereGeometry") return {
      type: "SphereGeometry",
      width: 100,
      height: 100,
      depth: 100,
      widthSegments: 64,
      heightSegments: 64,
      phiStart: 0,
      phiLength: 2 * Math.PI,
      thetaStart: 0,
      thetaLength: 180
    };
    throw new Error("not implemented");
  }
  t.defaultData = n;
})(Sl || (Sl = {}));
var u1 = ["width", "height", "depth"];
var Gv;
(function (t) {
  return t.defaultData = {
    enabled: !1,
    useBackgroundColor: !1,
    color: Ni.white,
    near: .1,
    far: 2e3
  };
})(Gv || (Gv = {}));
var Ud;
(function (e) {
  var n = {
    opacity: 1,
    blendFunction: 13,
    enabled: !1
  };
  e.defaultData = {
    enabled: !1,
    pixelation: _objectSpread(_objectSpread({}, n), {}, {
      blendFunction: 16,
      granularity: 15
    }),
    bloom: _objectSpread(_objectSpread({}, n), {}, {
      blendFunction: 16,
      intensity: 1,
      blurScale: 1,
      luminanceThreshold: .25,
      luminanceSmoothing: .025,
      kernelSize: 3
    }),
    chromaticAberration: _objectSpread(_objectSpread({}, n), {}, {
      offset: [2, 2]
    }),
    vignette: _objectSpread(_objectSpread({}, n), {}, {
      darkness: 1,
      offset: 0
    }),
    hueSaturation: _objectSpread(_objectSpread({}, n), {}, {
      hue: 3,
      saturation: 0
    }),
    brightnessContrast: _objectSpread(_objectSpread({}, n), {}, {
      brightness: .25,
      contrast: 0
    }),
    depthOfField: _objectSpread(_objectSpread({}, n), {}, {
      focalLength: 2,
      focusDistance: 2,
      bokehScale: 2
    }),
    noise: _objectSpread(_objectSpread({}, n), {}, {
      blendFunction: 16
    })
  };
})(Ud || (Ud = {}));
var d1;
(function (t) {
  return t.defaultData = {
    softShadowQuality: "low"
  };
})(d1 || (d1 = {}));
var h1;
(function (t) {
  return t.defaultData = {
    enabled: !0,
    color: {
      r: .8274509803921568,
      g: .8274509803921568,
      b: .8274509803921568
    },
    intensity: .75
  };
})(h1 || (h1 = {}));
var f1;
(function (t) {
  return t.defaultData = {
    occlusion: !1,
    aoFullRes: !1,
    radius: 256,
    bias: .5,
    aoColor: {
      r: .19607843137254902,
      g: .19607843137254902,
      b: .19607843137254902
    }
  };
})(f1 || (f1 = {}));
var wl;
(function (t) {
  return t.defaultData = {
    usePhysics: !1,
    gravity: -10
  };
})(wl || (wl = {}));
var p1;
(function (t) {
  return t.defaultData = {
    playCamera: us,
    gameControlObject: null
  };
})(p1 || (p1 = {}));
var jv;
(function (t) {
  return t.defaultData = {
    backgroundColor: pt.fromHexAndA(bD, 1),
    postprocessing: Ud.defaultData,
    fog: Gv.defaultData,
    globalPhysics: wl.defaultData,
    ambient: h1.defaultData,
    ao: f1.defaultData,
    shadow: d1.defaultData,
    publish: p1.defaultData
  };
})(jv || (jv = {}));
var Hv;
(function (t) {
  return t.defaultData = {
    colliderType: "box",
    size: [100, 100, 100],
    colliderHelperVisible: !0,
    forceType: "collider",
    forceRange: "global",
    forceIntensity: .5,
    forceDambing: .95
  };
})(Hv || (Hv = {}));
var TD;
(function (e) {
  function n(r) {
    return r === "Component" || r === "Instance";
  }
  e.isComponentRelated = n;
  function t(r) {
    return r === "Empty" || r === "Instance";
  }
  e.isEmptyOrComponent = t;
})(TD || (TD = {}));
var Gd;
(function (i) {
  i.identity = _objectSpread(_objectSpread({}, Rv.identity), {}, {
    hiddenMatrix: yl.identity
  });
  function t(s) {
    return {
      position: s.position,
      rotation: s.rotation,
      scale: s.scale,
      hiddenMatrix: s.hiddenMatrix
    };
  }
  i.fromObject = t;
  function e(s, o) {
    return {
      position: (o === null || o === void 0 ? void 0 : o.position) || s.position,
      rotation: (o === null || o === void 0 ? void 0 : o.rotation) || s.rotation,
      scale: (o === null || o === void 0 ? void 0 : o.scale) || s.scale,
      hiddenMatrix: (o === null || o === void 0 ? void 0 : o.hiddenMatrix) || s.hiddenMatrix
    };
  }
  i.merge = e;
  function r(s, o) {
    return rv({
      position: bo.isEqual(s.position, o.position) ? void 0 : o.position,
      rotation: bo.isEqual(s.rotation, o.rotation) ? void 0 : o.rotation,
      scale: bo.isEqual(s.scale, o.scale) ? null : o.scale,
      hiddenMatrix: yl.isEqual(s.hiddenMatrix, o.hiddenMatrix) ? void 0 : o.hiddenMatrix
    });
  }
  i.diff = r;
})(Gd || (Gd = {}));
var wi;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({
    states: new Re(),
    events: new Re(),
    visible: !0,
    raycastLock: !1,
    physics: bl.defaultData,
    pathSnapping: {
      pathId: null,
      slide: 0,
      offset: 0,
      orientation: "tangential"
    }
  }, Gd.identity), {}, {
    cloner: null
  });
})(wi || (wi = {}));
var Wv;
(function (t) {
  return t.defaultData = _objectSpread({
    type: "Empty"
  }, wi.defaultData);
})(Wv || (Wv = {}));
var MD;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({
    type: "ParticleCollider"
  }, Hv.defaultData), wi.defaultData);
})(MD || (MD = {}));
var CD;
(function (t) {
  return t.defaultData = _objectSpread({
    type: "Component"
  }, wi.defaultData);
})(CD || (CD = {}));
var PD;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({
    type: "Particle"
  }, wi.defaultData), Fd.defaultData);
})(PD || (PD = {}));
var Pc;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({
    type: "Mesh"
  }, wi.defaultData), Fv.defaultData);
})(Pc || (Pc = {}));
var Dc;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread(_objectSpread({}, wi.defaultData), Gd.identity), {}, {
    position: [0, 0, xl.DefaultTargetOffset]
  }, xl.defaultData);
})(Dc || (Dc = {}));
var qv;
(function (e) {
  function n(r) {
    return _objectSpread(_objectSpread({}, wi.defaultData), Nv.defaultData(r));
  }
  e.defaultData = n, e.defaultDirectionalLightData = _objectSpread(_objectSpread({}, e.defaultData("DirectionalLight")), {}, {
    position: [200, 300, 300],
    name: "Directional Light",
    intensity: .7
  });
})(qv || (qv = {}));
var jd;
(function (e) {
  function n(r, i) {
    var s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    for (; s < i.length;) {
      var o = r ? r[i[s]] : void 0;
      if (i.length === s + 1) return o;
      if (o) r = o.descendants, s += 1;else return;
    }
  }
  e.resolveWithDes = n;
  function t(r, i) {
    var s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var o = n(r, i, s);
    if (o) {
      var a = Object.keys(o);
      if (a.length === 1 && a[0] === "descendants") return;
    }
    return o;
  }
  e.resolve = t;
})(jd || (jd = {}));
var wo;
(function (s) {
  s.rootOverrideProps = ["physics", "events"], s.compositeNonOptionalOverrideProps = ["geometry"], s.compositeEntireOverrideOverrideProps = ["material"];
  function r(o, a) {
    return _objectSpread(_objectSpread(_objectSpread({}, wi.defaultData), a), {}, {
      component: o,
      overrides: new lr(),
      physics: void 0,
      events: void 0,
      type: "Instance"
    });
  }
  s.ofComponent = r;
  function i(o) {
    var a = Gd.fromObject(o.data);
    return r(o.id, a);
  }
  s.fromComponentData = i;
})(wo || (wo = {}));
var ma;
(function (e) {
  e.defaultData = _objectSpread(_objectSpread(_objectSpread({
    type: "Page"
  }, wi.defaultData), {}, {
    physics: _objectSpread(_objectSpread({}, bl.defaultData), {}, {
      fusedBody: !1
    })
  }, jv.defaultData), {}, {
    camera: Dc.defaultData
  });
  function t(r) {
    return r.uiScene !== void 0;
  }
  e.isUIPage = t;
})(ma || (ma = {}));
var Yv;
(function (s) {
  return s.defaultCamera = _objectSpread({
    position: [0, 0, 1e3],
    scale: [1, 1, 1],
    rotation: [0, 0, 0],
    hiddenMatrix: yl.identity,
    name: "Play Camera",
    visible: !0,
    raycastLock: !1,
    physics: bl.defaultData,
    states: new Re(),
    events: new Re(),
    cloner: null,
    pathSnapping: {
      pathId: null,
      orientation: "tangential",
      slide: 0,
      offset: 0
    }
  }, xl.defaultData), s.KeysByResetCategory = {
    States: ["states"],
    Events: ["events"],
    Material: ["material", "materials"],
    Geometry: ["geometry"],
    Position: ["position"],
    Rotation: ["rotation"],
    Scale: ["scale"],
    Transform: ["position", "scale", "rotation", "hiddenMatrix"],
    Name: ["name"],
    Visibility: ["visible", "raycastLock", "flatShading", "wireframe", "side"],
    Shadows: ["castShadow", "receiveShadow"],
    Cloner: ["cloner"],
    Physics: ["physics"]
  }, s.defaultMeshObject = _objectSpread(_objectSpread(_objectSpread({
    name: "Rectangle"
  }, wi.defaultData), Pc.defaultData), {}, {
    geometry: Sl.defaultData("RectangleGeometry"),
    material: Qr.defaultTwoLayerData("phong", "layer1", "layer2")
  }), s.defaultBooleanObject = _objectSpread(_objectSpread(_objectSpread({
    name: "Boolean"
  }, wi.defaultData), Pc.defaultData), {}, {
    geometry: Sl.defaultData("BooleanGeometry"),
    material: Qr.defaultTwoLayerData("phong", "layer1", "layer2")
  }), s.defaultTextObject = _objectSpread(_objectSpread(_objectSpread({
    name: "Text"
  }, wi.defaultData), Pc.defaultData), {}, {
    geometry: Sl.defaultData("TextGeometry"),
    material: Qr.defaultTwoLayerData("phong", "layer1", "layer2")
  });
})(Yv || (Yv = {}));
var ga;
(function (i) {
  function n(s, o) {
    var a = {
      name: o
    };
    return s.type === "Mesh" ? (a.geometry = {}, "material" in s && (a.material = {
      layers: new lr()
    }), "materials" in s && (a.materials = s.materials.map(function (l) {
      return {
        layers: new lr()
      };
    }))) : ks.is(s.type) && (a.perspective = {}, a.orthographic = {}), a;
  }
  i.newEmpty = n;
  function t(s, o) {
    if (o === void 0) return s;
    var a = _objectSpread({}, s);
    return "material" in a && "material" in o && o.material && (a.material = fl(a.material, function (l) {
      if (typeof l != "string") for (var _i27 = 0, _Object$entries4 = Object.entries(o.material.layers); _i27 < _Object$entries4.length; _i27++) {
        var _Object$entries4$_i = _slicedToArray(_Object$entries4[_i27], 2),
          u = _Object$entries4$_i[0],
          c = _Object$entries4$_i[1];
        var d = l.layers.data(u);
        d && Ir.patch(d, c);
      }
    }).data), a.materials && o.materials && (a.materials = fl(a.materials, function (l) {
      for (var u = 0; u < a.materials.length; u++) {
        var c = o.materials[u];
        if (typeof c != "string") for (var _i28 = 0, _Object$entries5 = Object.entries(c.layers); _i28 < _Object$entries5.length; _i28++) {
          var _l$u;
          var _Object$entries5$_i = _slicedToArray(_Object$entries5[_i28], 2),
            d = _Object$entries5$_i[0],
            h = _Object$entries5$_i[1];
          var f = (_l$u = l[u]) === null || _l$u === void 0 || (_l$u = _l$u.layers) === null || _l$u === void 0 ? void 0 : _l$u.data(d);
          f && Ir.patch(f, h);
        }
      }
    }).data), a;
  }
  function e(s, o) {
    var a,
      l = [],
      u = {
        orthographic: 0,
        perspective: 0,
        geometry: 0
      };
    function c(d, h) {
      for (var _i29 = 0, _Object$entries6 = Object.entries(h.layers); _i29 < _Object$entries6.length; _i29++) {
        var _Object$entries6$_i = _slicedToArray(_Object$entries6[_i29], 2),
          f = _Object$entries6$_i[0],
          p = _Object$entries6$_i[1];
        var m = p.texture,
          g = _objectWithoutProperties(p, _excluded2);
        if (m !== void 0 && Object.keys(m).length > 0) {
          var y = {
            path: [].concat(_toConsumableArray(d), ["layers", f, "texture"]),
            props: m,
            type: 0
          };
          l.push(y);
        }
        if (Object.keys(g).length > 0) {
          var _y17 = {
            path: [].concat(_toConsumableArray(d), ["layers", f]),
            props: g,
            type: 0
          };
          l.push(_y17);
        }
      }
    }
    for (var _i30 = 0, _Object$entries7 = Object.entries(o); _i30 < _Object$entries7.length; _i30++) {
      var _Object$entries7$_i = _slicedToArray(_Object$entries7[_i30], 2),
        d = _Object$entries7$_i[0],
        h = _Object$entries7$_i[1];
      if (d !== "name") if (d === "cloner") l.push.apply(l, _toConsumableArray(Lv.toOps(h, ["cloner"])));else if (d === "pathSnapping") l.push({
        path: [d],
        props: {
          slide: h.slide,
          offset: h.offset
        },
        type: 0
      });else if (d === "material") c(["material"], h);else if (d === "materials") for (var _i31 = 0, _Object$entries8 = Object.entries(h); _i31 < _Object$entries8.length; _i31++) {
        var _Object$entries8$_i = _slicedToArray(_Object$entries8[_i31], 2),
          f = _Object$entries8$_i[0],
          p = _Object$entries8$_i[1];
        c(["materials", f], p);
      } else if (u[d] === 0) {
        if (d === "geometry" && h.extrusion !== void 0) {
          var _f39 = {
            path: [d, "extrusion"],
            props: h.extrusion,
            type: 0
          };
          l.push(_f39), h = _objectSpread({}, h), delete h.extrusion;
        }
        if (Object.keys(h).length > 0) {
          var _f40 = {
            path: [d],
            props: h,
            type: 0
          };
          l.push(_f40);
        }
      } else a === void 0 && (a = {
        path: [],
        props: {},
        type: 0
      }, l.push(a)), a.props[d] = h;
    }
    return l;
  }
  i.toOps = e;
  function r(s, o) {
    var _ref7, _o$pathSnapping$slide, _o$pathSnapping, _a$pathSnapping, _ref8, _o$pathSnapping$offse, _o$pathSnapping2, _a$pathSnapping2;
    if (o === void 0) return s;
    var a = _objectSpread({}, s);
    if (Object.assign(a, Gd.merge(a, o)), Object.assign(a, {
      pathSnapping: Object.assign({}, a.pathSnapping, {
        slide: (_ref7 = (_o$pathSnapping$slide = (_o$pathSnapping = o.pathSnapping) === null || _o$pathSnapping === void 0 ? void 0 : _o$pathSnapping.slide) !== null && _o$pathSnapping$slide !== void 0 ? _o$pathSnapping$slide : (_a$pathSnapping = a.pathSnapping) === null || _a$pathSnapping === void 0 ? void 0 : _a$pathSnapping.slide) !== null && _ref7 !== void 0 ? _ref7 : 0,
        offset: (_ref8 = (_o$pathSnapping$offse = (_o$pathSnapping2 = o.pathSnapping) === null || _o$pathSnapping2 === void 0 ? void 0 : _o$pathSnapping2.offset) !== null && _o$pathSnapping$offse !== void 0 ? _o$pathSnapping$offse : (_a$pathSnapping2 = a.pathSnapping) === null || _a$pathSnapping2 === void 0 ? void 0 : _a$pathSnapping2.offset) !== null && _ref8 !== void 0 ? _ref8 : 0
      })
    }), ks.is(s.type)) {
      var _l$orthographic, _l$perspective;
      a.orthographic = _objectSpread({}, a.orthographic), a.perspective = _objectSpread({}, a.perspective);
      var l = o;
      ((_l$orthographic = l.orthographic) === null || _l$orthographic === void 0 ? void 0 : _l$orthographic.zoom) !== void 0 && (a.orthographic.zoom = l.orthographic.zoom), ((_l$perspective = l.perspective) === null || _l$perspective === void 0 ? void 0 : _l$perspective.zoom) !== void 0 && (a.perspective.zoom = l.perspective.zoom), l.isUpVectorFlipped !== void 0 && (a.isUpVectorFlipped = l.isUpVectorFlipped), l.targetOffset !== void 0 && (a.targetOffset = l.targetOffset);
    } else if (s.type === "Mesh") "geometry" in o && Object.assign(a, {
      geometry: Uv.merge(a.geometry, o.geometry)
    }), (o.material || o.materials) && (a = t(a, o)), a.cloner && "cloner" in o && Object.assign(a, {
      cloner: So.merge(a.cloner, o.cloner)
    });else if (s.type === "Empty") a.cloner && "cloner" in o && Object.assign(a, {
      cloner: So.merge(a.cloner, o.cloner)
    });else if (Bv.is(s.type)) {
      var _l49 = o;
      _l49.intensity !== void 0 && (a.intensity = _l49.intensity), _l49.color !== void 0 && (typeof _l49.color == "string" ? a.color = _l49.color : a.color = Ni.clone(_l49.color));
    }
    return a;
  }
  i.patch = r;
})(ga || (ga = {}));
var Hd;
(function (t) {
  return t.defaultData = {
    enablePan: !0,
    enableZoom: !0,
    enableRotate: !0,
    enableDamping: !0,
    rotationLimitsMode: 0,
    rotationVerticalOffset: {
      min: Math.PI / 4,
      max: Math.PI / 4
    },
    rotationHorizontalOffset: {
      min: Math.PI / 4,
      max: Math.PI / 4
    },
    rotationSoftLimit: 2,
    panLimitsMode: 0,
    panVerticalOffset: {
      min: 250,
      max: 250
    },
    panHorizontalOffset: {
      min: 250,
      max: 250
    },
    panSoftLimit: 2,
    zoomLimitsEnabled: !1,
    zoomLimits: {
      min: .1,
      max: 2
    },
    autoRotate: !1,
    autoRotateSpeed: 2,
    autoRotateClockwise: !0,
    hoverRotatePanMode: 0,
    hoverRotatePanStrength: 20,
    hoverRotateDamping: .125,
    isTouchZoom: !0,
    orbitTouches: 2,
    panTouches: 3,
    resetHoverEffectOnPointerLeave: !0
  };
})(Hd || (Hd = {}));
var zs;
(function (t) {
  return t.defaultData = {
    orbitControls: Hd.defaultData,
    playPage: vl,
    withBackground: !0,
    preventScroll: !1,
    preventTouchScroll: !1,
    hideCursor: !1,
    mouseEventTarget: "canvas",
    joystickSizeAndXYOffset: Array(12).fill(0).map(function (e, r) {
      var i = 0,
        s = 0;
      return r < 5 ? s = -30 : r < 10 && (s = 30), r === 0 || r === 10 || r === 5 ? i = 30 : (r === 4 || r === 11 || r === 9) && (i = -30), [120, [i, s], "show"];
    }),
    settings: {
      image: {
        format: "jpg",
        ratio: 1
      },
      video: {
        format: "mp4",
        imageFormat: "jpg",
        fps: 30,
        mbps: 80,
        ratio: Math.max(1, (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" ? Math.floor(window.devicePixelRatio) : 1),
        stopMode: "manual",
        duration: 5e3
      },
      web: {
        logo: !0,
        compress: !0,
        preset: 1,
        preload: !0,
        hint: !1
      }
    },
    stopRaycast: !0,
    hdTransmission: !1
  };
})(zs || (zs = {}));
var m1;
(function (t) {
  return t.defaultData = {
    id: "basic",
    label: "Basic",
    style: "None",
    prompt: ""
  };
})(m1 || (m1 = {}));
var g1;
(function (t) {
  return t.defaultData = {
    weather: 0,
    shadows: 0,
    lightOrigin: 0,
    temperature: 0,
    sun: 0,
    camera: 0,
    environment: 0,
    particles: 0,
    nature: 0,
    floor: 0
  };
})(g1 || (g1 = {}));
var ya;
(function (e) {
  return e.defaultData = function () {
    return {
      mode: "line-art-both",
      prompt: "",
      negativePrompt: "",
      style: _objectSpread({}, m1.defaultData),
      isRandomSeed: !0,
      seed: e.generateSeed(),
      guessMode: !1,
      advanced: !1,
      steps: 20,
      guidanceScale: 7.5,
      controlNetScale: 1,
      modifiers: g1.defaultData
    };
  }, e.generateSeed = function () {
    return Math.round(Math.random() * 1e5);
  };
})(ya || (ya = {}));
var Al;
(function (e) {
  function n(r) {
    return r.find(function (i) {
      return i.data.type === "Page" && i.data.globalPhysics.usePhysics;
    }) !== void 0;
  }
  e.physicsEnabled = n;
  function t(r, i, s) {
    r.scene.objects.traverseFrom(i, function (o, a) {
      if (a.type === "Instance") {
        var _Wd$getComponentData;
        var l = (_Wd$getComponentData = Wd.getComponentData(r, a.component)) === null || _Wd$getComponentData === void 0 ? void 0 : _Wd$getComponentData.data;
        l && s(o, a, l.events);
      } else s(o, a, a.events);
    });
  }
  e.traverseModuleInstances = t;
})(Al || (Al = {}));
var va;
(function (l) {
  l.TRASH_CAN_ID = "830a2708-8ed9-49cf-a68e-085299892222";
  function t() {
    var u = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
      withLight: !0,
      withSquare: !0
    };
    var c = [],
      d = Yv.defaultMeshObject;
    u.withLight === !0 && c.push({
      fi: -1,
      data: qv.defaultDirectionalLightData,
      id: "830a2708-8ed9-49cf-a68e-085299899103",
      children: []
    }), u.withSquare === !0 && c.push({
      fi: 1,
      id: "7ba78968-2a55-48f2-b14c-5191da3e075e",
      data: d,
      children: []
    });
    var h = new ar();
    return h.push({
      fi: 1,
      id: vl,
      data: _objectSpread(_objectSpread({}, ma.defaultData), {}, {
        name: "Scene 1"
      }),
      children: c
    }), h;
  }
  l.defaultData = {
    objects: t(),
    publish: zs.defaultData,
    styles: ya.defaultData()
  }, l.emptyDataWithoutPage = function () {
    return {
      objects: new ar(),
      publish: zs.defaultData,
      styles: ya.defaultData()
    };
  }, l.emptyDataWithPage = function (u) {
    return {
      objects: t(u),
      publish: zs.defaultData,
      styles: ya.defaultData()
    };
  }, l.emptyData = function () {
    return {
      objects: new ar(),
      publish: _objectSpread({}, zs.defaultData),
      styles: ya.defaultData()
    };
  };
  function o(u) {
    return _objectSpread(_objectSpread({}, l.defaultData), {}, {
      objects: pn(u, ar.prototype)
    });
  }
  l.withObjs = o;
  function a(u, c) {
    return o([{
      id: u,
      data: c,
      children: [],
      fi: 0
    }]);
  }
  l.withObj = a;
})(va || (va = {}));
var qd;
(function (t) {
  return t.defaultData = {
    preset: "fullscreen",
    allowResponsive: !1,
    size: [512, 512],
    coords: [0, 0],
    sceneScale: 1,
    color: {
      r: 0,
      g: 0,
      b: 0,
      a: .5
    }
  };
})(qd || (qd = {}));
var Yd;
(function (t) {
  return t.emptyImage = {
    data: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",
    name: "empty"
  };
})(Yd || (Yd = {}));
var Fi;
(function (s) {
  function n(o) {
    return o.textValue !== void 0;
  }
  s.isTextValue = n;
  function t(o) {
    return typeof o == "number";
  }
  s.isNumber = t;
  function e(o) {
    return typeof o == "boolean";
  }
  s.isBoolean = e;
  function r(o) {
    return n(o) ? "string" : e(o) ? "boolean" : "number";
  }
  s.typeOfVariable = r;
  function i(o) {
    var _o$deliminator;
    return s.isTextValue(o) ? Array.isArray(o.textValue) ? o.textValue.map(function (a) {
      var _o$padding;
      return a.toString().padStart((_o$padding = o.padding) !== null && _o$padding !== void 0 ? _o$padding : 2, "0");
    }).join((_o$deliminator = o.deliminator) !== null && _o$deliminator !== void 0 ? _o$deliminator : ":") + (o.suffix !== void 0 ? " " + o.suffix : "") : o.textValue.toString() : s.isBoolean(o) ? o ? "True" : "False" : s.isNumber(o) ? parseFloat(o.toFixed(3)).toString() : o.toString();
  }
  s.getDisplayedValue = i;
})(Fi || (Fi = {}));
var y1;
(function (t) {
  return t.all = ["images", "videos", "colors", "audios", "particles", "fonts", "materials", "variables"];
})(y1 || (y1 = {}));
var DD;
(function (t) {
  return t.all = [].concat(_toConsumableArray(y1.all), ["components"]);
})(DD || (DD = {}));
var OD;
(function (t) {
  function n() {
    return {
      images: new Ke(),
      videos: new Ke(),
      colors: new Ke(),
      audios: new Ke(),
      particles: new Ke(),
      fonts: new Ke(),
      materials: new Ke(),
      components: new Ke(),
      variables: new Ke()
    };
  }
  t.defaultData = n;
})(OD || (OD = {}));
var xa;
(function (t) {
  function n() {
    return {
      images: new Ke(),
      videos: new Ke(),
      colors: new Ke(),
      audios: new Ke(),
      particles: new Ke(),
      fonts: new Ke(),
      materials: new Ke(),
      components: new Ke(),
      variables: new Ke()
    };
  }
  t.defaultData = n;
})(xa || (xa = {}));
var yn;
(function (s) {
  function n() {
    var o = {};
    return o["89b10010-844c-11ec-a8a3-0242ac120002"] = {
      r: .5,
      g: .5,
      b: .5,
      a: 1,
      name: "Default Color"
    }, pn(o, Ke.prototype);
  }
  s.defaultColors = n;
  function t(o) {
    var a = {};
    return o !== null && o !== void 0 && o.withAITexture && (a["a1b10010-844c-a8a3-11ec-0242ac2011ec"] = _objectSpread(_objectSpread({}, Yd.emptyImage), {}, {
      name: "AI generated image"
    })), pn(a, Ke.prototype);
  }
  s.defaultImages = t;
  function e() {
    return {
      catelogs: new Ke(),
      materials: new Ke(),
      images: new Ke(),
      videos: new Ke(),
      colors: new Ke(),
      audios: new Ke(),
      particles: new Ke(),
      fonts: new Ke(),
      variables: new Re(),
      lib: xa.defaultData()
    };
  }
  s.emptyData = e;
  function r(o) {
    switch (o) {
      case "number":
        return {
          value: 0,
          name: "Number"
        };
      case "boolean":
        return {
          value: !1,
          name: "Boolean"
        };
      case "string":
        return {
          value: {
            textValue: "String value"
          },
          name: "String"
        };
      case "time":
        var a = [0, 0, 0];
        return {
          name: "Time",
          value: {
            textValue: a,
            deliminator: ":",
            padding: 2,
            suffix: "AM"
          },
          dynamicVariableType: "time",
          format: "HH:mm:ss",
          format12h24h: "12ampm",
          timeZone: null,
          hasEnd: !1,
          endValue: {
            textValue: a,
            deliminator: ":",
            padding: 2,
            suffix: "AM"
          },
          autoStart: !0,
          repeat: !1
        };
      case "counter":
        return {
          name: "Counter",
          value: 0,
          dynamicVariableType: "counter",
          updateInterval: 1e3,
          increment: 1,
          autoStart: !0,
          hasEnd: !0,
          endValue: 60,
          repeat: !0,
          randomStart: !1,
          range: [0, 100],
          decimals: 0
        };
      case "random":
        return {
          name: "Random",
          value: 0,
          dynamicVariableType: "random",
          updateInterval: 1e3,
          increment: 1,
          autoStart: !0,
          isStatic: !1,
          hasEnd: !0,
          endValue: 60,
          repeat: !0,
          min: 0,
          max: 100,
          decimals: 0
        };
      default:
        console.error("Unknown variable type", o);
    }
  }
  s.defaultVariables = r;
  function i(o, a) {
    if (a.format === "HH:mm:ss") {
      var l = Math.floor(o / 3600),
        u = Math.floor((o - l * 3600) / 60),
        c = Math.round(o - l * 3600 - u * 60);
      return {
        textValue: [l, u, c]
      };
    } else if (a.format === "mm:ss") {
      var _l50 = Math.floor(o / 60),
        _u21 = Math.round(o - _l50 * 60);
      return {
        textValue: [_l50, _u21]
      };
    } else return a.format === "number" ? o = Math.round(o) : o = Math.round(o * 1e3) / 1e3, o;
  }
  s.getFormattedTimerTime = i;
})(yn || (yn = {}));
var Xd;
(function (t) {
  return t.list = ["idle", "move", "jump", "run"];
})(Xd || (Xd = {}));
var Qd;
(function (e) {
  return e.defaultColliderData = {
    type: "capsule",
    height: 200,
    radius: 50,
    position: [0, 0, 0],
    rotation: [0, 0, 0]
  }, e.defaultDataThirdPerson = {
    moveMode: "walk",
    forwardDirection: "+z",
    speedTranslate: 1e3,
    speedRotate: 100,
    runMultiplier: 2,
    rotationMode: "normal",
    rotBy: "keys",
    rotByTouch: "drag",
    delayPos: [.3, .3],
    delayRot: [.3, .3],
    keyAssignments: [["moveNegZ", "W"], ["moveNegX", "A"], ["movePosZ", "S"], ["movePosX", "D"], ["rotPosX", "\u25B2"], ["rotPosY", "\u25C0"], ["rotNegX", "\u25BC"], ["rotNegY", "\u25B6"], ["jump", "Space"], ["run", "\u21E7"], ["none", "Ctrl"]],
    touchControl: !0,
    joystickPosLoc: 5,
    joystickRotLoc: 11,
    jumpTouchButtonLoc: 9,
    collider: e.defaultColliderData,
    colliderHelperVisible: !0,
    collisionEnabled: !0,
    jumpPower: 100,
    resetYPosition: 3e3,
    alignToGround: !1,
    autoOrientMove: !0,
    orientWith: "camera",
    orientMode: "radial",
    delayPosCamera: .3,
    delayRotCamera: .3,
    camera: "",
    cameraXAxis: "Limit",
    cameraYAxis: "Free",
    cameraRotXLimits: [0, Math.PI / 2],
    cameraRotYLimits: [-Math.PI / 2, Math.PI / 2],
    gameActions: {
      idle: new Re(),
      move: new Re(),
      jump: new Re(),
      run: new Re()
    },
    navmesh: {
      enabled: !1,
      ch: 6,
      cs: 6,
      walkableClimb: 5,
      walkableHeight: 1,
      walkableRadius: 0,
      zones: "all",
      objects: [],
      helperVisible: !0,
      destinationHelperRadius: 0,
      destinationHelperColor: pt.fromHexAndA(3728051, 1)
    }
  };
})(Qd || (Qd = {}));
function ID(n) {
  n.layers.forEach(function (t) {
    if (t.type === "depth" && t.colorA !== void 0) {
      var e = t.colorA,
        r = t.colorB,
        i = [[e.r, e.g, e.b, e.a], [r.r, r.g, r.b, r.a]],
        s = [0, 1];
      for (var a = 2; a < 10; a++) i.push(i[1]), s.push(1);
      var o = _objectSpread(_objectSpread({}, Qn(Cr(t), "type", "visible", "isVector", "isWorldSpace", "origin", "alpha", "mode")), {}, {
        near: Math.max(0, t.near),
        far: Math.max(0, t.far),
        colors: i,
        steps: s,
        num: 2,
        direction: [1, 0, 0],
        smooth: !1,
        gradientType: 1
      });
      Object.assign(t, o);
    } else if (t.type === "depth" && t.gradientType === 1 && (t.near < 0 || t.far < 0)) {
      var _e42 = _objectSpread(_objectSpread({}, Cr(t)), {}, {
        near: Math.max(t.near, 0),
        far: Math.max(t.far, 0)
      });
      Object.assign(t, _e42);
    }
  });
}
function ba(n, t) {
  Object.values(n.shared.materials).forEach(function (e) {
    return t(e);
  });
}
function Sa(n, t) {
  n.scene.objects.traverse(function (e, r) {
    "materials" in r ? r.materials.forEach(function (i, s) {
      i === void 0 && (r.materials[s] = Qr.defaultData(), i = r.materials[s]), typeof i != "string" && t(i);
    }) : "material" in r ? typeof r.material != "string" && (r.material === void 0 && (r.material = Qr.defaultData()), t(r.material)) : r.type === "Mesh" && (r.material === void 0 && (r.material = Qr.defaultData()), t(r.material)), "overrides" in r && Object.values(r.overrides).forEach(function (i) {
      i.material && typeof i.material != "string" && Object.getPrototypeOf(i.material) !== lr.prototype && t(i.material);
    });
  });
}
function gq(n) {
  Object.assign(n.scene.publish, {
    orbitControls: _objectSpread(_objectSpread({}, Hd.defaultData), Cr(n.scene.publish.orbitControls))
  });
}
function yq(n) {
  Object.assign(n.scene.publish.settings, {
    video: _objectSpread(_objectSpread({}, zs.defaultData.settings.video), Cr(n.scene.publish.settings.video))
  });
}
function vq(n) {
  function t(e) {
    if (e.layers) {
      for (var _i32 = 0, _Object$values = Object.values(e.layers); _i32 < _Object$values.length; _i32++) {
        var r = _Object$values[_i32];
        if (r) {
          for (var _i33 = 0, _Object$entries9 = Object.entries(r); _i33 < _Object$entries9.length; _i33++) {
            var _Object$entries9$_i = _slicedToArray(_Object$entries9[_i33], 2),
              i = _Object$entries9$_i[0],
              s = _Object$entries9$_i[1];
            if ((kv.includes(i) || typeof s == "boolean") && delete r[i], i === "texture") for (var _i34 = 0, _Object$entries10 = Object.entries(s); _i34 < _Object$entries10.length; _i34++) {
              var _Object$entries10$_i = _slicedToArray(_Object$entries10[_i34], 2),
                o = _Object$entries10$_i[0],
                a = _Object$entries10$_i[1];
              (ED.includes(o) || typeof a == "boolean") && delete s[o];
            }
          }
        }
      }
    }
  }
  n.scene.objects.traverse(function (e, r) {
    r.states.forEach(function (i) {
      var s = i;
      s.material ? t(s.material) : s.materials && s.materials.forEach(function (o) {
        t(o);
      });
    });
  });
}
function xq(n) {
  n.scene.publish.withBackground = !0;
}
function bq(n) {
  n.scene.publish.settings.web = {
    compress: !0,
    preload: !0,
    preset: 1,
    logo: !0,
    hint: !1
  };
}
function Sq(n) {
  n.scene.objects.traverse(function (t, e) {
    var r = e.cloner;
    r && (r.radial.scale = r.radial.scale.map(function (i) {
      return i + 1;
    }), r.linear.scale = r.linear.scale.map(function (i) {
      return i + 1;
    }));
  });
}
function wq(n) {
  n.scene.objects.traverse(function (t, e) {
    var r = e.geometry;
    r && (r.type === "DodecahedronGeometry" || r.type === "IcosahedronGeometry") && (r.detail = Math.round(r.detail));
  });
}
function Aq(n) {
  n.scene.objects.traverse(function (t, e) {
    var r = n.scene.objects.unproxy().parent(t);
    if (r) {
      var i = Cr(n.scene.objects.data(r));
      i && i.type === "Mesh" && i.geometry.type === "BooleanGeometry" && e.type === "Mesh" && (e.visible = Cr(e).booleanExclude !== !0);
    }
  });
}
function _q(n) {
  n.scene.objects.traverse(function (t, e) {
    if (e.type === "Mesh") {
      var r = e;
      e.geometry.type === "NonParametricGeometry" ? r.material !== void 0 && delete r.material : r.materials !== void 0 && delete r.materials;
    }
  });
}
function Eq(n) {
  function t(r) {
    Object.setPrototypeOf(r, lr.prototype), r.texture && Object.setPrototypeOf(r.texture, lr.prototype);
  }
  function e(r) {
    Object.setPrototypeOf(r, lr.prototype);
    for (var i in r) t(r[i]);
  }
  n.scene.objects.traverse(function (r, i) {
    i.states.forEach(function (s) {
      var o = s;
      if (o.material) {
        var a = Cr(o.material).layers;
        e(a), o.material.layers = a;
      }
      if (o.materials) for (var _a22 = 0; _a22 < o.materials.length; _a22++) {
        var l = o.materials[_a22],
          u = Cr(l).layers;
        e(u), l.layers = u;
      }
    });
  });
}
function RD(n) {
  n.layers === void 0 && Object.assign(n, Qr.defaultTwoLayerData("lambert"));
}
function v1(n) {
  !n.layers || n.layers.forEach(function (t) {
    if (t.type === "depth" && t.colors.length === 10) {
      var e = _toConsumableArray(t.colors);
      e.push(t.colors[9]);
      var r = _toConsumableArray(t.steps);
      r.push(t.steps[9]);
      var i = _objectSpread(_objectSpread({}, Cr(t)), {}, {
        colors: e,
        steps: r
      });
      Object.assign(t, i);
    }
  });
}
function Tq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.type === "Mesh" && (e.geometry.type === "BooleanGeometry" || e.geometry.type === "SubdivGeometry") && (e.geometry.phongAngle = 35);
  });
}
function LD(n) {
  n.scene.objects.traverse(function (t, e) {
    "materials" in e ? e.materials.forEach(function (r) {
      typeof r != "string" && v1(r);
    }) : "material" in e && typeof e.material != "string" && v1(e.material);
  }), Object.values(n.shared.materials).forEach(function (t) {
    return v1(t);
  });
}
function Mq(n) {
  n.scene.environment.ambientLight.softShadows = !1, n.scene.environment.ambientLight.softShadowQuality = "low", n.scene.objects.traverse(function (t, e) {
    (e.type === "DirectionalLight" || e.type === "SpotLight") && (e.shadowResolution = 1024, e.shadowRadius = 1, e.depth = 1e5);
  }), n.shared.penumbraSize = new Array(5).fill(.5);
}
function Cq(n) {
  n.shared.audios = pn({}, Ke.prototype);
}
function Pq(n) {
  n.shared.videos = pn({}, Ke.prototype);
}
function Dq(n) {
  var t = n.shared.materials;
  Object.entries(t).forEach(function (_ref9) {
    var _ref10 = _slicedToArray(_ref9, 2),
      e = _ref10[0],
      r = _ref10[1];
    if (!r.layers) {
      var i = {
        name: "Untitled Material",
        layers: [{
          fi: 0,
          data: {
            type: "light",
            category: "phong",
            alpha: .6,
            visible: !0,
            mode: 0,
            specular: {
              r: .2,
              g: .2,
              b: .2
            },
            shininess: 5
          },
          id: "layer1"
        }, {
          fi: 1,
          data: {
            type: "color",
            alpha: 1,
            visible: !0,
            mode: 0,
            color: {
              r: .2823529411764706,
              g: .2823529411764706,
              b: .30196078431372547
            }
          },
          id: "layer2"
        }]
      };
      Object.assign(t, _defineProperty({}, e, i));
    }
  });
}
function Oq(n) {
  Object.entries(Cr(n.shared.images)).filter(function (r) {
    return r[1].asset === !1;
  }).map(function (r) {
    return r[0];
  }).forEach(function (r) {
    delete n.shared.images[r];
  }), Object.entries(Cr(n.shared.audios)).filter(function (r) {
    return r[1].asset === !1;
  }).map(function (r) {
    return r[0];
  }).forEach(function (r) {
    delete n.shared.audios[r];
  });
}
function Iq(n) {
  n.scene.publish.settings.web.preload = !1;
}
function BD(n) {
  n.layers && n.layers.forEach(function (t) {
    t.type === "depth" && t.num !== void 0 && (t.colors = t.colors.slice(0, t.num), t.steps = t.steps.slice(0, t.num), delete t.num);
  });
}
function ND(n) {
  n.layers && n.layers.forEach(function (t) {
    _D(t) && t.isMask === void 0 && (t.isMask = !1), (t.type === "texture" || t.type === "video") && t.blending === void 0 && (t.blending = 0), (t.type === "noise" || t.type === "displace" && t.displacementType === "noise") && (t.voronoiStyle === void 0 && (t.voronoiStyle = 0), t.highCut === void 0 && (t.highCut = 1), t.lowCut === void 0 && (t.lowCut = 0), t.smoothness === void 0 && (t.smoothness = .3), t.seed === void 0 && (t.seed = 0), t.quality === void 0 && (t.quality = 1));
  });
}
function Rq(n) {
  n.shared.fonts = pn({}, Ke.prototype);
}
function Lq(n) {
  return n.replace(".typeface", "").replace(/optimer/gi, "open sans").replace("space_mono", "space mono").replace(/alma_mono/gi, "varela round").replace(/droid_sans_mono/gi, "noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi, "roboto").replace(/droid_serif/gi, "roboto slab").replace("_sans", " sans").replace("crimson_text", "crimson text").replace("medium_medium", "medium").replace("fatface_fatface", "fatface").replace("100hairline", "thin").replace("200thin", "extralight").replace("300light", "light").replace("500medium", "medium").replace("600semi", "semibold").replace("800heavy", "extrabold").replace("900black", "black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi, "bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi, "bodoni moda").replace(/(thin|hairline)(_regular)?/gi, "100").replace(/(extra|ultra)light(_regular)?/gi, "200").replace(/light(_regular)?/gi, "300").replace(/_book|_normal|_roman/gi, "_regular").replace(/medium(_regular)?/gi, "500").replace(/(semi|demi)bold(_regular)?/gi, "600").replace(/(extra|ultra)bold(_regular)?/gi, "800").replace(/bold(_regular)?/gi, "700").replace(/(black|heavy|fatface)(_regular)?/gi, "900").replace(/([1-9]00)_italic/gi, "$1italic").replace(/regularitalic/gi, "italic").replace(/regularitalic/gi, "italic").split(" ").map(function (e) {
    return e.charAt(0).toUpperCase() + e.slice(1);
  }).join(" ");
}
function Bq(n) {
  var t = [];
  n.scene.objects.traverse(function (e, r) {
    var i = r;
    if (i.type === "TextFrame") {
      var s = Qr.defaultTwoLayerData("phong"),
        o = typeof i.color == "string" ? n.shared.colors[i.color] : i.color;
      s.layers[1].data.color = {
        r: o.r,
        g: o.g,
        b: o.b
      }, s.layers[1].data.alpha = i.alpha;
      var a = Lq(i.font);
      n.shared.fonts[a] === void 0 && (n.shared.fonts[a] = {
        name: a
      });
      var l = _objectSpread(_objectSpread(_objectSpread({
          name: i.name
        }, wi.defaultData), Pc.defaultData), {}, {
          flatShading: !1,
          wireframe: !1,
          geometry: _objectSpread(_objectSpread({}, Sl.defaultData("TextGeometry")), {}, {
            width: i.width,
            height: i.height,
            font: a,
            depth: 0,
            horizontalAlign: i.horizontalAlign,
            verticalAlign: i.verticalAlign,
            fontSize: i.fontSize * 1.40625,
            lineHeight: i.lineHeight / 1.40625,
            letterSpacing: i.letterSpacing - 1,
            text: i.text,
            textTransform: i.textTransform,
            extrudeBevelSize: 0,
            extrudeBevelSegments: 1
          }),
          material: s,
          states: Cr(i.states),
          events: Cr(i.events),
          visible: i.visible,
          raycastLock: i.raycastLock,
          position: i.position,
          rotation: i.rotation,
          scale: i.scale,
          hiddenMatrix: i.hiddenMatrix
        }),
        u = Cr(n.scene.objects).parent(e);
      n.scene.objects.insertAfter(u !== null && u !== void 0 ? u : null, e, [{
        id: e + "new",
        data: l,
        children: []
      }]), t.push(e);
    }
  }), t.forEach(function (e) {
    n.scene.objects.delete(e);
  });
}
function Nq(n) {
  var t = {
    0: "MouseDown",
    1: "MouseUp",
    2: "MouseHover",
    5: "KeyDown",
    6: "KeyUp",
    7: "Start",
    9: "LookAt",
    10: "Follow",
    11: "Scroll",
    12: "Audio",
    13: "GameControl"
  };
  n.scene.objects.traverse(function (e, r) {
    r.events.forEach(function (i) {
      if (!!t[Number(i.type)]) if (Object.assign(i, {
        type: t[Number(i.type)]
      }), i.type === "Audio" && "audioEvent" in i && (Object.assign(i, {
        playAudio: i.audioEvent
      }), delete i.audioEvent), i.type === "GameControl") Object.assign(i, {
        gameActions: {
          idle: new Re(),
          move: new Re(),
          jump: new Re()
        }
      });else {
        var s = new Re();
        Object.assign(i, {
          actions: s
        }), (i.type === "MouseDown" || i.type === "MouseUp" || i.type === "KeyDown" || i.type === "KeyUp") && "url" in i && s.push({
          fi: 0,
          id: Se.generateUUID(),
          data: {
            type: "Link",
            url: i.url,
            delay: 0
          }
        }), "targets" in i && (i.targets.forEach(function (o, a, l) {
          var u = {
              state: void 0,
              repeat: 0,
              delay: 0,
              delayDirection: void 0,
              direction: "normal",
              duration: 0,
              easing: 4
            },
            c = {
              easing: o.easing,
              duration: o.duration
            };
          o.easing === 6 ? Object.assign(c, Qn(o, "mass", "stiffness", "damping", "velocity")) : o.easing === 5 && Object.assign(c, {
            control1: _objectSpread({}, o.control1),
            control2: _objectSpread({}, o.control2)
          });
          var d = {
              repeat: o.repeat ? -1 : 0,
              delay: o.delay,
              delayDirection: o.delayDirection,
              direction: o.cycle && o.rewind ? "pingpong-rewind" : o.cycle ? "pingpong" : "normal"
            },
            h = _objectSpread(_objectSpread({
              state: o.state
            }, d), c),
            f = {
              allowSlerp: !0,
              type: "Transition",
              object: o.object,
              repeat: 0,
              delay: 0,
              delayDirection: void 0,
              direction: "normal",
              tweens: new Re({
                fi: 0,
                id: Se.generateUUID(),
                data: u
              }, {
                fi: 1,
                id: Se.generateUUID(),
                data: h
              })
            };
          s.push({
            fi: l,
            id: a,
            data: f
          });
        }), delete i.targets);
      }
    });
  });
}
function Fq(n) {
  n.scene.objects.traverse(function (t, e) {
    function r(i, s) {
      var o = new Re(),
        a = [];
      if (e.events.forEach(function (l, u, c) {
        if (l.type === "Audio" && l.trigger === s) {
          var d;
          a.push(u), l.interaction === "play" ? d = _objectSpread(_objectSpread({}, Qn(l, "interaction", "audio", "delay", "volume", "loop")), {}, {
            triggerAfter: "after" in l ? l.after : void 0,
            toggle: "after" in l ? l.toggle : void 0,
            type: "Audio"
          }) : (l.interaction === "pause" || l.interaction === "stop") && (d = _objectSpread(_objectSpread({}, Qn(l, "interaction", "delay", "object", "playAudio")), {}, {
            type: "Audio"
          })), d && o.push({
            fi: c,
            id: u,
            data: d
          });
        }
      }), a.forEach(function (l) {
        return e.events.delete(l);
      }), o.length) {
        var _e$events$find;
        var l = (_e$events$find = e.events.find(function (u) {
          return u.type === i;
        })) === null || _e$events$find === void 0 ? void 0 : _e$events$find.data;
        l ? "actions" in l && l.actions.insertBefore(null, o) : e.events.insertBefore(null, [{
          id: Se.generateUUID(),
          data: {
            type: i,
            actions: o
          }
        }]);
      }
    }
    r("Start", "start"), r("MouseDown", "mouseDown"), r("MouseUp", "mouseUp"), r("KeyDown", "keyDown"), r("KeyUp", "keyUp");
  });
}
function FD(n) {
  var _n$layers$find;
  var t = (_n$layers$find = n.layers.find(function (e) {
    return e.type === "light";
  })) === null || _n$layers$find === void 0 ? void 0 : _n$layers$find.data;
  if ((t === null || t === void 0 ? void 0 : t.category) === "basic") {
    var e = Ir.defaultData("light", "phong"),
      r = t;
    Object.assign(r, e), r.visible = !1;
  }
}
function kD(n) {
  ba(n, FD), Sa(n, FD);
}
function kq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.type === "Mesh" && e.geometry.type === "SubdivGeometry" && (e.geometry.scaleBaked || (e.geometry.scaleBaked = [1, 1, 1]));
  });
}
function zq(n) {
  n.scene.objects.traverse(function (t, e) {
    (e.type === "Empty" || e.type === "Mesh") && e.cloner && !e.cloner.randomnessObject && !e.cloner.toObject && !e.cloner.randomness && (e.cloner = _objectSpread(_objectSpread({}, e.cloner), {}, {
      toObject: {
        object: "",
        spreadType: "random",
        scale: [0, 0, 0],
        rotation: [0, 0, 0],
        position: [0, 0, 0],
        axis: "x",
        seed: 0,
        count: 99,
        align: "normal"
      },
      randomness: !1,
      randomnessObject: {
        strength: 100,
        scale: [0, 0, 0],
        rotation: [0, 0, 0],
        position: [0, 0, 0],
        movement: 1,
        seed: 0,
        freqScale: 10,
        noiseType: "perlin"
      }
    }));
  });
}
function Vq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.type === "Mesh" && e.geometry.type === "NonParametricGeometry" && !("material" in e) && !("materials" in e) && (e.material = Qr.defaultTwoLayerData("phong"));
  });
}
function Uq(n) {
  n.scene.publish.orbitControls.autoZoom === void 0 && (n.scene.publish.orbitControls.autoZoom = !1), n.scene.objects.traverse(function (t, e) {
    (e.type === "OrthographicCamera" || e.type === "PerspectiveCamera") && (e.orthographic.autoZoom === void 0 && (e.orthographic.autoZoom = !1), e.orthographic.autoZoomFrustumSize === void 0 && (e.orthographic.autoZoomFrustumSize = 790));
  });
}
function Gq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.pathSnapping === void 0 && (e.pathSnapping = {
      pathId: null,
      slide: 0,
      offset: 0,
      orientation: "tangential"
    }), e.pathSnapping.offset === void 0 && (e.pathSnapping.offset = 0);
  });
}
function jq(n) {
  n.scene.publish.mouseEventTarget === void 0 && (n.scene.publish.mouseEventTarget = "canvas"), n.scene.publish.settings.web.hint === void 0 && (n.scene.publish.settings.web.hint = !1);
}
function Hq(n) {
  var t = n.scene.publish.settings.video;
  t.format === "gif" && t.fps > 48 && (t.fps = 15);
}
function Wq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.events.forEach(function (r) {
      r.type === "GameControl" && (r.resetYPosition = Math.abs(r.resetYPosition - e.position[1]));
    });
  });
}
function qq(n) {
  var t = n.scene.environment.usePhysics;
  n.scene.objects.traverse(function (e, r) {
    t && r.physics === null ? r.collision = !1 : r.collision = "visibility";
  });
}
function Yq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.events.forEach(function (r) {
      r.type === "GameControl" && (r.navmesh = Qd.defaultDataThirdPerson.navmesh);
    });
  });
}
function Xq(n) {
  n.scene.styles || (n.scene.styles = ya.defaultData());
}
function zD(n) {
  n.layers.forEach(function (t) {
    t.type === "light" && t.category !== "toon" && t.occlusion === void 0 && (t.occlusion = !0);
  });
}
function Qq(n) {
  n.scene.environment.ambientLight.occlusion === void 0 && (n.scene.environment.ambientLight.occlusion = !1), n.scene.environment.ambientLight.aoFullRes === void 0 && (n.scene.environment.ambientLight.aoFullRes = !1), n.scene.environment.ambientLight.radius === void 0 && (n.scene.environment.ambientLight.radius = 256), n.scene.environment.ambientLight.bias === void 0 && (n.scene.environment.ambientLight.bias = .5), n.scene.environment.ambientLight.aoColor === void 0 && (n.scene.environment.ambientLight.aoColor = {
    r: .19607843137254902,
    g: .19607843137254902,
    b: .19607843137254902
  }), Sa(n, zD), ba(n, zD);
}
function Kq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.events.forEach(function (r) {
      r.type === "GameControl" && Object.assign(r.gameActions, {
        run: new Re()
      });
    });
  });
}
function Zq(n) {
  n.scene.objects.traverse(function (t, e) {
    e.events.forEach(function (r) {
      r.type === "GameControl" && (r.keyAssignments = [].concat(_toConsumableArray(r.keyAssignments), [["run", "\u21E7"], ["none", "Ctrl"]]));
    });
  });
}
function VD(n) {
  n.layers && n.layers.forEach(function (t) {
    t.type === "light" && t.bumpMapIntensity === void 0 && (t.bumpMapIntensity = 5);
  });
}
function UD(n, t) {
  if (t < 1 && (Sa(n, ID), ba(n, ID), n.schema = 1), t < 2 && (gq(n), n.schema = 2), t < 3 && (vq(n), n.schema = 3), t < 4 && (xq(n), n.schema = 4), t < 5 && (bq(n), n.schema = 5), t < 6 && (Sq(n), n.schema = 6), t < 7 && (wq(n), n.schema = 7), t < 8 && (n.schema = 8), t < 9 && (LD(n), n.schema = 9), t < 10 && (Tq(n), n.schema = 10), t < 11 && (Mq(n), n.schema = 11), t < 12 && (LD(n), n.schema = 12), t < 13 && (Cq(n), n.schema = 13), t < 14 && (Dq(n), n.schema = 14), t < 15 && (Oq(n), n.schema = 15), t < 16 && (Iq(n), n.schema = 16), t < 17 && (Sa(n, BD), ba(n, BD), n.schema = 17), t < 18 && (Sa(n, RD), ba(n, RD), n.schema = 18), t < 19 && (yq(n), n.schema = 19), t < 20 && (Rq(n), Bq(n), n.schema = 20), t < 21 && (Nq(n), Fq(n), n.schema = 21), t < 22 && (kD(n), n.schema = 22), t < 23 && (kq(n), n.schema = 23), t < 24 && (zq(n), n.schema = 24), (t < 25 || n.shared.videos === void 0) && (Pq(n), t < 25 && (n.schema = 25)), t < 26 && (Aq(n), n.schema = 26), t < 27 && (_q(n), n.schema = 27), t < 28 && (kD(n), n.schema = 28), t < 29 && (Eq(n), n.schema = 29), t < 30 && (Vq(n), n.schema = 30), t < 31 && (Uq(n), n.schema = 31), t < 33 && (Gq(n), n.schema = 33), t < 34 && (jq(n), n.schema = 34), t < 35 && (Hq(n), n.schema = 35), t < 36 && (Wq(n), n.schema = 36), t < 37 && (qq(n), n.schema = 37), t < 38 && (Sa(n, ND), ba(n, ND), n.schema = 38), t < 39 && (Yq(n), n.schema = 39), t < 40 && (Xq(n), n.schema = 40), t < 41 && (Qq(n), n.schema = 41), t < 42 && (Kq(n), n.schema = 42), t < 43 && (Zq(n), n.schema = 43), t < 99) {
    var _Cr2;
    Sa(n, VD), ba(n, VD), n.scene.publish.playCamera === null && (n.scene.publish.playCamera = us);
    var e = Cr(n.scene.objects),
      r = n.scene.objects;
    n.scene.publish.playPage = vl, r.insertBefore(null, null, [{
      id: vl,
      data: _objectSpread(_objectSpread({}, ma.defaultData), {}, {
        backgroundColor: n.scene.backgroundColor,
        fog: n.scene.fog,
        postprocessing: n.scene.postprocessing,
        ao: Qn(n.scene.environment.ambientLight, "occlusion", "aoFullRes", "radius", "bias", "aoColor"),
        publish: {
          playCamera: n.scene.publish.playCamera,
          gameControlObject: n.scene.publish.gameControlObject
        },
        shadow: Qn(n.scene.environment.ambientLight, "softShadowQuality"),
        globalPhysics: _objectSpread(_objectSpread({}, wl.defaultData), Qn(n.scene.environment, "usePhysics", "gravity")),
        camera: (_Cr2 = Cr(n.scene.ownerCamera)) !== null && _Cr2 !== void 0 ? _Cr2 : ma.defaultData.camera,
        name: "Scene"
      }),
      children: []
    }]);
    var _iterator34 = _createForOfIteratorHelper(e),
      _step34;
    try {
      for (_iterator34.s(); !(_step34 = _iterator34.n()).done;) {
        var o = _step34.value;
        o.id !== va.TRASH_CAN_ID && r.move(vl, o.fi, o.id);
      }
    } catch (err) {
      _iterator34.e(err);
    } finally {
      _iterator34.f();
    }
    var i = 0,
      s = 0;
    n.shared.penumbraSize && n.scene.objects.traverse(function (o, a) {
      var _a$collision;
      a.type === "DirectionalLight" ? (a.penumbraSize = n.shared.penumbraSize[Math.min(i, 2)], i += 1) : a.type === "SpotLight" && (a.penumbraSize = n.shared.penumbraSize[3 + Math.min(s, 1)], s += 1), (a.physics === void 0 || a.physics === null) && a.type !== "Instance" && (a.physics = {}, Object.assign(a.physics, bl.defaultData)), a.physics !== void 0 && a.physics !== null && (a.physics.enabled = (_a$collision = a.collision) !== null && _a$collision !== void 0 ? _a$collision : "visibility", delete a.collision);
    }), n.schema = 99;
  }
}
function GD(n) {
  n.layers && n.layers.forEach(function (t) {
    t.type === "light" && t.alphaOverride === void 0 && (t.alphaOverride = 1);
  });
}
function Jq(n) {
  n.scene.objects.traverse(function (t, e) {
    var r = e.geometry;
    r && r.type === "PathGeometry" && (r.extrusion.capType = "flat", r.extrusion.bevel = 50, r.extrusion.bevelSides = 6, r.extrusion.shape.type === "Custom" && (r.extrusion.shape.shapeQuality = "low"));
  });
}
function $q(n) {
  var _n$events;
  Array.isArray(Cr(n.events)) && ((_n$events = n.events) === null || _n$events === void 0 ? void 0 : _n$events.forEach(function (t) {
    "disabled" in t || (t.disabled = !1), (t.type === "MouseDown" || t.type === "MouseUp" || t.type === "MousePress") && (t.mode = t.mode || "Object");
  }));
}
var Kd = 180 / Math.PI;
function jD(n) {
  n.rotation = n.rotation.slice(0, 3).map(function (t) {
    return t * Kd;
  });
}
function HD(n) {
  var _n$states, _t$thetaLength, _n$events2;
  jD(n), n.type === "Page" && jD(n.camera), (_n$states = n.states) === null || _n$states === void 0 ? void 0 : _n$states.forEach(function (e) {
    e.rotation === void 0 || e.rotation === null || (e.rotation = e.rotation.slice(0, 3).map(function (r) {
      return r * Kd;
    }));
  });
  var t = n.geometry;
  t && t.type === "SphereGeometry" && (t.thetaLength = ((_t$thetaLength = t.thetaLength) !== null && _t$thetaLength !== void 0 ? _t$thetaLength : 180) * Kd), t && t.type === "TorusGeometry" && (t.arc = t.arc * Kd), t && t.type === "PathGeometry" && (t.extrusion.angle *= Kd, t.extrusion.twist *= Kd), n.type === "Mesh" && n.geometry.type === "TextGeometry" && (n.geometry.text = {
    textValue: n.geometry.text
  }), Array.isArray(Cr(n.events)) && ((_n$events2 = n.events) === null || _n$events2 === void 0 ? void 0 : _n$events2.forEach(function (e) {
    (e.type === "MouseDown" || e.type === "MouseUp" || e.type === "MousePress" || e.type === "KeyDown" || e.type === "KeyUp" || e.type === "KeyPress" || e.type === "Collision" || e.type === "Trigger") && (e.runMode = e.toggle ? "Toggle" : "Repeat");
  }));
}
function e9(n) {
  n.shared.variables = pn({}, Ke.prototype);
}
function t9(n) {
  var t = Cr(n.shared.variables);
  n.shared.variables = pn(Object.entries(t !== null && t !== void 0 ? t : {}).map(function (_ref11, i) {
    var _ref12 = _slicedToArray(_ref11, 2),
      e = _ref12[0],
      r = _ref12[1];
    return {
      fi: i,
      id: e,
      data: r
    };
  }), Re.prototype);
}
var Ao = 111;
function WD(n, t) {
  t(n.data);
  var _iterator35 = _createForOfIteratorHelper(n.children),
    _step35;
  try {
    for (_iterator35.s(); !(_step35 = _iterator35.n()).done;) {
      var e = _step35.value;
      WD(e, t);
    }
  } catch (err) {
    _iterator35.e(err);
  } finally {
    _iterator35.f();
  }
}
function r9(n) {
  var _n$schema;
  var t = (_n$schema = n.schema) !== null && _n$schema !== void 0 ? _n$schema : 104;
  t !== Ao && t < 105 && (WD(n.asset, HD), n.schema = 105);
}
function i9(n) {
  n.shared.particles = pn({}, Ke.prototype), n.shared.lib && (n.shared.lib.particles = xa.defaultData().particles);
}
function n9(n) {
  n.scene.objects.traverse(function (t, e) {
    e.type === "Particle" && typeof e.renderMaterial.size == "number" && Object.assign(e.renderMaterial, {
      size: [e.renderMaterial.size, e.renderMaterial.size]
    });
  });
}
function Xv(n) {
  var _n$schema2;
  var t = (_n$schema2 = n.schema) !== null && _n$schema2 !== void 0 ? _n$schema2 : 0;
  if (t !== Ao) {
    console.warn("updating from ", t, "to ", Ao), UD(n, t), t < 100 && (n.scene.publish.joystickSizeAndXYOffset === void 0 && (n.scene.publish.joystickSizeAndXYOffset = zs.defaultData.joystickSizeAndXYOffset), n.schema = 100), t < 101 && (Sa(n, GD), ba(n, GD), n.schema = 101), t < 102 && (Jq(n), n.schema = 102), t < 104 && (n.shared.catelogs = new Ke(), n.shared.lib = xa.defaultData(), n.schema = 104), t < 105 && (e9(n), n.scene.objects.traverse(function (e, r) {
      HD(r);
    }), n.schema = 105);
    for (var _i35 = 0, _Object$values2 = Object.values(n.shared.lib.components); _i35 < _Object$values2.length; _i35++) {
      var e = _Object$values2[_i35];
      r9(e);
    }
    t < 106 && (t9(n), n.schema = 106), t < 107 && (n.shared.lib.variables = xa.defaultData().variables, n.schema = 107), t < 109 && (i9(n), n.schema = 109), t < 110 && (n9(n), n.schema = 110), t < 111 && (n.scene.objects.traverse(function (e, r) {
      $q(r);
    }), n.schema = 111);
  }
}
var Wd;
(function (l) {
  l.defaultData = {
    schema: Ao,
    scene: va.defaultData,
    frames: new Ke().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd", qd.defaultData),
    shared: _objectSpread(_objectSpread({}, yn.emptyData()), {}, {
      colors: yn.defaultColors()
    })
  }, l.emptyDataForImports = function (u) {
    var c = va.emptyDataWithPage(u);
    return {
      schema: Ao,
      scene: c,
      frames: new Ke().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd", qd.defaultData),
      shared: _objectSpread(_objectSpread({}, yn.emptyData()), {}, {
        colors: yn.defaultColors(),
        images: yn.defaultImages(u)
      })
    };
  }, l.emptyData = function () {
    return {
      schema: Ao,
      scene: va.emptyDataWithPage(),
      frames: new Ke().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd", qd.defaultData),
      shared: yn.emptyData()
    };
  }, l.clipboard2dData = function () {
    return {
      schema: Ao,
      scene: va.emptyData(),
      frames: new Ke(),
      shared: yn.emptyData()
    };
  }, l.collabHelper = _objectSpread(_objectSpread({}, zp), {}, {
    updateSchema: function updateSchema(u) {
      var _u$schema, _u$schema2;
      return ((_u$schema = u.schema) !== null && _u$schema !== void 0 ? _u$schema : 0) < Ao ? fl(u, Xv) : ((_u$schema2 = u.schema) !== null && _u$schema2 !== void 0 ? _u$schema2 : 0) - Ao;
    }
  });
  function s(u) {
    var c = l.collabHelper.updateSchema(u);
    return typeof c == "number" ? c === 0 ? u : null : c.data;
  }
  l.updateSchemaDirectly = s;
  function o(u) {
    return _objectSpread(_objectSpread({}, u), {}, {
      shared: _objectSpread(_objectSpread({}, u.shared), {}, {
        lib: xa.defaultData()
      })
    });
  }
  l.withoutLib = o;
  function a(u, c) {
    var d = u.scene.objects.get(c);
    if (d && d.data.type === "Component") return d;
    {
      var h = u.shared.lib.components[c];
      if (h) return h.asset;
    }
  }
  l.getComponentData = a;
})(Wd || (Wd = {}));
var qD;
(function (t) {
  function n(e) {
    return !0;
  }
  t.is = n;
})(qD || (qD = {}));
var Qv;
(function (r) {
  r.defaultData = {
    position: [0, 0],
    scale: [1, 1],
    rotation: 0
  };
  function t(i, s) {
    var _s$position, _s$rotation, _s$scale;
    return {
      position: (_s$position = s === null || s === void 0 ? void 0 : s.position) !== null && _s$position !== void 0 ? _s$position : i.position,
      rotation: (_s$rotation = s === null || s === void 0 ? void 0 : s.rotation) !== null && _s$rotation !== void 0 ? _s$rotation : i.rotation,
      scale: (_s$scale = s === null || s === void 0 ? void 0 : s.scale) !== null && _s$scale !== void 0 ? _s$scale : i.scale
    };
  }
  r.merge = t;
  function e(i, s) {
    return rv({
      position: xo.isEqual(i.position, s.position) ? void 0 : s.position,
      rotation: i.rotation === s.rotation ? void 0 : s.rotation,
      scale: xo.isEqual(i.scale, s.scale) ? void 0 : s.scale
    });
  }
  r.diff = e;
})(Qv || (Qv = {}));
var x1;
(function (t) {
  return t.defaultData = {
    horizontalConstraint: 0,
    verticalConstraint: 0
  };
})(x1 || (x1 = {}));
var Kv;
(function (t) {
  return t.defaultData = {
    opacity: 1,
    fill: {
      color: pt.white,
      enabled: !0
    },
    stroke: {
      color: pt.from0to1([0, 0, 0, 1]),
      thickness: 1,
      enabled: !1,
      mode: "inside"
    },
    layerBlur: {
      radius: 2,
      enabled: !1
    },
    backgroundBlur: {
      radius: 2,
      enabled: !1
    },
    dropShadow: {
      offset: [10, 10],
      blurRadius: 10,
      color: pt.from0to1([0, 0, 0, 1]),
      enabled: !1,
      spread: 0
    },
    innerShadow: {
      offset: [10, 10],
      blurRadius: 10,
      color: pt.from0to1([0, 0, 0, 1]),
      enabled: !1,
      spread: 0
    }
  };
})(Kv || (Kv = {}));
var wa;
(function (s) {
  function n(o, a) {
    return {
      name: a
    };
  }
  s.newEmpty = n;
  function t(o, a) {
    if (a === void 0) return o;
    var l = _objectSpread({}, o),
      u = ["width", "height", "cornerRadius"];
    for (var _i36 = 0, _u22 = u; _i36 < _u22.length; _i36++) {
      var c = _u22[_i36];
      c in l && c in a && a[c] !== void 0 && Object.assign(l, _defineProperty({}, c, a[c]));
    }
    return l;
  }
  function e(o, a) {
    if (a === void 0) return o;
    var l = _objectSpread({}, o);
    return "fill" in l && "fill" in a && a.fill !== void 0 && Object.assign(l, {
      fill: _objectSpread(_objectSpread({}, l.fill), a.fill)
    }), "stroke" in l && "stroke" in a && a.stroke !== void 0 && Object.assign(l, {
      stroke: _objectSpread(_objectSpread({}, l.stroke), a.stroke)
    }), "layerBlur" in l && "layerBlur" in a && a.layerBlur !== void 0 && Object.assign(l, {
      layerBlur: _objectSpread(_objectSpread({}, l.layerBlur), a.layerBlur)
    }), "backgroundBlur" in l && "backgroundBlur" in a && a.backgroundBlur !== void 0 && Object.assign(l, {
      backgroundBlur: _objectSpread(_objectSpread({}, l.backgroundBlur), a.backgroundBlur)
    }), "dropShadow" in l && "dropShadow" in a && a.dropShadow !== void 0 && Object.assign(l, {
      dropShadow: _objectSpread(_objectSpread({}, l.dropShadow), a.dropShadow)
    }), "innerShadow" in l && "innerShadow" in a && a.innerShadow !== void 0 && Object.assign(l, {
      innerShadow: _objectSpread(_objectSpread({}, l.innerShadow), a.innerShadow)
    }), l;
  }
  function r(o, a) {
    if (a === void 0) return o;
    var l = _objectSpread({}, o);
    return Object.assign(l, Qv.merge(l, a)), l = t(l, a), l = e(l, a), l;
  }
  s.patch = r;
  function i(o, a) {
    var l,
      u = [];
    for (var _i37 = 0, _Object$entries11 = Object.entries(a); _i37 < _Object$entries11.length; _i37++) {
      var _Object$entries11$_i = _slicedToArray(_Object$entries11[_i37], 2),
        c = _Object$entries11$_i[0],
        d = _Object$entries11$_i[1];
      c !== "name" && (l === void 0 && (l = {
        path: [],
        props: {},
        type: 0
      }, u.push(l)), l.props[c] = d);
    }
    return u;
  }
  s.toOps = i;
})(wa || (wa = {}));
var qp;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread(_objectSpread({}, Qv.defaultData), x1.defaultData), {}, {
    states: new Re(),
    events: new Re(),
    visible: !0,
    raycastLock: !1
  });
})(qp || (qp = {}));
var Yp;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({}, qp.defaultData), Kv.defaultData);
})(Yp || (Yp = {}));
var Zv;
(function (t) {
  return t.defaultData = {
    cornerRadius: [0, 0, 0, 0]
  };
})(Zv || (Zv = {}));
var b1;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({}, Yp.defaultData), {}, {
    type: "ellipse2d",
    width: 100,
    height: 100,
    name: "Ellipse"
  });
})(b1 || (b1 = {}));
var Zd;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread(_objectSpread({}, Yp.defaultData), Zv.defaultData), {}, {
    type: "rectangle2d",
    width: 100,
    height: 100,
    name: "Rectangle"
  });
})(Zd || (Zd = {}));
var S1;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({}, Yp.defaultData), {}, {
    type: "text2d",
    width: 100,
    height: 100,
    fontSize: 12,
    lineHeight: 1.2,
    letterSpacing: 0,
    text: {
      textValue: "Hello world"
    },
    horizontalAlign: 1,
    verticalAlign: 1,
    textTransform: 1,
    font: "Roboto_regular",
    name: "Text"
  });
})(S1 || (S1 = {}));
var YD;
(function (t) {
  function n(e) {
    return e.type === "ellipse2d" || e.type === "rectangle2d" || e.type === "text2d" || e.type === "vector2d";
  }
  t.is = n;
})(YD || (YD = {}));
var Xp;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread({}, qp.defaultData), {}, {
    name: "Group",
    type: "group2d"
  });
})(Xp || (Xp = {}));
var w1;
(function (t) {
  return t.defaultData = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, qp.defaultData), Zv.defaultData), Kv.defaultData), {}, {
    name: "Frame",
    type: "frame2d",
    width: 200,
    height: 200,
    fill: {
      color: pt.fromHexAndA(Xr, 1),
      enabled: !0
    },
    stroke: {
      color: pt.fromHexAndA(0, 1),
      thickness: 1,
      enabled: !1,
      mode: "inside"
    },
    backgroundBlur: {
      radius: 2,
      enabled: !1
    },
    layerBlur: {
      radius: 2,
      enabled: !1
    }
  });
})(w1 || (w1 = {}));
var Aa;
(function (i) {
  function n(s) {
    switch (s) {
      case "rectangle2d":
        return _objectSpread({}, Zd.defaultData);
      case "ellipse2d":
        return _objectSpread({}, b1.defaultData);
      case "text2d":
        return _objectSpread({}, S1.defaultData);
      case "vector2d":
        return _objectSpread({}, Zd.defaultData);
      case "frame2d":
        return _objectSpread({}, w1.defaultData);
      case "group2d":
        return _objectSpread({}, Xp.defaultData);
    }
  }
  i.defaultData = n;
  function t(s) {
    return "width" in s && "height" in s ? [typeof s.width == "number" ? s.width * .5 : 0, typeof s.height == "number" ? s.height * .5 : 0] : [0, 0];
  }
  i.getPivot = t;
  function e(s) {
    return s.type === "rectangle2d" || s.type === "ellipse2d" || s.type === "text2d" || s.type === "frame2d";
  }
  i.isResizeable = e;
  function r(s) {
    return s.type === "rectangle2d" || s.type === "frame2d";
  }
  i.hasCorners = r;
})(Aa || (Aa = {}));
var Jv;
(function (e) {
  return e.defaultData = {
    name: "UI",
    type: "scene2d",
    objects: new ar()
  }, e.emptyData = function () {
    return {
      type: "scene2d",
      objects: new ar()
    };
  };
})(Jv || (Jv = {}));
function Vs(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
  var e = n[0].index !== null,
    r = new Set(Object.keys(n[0].attributes)),
    i = new Set(Object.keys(n[0].morphAttributes)),
    s = {},
    o = {},
    a = n[0].morphTargetsRelative,
    l = new we(),
    u = 0;
  for (var c = 0; c < n.length; ++c) {
    var d = n[c],
      h = 0;
    if (e !== (d.index !== null)) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + ". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."), null;
    for (var f in d.attributes) {
      if (!r.has(f)) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + '. All geometries must have compatible attributes; make sure "' + f + '" attribute exists among all geometries, or in none of them.'), null;
      s[f] === void 0 && (s[f] = []), s[f].push(d.attributes[f]), h++;
    }
    if (h !== r.size) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + ". Make sure all geometries have the same number of attributes."), null;
    if (a !== d.morphTargetsRelative) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + ". .morphTargetsRelative must be consistent throughout all geometries."), null;
    for (var _f41 in d.morphAttributes) {
      if (!i.has(_f41)) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + ".  .morphAttributes must be consistent throughout all geometries."), null;
      o[_f41] === void 0 && (o[_f41] = []), o[_f41].push(d.morphAttributes[_f41]);
    }
    if (t) {
      var _f42 = void 0;
      if (e) _f42 = d.index.count;else if (d.attributes.position !== void 0) _f42 = d.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index " + c + ". The geometry must have either an index or a position attribute"), null;
      l.addGroup(u, _f42, c), u += _f42;
    }
  }
  if (e) {
    var _c8 = 0,
      _d5 = [];
    for (var _h25 = 0; _h25 < n.length; ++_h25) {
      var _f43 = n[_h25].index;
      for (var p = 0; p < _f43.count; ++p) _d5.push(_f43.getX(p) + _c8);
      _c8 += n[_h25].attributes.position.count;
    }
    l.setIndex(_d5);
  }
  for (var _c9 in s) {
    var _d23 = XD(s[_c9]);
    if (!_d23) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the " + _c9 + " attribute."), null;
    l.setAttribute(_c9, _d23);
  }
  for (var _c10 in o) {
    var _d24 = o[_c10][0].length;
    if (_d24 === 0) break;
    l.morphAttributes = l.morphAttributes || {}, l.morphAttributes[_c10] = [];
    for (var _h26 = 0; _h26 < _d24; ++_h26) {
      var _f44 = [];
      for (var m = 0; m < o[_c10].length; ++m) _f44.push(o[_c10][m][_h26]);
      var _p28 = XD(_f44);
      if (!_p28) return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the " + _c10 + " morphAttribute."), null;
      l.morphAttributes[_c10].push(_p28);
    }
  }
  return l;
}
function XD(n) {
  var t,
    e,
    r,
    i = 0;
  for (var a = 0; a < n.length; ++a) {
    var l = n[a];
    if (l.isInterleavedBufferAttribute) return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."), null;
    if (t === void 0 && (t = l.array.constructor), t !== l.array.constructor) return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."), null;
    if (e === void 0 && (e = l.itemSize), e !== l.itemSize) return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."), null;
    if (r === void 0 && (r = l.normalized), r !== l.normalized) return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."), null;
    i += l.array.length;
  }
  var s = new t(i),
    o = 0;
  for (var _a23 = 0; _a23 < n.length; ++_a23) s.set(n[_a23].array, o), o += n[_a23].array.length;
  return new Ge(s, e, r);
}
var QD = Math.pow(2, -24);
var Oc = /*#__PURE__*/_createClass(function Oc() {
  _classCallCheck(this, Oc);
});
function hs(n, t, e) {
  return e.min.x = t[n], e.min.y = t[n + 1], e.min.z = t[n + 2], e.max.x = t[n + 3], e.max.y = t[n + 4], e.max.z = t[n + 5], e;
}
function A1(n) {
  var t = -1,
    e = -1 / 0;
  for (var r = 0; r < 3; r++) {
    var i = n[r + 3] - n[r];
    i > e && (e = i, t = r);
  }
  return t;
}
function _1(n, t) {
  t.set(n);
}
function E1(n, t, e) {
  var r, i;
  for (var s = 0; s < 3; s++) {
    var o = s + 3;
    r = n[s], i = t[s], e[s] = r < i ? r : i, r = n[o], i = t[o], e[o] = r > i ? r : i;
  }
}
function Qp(n, t, e) {
  for (var r = 0; r < 3; r++) {
    var i = t[n + 2 * r],
      s = t[n + 2 * r + 1],
      o = i - s,
      a = i + s;
    o < e[r] && (e[r] = o), a > e[r + 3] && (e[r + 3] = a);
  }
}
function Jd(n) {
  var t = n[3] - n[0],
    e = n[4] - n[1],
    r = n[5] - n[2];
  return 2 * (t * e + e * r + r * t);
}
function a9(n, t) {
  if (!n.index) {
    var e = n.attributes.position.count,
      r = t.useSharedArrayBuffer ? SharedArrayBuffer : ArrayBuffer,
      i;
    e > 65535 ? i = new Uint32Array(new r(4 * e)) : i = new Uint16Array(new r(2 * e)), n.setIndex(new Ge(i, 1));
    for (var s = 0; s < e; s++) i[s] = s;
  }
}
function l9(n) {
  if (!n.groups || !n.groups.length) return [{
    offset: 0,
    count: n.index.count / 3
  }];
  var t = [],
    e = new Set();
  var _iterator36 = _createForOfIteratorHelper(n.groups),
    _step36;
  try {
    for (_iterator36.s(); !(_step36 = _iterator36.n()).done;) {
      var _i38 = _step36.value;
      e.add(_i38.start), e.add(_i38.start + _i38.count);
    }
  } catch (err) {
    _iterator36.e(err);
  } finally {
    _iterator36.f();
  }
  var r = Array.from(e.values()).sort(function (i, s) {
    return i - s;
  });
  for (var i = 0; i < r.length - 1; i++) {
    var s = r[i],
      o = r[i + 1];
    t.push({
      offset: s / 3,
      count: (o - s) / 3
    });
  }
  return t;
}
function M1(n, t, e, r) {
  var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
  var s = 1 / 0,
    o = 1 / 0,
    a = 1 / 0,
    l = -1 / 0,
    u = -1 / 0,
    c = -1 / 0,
    d = 1 / 0,
    h = 1 / 0,
    f = 1 / 0,
    p = -1 / 0,
    m = -1 / 0,
    g = -1 / 0,
    y = i !== null;
  for (var v = t * 6, x = (t + e) * 6; v < x; v += 6) {
    var S = n[v + 0],
      w = n[v + 1],
      A = S - w,
      E = S + w;
    A < s && (s = A), E > l && (l = E), y && S < d && (d = S), y && S > p && (p = S);
    var b = n[v + 2],
      T = n[v + 3],
      M = b - T,
      C = b + T;
    M < o && (o = M), C > u && (u = C), y && b < h && (h = b), y && b > m && (m = b);
    var P = n[v + 4],
      D = n[v + 5],
      O = P - D,
      I = P + D;
    O < a && (a = O), I > c && (c = I), y && P < f && (f = P), y && P > g && (g = P);
  }
  r[0] = s, r[1] = o, r[2] = a, r[3] = l, r[4] = u, r[5] = c, y && (i[0] = d, i[1] = h, i[2] = f, i[3] = p, i[4] = m, i[5] = g);
}
function c9(n, t, e, r) {
  var i = 1 / 0,
    s = 1 / 0,
    o = 1 / 0,
    a = -1 / 0,
    l = -1 / 0,
    u = -1 / 0;
  for (var c = t * 6, d = (t + e) * 6; c < d; c += 6) {
    var h = n[c + 0];
    h < i && (i = h), h > a && (a = h);
    var f = n[c + 2];
    f < s && (s = f), f > l && (l = f);
    var p = n[c + 4];
    p < o && (o = p), p > u && (u = p);
  }
  r[0] = i, r[1] = s, r[2] = o, r[3] = a, r[4] = l, r[5] = u;
}
function u9(n, t, e, r, i) {
  var s = e,
    o = e + r - 1,
    a = i.pos,
    l = i.axis * 2;
  for (;;) {
    for (; s <= o && t[s * 6 + l] < a;) s++;
    for (; s <= o && t[o * 6 + l] >= a;) o--;
    if (s < o) {
      for (var u = 0; u < 3; u++) {
        var c = n[s * 3 + u];
        n[s * 3 + u] = n[o * 3 + u], n[o * 3 + u] = c;
        var d = t[s * 6 + u * 2 + 0];
        t[s * 6 + u * 2 + 0] = t[o * 6 + u * 2 + 0], t[o * 6 + u * 2 + 0] = d;
        var h = t[s * 6 + u * 2 + 1];
        t[s * 6 + u * 2 + 1] = t[o * 6 + u * 2 + 1], t[o * 6 + u * 2 + 1] = h;
      }
      s++, o--;
    } else return s;
  }
}
var _a = 32,
  d9 = function d9(n, t) {
    return n.candidate - t.candidate;
  },
  _l = new Array(_a).fill().map(function () {
    return {
      count: 0,
      bounds: new Float32Array(6),
      rightCacheBounds: new Float32Array(6),
      leftCacheBounds: new Float32Array(6),
      candidate: 0
    };
  }),
  $v = new Float32Array(6);
function h9(n, t, e, r, i, s) {
  var o = -1,
    a = 0;
  if (s === 0) o = A1(t), o !== -1 && (a = (t[o] + t[o + 3]) / 2);else if (s === 1) o = A1(n), o !== -1 && (a = f9(e, r, i, o));else if (s === 2) {
    var l = Jd(n),
      u = 1.25 * i,
      c = r * 6,
      d = (r + i) * 6;
    for (var h = 0; h < 3; h++) {
      var f = t[h],
        g = (t[h + 3] - f) / _a;
      if (i < _a / 4) {
        var y = _toConsumableArray(_l);
        y.length = i;
        var v = 0;
        for (var S = c; S < d; S += 6, v++) {
          var w = y[v];
          w.candidate = e[S + 2 * h], w.count = 0;
          var A = w.bounds,
            E = w.leftCacheBounds,
            b = w.rightCacheBounds;
          for (var T = 0; T < 3; T++) b[T] = 1 / 0, b[T + 3] = -1 / 0, E[T] = 1 / 0, E[T + 3] = -1 / 0, A[T] = 1 / 0, A[T + 3] = -1 / 0;
          Qp(S, e, A);
        }
        y.sort(d9);
        var x = i;
        for (var _S14 = 0; _S14 < x; _S14++) {
          var _w14 = y[_S14];
          for (; _S14 + 1 < x && y[_S14 + 1].candidate === _w14.candidate;) y.splice(_S14 + 1, 1), x--;
        }
        for (var _S15 = c; _S15 < d; _S15 += 6) {
          var _w15 = e[_S15 + 2 * h];
          for (var _A10 = 0; _A10 < x; _A10++) {
            var _E10 = y[_A10];
            _w15 >= _E10.candidate ? Qp(_S15, e, _E10.rightCacheBounds) : (Qp(_S15, e, _E10.leftCacheBounds), _E10.count++);
          }
        }
        for (var _S16 = 0; _S16 < x; _S16++) {
          var _w16 = y[_S16],
            _A11 = _w16.count,
            _E11 = i - _w16.count,
            _b8 = _w16.leftCacheBounds,
            _T5 = _w16.rightCacheBounds,
            M = 0;
          _A11 !== 0 && (M = Jd(_b8) / l);
          var C = 0;
          _E11 !== 0 && (C = Jd(_T5) / l);
          var P = 1 + 1.25 * (M * _A11 + C * _E11);
          P < u && (o = h, u = P, a = _w16.candidate);
        }
      } else {
        for (var _x15 = 0; _x15 < _a; _x15++) {
          var _S17 = _l[_x15];
          _S17.count = 0, _S17.candidate = f + g + _x15 * g;
          var _w17 = _S17.bounds;
          for (var _A12 = 0; _A12 < 3; _A12++) _w17[_A12] = 1 / 0, _w17[_A12 + 3] = -1 / 0;
        }
        for (var _x16 = c; _x16 < d; _x16 += 6) {
          var _A13 = ~~((e[_x16 + 2 * h] - f) / g);
          _A13 >= _a && (_A13 = _a - 1);
          var _E12 = _l[_A13];
          _E12.count++, Qp(_x16, e, _E12.bounds);
        }
        var _y18 = _l[_a - 1];
        _1(_y18.bounds, _y18.rightCacheBounds);
        for (var _x17 = _a - 2; _x17 >= 0; _x17--) {
          var _S18 = _l[_x17],
            _w18 = _l[_x17 + 1];
          E1(_S18.bounds, _w18.rightCacheBounds, _S18.rightCacheBounds);
        }
        var _v16 = 0;
        for (var _x18 = 0; _x18 < _a - 1; _x18++) {
          var _S19 = _l[_x18],
            _w19 = _S19.count,
            _A14 = _S19.bounds,
            _b9 = _l[_x18 + 1].rightCacheBounds;
          _w19 !== 0 && (_v16 === 0 ? _1(_A14, $v) : E1(_A14, $v, $v)), _v16 += _w19;
          var _T6 = 0,
            _M10 = 0;
          _v16 !== 0 && (_T6 = Jd($v) / l);
          var _C10 = i - _v16;
          _C10 !== 0 && (_M10 = Jd(_b9) / l);
          var _P13 = 1 + 1.25 * (_T6 * _v16 + _M10 * _C10);
          _P13 < u && (o = h, u = _P13, a = _S19.candidate);
        }
      }
    }
  } else console.warn("MeshBVH: Invalid build strategy value ".concat(s, " used."));
  return {
    axis: o,
    pos: a
  };
}
function f9(n, t, e, r) {
  var i = 0;
  for (var s = t, o = t + e; s < o; s++) i += n[s * 6 + r * 2];
  return i / e;
}
function p9(n, t) {
  var e = n.attributes.position,
    r = n.index.array,
    i = r.length / 3,
    s = new Float32Array(i * 6),
    o = e.normalized,
    a = e.array,
    l = e.offset || 0,
    u = 3;
  e.isInterleavedBufferAttribute && (u = e.data.stride);
  var c = ["getX", "getY", "getZ"];
  for (var d = 0; d < i; d++) {
    var h = d * 3,
      f = d * 6,
      p = void 0,
      m = void 0,
      g = void 0;
    o ? (p = r[h + 0], m = r[h + 1], g = r[h + 2]) : (p = r[h + 0] * u + l, m = r[h + 1] * u + l, g = r[h + 2] * u + l);
    for (var y = 0; y < 3; y++) {
      var v = void 0,
        x = void 0,
        S = void 0;
      o ? (v = e[c[y]](p), x = e[c[y]](m), S = e[c[y]](g)) : (v = a[p + y], x = a[m + y], S = a[g + y]);
      var w = v;
      x < w && (w = x), S < w && (w = S);
      var A = v;
      x > A && (A = x), S > A && (A = S);
      var E = (A - w) / 2,
        b = y * 2;
      s[f + b + 0] = w + E, s[f + b + 1] = E + (Math.abs(w) + E) * QD, w < t[y] && (t[y] = w), A > t[y + 3] && (t[y + 3] = A);
    }
  }
  return s;
}
function m9(n, t) {
  function e(y) {
    h && h(y / f);
  }
  function r(y, v, x) {
    var S = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
    var w = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
    if (!p && w >= l && (p = !0, u && (console.warn("MeshBVH: Max depth of ".concat(l, " reached when generating BVH. Consider increasing maxDepth.")), console.warn(n))), x <= c || w >= l) return e(v + x), y.offset = v, y.count = x, y;
    var A = h9(y.boundingData, S, o, v, x, d);
    if (A.axis === -1) return e(v + x), y.offset = v, y.count = x, y;
    var E = u9(a, o, v, x, A);
    if (E === v || E === v + x) e(v + x), y.offset = v, y.count = x;else {
      y.splitAxis = A.axis;
      var b = new Oc(),
        T = v,
        M = E - v;
      y.left = b, b.boundingData = new Float32Array(6), M1(o, T, M, b.boundingData, s), r(b, T, M, s, w + 1);
      var C = new Oc(),
        P = E,
        D = x - M;
      y.right = C, C.boundingData = new Float32Array(6), M1(o, P, D, C.boundingData, s), r(C, P, D, s, w + 1);
    }
    return y;
  }
  a9(n, t);
  var i = new Float32Array(6),
    s = new Float32Array(6),
    o = p9(n, i),
    a = n.index.array,
    l = t.maxDepth,
    u = t.verbose,
    c = t.maxLeafTris,
    d = t.strategy,
    h = t.onProgress,
    f = n.index.count / 3,
    p = !1,
    m = [],
    g = l9(n);
  if (g.length === 1) {
    var y = g[0],
      v = new Oc();
    v.boundingData = i, c9(o, y.offset, y.count, s), r(v, y.offset, y.count, s), m.push(v);
  } else {
    var _iterator37 = _createForOfIteratorHelper(g),
      _step37;
    try {
      for (_iterator37.s(); !(_step37 = _iterator37.n()).done;) {
        var _y19 = _step37.value;
        var _v17 = new Oc();
        _v17.boundingData = new Float32Array(6), M1(o, _y19.offset, _y19.count, _v17.boundingData, s), r(_v17, _y19.offset, _y19.count, s), m.push(_v17);
      }
    } catch (err) {
      _iterator37.e(err);
    } finally {
      _iterator37.f();
    }
  }
  return m;
}
function JD(n, t) {
  var e = m9(n, t),
    r,
    i,
    s,
    o = [],
    a = t.useSharedArrayBuffer ? SharedArrayBuffer : ArrayBuffer;
  for (var c = 0; c < e.length; c++) {
    var d = e[c],
      h = l(d),
      f = new a(32 * h);
    r = new Float32Array(f), i = new Uint32Array(f), s = new Uint16Array(f), u(0, d), o.push(f);
  }
  return o;
  function l(c) {
    return c.count ? 1 : 1 + l(c.left) + l(c.right);
  }
  function u(c, d) {
    var h = c / 4,
      f = c / 2,
      p = !!d.count,
      m = d.boundingData;
    for (var g = 0; g < 6; g++) r[h + g] = m[g];
    if (p) {
      var _g16 = d.offset,
        y = d.count;
      return i[h + 6] = _g16, s[f + 14] = y, s[f + 15] = 65535, c + 32;
    } else {
      var _g17 = d.left,
        _y20 = d.right,
        v = d.splitAxis,
        x;
      if (x = u(c + 32, _g17), x / 4 > Math.pow(2, 32)) throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");
      return i[h + 6] = x / 4, x = u(x, _y20), i[h + 7] = v, x;
    }
  }
}
var Mn = /*#__PURE__*/function () {
  function Mn() {
    _classCallCheck(this, Mn);
    this.min = 1 / 0, this.max = -1 / 0;
  }
  _createClass(Mn, [{
    key: "setFromPointsField",
    value: function setFromPointsField(t, e) {
      var r = 1 / 0,
        i = -1 / 0;
      for (var s = 0, o = t.length; s < o; s++) {
        var l = t[s][e];
        r = l < r ? l : r, i = l > i ? l : i;
      }
      this.min = r, this.max = i;
    }
  }, {
    key: "setFromPoints",
    value: function setFromPoints(t, e) {
      var r = 1 / 0,
        i = -1 / 0;
      for (var s = 0, o = e.length; s < o; s++) {
        var a = e[s],
          l = t.dot(a);
        r = l < r ? l : r, i = l > i ? l : i;
      }
      this.min = r, this.max = i;
    }
  }, {
    key: "isSeparated",
    value: function isSeparated(t) {
      return this.min > t.max || t.min > this.max;
    }
  }]);
  return Mn;
}();
Mn.prototype.setFromBox = function () {
  var n = new _();
  return function (e, r) {
    var i = r.min,
      s = r.max,
      o = 1 / 0,
      a = -1 / 0;
    for (var l = 0; l <= 1; l++) for (var u = 0; u <= 1; u++) for (var c = 0; c <= 1; c++) {
      n.x = i.x * l + s.x * (1 - l), n.y = i.y * u + s.y * (1 - u), n.z = i.z * c + s.z * (1 - c);
      var d = e.dot(n);
      o = Math.min(d, o), a = Math.max(d, a);
    }
    this.min = o, this.max = a;
  };
}();
var jfe = function () {
  var n = new Mn();
  return function (e, r) {
    var i = e.points,
      s = e.satAxes,
      o = e.satBounds,
      a = r.points,
      l = r.satAxes,
      u = r.satBounds;
    for (var c = 0; c < 3; c++) {
      var d = o[c],
        h = s[c];
      if (n.setFromPoints(h, a), d.isSeparated(n)) return !1;
    }
    for (var _c11 = 0; _c11 < 3; _c11++) {
      var _d25 = u[_c11],
        _h27 = l[_c11];
      if (n.setFromPoints(_h27, i), _d25.isSeparated(n)) return !1;
    }
  };
}();
var g9 = function () {
    var n = new _(),
      t = new _(),
      e = new _();
    return function (i, s, o) {
      var a = i.start,
        l = n,
        u = s.start,
        c = t;
      e.subVectors(a, u), n.subVectors(i.end, i.start), t.subVectors(s.end, s.start);
      var d = e.dot(c),
        h = c.dot(l),
        f = c.dot(c),
        p = e.dot(l),
        g = l.dot(l) * f - h * h,
        y,
        v;
      g !== 0 ? y = (d * h - p * f) / g : y = 0, v = (d + y * h) / f, o.x = y, o.y = v;
    };
  }(),
  Kp = function () {
    var n = new N(),
      t = new _(),
      e = new _();
    return function (i, s, o, a) {
      g9(i, s, n);
      var l = n.x,
        u = n.y;
      if (l >= 0 && l <= 1 && u >= 0 && u <= 1) {
        i.at(l, o), s.at(u, a);
        return;
      } else if (l >= 0 && l <= 1) {
        u < 0 ? s.at(0, a) : s.at(1, a), i.closestPointToPoint(a, !0, o);
        return;
      } else if (u >= 0 && u <= 1) {
        l < 0 ? i.at(0, o) : i.at(1, o), s.closestPointToPoint(o, !0, a);
        return;
      } else {
        var c;
        l < 0 ? c = i.start : c = i.end;
        var d;
        u < 0 ? d = s.start : d = s.end;
        var h = t,
          f = e;
        if (i.closestPointToPoint(d, !0, t), s.closestPointToPoint(c, !0, e), h.distanceToSquared(d) <= f.distanceToSquared(c)) {
          o.copy(h), a.copy(d);
          return;
        } else {
          o.copy(c), a.copy(f);
          return;
        }
      }
    };
  }(),
  $D = function () {
    var n = new _(),
      t = new _(),
      e = new qr(),
      r = new xi();
    return function (s, o) {
      var a = s.radius,
        l = s.center,
        u = o.a,
        c = o.b,
        d = o.c;
      if (r.start = u, r.end = c, r.closestPointToPoint(l, !0, n).distanceTo(l) <= a || (r.start = u, r.end = d, r.closestPointToPoint(l, !0, n).distanceTo(l) <= a) || (r.start = c, r.end = d, r.closestPointToPoint(l, !0, n).distanceTo(l) <= a)) return !0;
      var m = o.getPlane(e);
      if (Math.abs(m.distanceToPoint(l)) <= a) {
        var y = m.projectPoint(l, t);
        if (o.containsPoint(y)) return !0;
      }
      return !1;
    };
  }();
var y9 = 1e-15;
function $d(n) {
  return Math.abs(n) < y9;
}
var Cn = /*#__PURE__*/function (_vr) {
  _inherits(Cn, _vr);
  var _super110 = _createSuper(Cn);
  function Cn() {
    var _this94;
    _classCallCheck(this, Cn);
    for (var _len3 = arguments.length, t = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {
      t[_key3] = arguments[_key3];
    }
    _this94 = _super110.call.apply(_super110, [this].concat(t)), _this94.isExtendedTriangle = !0, _this94.satAxes = new Array(4).fill().map(function () {
      return new _();
    }), _this94.satBounds = new Array(4).fill().map(function () {
      return new Mn();
    }), _this94.points = [_this94.a, _this94.b, _this94.c], _this94.sphere = new Er(), _this94.plane = new qr(), _this94.needsUpdate = !0;
    return _this94;
  }
  _createClass(Cn, [{
    key: "intersectsSphere",
    value: function intersectsSphere(t) {
      return $D(t, this);
    }
  }, {
    key: "update",
    value: function update() {
      var t = this.a,
        e = this.b,
        r = this.c,
        i = this.points,
        s = this.satAxes,
        o = this.satBounds,
        a = s[0],
        l = o[0];
      this.getNormal(a), l.setFromPoints(a, i);
      var u = s[1],
        c = o[1];
      u.subVectors(t, e), c.setFromPoints(u, i);
      var d = s[2],
        h = o[2];
      d.subVectors(e, r), h.setFromPoints(d, i);
      var f = s[3],
        p = o[3];
      f.subVectors(r, t), p.setFromPoints(f, i), this.sphere.setFromPoints(this.points), this.plane.setFromNormalAndCoplanarPoint(a, t), this.needsUpdate = !1;
    }
  }]);
  return Cn;
}(vr);
Cn.prototype.closestPointToSegment = function () {
  var n = new _(),
    t = new _(),
    e = new xi();
  return function (i) {
    var s = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var a = i.start,
      l = i.end,
      u = this.points,
      c,
      d = 1 / 0;
    for (var h = 0; h < 3; h++) {
      var f = (h + 1) % 3;
      e.start.copy(u[h]), e.end.copy(u[f]), Kp(e, i, n, t), c = n.distanceToSquared(t), c < d && (d = c, s && s.copy(n), o && o.copy(t));
    }
    return this.closestPointToPoint(a, n), c = a.distanceToSquared(n), c < d && (d = c, s && s.copy(n), o && o.copy(a)), this.closestPointToPoint(l, n), c = l.distanceToSquared(n), c < d && (d = c, s && s.copy(n), o && o.copy(l)), Math.sqrt(d);
  };
}();
Cn.prototype.intersectsTriangle = function () {
  var n = new Cn(),
    t = new Array(3),
    e = new Array(3),
    r = new Mn(),
    i = new Mn(),
    s = new _(),
    o = new _(),
    a = new _(),
    l = new _(),
    u = new xi(),
    c = new xi(),
    d = new xi();
  return function (f) {
    var p = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var m = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
    this.needsUpdate && this.update(), f.isExtendedTriangle ? f.needsUpdate && f.update() : (n.copy(f), n.update(), f = n);
    var g = this.plane,
      y = f.plane;
    if (Math.abs(g.normal.dot(y.normal)) > 1 - 1e-10) {
      var v = this.satBounds,
        x = this.satAxes;
      e[0] = f.a, e[1] = f.b, e[2] = f.c;
      for (var A = 0; A < 4; A++) {
        var E = v[A],
          b = x[A];
        if (r.setFromPoints(b, e), E.isSeparated(r)) return !1;
      }
      var S = f.satBounds,
        w = f.satAxes;
      t[0] = this.a, t[1] = this.b, t[2] = this.c;
      for (var _A15 = 0; _A15 < 4; _A15++) {
        var _E13 = S[_A15],
          _b10 = w[_A15];
        if (r.setFromPoints(_b10, t), _E13.isSeparated(r)) return !1;
      }
      for (var _A16 = 0; _A16 < 4; _A16++) {
        var _E14 = x[_A16];
        for (var _b11 = 0; _b11 < 4; _b11++) {
          var T = w[_b11];
          if (s.crossVectors(_E14, T), r.setFromPoints(s, t), i.setFromPoints(s, e), r.isSeparated(i)) return !1;
        }
      }
      return p && (m || console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."), p.start.set(0, 0, 0), p.end.set(0, 0, 0)), !0;
    } else {
      var _v18 = this.points,
        _x19 = !1,
        _S20 = 0;
      for (var O = 0; O < 3; O++) {
        var I = _v18[O],
          z = _v18[(O + 1) % 3];
        u.start.copy(I), u.end.copy(z), u.delta(o);
        var B = _x19 ? c.start : c.end,
          V = $d(y.distanceToPoint(I));
        if ($d(y.normal.dot(o)) && V) {
          c.copy(u), _S20 = 2;
          break;
        }
        if ((y.intersectLine(u, B) || V) && !$d(B.distanceTo(z))) {
          if (_S20++, _x19) break;
          _x19 = !0;
        }
      }
      if (_S20 === 1 && f.containsPoint(c.end)) return p && (p.start.copy(c.end), p.end.copy(c.end)), !0;
      if (_S20 !== 2) return !1;
      var _w20 = f.points,
        _A17 = !1,
        _E15 = 0;
      for (var _O14 = 0; _O14 < 3; _O14++) {
        var _I5 = _w20[_O14],
          _z4 = _w20[(_O14 + 1) % 3];
        u.start.copy(_I5), u.end.copy(_z4), u.delta(a);
        var _B4 = _A17 ? d.start : d.end,
          _V7 = $d(g.distanceToPoint(_I5));
        if ($d(g.normal.dot(a)) && _V7) {
          d.copy(u), _E15 = 2;
          break;
        }
        if ((g.intersectLine(u, _B4) || _V7) && !$d(_B4.distanceTo(_z4))) {
          if (_E15++, _A17) break;
          _A17 = !0;
        }
      }
      if (_E15 === 1 && this.containsPoint(d.end)) return p && (p.start.copy(d.end), p.end.copy(d.end)), !0;
      if (_E15 !== 2) return !1;
      if (c.delta(o), d.delta(a), o.dot(a) < 0) {
        var _O15 = d.start;
        d.start = d.end, d.end = _O15;
      }
      var _b12 = c.start.dot(o),
        _T7 = c.end.dot(o),
        M = d.start.dot(o),
        C = d.end.dot(o),
        P = _T7 < M,
        D = _b12 < C;
      return _b12 !== C && M !== _T7 && P === D ? !1 : (p && (l.subVectors(c.start, d.start), l.dot(o) > 0 ? p.start.copy(c.start) : p.start.copy(d.start), l.subVectors(c.end, d.end), l.dot(o) < 0 ? p.end.copy(c.end) : p.end.copy(d.end)), !0);
    }
  };
}();
Cn.prototype.distanceToPoint = function () {
  var n = new _();
  return function (e) {
    return this.closestPointToPoint(e, n), e.distanceTo(n);
  };
}();
Cn.prototype.distanceToTriangle = function () {
  var n = new _(),
    t = new _(),
    e = ["a", "b", "c"],
    r = new xi(),
    i = new xi();
  return function (o) {
    var a = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
    var l = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var u = a || l ? r : null;
    if (this.intersectsTriangle(o, u)) return (a || l) && (a && u.getCenter(a), l && u.getCenter(l)), 0;
    var c = 1 / 0;
    for (var d = 0; d < 3; d++) {
      var h = void 0,
        f = e[d],
        p = o[f];
      this.closestPointToPoint(p, n), h = p.distanceToSquared(n), h < c && (c = h, a && a.copy(n), l && l.copy(p));
      var m = this[f];
      o.closestPointToPoint(m, n), h = m.distanceToSquared(n), h < c && (c = h, a && a.copy(m), l && l.copy(n));
    }
    for (var _d26 = 0; _d26 < 3; _d26++) {
      var _h28 = e[_d26],
        _f45 = e[(_d26 + 1) % 3];
      r.set(this[_h28], this[_f45]);
      for (var _p29 = 0; _p29 < 3; _p29++) {
        var _m25 = e[_p29],
          g = e[(_p29 + 1) % 3];
        i.set(o[_m25], o[g]), Kp(r, i, n, t);
        var y = n.distanceToSquared(t);
        y < c && (c = y, a && a.copy(n), l && l.copy(t));
      }
    }
    return Math.sqrt(c);
  };
}();
var Pn = /*#__PURE__*/function () {
  function Pn(t, e, r) {
    _classCallCheck(this, Pn);
    this.isOrientedBox = !0, this.min = new _(), this.max = new _(), this.matrix = new te(), this.invMatrix = new te(), this.points = new Array(8).fill().map(function () {
      return new _();
    }), this.satAxes = new Array(3).fill().map(function () {
      return new _();
    }), this.satBounds = new Array(3).fill().map(function () {
      return new Mn();
    }), this.alignedSatBounds = new Array(3).fill().map(function () {
      return new Mn();
    }), this.needsUpdate = !1, t && this.min.copy(t), e && this.max.copy(e), r && this.matrix.copy(r);
  }
  _createClass(Pn, [{
    key: "set",
    value: function set(t, e, r) {
      this.min.copy(t), this.max.copy(e), this.matrix.copy(r), this.needsUpdate = !0;
    }
  }, {
    key: "copy",
    value: function copy(t) {
      this.min.copy(t.min), this.max.copy(t.max), this.matrix.copy(t.matrix), this.needsUpdate = !0;
    }
  }]);
  return Pn;
}();
Pn.prototype.update = function () {
  return function () {
    var t = this.matrix,
      e = this.min,
      r = this.max,
      i = this.points;
    for (var u = 0; u <= 1; u++) for (var c = 0; c <= 1; c++) for (var d = 0; d <= 1; d++) {
      var h = 1 * u | 2 * c | 4 * d,
        f = i[h];
      f.x = u ? r.x : e.x, f.y = c ? r.y : e.y, f.z = d ? r.z : e.z, f.applyMatrix4(t);
    }
    var s = this.satBounds,
      o = this.satAxes,
      a = i[0];
    for (var _u23 = 0; _u23 < 3; _u23++) {
      var _c12 = o[_u23],
        _d27 = s[_u23],
        _h29 = 1 << _u23,
        _f46 = i[_h29];
      _c12.subVectors(a, _f46), _d27.setFromPoints(_c12, i);
    }
    var l = this.alignedSatBounds;
    l[0].setFromPointsField(i, "x"), l[1].setFromPointsField(i, "y"), l[2].setFromPointsField(i, "z"), this.invMatrix.copy(this.matrix).invert(), this.needsUpdate = !1;
  };
}();
Pn.prototype.intersectsBox = function () {
  var n = new Mn();
  return function (e) {
    this.needsUpdate && this.update();
    var r = e.min,
      i = e.max,
      s = this.satBounds,
      o = this.satAxes,
      a = this.alignedSatBounds;
    if (n.min = r.x, n.max = i.x, a[0].isSeparated(n) || (n.min = r.y, n.max = i.y, a[1].isSeparated(n)) || (n.min = r.z, n.max = i.z, a[2].isSeparated(n))) return !1;
    for (var l = 0; l < 3; l++) {
      var u = o[l],
        c = s[l];
      if (n.setFromBox(u, e), c.isSeparated(n)) return !1;
    }
    return !0;
  };
}();
Pn.prototype.intersectsTriangle = function () {
  var n = new Cn(),
    t = new Array(3),
    e = new Mn(),
    r = new Mn(),
    i = new _();
  return function (o) {
    this.needsUpdate && this.update(), o.isExtendedTriangle ? o.needsUpdate && o.update() : (n.copy(o), n.update(), o = n);
    var a = this.satBounds,
      l = this.satAxes;
    t[0] = o.a, t[1] = o.b, t[2] = o.c;
    for (var h = 0; h < 3; h++) {
      var f = a[h],
        p = l[h];
      if (e.setFromPoints(p, t), f.isSeparated(e)) return !1;
    }
    var u = o.satBounds,
      c = o.satAxes,
      d = this.points;
    for (var _h30 = 0; _h30 < 3; _h30++) {
      var _f47 = u[_h30],
        _p30 = c[_h30];
      if (e.setFromPoints(_p30, d), _f47.isSeparated(e)) return !1;
    }
    for (var _h31 = 0; _h31 < 3; _h31++) {
      var _f48 = l[_h31];
      for (var _p31 = 0; _p31 < 4; _p31++) {
        var m = c[_p31];
        if (i.crossVectors(_f48, m), e.setFromPoints(i, t), r.setFromPoints(i, d), e.isSeparated(r)) return !1;
      }
    }
    return !0;
  };
}();
Pn.prototype.closestPointToPoint = function () {
  return function (t, e) {
    return this.needsUpdate && this.update(), e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min, this.max).applyMatrix4(this.matrix), e;
  };
}();
Pn.prototype.distanceToPoint = function () {
  var n = new _();
  return function (e) {
    return this.closestPointToPoint(e, n), e.distanceTo(n);
  };
}();
Pn.prototype.distanceToBox = function () {
  var n = ["x", "y", "z"],
    t = new Array(12).fill().map(function () {
      return new xi();
    }),
    e = new Array(12).fill().map(function () {
      return new xi();
    }),
    r = new _(),
    i = new _();
  return function (o) {
    var a = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var l = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
    var u = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
    if (this.needsUpdate && this.update(), this.intersectsBox(o)) return (l || u) && (o.getCenter(i), this.closestPointToPoint(i, r), o.closestPointToPoint(r, i), l && l.copy(r), u && u.copy(i)), 0;
    var c = a * a,
      d = o.min,
      h = o.max,
      f = this.points,
      p = 1 / 0;
    for (var g = 0; g < 8; g++) {
      var y = f[g];
      i.copy(y).clamp(d, h);
      var v = y.distanceToSquared(i);
      if (v < p && (p = v, l && l.copy(y), u && u.copy(i), v < c)) return Math.sqrt(v);
    }
    var m = 0;
    for (var _g18 = 0; _g18 < 3; _g18++) for (var _y21 = 0; _y21 <= 1; _y21++) for (var _v19 = 0; _v19 <= 1; _v19++) {
      var x = (_g18 + 1) % 3,
        S = (_g18 + 2) % 3,
        w = _y21 << x | _v19 << S,
        A = 1 << _g18 | _y21 << x | _v19 << S,
        E = f[w],
        b = f[A];
      t[m].set(E, b);
      var M = n[_g18],
        C = n[x],
        P = n[S],
        D = e[m],
        O = D.start,
        I = D.end;
      O[M] = d[M], O[C] = _y21 ? d[C] : h[C], O[P] = _v19 ? d[P] : h[C], I[M] = h[M], I[C] = _y21 ? d[C] : h[C], I[P] = _v19 ? d[P] : h[C], m++;
    }
    for (var _g19 = 0; _g19 <= 1; _g19++) for (var _y22 = 0; _y22 <= 1; _y22++) for (var _v20 = 0; _v20 <= 1; _v20++) {
      i.x = _g19 ? h.x : d.x, i.y = _y22 ? h.y : d.y, i.z = _v20 ? h.z : d.z, this.closestPointToPoint(i, r);
      var _x20 = i.distanceToSquared(r);
      if (_x20 < p && (p = _x20, l && l.copy(r), u && u.copy(i), _x20 < c)) return Math.sqrt(_x20);
    }
    for (var _g20 = 0; _g20 < 12; _g20++) {
      var _y23 = t[_g20];
      for (var _v21 = 0; _v21 < 12; _v21++) {
        var _x21 = e[_v21];
        Kp(_y23, _x21, r, i);
        var _S21 = r.distanceToSquared(i);
        if (_S21 < p && (p = _S21, l && l.copy(r), u && u.copy(i), _S21 < c)) return Math.sqrt(_S21);
      }
    }
    return Math.sqrt(p);
  };
}();
var eh = new _(),
  th = new _(),
  rh = new _(),
  t0 = new N(),
  r0 = new N(),
  i0 = new N(),
  eO = new _(),
  tO = new _(),
  rO = new _(),
  n0 = new _();
function v9(n, t, e, r, i, s) {
  var o;
  return s === ai ? o = n.intersectTriangle(r, e, t, !0, i) : o = n.intersectTriangle(t, e, r, s !== qi, i), o === null ? null : {
    distance: n.origin.distanceTo(i),
    point: i.clone()
  };
}
function x9(n, t, e, r, i, s, o, a, l) {
  eh.fromBufferAttribute(t, s), th.fromBufferAttribute(t, o), rh.fromBufferAttribute(t, a);
  var u = v9(n, eh, th, rh, n0, l);
  if (u) {
    r && (t0.fromBufferAttribute(r, s), r0.fromBufferAttribute(r, o), i0.fromBufferAttribute(r, a), u.uv = vr.getInterpolation(n0, eh, th, rh, t0, r0, i0, new N())), i && (t0.fromBufferAttribute(i, s), r0.fromBufferAttribute(i, o), i0.fromBufferAttribute(i, a), u.uv1 = vr.getInterpolation(n0, eh, th, rh, t0, r0, i0, new N())), e && (eO.fromBufferAttribute(e, s), tO.fromBufferAttribute(e, o), rO.fromBufferAttribute(e, a), u.normal = vr.getInterpolation(n0, eh, th, rh, eO, tO, rO, new _()), u.normal.dot(n.direction) > 0 && u.normal.multiplyScalar(-1));
    var c = {
      a: s,
      b: o,
      c: a,
      normal: new _(),
      materialIndex: 0
    };
    vr.getNormal(eh, th, rh, c.normal), u.face = c, u.faceIndex = s;
  }
  return u;
}
function P1(n, t, e, r, i) {
  var s = r * 3,
    o = n.index.getX(s),
    a = n.index.getX(s + 1),
    l = n.index.getX(s + 2),
    _n$attributes = n.attributes,
    u = _n$attributes.position,
    c = _n$attributes.normal,
    d = _n$attributes.uv,
    h = _n$attributes.uv1,
    f = x9(e, u, c, d, h, o, a, l, t);
  return f ? (f.faceIndex = r, i && i.push(f), f) : null;
}
function iO(n, t, e, r, i, s) {
  for (var o = r, a = r + i; o < a; o++) P1(n, t, e, o, s);
}
function nO(n, t, e, r, i) {
  var s = 1 / 0,
    o = null;
  for (var a = r, l = r + i; a < l; a++) {
    var u = P1(n, t, e, a);
    u && u.distance < s && (o = u, s = u.distance);
  }
  return o;
}
function fs(n, t, e, r) {
  var i = n.a,
    s = n.b,
    o = n.c,
    a = t,
    l = t + 1,
    u = t + 2;
  e && (a = e.getX(t), l = e.getX(t + 1), u = e.getX(t + 2)), i.x = r.getX(a), i.y = r.getY(a), i.z = r.getZ(a), s.x = r.getX(l), s.y = r.getY(l), s.z = r.getZ(l), o.x = r.getX(u), o.y = r.getY(u), o.z = r.getZ(u);
}
function D1(n, t, e, r, i, s, o) {
  var a = e.index,
    l = e.attributes.position;
  for (var u = n, c = t + n; u < c; u++) if (fs(o, u * 3, a, l), o.needsUpdate = !0, r(o, u, i, s)) return !0;
  return !1;
}
var ih = /*#__PURE__*/function () {
  function ih(t) {
    _classCallCheck(this, ih);
    this._getNewPrimitive = t, this._primitives = [];
  }
  _createClass(ih, [{
    key: "getPrimitive",
    value: function getPrimitive() {
      var t = this._primitives;
      return t.length === 0 ? this._getNewPrimitive() : t.pop();
    }
  }, {
    key: "releasePrimitive",
    value: function releasePrimitive(t) {
      this._primitives.push(t);
    }
  }]);
  return ih;
}();
function Ea(n, t) {
  return t[n + 15] === 65535;
}
function Ic(n, t) {
  return t[n + 6];
}
function nh(n, t) {
  return t[n + 14];
}
function sh(n) {
  return n + 8;
}
function oh(n, t) {
  return t[n + 6];
}
function sO(n, t) {
  return t[n + 7];
}
var ah = new Bt(),
  o0 = new _(),
  S9 = ["x", "y", "z"];
function a0(n, t, e, r, i) {
  var s = n * 2,
    o = lh,
    a = El,
    l = Tl;
  if (Ea(s, a)) {
    var c = Ic(n, l),
      d = nh(s, a);
    iO(t, e, r, c, d, i);
  } else {
    var _c13 = sh(n);
    c0(_c13, o, r, o0) && a0(_c13, t, e, r, i);
    var _d28 = oh(n, l);
    c0(_d28, o, r, o0) && a0(_d28, t, e, r, i);
  }
}
function l0(n, t, e, r) {
  var i = n * 2,
    s = lh,
    o = El,
    a = Tl;
  if (Ea(i, o)) {
    var u = Ic(n, a),
      c = nh(i, o);
    return nO(t, e, r, u, c);
  } else {
    var _u24 = sO(n, a),
      _c14 = S9[_u24],
      h = r.direction[_c14] >= 0,
      f,
      p;
    h ? (f = sh(n), p = oh(n, a)) : (f = oh(n, a), p = sh(n));
    var g = c0(f, s, r, o0) ? l0(f, t, e, r) : null;
    if (g) {
      var x = g.point[_c14];
      if (h ? x <= s[p + _u24] : x >= s[p + _u24 + 3]) return g;
    }
    var v = c0(p, s, r, o0) ? l0(p, t, e, r) : null;
    return g && v ? g.distance <= v.distance ? g : v : g || v || null;
  }
}
var oO = function () {
    var n,
      t,
      e = [],
      r = new ih(function () {
        return new Bt();
      });
    return function () {
      n = r.getPrimitive(), t = r.getPrimitive(), e.push(n, t);
      var a = i.apply(void 0, arguments);
      r.releasePrimitive(n), r.releasePrimitive(t), e.pop(), e.pop();
      var l = e.length;
      return l > 0 && (t = e[l - 1], n = e[l - 2]), a;
    };
    function i(s, o, a, l) {
      var u = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
      var c = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
      var d = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 0;
      function h(x) {
        var S = x * 2,
          w = El,
          A = Tl;
        for (; !Ea(S, w);) x = sh(x), S = x * 2;
        return Ic(x, A);
      }
      function f(x) {
        var S = x * 2,
          w = El,
          A = Tl;
        for (; !Ea(S, w);) x = oh(x, A), S = x * 2;
        return Ic(x, A) + nh(S, w);
      }
      var p = s * 2,
        m = lh,
        g = El,
        y = Tl;
      if (Ea(p, g)) {
        var x = Ic(s, y),
          S = nh(p, g);
        return hs(s, m, n), l(x, S, !1, d, c + s, n);
      } else {
        var _x22 = sh(s),
          _S22 = oh(s, y),
          w = _x22,
          A = _S22,
          E,
          b,
          T,
          M;
        if (u && (T = n, M = t, hs(w, m, T), hs(A, m, M), E = u(T), b = u(M), b < E)) {
          w = _S22, A = _x22;
          var B = E;
          E = b, b = B, T = M;
        }
        T || (T = n, hs(w, m, T));
        var C = Ea(w * 2, g),
          P = a(T, C, E, d + 1, c + w),
          D;
        if (P === 2) {
          var _B5 = h(w),
            U = f(w) - _B5;
          D = l(_B5, U, !0, d + 1, c + w, T);
        } else D = P && i(w, o, a, l, u, c, d + 1);
        if (D) return !0;
        M = t, hs(A, m, M);
        var O = Ea(A * 2, g),
          I = a(M, O, b, d + 1, c + A),
          z;
        if (I === 2) {
          var _B6 = h(A),
            _U4 = f(A) - _B6;
          z = l(_B6, _U4, !0, d + 1, c + A, M);
        } else z = I && i(A, o, a, l, u, c, d + 1);
        return !!z;
      }
    }
  }(),
  aO = function () {
    var n = new Cn(),
      t = new Cn(),
      e = new te(),
      r = new Pn(),
      i = new Pn();
    return function s(o, a, l, u) {
      var c = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null;
      var d = o * 2,
        h = lh,
        f = El,
        p = Tl;
      if (c === null && (l.boundingBox || l.computeBoundingBox(), r.set(l.boundingBox.min, l.boundingBox.max, u), c = r), Ea(d, f)) {
        var g = a,
          y = g.index,
          v = g.attributes.position,
          x = l.index,
          S = l.attributes.position,
          w = Ic(o, p),
          A = nh(d, f);
        if (e.copy(u).invert(), l.boundsTree) return hs(o, h, i), i.matrix.copy(e), i.needsUpdate = !0, l.boundsTree.shapecast({
          intersectsBounds: function intersectsBounds(b) {
            return i.intersectsBox(b);
          },
          intersectsTriangle: function intersectsTriangle(b) {
            b.a.applyMatrix4(u), b.b.applyMatrix4(u), b.c.applyMatrix4(u), b.needsUpdate = !0;
            for (var T = w * 3, M = (A + w) * 3; T < M; T += 3) if (fs(t, T, y, v), t.needsUpdate = !0, b.intersectsTriangle(t)) return !0;
            return !1;
          }
        });
        for (var E = w * 3, b = A + w * 3; E < b; E += 3) {
          fs(n, E, y, v), n.a.applyMatrix4(e), n.b.applyMatrix4(e), n.c.applyMatrix4(e), n.needsUpdate = !0;
          for (var T = 0, M = x.count; T < M; T += 3) if (fs(t, T, x, S), t.needsUpdate = !0, n.intersectsTriangle(t)) return !0;
        }
      } else {
        var _g21 = o + 8,
          _y24 = p[o + 6];
        return hs(_g21, h, ah), !!(c.intersectsBox(ah) && s(_g21, a, l, u, c) || (hs(_y24, h, ah), c.intersectsBox(ah) && s(_y24, a, l, u, c)));
      }
    };
  }();
function c0(n, t, e, r) {
  return hs(n, t, ah), e.intersectBox(ah, r);
}
var O1 = [],
  s0,
  lh,
  El,
  Tl;
function ch(n) {
  s0 && O1.push(s0), s0 = n, lh = new Float32Array(n), El = new Uint16Array(n), Tl = new Uint32Array(n);
}
function Zp() {
  s0 = null, lh = null, El = null, Tl = null, O1.length && ch(O1.pop());
}
var I1 = Symbol("skip tree generation"),
  R1 = new Bt(),
  L1 = new Bt(),
  uh = new te(),
  Rc = new Pn(),
  Jp = new Pn(),
  $p = new _(),
  u0 = new _(),
  w9 = new _(),
  A9 = new _(),
  _9 = new _(),
  lO = new Bt(),
  _o = new ih(function () {
    return new Cn();
  }),
  Eo = /*#__PURE__*/function () {
    function Eo(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      _classCallCheck(this, Eo);
      if (t.isBufferGeometry) {
        if (t.index && t.index.isInterleavedBufferAttribute) throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");
      } else throw new Error("MeshBVH: Only BufferGeometries are supported.");
      if (e = Object.assign(_defineProperty({
        strategy: 0,
        maxDepth: 40,
        maxLeafTris: 10,
        verbose: !0,
        useSharedArrayBuffer: !1,
        setBoundingBox: !0,
        onProgress: null
      }, I1, !1), e), e.useSharedArrayBuffer && (typeof SharedArrayBuffer === "undefined" ? "undefined" : _typeof(SharedArrayBuffer)) > "u") throw new Error("MeshBVH: SharedArrayBuffer is not available.");
      this._roots = null, e[I1] || (this._roots = JD(t, e), !t.boundingBox && e.setBoundingBox && (t.boundingBox = this.getBoundingBox(new Bt()))), this.geometry = t;
    }
    _createClass(Eo, [{
      key: "refit",
      value: function refit() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
        t && Array.isArray(t) && (t = new Set(t));
        var e = this.geometry,
          r = e.index.array,
          i = e.attributes.position,
          s,
          o,
          a,
          l,
          u = 0,
          c = this._roots;
        for (var h = 0, f = c.length; h < f; h++) s = c[h], o = new Uint32Array(s), a = new Uint16Array(s), l = new Float32Array(s), d(0, u), u += s.byteLength;
        function d(h, f) {
          var p = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
          var m = h * 2;
          if (a[m + 15] === 65535) {
            var y = o[h + 6],
              v = a[m + 14],
              x = 1 / 0,
              S = 1 / 0,
              w = 1 / 0,
              A = -1 / 0,
              E = -1 / 0,
              b = -1 / 0;
            for (var T = 3 * y, M = 3 * (y + v); T < M; T++) {
              var C = r[T],
                P = i.getX(C),
                D = i.getY(C),
                O = i.getZ(C);
              P < x && (x = P), P > A && (A = P), D < S && (S = D), D > E && (E = D), O < w && (w = O), O > b && (b = O);
            }
            return l[h + 0] !== x || l[h + 1] !== S || l[h + 2] !== w || l[h + 3] !== A || l[h + 4] !== E || l[h + 5] !== b ? (l[h + 0] = x, l[h + 1] = S, l[h + 2] = w, l[h + 3] = A, l[h + 4] = E, l[h + 5] = b, !0) : !1;
          } else {
            var _y25 = h + 8,
              _v22 = o[h + 6],
              _x23 = _y25 + f,
              _S23 = _v22 + f,
              _w21 = p,
              _A18 = !1,
              _E16 = !1;
            t ? _w21 || (_A18 = t.has(_x23), _E16 = t.has(_S23), _w21 = !_A18 && !_E16) : (_A18 = !0, _E16 = !0);
            var _b13 = _w21 || _A18,
              _T8 = _w21 || _E16,
              _M11 = !1;
            _b13 && (_M11 = d(_y25, f, _w21));
            var _C11 = !1;
            _T8 && (_C11 = d(_v22, f, _w21));
            var _P14 = _M11 || _C11;
            if (_P14) for (var _D8 = 0; _D8 < 3; _D8++) {
              var _O16 = _y25 + _D8,
                I = _v22 + _D8,
                z = l[_O16],
                B = l[_O16 + 3],
                V = l[I],
                U = l[I + 3];
              l[h + _D8] = z < V ? z : V, l[h + _D8 + 3] = B > U ? B : U;
            }
            return _P14;
          }
        }
      }
    }, {
      key: "traverse",
      value: function traverse(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = this._roots[e],
          i = new Uint32Array(r),
          s = new Uint16Array(r);
        o(0);
        function o(a) {
          var l = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          var u = a * 2,
            c = s[u + 15] === 65535;
          if (c) {
            var d = i[a + 6],
              h = s[u + 14];
            t(l, c, new Float32Array(r, a * 4, 6), d, h);
          } else {
            var _d29 = a + 32 / 4,
              _h32 = i[a + 6],
              f = i[a + 7];
            t(l, c, new Float32Array(r, a * 4, 6), f) || (o(_d29, l + 1), o(_h32, l + 1));
          }
        }
      }
    }, {
      key: "raycast",
      value: function raycast(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : jn;
        var r = this._roots,
          i = this.geometry,
          s = [],
          o = e.isMaterial,
          a = Array.isArray(e),
          l = i.groups,
          u = o ? e.side : e;
        for (var c = 0, d = r.length; c < d; c++) {
          var h = a ? e[l[c].materialIndex].side : u,
            f = s.length;
          if (ch(r[c]), a0(0, i, h, t, s), Zp(), a) {
            var p = l[c].materialIndex;
            for (var m = f, g = s.length; m < g; m++) s[m].face.materialIndex = p;
          }
        }
        return s;
      }
    }, {
      key: "raycastFirst",
      value: function raycastFirst(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : jn;
        var r = this._roots,
          i = this.geometry,
          s = e.isMaterial,
          o = Array.isArray(e),
          a = null,
          l = i.groups,
          u = s ? e.side : e;
        for (var c = 0, d = r.length; c < d; c++) {
          var h = o ? e[l[c].materialIndex].side : u;
          ch(r[c]);
          var f = l0(0, i, h, t);
          Zp(), f != null && (a == null || f.distance < a.distance) && (a = f, o && (f.face.materialIndex = l[c].materialIndex));
        }
        return a;
      }
    }, {
      key: "intersectsGeometry",
      value: function intersectsGeometry(t, e) {
        var r = this.geometry,
          i = !1;
        var _iterator38 = _createForOfIteratorHelper(this._roots),
          _step38;
        try {
          for (_iterator38.s(); !(_step38 = _iterator38.n()).done;) {
            var s = _step38.value;
            if (ch(s), i = aO(0, r, t, e), Zp(), i) break;
          }
        } catch (err) {
          _iterator38.e(err);
        } finally {
          _iterator38.f();
        }
        return i;
      }
    }, {
      key: "shapecast",
      value: function shapecast(t, e, r) {
        var i = this.geometry;
        if (t instanceof Function) {
          if (e) {
            var h = e;
            e = function e(f, p, m, g) {
              var y = p * 3;
              return h(f, y, y + 1, y + 2, m, g);
            };
          }
          t = {
            boundsTraverseOrder: r,
            intersectsBounds: t,
            intersectsTriangle: e,
            intersectsRange: null
          }, console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.");
        }
        var s = _o.getPrimitive(),
          _t24 = t,
          o = _t24.boundsTraverseOrder,
          a = _t24.intersectsBounds,
          l = _t24.intersectsRange,
          u = _t24.intersectsTriangle;
        if (l && u) {
          var _h33 = l;
          l = function l(f, p, m, g, y) {
            return _h33(f, p, m, g, y) ? !0 : D1(f, p, i, u, m, g, s);
          };
        } else l || (u ? l = function l(h, f, p, m) {
          return D1(h, f, i, u, p, m, s);
        } : l = function l(h, f, p) {
          return p;
        });
        var c = !1,
          d = 0;
        var _iterator39 = _createForOfIteratorHelper(this._roots),
          _step39;
        try {
          for (_iterator39.s(); !(_step39 = _iterator39.n()).done;) {
            var _h34 = _step39.value;
            if (ch(_h34), c = oO(0, i, a, l, o, d), Zp(), c) break;
            d += _h34.byteLength;
          }
        } catch (err) {
          _iterator39.e(err);
        } finally {
          _iterator39.f();
        }
        return _o.releasePrimitive(s), c;
      }
    }, {
      key: "bvhcast",
      value: function bvhcast(t, e, r) {
        var i = r.intersectsRanges,
          s = r.intersectsTriangles,
          o = this.geometry.index,
          a = this.geometry.attributes.position,
          l = t.geometry.index,
          u = t.geometry.attributes.position;
        uh.copy(e).invert();
        var c = _o.getPrimitive(),
          d = _o.getPrimitive();
        if (s) {
          var f = function f(p, m, g, y, v, x, S, w) {
            for (var A = g, E = g + y; A < E; A++) {
              fs(d, A * 3, l, u), d.a.applyMatrix4(e), d.b.applyMatrix4(e), d.c.applyMatrix4(e), d.needsUpdate = !0;
              for (var b = p, T = p + m; b < T; b++) if (fs(c, b * 3, o, a), c.needsUpdate = !0, s(c, d, b, A, v, x, S, w)) return !0;
            }
            return !1;
          };
          if (i) {
            var p = i;
            i = function i(m, g, y, v, x, S, w, A) {
              return p(m, g, y, v, x, S, w, A) ? !0 : f(m, g, y, v, x, S, w, A);
            };
          } else i = f;
        }
        t.getBoundingBox(L1), L1.applyMatrix4(e);
        var h = this.shapecast({
          intersectsBounds: function intersectsBounds(f) {
            return L1.intersectsBox(f);
          },
          intersectsRange: function intersectsRange(f, p, m, g, y, v) {
            return R1.copy(v), R1.applyMatrix4(uh), t.shapecast({
              intersectsBounds: function intersectsBounds(x) {
                return R1.intersectsBox(x);
              },
              intersectsRange: function intersectsRange(x, S, w, A, E) {
                return i(f, p, x, S, g, y, A, E);
              }
            });
          }
        });
        return _o.releasePrimitive(c), _o.releasePrimitive(d), h;
      }
    }, {
      key: "intersectsBox",
      value: function intersectsBox(t, e) {
        return Rc.set(t.min, t.max, e), Rc.needsUpdate = !0, this.shapecast({
          intersectsBounds: function intersectsBounds(r) {
            return Rc.intersectsBox(r);
          },
          intersectsTriangle: function intersectsTriangle(r) {
            return Rc.intersectsTriangle(r);
          }
        });
      }
    }, {
      key: "intersectsSphere",
      value: function intersectsSphere(t) {
        return this.shapecast({
          intersectsBounds: function intersectsBounds(e) {
            return t.intersectsBox(e);
          },
          intersectsTriangle: function intersectsTriangle(e) {
            return e.intersectsSphere(t);
          }
        });
      }
    }, {
      key: "closestPointToGeometry",
      value: function closestPointToGeometry(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1 / 0;
        t.boundingBox || t.computeBoundingBox(), Rc.set(t.boundingBox.min, t.boundingBox.max, e), Rc.needsUpdate = !0;
        var a = this.geometry,
          l = a.attributes.position,
          u = a.index,
          c = t.attributes.position,
          d = t.index,
          h = _o.getPrimitive(),
          f = _o.getPrimitive(),
          p = u0,
          m = w9,
          g = null,
          y = null;
        i && (g = A9, y = _9);
        var v = 1 / 0,
          x = null,
          S = null;
        return uh.copy(e).invert(), Jp.matrix.copy(uh), this.shapecast({
          boundsTraverseOrder: function boundsTraverseOrder(w) {
            return Rc.distanceToBox(w);
          },
          intersectsBounds: function intersectsBounds(w, A, E) {
            return E < v && E < o ? (A && (Jp.min.copy(w.min), Jp.max.copy(w.max), Jp.needsUpdate = !0), !0) : !1;
          },
          intersectsRange: function intersectsRange(w, A) {
            if (t.boundsTree) return t.boundsTree.shapecast({
              boundsTraverseOrder: function boundsTraverseOrder(E) {
                return Jp.distanceToBox(E);
              },
              intersectsBounds: function intersectsBounds(E, b, T) {
                return T < v && T < o;
              },
              intersectsRange: function intersectsRange(E, b) {
                for (var T = E * 3, M = (E + b) * 3; T < M; T += 3) {
                  fs(f, T, d, c), f.a.applyMatrix4(e), f.b.applyMatrix4(e), f.c.applyMatrix4(e), f.needsUpdate = !0;
                  for (var C = w * 3, P = (w + A) * 3; C < P; C += 3) {
                    fs(h, C, u, l), h.needsUpdate = !0;
                    var D = h.distanceToTriangle(f, p, g);
                    if (D < v && (m.copy(p), y && y.copy(g), v = D, x = C / 3, S = T / 3), D < s) return !0;
                  }
                }
              }
            });
            {
              var E = d ? d.count : c.count;
              for (var b = 0, T = E; b < T; b += 3) {
                fs(f, b, d, c), f.a.applyMatrix4(e), f.b.applyMatrix4(e), f.c.applyMatrix4(e), f.needsUpdate = !0;
                for (var M = w * 3, C = (w + A) * 3; M < C; M += 3) {
                  fs(h, M, u, l), h.needsUpdate = !0;
                  var P = h.distanceToTriangle(f, p, g);
                  if (P < v && (m.copy(p), y && y.copy(g), v = P, x = M / 3, S = b / 3), P < s) return !0;
                }
              }
            }
          }
        }), _o.releasePrimitive(h), _o.releasePrimitive(f), v === 1 / 0 ? null : (r.point ? r.point.copy(m) : r.point = m.clone(), r.distance = v, r.faceIndex = x, i && (i.point ? i.point.copy(y) : i.point = y.clone(), i.point.applyMatrix4(uh), m.applyMatrix4(uh), i.distance = m.sub(i.point).length(), i.faceIndex = S), r);
      }
    }, {
      key: "closestPointToPoint",
      value: function closestPointToPoint(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1 / 0;
        var s = r * r,
          o = i * i,
          a = 1 / 0,
          l = null;
        if (this.shapecast({
          boundsTraverseOrder: function boundsTraverseOrder(c) {
            return $p.copy(t).clamp(c.min, c.max), $p.distanceToSquared(t);
          },
          intersectsBounds: function intersectsBounds(c, d, h) {
            return h < a && h < o;
          },
          intersectsTriangle: function intersectsTriangle(c, d) {
            c.closestPointToPoint(t, $p);
            var h = t.distanceToSquared($p);
            return h < a && (u0.copy($p), a = h, l = d), h < s;
          }
        }), a === 1 / 0) return null;
        var u = Math.sqrt(a);
        return e.point ? e.point.copy(u0) : e.point = u0.clone(), e.distance = u, e.faceIndex = l, e;
      }
    }, {
      key: "getBoundingBox",
      value: function getBoundingBox(t) {
        return t.makeEmpty(), this._roots.forEach(function (r) {
          hs(0, new Float32Array(r), lO), t.union(lO);
        }), t;
      }
    }], [{
      key: "serialize",
      value: function serialize(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
        if (e.isBufferGeometry) return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."), Eo.serialize(arguments[0], {
          cloneBuffers: arguments[2] === void 0 ? !0 : arguments[2]
        });
        e = _objectSpread({
          cloneBuffers: !0
        }, e);
        var r = t.geometry,
          i = t._roots,
          s = r.getIndex(),
          o;
        return e.cloneBuffers ? o = {
          roots: i.map(function (a) {
            return a.slice();
          }),
          index: s.array.slice()
        } : o = {
          roots: i,
          index: s.array
        }, o;
      }
    }, {
      key: "deserialize",
      value: function deserialize(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
        if (typeof r == "boolean") return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."), Eo.deserialize(arguments[0], arguments[1], {
          setIndex: arguments[2] === void 0 ? !0 : arguments[2]
        });
        r = _objectSpread({
          setIndex: !0
        }, r);
        var i = t.index,
          s = t.roots,
          o = new Eo(e, _objectSpread(_objectSpread({}, r), {}, _defineProperty({}, I1, !0)));
        if (o._roots = s, r.setIndex) {
          var a = e.getIndex();
          if (a === null) {
            var l = new Ge(t.index, 1, !1);
            e.setIndex(l);
          } else a.array !== i && (a.array.set(i), a.needsUpdate = !0);
        }
        return o;
      }
    }]);
    return Eo;
  }();
var rf = Pi(uO());
var E9 = .5 * (Math.sqrt(3) - 1),
  em = (3 - Math.sqrt(3)) / 6,
  T9 = 1 / 3,
  To = 1 / 6,
  Npe = (Math.sqrt(5) - 1) / 4,
  Fpe = (5 - Math.sqrt(5)) / 20,
  tm = function tm(n) {
    return Math.floor(n) | 0;
  },
  dO = new Float64Array([1, 1, -1, 1, 1, -1, -1, -1, 1, 0, -1, 0, 1, 0, -1, 0, 0, 1, 0, -1, 0, 1, 0, -1]),
  N1 = new Float64Array([1, 1, 0, -1, 1, 0, 1, -1, 0, -1, -1, 0, 1, 0, 1, -1, 0, 1, 1, 0, -1, -1, 0, -1, 0, 1, 1, 0, -1, 1, 0, 1, -1, 0, -1, -1]);
function d0() {
  var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Math.random;
  var t = fO(n),
    e = new Float64Array(t).map(function (i) {
      return dO[i % 12 * 2];
    }),
    r = new Float64Array(t).map(function (i) {
      return dO[i % 12 * 2 + 1];
    });
  return function (s, o) {
    var a = 0,
      l = 0,
      u = 0,
      c = (s + o) * E9,
      d = tm(s + c),
      h = tm(o + c),
      f = (d + h) * em,
      p = d - f,
      m = h - f,
      g = s - p,
      y = o - m,
      v,
      x;
    g > y ? (v = 1, x = 0) : (v = 0, x = 1);
    var S = g - v + em,
      w = y - x + em,
      A = g - 1 + 2 * em,
      E = y - 1 + 2 * em,
      b = d & 255,
      T = h & 255,
      M = .5 - g * g - y * y;
    if (M >= 0) {
      var D = b + t[T],
        O = e[D],
        I = r[D];
      M *= M, a = M * M * (O * g + I * y);
    }
    var C = .5 - S * S - w * w;
    if (C >= 0) {
      var _D9 = b + v + t[T + x],
        _O17 = e[_D9],
        _I6 = r[_D9];
      C *= C, l = C * C * (_O17 * S + _I6 * w);
    }
    var P = .5 - A * A - E * E;
    if (P >= 0) {
      var _D10 = b + 1 + t[T + 1],
        _O18 = e[_D10],
        _I7 = r[_D10];
      P *= P, u = P * P * (_O18 * A + _I7 * E);
    }
    return 70 * (a + l + u);
  };
}
function hO() {
  var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Math.random;
  var t = fO(n),
    e = new Float64Array(t).map(function (s) {
      return N1[s % 12 * 3];
    }),
    r = new Float64Array(t).map(function (s) {
      return N1[s % 12 * 3 + 1];
    }),
    i = new Float64Array(t).map(function (s) {
      return N1[s % 12 * 3 + 2];
    });
  return function (o, a, l) {
    var u,
      c,
      d,
      h,
      f = (o + a + l) * T9,
      p = tm(o + f),
      m = tm(a + f),
      g = tm(l + f),
      y = (p + m + g) * To,
      v = p - y,
      x = m - y,
      S = g - y,
      w = o - v,
      A = a - x,
      E = l - S,
      b,
      T,
      M,
      C,
      P,
      D;
    w >= A ? A >= E ? (b = 1, T = 0, M = 0, C = 1, P = 1, D = 0) : w >= E ? (b = 1, T = 0, M = 0, C = 1, P = 0, D = 1) : (b = 0, T = 0, M = 1, C = 1, P = 0, D = 1) : A < E ? (b = 0, T = 0, M = 1, C = 0, P = 1, D = 1) : w < E ? (b = 0, T = 1, M = 0, C = 0, P = 1, D = 1) : (b = 0, T = 1, M = 0, C = 1, P = 1, D = 0);
    var O = w - b + To,
      I = A - T + To,
      z = E - M + To,
      B = w - C + 2 * To,
      V = A - P + 2 * To,
      U = E - D + 2 * To,
      j = w - 1 + 3 * To,
      W = A - 1 + 3 * To,
      k = E - 1 + 3 * To,
      H = p & 255,
      X = m & 255,
      q = g & 255,
      G = .6 - w * w - A * A - E * E;
    if (G < 0) u = 0;else {
      var Y = H + t[X + t[q]];
      G *= G, u = G * G * (e[Y] * w + r[Y] * A + i[Y] * E);
    }
    var J = .6 - O * O - I * I - z * z;
    if (J < 0) c = 0;else {
      var _Y5 = H + b + t[X + T + t[q + M]];
      J *= J, c = J * J * (e[_Y5] * O + r[_Y5] * I + i[_Y5] * z);
    }
    var Z = .6 - B * B - V * V - U * U;
    if (Z < 0) d = 0;else {
      var _Y6 = H + C + t[X + P + t[q + D]];
      Z *= Z, d = Z * Z * (e[_Y6] * B + r[_Y6] * V + i[_Y6] * U);
    }
    var K = .6 - j * j - W * W - k * k;
    if (K < 0) h = 0;else {
      var _Y7 = H + 1 + t[X + 1 + t[q + 1]];
      K *= K, h = K * K * (e[_Y7] * j + r[_Y7] * W + i[_Y7] * k);
    }
    return 32 * (u + c + d + h);
  };
}
function fO(n) {
  var e = new Uint8Array(512);
  for (var r = 0; r < 512 / 2; r++) e[r] = r;
  for (var _r15 = 0; _r15 < 512 / 2 - 1; _r15++) {
    var i = _r15 + ~~(n() * (256 - _r15)),
      s = e[_r15];
    e[_r15] = e[i], e[i] = s;
  }
  for (var _r16 = 256; _r16 < 512; _r16++) e[_r16] = e[_r16 - 256];
  return e;
}
var Us = new vr(),
  h0 = /*#__PURE__*/function () {
    function h0(t) {
      _classCallCheck(this, h0);
      this.weightAttribute = null;
      var e = t.geometry;
      if (!e.isBufferGeometry || e.attributes.position.itemSize !== 3) throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");
      e.index && (e = e.toNonIndexed()), this.geometry = e, this.randomFunction = Math.random, this.positionAttribute = this.geometry.getAttribute("position"), this.distribution = null;
    }
    _createClass(h0, [{
      key: "build",
      value: function build() {
        var t = this.positionAttribute,
          e = new Float32Array(t.count / 3);
        for (var i = 0; i < t.count; i += 3) {
          var s = 1;
          Us.a.fromBufferAttribute(t, i), Us.b.fromBufferAttribute(t, i + 1), Us.c.fromBufferAttribute(t, i + 2), s *= Us.getArea(), e[i / 3] = s;
        }
        this.distribution = new Float32Array(t.count / 3);
        var r = 0;
        for (var _i39 = 0; _i39 < e.length; _i39++) r += e[_i39], this.distribution[_i39] = r;
        return this;
      }
    }, {
      key: "setRandomGenerator",
      value: function setRandomGenerator(t) {
        return this.randomFunction = t, this;
      }
    }, {
      key: "sample",
      value: function sample(t, e) {
        if (this.distribution) {
          var r = this.distribution[this.distribution.length - 1],
            i = this.binarySearch(this.randomFunction() * r);
          return this.sampleFace(i, t, e);
        }
      }
    }, {
      key: "binarySearch",
      value: function binarySearch(t) {
        if (!this.distribution) return 0;
        var e = this.distribution,
          r = 0,
          i = e.length - 1,
          s = -1;
        for (; r <= i;) {
          var o = Math.ceil((r + i) / 2);
          if (o === 0 || e[o - 1] <= t && e[o] > t) {
            s = o;
            break;
          } else t < e[o] ? i = o - 1 : r = o + 1;
        }
        return s;
      }
    }, {
      key: "sampleFace",
      value: function sampleFace(t, e, r) {
        var i = this.randomFunction(),
          s = this.randomFunction();
        return i + s > 1 && (i = 1 - i, s = 1 - s), Us.a.fromBufferAttribute(this.positionAttribute, t * 3), Us.b.fromBufferAttribute(this.positionAttribute, t * 3 + 1), Us.c.fromBufferAttribute(this.positionAttribute, t * 3 + 2), e.set(0, 0, 0).addScaledVector(Us.a, i).addScaledVector(Us.b, s).addScaledVector(Us.c, 1 - (i + s)), Us.getNormal(r), this;
      }
    }]);
    return h0;
  }();
var mO = Pi(F1()),
  M9 = new te(),
  C9 = new te(),
  P9 = new te(),
  dh;
(function (t) {
  function n(e) {
    return e && e.__isSPEObject;
  }
  t.is = n;
})(dh || (dh = {}));
var hh = function hh(n) {
  return /*#__PURE__*/function (_n4) {
    _inherits(_class, _n4);
    var _super111 = _createSuper(_class);
    function _class() {
      var _this95;
      _classCallCheck(this, _class);
      _this95 = _super111.apply(this, arguments);
      _this95.previousModelViewMatrix = new te();
      _this95.copyPreviousMatrix = !0;
      _this95.hiddenMatrix = new te();
      _this95.matrixWorldRigid = new te();
      _this95.shearScale = new te();
      _this95.shearScaleInv = new te();
      return _this95;
    }
    _createClass(_class, [{
      key: "__isSPEObject",
      get: function get() {
        return !0;
      }
    }, {
      key: "isDescendantOf",
      value: function isDescendantOf(r) {
        r instanceof mt && (r = r.uuid);
        var i = this;
        for (; i.parent;) {
          if (i.parent.uuid === r) return !0;
          i = i.parent;
        }
        return !1;
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(r) {
        this.matrixAutoUpdate && this.updateMatrix(), (this.matrixWorldNeedsUpdate || r) && (this.parent === null ? this.matrixWorld.multiplyMatrices(this.hiddenMatrix, this.matrix) : (this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.hiddenMatrix), this.matrixWorld.multiplyMatrices(this.matrixWorld, this.matrix)), this.matrixWorldNeedsUpdate = !1, r = !0);
        var _iterator40 = _createForOfIteratorHelper(this.children),
          _step40;
        try {
          for (_iterator40.s(); !(_step40 = _iterator40.n()).done;) {
            var i = _step40.value;
            i.updateMatrixWorld(r);
          }
        } catch (err) {
          _iterator40.e(err);
        } finally {
          _iterator40.f();
        }
      }
    }, {
      key: "updateWorldMatrix",
      value: function updateWorldMatrix(r, i) {
        var s = this.parent;
        if (r && s !== null && s.updateWorldMatrix(!0, !1), this.matrixAutoUpdate && this.updateMatrix(), this.parent === null ? this.matrixWorld.multiplyMatrices(this.hiddenMatrix, this.matrix) : (this.matrixWorld.multiplyMatrices(this.parent.matrixWorld, this.hiddenMatrix), this.matrixWorld.multiplyMatrices(this.matrixWorld, this.matrix)), i) {
          var _iterator41 = _createForOfIteratorHelper(this.children),
            _step41;
          try {
            for (_iterator41.s(); !(_step41 = _iterator41.n()).done;) {
              var o = _step41.value;
              o.updateWorldMatrix(!1, !0);
            }
          } catch (err) {
            _iterator41.e(err);
          } finally {
            _iterator41.f();
          }
        }
      }
    }, {
      key: "traverseChildren",
      value: function traverseChildren(r) {
        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var _iterator42 = _createForOfIteratorHelper(this.children),
          _step42;
        try {
          for (_iterator42.s(); !(_step42 = _iterator42.n()).done;) {
            var s = _step42.value;
            dh.is(s) && s.traverseObject(r, i + 1);
          }
        } catch (err) {
          _iterator42.e(err);
        } finally {
          _iterator42.f();
        }
      }
    }, {
      key: "traverseObject",
      value: function traverseObject(r) {
        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        if (r(this, i) !== !0) {
          var _iterator43 = _createForOfIteratorHelper(this.children),
            _step43;
          try {
            for (_iterator43.s(); !(_step43 = _iterator43.n()).done;) {
              var o = _step43.value;
              dh.is(o) && o.traverseObject(r, i + 1);
            }
          } catch (err) {
            _iterator43.e(err);
          } finally {
            _iterator43.f();
          }
        }
      }
    }, {
      key: "updateMatrixWorldSVD",
      value: function updateMatrixWorldSVD() {
        var r = this.matrixWorld.elements,
          i = [[r[0], r[4], r[8]], [r[1], r[5], r[9]], [r[2], r[6], r[10]]],
          _ref13 = (0, mO.SVD)(i),
          s = _ref13.u,
          o = _ref13.v,
          a = _ref13.q,
          l = M9.set(s[0][0], s[0][1], s[0][2], 0, s[1][0], s[1][1], s[1][2], 0, s[2][0], s[2][1], s[2][2], 0, 0, 0, 0, 1),
          u = C9.set(o[0][0], o[0][1], o[0][2], 0, o[1][0], o[1][1], o[1][2], 0, o[2][0], o[2][1], o[2][2], 0, 0, 0, 0, 1),
          c = P9.copy(u).transpose();
        this.shearScale.makeScale(a[0], a[1], a[2]).multiply(c).premultiply(u), this.shearScaleInv.copy(this.shearScale).invert(), this.matrixWorldRigid.multiplyMatrices(l, c).copyPosition(this.matrixWorld), a.every(function (d) {
          return Math.abs(a[0] - d) < .01;
        }) ? this.hasNonUniformScale = !1 : this.hasNonUniformScale = !0;
      }
    }, {
      key: "attach",
      value: function attach(r, i) {
        this.updateWorldMatrix(!0, !1);
        var s = new te().copy(this.matrixWorld).invert();
        return r.parent !== null && (r.parent.updateWorldMatrix(!0, !1), s.multiply(r.parent.matrixWorld)), "hiddenMatrix" in r && r.hiddenMatrix instanceof te ? r.hiddenMatrix.premultiply(s) : r.applyMatrix4(s), r.updateWorldMatrix(!1, !1), this.add(r), i !== void 0 && (this.children.pop(), this.children.splice(i, 0, r)), this;
      }
    }, {
      key: "copy",
      value: function copy(r) {
        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        return _get(_getPrototypeOf(_class.prototype), "copy", this).call(this, r, i), this.hasNonUniformScale = r.hasNonUniformScale, this;
      }
    }, {
      key: "onAfterRender",
      value: function onAfterRender(r, i, s, o, a, l) {
        this.copyPreviousMatrix && this.previousModelViewMatrix.copy(this.modelViewMatrix);
      }
    }]);
    return _class;
  }(n);
};
var k1 = /*#__PURE__*/function (_hh) {
    _inherits(k1, _hh);
    var _super112 = _createSuper(k1);
    function k1() {
      _classCallCheck(this, k1);
      return _super112.apply(this, arguments);
    }
    return _createClass(k1);
  }(hh(mt)),
  D9 = function D9(n) {
    return n.type === "Mesh";
  },
  Pr = /*#__PURE__*/function (_k3) {
    _inherits(Pr, _k3);
    var _super113 = _createSuper(Pr);
    function Pr(e) {
      var _this96;
      _classCallCheck(this, Pr);
      _this96 = _super113.call(this);
      _this96.object = e;
      _this96.matrixAutoUpdate = !1, _this96.hasNonUniformScale = e.hasNonUniformScale;
      return _this96;
    }
    _createClass(Pr, [{
      key: "raycast",
      value: function raycast(e, r) {}
    }, {
      key: "expand",
      value: function expand() {
        var e = 0,
          r = this.object.entityChildren(e);
        for (; r;) {
          var _i40;
          var i = this.children[e];
          ((_i40 = i) === null || _i40 === void 0 ? void 0 : _i40.object) !== r && (i && this.remove(i), i = new Pr(r), this.add(i), this.children.splice(e, 0, this.children.pop()), i.matrixWorldNeedsUpdate = !0, i.matrixAutoUpdate = !1, i.matrix = r.matrix, i.hiddenMatrix = r.hiddenMatrix), i.expand(), e += 1, r = this.object.entityChildren(e);
        }
        for (; this.children.length > e;) this.remove(this.children[e]);
      }
    }, {
      key: "visible",
      get: function get() {
        var _this$object$dataPatc;
        return this.playModeVisible !== void 0 ? this.playModeVisible : this.object.visible || this.object.dataPatched.visible && ((_this$object$dataPatc = this.object.dataPatched.cloner) === null || _this$object$dataPatc === void 0 ? void 0 : _this$object$dataPatc.hideBase) === !0;
      },
      set: function set(e) {}
    }, {
      key: "castShadow",
      get: function get() {
        return this.object.castShadow;
      },
      set: function set(e) {}
    }, {
      key: "receiveShadow",
      get: function get() {
        return this.object.receiveShadow;
      },
      set: function set(e) {}
    }, {
      key: "isMesh",
      get: function get() {
        return D9(this.object);
      }
    }, {
      key: "isLight",
      get: function get() {
        return this.object.isLight;
      }
    }, {
      key: "layers",
      get: function get() {
        return this.object.layers;
      },
      set: function set(e) {}
    }, {
      key: "isCamera",
      get: function get() {
        return !1;
      }
    }, {
      key: "geometry",
      get: function get() {
        if (this.object.geometry) return this.object.geometry;
      }
    }, {
      key: "material",
      get: function get() {
        if (this.object.material) return this.object.material;
      }
    }]);
    return Pr;
  }(k1);
var Lc = new _(),
  Bc = new _(),
  fh = new te(),
  yO = [new _(-1, 1, 1), new _(-1, -1, 1), new _(1, -1, 1), new _(1, 1, 1), new _(-1, 1, -1), new _(-1, -1, -1), new _(1, -1, -1), new _(1, 1, -1)],
  O9 = [[0, 3], [1, 2], [5, 6], [4, 7], [0, 1], [3, 2], [7, 6], [4, 5], [0, 4], [1, 5], [2, 6], [3, 7]],
  I9 = [[0, 2], [7, 5], [4, 1], [3, 6], [4, 3], [1, 6]],
  gO = function gO(n, t, e) {
    n.updateEntityBoxSize(Lc, Bc), fh.copy(t).multiply(n.matrixWorld), Bc.x === 0 && Bc.y === 0 && Bc.z === 0 ? e.push(new _(Lc.x, Lc.y, Lc.z).applyMatrix4(fh)) : yO.forEach(function (r) {
      e.push(r.clone().multiply(Bc).add(Lc).applyMatrix4(fh));
    });
  },
  rm = /*#__PURE__*/function (_Bt) {
    _inherits(rm, _Bt);
    var _super114 = _createSuper(rm);
    function rm() {
      var _this97;
      _classCallCheck(this, rm);
      _this97 = _super114.apply(this, arguments);
      _this97.matrix = new te();
      _this97.vertices = [];
      _this97.faces = [];
      _this97.edges = [];
      _this97.centerEdges = [];
      return _this97;
    }
    _createClass(rm, [{
      key: "copy",
      value: function copy(e) {
        return _get(_getPrototypeOf(rm.prototype), "copy", this).call(this, e), this.matrix.copy(e.matrix), this.vertices = e.vertices.map(function (r) {
          return r.clone();
        }), this.faces = e.faces.map(function (r) {
          return r.clone();
        }), this.edges = e.edges.map(function (r) {
          return r.clone();
        }), this.centerEdges = e.centerEdges.map(function (r) {
          return r.clone();
        }), this;
      }
    }, {
      key: "setFromObjectSize",
      value: function setFromObjectSize(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        e.updateWorldMatrix(!1, r), this.makeEmpty(), this.matrix.copy(e.matrixWorld);
        var i = new te().copy(e.matrixWorld).invert();
        return this.expandByObjectSize(e, i, r);
      }
    }, {
      key: "expandByObjectSize",
      value: function expandByObjectSize(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        var s = [];
        return i === !0 ? e.traverseEntity(function (o) {
          if (o.visible || o.cloner && o.data.visible) {
            if (!("geometry" in o)) {
              s.push(new _());
              return;
            }
            gO(o, r, s);
          }
        }) : gO(e, r, s), this.setFromPoints(s);
      }
    }, {
      key: "getCenter",
      value: function getCenter(e) {
        return e = _get(_getPrototypeOf(rm.prototype), "getCenter", this).call(this, e), e.applyMatrix4(this.matrix), e;
      }
    }, {
      key: "getPositionToCenter",
      value: function getPositionToCenter(e) {
        return e = _get(_getPrototypeOf(rm.prototype), "getCenter", this).call(this, e), e.applyMatrix4(fh.copy(this.matrix).setPosition(0, 0, 0)), e;
      }
    }, {
      key: "computeVertices",
      value: function computeVertices() {
        this.getSize(Bc).multiplyScalar(.5), this.getCenter(Lc), fh.copy(this.matrix).setPosition(Lc), this.vertices = yO.map(function (e) {
          return e.clone().multiply(Bc).applyMatrix4(fh);
        });
      }
    }, {
      key: "computeEdges",
      value: function computeEdges() {
        var _this98 = this;
        this.vertices.length > 0 && this.computeVertices(), this.edges = O9.map(function (_ref14) {
          var _ref15 = _slicedToArray(_ref14, 2),
            e = _ref15[0],
            r = _ref15[1];
          return new xi(_this98.vertices[e], _this98.vertices[r]);
        }), this.centerEdges = this.edges.map(function (e) {
          return e.getCenter(new _());
        });
      }
    }, {
      key: "computeFaces",
      value: function computeFaces() {
        var _this99 = this;
        this.vertices.length > 0 && this.computeVertices(), this.faces = I9.map(function (_ref16) {
          var _ref17 = _slicedToArray(_ref16, 2),
            e = _ref17[0],
            r = _ref17[1];
          return _this99.vertices[e].clone().add(_this99.vertices[r]).multiplyScalar(.5);
        });
      }
    }]);
    return rm;
  }(Bt);
var Gs = {
  Cloner: function Cloner() {},
  changeEntityProptotype: function changeEntityProptotype() {},
  createEntity: function createEntity() {}
};
var V1 = /*#__PURE__*/function (_mp2) {
  _inherits(V1, _mp2);
  var _super115 = _createSuper(V1);
  function V1() {
    _classCallCheck(this, V1);
    return _super115.call(this);
  }
  _createClass(V1, [{
    key: "getPoints",
    value: function getPoints() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 12;
      var e = [],
        r,
        i = this.getCurveLengths(),
        o = i[i.length - 1] / i.length;
      for (var a = 0, l = this.curves; a < l.length; a++) {
        var u = l[a],
          c = a === 0 ? i[a] : i[a] - i[a - 1],
          d = Math.ceil(t * c / o),
          h = u.getPoints(d);
        for (var f = 0; f < h.length; f++) {
          var p = h[f];
          r && r.equals(p) || (e.push(p), r = p);
        }
      }
      return this.autoClose && e.length > 1 && !e[e.length - 1].equals(e[0]) && e.push(e[0]), e;
    }
  }]);
  return V1;
}(mp);
var U1 = .001;
function G1(n, t, e) {
  return t.clone().sub(n).cross(t.clone().sub(e)).length() <= U1;
}
function z1(n, t) {
  var e = _construct(_, _toConsumableArray(n.position)),
    r = _construct(_, _toConsumableArray(n.controlNext.position)),
    i = _construct(_, _toConsumableArray(t.controlPrevious.position)),
    s = _construct(_, _toConsumableArray(t.position));
  return G1(e, r, s) && G1(e, i, s);
}
function p0(n) {
  var t = n.points.map(function (c) {
      return _construct(_, _toConsumableArray(c.data.position));
    }),
    e = [n.points[0]],
    r = _construct(_, _toConsumableArray(e[0].data.position));
  for (var c = 0; c < n.points.length - 1; c++) G1(r, t[c], t[c + 1]) || (e.push(n.points[c]), r = t[c]);
  e.push(n.points[n.points.length - 1]);
  var i = n.isClosed,
    s = e.length - (i ? 0 : 1),
    o = e.length,
    a = [];
  for (var _c15 = 0; _c15 < o; _c15++) {
    var d = e[_c15].data,
      h = _construct(_, _toConsumableArray(d.position)),
      f = _construct(_, _toConsumableArray(d.controlPrevious.position)),
      p = _construct(_, _toConsumableArray(d.controlNext.position)),
      m = {
        position: h,
        baseRoundness: d.roundness,
        controlPrevious: f,
        controlNext: p
      };
    if (d.roundness === 0 || !n.isClosed && (_c15 === 0 || _c15 === o - 1)) {
      a[_c15] = _objectSpread(_objectSpread({}, m), {}, {
        removedLength: 0
      });
      continue;
    }
    var g = i && _c15 == 0 ? o - 1 : _c15 - 1,
      y = i && _c15 == o - 1 ? 0 : _c15 + 1,
      v = e[g].data,
      x = e[y].data,
      S = _construct(_, _toConsumableArray(v.position)),
      w = _construct(_, _toConsumableArray(x.position)),
      A = S.clone().sub(h).normalize(),
      E = w.clone().sub(h).normalize();
    Object.assign(m, {
      prevDir: A,
      nextDir: E
    });
    var b = z1(v, d),
      T = z1(d, x);
    if (!b || !T) a[_c15] = _objectSpread(_objectSpread({}, m), {}, {
      removedLength: 0
    });else {
      var M = A.clone().add(E).normalize(),
        C = M.clone().cross(A).length() / A.dot(M);
      a[_c15] = _objectSpread(_objectSpread({}, m), {}, {
        tan: C,
        removedLength: d.roundness / C
      });
    }
  }
  for (var _c16 = 0; _c16 < s; _c16++) {
    var _d30 = _c16,
      _h35 = i && _c16 === o - 1 ? 0 : _c16 + 1,
      _f49 = a[_d30],
      _p32 = a[_h35];
    if (_f49.removedLength !== 0 || _p32.removedLength !== 0) {
      var _m26 = _f49.position.distanceTo(_p32.position);
      _f49.removedLength = Math.min(_f49.removedLength, _m26 / 2), _p32.removedLength = Math.min(_p32.removedLength, _m26 / 2);
    }
  }
  var l = [];
  for (var _c17 = 0; _c17 < s; _c17++) {
    var _d31 = _c17,
      _h36 = i && _c17 === o - 1 ? 0 : _c17 + 1,
      _f50 = a[_d31],
      _p33 = a[_h36],
      _m27 = null;
    if (!z1(e[_d31].data, e[_h36].data)) _f50.position.distanceTo(_p33.position) > U1 && (_m27 = new gc(_f50.position, _f50.controlNext, _p33.controlPrevious, _p33.position));else {
      var _g22 = _f50.position.clone(),
        _y26 = _p33.position.clone();
      (_f50.removedLength !== 0 || _p33.removedLength !== 0) && (_f50.nextDir && _g22.add(_f50.nextDir.clone().setLength(_f50.removedLength)), _p33.prevDir && _y26.add(_p33.prevDir.clone().setLength(_p33.removedLength))), _g22.distanceTo(_y26) > U1 && (_m27 = new gc(_g22, _g22.clone().lerp(_y26, .3), _y26.clone().lerp(_g22, .3), _y26));
    }
    l[2 * _c17 + 1] = _m27;
  }
  for (var _c18 = 0; _c18 < o; _c18++) {
    var _d32 = a[_c18];
    if (_d32.removedLength === 0) {
      l[2 * _c18] = null;
      continue;
    }
    var _h37 = _d32.position,
      _f51 = _d32.prevDir.clone().multiplyScalar(_d32.removedLength).add(_h37),
      _p34 = _d32.nextDir.clone().multiplyScalar(_d32.removedLength).add(_h37),
      _m28 = _d32.tan * _d32.removedLength,
      _g23 = _d32.prevDir.clone().add(_d32.nextDir).normalize(),
      _y27 = _f51.clone().lerp(_p34, .5),
      _v23 = _f51.distanceTo(_p34) / 2,
      _x24 = _g23.clone().multiplyScalar(Math.sqrt(Math.pow(_m28, 2) - Math.pow(_v23, 2))).add(_y27),
      _S24 = _g23.clone().multiplyScalar(-_m28).add(_x24),
      _w22 = _h37.distanceTo(_S24) / _h37.distanceTo(_y27),
      _A19 = _d32.prevDir.clone().multiplyScalar(_w22 * _h37.distanceTo(_f51)).add(_h37),
      _E17 = _A19.clone().lerp(_S24, 2),
      _b14 = _f51.clone().lerp(_A19, 4 / 3),
      _T9 = _p34.clone().lerp(_E17, 4 / 3);
    l[2 * _c18] = new gc(_f51, _b14, _T9, _p34);
  }
  var u = new V1();
  return l.forEach(function (c) {
    c && u.add(c);
  }), u;
}
var ut;
(function (t) {
  function n(e) {
    return e && e.__isEntity;
  }
  t.is = n;
})(ut || (ut = {}));
var Mo = function Mo(n) {
    return ut.is(n);
  },
  R9 = {
    type: "completeState",
    isfromEntity: !0
  },
  L9 = ["x", "y", "z"],
  j1 = new _(),
  B9 = new _().set(0, 1, 0),
  ph = function ph(n) {
    return /*#__PURE__*/function (_hh2) {
      _inherits(_class2, _hh2);
      var _super116 = _createSuper(_class2);
      function _class2() {
        var _this100;
        _classCallCheck(this, _class2);
        _this100 = _super116.apply(this, arguments);
        _this100.raycastLock = !1;
        _this100.scaleLock = !1;
        _this100.disposed = !1;
        _this100.stateSelection = null;
        _this100.destroyedInAction = !1;
        _this100.instances = [];
        _this100.prevState = null;
        _this100.currentState = null;
        _this100.reversibleToState = null;
        _this100.currentTransitionEvent = null;
        _this100.previousAction = null;
        _this100._singleBBox = new rm();
        _this100._recursiveBBox = new rm();
        _this100.singleBBoxNeedsUpdate = !0;
        _this100.recursiveBBoxNeedsUpdate = !0;
        _this100._needApplyPathSnapping = !0;
        _this100.attachedPaths = new Set();
        return _this100;
      }
      _createClass(_class2, [{
        key: "__isEntity",
        get: function get() {
          return !0;
        }
      }, {
        key: "entityChildren",
        value: function entityChildren(r) {
          var i = this.children[r];
          if (ut.is(i)) return i;
        }
      }, {
        key: "entityChildrenCount",
        value: function entityChildrenCount() {
          var r = this.children.length;
          for (; r--;) if (ut.is(this.children[r])) return r + 1;
          return 0;
        }
      }, {
        key: "isConcreteEntity",
        get: function get() {
          return typeof this.identity == "string";
        }
      }, {
        key: "isVirtualEntity",
        get: function get() {
          return typeof this.identity != "string";
        }
      }, {
        key: "isInstanceRoot",
        get: function get() {
          return this.isConcreteEntity && this.data.type === "Instance";
        }
      }, {
        key: "nearestInstanceSelfOrParent",
        value: function nearestInstanceSelfOrParent() {
          var r = this;
          for (; r.data.type !== "Instance";) {
            var i = r.parent;
            if (ut.is(i)) r = i;else return;
          }
          return r;
        }
      }, {
        key: "forInstancesRec",
        value: function forInstancesRec(r) {
          this.instances.forEach(function (i) {
            i.disposed || r(i), i.forInstancesRec(r);
          });
        }
      }, {
        key: "super_Entity",
        value: function super_Entity(r, i) {
          typeof r == "string" && (this.uuid = r), this.identity = r, this.data = i, this.matrixAutoUpdate = !1, this.dataPatched = this.data;
        }
      }, {
        key: "changeSelectedState",
        value: function changeSelectedState(r, i) {
          var _this101 = this;
          var s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
          if (!(this.data.states.length === 0 && !s)) {
            var _iterator44 = _createForOfIteratorHelper(this.data.states),
              _step44;
            try {
              for (_iterator44.s(); !(_step44 = _iterator44.n()).done;) {
                var _o18 = _step44.value;
                ga.toOps(this.data, _o18.data).forEach(function (l) {
                  var u = Rd.replaceProps(l, _this101.data);
                  _this101.dataPatched = _this101.data, _this101.updateByPatchedOp(u, _this101.data, i);
                });
              }
            } catch (err) {
              _iterator44.e(err);
            } finally {
              _iterator44.f();
            }
            if (r !== null) {
              var o = this.data.states.data(r);
              o && (this.dataPatched = ga.patch(this.data, o), ga.toOps(this.data, o).forEach(function (l) {
                _this101.updateByPatchedOp(l, _this101.dataPatched, i);
              }));
            }
            s && this.updateTransformState(this.dataPatched, i), this.stateSelection = r, this.updatePathSnapping(this.dataPatched.pathSnapping);
          }
        }
      }, {
        key: "singleBBox",
        get: function get() {
          return this.singleBBoxNeedsUpdate && (this.singleBBoxNeedsUpdate = !1, this._singleBBox.setFromObjectSize(this, !1), this._singleBBox.computeVertices(), this._singleBBox.computeEdges(), this._singleBBox.computeFaces()), this._singleBBox;
        }
      }, {
        key: "recursiveBBox",
        get: function get() {
          return this.recursiveBBoxNeedsUpdate && (this.recursiveBBoxNeedsUpdate = !1, this._recursiveBBox.setFromObjectSize(this, !0), this._recursiveBBox.computeVertices(), this._recursiveBBox.computeEdges(), this._recursiveBBox.computeFaces()), this._recursiveBBox;
        }
      }, {
        key: "updateEntityBoxSize",
        value: function updateEntityBoxSize(r, i) {
          r.setScalar(0), i.setScalar(0);
        }
      }, {
        key: "resetBBoxNeedsUpdateSelf",
        value: function resetBBoxNeedsUpdateSelf() {
          this.singleBBoxNeedsUpdate = !0, this.recursiveBBoxNeedsUpdate = !0;
        }
      }, {
        key: "resetBBoxNeedsUpdate",
        value: function resetBBoxNeedsUpdate() {
          this.resetBBoxNeedsUpdateSelf(), this.traverseAncestors(function (r) {
            Mo(r) && r.resetBBoxNeedsUpdateSelf();
          }), this.traverseEntity(function (r) {
            r.resetBBoxNeedsUpdateSelf();
          });
        }
      }, {
        key: "find",
        value: function find(r) {
          var i;
          return this.traverseEntity(function (s) {
            s.uuid === r && (i = s);
          }), i;
        }
      }, {
        key: "traverseSortNextHelper",
        value: function traverseSortNextHelper() {
          var r = this.parent;
          if (r) {
            var i = r.children,
              s = i.indexOf(this) + 1;
            if (ut.is(i[s])) return i[s];
            if (ut.is(r)) return r.traverseSortNextHelper();
          }
        }
      }, {
        key: "sortNext",
        value: function sortNext() {
          var r = this.children;
          return this.children.length > 0 && ut.is(this.children[0]) ? r[0] : this.traverseSortNextHelper();
        }
      }, {
        key: "goUp",
        value: function goUp(r) {
          var i = this;
          for (; r > 0 && i !== null;) i = i.parent, r -= 1;
          return i;
        }
      }, {
        key: "hasAnccestorOrSelf",
        value: function hasAnccestorOrSelf(r) {
          return this === r || this.hasAnccestor(r);
        }
      }, {
        key: "hasAnccestor",
        value: function hasAnccestor(r) {
          var i = this.parent;
          for (; i;) {
            if (r === i) return !0;
            i = i.parent;
          }
          return !1;
        }
      }, {
        key: "countToAccestor",
        value: function countToAccestor(r) {
          var i = 0,
            s = this;
          for (; s !== r;) {
            if (s === null) return -1;
            s = s.parent, i += 1;
          }
          return i;
        }
      }, {
        key: "forEachEntity",
        value: function forEachEntity(r) {
          var _iterator45 = _createForOfIteratorHelper(this.children),
            _step45;
          try {
            for (_iterator45.s(); !(_step45 = _iterator45.n()).done;) {
              var i = _step45.value;
              Mo(i) && r(i);
            }
          } catch (err) {
            _iterator45.e(err);
          } finally {
            _iterator45.f();
          }
        }
      }, {
        key: "traverseEntityAncestors",
        value: function traverseEntityAncestors(r) {
          this.traverseAncestors(function (i) {
            ut.is(i) && r(i);
          });
        }
      }, {
        key: "traverseConcreteEntity",
        value: function traverseConcreteEntity(r) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          if (r(this, i) !== !0) {
            var _iterator46 = _createForOfIteratorHelper(this.children),
              _step46;
            try {
              for (_iterator46.s(); !(_step46 = _iterator46.n()).done;) {
                var o = _step46.value;
                Mo(o) && o.isConcreteEntity && o.traverseEntity(r, i + 1);
              }
            } catch (err) {
              _iterator46.e(err);
            } finally {
              _iterator46.f();
            }
          }
        }
      }, {
        key: "traverseEntity",
        value: function traverseEntity(r) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          if (r(this, i) !== !0) {
            var _iterator47 = _createForOfIteratorHelper(this.children),
              _step47;
            try {
              for (_iterator47.s(); !(_step47 = _iterator47.n()).done;) {
                var o = _step47.value;
                Mo(o) && o.traverseEntity(r, i + 1);
              }
            } catch (err) {
              _iterator47.e(err);
            } finally {
              _iterator47.f();
            }
          }
        }
      }, {
        key: "traverseVisibleEntity",
        value: function traverseVisibleEntity(r) {
          r(this);
          var _iterator48 = _createForOfIteratorHelper(this.children),
            _step48;
          try {
            for (_iterator48.s(); !(_step48 = _iterator48.n()).done;) {
              var i = _step48.value;
              Mo(i) && i.visible && i.traverseVisibleEntity(r);
            }
          } catch (err) {
            _iterator48.e(err);
          } finally {
            _iterator48.f();
          }
        }
      }, {
        key: "updateMatrix",
        value: function updateMatrix() {
          _get(_getPrototypeOf(_class2.prototype), "updateMatrix", this).call(this), this.cloner && this.cloner.onObjUpdateMatrix(), this.dispatchEvent({
            type: "updateMatrix"
          });
        }
      }, {
        key: "updateMatrixWorld",
        value: function updateMatrixWorld(r) {
          _get(_getPrototypeOf(_class2.prototype), "updateMatrixWorld", this).call(this, r), this.dispatchEvent({
            type: "updateMatrixWorld"
          });
        }
      }, {
        key: "copy",
        value: function copy(r) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
          return _get(_getPrototypeOf(_class2.prototype), "copy", this).call(this, r, i), this.dataPatched = r.dataPatched, this.raycastLock = r.raycastLock, this.scaleLock = r.scaleLock, this.hiddenMatrix.copy(r.hiddenMatrix), this;
        }
      }, {
        key: "hasEntityChild",
        value: function hasEntityChild() {
          return this.children.some(function (r) {
            return Mo(r);
          });
        }
      }, {
        key: "isAncestorOf",
        value: function isAncestorOf(r) {
          if (this.uuid === r) return !1;
          var i = !1;
          return this.traverseEntity(function (s) {
            s.uuid === r && (i = !0);
          }), i;
        }
      }, {
        key: "toObjectTransformState",
        value: function toObjectTransformState() {
          var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
          this.updateWorldMatrix(!0, !1);
          var i = {
            position: this.position.toArray(),
            rotation: [this.rotation.x * Se.RAD2DEG, this.rotation.y * Se.RAD2DEG, this.rotation.z * Se.RAD2DEG],
            scale: this.scale.toArray(),
            hiddenMatrix: this.hiddenMatrix.toArray()
          };
          return Ed(i, r);
        }
      }, {
        key: "getTransformValues",
        value: function getTransformValues(r, i, s) {
          var _this102 = this;
          return i[r].map(function (o, a) {
            var _s$shared$getVariable;
            return (_s$shared$getVariable = s === null || s === void 0 ? void 0 : s.shared.getVariable(o, [_this102.uuid, r, L9[a]])) !== null && _s$shared$getVariable !== void 0 ? _s$shared$getVariable : o;
          });
        }
      }, {
        key: "updateTransformState",
        value: function updateTransformState(r, i) {
          var _r$hiddenMatrix,
            _this103 = this;
          var s = !1;
          return r.position && (this.position.fromArray(this.getTransformValues("position", r, i)), s = !0), r.rotation && (j1.fromArray(this.getTransformValues("rotation", r, i)).multiplyScalar(Se.DEG2RAD), this.rotation.setFromVector3(j1), s = !0), r.scale && (this.scale.fromArray(this.getTransformValues("scale", r, i)), s = !0), r.hiddenMatrix !== void 0 && (s = !0, this.hiddenMatrix.fromArray((_r$hiddenMatrix = r.hiddenMatrix) !== null && _r$hiddenMatrix !== void 0 ? _r$hiddenMatrix : yl.identity)), s && (this.updateMatrix(), this.resetBBoxNeedsUpdate(), this.invalidateClonerTransform(this), this.traverseEntityAncestors(function (o) {
            o.invalidateClonerTransform(_this103);
          })), r.position && r.rotation && r.scale && r.hiddenMatrix !== void 0 && this.updateWorldMatrix(!1, !0), s;
        }
      }, {
        key: "onVariableUpdate",
        value: function onVariableUpdate() {
          var _this104 = this;
          var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
          if (r) {
            this.resetBBoxNeedsUpdate();
            return;
          }
          this.updateMatrix(), this.resetBBoxNeedsUpdate(), this.invalidateClonerTransform(this), this.traverseEntityAncestors(function (i) {
            i.invalidateClonerTransform(_this104);
          });
        }
      }, {
        key: "dispose",
        value: function dispose() {
          this.disposed = !0, this.cloner && (this.cloner.removeFromParent(), this.cloner = void 0);
        }
      }, {
        key: "disposeChildrenRecursively",
        value: function disposeChildrenRecursively() {
          var _iterator49 = _createForOfIteratorHelper(this.children),
            _step49;
          try {
            for (_iterator49.s(); !(_step49 = _iterator49.n()).done;) {
              var r = _step49.value;
              ut.is(r) && r.disposeRecursively();
            }
          } catch (err) {
            _iterator49.e(err);
          } finally {
            _iterator49.f();
          }
        }
      }, {
        key: "disposeRecursively",
        value: function disposeRecursively() {
          this.dispose(), this.children.forEach(function (r) {
            ut.is(r) && r.disposeRecursively();
          });
        }
      }, {
        key: "toState",
        value: function toState() {
          var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
          var i = _objectSpread({
            name: this.name,
            visible: this.visible,
            raycastLock: this.raycastLock
          }, this.toObjectTransformState(r));
          return Ed(i, r);
        }
      }, {
        key: "updateByObjUpdateOp",
        value: function updateByObjUpdateOp(r, i) {
          r !== void 0 && this.updateByOp({
            type: 0,
            props: r,
            path: []
          }, _objectSpread(_objectSpread({}, this.data), r), i, !1);
        }
      }, {
        key: "updateByOp",
        value: function updateByOp(r, i, s, o) {
          var a = this.data;
          this.data = i;
          var l = r,
            u = wt(r.path, ["states", "*"]);
          if (u !== null) {
            if (r.type === 0) {
              var _u25 = _slicedToArray(u, 1),
                c = _u25[0];
              if ((this === null || this === void 0 ? void 0 : this.stateSelection) === c) {
                var d = _objectSpread({}, r.props);
                if (delete d.name, Object.values(r.props).some(function (h) {
                  return h === void 0;
                })) {
                  var h = this.data;
                  if (h !== void 0) {
                    var f = Tr.zoom(h, r.path.slice(2));
                    if (f) for (var p in r.props) r.props[p] === void 0 && p in f && (d[p] = f[p]);
                  }
                }
                l = _objectSpread(_objectSpread({}, r), {}, {
                  props: d,
                  path: r.path.slice(2)
                });
              }
            }
          } else if (r.type === 0) {
            var _c19 = this.stateSelection ? this.data.states.data(this.stateSelection) : void 0;
            if (_c19 !== void 0) {
              if (r.props.name !== void 0 && _c19.name) {
                var _c20 = _c19,
                  _h38 = _c20.name,
                  _f52 = _objectWithoutProperties(_c20, _excluded3);
                _c19 = _f52;
              }
              if (r.props.material !== void 0 && "material" in _c19) {
                var _c21 = _c19,
                  _h39 = _c21.material,
                  _f53 = _objectWithoutProperties(_c21, _excluded4);
                _c19 = _f53;
              }
              var _d33 = Tr.removeOverridden(r.path, r.props, _c19);
              l = _objectSpread(_objectSpread({}, r), {}, {
                props: _d33
              });
            }
          }
          if (this.updateByPatchedOpBase(l, ga.patch(this.data, this.stateSelection ? this.data.states.data(this.stateSelection) : void 0), s), wt(r.path, ["overrides"])) {
            var _c22 = [],
              _d34 = _toConsumableArray(r.path);
            for (_c22.push(_d34[1]), _d34.splice(0, 2); _d34.length > 0 && _d34[0] === "descendants";) _c22.push(_d34[1]), _d34.splice(0, 2);
            if (_c22[_c22.length - 1] === void 0) {
              if (r.type === 0) for (var _i41 = 0, _Object$keys8 = Object.keys(r.props); _i41 < _Object$keys8.length; _i41++) {
                var _h40 = _Object$keys8[_i41];
                _c22[_c22.length - 1] = _h40;
                var _f54 = s.scene.findInstance([this.uuid].concat(_c22));
                _f54 && (_f54.overrideData = r.props[_h40], _f54.updateState(po.apply(_f54.component.data, _f54.overrideData), s));
              }
            } else {
              var _h41 = s.scene.findInstance([this.uuid].concat(_c22));
              if (_h41) {
                var _f55 = Tr.zoom(_h41.component.data, _d34);
                if (r = _objectSpread(_objectSpread({}, r), {}, {
                  path: _d34
                }), r.type === 0) {
                  var _p35 = r.props;
                  if (_f55) for (var _i42 = 0, _Object$entries12 = Object.entries(r.props); _i42 < _Object$entries12.length; _i42++) {
                    var _Object$entries12$_i = _slicedToArray(_Object$entries12[_i42], 2),
                      m = _Object$entries12$_i[0],
                      g = _Object$entries12$_i[1];
                    g === void 0 && (_p35 === r.props && (_p35 = _objectSpread({}, r.props)), _p35[m] = _f55[m]);
                  }
                  r = _objectSpread(_objectSpread({}, r), {}, {
                    props: _p35
                  });
                }
                _h41.overrideData = jd.resolve(i.overrides, _c22), _h41.updateByOp(r, Mr.applySimple(_h41.data, r), s, !1);
              }
            }
          } else if (this.instances.length > 0) {
            var _c23;
            if (r.path.length === 0 && r.type === 0) {
              var _d35;
              var _iterator50 = _createForOfIteratorHelper(wo.rootOverrideProps),
                _step50;
              try {
                for (_iterator50.s(); !(_step50 = _iterator50.n()).done;) {
                  var _h42 = _step50.value;
                  _h42 in r.props && (_d35 === void 0 && (_d35 = {}), _d35[_h42] = r.props[_h42]);
                }
              } catch (err) {
                _iterator50.e(err);
              } finally {
                _iterator50.f();
              }
              _d35 && (_c23 = _objectSpread(_objectSpread({}, r), {}, {
                props: _d35
              }));
            } else {
              var _iterator51 = _createForOfIteratorHelper(wo.rootOverrideProps),
                _step51;
              try {
                for (_iterator51.s(); !(_step51 = _iterator51.n()).done;) {
                  var _d36 = _step51.value;
                  if (wt(r.path, [_d36])) {
                    _c23 = r;
                    break;
                  }
                }
              } catch (err) {
                _iterator51.e(err);
              } finally {
                _iterator51.f();
              }
            }
            _c23 !== void 0 && this.instances.forEach(function (d) {
              if (d.isInstanceRoot) {
                var _h43 = po.filterOp(d.overrideData, _c23);
                _h43 && d.updateByOp(_h43, Mr.applySimple(d.data, _h43), s, !0);
              }
            }), this.instances.forEach(function (d) {
              if (!d.isInstanceRoot) {
                var _h44 = po.filterOp(d.overrideData, r);
                if (_h44) {
                  var _f56;
                  a === d.data && r === _h44 ? _f56 = i : _f56 = Mr.applySimple(d.data, _h44), d.updateByOp(_h44, _f56, s, !0);
                }
              }
            });
          }
        }
      }, {
        key: "updateByPatchedOpBase",
        value: function updateByPatchedOpBase(r, i, s) {
          if (this.dataPatched = i, r.path.length === 0 && r.type === 0) r.props.type !== void 0 && !ks.is(r.props.type) && Gs.changeEntityProptotype(this, i, s);else if (r.path.length === 1 && r.path[0] === "geometry" && r.type === 0 && "type" in r.props) {
            Gs.changeEntityProptotype(this, i, s);
            var _iterator52 = _createForOfIteratorHelper(this.children),
              _step52;
            try {
              for (_iterator52.s(); !(_step52 = _iterator52.n()).done;) {
                var o = _step52.value;
                ut.is(o) && o.updateVisible(s.scene);
              }
            } catch (err) {
              _iterator52.e(err);
            } finally {
              _iterator52.f();
            }
          }
          this.updateByPatchedOp(r, i, s);
        }
      }, {
        key: "updateByPatchedOp",
        value: function updateByPatchedOp(r, i, s) {
          if (r.path.length === 0 && r.type === 0 && this.updateState(r.props, s), wt(r.path, ["pathSnapping"]) !== null && this.updatePathSnapping(i.pathSnapping), wt(r.path, ["cloner"]) !== null) {
            var o = Mr.drop(r, 1);
            o.path.length === 0 && o.type === 0 && o.props.disabled === !0 ? this.setFromClonerState(null, s) : this.cloner ? this.cloner.updateState(i.cloner, s.scene) : (this.setFromClonerState(i.cloner, s), this.expandCloner(s.scene)), this.updateVisible(s.scene);
          }
        }
      }, {
        key: "updatePathSnapping",
        value: function updatePathSnapping() {
          var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.dataPatched.pathSnapping;
          this._updatedPathSnapping = r, this._needApplyPathSnapping = !0;
        }
      }, {
        key: "updatedPathSnapping",
        get: function get() {
          return this._updatedPathSnapping;
        }
      }, {
        key: "applyPathSnapping",
        value: function applyPathSnapping(r) {
          var _this$_updatedPathSna, _this$_updatedPathSna2, _ref18, _this$_updatedPathSna3, _this$_updatedPathSna4, _ref19, _this$_updatedPathSna5, _this$_updatedPathSna6, _this$_updatedPathSna7, _this$_updatedPathSna8, _this$parent;
          var i = (_this$_updatedPathSna = (_this$_updatedPathSna2 = this._updatedPathSnapping) === null || _this$_updatedPathSna2 === void 0 ? void 0 : _this$_updatedPathSna2.pathId) !== null && _this$_updatedPathSna !== void 0 ? _this$_updatedPathSna : this.dataPatched.pathSnapping.pathId,
            s = (_ref18 = (_this$_updatedPathSna3 = (_this$_updatedPathSna4 = this._updatedPathSnapping) === null || _this$_updatedPathSna4 === void 0 ? void 0 : _this$_updatedPathSna4.slide) !== null && _this$_updatedPathSna3 !== void 0 ? _this$_updatedPathSna3 : this.dataPatched.pathSnapping.slide) !== null && _ref18 !== void 0 ? _ref18 : 0,
            o = (_ref19 = (_this$_updatedPathSna5 = (_this$_updatedPathSna6 = this._updatedPathSnapping) === null || _this$_updatedPathSna6 === void 0 ? void 0 : _this$_updatedPathSna6.offset) !== null && _this$_updatedPathSna5 !== void 0 ? _this$_updatedPathSna5 : this.dataPatched.pathSnapping.offset) !== null && _ref19 !== void 0 ? _ref19 : 0,
            a = (_this$_updatedPathSna7 = (_this$_updatedPathSna8 = this._updatedPathSnapping) === null || _this$_updatedPathSna8 === void 0 ? void 0 : _this$_updatedPathSna8.orientation) !== null && _this$_updatedPathSna7 !== void 0 ? _this$_updatedPathSna7 : this.dataPatched.pathSnapping.orientation;
          if (i === null) return;
          var l = r.find(i);
          if (!l || this._needApplyPathSnapping === !1) return;
          this._needApplyPathSnapping = !1;
          var u = l.data;
          if (u.geometry.path.points.length <= 1) return;
          var c = p0(u.geometry.path),
            d = (s + o) % 1;
          s + o === 1 && d === 0 && (d = 1);
          var h = c.getPointAt(d);
          if (h === null) return;
          var f = this.parent ? (_this$parent = this.parent) === null || _this$parent === void 0 ? void 0 : _this$parent.matrixWorld : new te();
          l.updateMatrixWorld();
          var p = new te().multiplyMatrices(f.clone().invert(), l.matrixWorld);
          h.applyMatrix4(p);
          var m = {
            position: h.toArray(),
            rotation: u.rotation
          };
          if (a === "tangential") {
            var g = new te().extractRotation(l.matrixWorld),
              y = c.getTangentAt(d).applyMatrix4(g).add(h),
              v = new te().lookAt(h, y, B9),
              x = j1.setFromEuler(new Kt().setFromRotationMatrix(v)).multiplyScalar(Se.RAD2DEG);
            m = _objectSpread(_objectSpread({}, m), {}, {
              rotation: x.toArray()
            });
          }
          this.updateTransformState(m), this.traverseEntity(function (g) {
            g._cameraType && g.dispatchEvent(R9);
          });
        }
      }, {
        key: "updateVisible",
        value: function updateVisible(r) {
          var _this$dataPatched$clo, _this$dataPatched$clo2;
          if (this.visible = this.dataPatched.visible && (!this.dataPatched.cloner || ((_this$dataPatched$clo = this.dataPatched.cloner.disabled) !== null && _this$dataPatched$clo !== void 0 ? _this$dataPatched$clo : !1) || ((_this$dataPatched$clo2 = this.dataPatched.cloner) === null || _this$dataPatched$clo2 === void 0 ? void 0 : _this$dataPatched$clo2.hideBase) !== !0), !r) return;
          var i = !1;
          this.traverseEntity(function (s) {
            if (s.data.type === "Splat") return i = !0, !0;
          }), i && r.reloadSplats();
        }
      }, {
        key: "updateState_Entity",
        value: function updateState_Entity(r, i) {
          r.name !== void 0 && (this.name = r.name), r.raycastLock !== void 0 && (this.raycastLock = r.raycastLock), r.visible !== void 0 && (this.updateVisible(i === null || i === void 0 ? void 0 : i.scene), this.resetBBoxNeedsUpdate()), i && "cloner" in r && r.cloner !== void 0 && (this.setFromClonerState(r.cloner, i), this.updateVisible(i.scene)), this.updateTransformState(r, i);
        }
      }, {
        key: "attachedSurfaceCloners",
        get: function get() {
          return this.children.filter(function (r) {
            return r instanceof Gs.Cloner && r.parameters.type === "toObject";
          });
        }
      }, {
        key: "setFromClonerState",
        value: function setFromClonerState(r, i) {
          this.disposed || (r === null || r.disabled ? (this.cloner && this.cloner.removeFromParent(), this.cloner = void 0) : this.cloner === void 0 ? (this.cloner = new Gs.Cloner(this, r), i.scene.addPendingExpandCloner(this)) : this.cloner.updateState(r, i.scene));
        }
      }, {
        key: "expandCloner",
        value: function expandCloner(r) {
          !this.disposed && this.cloner && this.cloner.expandClones(r);
        }
      }, {
        key: "invalidateClonerTransform",
        value: function invalidateClonerTransform(r) {
          this.cloner && this.cloner.invalidateTransform(r);
        }
      }, {
        key: "requestRender",
        value: function requestRender() {
          this.dispatchEvent({
            type: "requestRender"
          });
        }
      }]);
      return _class2;
    }(hh(n));
  };
var m0 = /*#__PURE__*/function () {
  function m0() {
    _classCallCheck(this, m0);
  }
  _createClass(m0, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters, _e$radiusTop, _e$radiusBottom, _e$height, _e$depth;
      var e = Object.assign({}, (_t$parameters = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters !== void 0 ? _t$parameters : {
        width: 100,
        radialSegments: 64,
        heightSegments: 1,
        openEnded: !1,
        thetaStart: 0,
        thetaLength: 360,
        cornerRadius: 8,
        cornerSegments: 8,
        hollow: 0
      }, n.parameters);
      e.thetaLength = Se.clamp(e.thetaLength, 0, 360);
      var r = e.width / 2,
        i = (_e$radiusTop = e.radiusTop) !== null && _e$radiusTop !== void 0 ? _e$radiusTop : r,
        s = (_e$radiusBottom = e.radiusBottom) !== null && _e$radiusBottom !== void 0 ? _e$radiusBottom : r;
      return i === s ? (i = r, s = r) : i > s ? (i = r, s = s * r / i) : (i = i * r / s, s = r), {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height = e.height) !== null && _e$height !== void 0 ? _e$height : e.width),
          depth: Math.abs((_e$depth = e.depth) !== null && _e$depth !== void 0 ? _e$depth : e.width),
          radiusTop: i,
          radiusBottom: s
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters = n.parameters,
        t = _n$parameters.width,
        e = _n$parameters.depth,
        r = _n$parameters.height,
        i = _n$parameters.radialSegments,
        s = _n$parameters.heightSegments,
        o = _n$parameters.openEnded,
        a = _n$parameters.thetaStart,
        l = _n$parameters.thetaLength,
        u = _n$parameters.radiusTop,
        c = _n$parameters.radiusBottom,
        d = _n$parameters.cornerRadius,
        h = _n$parameters.cornerSegments,
        f = _n$parameters.hollow,
        p;
      return l === 0 ? (p = new we(), p.setAttribute("position", new be([], 3))) : d || f ? p = new im(u, c, r, i, s, o, a, l * Math.PI / 180, d, d, h, f) : p = new vc(u, c, r, i, s, o, a, l * Math.PI / 180), p.scale(1, 1, e / t), Object.assign(p, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "CylinderGeometry"
        })
      });
    }
  }]);
  return m0;
}();
function Ml(n, t, e) {
  e.x = n.x * t.x, e.y = n.y, e.z = n.x * t.y;
}
function vO(n) {
  return new N(n.y, -n.x);
}
var im = /*#__PURE__*/function (_we10) {
  _inherits(im, _we10);
  var _super117 = _createSuper(im);
  function im(t, e, r, i, s, o, a, l, u, c, d, h) {
    var _this105;
    var f = arguments.length > 12 && arguments[12] !== undefined ? arguments[12] : !1;
    _classCallCheck(this, im);
    _this105 = _super117.call(this), _this105.type = "RoundedCylinderBufferGeometry", t = t !== void 0 ? t : 1, e = e !== void 0 ? e : 1, r = r || 1, i = Math.floor(i) || 8, s = Math.floor(s) || 1, o = o !== void 0 ? o : !1, a = a !== void 0 ? a : 0, l = l !== void 0 ? l : Math.PI * 2, o && (u = 0, c = 0);
    var p = [],
      m = [],
      g = [],
      y = [],
      v = 0,
      x = r / 2,
      S = new _(),
      w = new _();
    f && t == 0 && (t = u), f && e == 0 && (e = c);
    var A = new N(t, x),
      E = new N(e, -x),
      b = null,
      T = null,
      M = null,
      C = null,
      P = A.clone().sub(E),
      D = 0,
      O = 0,
      I = 0;
    h > 0 && (D = Math.min(t, e) * (1 - h), O = t - D, I = e - D);
    var z = A.clone();
    z.x -= D;
    var B = Math.PI - P.angle(),
      V = P.angle(),
      U = Math.tan(V / 2),
      j = Math.tan(B / 2),
      W = U + j,
      k = h ? W : j,
      H = h ? W : U;
    if (u = Math.min(u, (t - O) / k, P.length() / W), c = Math.min(c, (e - I) / H, P.length() / W), u > 0) {
      var K = u / U;
      b = A.clone().sub(new N(K, u)), h && (M = b.clone(), M.x -= D - W * u), A.sub(P.clone().setLength(K));
    }
    if (c > 0) {
      var _K2 = c / j;
      T = E.clone().sub(new N(_K2, -c)), E.add(P.clone().setLength(_K2)), h && (C = T.clone(), C.x -= D - W * c, z.sub(P.clone().setLength(_K2)));
    }
    P = A.clone().sub(E);
    var X = P.length() < .5,
      q = [];
    for (var _K3 = 0; _K3 <= i; _K3++) {
      var Y = [],
        ye = _K3 / i,
        fe = ye * l + a,
        oe = new N(Math.sin(fe), Math.cos(fe));
      C && T ? (G(Y, ye, oe, B, c, C, -1, !0), G(Y, ye, oe, V, c, T, -1, !1)) : T ? (J(Y, oe, T.x, 0, -1), G(Y, ye, oe, V, c, T, -1, !1)) : o || J(Y, oe, e, I, -1);
      var _e = vO(P).normalize();
      if (Ml(_e, oe, S), !X) for (var xe = 0; xe <= s; xe++) {
        var Ie = xe / s,
          Oe = P.clone().multiplyScalar(Ie).add(E);
        Ml(Oe, oe, w), m.push(w.x, w.y, w.z), g.push(S.x, S.y, S.z), y.push(ye, .5 + w.y / r), Y.push(v++);
      }
      if (M && b ? (G(Y, ye, oe, B, u, b, 1, !1), G(Y, ye, oe, V, u, M, 1, !0)) : b ? (G(Y, ye, oe, B, u, b, 1, !1), J(Y, oe, b.x, 0, 1)) : o || J(Y, oe, t, O, 1), h && !X) {
        var _xe = vO(P).multiplyScalar(-1).normalize();
        Ml(_xe, oe, S);
        for (var _Ie = 0; _Ie <= s; _Ie++) {
          var _Oe = _Ie / s,
            Pe = P.clone().multiplyScalar(-_Oe).add(z);
          Ml(Pe, oe, w), m.push(w.x, w.y, w.z), g.push(S.x, S.y, S.z), y.push(ye, .5 + w.y / r), Y.push(v++);
        }
      }
      h && !o && Y.push(Y[0]), q.push(Y);
    }
    for (var _K4 = 0; _K4 < q.length - 1; _K4++) for (var _Y8 = 0; _Y8 < q[0].length - 1; _Y8++) {
      if (o && h && _Y8 == s) continue;
      var _ye = q[_K4][_Y8],
        _fe = q[_K4 + 1][_Y8],
        _oe4 = q[_K4 + 1][_Y8 + 1],
        _e43 = q[_K4][_Y8 + 1],
        _xe2 = m[_oe4 * 3 + 0],
        _Ie2 = m[_oe4 * 3 + 2];
      p.push(_ye, _fe, _e43), (_xe2 != 0 || _Ie2 != 0) && p.push(_fe, _oe4, _e43);
    }
    l < Math.PI * 2 && (Z(-1, q[0], a), Z(1, q[q.length - 1], a + l)), _this105.setIndex(p), _this105.setAttribute("position", new be(m, 3)), _this105.setAttribute("normal", new be(g, 3)), _this105.setAttribute("uv", new be(y, 2));
    function G(K, Y, ye, fe, oe, _e, xe, Ie) {
      for (var _Oe2 = 0; _Oe2 < d + 1; _Oe2++) {
        var _Pe = _Oe2 / d,
          Te = xe < 0 ? _Pe : 1 - _Pe;
        Ie && (Te -= 1), Te *= fe;
        var Ve = new N(Math.sin(Te), Math.cos(Te) * xe),
          Ue = Ve.clone().multiplyScalar(oe).add(_e);
        Ml(Ue, ye, w), m.push(w.x, w.y, w.z), Ml(Ve, ye, S), g.push(S.x, S.y, S.z), y.push(Y, .5 + w.y / r), K.push(v++);
      }
    }
    function J(K, Y, ye, fe, oe) {
      var _e = new _(),
        xe = new N(),
        Ie = [ye, fe];
      oe < 0 && Ie.reverse();
      for (var _i43 = 0, _Ie3 = Ie; _i43 < _Ie3.length; _i43++) {
        var _Oe3 = _Ie3[_i43];
        xe.set(_Oe3, x * oe), Ml(xe, Y, _e), m.push(_e.x, _e.y, _e.z), g.push(0, oe, 0), y.push(.5, .5), K.push(v++);
      }
    }
    function Z(K, Y, ye) {
      var fe = new N(Math.sin(ye), Math.cos(ye)),
        oe = new N(-Math.cos(ye), Math.sin(ye)),
        _e = new _(),
        xe = K < 0 ? function (Pe, Te, Ve) {
          return p.push(Pe, Te, Ve);
        } : function (Pe, Te, Ve) {
          return p.push(Pe, Ve, Te);
        },
        Ie = new N((t + e + O + I) / 4, 0);
      Ml(Ie, fe, _e), m.push(_e.x, _e.y, _e.z), g.push(oe.x, 0, oe.y), y.push(.5, .5);
      var Oe = v++;
      var _iterator53 = _createForOfIteratorHelper(Y),
        _step53;
      try {
        for (_iterator53.s(); !(_step53 = _iterator53.n()).done;) {
          var _Pe3 = _step53.value;
          var Te = m.slice(_Pe3 * 3, _Pe3 * 3 + 3);
          m.push.apply(m, _toConsumableArray(Te)), g.push(oe.x, 0, oe.y);
          var Ve = y.slice(_Pe3 * 2, _Pe3 * 2 + 2);
          y.push.apply(y, _toConsumableArray(Ve)), v++;
        }
      } catch (err) {
        _iterator53.e(err);
      } finally {
        _iterator53.f();
      }
      for (var _Pe2 = Oe + 1; _Pe2 < v - 1; _Pe2++) xe(Oe, _Pe2, _Pe2 + 1);
      xe(Oe, v - 1, Oe + 1);
    }
    return _this105;
  }
  return _createClass(im);
}(we);
var xO = /*#__PURE__*/function () {
  function xO() {
    _classCallCheck(this, xO);
  }
  _createClass(xO, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters2, _e$height2, _e$depth2;
      var e = Object.assign({}, (_t$parameters2 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters2 !== void 0 ? _t$parameters2 : {
        width: 100,
        radialSegments: 32,
        heightSegments: 8,
        openEnded: !1,
        thetaStart: 0,
        thetaLength: 360,
        cornerRadiusTop: 8,
        cornerRadiusBottom: 8,
        cornerSegments: 8
      }, n.parameters);
      return e.thetaLength = Se.clamp(e.thetaLength, 0, 360), {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height2 = e.height) !== null && _e$height2 !== void 0 ? _e$height2 : e.width),
          depth: Math.abs((_e$depth2 = e.depth) !== null && _e$depth2 !== void 0 ? _e$depth2 : e.width)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters2 = n.parameters,
        t = _n$parameters2.width,
        e = _n$parameters2.depth,
        r = _n$parameters2.height,
        i = _n$parameters2.radialSegments,
        s = _n$parameters2.heightSegments,
        o = _n$parameters2.openEnded,
        a = _n$parameters2.thetaStart,
        l = _n$parameters2.thetaLength,
        u = _n$parameters2.cornerRadiusTop,
        c = _n$parameters2.cornerRadiusBottom,
        d = _n$parameters2.cornerSegments,
        h;
      return l === 0 ? (h = new we(), h.setAttribute("position", new be([], 3))) : u > 0 || c > 0 || l < 360 ? h = new im(0, t / 2, r, i, s, o, a, l * Math.PI / 180, u, c, d, 0, !0) : h = new $a(t / 2, r, i, s, o), h.scale(1, 1, e / t), Object.assign(h, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "ConeGeometry"
        })
      });
    }
  }]);
  return xO;
}();
var bO = /*#__PURE__*/function () {
    function bO() {
      _classCallCheck(this, bO);
    }
    _createClass(bO, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters3, _e$height3, _e$depth3;
        var e = Object.assign({}, (_t$parameters3 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters3 !== void 0 ? _t$parameters3 : {
          width: 100,
          widthSegments: 1,
          heightSegments: 1,
          depthSegments: 1,
          cornerRadius: 8,
          cornerSegments: 8
        }, n.parameters);
        return {
          parameters: Object.assign(e, {
            width: Math.abs(e.width),
            height: Math.abs((_e$height3 = e.height) !== null && _e$height3 !== void 0 ? _e$height3 : e.width),
            depth: Math.abs((_e$depth3 = e.depth) !== null && _e$depth3 !== void 0 ? _e$depth3 : e.width)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters3 = n.parameters,
          t = _n$parameters3.width,
          e = _n$parameters3.height,
          r = _n$parameters3.depth,
          i = _n$parameters3.widthSegments,
          s = _n$parameters3.heightSegments,
          o = _n$parameters3.depthSegments,
          a = _n$parameters3.cornerRadius,
          l = _n$parameters3.cornerSegments,
          u;
        return a == 0 ? u = new li(t, e, r, i, s, o) : u = new W1(t, e, r, i, s, o, a, l), Object.assign(u, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "CubeGeometry"
          })
        });
      }
    }]);
    return bO;
  }(),
  H1 = Math.PI / 2,
  W1 = /*#__PURE__*/function (_we11) {
    _inherits(W1, _we11);
    var _super118 = _createSuper(W1);
    function W1() {
      var _this106;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 0;
      var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 4;
      _classCallCheck(this, W1);
      _this106 = _super118.call(this), _this106.type = "BoxGeometry";
      var u = _assertThisInitialized(_this106);
      i = Math.floor(i), s = Math.floor(s), o = Math.floor(o), l = Math.floor(l), a = Math.min(a, t / 2, e / 2, r / 2);
      var c = [],
        d = [],
        h = [],
        f = [],
        p = 0,
        m = 0;
      g("z", "y", "x", -1, -1, r, e, t, o, s, 0), g("z", "y", "x", 1, -1, r, e, -t, o, s, 1), g("x", "z", "y", 1, 1, t, r, e, i, o, 2), g("x", "z", "y", 1, -1, t, r, -e, i, o, 3), g("x", "y", "z", 1, -1, t, e, r, i, s, 4), g("x", "y", "z", -1, -1, t, e, -r, i, s, 5), a > 0 && (y("z", "y", "x", -1, -1, 1, r, e, t, o, 0), y("z", "y", "x", 1, -1, -1, r, e, t, o, 1), y("z", "y", "x", -1, 1, -1, r, e, t, o, 1), y("z", "y", "x", 1, 1, 1, r, e, t, o, 0), y("x", "y", "z", -1, -1, -1, t, e, r, i, 0), y("x", "y", "z", 1, -1, 1, t, e, r, i, 1), y("x", "y", "z", -1, 1, 1, t, e, r, i, 0), y("x", "y", "z", 1, 1, -1, t, e, r, i, 1), y("y", "x", "z", -1, -1, 1, e, t, r, s, 0), y("y", "x", "z", 1, -1, -1, e, t, r, s, 1), y("y", "x", "z", 1, 1, 1, e, t, r, s, 1), y("y", "x", "z", -1, 1, -1, e, t, r, s, 0), v(1, 1, 1), v(-1, 1, 1), v(1, -1, 1), v(-1, -1, 1), v(1, 1, -1), v(-1, 1, -1), v(1, -1, -1), v(-1, -1, -1)), _this106.setIndex(c), _this106.setAttribute("position", new be(d, 3)), _this106.setAttribute("normal", new be(h, 3)), _this106.setAttribute("uv", new be(f, 2));
      function g(x, S, w, A, E, b, T, M, C, P, D) {
        var O = (b - 2 * a) / C,
          I = (T - 2 * a) / P,
          z = b / 2 - a,
          B = T / 2 - a,
          V = M / 2,
          U = C + 1,
          j = P + 1,
          W = 0,
          k = 0,
          H = new _();
        for (var X = 0; X < j; X++) {
          var q = X * I - B;
          for (var _G5 = 0; _G5 < U; _G5++) {
            var _J = _G5 * O - z;
            H[x] = _J * A, H[S] = q * E, H[w] = V, d.push(H.x, H.y, H.z), H[x] = 0, H[S] = 0, H[w] = M > 0 ? 1 : -1, h.push(H.x, H.y, H.z), f.push(_G5 / C), f.push(1 - X / P), W += 1;
          }
        }
        for (var _X3 = 0; _X3 < P; _X3++) for (var _q2 = 0; _q2 < C; _q2++) {
          var _G6 = p + _q2 + U * _X3,
            _J2 = p + _q2 + U * (_X3 + 1),
            Z = p + (_q2 + 1) + U * (_X3 + 1),
            K = p + (_q2 + 1) + U * _X3;
          c.push(_G6, _J2, K), c.push(_J2, Z, K), k += 6;
        }
        u.addGroup(m, k, D), m += k, p += W;
      }
      function y(x, S, w, A, E, b, T, M, C, P, D) {
        var O = (T - 2 * a) / P,
          I = T / 2 - a,
          z = M / 2 - a,
          B = C / 2,
          V = P + 1,
          U = 0,
          j = 0,
          W = new _(),
          k = new _();
        for (var H = 0; H < l + 1; H++) {
          var X = H / l * H1,
            q = Math.sin(X) * a,
            _G7 = (1 - Math.cos(X)) * a,
            _J3 = Math.sin(X),
            Z = Math.cos(X);
          W[S] = (z + q) * E, W[w] = (B - _G7) * b, k[x] = 0, k[S] = _J3 * Math.sign(W[S]), k[w] = Z * Math.sign(W[w]);
          for (var K = 0; K < V; K++) {
            var Y = K * O - I;
            W[x] = Y * A, d.push(W.x, W.y, W.z), h.push(k.x, k.y, k.z), f.push(K / P), f.push(0), U += 1;
          }
        }
        for (var _H5 = 0; _H5 < l; _H5++) for (var _X7 = 0; _X7 < P; _X7++) {
          var _q8 = p + _X7 + V * _H5,
            _G8 = p + _X7 + V * (_H5 + 1),
            _J4 = p + (_X7 + 1) + V * (_H5 + 1),
            _Z2 = p + (_X7 + 1) + V * _H5;
          c.push(_q8, _G8, _Z2), c.push(_G8, _J4, _Z2), j += 6;
        }
        u.addGroup(m, j, D), m += j, p += U;
      }
      function v(x, S, w) {
        var A = new _(),
          E = new _(t / 2, e / 2, r / 2);
        E.subScalar(a);
        var b = [],
          T = x * S * w > 0 ? function (C, P, D) {
            return c.push(C, P, D);
          } : function (C, P, D) {
            return c.push(C, D, P);
          };
        for (var C = 0; C <= l; C++) {
          var P = [],
            D = H1 * (1 - C / l),
            O = Math.cos(D),
            I = Math.sin(D),
            z = 0;
          for (var B = 0; B <= C; B++) {
            var V = Math.cos(z),
              U = Math.sin(z);
            A.x = O * V, A.y = I, A.z = O * U;
            var j = E.clone().addScaledVector(A, a);
            d.push(x * j.x, S * j.y, w * j.z), h.push(x * A.x, S * A.y, w * A.z), f.push(0, 0), P.push(p++), z += H1 / C;
          }
          b.push(P);
        }
        var M = b.length - 1;
        for (var _C12 = 0; _C12 < M; _C12++) {
          var _P15 = b[_C12],
            _D11 = b[_C12 + 1],
            _O19 = _P15.length - 1;
          T(_P15[0], _D11[1], _D11[0]);
          for (var _I8 = 1; _I8 <= _O19; _I8++) T(_P15[_I8 - 1], _P15[_I8], _D11[_I8]), T(_P15[_I8], _D11[_I8 + 1], _D11[_I8]);
        }
      }
      return _this106;
    }
    return _createClass(W1);
  }(we);
var Cl = /*#__PURE__*/function (_we12) {
  _inherits(Cl, _we12);
  var _super119 = _createSuper(Cl);
  function Cl() {
    var _this107;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
    var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : .2;
    var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 4;
    _classCallCheck(this, Cl);
    _this107 = _super119.call(this), _this107.type = "PolyhedronGeometryRound";
    var a = [],
      l = [],
      u = [];
    c(), d(), _this107.setAttribute("position", new be(a, 3)), _this107.setAttribute("normal", new be(u, 3)), _this107.setAttribute("uv", new be(l, 2));
    return _possibleConstructorReturn(_this107);
    function c() {
      s = Math.min(1 - 1e-5, s), s == 0 && (o = 0);
      var f = {
          IcosahedronGeometry: 5,
          DodecahedronGeometry: 3,
          HexahedronGeometry: 3,
          OctahedronGeometry: 4,
          TetrahedronGeometry: 3
        }[r],
        p = new _(),
        m = p.clone(),
        g = new vr(),
        y = s * i,
        v = i - y,
        x = o + 1,
        S = new _(),
        w = function w(U, j) {
          return S.subVectors(U, j).normalize();
        },
        A = function A(U, j) {
          return Array(U).fill(void 0).map(j);
        },
        E = A(t.length / 3, function (U, j) {
          return new _().fromArray(t, j * 3).setLength(i);
        }),
        b = [],
        T = 1e6;
      var _loop6 = function _loop6() {
        var j = E[U],
          W = [],
          k,
          H,
          X,
          q = 1e10,
          G = -1;
        for (; (G = e.indexOf(U, G + 1)) != -1;) {
          var _Y9 = G - G % 3;
          k = e[_Y9 + (G + 1) % 3], H = e[_Y9 + (G + 2) % 3], X = j.distanceToSquared(E[k]), q = Math.min(q, X), W.push([k, H, X]);
        }
        q += 1e-6;
        var J = [],
          Z = 0,
          K = W.length;
        for (var _Y10 = 0; _Y10 < K; _Y10++) {
          var _b$k;
          var _W$Z = _slicedToArray(W[Z], 3);
          k = _W$Z[0];
          H = _W$Z[1];
          X = _W$Z[2];
          var _ye2 = ((_b$k = b[k]) === null || _b$k === void 0 ? void 0 : _b$k.includes(U)) == !0;
          X <= q && J.push(k + +_ye2 * T), Z = W.findIndex(function (fe) {
            return fe[0] == H;
          });
        }
        b.push(J);
      };
      for (var U = 0; U < E.length; U++) {
        _loop6();
      }
      var M = [];
      {
        var _U5 = 0,
          j = 0,
          W,
          k,
          H = f == 3;
        for (var X = 0; X <= o; X++) {
          W = X * (X + 1) / 2, k = (X + 1) * (X + 2) / 2;
          for (var q = 0; q < o - X; q++) (_U5 = W + q + X + 2, j = k + q + X + 3), M.push.apply(M, [W, k].concat(_toConsumableArray(H ? [j, W] : [_U5, k]), [j, _U5])), (W = _U5, k = j);
          M.push(W, k, W + o + 2);
        }
      }
      var C = p.clone(),
        P = p.clone(),
        D = p.clone(),
        O = p.clone(),
        I = p.clone(),
        z = [],
        B = A(E.length, function () {
          return A(f, function () {
            return p.clone();
          });
        });
      for (var _U6 = 0; _U6 < E.length; _U6++) {
        p.copy(E[_U6]).normalize(), C.copy(p).multiplyScalar(v);
        var _j6 = b[_U6];
        for (var _J5 = 0; _J5 < _j6.length; _J5++) {
          var Z = _j6[_J5],
            K = _j6[(_J5 + 1) % f];
          g.setFromPointsAndIndices(E, _U6, Z % T, K % T), g.b.sub(g.a).setLength(1e10).add(g.a), g.c.sub(g.a).setLength(1e10).add(g.a), g.closestPointToPoint(C, B[_U6][_J5]);
        }
        var _W3 = [],
          _k4 = [],
          _H6 = [],
          _X8 = new _();
        o == 0 && _toConsumableArray(B[_U6]).reduce(function (J, Z) {
          return J.add(Z);
        }, _X8).multiplyScalar(1 / f);
        for (var _J6 = 0; _J6 < f; _J6++) {
          var _Z3 = [],
            _K5 = (_J6 - 1 + f) % f,
            Y = B[_U6][_K5],
            ye = B[_U6][_J6];
          p.copy(Y).sub(C), m.copy(ye).sub(C);
          var fe = C.angleTo(p),
            oe = p.angleTo(m),
            _e = Math.cos(fe) * y;
          o == 0 ? P.copy(_X8) : P.copy(C).setLength(v + _e), _k4.push(_e);
          var xe = [P, Y, ye];
          for (var Ie = 0; Ie < 2; Ie++) {
            var Oe = xe[Ie],
              Pe = xe[Ie + 1];
            O.subVectors(Oe, C), I.subVectors(Pe, C), D.crossVectors(O, I).normalize();
            for (var Te = 0; Te < x; Te++) {
              var Ve = [fe, oe][Ie] * Te / x;
              p.copy(O).applyAxisAngle(D, Ve).add(C), _W3.push(p.clone()), Ie && (w(p, C), _Z3.push([Te == 0 ? Oe : p.clone(), S.clone()]));
            }
            Ie && (w(Pe, C), _Z3.push([Pe, S.clone()]));
          }
          _H6.push(_Z3);
        }
        z.push(_H6);
        var _q9 = 2 * x,
          _G9 = 2;
        var _loop7 = function _loop7() {
          var Z = _q9 * _J7,
            K = _q9 * ((_J7 + 1) % f),
            Y = [_W3[Z]];
          for (var _fe2 = 1; _fe2 < x; _fe2++) {
            O = _W3[Z + _fe2], I = _W3[K + _fe2], Y.push(O);
            for (var _oe5 = 1, _e44 = _fe2 - _G9 + 1; _oe5 <= _e44; _oe5++) p.lerpVectors(O, I, _oe5 / (_e44 + 1)), p.sub(C).setLength(_k4[_J7]).add(C), Y.push(p.clone());
            Y.push(I);
          }
          for (var _fe3 = 0; _fe3 < x; _fe3++) Y.push(_W3[_fe3 + x + Z]);
          Y.push(_W3[K + x]);
          var ye = M.map(function (fe) {
            return Y[fe];
          });
          a.push.apply(a, _toConsumableArray(ye.map(function (fe) {
            return [fe.x, fe.y, fe.z];
          }).flat())), u.push.apply(u, _toConsumableArray(ye.map(function (fe) {
            return w(fe, C), [S.x, S.y, S.z];
          }).flat()));
        };
        for (var _J7 = 0; _J7 < f; _J7++) {
          _loop7();
        }
      }
      var V = [];
      var _loop8 = function _loop8(_U7) {
        for (var _j8 = 0; _j8 < f; _j8++) {
          var _W5 = b[_U7][_j8];
          if (_W5 < T) {
            var _k6 = b[_W5].findIndex(function (q) {
                return q % T == _U7;
              }),
              _H8 = z[_U7][_j8],
              _X10 = z[_W5][_k6];
            for (var _q11 = 0; _q11 < x; _q11++) {
              var _G10 = _H8[_q11],
                _J8 = _X10[x - _q11],
                _Z4 = _H8[_q11 + 1],
                _K6 = _X10[x - (_q11 + 1)];
              [_G10, _J8, _Z4, _Z4, _J8, _K6].forEach(function (Y) {
                a.push(Y[0].x, Y[0].y, Y[0].z), u.push(Y[1].x, Y[1].y, Y[1].z);
              });
            }
            V.push(_H8[0][0], _X10[x][0], _H8[x][0], _X10[0][0]);
          }
        }
      };
      for (var _U7 = 0; _U7 < b.length; _U7++) {
        _loop8(_U7);
      }
      for (; V.length;) {
        var _U8 = void 0,
          _j7 = void 0,
          _W4 = void 0,
          _k5 = void 0;
        var _V$splice = V.splice(0, 2);
        var _V$splice2 = _slicedToArray(_V$splice, 2);
        _U8 = _V$splice2[0];
        _j7 = _V$splice2[1];
        var _H7 = [_U8];
        for (; _U8 != _j7;) _H7.push(_j7), _W4 = V.indexOf(_j7), _k5 = _W4 % 2, _j7 = V.splice(_W4 - _k5, 2)[1 - _k5];
        S.subVectors(_H7[0], _H7[1]).cross(p.subVectors(_H7[0], _H7[2])).normalize();
        var _X9 = S.dot(_H7[0]) < 0;
        _X9 && S.negate();
        for (var _q10 = 1; _q10 <= _H7.length - 2; _q10++) [_H7[_q10 + +_X9], _H7[_q10 + 1 - +_X9], _H7[0]].forEach(function (G) {
          a.push(G.x, G.y, G.z), u.push(S.x, S.y, S.z);
        });
      }
    }
    function d() {
      var h = new _();
      for (var E = 0; E < a.length; E += 3) {
        h.x = a[E + 0], h.y = a[E + 1], h.z = a[E + 2];
        var b = w(h) / 2 / Math.PI + .5,
          T = A(h) / Math.PI + .5;
        l.push(b, 1 - T);
      }
      var f = new _(),
        p = new _(),
        m = new _(),
        g = new _(),
        y = new N(),
        v = new N(),
        x = new N(),
        S = function S(E, b, T, M) {
          M < 0 && E.x === 1 && (l[b] = E.x - 1), T.x === 0 && T.z === 0 && (l[b] = M / 2 / Math.PI + .5);
        };
      for (var _E18 = 0, _b15 = 0; _E18 < a.length; _E18 += 9, _b15 += 6) {
        f.set(a[_E18 + 0], a[_E18 + 1], a[_E18 + 2]), p.set(a[_E18 + 3], a[_E18 + 4], a[_E18 + 5]), m.set(a[_E18 + 6], a[_E18 + 7], a[_E18 + 8]), y.set(l[_b15 + 0], l[_b15 + 1]), v.set(l[_b15 + 2], l[_b15 + 3]), x.set(l[_b15 + 4], l[_b15 + 5]), g.copy(f).add(p).add(m).divideScalar(3);
        var _T10 = w(g);
        S(y, _b15 + 0, f, _T10), S(v, _b15 + 2, p, _T10), S(x, _b15 + 4, m, _T10);
      }
      for (var _E19 = 0; _E19 < l.length; _E19 += 6) {
        var _b16 = l[_E19 + 0],
          _T11 = l[_E19 + 2],
          M = l[_E19 + 4],
          C = Math.max(_b16, _T11, M),
          P = Math.min(_b16, _T11, M);
        C > .9 && P < .1 && (_b16 < .2 && (l[_E19 + 0] += 1), _T11 < .2 && (l[_E19 + 2] += 1), M < .2 && (l[_E19 + 4] += 1));
      }
      function w(E) {
        return Math.atan2(E.z, -E.x);
      }
      function A(E) {
        return Math.atan2(-E.y, Math.sqrt(E.x * E.x + E.z * E.z));
      }
    }
    return _this107;
  }
  _createClass(Cl, null, [{
    key: "fromJSON",
    value: function fromJSON(t) {
      return new Cl(t.vertices, t.indices, t.radius, t.corner, t.cornerSides);
    }
  }]);
  return Cl;
}(we);
var SO = /*#__PURE__*/function () {
    function SO() {
      _classCallCheck(this, SO);
    }
    _createClass(SO, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters4, _e$height4, _e$depth4;
        var e = Object.assign({}, (_t$parameters4 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters4 !== void 0 ? _t$parameters4 : {
          width: 100,
          detail: 0,
          corner: 0,
          cornerSides: 4
        }, n.parameters);
        return {
          parameters: Object.assign(e, {
            width: Math.abs(e.width),
            height: Math.abs((_e$height4 = e.height) !== null && _e$height4 !== void 0 ? _e$height4 : e.width),
            depth: Math.abs((_e$depth4 = e.depth) !== null && _e$depth4 !== void 0 ? _e$depth4 : e.width)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters4 = n.parameters,
          t = _n$parameters4.width,
          e = _n$parameters4.height,
          r = _n$parameters4.depth,
          i = _n$parameters4.detail,
          s = _n$parameters4.corner,
          o = _n$parameters4.cornerSides,
          a = i === 0 && s !== 0 ? new nm(t * .5, s, o) : new Nu(t * .5, i);
        return a.scale(1, e / t, r / t), Object.assign(a, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "DodecahedronGeometry"
          })
        });
      }
    }]);
    return SO;
  }(),
  nm = /*#__PURE__*/function (_Cl) {
    _inherits(nm, _Cl);
    var _super120 = _createSuper(nm);
    function nm() {
      var _this108;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : .2;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4;
      _classCallCheck(this, nm);
      var i = (1 + Math.sqrt(5)) / 2,
        s = 1 / i,
        o = [-1, -1, -1, -1, -1, 1, -1, 1, -1, -1, 1, 1, 1, -1, -1, 1, -1, 1, 1, 1, -1, 1, 1, 1, 0, -s, -i, 0, -s, i, 0, s, -i, 0, s, i, -s, -i, 0, -s, i, 0, s, -i, 0, s, i, 0, -i, 0, -s, i, 0, -s, -i, 0, s, i, 0, s],
        a = [3, 11, 7, 3, 7, 15, 3, 15, 13, 7, 19, 17, 7, 17, 6, 7, 6, 15, 17, 4, 8, 17, 8, 10, 17, 10, 6, 8, 0, 16, 8, 16, 2, 8, 2, 10, 0, 12, 1, 0, 1, 18, 0, 18, 16, 6, 10, 2, 6, 2, 13, 6, 13, 15, 2, 16, 18, 2, 18, 3, 2, 3, 13, 18, 1, 9, 18, 9, 11, 18, 11, 3, 4, 14, 12, 4, 12, 0, 4, 0, 8, 11, 9, 5, 11, 5, 19, 11, 19, 7, 19, 5, 14, 19, 14, 4, 19, 4, 17, 1, 12, 14, 1, 14, 5, 1, 5, 9],
        l = "DodecahedronGeometry";
      _this108 = _super120.call(this, o, a, l, t, e, r), _this108.type = l;
      return _this108;
    }
    _createClass(nm, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new nm(t.radius, t.corner, t.cornerSides);
      }
    }]);
    return nm;
  }(Cl);
var sm = 1e-12,
  mh = /*#__PURE__*/function () {
    function mh(t) {
      _classCallCheck(this, mh);
      this.position = new N();
      this.startPosition = new N();
      this.uuid = Se.generateUUID();
      this.position = t.clone();
    }
    _createClass(mh, [{
      key: "start",
      value: function start() {
        this.reset();
      }
    }, {
      key: "reset",
      value: function reset() {
        this.startPosition.copy(this.position);
      }
    }, {
      key: "applyOffset",
      value: function applyOffset(t) {
        this.position.copy(this.startPosition).add(t);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        return this.position.copy(t.position), this.startPosition.copy(t.startPosition), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new mh(this.position).copy(this);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        return [this.position.x, this.position.y];
      }
    }]);
    return mh;
  }(),
  gh = /*#__PURE__*/function (_mh) {
    _inherits(gh, _mh);
    var _super121 = _createSuper(gh);
    function gh(e) {
      var _this109;
      _classCallCheck(this, gh);
      _this109 = _super121.call(this, e.position);
      _this109.parent = e;
      return _this109;
    }
    _createClass(gh, [{
      key: "copy",
      value: function copy(e) {
        return _get(_getPrototypeOf(gh.prototype), "copy", this).call(this, e), this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new gh(this.parent).copy(this);
      }
    }]);
    return gh;
  }(mh),
  js = /*#__PURE__*/function (_mh2) {
    _inherits(js, _mh2);
    var _super122 = _createSuper(js);
    function js(e, r) {
      var _this110;
      _classCallCheck(this, js);
      _this110 = _super122.call(this, r);
      _this110.controls = [];
      _this110.roundness = 0;
      _this110.areControlsDirectionsMirrored = !0;
      _this110.uuid = e, _this110.controls.push(new gh(_assertThisInitialized(_this110)), new gh(_assertThisInitialized(_this110)));
      return _this110;
    }
    _createClass(js, [{
      key: "getOppositeControl",
      value: function getOppositeControl(e) {
        var r = this.controls.indexOf(e);
        return r === 0 ? this.controls[1] : r === 1 ? this.controls[0] : null;
      }
    }, {
      key: "applyOffsetToControls",
      value: function applyOffsetToControls(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
        for (var i = 0, s = this.controls.length; i < s; i++) {
          var o = this.controls[i];
          this.position.distanceTo(o.position) <= r ? o.position.copy(this.position) : o.applyOffset(e);
        }
      }
    }, {
      key: "controlsMoved",
      value: function controlsMoved() {
        return !(this.position.equals(this.controls[0].position) && this.position.equals(this.controls[1].position));
      }
    }, {
      key: "copy",
      value: function copy(e) {
        return _get(_getPrototypeOf(js.prototype), "copy", this).call(this, e), this.controls[0].copy(e.controls[0]), this.controls[1].copy(e.controls[1]), this.roundness = e.roundness, this.uuid = e.uuid, this;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new js(this.uuid, this.position).copy(this);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        return _get(_getPrototypeOf(js.prototype), "toJSON", this).call(this).concat(this.controls[0].toJSON(), this.controls[1].toJSON(), [this.roundness]);
      }
    }, {
      key: "computeTangents",
      value: function computeTangents() {
        var _this$curveBefore, _this$curveAfter;
        var e = (_this$curveBefore = this.curveBefore) === null || _this$curveBefore === void 0 ? void 0 : _this$curveBefore.getTangentAt(1),
          r = (_this$curveAfter = this.curveAfter) === null || _this$curveAfter === void 0 ? void 0 : _this$curveAfter.getTangentAt(0);
        return [e, r];
      }
    }, {
      key: "computeNormals",
      value: function computeNormals() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
        var _this$computeTangents = this.computeTangents(),
          _this$computeTangents2 = _slicedToArray(_this$computeTangents, 2),
          i = _this$computeTangents2[0],
          s = _this$computeTangents2[1];
        return i && s && (wO(i, e), wO(s, r)), [e, r];
      }
    }, {
      key: "computeTangent",
      value: function computeTangent() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
        var _this$computeTangents3 = this.computeTangents(),
          _this$computeTangents4 = _slicedToArray(_this$computeTangents3, 2),
          r = _this$computeTangents4[0],
          i = _this$computeTangents4[1];
        return r && i && e.copy(r).add(i).normalize(), e;
      }
    }, {
      key: "computeNormal",
      value: function computeNormal() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
        var _this$computeNormals = this.computeNormals(),
          _this$computeNormals2 = _slicedToArray(_this$computeNormals, 2),
          r = _this$computeNormals2[0],
          i = _this$computeNormals2[1];
        return e.copy(r).add(i).normalize(), e;
      }
    }], [{
      key: "create",
      value: function create(e, r) {
        var _i$controls$0$positio, _i$controls$1$positio;
        var i = new js(e, _construct(N, _toConsumableArray(r.position)));
        return (_i$controls$0$positio = i.controls[0].position).set.apply(_i$controls$0$positio, _toConsumableArray(r.controlPrevious.position)), (_i$controls$1$positio = i.controls[1].position).set.apply(_i$controls$1$positio, _toConsumableArray(r.controlNext.position)), i.roundness = r.roundness, i.areControlsDirectionsMirrored = r.areControlsDirectionsMirrored, i;
      }
    }]);
    return js;
  }(mh);
function wO(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
  var e = n.length();
  return t.set(-n.y / e, n.x / e);
}
var Y1 = function Y1(n) {
    return n;
  },
  yh = new N(),
  g0 = new N(),
  N9 = new N(),
  F9 = new N(),
  k9 = new N(),
  z9 = new N(),
  _O = new _(),
  EO = new _();
function TO(n) {
  var t = new N();
  t.addVectors(n.v0, yh.subVectors(n.v1, n.v0).multiplyScalar(2 / 3));
  var e = new N();
  return e.addVectors(n.v2, g0.subVectors(n.v1, n.v2).multiplyScalar(2 / 3)), new rn(n.v0, t, e, n.v2);
}
function om(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Number.EPSILON;
  return Math.abs(n - t) < e;
}
function V9(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Number.EPSILON;
  return n.distanceTo(t) < e;
}
function U9(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Number.EPSILON;
  return n.distanceTo(t) < e;
}
function X1(n, t, e) {
  var r = Math.sqrt(Math.pow(t.x - n.x, 2) + Math.pow(t.y - n.y, 2)),
    i = Math.sqrt(Math.pow(t.x - e.x, 2) + Math.pow(t.y - e.y, 2)),
    s = Math.sqrt(Math.pow(e.x - n.x, 2) + Math.pow(e.y - n.y, 2));
  return Math.acos((i * i + r * r - s * s) / (2 * i * r));
}
function MO(n, t, e) {
  return AO(n, t) && AO(t, e) && q1(n.position, t.position, e.position);
}
function q1(n, t, e) {
  return yh.copy(t).sub(n).cross(g0.copy(e).sub(n)) === 0;
}
function CO(n, t, e, r, i) {
  var s = Math.sqrt(Math.pow(t.x - n.x, 2) + Math.pow(t.y - n.y, 2)),
    o = (n.y + t.y) / 2,
    a = (n.x + t.x) / 2,
    l = Math.sqrt(Math.pow(e, 2) - Math.pow(s / 2, 2)) * (n.y - t.y) / s,
    u = Math.sqrt(Math.pow(e, 2) - Math.pow(s / 2, 2)) * (t.x - n.x) / s;
  return r.set(a + l, o + u), i.set(a - l, o - u), [r, i];
}
function PO(n, t, e) {
  var r = n.distanceTo(e),
    i = t.distanceTo(e);
  return r < i ? t : n;
}
function DO(n, t, e, r, i, s) {
  var o = t.x - n.x,
    a = t.y - n.y,
    l = e.x - n.x,
    u = e.y - n.y,
    c = Math.sqrt((o + l) * (o + l) + (a + u) * (a + u)),
    d;
  return X1(t, n, e) > Math.PI && (c *= -1), om(u, a) ? d = (a + u) * (r / c - .5) * 8 / 3 / (o - l) : d = (o + l) * (r / c - .5) * 8 / 3 / (u - a), i.set(t.x - d * a, t.y + d * o), s.set(e.x + d * u, e.y - d * l), [i, s];
}
function Q1(n, t) {
  return n.position.equals(n.controls[1].position) && t.position.equals(t.controls[0].position);
}
function AO(n, t) {
  return q1(n.position, n.controls[1].position, t.position) && q1(n.position, t.controls[0].position, t.position);
}
function OO(n, t, e, r) {
  var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : .5;
  var s = yh.subVectors(t, n).multiplyScalar(i).add(n),
    o = g0.subVectors(e, t).multiplyScalar(i).add(t),
    a = N9.subVectors(r, e).multiplyScalar(i).add(e),
    l = s,
    u = F9.subVectors(o, s).multiplyScalar(i).add(s),
    c = k9.subVectors(a, o).multiplyScalar(i).add(o),
    d = a,
    h = z9.subVectors(c, u).multiplyScalar(i).add(u);
  return [n.x, n.y, l.x, l.y, u.x, u.y, h.x, h.y, c.x, c.y, d.x, d.y, r.x, r.y];
}
function IO(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 12;
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !0;
  var i = EO.set(0, 0, 0),
    s,
    o = 0,
    a = [];
  for (var l = 0; l < t.length; l++) {
    var u = Y1(t[l]),
      c = yh,
      d = Pl(u, e);
    a.push(d);
    for (var h = 0; h <= d; h++) if (u instanceof rn || u instanceof Wn || u instanceof nn) {
      if (u.getPoint(h / d, c), i.set(c.x, c.y, 0), s !== void 0 && U9(s, i)) continue;
      s === void 0 && (s = _O), s.copy(i), n.setXYZ(o, i.x, i.y, i.z), o++;
    }
  }
  return r && o > 1 && !(n.getX(o - 1) === n.getX(0) && n.getY(o - 1) === n.getY(0) && n.getZ(o - 1) === n.getZ(0)) && (n.setXYZ(o, n.getX(0), n.getY(0), n.getZ(0)), o++), n;
}
function RO(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 12;
  var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !0;
  var s = EO.set(0, 0, 0),
    o = 0,
    a = [];
  for (var l = 0; l < t.length; l++) {
    if (e[l] === !1) continue;
    var u = void 0,
      c = Y1(t[l]),
      d = yh,
      h = Pl(c, r);
    a.push(h);
    for (var f = 0; f <= h; f++) if (c instanceof rn || c instanceof Wn || c instanceof nn) {
      var _u26;
      if (c.getPoint(f / h, d), s.set(d.x, d.y, 0), (_u26 = u) !== null && _u26 !== void 0 && _u26.equals(s)) continue;
      u === void 0 ? u = _O : (n.setXYZ(o, u.x, u.y, u.z), o++, n.setXYZ(o, s.x, s.y, s.z), o++), u.copy(s);
    }
  }
  return i && o > 1 && !(n.getX(o - 1) === n.getX(0) && n.getY(o - 1) === n.getY(0) && n.getZ(o - 1) === n.getZ(0)) && (n.setXYZ(o, n.getX(0), n.getY(0), n.getZ(0)), o++), a;
}
function K1(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
  var r = [];
  for (var i = 0, s = n.length; i < s; i++) {
    var o = n[i],
      a = 0;
    if (e && o.roundedCurveCorner !== void 0) {
      var l = Pl(o.roundedCurveCorner, t) * .5;
      i > 0 && (r[i - 1] += l), a += l;
    }
    o.curveAfter !== void 0 && (a += Pl(o.curveAfter, t)), r.push(a);
  }
  return n.length > 0 && e && n[0].roundedCurveCorner !== void 0 && (r[n.length - 1] += Pl(n[0].roundedCurveCorner, t) * .5), r;
}
function Pl(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
  return n && n instanceof mc ? t * 2 : n && (n instanceof nn || n instanceof pp) ? 1 : n && n instanceof Ru ? t * n.points.length : t;
}
function LO(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 12;
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !0;
  var i,
    s = 0;
  for (var o = 0; o < t.length; o++) {
    var a = Y1(t[o]),
      l = Pl(a, e),
      u = yh;
    for (var c = 0; c <= l; c++) if (a instanceof rn || a instanceof Wn || a instanceof nn) {
      if (a.getPoint(c / l, u), i !== void 0 && V9(i, u, sm)) continue;
      i === void 0 && (i = g0), i.copy(u), n.push(u.x, u.y), s++;
    }
  }
  return om(n[0], n[n.length - 2], sm) && om(n[1], n[n.length - 1], sm) && (n.pop(), n.pop()), r && s > 1 && !(om(n[s - 1], n[1], sm) && om(n[s - 2], n[0], sm)) && (n.push(n[0], n[1]), s++), n;
}
var Z1 = new N(),
  G9 = new N(),
  j9 = new N(),
  H9 = new N(),
  W9 = new N(),
  q9 = new N(),
  kt = /*#__PURE__*/function (_oa) {
    _inherits(kt, _oa);
    var _super123 = _createSuper(kt);
    function kt() {
      var _this111;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 100;
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;
      _classCallCheck(this, kt);
      _this111 = _super123.call(this);
      _this111.points = [];
      _this111.shapeHoles = [];
      _this111.plane = new qr(new _(0, 0, -1));
      _this111.subdivision = 0;
      _this111.controlSnapDistance = 4;
      _this111.pointIDs = 0;
      _this111.isMesh2D = !1;
      _this111.isText = !1;
      _this111._roundness = 0;
      _this111.isClosed = !1;
      _this111.useCubicForRoundedCorners = !0;
      _this111.uuid = Se.generateUUID();
      _this111.needsUpdate = !1;
      _this111.roundedCurves = [];
      _this111._width = e, _this111._height = r;
      return _this111;
    }
    _createClass(kt, [{
      key: "width",
      get: function get() {
        return this._width;
      }
    }, {
      key: "height",
      get: function get() {
        return this._height;
      }
    }, {
      key: "roundness",
      get: function get() {
        return this._roundness;
      },
      set: function set(e) {
        if (this._roundness !== e) {
          this._roundness = e;
          for (var r = 0, i = this.points.length; r < i; r++) this.points[r].roundness = e;
          this.needsUpdate = !0;
        }
      }
    }, {
      key: "getPointsIndexesByIds",
      value: function getPointsIndexesByIds(e) {
        var _this112 = this;
        return e.map(function (r) {
          return _this112.getPointIndexById(r);
        }).filter(function (r) {
          return r >= 0;
        });
      }
    }, {
      key: "getPointIndexById",
      value: function getPointIndexById(e) {
        var r = this.points.length,
          i = this.points.findIndex(function (s) {
            return s.uuid === e;
          });
        if (i < 0) {
          var s = r;
          for (var o = 0, a = this.shapeHoles.length; o < a; o++) {
            var l = this.shapeHoles[o],
              u = l.points.length,
              c = l.getPointIndexById(e);
            if (c < 0) s += u;else return c + s;
          }
        }
        return i;
      }
    }, {
      key: "getLineIndexById",
      value: function getLineIndexById(e) {
        return this.getPointIndexById(e);
      }
    }, {
      key: "getBezierPoint",
      value: function getBezierPoint(e) {
        if (e <= this.points.length - 1) return this.points[e];
        if (this.shapeHoles.length > 0) {
          var r = this.points.length;
          for (var i = 0, s = this.shapeHoles.length; i < s; i++) {
            var o = this.shapeHoles[i],
              a = e - r;
            if (a <= o.points.length - 1) return o.points[a];
            r += o.points.length;
          }
        }
        throw new Error("This shape does not have a point for this index: " + e);
      }
    }, {
      key: "getBezierPointIndex",
      value: function getBezierPointIndex(e) {
        var r = this.points.indexOf(e);
        if (r >= 0) return r;
        if (r = this.points.length, this.shapeHoles.length > 0) for (var i = 0, s = this.shapeHoles.length; i < s; i++) {
          var o = this.shapeHoles[i],
            a = o.points.indexOf(e);
          if (a >= 0) return r + a;
          r += o.points.length;
        }
        return -1;
      }
    }, {
      key: "getAllPoints",
      value: function getAllPoints() {
        var _ref20;
        var e = (_ref20 = []).concat.apply(_ref20, _toConsumableArray(this.shapeHoles.map(function (r) {
          return r.points;
        })));
        return [].concat(_toConsumableArray(this.points), _toConsumableArray(e));
      }
    }, {
      key: "applySize",
      value: function applySize(e, r) {
        e === 0 && (e = .001), r === 0 && (r = .001), this._width = e, this._height = r;
      }
    }, {
      key: "applyScale",
      value: function applyScale(e, r) {
        var i = Z1.set(e, r);
        for (var s = 0, o = this.points.length; s < o; s++) {
          var a = this.points[s];
          a.position.multiply(i), a.controls[0].position.multiply(i), a.controls[1].position.multiply(i);
        }
        for (var _s21 = 0, _o19 = this.shapeHoles.length; _s21 < _o19; _s21++) this.shapeHoles[_s21].applyScale(e, r);
        this._update();
      }
    }, {
      key: "createPoint",
      value: function createPoint(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : Se.generateUUID();
        var s;
        e instanceof N ? s = e : s = new N(e, r);
        var o = new js(i, s);
        return o.roundness = this.roundness, o;
      }
    }, {
      key: "addPoint",
      value: function addPoint(e) {
        this.points.push(e), this.needsUpdate = !0;
      }
    }, {
      key: "addPointAt",
      value: function addPointAt(e, r) {
        this.points.splice(r, 0, e), this.needsUpdate = !0;
      }
    }, {
      key: "getPointByUuid",
      value: function getPointByUuid(e) {
        for (var r = 0, i = this.points.length; r < i; r++) {
          var s = this.points[r];
          if (s.uuid === e) return s;
        }
        for (var _r17 = 0, _i44 = this.shapeHoles.length; _r17 < _i44; _r17++) {
          var o = this.shapeHoles[_r17].getPointByUuid(e);
          if (o) return o;
        }
      }
    }, {
      key: "getFirstPoint",
      value: function getFirstPoint() {
        return this.points[0];
      }
    }, {
      key: "getLastPoint",
      value: function getLastPoint() {
        return this.points[this.points.length - 1];
      }
    }, {
      key: "removePoint",
      value: function removePoint(e) {
        var r = this.points.indexOf(e);
        r >= 0 && this.points.splice(r, 1), this.needsUpdate = !0;
      }
    }, {
      key: "removePointById",
      value: function removePointById(e) {
        var r = this.points.find(function (i) {
          return i.uuid === e;
        });
        r && this.removePoint(r);
      }
    }, {
      key: "update",
      value: function update() {
        for (var e = 0, r = this.shapeHoles.length; e < r; e++) this.shapeHoles[e].update();
        this._update();
      }
    }, {
      key: "extractShapePointsToBuffer",
      value: function extractShapePointsToBuffer(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        this.subdivision = r, this.curveDivisions === void 0 && this.computeCurveDivisions(r);
        var s = i ? this.roundedCurveDivisions : this.curveDivisions;
        return IO(e, i ? this.roundedCurves : this.curves, r, this.autoClose), s.reduce(function (o, a) {
          return o + a;
        }, 0) + 1;
      }
    }, {
      key: "computeCurveDivisions",
      value: function computeCurveDivisions() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 12;
        return this.curveDivisions = K1(this.points, e, !1), this.roundedCurveDivisions = K1(this.points, e, !0), this.curveDivisions;
      }
    }, {
      key: "extractFilteredShapePointsToBuffer",
      value: function extractFilteredShapePointsToBuffer(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 12;
        return RO(e, this.curves, r, i, this.autoClose).reduce(function (o, a) {
          return o + a;
        }, 0) * 2;
      }
    }, {
      key: "extractShapePointsToFlatArray",
      value: function extractShapePointsToFlatArray(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
        return this.subdivision = r, this.curveDivisions === void 0 && this.computeCurveDivisions(r), LO(e, this.roundedCurves, r, this.autoClose);
      }
    }, {
      key: "getCurveIndexFromVertexId",
      value: function getCurveIndexFromVertexId(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        var i = 0;
        this.curveDivisions === void 0 && this.computeCurveDivisions(this.subdivision);
        var s = r ? this.roundedCurveDivisions : this.curveDivisions,
          o = 0;
        r && this.points[0].roundedCurveCorner !== void 0 && (o = Pl(this.points[0].roundedCurveCorner, this.subdivision) * .5);
        var a = e - o;
        a < 0 && (a += s.reduce(function (l, u) {
          return l + u;
        }, 0));
        for (var l = 0, u = s.length; l < u; l++) {
          var c = s[l];
          if (a < i + c) return [l, (a - i + 1) / c];
          i += c;
        }
        return [0, 1];
      }
    }, {
      key: "getCurveT",
      value: function getCurveT(e, r, i) {
        var s = this.points[e],
          o = this.points[e >= this.points.length - 1 ? 0 : e + 1],
          a = this.curveDivisions,
          l = a[e];
        if (Q1(s, o)) {
          var d = s.position.distanceTo(o.position);
          return s.position.distanceTo(Z1.set(i.x, i.y)) / d;
        }
        var u = 0;
        for (var _d37 = 0; _d37 < e; _d37++) u += a[_d37];
        return (r - u) / l;
      }
    }, {
      key: "dispose",
      value: function dispose() {}
    }, {
      key: "_applyCurveForPoint",
      value: function _applyCurveForPoint(e, r) {
        Q1(r, e) ? this.lineTo(e.position.x, e.position.y) : this.bezierCurveTo(r.controls[1].position.x, r.controls[1].position.y, e.controls[0].position.x, e.controls[0].position.y, e.position.x, e.position.y);
        var i = this.curves[this.curves.length - 1];
        e.curveBefore = i, r.curveAfter = i;
        var s = i.clone();
        e.roundedCurveBefore = s, r.roundedCurveAfter = s, e.roundedCurveCorner = void 0, this.roundedCurves.push(s);
      }
    }, {
      key: "_update",
      value: function _update() {
        if (this.curves = [], this.roundedCurves = [], !this.points.length) return;
        for (var r = 0, i = this.points.length; r < i; r++) {
          var s = this.points[r];
          if (r === 0) this.moveTo(s.position.x, s.position.y);else {
            var o = this.points[r - 1];
            this._applyCurveForPoint(s, o);
          }
        }
        var e = this.getLastPoint();
        if (e !== null && e !== void 0 && e.curveAfter && (e.curveAfter = void 0), this.isClosed) {
          var _r18 = this.points[0],
            _i45 = this.points[this.points.length - 1];
          this._applyCurveForPoint(_r18, _i45);
        }
        if (this.points.length > 2) {
          var _r19 = 0;
          for (var _i46 = 0, _s22 = this.points.length; _i46 < _s22; _i46++) {
            var _this$points, _this$points2;
            var _o20 = this.points[_i46],
              a = (_this$points = this.points[_i46 - 1]) !== null && _this$points !== void 0 ? _this$points : this.points[this.points.length - 1],
              l = (_this$points2 = this.points[_i46 + 1]) !== null && _this$points2 !== void 0 ? _this$points2 : this.points[0],
              u = _o20.roundness,
              c = a && l && MO(a, _o20, l);
            if (!_o20.controlsMoved() && u > 0 && !c) {
              var d = _o20.curveBefore,
                h = _o20.curveAfter;
              if (d === void 0 || h === void 0) continue;
              var f = _o20.roundedCurveBefore,
                p = _o20.roundedCurveAfter,
                m = d.getLength(),
                g = h.getLength(),
                y = Math.min(u, m * .499),
                v = Math.min(u, g * .499),
                x = Math.min(y, v),
                S = 1 - x / m,
                w = x / g,
                A = d.getPointAt(S, Z1),
                E = h.getPointAt(w, G9);
              this._subSplitCurve(d, f, S, A, void 0), this._subSplitCurve(h, p, w, void 0, E);
              var b = void 0;
              if (this.useCubicForRoundedCorners) {
                var T = X1(A, _o20.position, E) / 2,
                  M = Math.tan(T) * A.distanceTo(_o20.position),
                  _CO = CO(A, E, M, j9, H9),
                  _CO2 = _slicedToArray(_CO, 2),
                  C = _CO2[0],
                  P = _CO2[1],
                  D = PO(C, P, _o20.position),
                  _DO = DO(D, A, E, M, W9, q9),
                  _DO2 = _slicedToArray(_DO, 2),
                  O = _DO2[0],
                  I = _DO2[1];
                b = new rn(A.clone(), O.clone(), I.clone(), E.clone());
              } else b = new Wn(A.clone(), _o20.position.clone(), E.clone());
              _o20.roundedCurveCorner = b, this.roundedCurves.splice(_i46 + _r19, 0, b), _r19++;
            }
          }
        }
      }
    }, {
      key: "_subSplitCurve",
      value: function _subSplitCurve(e, r, i, s, o) {
        if (e instanceof nn) s !== void 0 && r.v2.copy(s), o !== void 0 && r.v1.copy(o);else {
          var a = e,
            l = r,
            u = a.getUtoTmapping(i, 0),
            c = OO(a.v0, a.v1, a.v2, a.v3, u);
          return s !== void 0 && (l.v0.set(c[0], c[1]), l.v1.set(c[2], c[3]), l.v2.set(c[4], c[5]), l.v3.set(c[6], c[7])), o !== void 0 && (l.v0.set(c[6], c[7]), l.v1.set(c[8], c[9]), l.v2.set(c[10], c[11]), l.v3.set(c[12], c[13])), l;
        }
        return r;
      }
    }, {
      key: "clone",
      value: function clone() {
        var e = new kt(this._width, this._height);
        return e.points = this.points.map(function (r) {
          return r.clone();
        }), e.isClosed = this.isClosed, e.roundness = this.roundness, e.isMesh2D = this.isMesh2D, e.shapeHoles = this.shapeHoles.map(function (r) {
          return r.clone();
        }), e;
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        return {
          points: this.points.reduce(function (e, r) {
            return e.concat(r.toJSON());
          }, []),
          shapeHoles: this.shapeHoles.map(function (e) {
            return e.toJSON();
          }),
          isClosed: this.isClosed,
          roundness: this.roundness
        };
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(e) {
        var _e$shapeHoles;
        this.points = [], this.pointIDs = 0;
        var r = e.points.length / 7;
        for (var i = 0; i < r; i++) {
          var s = i * 7,
            o = e.points[s + 0],
            a = e.points[s + 1],
            l = e.points[s + 2],
            u = e.points[s + 3],
            c = e.points[s + 4],
            d = e.points[s + 5],
            h = e.points[s + 6],
            f = new js(Se.generateUUID(), new N(o, a));
          f.controls[0].position.set(l, u), f.controls[1].position.set(c, d), f.roundness = h, this.points.push(f);
        }
        return this.shapeHoles = (_e$shapeHoles = e.shapeHoles) !== null && _e$shapeHoles !== void 0 && _e$shapeHoles.length ? e.shapeHoles.map(function (i) {
          var s = new kt();
          return s.fromJSON(i), s;
        }) : [], this.isClosed = e.isClosed, this._roundness = e.roundness, this._update(), this;
      }
    }, {
      key: "fromShape",
      value: function fromShape(e) {
        var _this113 = this;
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        this.isText = r;
        var i = function i(o, a) {
            a instanceof rn && a.v3.equals(o.position) && o.controls[0].position.copy(a.v2);
          },
          s = function s(o) {
            var a = [],
              l,
              u;
            for (l = 0, u = o.length; l < u; l++) o[l] instanceof Wn && (o[l] = TO(o[l]));
            for (l = 0, u = o.length; l < u; l++) {
              var h = o[l],
                f = l > 0 ? o[l - 1] : null,
                p = void 0;
              h instanceof rn ? (p = _this113.createPoint(h.v0), p.controls[1].position.copy(h.v1)) : h instanceof nn && (p = _this113.createPoint(h.v1)), p !== void 0 && (f !== null && i(p, f), a.push(p));
            }
            var c = o[o.length - 1],
              d = !1;
            return c instanceof rn ? c.v3.equals(a[0].position) && (a[0].controls[0].position.copy(c.v2), d = !0) : c instanceof nn && c.v2.equals(a[0].position) && (d = !0), _this113.isClosed = d, a;
          };
        return this.points = s(e.curves), e instanceof oa && (this.shapeHoles = e.holes.map(function (o) {
          var a = new kt();
          return a.fromShape(o), a;
        })), this.update(), this;
      }
    }, {
      key: "updatePoint",
      value: function updatePoint(e, r) {
        var i = this.getPointByUuid(e);
        i && (r.position !== void 0 && i.position.fromArray(r.position), r.roundness !== void 0 && (i.roundness = r.roundness), r.areControlsDirectionsMirrored !== void 0 && (i.areControlsDirectionsMirrored = r.areControlsDirectionsMirrored), this.needsUpdate = !0);
      }
    }, {
      key: "updatePreviousControl",
      value: function updatePreviousControl(e, r) {
        var _this$getPointByUuid;
        var s = (_this$getPointByUuid = this.getPointByUuid(e)) === null || _this$getPointByUuid === void 0 ? void 0 : _this$getPointByUuid.controls[0];
        s && (r.position && s.position.fromArray(r.position), this.needsUpdate = !0);
      }
    }, {
      key: "updateNextControl",
      value: function updateNextControl(e, r) {
        var _this$getPointByUuid2;
        var s = (_this$getPointByUuid2 = this.getPointByUuid(e)) === null || _this$getPointByUuid2 === void 0 ? void 0 : _this$getPointByUuid2.controls[1];
        s && (r.position && s.position.fromArray(r.position), this.needsUpdate = !0);
      }
    }], [{
      key: "createFromState",
      value: function createFromState(e, r, i) {
        var s = new kt();
        return s.isClosed = e.isClosed, s.points = e.points.map(function (o) {
          return js.create(o.id, o.data);
        }), typeof e.roundness == "number" && (s.roundness = e.roundness), s.shapeHoles = e.shapeHoles.map(function (o) {
          return kt.createFromState(o);
        }), r !== void 0 && i !== void 0 && s.applySize(r, i), s.update(), s;
      }
    }]);
    return kt;
  }(oa);
var $1 = Math.PI * 2;
function J1(_ref21, e, r, i, s) {
  var n = _ref21.x,
    t = _ref21.y;
  return {
    x: n * e + i,
    y: t * r + s
  };
}
function Y9(n, t) {
  var e = t === 1.5707963267948966 ? .551915024494 : t === -1.5707963267948966 ? -.551915024494 : 1.3333333333333333 * Math.tan(t / 4),
    r = Math.cos(n),
    i = Math.sin(n),
    s = Math.cos(n + t),
    o = Math.sin(n + t);
  return [{
    x: r - i * e,
    y: i + r * e
  }, {
    x: s + o * e,
    y: o - s * e
  }, {
    x: s,
    y: o
  }];
}
function BO(n, t, e, r) {
  var i = n * r - t * e < 0 ? -1 : 1,
    s = Math.min(1, Math.max(-1, n * e + t * r));
  return i * Math.acos(s);
}
function X9(n, t, e, r, i, s, o, a, l, u) {
  var c = Math.pow(i, 2),
    d = Math.pow(s, 2),
    h = Math.pow(o, 2),
    f = Math.pow(a, 2),
    p = c * d - c * f - d * h;
  p < 0 && (p = 0), p /= c * f + d * h, p = Math.sqrt(p) * (l === u ? -1 : 1);
  var m = p * i / s * a,
    g = p * -s / i * o,
    y = m + (n + e) / 2,
    v = g + (t + r) / 2,
    x = (o - m) / i,
    S = (a - g) / s,
    w = (-o - m) / i,
    A = (-a - g) / s,
    E = BO(1, 0, x, S),
    b = BO(x, S, w, A);
  return !u && b > 0 && (b -= $1), u && b < 0 && (b += $1), {
    centerx: y,
    centery: v,
    ang1: E,
    ang2: b
  };
}
function NO(_ref22) {
  var n = _ref22.px,
    t = _ref22.py,
    e = _ref22.cx,
    r = _ref22.cy,
    i = _ref22.rx,
    s = _ref22.ry,
    o = _ref22.largeArcFlag,
    a = _ref22.sweepFlag;
  var l = [];
  if (i === 0 || s === 0) return [];
  var u = (n - e) / 2,
    c = (t - r) / 2;
  if (u === 0 && c === 0) return [];
  i = Math.abs(i), s = Math.abs(s);
  var d = Math.pow(u, 2) / Math.pow(i, 2) + Math.pow(c, 2) / Math.pow(s, 2);
  d > 1 && (i *= Math.sqrt(d), s *= Math.sqrt(d));
  var h = X9(n, t, e, r, i, s, u, c, o, a),
    f = h.ang1,
    p = h.ang2,
    m = h.centerx,
    g = h.centery,
    y = Math.abs(p) / ($1 / 4);
  Math.abs(1 - y) < 1e-7 && (y = 1);
  var v = Math.max(Math.ceil(y), 1);
  p /= v;
  for (var x = 0; x < v; x++) l.push(Y9(f, p)), f += p;
  return l.map(function (x) {
    var _J9 = J1(x[0], i, s, m, g),
      S = _J9.x,
      w = _J9.y,
      _J10 = J1(x[1], i, s, m, g),
      A = _J10.x,
      E = _J10.y,
      _J11 = J1(x[2], i, s, m, g),
      b = _J11.x,
      T = _J11.y;
    return {
      x1: S,
      y1: w,
      x2: A,
      y2: E,
      x: b,
      y: T
    };
  });
}
var Mt;
(function (n) {
  n[n.ODD = 0] = "ODD", n[n.NONZERO = 1] = "NONZERO", n[n.POSITIVE = 2] = "POSITIVE", n[n.NEGATIVE = 3] = "NEGATIVE", n[n.ABS_GEQ_TWO = 4] = "ABS_GEQ_TWO";
})(Mt || (Mt = {}));
var Rr;
(function (n) {
  n[n.POLYGONS = 0] = "POLYGONS", n[n.CONNECTED_POLYGONS = 1] = "CONNECTED_POLYGONS", n[n.BOUNDARY_CONTOURS = 2] = "BOUNDARY_CONTOURS";
})(Rr || (Rr = {}));
function nt(n, t) {
  if (!n) throw t || "Assertion Failed!";
}
var $e = function () {
    function n() {}
    return n.vertEq = function (t, e) {
      return t.s === e.s && t.t === e.t;
    }, n.vertLeq = function (t, e) {
      return t.s < e.s || t.s === e.s && t.t <= e.t;
    }, n.transLeq = function (t, e) {
      return t.t < e.t || t.t === e.t && t.s <= e.s;
    }, n.edgeGoesLeft = function (t) {
      return n.vertLeq(t.Dst, t.Org);
    }, n.edgeGoesRight = function (t) {
      return n.vertLeq(t.Org, t.Dst);
    }, n.vertL1dist = function (t, e) {
      return Math.abs(t.s - e.s) + Math.abs(t.t - e.t);
    }, n.edgeEval = function (t, e, r) {
      nt(n.vertLeq(t, e) && n.vertLeq(e, r));
      var i = e.s - t.s,
        s = r.s - e.s;
      return i + s > 0 ? i < s ? e.t - t.t + (t.t - r.t) * (i / (i + s)) : e.t - r.t + (r.t - t.t) * (s / (i + s)) : 0;
    }, n.edgeSign = function (t, e, r) {
      nt(n.vertLeq(t, e) && n.vertLeq(e, r));
      var i = e.s - t.s,
        s = r.s - e.s;
      return i + s > 0 ? (e.t - r.t) * i + (e.t - t.t) * s : 0;
    }, n.transEval = function (t, e, r) {
      nt(n.transLeq(t, e) && n.transLeq(e, r));
      var i = e.t - t.t,
        s = r.t - e.t;
      return i + s > 0 ? i < s ? e.s - t.s + (t.s - r.s) * (i / (i + s)) : e.s - r.s + (r.s - t.s) * (s / (i + s)) : 0;
    }, n.transSign = function (t, e, r) {
      nt(n.transLeq(t, e) && n.transLeq(e, r));
      var i = e.t - t.t,
        s = r.t - e.t;
      return i + s > 0 ? (e.s - r.s) * i + (e.s - t.s) * s : 0;
    }, n.vertCCW = function (t, e, r) {
      return t.s * (e.t - r.t) + e.s * (r.t - t.t) + r.s * (t.t - e.t) >= 0;
    }, n.interpolate = function (t, e, r, i) {
      return t = t < 0 ? 0 : t, r = r < 0 ? 0 : r, t <= r ? r === 0 ? (e + i) / 2 : e + (i - e) * (t / (t + r)) : i + (e - i) * (r / (t + r));
    }, n.intersect = function (t, e, r, i, s) {
      var o, a, l;
      n.vertLeq(t, e) || (l = t, t = e, e = l), n.vertLeq(r, i) || (l = r, r = i, i = l), n.vertLeq(t, r) || (l = t, t = r, r = l, l = e, e = i, i = l), n.vertLeq(r, e) ? n.vertLeq(e, i) ? (o = n.edgeEval(t, r, e), a = n.edgeEval(r, e, i), o + a < 0 && (o = -o, a = -a), s.s = n.interpolate(o, r.s, a, e.s)) : (o = n.edgeSign(t, r, e), a = -n.edgeSign(t, i, e), o + a < 0 && (o = -o, a = -a), s.s = n.interpolate(o, r.s, a, i.s)) : s.s = (r.s + e.s) / 2, n.transLeq(t, e) || (l = t, t = e, e = l), n.transLeq(r, i) || (l = r, r = i, i = l), n.transLeq(t, r) || (l = t, t = r, r = l, l = e, e = i, i = l), n.transLeq(r, e) ? n.transLeq(e, i) ? (o = n.transEval(t, r, e), a = n.transEval(r, e, i), o + a < 0 && (o = -o, a = -a), s.t = n.interpolate(o, r.t, a, e.t)) : (o = n.transSign(t, r, e), a = -n.transSign(t, i, e), o + a < 0 && (o = -o, a = -a), s.t = n.interpolate(o, r.t, a, i.t)) : s.t = (r.t + e.t) / 2;
    }, n;
  }(),
  am = function () {
    function n() {
      this.next = null, this.prev = null, this.anEdge = null, this.trail = null, this.n = 0, this.marked = !1, this.inside = !1;
    }
    return n;
  }(),
  y0 = function () {
    function n(t) {
      this.side = t, this.next = null, this.Org = null, this.Sym = null, this.Onext = null, this.Lnext = null, this.Lface = null, this.activeRegion = null, this.winding = 0;
    }
    return Object.defineProperty(n.prototype, "Rface", {
      get: function get() {
        return this.Sym.Lface;
      },
      set: function set(t) {
        this.Sym.Lface = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Dst", {
      get: function get() {
        return this.Sym.Org;
      },
      set: function set(t) {
        this.Sym.Org = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Oprev", {
      get: function get() {
        return this.Sym.Lnext;
      },
      set: function set(t) {
        this.Sym.Lnext = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Lprev", {
      get: function get() {
        return this.Onext.Sym;
      },
      set: function set(t) {
        this.Onext.Sym = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Dprev", {
      get: function get() {
        return this.Lnext.Sym;
      },
      set: function set(t) {
        this.Lnext.Sym = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Rprev", {
      get: function get() {
        return this.Sym.Onext;
      },
      set: function set(t) {
        this.Sym.Onext = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Dnext", {
      get: function get() {
        return this.Sym.Onext.Sym;
      },
      set: function set(t) {
        this.Sym.Onext.Sym = t;
      },
      enumerable: !0,
      configurable: !0
    }), Object.defineProperty(n.prototype, "Rnext", {
      get: function get() {
        return this.Sym.Lnext.Sym;
      },
      set: function set(t) {
        this.Sym.Lnext.Sym = t;
      },
      enumerable: !0,
      configurable: !0
    }), n;
  }(),
  vh = function () {
    function n() {
      this.next = null, this.prev = null, this.anEdge = null, this.coords = [0, 0, 0], this.s = 0, this.t = 0, this.pqHandle = 0, this.n = 0, this.idx = 0;
    }
    return n;
  }(),
  FO = function () {
    function n() {
      var t = new vh(),
        e = new am(),
        r = new y0(0),
        i = new y0(1);
      t.next = t.prev = t, t.anEdge = null, e.next = e.prev = e, r.next = r, r.Sym = i, i.next = i, i.Sym = r, this.vHead = t, this.fHead = e, this.eHead = r, this.eHeadSym = i;
    }
    return n.prototype.makeEdge_ = function (t) {
      var e = new y0(0),
        r = new y0(1);
      t.Sym.side < t.side && (t = t.Sym);
      var i = t.Sym.next;
      return r.next = i, i.Sym.next = e, e.next = t, t.Sym.next = r, e.Sym = r, e.Onext = e, e.Lnext = r, e.Org = null, e.Lface = null, e.winding = 0, e.activeRegion = null, r.Sym = e, r.Onext = r, r.Lnext = e, r.Org = null, r.Lface = null, r.winding = 0, r.activeRegion = null, e;
    }, n.prototype.splice_ = function (t, e) {
      var r = t.Onext,
        i = e.Onext;
      r.Sym.Lnext = e, i.Sym.Lnext = t, t.Onext = i, e.Onext = r;
    }, n.prototype.makeVertex_ = function (t, e, r) {
      var i = t;
      nt(i, "Vertex can't be null!");
      var s = r.prev;
      i.prev = s, s.next = i, i.next = r, r.prev = i, i.anEdge = e;
      var o = e;
      do o.Org = i, o = o.Onext; while (o !== e);
    }, n.prototype.makeFace_ = function (t, e, r) {
      var i = t;
      nt(i, "Face can't be null");
      var s = r.prev;
      i.prev = s, s.next = i, i.next = r, r.prev = i, i.anEdge = e, i.trail = null, i.marked = !1, i.inside = r.inside;
      var o = e;
      do o.Lface = i, o = o.Lnext; while (o !== e);
    }, n.prototype.killEdge_ = function (t) {
      t.Sym.side < t.side && (t = t.Sym);
      var e = t.next,
        r = t.Sym.next;
      e.Sym.next = r, r.Sym.next = e;
    }, n.prototype.killVertex_ = function (t, e) {
      var r = t.anEdge,
        i = r;
      do i.Org = e, i = i.Onext; while (i !== r);
      var s = t.prev,
        o = t.next;
      o.prev = s, s.next = o;
    }, n.prototype.killFace_ = function (t, e) {
      var r = t.anEdge,
        i = r;
      do i.Lface = e, i = i.Lnext; while (i !== r);
      var s = t.prev,
        o = t.next;
      o.prev = s, s.next = o;
    }, n.prototype.makeEdge = function () {
      var t = new vh(),
        e = new vh(),
        r = new am(),
        i = this.makeEdge_(this.eHead);
      return this.makeVertex_(t, i, this.vHead), this.makeVertex_(e, i.Sym, this.vHead), this.makeFace_(r, i, this.fHead), i;
    }, n.prototype.splice = function (t, e) {
      var r = !1,
        i = !1;
      if (t !== e) {
        if (e.Org !== t.Org && (i = !0, this.killVertex_(e.Org, t.Org)), e.Lface !== t.Lface && (r = !0, this.killFace_(e.Lface, t.Lface)), this.splice_(e, t), !i) {
          var s = new vh();
          this.makeVertex_(s, e, t.Org), t.Org.anEdge = t;
        }
        if (!r) {
          var o = new am();
          this.makeFace_(o, e, t.Lface), t.Lface.anEdge = t;
        }
      }
    }, n.prototype.delete = function (t) {
      var e = t.Sym,
        r = !1;
      if (t.Lface !== t.Rface && (r = !0, this.killFace_(t.Lface, t.Rface)), t.Onext === t) this.killVertex_(t.Org, null);else if (t.Rface.anEdge = t.Oprev, t.Org.anEdge = t.Onext, this.splice_(t, t.Oprev), !r) {
        var i = new am();
        this.makeFace_(i, t, t.Lface);
      }
      e.Onext === e ? (this.killVertex_(e.Org, null), this.killFace_(e.Lface, null)) : (t.Lface.anEdge = e.Oprev, e.Org.anEdge = e.Onext, this.splice_(e, e.Oprev)), this.killEdge_(t);
    }, n.prototype.addEdgeVertex = function (t) {
      var e = this.makeEdge_(t),
        r = e.Sym;
      this.splice_(e, t.Lnext), e.Org = t.Dst;
      var i = new vh();
      return this.makeVertex_(i, r, e.Org), e.Lface = r.Lface = t.Lface, e;
    }, n.prototype.splitEdge = function (t) {
      var e = this.addEdgeVertex(t),
        r = e.Sym;
      return this.splice_(t.Sym, t.Sym.Oprev), this.splice_(t.Sym, r), t.Dst = r.Org, r.Dst.anEdge = r.Sym, r.Rface = t.Rface, r.winding = t.winding, r.Sym.winding = t.Sym.winding, r.idx = t.idx, r.Sym.idx = t.Sym.idx, r;
    }, n.prototype.connect = function (t, e) {
      var r = !1,
        i = this.makeEdge_(t),
        s = i.Sym;
      if (e.Lface !== t.Lface && (r = !0, this.killFace_(e.Lface, t.Lface)), this.splice_(i, t.Lnext), this.splice_(s, e), i.Org = t.Dst, s.Org = e.Org, i.Lface = s.Lface = t.Lface, t.Lface.anEdge = s, !r) {
        var o = new am();
        this.makeFace_(o, i, t.Lface);
      }
      return i;
    }, n.prototype.zapFace = function (t) {
      var e = t.anEdge,
        r,
        i,
        s,
        o,
        a;
      i = e.Lnext;
      do r = i, i = r.Lnext, r.Lface = null, r.Rface === null && (r.Onext === r ? this.killVertex_(r.Org, null) : (r.Org.anEdge = r.Onext, this.splice_(r, r.Oprev)), s = r.Sym, s.Onext === s ? this.killVertex_(s.Org, null) : (s.Org.anEdge = s.Onext, this.splice_(s, s.Oprev)), this.killEdge_(r)); while (r != e);
      o = t.prev, a = t.next, a.prev = o, o.next = a;
    }, n.prototype.countFaceVerts_ = function (t) {
      var e = t.anEdge,
        r = 0;
      do r++, e = e.Lnext; while (e !== t.anEdge);
      return r;
    }, n.prototype.mergeConvexFaces = function (t) {
      var e, r, i, s, o, a, l;
      for (e = this.fHead.next; e !== this.fHead; e = e.next) if (!!e.inside) for (r = e.anEdge, o = r.Org; i = r.Lnext, s = r.Sym, s && s.Lface && s.Lface.inside && (a = this.countFaceVerts_(e), l = this.countFaceVerts_(s.Lface), a + l - 2 <= t && $e.vertCCW(r.Lprev.Org, r.Org, s.Lnext.Lnext.Org) && $e.vertCCW(s.Lprev.Org, s.Org, r.Lnext.Lnext.Org) && (i = s.Lnext, this.delete(s), r = null, s = null)), !(r && r.Lnext.Org === o);) r = i;
      return !0;
    }, n.prototype.check = function () {
      var t = this.fHead,
        e = this.vHead,
        r = this.eHead,
        i,
        s,
        o,
        a,
        l,
        u;
      for (s = t, s = t; (i = s.next) !== t; s = i) {
        nt(i.prev === s), l = i.anEdge;
        do nt(l.Sym !== l), nt(l.Sym.Sym === l), nt(l.Lnext.Onext.Sym === l), nt(l.Onext.Sym.Lnext === l), nt(l.Lface === i), l = l.Lnext; while (l !== i.anEdge);
      }
      for (nt(i.prev === s && i.anEdge === null), a = e, a = e; (o = a.next) !== e; a = o) {
        nt(o.prev === a), l = o.anEdge;
        do nt(l.Sym !== l), nt(l.Sym.Sym === l), nt(l.Lnext.Onext.Sym === l), nt(l.Onext.Sym.Lnext === l), nt(l.Org === o), l = l.Onext; while (l !== o.anEdge);
      }
      for (nt(o.prev === a && o.anEdge === null), u = r, u = r; (l = u.next) !== r; u = l) nt(l.Sym.next === u.Sym), nt(l.Sym !== l), nt(l.Sym.Sym === l), nt(l.Org !== null), nt(l.Dst !== null), nt(l.Lnext.Onext.Sym === l), nt(l.Onext.Sym.Lnext === l);
      nt(l.Sym.next === u.Sym && l.Sym === this.eHeadSym && l.Sym.Sym === l && l.Org === null && l.Dst === null && l.Lface === null && l.Rface === null);
    }, n;
  }(),
  kO = function () {
    function n() {
      this.handle = null;
    }
    return n;
  }(),
  zO = function () {
    function n() {
      this.key = null, this.node = 0;
    }
    return n;
  }(),
  Q9 = function () {
    function n(t, e) {
      this.leq = e, this.max = 0, this.nodes = [], this.handles = [], this.initialized = !1, this.freeList = 0, this.size = 0, this.max = t, this.nodes = [], this.handles = [];
      for (var r = 0; r < t + 1; r++) this.nodes[r] = new kO(), this.handles[r] = new zO();
      this.initialized = !1, this.nodes[1].handle = 1, this.handles[1].key = null;
    }
    return n.prototype.floatDown_ = function (t) {
      var e = this.nodes,
        r = this.handles,
        i,
        s,
        o;
      for (i = e[t].handle;;) {
        if (o = t << 1, o < this.size && this.leq(r[e[o + 1].handle].key, r[e[o].handle].key) && ++o, nt(o <= this.max), s = e[o].handle, o > this.size || this.leq(r[i].key, r[s].key)) {
          e[t].handle = i, r[i].node = t;
          break;
        }
        e[t].handle = s, r[s].node = t, t = o;
      }
    }, n.prototype.floatUp_ = function (t) {
      var e = this.nodes,
        r = this.handles,
        i,
        s,
        o;
      for (i = e[t].handle;;) {
        if (o = t >> 1, s = e[o].handle, o === 0 || this.leq(r[s].key, r[i].key)) {
          e[t].handle = i, r[i].node = t;
          break;
        }
        e[t].handle = s, r[s].node = t, t = o;
      }
    }, n.prototype.init = function () {
      for (var t = this.size; t >= 1; --t) this.floatDown_(t);
      this.initialized = !0;
    }, n.prototype.min = function () {
      return this.handles[this.nodes[1].handle].key;
    }, n.prototype.insert = function (t) {
      var e, r;
      if (e = ++this.size, e * 2 > this.max) {
        this.max *= 2;
        var i, s;
        for (s = this.nodes.length, this.nodes.length = this.max + 1, i = s; i < this.nodes.length; i++) this.nodes[i] = new kO();
        for (s = this.handles.length, this.handles.length = this.max + 1, i = s; i < this.handles.length; i++) this.handles[i] = new zO();
      }
      return this.freeList === 0 ? r = e : (r = this.freeList, this.freeList = this.handles[r].node), this.nodes[e].handle = r, this.handles[r].node = e, this.handles[r].key = t, this.initialized && this.floatUp_(e), r;
    }, n.prototype.extractMin = function () {
      var t = this.nodes,
        e = this.handles,
        r = t[1].handle,
        i = e[r].key;
      return this.size > 0 && (t[1].handle = t[this.size].handle, e[t[1].handle].node = 1, e[r].key = null, e[r].node = this.freeList, this.freeList = r, --this.size, this.size > 0 && this.floatDown_(1)), i;
    }, n.prototype.delete = function (t) {
      var e = this.nodes,
        r = this.handles,
        i;
      nt(t >= 1 && t <= this.max && r[t].key !== null), i = r[t].node, e[i].handle = e[this.size].handle, r[e[i].handle].node = i, --this.size, i <= this.size && (i <= 1 || this.leq(r[e[i >> 1].handle].key, r[e[i].handle].key) ? this.floatDown_(i) : this.floatUp_(i)), r[t].key = null, r[t].node = this.freeList, this.freeList = t;
    }, n;
  }(),
  eA = function () {
    function n() {
      this.eUp = null, this.nodeUp = null, this.windingNumber = 0, this.inside = !1, this.sentinel = !1, this.dirty = !1, this.fixUpperEdge = !1;
    }
    return n;
  }(),
  VO = function () {
    function n() {
      this.key = null, this.next = null, this.prev = null;
    }
    return n;
  }(),
  K9 = function () {
    function n(t, e) {
      this.frame = t, this.leq = e, this.head = new VO(), this.head.next = this.head, this.head.prev = this.head;
    }
    return n.prototype.min = function () {
      return this.head.next;
    }, n.prototype.max = function () {
      return this.head.prev;
    }, n.prototype.insert = function (t) {
      return this.insertBefore(this.head, t);
    }, n.prototype.search = function (t) {
      var e = this.head;
      do e = e.next; while (e.key !== null && !this.leq(this.frame, t, e.key));
      return e;
    }, n.prototype.insertBefore = function (t, e) {
      do t = t.prev; while (t.key !== null && !this.leq(this.frame, t.key, e));
      var r = new VO();
      return r.key = e, r.next = t.next, t.next.prev = r, r.prev = t, t.next = r, r;
    }, n.prototype.delete = function (t) {
      t.next.prev = t.prev, t.prev.next = t.next;
    }, n;
  }(),
  Z9 = function () {
    function n() {}
    return n.regionBelow = function (t) {
      return t.nodeUp.prev.key;
    }, n.regionAbove = function (t) {
      return t.nodeUp.next.key;
    }, n.debugEvent = function (t) {}, n.addWinding = function (t, e) {
      t.winding += e.winding, t.Sym.winding += e.Sym.winding;
    }, n.edgeLeq = function (t, e, r) {
      var i = t.event,
        s = e.eUp,
        o = r.eUp;
      if (s.Dst === i) return o.Dst === i ? $e.vertLeq(s.Org, o.Org) ? $e.edgeSign(o.Dst, s.Org, o.Org) <= 0 : $e.edgeSign(s.Dst, o.Org, s.Org) >= 0 : $e.edgeSign(o.Dst, i, o.Org) <= 0;
      if (o.Dst === i) return $e.edgeSign(s.Dst, i, s.Org) >= 0;
      var a = $e.edgeEval(s.Dst, i, s.Org),
        l = $e.edgeEval(o.Dst, i, o.Org);
      return a >= l;
    }, n.deleteRegion = function (t, e) {
      e.fixUpperEdge && nt(e.eUp.winding === 0), e.eUp.activeRegion = null, t.dict.delete(e.nodeUp);
    }, n.fixUpperEdge = function (t, e, r) {
      nt(e.fixUpperEdge), t.mesh.delete(e.eUp), e.fixUpperEdge = !1, e.eUp = r, r.activeRegion = e;
    }, n.topLeftRegion = function (t, e) {
      var r = e.eUp.Org,
        i;
      do e = n.regionAbove(e); while (e.eUp.Org === r);
      if (e.fixUpperEdge) {
        if (i = t.mesh.connect(n.regionBelow(e).eUp.Sym, e.eUp.Lnext), i === null) return null;
        n.fixUpperEdge(t, e, i), e = n.regionAbove(e);
      }
      return e;
    }, n.topRightRegion = function (t) {
      var e = t.eUp.Dst;
      do t = n.regionAbove(t); while (t.eUp.Dst === e);
      return t;
    }, n.addRegionBelow = function (t, e, r) {
      var i = new eA();
      return i.eUp = r, i.nodeUp = t.dict.insertBefore(e.nodeUp, i), i.fixUpperEdge = !1, i.sentinel = !1, i.dirty = !1, r.activeRegion = i, i;
    }, n.isWindingInside = function (t, e) {
      switch (t.windingRule) {
        case Mt.ODD:
          return (e & 1) !== 0;
        case Mt.NONZERO:
          return e !== 0;
        case Mt.POSITIVE:
          return e > 0;
        case Mt.NEGATIVE:
          return e < 0;
        case Mt.ABS_GEQ_TWO:
          return e >= 2 || e <= -2;
      }
      throw new Error("Invalid winding rulle");
    }, n.computeWinding = function (t, e) {
      e.windingNumber = n.regionAbove(e).windingNumber + e.eUp.winding, e.inside = n.isWindingInside(t, e.windingNumber);
    }, n.finishRegion = function (t, e) {
      var r = e.eUp,
        i = r.Lface;
      i.inside = e.inside, i.anEdge = r, n.deleteRegion(t, e);
    }, n.finishLeftRegions = function (t, e, r) {
      for (var i, s = null, o = e, a = e.eUp; o !== r;) {
        if (o.fixUpperEdge = !1, s = n.regionBelow(o), i = s.eUp, i.Org != a.Org) {
          if (!s.fixUpperEdge) {
            n.finishRegion(t, o);
            break;
          }
          i = t.mesh.connect(a.Lprev, i.Sym), n.fixUpperEdge(t, s, i);
        }
        a.Onext !== i && (t.mesh.splice(i.Oprev, i), t.mesh.splice(a, i)), n.finishRegion(t, o), a = s.eUp, o = s;
      }
      return a;
    }, n.addRightEdges = function (t, e, r, i, s, o) {
      var a,
        l,
        u,
        c,
        d = !0;
      u = r;
      do nt($e.vertLeq(u.Org, u.Dst)), n.addRegionBelow(t, e, u.Sym), u = u.Onext; while (u !== i);
      for (s === null && (s = n.regionBelow(e).eUp.Rprev), l = e, c = s; a = n.regionBelow(l), u = a.eUp.Sym, u.Org === c.Org;) u.Onext !== c && (t.mesh.splice(u.Oprev, u), t.mesh.splice(c.Oprev, u)), a.windingNumber = l.windingNumber - u.winding, a.inside = n.isWindingInside(t, a.windingNumber), l.dirty = !0, !d && n.checkForRightSplice(t, l) && (n.addWinding(u, c), n.deleteRegion(t, l), t.mesh.delete(c)), d = !1, l = a, c = u;
      l.dirty = !0, nt(l.windingNumber - u.winding === a.windingNumber), o && n.walkDirtyRegions(t, l);
    }, n.spliceMergeVertices = function (t, e, r) {
      t.mesh.splice(e, r);
    }, n.vertexWeights = function (t, e, r) {
      var i = $e.vertL1dist(e, t),
        s = $e.vertL1dist(r, t),
        o = .5 * s / (i + s),
        a = .5 * i / (i + s);
      t.coords[0] += o * e.coords[0] + a * r.coords[0], t.coords[1] += o * e.coords[1] + a * r.coords[1], t.coords[2] += o * e.coords[2] + a * r.coords[2];
    }, n.getIntersectData = function (t, e, r, i, s, o) {
      e.coords[0] = e.coords[1] = e.coords[2] = 0, e.idx = -1, n.vertexWeights(e, r, i), n.vertexWeights(e, s, o);
    }, n.checkForRightSplice = function (t, e) {
      var r = n.regionBelow(e),
        i = e.eUp,
        s = r.eUp;
      if ($e.vertLeq(i.Org, s.Org)) {
        if ($e.edgeSign(s.Dst, i.Org, s.Org) > 0) return !1;
        $e.vertEq(i.Org, s.Org) ? i.Org !== s.Org && (t.pq.delete(i.Org.pqHandle), n.spliceMergeVertices(t, s.Oprev, i)) : (t.mesh.splitEdge(s.Sym), t.mesh.splice(i, s.Oprev), e.dirty = r.dirty = !0);
      } else {
        if ($e.edgeSign(i.Dst, s.Org, i.Org) < 0) return !1;
        n.regionAbove(e).dirty = e.dirty = !0, t.mesh.splitEdge(i.Sym), t.mesh.splice(s.Oprev, i);
      }
      return !0;
    }, n.checkForLeftSplice = function (t, e) {
      var r = n.regionBelow(e),
        i = e.eUp,
        s = r.eUp,
        o;
      if (nt(!$e.vertEq(i.Dst, s.Dst)), $e.vertLeq(i.Dst, s.Dst)) {
        if ($e.edgeSign(i.Dst, s.Dst, i.Org) < 0) return !1;
        n.regionAbove(e).dirty = e.dirty = !0, o = t.mesh.splitEdge(i), t.mesh.splice(s.Sym, o), o.Lface.inside = e.inside;
      } else {
        if ($e.edgeSign(s.Dst, i.Dst, s.Org) > 0) return !1;
        e.dirty = r.dirty = !0, o = t.mesh.splitEdge(s), t.mesh.splice(i.Lnext, s.Sym), o.Rface.inside = e.inside;
      }
      return !0;
    }, n.checkForIntersect = function (t, e) {
      var r = n.regionBelow(e),
        i = e.eUp,
        s = r.eUp,
        o = i.Org,
        a = s.Org,
        l = i.Dst,
        u = s.Dst,
        c,
        d,
        h = new vh(),
        f,
        p;
      if (nt(!$e.vertEq(u, l)), nt($e.edgeSign(l, t.event, o) <= 0), nt($e.edgeSign(u, t.event, a) >= 0), nt(o !== t.event && a !== t.event), nt(!e.fixUpperEdge && !r.fixUpperEdge), o === a || (c = Math.min(o.t, l.t), d = Math.max(a.t, u.t), c > d)) return !1;
      if ($e.vertLeq(o, a)) {
        if ($e.edgeSign(u, o, a) > 0) return !1;
      } else if ($e.edgeSign(l, a, o) < 0) return !1;
      return n.debugEvent(t), $e.intersect(l, o, u, a, h), nt(Math.min(o.t, l.t) <= h.t), nt(h.t <= Math.max(a.t, u.t)), nt(Math.min(u.s, l.s) <= h.s), nt(h.s <= Math.max(a.s, o.s)), $e.vertLeq(h, t.event) && (h.s = t.event.s, h.t = t.event.t), f = $e.vertLeq(o, a) ? o : a, $e.vertLeq(f, h) && (h.s = f.s, h.t = f.t), $e.vertEq(h, o) || $e.vertEq(h, a) ? (n.checkForRightSplice(t, e), !1) : !$e.vertEq(l, t.event) && $e.edgeSign(l, t.event, h) >= 0 || !$e.vertEq(u, t.event) && $e.edgeSign(u, t.event, h) <= 0 ? u === t.event ? (t.mesh.splitEdge(i.Sym), t.mesh.splice(s.Sym, i), e = n.topLeftRegion(t, e), i = n.regionBelow(e).eUp, n.finishLeftRegions(t, n.regionBelow(e), r), n.addRightEdges(t, e, i.Oprev, i, i, !0), !0) : l === t.event ? (t.mesh.splitEdge(s.Sym), t.mesh.splice(i.Lnext, s.Oprev), r = e, e = n.topRightRegion(e), p = n.regionBelow(e).eUp.Rprev, r.eUp = s.Oprev, s = n.finishLeftRegions(t, r, null), n.addRightEdges(t, e, s.Onext, i.Rprev, p, !0), !0) : ($e.edgeSign(l, t.event, h) >= 0 && (n.regionAbove(e).dirty = e.dirty = !0, t.mesh.splitEdge(i.Sym), i.Org.s = t.event.s, i.Org.t = t.event.t), $e.edgeSign(u, t.event, h) <= 0 && (e.dirty = r.dirty = !0, t.mesh.splitEdge(s.Sym), s.Org.s = t.event.s, s.Org.t = t.event.t), !1) : (t.mesh.splitEdge(i.Sym), t.mesh.splitEdge(s.Sym), t.mesh.splice(s.Oprev, i), i.Org.s = h.s, i.Org.t = h.t, i.Org.pqHandle = t.pq.insert(i.Org), n.getIntersectData(t, i.Org, o, l, a, u), n.regionAbove(e).dirty = e.dirty = r.dirty = !0, !1);
    }, n.walkDirtyRegions = function (t, e) {
      for (var r = n.regionBelow(e), i, s;;) {
        for (; r.dirty;) e = r, r = n.regionBelow(r);
        if (!e.dirty && (r = e, e = n.regionAbove(e), e === null || !e.dirty)) return;
        if (e.dirty = !1, i = e.eUp, s = r.eUp, i.Dst !== s.Dst && n.checkForLeftSplice(t, e) && (r.fixUpperEdge ? (n.deleteRegion(t, r), t.mesh.delete(s), r = n.regionBelow(e), s = r.eUp) : e.fixUpperEdge && (n.deleteRegion(t, e), t.mesh.delete(i), e = n.regionAbove(r), i = e.eUp)), i.Org !== s.Org) if (i.Dst !== s.Dst && !e.fixUpperEdge && !r.fixUpperEdge && (i.Dst === t.event || s.Dst === t.event)) {
          if (n.checkForIntersect(t, e)) return;
        } else n.checkForRightSplice(t, e);
        i.Org === s.Org && i.Dst === s.Dst && (n.addWinding(s, i), n.deleteRegion(t, e), t.mesh.delete(i), e = n.regionAbove(r));
      }
    }, n.connectRightVertex = function (t, e, r) {
      var i,
        s = r.Onext,
        o = n.regionBelow(e),
        a = e.eUp,
        l = o.eUp,
        u = !1;
      if (a.Dst !== l.Dst && n.checkForIntersect(t, e), $e.vertEq(a.Org, t.event) && (t.mesh.splice(s.Oprev, a), e = n.topLeftRegion(t, e), s = n.regionBelow(e).eUp, n.finishLeftRegions(t, n.regionBelow(e), o), u = !0), $e.vertEq(l.Org, t.event) && (t.mesh.splice(r, l.Oprev), r = n.finishLeftRegions(t, o, null), u = !0), u) {
        n.addRightEdges(t, e, r.Onext, s, s, !0);
        return;
      }
      $e.vertLeq(l.Org, a.Org) ? i = l.Oprev : i = a, i = t.mesh.connect(r.Lprev, i), n.addRightEdges(t, e, i, i.Onext, i.Onext, !1), i.Sym.activeRegion.fixUpperEdge = !0, n.walkDirtyRegions(t, e);
    }, n.connectLeftDegenerate = function (t, e, r) {
      var i, s, o, a, l;
      if (i = e.eUp, $e.vertEq(i.Org, r)) {
        nt(!1), n.spliceMergeVertices(t, i, r.anEdge);
        return;
      }
      if (!$e.vertEq(i.Dst, r)) {
        t.mesh.splitEdge(i.Sym), e.fixUpperEdge && (t.mesh.delete(i.Onext), e.fixUpperEdge = !1), t.mesh.splice(r.anEdge, i), n.sweepEvent(t, r);
        return;
      }
      nt(!1), e = n.topRightRegion(e), l = n.regionBelow(e), o = l.eUp.Sym, s = a = o.Onext, l.fixUpperEdge && (nt(s !== o), n.deleteRegion(t, l), t.mesh.delete(o), o = s.Oprev), t.mesh.splice(r.anEdge, o), $e.edgeGoesLeft(s) || (s = null), n.addRightEdges(t, e, o.Onext, a, s, !0);
    }, n.connectLeftVertex = function (t, e) {
      var r,
        i,
        s,
        o,
        a,
        l,
        u = new eA();
      if (u.eUp = e.anEdge.Sym, r = t.dict.search(u).key, i = n.regionBelow(r), !!i) {
        if (o = r.eUp, a = i.eUp, $e.edgeSign(o.Dst, e, o.Org) === 0) {
          n.connectLeftDegenerate(t, r, e);
          return;
        }
        if (s = $e.vertLeq(a.Dst, o.Dst) ? r : i, r.inside || s.fixUpperEdge) {
          if (s === r) l = t.mesh.connect(e.anEdge.Sym, o.Lnext);else {
            var c = t.mesh.connect(a.Dnext, e.anEdge);
            l = c.Sym;
          }
          s.fixUpperEdge ? n.fixUpperEdge(t, s, l) : n.computeWinding(t, n.addRegionBelow(t, r, l)), n.sweepEvent(t, e);
        } else n.addRightEdges(t, r, e.anEdge, e.anEdge, null, !0);
      }
    }, n.sweepEvent = function (t, e) {
      t.event = e, n.debugEvent(t);
      for (var r = e.anEdge; r.activeRegion === null;) if (r = r.Onext, r === e.anEdge) {
        n.connectLeftVertex(t, e);
        return;
      }
      var i = n.topLeftRegion(t, r.activeRegion);
      nt(i !== null);
      var s = n.regionBelow(i),
        o = s.eUp,
        a = n.finishLeftRegions(t, s, null);
      a.Onext === o ? n.connectRightVertex(t, i, a) : n.addRightEdges(t, i, a.Onext, o, o, !0);
    }, n.addSentinel = function (t, e, r, i) {
      var s = new eA(),
        o = t.mesh.makeEdge();
      o.Org.s = r, o.Org.t = i, o.Dst.s = e, o.Dst.t = i, t.event = o.Dst, s.eUp = o, s.windingNumber = 0, s.inside = !1, s.fixUpperEdge = !1, s.sentinel = !0, s.dirty = !1, s.nodeUp = t.dict.insert(s);
    }, n.initEdgeDict = function (t) {
      t.dict = new K9(t, n.edgeLeq);
      var e = t.bmax[0] - t.bmin[0],
        r = t.bmax[1] - t.bmin[1],
        i = t.bmin[0] - e,
        s = t.bmax[0] + e,
        o = t.bmin[1] - r,
        a = t.bmax[1] + r;
      n.addSentinel(t, i, s, o), n.addSentinel(t, i, s, a);
    }, n.doneEdgeDict = function (t) {
      for (var e, r = 0; (e = t.dict.min().key) !== null;) e.sentinel || (nt(e.fixUpperEdge), nt(++r === 1)), nt(e.windingNumber === 0), n.deleteRegion(t, e);
    }, n.removeDegenerateEdges = function (t) {
      var e,
        r,
        i,
        s = t.mesh.eHead;
      for (e = s.next; e !== s; e = r) r = e.next, i = e.Lnext, $e.vertEq(e.Org, e.Dst) && e.Lnext.Lnext !== e && (n.spliceMergeVertices(t, i, e), t.mesh.delete(e), e = i, i = e.Lnext), i.Lnext === e && (i !== e && ((i === r || i === r.Sym) && (r = r.next), t.mesh.delete(i)), (e === r || e === r.Sym) && (r = r.next), t.mesh.delete(e));
    }, n.initPriorityQ = function (t) {
      var e,
        r,
        i,
        s = 0;
      for (i = t.mesh.vHead, r = i.next; r !== i; r = r.next) s++;
      for (s += 8, e = t.pq = new Q9(s, $e.vertLeq), i = t.mesh.vHead, r = i.next; r !== i; r = r.next) r.pqHandle = e.insert(r);
      return r !== i ? !1 : (e.init(), !0);
    }, n.donePriorityQ = function (t) {
      t.pq = null;
    }, n.removeDegenerateFaces = function (t, e) {
      var r, i, s;
      for (r = e.fHead.next; r !== e.fHead; r = i) i = r.next, s = r.anEdge, nt(s.Lnext !== s), s.Lnext.Lnext === s && (n.addWinding(s.Onext, s), t.mesh.delete(s));
      return !0;
    }, n.computeInterior = function (t, e) {
      e === void 0 && (e = !0);
      var r, i;
      if (n.removeDegenerateEdges(t), !n.initPriorityQ(t)) return !1;
      for (n.initEdgeDict(t); (r = t.pq.extractMin()) !== null;) {
        for (; i = t.pq.min(), !(i === null || !$e.vertEq(i, r));) i = t.pq.extractMin(), n.spliceMergeVertices(t, r.anEdge, i.anEdge);
        n.sweepEvent(t, r);
      }
      return t.event = t.dict.min().key.eUp.Org, n.debugEvent(t), n.doneEdgeDict(t), n.donePriorityQ(t), n.removeDegenerateFaces(t, t.mesh) ? (e && t.mesh.check(), !0) : !1;
    }, n;
  }(),
  J9 = function () {
    function n() {
      this.mesh = new FO(), this.normal = [0, 0, 0], this.sUnit = [0, 0, 0], this.tUnit = [0, 0, 0], this.bmin = [0, 0], this.bmax = [0, 0], this.windingRule = Mt.ODD, this.dict = null, this.pq = null, this.event = null, this.vertexIndexCounter = 0, this.vertices = [], this.vertexIndices = [], this.vertexCount = 0, this.elements = [], this.elementCount = 0;
    }
    return n.prototype.dot_ = function (t, e) {
      return t[0] * e[0] + t[1] * e[1] + t[2] * e[2];
    }, n.prototype.normalize_ = function (t) {
      var e = t[0] * t[0] + t[1] * t[1] + t[2] * t[2];
      if (!e) throw "Zero-size vector!";
      e = Math.sqrt(e), t[0] /= e, t[1] /= e, t[2] /= e;
    }, n.prototype.longAxis_ = function (t) {
      var e = 0;
      return Math.abs(t[1]) > Math.abs(t[0]) && (e = 1), Math.abs(t[2]) > Math.abs(t[e]) && (e = 2), e;
    }, n.prototype.computeNormal_ = function (t) {
      var e,
        r,
        i,
        s,
        o,
        a,
        l = [0, 0, 0],
        u = [0, 0, 0],
        c = [0, 0, 0],
        d = [0, 0, 0],
        h = [0, 0, 0],
        f = [null, null, null],
        p = [null, null, null],
        m = this.mesh.vHead;
      e = m.next;
      for (var g = 0; g < 3; ++g) s = e.coords[g], u[g] = s, p[g] = e, l[g] = s, f[g] = e;
      for (e = m.next; e !== m; e = e.next) for (var y = 0; y < 3; ++y) s = e.coords[y], s < u[y] && (u[y] = s, p[y] = e), s > l[y] && (l[y] = s, f[y] = e);
      var v = 0;
      if (l[1] - u[1] > l[0] - u[0] && (v = 1), l[2] - u[2] > l[v] - u[v] && (v = 2), u[v] >= l[v]) {
        t[0] = 0, t[1] = 0, t[2] = 1;
        return;
      }
      for (a = 0, r = p[v], i = f[v], c[0] = r.coords[0] - i.coords[0], c[1] = r.coords[1] - i.coords[1], c[2] = r.coords[2] - i.coords[2], e = m.next; e !== m; e = e.next) d[0] = e.coords[0] - i.coords[0], d[1] = e.coords[1] - i.coords[1], d[2] = e.coords[2] - i.coords[2], h[0] = c[1] * d[2] - c[2] * d[1], h[1] = c[2] * d[0] - c[0] * d[2], h[2] = c[0] * d[1] - c[1] * d[0], o = h[0] * h[0] + h[1] * h[1] + h[2] * h[2], o > a && (a = o, t[0] = h[0], t[1] = h[1], t[2] = h[2]);
      a <= 0 && (t[0] = t[1] = t[2] = 0, t[this.longAxis_(c)] = 1);
    }, n.prototype.checkOrientation_ = function () {
      for (var t = this.mesh.fHead, e, r = this.mesh.vHead, i, s = 0, o = t.next; o !== t; o = o.next) if (i = o.anEdge, !(i.winding <= 0)) do s += (i.Org.s - i.Dst.s) * (i.Org.t + i.Dst.t), i = i.Lnext; while (i !== o.anEdge);
      if (s < 0) {
        for (e = r.next; e !== r; e = e.next) e.t = -e.t;
        this.tUnit[0] = -this.tUnit[0], this.tUnit[1] = -this.tUnit[1], this.tUnit[2] = -this.tUnit[2];
      }
    }, n.prototype.projectPolygon_ = function () {
      var t = this.mesh.vHead,
        e = [0, 0, 0],
        r,
        i,
        s = !1;
      e[0] = this.normal[0], e[1] = this.normal[1], e[2] = this.normal[2], !e[0] && !e[1] && !e[2] && (this.computeNormal_(e), s = !0), r = this.sUnit, i = this.tUnit;
      var o = this.longAxis_(e);
      r[o] = 0, r[(o + 1) % 3] = 1, r[(o + 2) % 3] = 0, i[o] = 0, i[(o + 1) % 3] = 0, i[(o + 2) % 3] = e[o] > 0 ? 1 : -1;
      for (var a = t.next; a !== t; a = a.next) a.s = this.dot_(a.coords, r), a.t = this.dot_(a.coords, i);
      s && this.checkOrientation_();
      for (var l = !0, u = t.next; u !== t; u = u.next) l ? (this.bmin[0] = this.bmax[0] = u.s, this.bmin[1] = this.bmax[1] = u.t, l = !1) : (u.s < this.bmin[0] && (this.bmin[0] = u.s), u.s > this.bmax[0] && (this.bmax[0] = u.s), u.t < this.bmin[1] && (this.bmin[1] = u.t), u.t > this.bmax[1] && (this.bmax[1] = u.t));
    }, n.prototype.addWinding_ = function (t, e) {
      t.winding += e.winding, t.Sym.winding += e.Sym.winding;
    }, n.prototype.tessellateMonoRegion_ = function (t, e) {
      var r, i;
      if (r = e.anEdge, !(r.Lnext !== r && r.Lnext.Lnext !== r)) throw "Mono region invalid";
      for (; $e.vertLeq(r.Dst, r.Org); r = r.Lprev);
      for (; $e.vertLeq(r.Org, r.Dst); r = r.Lnext);
      i = r.Lprev;
      for (var s = void 0; r.Lnext !== i;) if ($e.vertLeq(r.Dst, i.Org)) {
        for (; i.Lnext !== r && ($e.edgeGoesLeft(i.Lnext) || $e.edgeSign(i.Org, i.Dst, i.Lnext.Dst) <= 0);) s = t.connect(i.Lnext, i), i = s.Sym;
        i = i.Lprev;
      } else {
        for (; i.Lnext !== r && ($e.edgeGoesRight(r.Lprev) || $e.edgeSign(r.Dst, r.Org, r.Lprev.Org) >= 0);) s = t.connect(r, r.Lprev), r = s.Sym;
        r = r.Lnext;
      }
      if (i.Lnext === r) throw "Mono region invalid";
      for (; i.Lnext.Lnext !== r;) s = t.connect(i.Lnext, i), i = s.Sym;
      return !0;
    }, n.prototype.tessellateInterior_ = function (t) {
      for (var e, r = t.fHead.next; r !== t.fHead; r = e) if (e = r.next, r.inside && !this.tessellateMonoRegion_(t, r)) return !1;
      return !0;
    }, n.prototype.discardExterior_ = function (t) {
      for (var e, r = t.fHead.next; r !== t.fHead; r = e) e = r.next, r.inside || t.zapFace(r);
    }, n.prototype.setWindingNumber_ = function (t, e, r) {
      for (var i, s = t.eHead.next; s !== t.eHead; s = i) i = s.next, s.Rface.inside !== s.Lface.inside ? s.winding = s.Lface.inside ? e : -e : r ? t.delete(s) : s.winding = 0;
    }, n.prototype.getNeighbourFace_ = function (t) {
      return !t.Rface || !t.Rface.inside ? -1 : t.Rface.n;
    }, n.prototype.outputPolymesh_ = function (t, e, r, i) {
      var s,
        o = 0,
        a = 0,
        l;
      r > 3 && t.mergeConvexFaces(r);
      for (var u = t.vHead.next; u !== t.vHead; u = u.next) u.n = -1;
      for (var c = t.fHead.next; c !== t.fHead; c = c.next) if (c.n = -1, !!c.inside) {
        s = c.anEdge, l = 0;
        do {
          var u = s.Org;
          u.n === -1 && (u.n = a, a++), l++, s = s.Lnext;
        } while (s !== c.anEdge);
        if (l > r) throw "Face vertex greater that support polygon";
        c.n = o, ++o;
      }
      this.elementCount = o, e === Rr.CONNECTED_POLYGONS && (o *= 2), this.elements = [], this.elements.length = o * r, this.vertexCount = a, this.vertices = [], this.vertices.length = a * i, this.vertexIndices = [], this.vertexIndices.length = a;
      for (var u = t.vHead.next; u !== t.vHead; u = u.next) if (u.n !== -1) {
        var d = u.n * i;
        this.vertices[d + 0] = u.coords[0], this.vertices[d + 1] = u.coords[1], i > 2 && (this.vertices[d + 2] = u.coords[2]), this.vertexIndices[u.n] = u.idx;
      }
      for (var h = 0, c = t.fHead.next; c !== t.fHead; c = c.next) if (!!c.inside) {
        s = c.anEdge, l = 0;
        do {
          var u = s.Org;
          this.elements[h++] = u.n, l++, s = s.Lnext;
        } while (s !== c.anEdge);
        for (var f = l; f < r; ++f) this.elements[h++] = -1;
        if (e === Rr.CONNECTED_POLYGONS) {
          s = c.anEdge;
          do this.elements[h++] = this.getNeighbourFace_(s), s = s.Lnext; while (s !== c.anEdge);
          for (var p = l; p < r; ++p) this.elements[h++] = -1;
        }
      }
    }, n.prototype.outputContours_ = function (t, e) {
      var r,
        i,
        s = 0,
        o = 0;
      this.vertexCount = 0, this.elementCount = 0;
      for (var a = t.fHead.next; a !== t.fHead; a = a.next) if (!!a.inside) {
        i = r = a.anEdge;
        do this.vertexCount++, r = r.Lnext; while (r !== i);
        this.elementCount++;
      }
      this.elements = [], this.elements.length = this.elementCount * 2, this.vertices = [], this.vertices.length = this.vertexCount * e, this.vertexIndices = [], this.vertexIndices.length = this.vertexCount;
      var l = 0,
        u = 0,
        c = 0;
      s = 0;
      for (var a = t.fHead.next; a !== t.fHead; a = a.next) if (!!a.inside) {
        o = 0, i = r = a.anEdge;
        do this.vertices[l++] = r.Org.coords[0], this.vertices[l++] = r.Org.coords[1], e > 2 && (this.vertices[l++] = r.Org.coords[2]), this.vertexIndices[u++] = this.vertexIdCallback ? this.vertexIdCallback(r) : r.Org.idx, o++, r = r.Lnext; while (r !== i);
        this.elements[c++] = s, this.elements[c++] = o, s += o;
      }
    }, n.prototype.addContour = function (t, e) {
      this.mesh === null && (this.mesh = new FO()), t < 2 && (t = 2), t > 3 && (t = 3);
      for (var r = null, i = 0; i < e.length; i += t) r === null ? (r = this.mesh.makeEdge(), this.mesh.splice(r, r.Sym)) : (this.mesh.splitEdge(r), r = r.Lnext), r.Org.coords[0] = e[i + 0], r.Org.coords[1] = e[i + 1], t > 2 ? r.Org.coords[2] = e[i + 2] : r.Org.coords[2] = 0, r.Org.idx = this.vertexIndexCounter++, this.edgeCreateCallback && this.edgeCreateCallback(r), r.winding = 1, r.Sym.winding = -1;
    }, n.prototype.tesselate = function (t, e, r, i, s, o) {
      if (t === void 0 && (t = Mt.ODD), e === void 0 && (e = Rr.POLYGONS), o === void 0 && (o = !0), this.vertices = [], this.elements = [], this.vertexIndices = [], this.vertexIndexCounter = 0, s && (this.normal[0] = s[0], this.normal[1] = s[1], this.normal[2] = s[2]), this.windingRule = t, i < 2 && (i = 2), i > 3 && (i = 3), !this.mesh) return !1;
      this.projectPolygon_(), Z9.computeInterior(this, o);
      var a = this.mesh;
      return e === Rr.BOUNDARY_CONTOURS ? this.setWindingNumber_(a, 1, !0) : this.tessellateInterior_(a), o && a.check(), e === Rr.BOUNDARY_CONTOURS ? this.outputContours_(a, i) : this.outputPolymesh_(a, e, r, i), !0;
    }, n;
  }();
function Hs(n) {
  var t = n.windingRule,
    e = t === void 0 ? Mt.ODD : t,
    r = n.elementType,
    i = r === void 0 ? Rr.POLYGONS : r,
    s = n.polySize,
    o = s === void 0 ? 3 : s,
    a = n.vertexSize,
    l = a === void 0 ? 2 : a,
    u = n.normal,
    c = u === void 0 ? [0, 0, 1] : u,
    d = n.contours,
    h = d === void 0 ? [] : d,
    f = n.strict,
    p = f === void 0 ? !0 : f,
    m = n.debug,
    g = m === void 0 ? !1 : m;
  if (!h && p) throw new Error("Contours can't be empty");
  if (!!h) {
    var y = new J9();
    n.edgeCreateCallback && (y.edgeCreateCallback = n.edgeCreateCallback), n.vertexIdCallback && (y.vertexIdCallback = n.vertexIdCallback);
    for (var v = 0; v < h.length; v++) y.addContour(l || 2, h[v]);
    return y.tesselate(e, i, o, l, c, p), {
      vertices: y.vertices,
      vertexIndices: y.vertexIndices,
      vertexCount: y.vertexCount,
      elements: y.elements,
      elementCount: y.elementCount,
      mesh: g ? y.mesh : void 0
    };
  }
}
var dge = Mt.ODD,
  hge = Mt.NONZERO,
  fge = Mt.POSITIVE,
  pge = Mt.NEGATIVE,
  mge = Mt.ABS_GEQ_TWO,
  gge = Rr.POLYGONS,
  yge = Rr.CONNECTED_POLYGONS,
  vge = Rr.BOUNDARY_CONTOURS;
var v0 = /*#__PURE__*/function () {
    function v0() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 256;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
      _classCallCheck(this, v0);
      this.capacity = t, this.size = 0, this.debug = e, this.debug && console.log("allocating with cap ".concat(t));
      var r = t * v0.eSize;
      this.buffer = new ArrayBuffer(r);
      var i = Float32Array.BYTES_PER_ELEMENT,
        s = 0;
      this.positions = new Float32Array(this.buffer, s * i, 3 * t), s += 3 * t, this.normals = new Float32Array(this.buffer, s * i, 3 * t), s += 3 * t, this.uvs = new Float32Array(this.buffer, s * i, 2 * t);
    }
    _createClass(v0, [{
      key: "realloc",
      value: function realloc(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        if (t < this.size) throw Error("cannot shrink buffer");
        if (t <= this.capacity && !e) return;
        this.debug && console.log("resizing from ".concat(this.capacity, " \u2192 ").concat(t));
        var r = t * v0.eSize,
          i = new ArrayBuffer(r),
          s = Float32Array.BYTES_PER_ELEMENT,
          o = 0,
          a = new Float32Array(i, o * s, 3 * t);
        o += 3 * t;
        var l = new Float32Array(i, o * s, 3 * t);
        o += 3 * t;
        var u = new Float32Array(i, o * s, 2 * t);
        e ? (a.set(this.positions.subarray(0, this.size * 3)), l.set(this.normals.subarray(0, this.size * 3)), u.set(this.uvs.subarray(0, this.size * 2))) : (a.set(this.positions), l.set(this.normals), u.set(this.uvs)), this.buffer = i, this.positions = a, this.normals = l, this.uvs = u, this.capacity = t;
      }
    }, {
      key: "get",
      value: function get() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
        var e = this.size + t;
        if (e > this.capacity) {
          var i = this.capacity;
          for (; e > i;) i *= 2;
          this.realloc(i);
        }
        var r = this.size;
        return this.size = e, r;
      }
    }, {
      key: "reserve",
      value: function reserve(t) {
        var e = this.size + t;
        e > this.capacity && this.realloc(e);
      }
    }, {
      key: "shrink",
      value: function shrink() {
        this.debug && console.log("shrinking ".concat(this.capacity, " \u2192 ").concat(this.size)), this.realloc(this.size, !0);
      }
    }]);
    return v0;
  }(),
  lm = v0;
lm.eSize = (3 + 3 + 2) * Float32Array.BYTES_PER_ELEMENT;
var HO = Pi(jO()),
  cm = {
    vertices: [160, 160, -160, 160, -160, -160, 160, -160],
    vertexIndices: [1, 0, 3, 2],
    vertexCount: 4,
    elements: [0, 4],
    elementCount: 1,
    mesh: void 0
  },
  sA = {
    vertices: [],
    vertexIndices: [],
    vertexCount: 0,
    elements: [],
    elementCount: 0,
    mesh: void 0
  },
  oA = {
    vertices: [-160, 160, 160, -160, 160, 160, -160, -160],
    vertexIndices: [1, 3, 0, 2],
    vertexCount: 4,
    elements: [0, 1, 2, 1, 0, 3],
    elementCount: 2,
    mesh: void 0
  },
  nA = function nA(n, t) {
    return function (_ref23) {
      var _ref24 = _slicedToArray(_ref23, 2),
        e = _ref24[0],
        r = _ref24[1];
      return r < e && (r += t), (n >= e ? n : n + t) <= r;
    };
  },
  Ol = /*#__PURE__*/function (_we13) {
    _inherits(Ol, _we13);
    var _super124 = _createSuper(Ol);
    function Ol(e, r) {
      var _this114;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 12;
      var o = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 3;
      var a = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : Mt.ODD;
      var l = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : !1;
      _classCallCheck(this, Ol);
      _this114 = _super124.call(this);
      _this114.forPathBevel = l;
      _this114.type = "ShapeGeometry";
      _this114.vertexCache = {};
      _this114._shape = e, _this114._depth = r, _this114._curveSegments = s, _this114._bevelSegmentsInput = o;
      var u = _this114._shape.extractShapePointsToFlatArray([], s),
        c = _this114._shape.shapeHoles.map(function (C) {
          var P = C.extractShapePointsToFlatArray([], s),
            D = [];
          for (var O = P.length - 1; O >= 1; O -= 2) {
            var I = P[O - 1],
              z = P[O - 0];
            D.push(I, z);
          }
          return D;
        }),
        d = [],
        h = [];
      for (var C = 0; C < u.length; C += 2) h.push([u[C], u[C + 1]]);
      d.push(h);
      for (var _C13 = 0; _C13 < c.length; _C13++) {
        var P = c[_C13],
          D = [];
        for (var O = 0; O < P.length; O += 2) D.push([P[O], P[O + 1]]);
        d.push(D);
      }
      var f;
      e.isText ? f = new Xu().setFromPoints(e.points.map(function (P) {
        return P.position;
      })).getSize(new N()).length() * .1 : d[0].length === 0 ? f = i : f = (0, HO.default)(d).distance, i <= 0 ? (_this114._bevel = 0, _this114._bevelSegments = 0) : (_this114._bevel = Math.min(i, f, r / 2), _this114._bevelSegments = Math.floor(o));
      var p;
      try {
        p = Hs({
          windingRule: a,
          elementType: Rr.BOUNDARY_CONTOURS,
          vertexSize: 2,
          strict: !0,
          contours: [u]
        });
      } catch (_unused16) {
        p = cm;
      }
      var m;
      try {
        m = Hs({
          windingRule: Mt.ODD,
          elementType: Rr.BOUNDARY_CONTOURS,
          vertexSize: 2,
          strict: !0,
          contours: _toConsumableArray(c)
        });
      } catch (_unused17) {
        m = sA;
      }
      if (!p) throw new Error("error generating geometry");
      var g = p.elementCount;
      if (m) {
        p.elementCount += m.elementCount;
        for (var _C14 = 0; _C14 < m.elements.length; _C14++) {
          var _P16 = m.elements[_C14],
            _D12 = _C14 % 2 === 0 ? p.vertexCount : 0;
          p.elements.push(_P16 + _D12);
        }
        for (var _C15 = 0; _C15 < m.vertexIndices.length; _C15++) {
          var _P17 = m.vertexIndices[_C15],
            _D13 = p.vertexCount;
          p.vertexIndices.push(_P17 + _D13);
        }
        for (var _C16 = 0; _C16 < m.vertices.length; _C16++) {
          var _P18 = m.vertices[_C16];
          p.vertices.push(_P18);
        }
      }
      var y = 1 / 0,
        v = -1 / 0,
        x = 1 / 0,
        S = -1 / 0;
      for (var _C17 = 0, _P19 = p.vertexCount; _C17 < _P19; _C17++) {
        var _D14 = _C17 * 2,
          _O20 = p.vertices[_D14 + 0],
          I = p.vertices[_D14 + 1];
        _O20 < y && (y = _O20), _O20 > v && (v = _O20), I < x && (x = I), I > S && (S = I);
      }
      _this114._minX = y, _this114._minY = x, _this114._width = v - y, _this114._height = S - x, _this114._buffer = new lm(_this114._computeBufferEstimatedSize(p));
      var w = [],
        A = [];
      for (var _C18 = p.elementCount - 1; _C18 >= 0; _C18--) {
        var _P20 = _C18 >= g,
          _D15 = _C18 * 2,
          _O21 = p.elements[_D15 + 0],
          _I9 = p.elements[_D15 + 1],
          z = _O21 + _I9,
          B = {
            start: _O21,
            count: _I9,
            normals: [],
            continuous: [],
            concave: []
          },
          V = _O21,
          U = z - 1,
          j = _O21 + 1,
          W = _this114._shape.roundedCurves.length;
        do {
          var _ref25;
          var _G11 = V - _O21,
            _J12 = p.vertices[U * 2 + 0],
            Z = p.vertices[U * 2 + 1],
            K = p.vertices[V * 2 + 0],
            Y = p.vertices[V * 2 + 1],
            ye = p.vertices[j * 2 + 0],
            fe = p.vertices[j * 2 + 1],
            oe = K - _J12,
            _e = Y - Z,
            xe = Math.sqrt(oe * oe + _e * _e);
          oe /= xe, _e /= xe;
          var Ie = K - ye,
            Oe = Y - fe,
            Pe = Math.sqrt(Ie * Ie + Oe * Oe);
          Ie /= Pe, Oe /= Pe, B.normals[_G11 * 2 + 0] = -Oe, B.normals[_G11 * 2 + 1] = Ie, B.concave[_G11] = oe * Oe - _e * Ie > 0;
          var Te = p.vertexIndices[V];
          if (Array.isArray(Te)) B.continuous[_G11] = !1;else {
            var _this114$_shape$getCu = _this114._shape.getCurveIndexFromVertexId(Te - 1, !0),
              _this114$_shape$getCu2 = _slicedToArray(_this114$_shape$getCu, 2),
              Ve = _this114$_shape$getCu2[0],
              Ue = _this114$_shape$getCu2[1];
            if (Ue > 0 && Ue < 1) B.continuous[_G11] = !0;else {
              var L = Ue === 1 ? Ve + 1 : Ve - 1;
              L = (L + W) % W;
              var R = Ue === 1 ? 0 : 1,
                ie = _this114._shape.roundedCurves[Ve].getTangent(Ue),
                ue = _this114._shape.roundedCurves[L].getTangent(R);
              B.continuous[_G11] = ie.dot(ue) > .95;
            }
          }
          _P20 && (B.normals[_G11 * 2 + 0] *= -1, B.normals[_G11 * 2 + 1] *= -1), (_ref25 = [V, j, j + 1], U = _ref25[0], V = _ref25[1], j = _ref25[2]), j >= z && (j -= _I9);
        } while (j !== _O21 + 1);
        var k = [];
        k.push({
          bevelI: 0,
          angle: 0,
          size: 0,
          boundary: {
            vertices: p.vertices.slice(_O21 * 2, z * 2),
            vertexCount: _I9,
            vertexIndices: new Array(_I9).fill(!0).map(function (G, J) {
              return [J, J];
            }),
            elements: [0, _I9],
            elementCount: 1,
            mesh: null
          },
          reverseMap: [],
          insetPoints: p.vertices.slice(_O21 * 2, z * 2)
        });
        var H = 0;
        var _loop9 = function _loop9() {
          var J = _G12 / _this114._bevelSegments * Math.PI / 2,
            Z = (1 - Math.cos(J)) * _this114._bevel,
            K = [],
            Y = [],
            ye = [],
            fe = [],
            oe = 0;
          for (var _xe4 = 0; _xe4 < _I9; _xe4++) {
            var _Ie5 = _xe4 * 2,
              _Oe5 = (_xe4 - 1 + _I9) % _I9 * 2,
              _Pe5 = p.vertices[B.start * 2 + _Ie5 + 0],
              _Te2 = p.vertices[B.start * 2 + _Ie5 + 1],
              _Ve2 = -B.normals[_Oe5 + 0] * Z,
              _Ue2 = -B.normals[_Oe5 + 1] * Z,
              _L3 = -B.normals[_Ie5 + 0] * Z,
              _R3 = -B.normals[_Ie5 + 1] * Z;
            if (B.concave[_xe4] || !B.concave[_xe4] && _P20) {
              var _ie2 = Math.atan2(_Ue2, _Ve2),
                _ue4 = Math.atan2(_R3, _L3);
              _ue4 > _ie2 && (_ue4 -= Math.PI * 2);
              var _me4 = _ue4 - _ie2;
              if (B.continuous[_xe4] || _P20) {
                var _De2 = _ie2 + _me4 / 2,
                  _Me5 = Math.cos(_De2) * Z,
                  _Ee7 = Math.sin(_De2) * Z;
                K[2 * oe + 0] = _Pe5 + _Me5 * (_P20 ? -1 : 1), K[2 * oe + 1] = _Te2 + _Ee7 * (_P20 ? -1 : 1), fe[oe] = _xe4, oe++;
              } else {
                var _De3 = Math.max(1, Math.floor(s / 4 * Math.abs(_me4) / Math.PI));
                for (var _Me6 = 0; _Me6 <= _De3; _Me6++) {
                  var _Ee8 = _ie2 + _me4 * (_Me6 / _De3),
                    _le4 = Math.cos(_Ee8) * Z,
                    Je = Math.sin(_Ee8) * Z;
                  K[2 * oe + 0] = _Pe5 + _le4, K[2 * oe + 1] = _Te2 + Je, fe[oe] = _xe4, oe++;
                }
              }
            } else K[2 * oe + 0] = _Pe5 + _Ve2, K[2 * oe + 1] = _Te2 + _Ue2, fe[oe] = _xe4, Y[_xe4] = oe, oe++, K[2 * oe + 0] = _Pe5, K[2 * oe + 1] = _Te2, fe[oe] = _xe4, oe++, K[2 * oe + 0] = _Pe5 + _L3, K[2 * oe + 1] = _Te2 + _R3, fe[oe] = _xe4, ye[_xe4] = oe, oe++;
          }
          var _e = Hs({
            windingRule: Mt.POSITIVE,
            elementType: Rr.BOUNDARY_CONTOURS,
            vertexSize: 2,
            strict: !0,
            contours: [K],
            edgeCreateCallback: function edgeCreateCallback(xe) {
              var Oe = xe.Org.idx,
                Pe = fe[Oe],
                Te = fe[(Oe + 1) % fe.length];
              xe.idx = [Pe, Te], xe.Sym.idx = [Te, Pe];
            },
            vertexIdCallback: function vertexIdCallback(xe) {
              var Ie = xe.Lprev.idx;
              return [Ie ? Ie[1] : 0, xe.idx ? xe.idx[0] : 0];
            }
          });
          if (!_e) throw console.log("Error"), new Error("error generating bevel geometry for ".concat(_G12, "'th loop"));
          if (!_e.vertexCount) {
            var _xe5 = (_G12 - 1) / _this114._bevelSegments * Math.PI / 2;
            H = (1 - Math.sin(_xe5)) * _this114._bevel;
            return 1; // break
          }
          for (var _xe6 = 0; _xe6 < _e.vertexIndices.length; _xe6++) {
            var _e$vertexIndices$_xe = _slicedToArray(_e.vertexIndices[_xe6], 2),
              _Ie6 = _e$vertexIndices$_xe[0],
              _Oe6 = _e$vertexIndices$_xe[1];
            if (_Ie6 === _Oe6) continue;
            var _Pe6 = _Oe6;
            _Oe6 < _Ie6 && (_Pe6 += _I9);
            for (var _Te3 = _Ie6; _Te3 < _Pe6; _Te3++) {
              var _Ve3 = _Te3 % _I9,
                _Ue3 = (_Te3 + 1) % _I9;
              if (!B.continuous[_Ve3] || !B.continuous[_Ue3]) {
                _e.vertexIndices[_xe6] = [_Ie6, _Ve3], _e.vertexIndices.splice(_xe6 + 1, 0, [_Ue3, _Oe6]), _e.vertices.splice((_xe6 + 1) * 2, 0, _e.vertices[_xe6 * 2], _e.vertices[_xe6 * 2 + 1]);
                break;
              }
            }
          }
          k.push({
            bevelI: _G12,
            angle: J,
            size: Z,
            boundary: _e,
            reverseMap: fe,
            insetPoints: K
          });
        };
        for (var _G12 = 1; _G12 <= _this114._bevelSegments; _G12++) {
          if (_loop9()) break;
        }
        var X = function X(G, J, Z) {
            var K = 0,
              Y = G.boundary.vertexIndices.length;
            for (; K < Y && Z(G.boundary.vertexIndices[J]);) J = (J + 1) % Y, K++;
            return K;
          },
          q = w.length;
        for (var _G13 = 1; _G13 < k.length; _G13++) {
          var _J13 = k[_G13 - 1],
            _Z5 = k[_G13],
            _K7 = _J13.boundary.vertexIndices.length,
            _Y11 = _Z5.boundary.vertexIndices.length;
          if (!_K7 || !_Y11) break;
          var _ye3 = B.concave.length,
            _fe4 = 0,
            _oe6 = nA(_fe4, _I9);
          for (; !_J13.boundary.vertexIndices.filter(_oe6).length || !_Z5.boundary.vertexIndices.filter(_oe6).length;) _fe4++, _oe6 = nA(_fe4, _I9);
          var _e45 = _J13.boundary.vertexIndices.findIndex(_oe6),
            _xe3 = _Z5.boundary.vertexIndices.findIndex(_oe6);
          do _e45 = (_e45 + 1) % _K7; while (_oe6(_J13.boundary.vertexIndices[_e45]));
          do _xe3 = (_xe3 + 1) % _Y11; while (_oe6(_Z5.boundary.vertexIndices[_xe3]));
          _fe4 = (_fe4 + 1) % _I9;
          var _Ie4 = _fe4,
            _Oe4 = 0,
            _Pe4 = _this114._buildBevelVert(B, _J13, (_e45 - 1 + _K7) % _K7, void 0, _Oe4),
            _Te = _this114._buildBevelVert(B, _Z5, (_xe3 - 1 + _Y11) % _Y11, void 0, _Oe4),
            _Ve = _Pe4,
            _Ue = _Te,
            _L2 = void 0,
            _R2 = void 0,
            _ie = !1;
          do {
            _Oe4 = (_fe4 || _ye3) / _ye3, _oe6 = nA(_fe4, _I9);
            var _ue3 = X(_J13, _e45, _oe6),
              me = X(_Z5, _xe3, _oe6),
              De = _ie;
            if (_ie = !1, _ue3 && !me) {
              for (var Me = 0; Me < _ue3; Me++) _L2 = _this114._buildBevelVert(B, _J13, (_e45 + Me) % _K7, Me / (_ue3 - 1), _Oe4), w.push(_Ve.topN, _L2.topP, _Ue.topN), l === !1 && w.push(_L2.bottomP, _Ve.bottomN, _Ue.bottomN), _Ve = _L2;
              _ie = !0;
            } else if (!_ue3 && me) for (var _Me = 0; _Me < me; _Me++) _R2 = _this114._buildBevelVert(B, _Z5, (_xe3 + _Me) % _Y11, _Me / (me - 1), _Oe4), w.push(_Ue.topN, _Ve.topP, _R2.topP), l === !1 && w.push(_Ve.bottomP, _Ue.bottomN, _R2.bottomP), _Ue = _R2;else if (_ue3 && me) if (_L2 = _this114._buildBevelVert(B, _J13, _e45, 0, _Oe4), _R2 = _this114._buildBevelVert(B, _Z5, _xe3, 0, _Oe4), De ? (w.push(_Ve.topN, _R2.topP, _Ue.topN), w.push(_Ve.topN, _L2.topP, _R2.topP), l === !1 && (w.push(_R2.bottomP, _Ve.bottomN, _Ue.bottomN), w.push(_R2.bottomP, _L2.bottomP, _Ve.bottomN))) : (w.push(_Ue.topN, _Ve.topN, _L2.topP), w.push(_Ue.topN, _L2.topP, _R2.topP), l === !1 && (w.push(_L2.bottomP, _Ve.bottomN, _Ue.bottomN), w.push(_L2.bottomP, _Ue.bottomN, _R2.bottomP))), _Ve = _L2, _Ue = _R2, _ue3 === me) for (var _Me2 = 1; _Me2 < _ue3; _Me2++) _L2 = _this114._buildBevelVert(B, _J13, (_e45 + _Me2) % _K7, _Me2 / (_ue3 - 1), _Oe4), _R2 = _this114._buildBevelVert(B, _Z5, (_xe3 + _Me2) % _Y11, _Me2 / (me - 1), _Oe4), w.push(_Ve.topN, _L2.topP, _Ue.topN), w.push(_Ue.topN, _L2.topP, _R2.topP), l === !1 && (w.push(_L2.bottomP, _Ve.bottomN, _Ue.bottomN), w.push(_L2.bottomP, _Ue.bottomN, _R2.bottomP)), _Ve = _L2, _Ue = _R2;else if (_ue3 > me) {
              var _Me3 = _ue3 / me,
                Ee = 0;
              for (var le = 1; le < _ue3; le++) _L2 = _this114._buildBevelVert(B, _J13, (_e45 + le) % _K7, le / (_ue3 - 1), _Oe4), w.push(_Ve.topN, _L2.topP, _Ue.topN), l === !1 && w.push(_L2.bottomP, _Ve.bottomN, _Ue.bottomN), _Ve = _L2, le > (Ee + 1) * _Me3 && (Ee++, _R2 = _this114._buildBevelVert(B, _Z5, (_xe3 + Ee) % _Y11, Ee / (me - 1), _Oe4), w.push(_Ue.topN, _L2.topP, _R2.topP), l === !1 && w.push(_L2.bottomP, _Ue.bottomN, _R2.bottomP), _Ue = _R2);
            } else {
              var _Me4 = me / _ue3,
                _Ee6 = 0;
              for (var _le3 = 1; _le3 < me; _le3++) _R2 = _this114._buildBevelVert(B, _Z5, (_xe3 + _le3) % _Y11, _le3 / (me - 1), _Oe4), w.push(_Ue.topN, _L2.topP, _R2.topP), l === !1 && w.push(_L2.bottomP, _Ue.bottomN, _R2.bottomP), _Ue = _R2, _le3 > (_Ee6 + 1) * _Me4 && (_Ee6++, _L2 = _this114._buildBevelVert(B, _J13, (_e45 + _Ee6) % _K7, _Ee6 / (_ue3 - 1), _Oe4), w.push(_Ve.topN, _L2.topP, _Ue.topN), l === !1 && w.push(_L2.bottomP, _Ve.bottomN, _Ue.bottomN), _Ve = _L2);
            }
            _e45 = (_e45 + _ue3) % _K7, _xe3 = (_xe3 + me) % _Y11, _fe4 = (_fe4 + 1) % _ye3;
          } while (_fe4 !== _Ie4);
        }
        if (l === !1 && _this114._depth > _this114._bevel * 2 && _this114._buildWall(k, B, w), _P20) {
          var _G14 = [];
          for (var _J14 = w.length - 1; _J14 >= q + 2; _J14 -= 3) {
            var _Z6 = w[_J14 - 2],
              _K8 = w[_J14 - 1],
              _Y12 = w[_J14 - 0];
            _G14.push(_Y12, _K8, _Z6);
          }
          w.splice.apply(w, [q, w.length - q].concat(_G14));
        }
        if (_P20) {
          var _G15 = [];
          for (var _J15 = k[k.length - 1].boundary.vertices.length - 1; _J15 >= 1; _J15 -= 2) {
            var _Z7 = k[k.length - 1].boundary.vertices[_J15 - 1],
              _K9 = k[k.length - 1].boundary.vertices[_J15 - 0];
            _G15.push(_Z7, _K9);
          }
          A.push(_G15);
        }
        if (!_P20) {
          var _G16 = k[k.length - 1],
            _J16 = void 0;
          try {
            _J16 = Hs({
              windingRule: k.length > 1 ? Mt.POSITIVE : Mt.ODD,
              elementType: Rr.POLYGONS,
              vertexSize: 2,
              strict: !0,
              contours: [_G16.insetPoints].concat(A)
            });
          } catch (_unused18) {
            _J16 = oA;
          }
          if (!_J16) throw new Error("Error generating geometry for surface");
          c.length === 0 && _this114._bevel < f && Object.assign(_assertThisInitialized(_this114), {
            useNgonForTopBottomFaceDuringBake: !0
          });
          for (var _Z8 = 0; _Z8 < _J16.elementCount * 3; _Z8 += 3) {
            var _K10 = _this114._buildSurfaceVert(_J16, _J16.elements[_Z8 + 0], H),
              _Y13 = _this114._buildSurfaceVert(_J16, _J16.elements[_Z8 + 1], H),
              _ye4 = _this114._buildSurfaceVert(_J16, _J16.elements[_Z8 + 2], H);
            w.push(_K10.top, _Y13.top, _ye4.top), l === !1 && w.push(_ye4.bottom, _Y13.bottom, _K10.bottom);
          }
        }
        _this114.vertexCache = {};
      }
      _this114._buffer.shrink();
      var E = new Ge(Uint32Array.from(w), 1),
        b = new Ge(_this114._buffer.positions, 3),
        T = new Ge(_this114._buffer.normals, 3),
        M = new Ge(_this114._buffer.uvs, 2);
      b.needsUpdate = !0, T.needsUpdate = !0, M.needsUpdate = !0, E.needsUpdate = !0, _this114.setAttribute("position", b), _this114.setAttribute("normal", T), _this114.setAttribute("uv", M), _this114.setIndex(E);
      return _this114;
    }
    _createClass(Ol, [{
      key: "_computeBufferEstimatedSize",
      value: function _computeBufferEstimatedSize(e) {
        return e.vertexCount * 2 * (2 + this._bevelSegments);
      }
    }, {
      key: "_buildWall",
      value: function _buildWall(e, r, i) {
        var s = e[0];
        for (var o = 0, a = s.boundary.vertexCount; o < a; o++) {
          var l = this._buildBevelVert(r, s, o),
            u = this._buildBevelVert(r, s, (o + 1) % a);
          i.push(u.topP, l.topN, l.bottomN), i.push(u.topP, l.bottomN, u.bottomP);
        }
      }
    }, {
      key: "_buildSurfaceVert",
      value: function _buildSurfaceVert(e, r, i) {
        var s = r.toString();
        if (s in this.vertexCache) return this.vertexCache[s];
        var o = e.vertices[r * 2 + 0],
          a = e.vertices[r * 2 + 1],
          l = (o - this._minX) / this._width,
          u = (a - this._minY) / this._height;
        this.forPathBevel && (u = 1);
        var c = this._buffer.get(this.forPathBevel ? 1 : 2),
          d = c * 3,
          h = c * 2,
          f = {
            top: c + 0,
            bottom: c + 1
          };
        return this._buffer.positions[d + 0] = o, this._buffer.positions[d + 1] = a, this._buffer.positions[d + 2] = this.forPathBevel ? this._bevel : this._depth - i, this._buffer.normals[d + 0] = 0, this._buffer.normals[d + 1] = 0, this._buffer.normals[d + 2] = 1, this._buffer.uvs[h + 0] = l, this._buffer.uvs[h + 1] = u, this.forPathBevel === !1 && (this._buffer.positions[d + 3] = o, this._buffer.positions[d + 4] = a, this._buffer.positions[d + 5] = i, this._buffer.normals[d + 3] = 0, this._buffer.normals[d + 4] = 0, this._buffer.normals[d + 5] = -1, this._buffer.uvs[h + 2] = l, this._buffer.uvs[h + 3] = u), this.vertexCache[s] = f, f;
      }
    }, {
      key: "_buildBevelVert",
      value: function _buildBevelVert(e, r, i) {
        var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
        var o = arguments.length > 4 ? arguments[4] : undefined;
        var a = "".concat(r.bevelI, ":").concat(i);
        if (a in this.vertexCache && o !== 0 && o !== 1 && (!o || o === this.vertexCache[a].pathBevelUCoord)) return this.vertexCache[a];
        var _r$boundary$vertexInd = _slicedToArray(r.boundary.vertexIndices[i], 2),
          l = _r$boundary$vertexInd[0],
          u = _r$boundary$vertexInd[1],
          c,
          d,
          h,
          f;
        l !== u ? (d = l, c = u, f = !1, h = e.continuous[d] && e.continuous[c]) : (c = l, d = (c - 1 + e.count) % e.count, f = e.concave[c] && r.bevelI > 0, h = e.continuous[c] || f);
        var p = Math.cos(r.angle),
          m = Math.sin(r.angle),
          g = i * 2,
          y = c * 2,
          v = d * 2,
          x = r.boundary.vertices[g + 0],
          S = r.boundary.vertices[g + 1],
          w = (1 - m) * this._bevel,
          A = (x - this._minX) / this._width,
          E = (S - this._minY) / this._height;
        this.forPathBevel && (o !== void 0 && (A = o), E = 1);
        var b = e.normals[y + 0],
          T = e.normals[y + 1],
          M = e.normals[v + 0],
          C = e.normals[v + 1];
        if (f) {
          var z = M - b,
            B = C - T;
          b = b + z * (1 - s), T = T + B * (1 - s);
          var V = Math.sqrt(b * b + T * T);
          b /= V, T /= V;
        }
        var P = this.forPathBevel ? this._buffer.get(h ? 1 : 2) : this._buffer.get(h ? 2 : 4),
          D = P * 3,
          O = P * 2,
          I = {
            i: i,
            fi: c,
            topP: P + 0,
            topN: P + 0,
            bottomP: P + 1,
            bottomN: P + 1,
            pathBevelUCoord: o
          };
        return this._buffer.positions[D + 0] = x, this._buffer.positions[D + 1] = S, this._buffer.positions[D + 2] = (this.forPathBevel ? this._bevel : this._depth) - w, this._buffer.normals[D + 0] = b * p, this._buffer.normals[D + 1] = T * p, this._buffer.normals[D + 2] = m, this._buffer.uvs[O + 0] = A, this._buffer.uvs[O + 1] = E, this.forPathBevel === !1 && (this._buffer.positions[D + 3] = x, this._buffer.positions[D + 4] = S, this._buffer.positions[D + 5] = w, this._buffer.normals[D + 3] = b * p, this._buffer.normals[D + 4] = T * p, this._buffer.normals[D + 5] = -m, this._buffer.uvs[O + 2] = E, this._buffer.uvs[O + 3] = A), h || (this.forPathBevel ? (P += 1, D += 3, O += 2) : (P += 2, D += 6, O += 4), I.topP = P + 0, I.bottomP = P + 1, this._buffer.positions[D + 0] = x, this._buffer.positions[D + 1] = S, this._buffer.positions[D + 2] = (this.forPathBevel ? this._bevel : this._depth) - w, this._buffer.normals[D + 0] = M * p, this._buffer.normals[D + 1] = C * p, this._buffer.normals[D + 2] = m, this._buffer.uvs[O + 0] = A, this._buffer.uvs[O + 1] = E, this.forPathBevel === !1 && (this._buffer.positions[D + 3] = x, this._buffer.positions[D + 4] = S, this._buffer.positions[D + 5] = w, this._buffer.normals[D + 3] = M * p, this._buffer.normals[D + 4] = C * p, this._buffer.normals[D + 5] = -m, this._buffer.uvs[O + 2] = E, this._buffer.uvs[O + 3] = A)), this.vertexCache[a] = I, I;
      }
    }, {
      key: "clone",
      value: function clone() {
        var e = new Ol(this._shape, this._depth, this._bevel, this._curveSegments, this._bevelSegmentsInput);
        return e.userData = ha(this.userData), e;
      }
    }]);
    return Ol;
  }(we);
var xh = /*#__PURE__*/function (_we14) {
  _inherits(xh, _we14);
  var _super125 = _createSuper(xh);
  function xh(e) {
    var _a$vertexCount, _a24, _a$elementCount, _a25, _a$elementCount2, _a26;
    var _this115;
    var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 12;
    var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    _classCallCheck(this, xh);
    _this115 = _super125.call(this);
    _this115.type = "ShapeGeometry";
    _this115.windingRule = Mt.ODD;
    _this115.elementType = Rr.POLYGONS;
    _this115.polySize = 3;
    _this115.vertexSize = 2;
    _this115.strict = !0;
    _this115._shape = e, _this115._curveSegments = r, _this115._triangulationOptions = Object.assign({
      windingRule: Mt.ODD,
      elementType: Rr.POLYGONS,
      polySize: 3,
      vertexSize: 2,
      strict: !0
    }, i);
    var s = _this115._shape.extractShapePointsToFlatArray([], _this115._curveSegments),
      o = _this115._shape.shapeHoles.map(function (p) {
        return p.extractShapePointsToFlatArray([], _this115._curveSegments);
      }),
      a,
      l = !0,
      u = !0,
      c,
      d;
    for (var p = 0, m = s.length / 2; p < m; p++) {
      var g = p * 2,
        y = s[g + 0],
        v = s[g + 1];
      if (c !== void 0 && y !== c && (l = !1), d !== void 0 && v !== d && (u = !1), c = y, d = v, !l && !u) break;
    }
    if (!l && !u) try {
      a = Hs({
        contours: [s].concat(_toConsumableArray(o)),
        windingRule: _this115._triangulationOptions.windingRule,
        elementType: _this115._triangulationOptions.elementType,
        polySize: _this115._triangulationOptions.polySize,
        vertexSize: _this115._triangulationOptions.vertexSize,
        strict: _this115._triangulationOptions.strict
      });
    } catch (_unused19) {
      a = cm;
    }
    var h = (_a$vertexCount = (_a24 = a) === null || _a24 === void 0 ? void 0 : _a24.vertexCount) !== null && _a$vertexCount !== void 0 ? _a$vertexCount : 1,
      f = (_a$elementCount = (_a25 = a) === null || _a25 === void 0 ? void 0 : _a25.elementCount) !== null && _a$elementCount !== void 0 ? _a$elementCount : 1;
    if (_this115._positionAttribute = new Ge(new Float32Array(h * 3), 3), _this115._normalAttribute = new Ge(new Float32Array(h * 3), 3), _this115._uvAttribute = new Ge(new Float32Array(h * 2), 2), _this115._indexAttribute = new Ge(new Uint32Array(f * 3), 1), a) {
      var _p36 = 1 / 0,
        _m29 = -1 / 0,
        _g24 = 1 / 0,
        _y28 = -1 / 0;
      for (var S = 0, w = h; S < w; S++) {
        var A = S * 2,
          E = a.vertices[A + 0],
          b = a.vertices[A + 1];
        E < _p36 && (_p36 = E), E > _m29 && (_m29 = E), b < _g24 && (_g24 = b), b > _y28 && (_y28 = b);
      }
      var _v24 = _m29 - _p36,
        x = _y28 - _g24;
      for (var _S25 = 0, _w23 = h; _S25 < _w23; _S25++) {
        var _A20 = _S25 * 2,
          _E20 = a.vertices[_A20 + 0],
          _b17 = a.vertices[_A20 + 1],
          T = (_E20 - _p36) / _v24,
          M = (_b17 - _g24) / x;
        _this115._positionAttribute.setXYZ(_S25, _E20, _b17, 0), _this115._normalAttribute.setXYZ(_S25, 0, 0, 1), _this115._uvAttribute.setXY(_S25, T, M);
      }
      for (var _S26 = 0, _w24 = f; _S26 < _w24; _S26++) {
        var _A21 = _S26 * 3,
          _E21 = a.elements[_A21 + 0],
          _b18 = a.elements[_A21 + 1],
          _T12 = a.elements[_A21 + 2];
        _this115._indexAttribute.setX(_A21 + 0, _E21), _this115._indexAttribute.setX(_A21 + 1, _b18), _this115._indexAttribute.setX(_A21 + 2, _T12);
      }
    }
    _this115.setAttribute("position", _this115._positionAttribute), _this115.setAttribute("normal", _this115._normalAttribute), _this115.setAttribute("uv", _this115._uvAttribute), _this115.setIndex(_this115._indexAttribute), _this115.setDrawRange(0, ((_a$elementCount2 = (_a26 = a) === null || _a26 === void 0 ? void 0 : _a26.elementCount) !== null && _a$elementCount2 !== void 0 ? _a$elementCount2 : 1) * 3);
    return _this115;
  }
  _createClass(xh, [{
    key: "clone",
    value: function clone() {
      var e = new xh(this._shape, this._curveSegments);
      return e.userData = ha(this.userData), e;
    }
  }]);
  return xh;
}(we);
var bh = /*#__PURE__*/function (_Ol) {
  _inherits(bh, _Ol);
  var _super126 = _createSuper(bh);
  function bh(e, r) {
    var _this116;
    var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 12;
    var o = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 3;
    var a = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : Mt.ODD;
    _classCallCheck(this, bh);
    _this116 = _super126.call(this, e, r, i, s, o, a);
    _this116.type = "ShapeGeometry";
    return _this116;
  }
  _createClass(bh, [{
    key: "_computeBufferEstimatedSize",
    value: function _computeBufferEstimatedSize(e) {
      return e.vertexCount * 2 * (2 + this._bevelSegments);
    }
  }, {
    key: "_buildWall",
    value: function _buildWall(e, r, i) {
      var s = e[0];
      for (var o = 0, a = s.boundary.vertexCount; o < a; o++) {
        var l = this._buildBevelVert(r, s, o),
          u = this._buildBevelVert(r, s, (o + 1) % a);
        i.push(u.topP, l.topN, l.bottomN), i.push(u.topP, l.bottomN, u.bottomP);
      }
    }
  }, {
    key: "clone",
    value: function clone() {
      var e = new bh(this._shape, this._depth, this._bevel, this._curveSegments, this._bevelSegmentsInput);
      return e.userData = ha(this.userData), e;
    }
  }]);
  return bh;
}(Ol);
var Dn = /*#__PURE__*/function () {
  function Dn() {
    _classCallCheck(this, Dn);
  }
  _createClass(Dn, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters5, _e$height5, _e$depth5, _n$shape, _o$roundness, _o21, _n$parameters5, _n$parameters6, _o22;
      var e = Object.assign({}, (_t$parameters5 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters5 !== void 0 ? _t$parameters5 : {
          width: 100,
          subdivisions: 40,
          roundness: 0,
          extrudeBevelSize: 0,
          extrudeBevelSegments: 3,
          windingRule: Mt.ODD
        }, n.parameters),
        r = Math.abs(e.width),
        i = Math.abs((_e$height5 = e.height) !== null && _e$height5 !== void 0 ? _e$height5 : e.width),
        s = Math.abs((_e$depth5 = e.depth) !== null && _e$depth5 !== void 0 ? _e$depth5 : 0),
        o = (_n$shape = n.shape) !== null && _n$shape !== void 0 ? _n$shape : t === null || t === void 0 ? void 0 : t.shape,
        a = (_o$roundness = (_o21 = o) === null || _o21 === void 0 ? void 0 : _o21.roundness) !== null && _o$roundness !== void 0 ? _o$roundness : e.roundness;
      o !== void 0 && (o instanceof kt ? (o.width !== r || o.height !== i) && o.applySize(r, i) : o = new kt(r, i).fromJSON(o), ((_n$parameters5 = n.parameters) === null || _n$parameters5 === void 0 ? void 0 : _n$parameters5.roundness) !== void 0 && ((_n$parameters6 = n.parameters) === null || _n$parameters6 === void 0 ? void 0 : _n$parameters6.roundness) > 0 && o.update());
      var l = (_o22 = o) !== null && _o22 !== void 0 ? _o22 : new kt(r, i);
      return {
        parameters: Object.assign(e, {
          width: r,
          height: i,
          depth: s,
          roundness: a
        }),
        shape: l
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters7 = n.parameters,
        t = _n$parameters7.depth,
        e = _n$parameters7.extrudeBevelSize,
        r = _n$parameters7.extrudeBevelSegments,
        i = _n$parameters7.subdivisions,
        s = _n$parameters7.roundness,
        o = _n$parameters7.windingRule;
      n.shape.roundness = s;
      var a;
      return t <= 0 ? a = new xh(n.shape, i, {
        windingRule: o
      }) : a = new bh(n.shape, t, e, i, r, o), Object.assign(a, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "VectorGeometry"
        })
      });
    }
  }]);
  return Dn;
}();
var qO = Math.PI * 2,
  wh = /*#__PURE__*/function () {
    function wh() {
      _classCallCheck(this, wh);
    }
    _createClass(wh, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters6, _e$height6, _e$depth6;
        var e = Object.assign({}, (_t$parameters6 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters6 !== void 0 ? _t$parameters6 : {
          width: 100,
          depth: 0,
          spikes: 64,
          angle: 360,
          innerRadius: 0,
          extrudeBevelSize: 0,
          extrudeBevelSegments: 1
        }, n.parameters);
        return e.angle = Se.clamp(e.angle, 0, 360), {
          shape: n.shape && n.shape instanceof kt ? n.shape : new kt(),
          parameters: Object.assign(e, {
            width: Math.abs(e.width),
            height: Math.abs((_e$height6 = e.height) !== null && _e$height6 !== void 0 ? _e$height6 : e.width),
            depth: Math.abs((_e$depth6 = e.depth) !== null && _e$depth6 !== void 0 ? _e$depth6 : 0)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters8 = n.parameters,
          t = _n$parameters8.width,
          e = _n$parameters8.height,
          r = _n$parameters8.spikes,
          i = _n$parameters8.angle,
          s = _n$parameters8.innerRadius,
          o = _n$parameters8.depth,
          a = _n$parameters8.extrudeBevelSize,
          l = _n$parameters8.extrudeBevelSegments,
          u = n.shape,
          c = t * .5,
          d = e * .5,
          h = iY(u, c, d, i * Math.PI / 180, r, s);
        u.isClosed = !0, u.update();
        var f;
        return i === 0 ? (f = new we(), f.setAttribute("position", new be([], 3))) : f = Dn.create({
          shape: u,
          parameters: {
            subdivisions: h,
            depth: o,
            extrudeBevelSize: a,
            extrudeBevelSegments: l
          }
        }), Object.assign(f, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "EllipseGeometry"
          })
        });
      }
    }]);
    return wh;
  }();
function iY(n, t, e, r, i, s) {
  if (r >= qO) return i > 30 || i % 4 === 0 ? (sY(n, t, e, s), Math.round(i / 4)) : WO(n, r, i, t, e, s);
  r = Math.max(r, .001);
  var o = {
      x: 0,
      y: e
    },
    a = r + Math.PI * .5,
    l = {
      x: Math.cos(a) * t,
      y: Math.sin(a) * e
    },
    u = NO({
      px: o.x,
      py: o.y,
      cx: l.x,
      cy: l.y,
      rx: t,
      ry: e,
      largeArcFlag: r > Math.PI,
      sweepFlag: !0
    });
  return i > 30 || i % u.length === 0 ? nY(n, o.x, o.y, u, i, t, e, s) : WO(n, r, i, t, e, s);
}
function nY(n, t, e, r, i, s, o, a) {
  var l = Math.round(i / r.length);
  n.addPoint(Sh(t, e));
  for (var u = 0, c = r.length; u < c; u++) {
    var d = r[u],
      h = n.points[u],
      f = Sh(d.x, d.y);
    h.controls[1].position.set(d.x1, d.y1), f.controls[0].position.set(d.x2, d.y2), n.addPoint(f);
  }
  return a > 0 ? YO(n, s, o, a) : n.addPoint(Sh(0, 0)), l;
}
function WO(n, t, e, r, i, s) {
  var o = -t / e;
  for (var a = 0; a <= e; a++) {
    var l = o * a,
      u = Math.sin(l) * r,
      c = Math.cos(l) * i;
    n.addPoint(Sh(u, c));
  }
  return t < qO ? s > 0 ? YO(n, r, i, s) : n.addPoint(Sh(0, 0)) : (n.removePoint(n.points[n.points.length - 1]), s > 0 && XO(n, r, i, s)), 1;
}
function sY(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
  var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
  var s = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
  var o = .5522847498,
    a = t * o,
    l = e * o;
  n.addPoint(b0(i - t, s, i - t, s - l, i - t, s + l)), n.addPoint(b0(i, s + e, i - a, s + e, i + a, s + e)), n.addPoint(b0(i + t, s, i + t, s + l, i + t, s - l)), n.addPoint(b0(i, s - e, i + a, s - e, i - a, s - e)), r > 0 && XO(n, t, e, r);
}
function Sh(n, t) {
  return new js(Se.generateUUID(), new N(n, t));
}
function b0(n, t, e, r, i, s) {
  var o = Sh(n, t);
  return o.controls[0].position.set(e, r), o.controls[1].position.set(i, s), o;
}
function YO(n, t, e, r) {
  QO(n, t, e, r).forEach(function (s) {
    return n.addPoint(s);
  });
}
function XO(n, t, e, r) {
  var i = QO(n, t, e, r),
    s = new kt();
  i.forEach(function (o) {
    return s.addPoint(o);
  }), s.isClosed = !0, n.shapeHoles.push(s);
}
function QO(n, t, e, r) {
  var i = r * t / 100,
    s = i * (Math.abs(e) / Math.abs(t)),
    o = new N(i / t, s / e),
    a = n.points.map(function (l) {
      var u = l.clone();
      return u.uuid = Se.generateUUID(), u;
    }).reverse();
  return a.forEach(function (l) {
    l.position.multiply(o);
    var u = l.controls[0].position.clone().multiply(o),
      c = l.controls[1].position.clone().multiply(o);
    l.controls[0].position.copy(c), l.controls[1].position.copy(u);
  }), a;
}
var KO = /*#__PURE__*/function () {
    function KO() {
      _classCallCheck(this, KO);
    }
    _createClass(KO, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters7, _e$height7, _e$depth7;
        var e = Object.assign({}, (_t$parameters7 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters7 !== void 0 ? _t$parameters7 : {
            width: 100,
            revolutions: 2,
            segments: 40,
            pathRadius: 10,
            pathType: 0,
            pathSegments: 30,
            cornerRadius: 30,
            cornerSegments: 4
          }, n.parameters),
          r = Math.abs(e.width),
          i = Math.abs((_e$height7 = e.height) !== null && _e$height7 !== void 0 ? _e$height7 : r),
          s = Math.abs((_e$depth7 = e.depth) !== null && _e$depth7 !== void 0 ? _e$depth7 : r),
          o = Math.abs(Math.min(r, s)) / 2;
        return {
          parameters: Object.assign(e, {
            width: r,
            height: i,
            depth: s,
            radius: o,
            segments: Math.round(e.segments),
            pathSegments: Math.round(e.pathSegments),
            cornerSegments: Math.round(e.cornerSegments)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters9 = n.parameters,
          t = _n$parameters9.width,
          e = _n$parameters9.height,
          r = _n$parameters9.depth,
          i = _n$parameters9.radius,
          s = _n$parameters9.revolutions,
          o = _n$parameters9.segments,
          a = _n$parameters9.pathRadius,
          l = _n$parameters9.pathType,
          u = _n$parameters9.pathSegments,
          c = _n$parameters9.cornerRadius,
          d = _n$parameters9.cornerSegments,
          h = new um(!1, t, e, r, i, s, o, a, l, u, c, d);
        return Object.assign(h, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "HelixGeometry"
          })
        });
      }
    }]);
    return KO;
  }(),
  aA = new co([0, 0, 0], 1),
  um = /*#__PURE__*/function (_we15) {
    _inherits(um, _we15);
    var _super127 = _createSuper(um);
    function um() {
      var _this117;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;
      var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
      var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 1;
      var u = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : 1;
      var c = arguments.length > 9 && arguments[9] !== undefined ? arguments[9] : 1;
      var d = arguments.length > 10 && arguments[10] !== undefined ? arguments[10] : 1;
      var h = arguments.length > 11 && arguments[11] !== undefined ? arguments[11] : 1;
      _classCallCheck(this, um);
      if (_this117 = _super127.call(this), o === 0) return _possibleConstructorReturn(_this117);
      var f = t && o === 1;
      f && (h = 0), d > 100 && (d = 100), d === 0 && (h = 0);
      var p = function p() {
          return new _();
        },
        m = new _(),
        g = p(),
        y = p(),
        v = p(),
        x,
        S,
        w,
        A,
        E,
        b,
        T,
        M,
        C = p(),
        P = p(),
        D = p(),
        O = p(),
        I = p(),
        z = p(),
        B = p(),
        V = p(),
        U = r - 2 * l + .001,
        j = U / o,
        W = Math.ceil(a * o),
        k = W + 1,
        H = U / W,
        X = -U / 2,
        q = c + 1,
        G = 2 * Math.PI / c,
        J = Math.PI / 2 / h,
        Z = .01,
        K = Math.min((1 - d / 100) * l, l - Z),
        Y = l - K,
        ye = 0,
        fe = 2,
        oe = h * fe + fe,
        _e = q * oe / fe,
        xe = _e + q * k,
        Ie = Math.max(0, q * (k + oe)),
        _map = [3, 3, 2].map(function (ke) {
          return Array(Ie * ke).fill(0);
        }),
        _map2 = _slicedToArray(_map, 3),
        Oe = _map2[0],
        Pe = _map2[1],
        Te = _map2[2],
        Ve = [],
        Ue = s - l;
      function L(ke, Be) {
        var qe = Math.PI / 2;
        b = Be * H, M = 2 * Math.PI * (b % j) / j + qe, b += X, T = Math.sin(M) * Ue, E = Math.cos(M) * Ue, t ? ke.set(E, T, b) : ke.set(E, b, T);
      }
      L(m, -1e-10), L(g, 0), C.copy(m), L(m, 1);
      var R = m.distanceTo(g),
        ie = f ? 0 : Y + K,
        ue = R * W + 2 * ie,
        me = K,
        De = ue - ie;
      var _loop10 = function _loop10() {
        L(y, ke), V.subVectors(y, C).normalize(), C.copy(y), z.copy(y).setComponent(+t + 1, 0).normalize(), B.crossVectors(V, z).normalize();
        var Be = ke === 0,
          qe = ke === W,
          et = Be ? 3 * Math.PI / 2 : J,
          Dt = Be ? me : De,
          yr = Be ? q : xe,
          ti = Be ? 0 : Ie - q,
          Q = V.clone().multiplyScalar(Be ? -Y : Y).add(y),
          ce = V.clone().multiplyScalar(Be ? -1 : 1).normalize();
        for (var ve = 0; ve < q; ve++) {
          var ze = ve * G;
          if (P.addVectors(m.copy(z).multiplyScalar(l * Math.cos(ze)), g.copy(B).multiplyScalar(l * Math.sin(ze))), D.copy(P).normalize(), Be || qe) {
            f || (ye = ti + ve, [0, 1, 2].forEach(function (Fe) {
              Oe[ye * 3 + Fe] = Q.getComponent(Fe), Pe[ye * 3 + Fe] = ce.getComponent(Fe);
            }), Te[ye * 2] = +qe, Te[ye * 2 + 1] = ve / c), g.copy(D).multiplyScalar(K), v.addVectors(y, g);
            for (var Fe = 0; Fe < h; Fe++) {
              var Ot = Fe * J + et;
              O.addVectors(m.copy(V).multiplyScalar(Y * Math.sin(Ot)), g.copy(D).multiplyScalar(Y * Math.cos(Ot))), I.copy(O).normalize(), g.addVectors(v, O), O.normalize(), ye = yr + Fe * q + ve, [0, 1, 2].forEach(function (jr) {
                Oe[ye * 3 + jr] = g.getComponent(jr), Pe[ye * 3 + jr] = I.getComponent(jr);
              });
              var ri = +Be + Math.sin(Ot);
              Te[ye * 2] = (Dt + Y * ri) / ue, Te[ye * 2 + 1] = ve / c;
            }
          }
          g.addVectors(y, P), ye = _e + ke * q + ve, [0, 1, 2].forEach(function (Fe) {
            Oe[ye * 3 + Fe] = g.getComponent(Fe), Pe[ye * 3 + Fe] = D.getComponent(Fe);
          }), Te[ye * 2] = (ie + ke * R) / ue, Te[ye * 2 + 1] = ve / c;
        }
      };
      for (var ke = 0; ke <= W; ke++) {
        _loop10();
      }
      var Me = k + 2 * h + fe,
        Ee = 1,
        le = +f,
        Je = Me - 1;
      for (var _ke4 = le; _ke4 <= Je - 1; _ke4++) {
        var Be = f && _ke4 === Je - 1;
        for (var qe = 0; qe < q - 1; qe++) x = _ke4 * q + qe, S = x + 1, w = (Be ? qe : x) + q, A = (Be ? qe + 1 : S) + q, _ke4 === 0 ? Ve.push(S, A, w) : _ke4 === Me - 2 ? Ve.push(x, S, w) : Ve.push(x, S, w, S, A, w);
      }
      _this117.setIndex(Ve), _this117.setAttribute("position", new be(Oe, 3)), _this117.setAttribute("normal", new be(Pe, 3)), _this117.setAttribute("uv", new be(Te, 2));
      return _possibleConstructorReturn(_this117);
    }
    _createClass(um, [{
      key: "getClosedTorusIndicesForBooleanOrSubdiv",
      value: function getClosedTorusIndicesForBooleanOrSubdiv() {
        var t = this.userData.parameters,
          e = Math.ceil(t.tubularSegments),
          r = t.radialSegments + 1,
          i = Array.from(this.getIndex().array),
          s,
          o,
          a,
          l,
          u = 6 * (e - 1) * t.radialSegments,
          c = e,
          d = c === e;
        for (var h = 0; h < t.radialSegments; h++) s = c * r + h, o = s + 1, a = (d ? h : s) + r, l = (d ? h + 1 : o) + r, i[u++] = s, i[u++] = o, i[u++] = a, i[u++] = o, i[u++] = l, i[u++] = a;
        return i.length = u, aA.array = i, aA.count = i.length, aA;
      }
    }]);
    return um;
  }(we);
var ZO = /*#__PURE__*/function () {
    function ZO() {
      _classCallCheck(this, ZO);
    }
    _createClass(ZO, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters8, _e$height8, _e$depth8;
        var e = Object.assign({}, (_t$parameters8 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters8 !== void 0 ? _t$parameters8 : {
          width: 100,
          detail: 0,
          corner: 0,
          cornerSides: 4
        }, n.parameters);
        return {
          parameters: Object.assign(e, {
            width: Math.abs(e.width),
            height: Math.abs((_e$height8 = e.height) !== null && _e$height8 !== void 0 ? _e$height8 : e.width),
            depth: Math.abs((_e$depth8 = e.depth) !== null && _e$depth8 !== void 0 ? _e$depth8 : e.width)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters10 = n.parameters,
          t = _n$parameters10.width,
          e = _n$parameters10.height,
          r = _n$parameters10.depth,
          i = _n$parameters10.detail,
          s = _n$parameters10.corner,
          o = _n$parameters10.cornerSides,
          a = i === 0 && s !== 0 ? new dm(t * .5, s, o) : new ku(t * .5, i);
        return a.scale(1, e / t, r / t), Object.assign(a, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "IcosahedronGeometry"
          })
        });
      }
    }]);
    return ZO;
  }(),
  dm = /*#__PURE__*/function (_Cl2) {
    _inherits(dm, _Cl2);
    var _super128 = _createSuper(dm);
    function dm() {
      var _this118;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : .2;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4;
      _classCallCheck(this, dm);
      var i = (1 + Math.sqrt(5)) / 2,
        s = [-1, i, 0, 1, i, 0, -1, -i, 0, 1, -i, 0, 0, -1, i, 0, 1, i, 0, -1, -i, 0, 1, -i, i, 0, -1, i, 0, 1, -i, 0, -1, -i, 0, 1],
        o = [0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 0, 10, 11, 1, 5, 9, 5, 11, 4, 11, 10, 2, 10, 7, 6, 7, 1, 8, 3, 9, 4, 3, 4, 2, 3, 2, 6, 3, 6, 8, 3, 8, 9, 4, 9, 5, 2, 4, 11, 6, 2, 10, 8, 6, 7, 9, 8, 1],
        a = "IcosahedronGeometry";
      _this118 = _super128.call(this, s, o, a, t, e, r), _this118.type = a;
      return _this118;
    }
    _createClass(dm, null, [{
      key: "fromJSON",
      value: function fromJSON(t) {
        return new dm(t.radius, t.corner, t.cornerSides);
      }
    }]);
    return dm;
  }(Cl);
var JO = /*#__PURE__*/function () {
  function JO() {
    _classCallCheck(this, JO);
  }
  _createClass(JO, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _n$parameters$points, _n$parameters11, _t$parameters9, _e$height9, _e$depth9;
      ((_n$parameters$points = (_n$parameters11 = n.parameters) === null || _n$parameters11 === void 0 ? void 0 : _n$parameters11.points) !== null && _n$parameters$points !== void 0 ? _n$parameters$points : []).forEach(function (r) {
        Array.isArray(r) && (r.x = r[0], r.y = r[1]);
      });
      var e = Object.assign({}, (_t$parameters9 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters9 !== void 0 ? _t$parameters9 : {
        width: 100,
        segments: 64,
        verticalSegments: 64,
        points: [{
          x: 0,
          y: -50,
          id: 0
        }, {
          x: 50,
          y: -50,
          id: 1
        }, {
          x: 50,
          y: 50,
          id: 2
        }, {
          x: 0,
          y: 50,
          id: 3
        }]
      }, n.parameters);
      return {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height9 = e.height) !== null && _e$height9 !== void 0 ? _e$height9 : e.width),
          depth: Math.abs((_e$depth9 = e.depth) !== null && _e$depth9 !== void 0 ? _e$depth9 : e.width)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters12 = n.parameters,
        t = _n$parameters12.points,
        e = _n$parameters12.segments,
        r = _n$parameters12.verticalSegments,
        i = new oa();
      i.moveTo(t[0].x, t[0].y), i.bezierCurveTo(t[1].x, t[1].y, t[2].x, t[2].y, t[3].x, t[3].y);
      var s = new Lu(i.extractPoints(r).shape, e);
      return s.rotateZ(Math.PI), Object.assign(s, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "LatheGeometry"
        })
      });
    }
  }]);
  return JO;
}();
var Co = new te(),
  lA = new mt(),
  S0 = new _(),
  Il = /*#__PURE__*/function (_ir8) {
    _inherits(Il, _ir8);
    var _super129 = _createSuper(Il);
    function Il() {
      var _this119;
      _classCallCheck(this, Il);
      _this119 = _super129.call(this), _this119.uuid = Se.generateUUID(), _this119.name = "", _this119.type = "Geometry", _this119.vertices = [], _this119.colors = [], _this119.faces = [], _this119.faceVertexUvs = [[]], _this119.morphTargets = [], _this119.morphNormals = [], _this119.skinWeights = [], _this119.skinIndices = [], _this119.lineDistances = [], _this119.boundingBox = null, _this119.boundingSphere = null, _this119.elementsNeedUpdate = !1, _this119.verticesNeedUpdate = !1, _this119.uvsNeedUpdate = !1, _this119.normalsNeedUpdate = !1, _this119.colorsNeedUpdate = !1, _this119.lineDistancesNeedUpdate = !1, _this119.groupsNeedUpdate = !1;
      return _this119;
    }
    _createClass(Il, [{
      key: "applyMatrix4",
      value: function applyMatrix4(t) {
        var e = new Qt().getNormalMatrix(t);
        for (var r = 0, i = this.vertices.length; r < i; r++) this.vertices[r].applyMatrix4(t);
        for (var _r20 = 0, _i47 = this.faces.length; _r20 < _i47; _r20++) {
          var s = this.faces[_r20];
          s.normal.applyMatrix3(e).normalize();
          for (var o = 0, a = s.vertexNormals.length; o < a; o++) s.vertexNormals[o].applyMatrix3(e).normalize();
        }
        return this.boundingBox !== null && this.computeBoundingBox(), this.boundingSphere !== null && this.computeBoundingSphere(), this.verticesNeedUpdate = !0, this.normalsNeedUpdate = !0, this;
      }
    }, {
      key: "rotateX",
      value: function rotateX(t) {
        return Co.makeRotationX(t), this.applyMatrix4(Co), this;
      }
    }, {
      key: "rotateY",
      value: function rotateY(t) {
        return Co.makeRotationY(t), this.applyMatrix4(Co), this;
      }
    }, {
      key: "rotateZ",
      value: function rotateZ(t) {
        return Co.makeRotationZ(t), this.applyMatrix4(Co), this;
      }
    }, {
      key: "translate",
      value: function translate(t, e, r) {
        return Co.makeTranslation(t, e, r), this.applyMatrix4(Co), this;
      }
    }, {
      key: "scale",
      value: function scale(t, e, r) {
        return Co.makeScale(t, e, r), this.applyMatrix4(Co), this;
      }
    }, {
      key: "lookAt",
      value: function lookAt(t) {
        return lA.lookAt(t), lA.updateMatrix(), this.applyMatrix4(lA.matrix), this;
      }
    }, {
      key: "fromBufferGeometry",
      value: function fromBufferGeometry(t) {
        var e = this,
          r = t.index !== null ? t.index : void 0,
          i = t.attributes;
        if (i.position === void 0) return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."), this;
        var s = i.position,
          o = i.normal,
          a = i.color,
          l = i.uv,
          u = i.uv2;
        u !== void 0 && (this.faceVertexUvs[1] = []);
        for (var h = 0; h < s.count; h++) e.vertices.push(new _().fromBufferAttribute(s, h)), a !== void 0 && e.colors.push(new Le().fromBufferAttribute(a, h));
        function c(h, f, p, m) {
          var g = a === void 0 ? [] : [e.colors[h].clone(), e.colors[f].clone(), e.colors[p].clone()],
            y = o === void 0 ? [] : [new _().fromBufferAttribute(o, h), new _().fromBufferAttribute(o, f), new _().fromBufferAttribute(o, p)],
            v = new Ah(h, f, p, y, g, m);
          e.faces.push(v), l !== void 0 && e.faceVertexUvs[0].push([new N().fromBufferAttribute(l, h), new N().fromBufferAttribute(l, f), new N().fromBufferAttribute(l, p)]), u !== void 0 && e.faceVertexUvs[1].push([new N().fromBufferAttribute(u, h), new N().fromBufferAttribute(u, f), new N().fromBufferAttribute(u, p)]);
        }
        var d = t.groups;
        if (d.length > 0) for (var _h45 = 0; _h45 < d.length; _h45++) {
          var f = d[_h45],
            p = f.start,
            m = f.count;
          for (var g = p, y = p + m; g < y; g += 3) r !== void 0 ? c(r.getX(g), r.getX(g + 1), r.getX(g + 2), f.materialIndex) : c(g, g + 1, g + 2, f.materialIndex);
        } else if (r !== void 0) for (var _h46 = 0; _h46 < r.count; _h46 += 3) c(r.getX(_h46), r.getX(_h46 + 1), r.getX(_h46 + 2));else for (var _h47 = 0; _h47 < s.count; _h47 += 3) c(_h47, _h47 + 1, _h47 + 2);
        return this.computeFaceNormals(), t.boundingBox !== null && (this.boundingBox = t.boundingBox.clone()), t.boundingSphere !== null && (this.boundingSphere = t.boundingSphere.clone()), this;
      }
    }, {
      key: "center",
      value: function center() {
        return this.computeBoundingBox(), this.boundingBox.getCenter(S0).negate(), this.translate(S0.x, S0.y, S0.z), this;
      }
    }, {
      key: "normalize",
      value: function normalize() {
        this.computeBoundingSphere();
        var t = this.boundingSphere.center,
          e = this.boundingSphere.radius,
          r = e === 0 ? 1 : 1 / e,
          i = new te();
        return i.set(r, 0, 0, -r * t.x, 0, r, 0, -r * t.y, 0, 0, r, -r * t.z, 0, 0, 0, 1), this.applyMatrix4(i), this;
      }
    }, {
      key: "computeFaceNormals",
      value: function computeFaceNormals() {
        var t = new _(),
          e = new _();
        for (var r = 0, i = this.faces.length; r < i; r++) {
          var s = this.faces[r],
            o = this.vertices[s.a],
            a = this.vertices[s.b],
            l = this.vertices[s.c];
          t.subVectors(l, a), e.subVectors(o, a), t.cross(e), t.normalize(), s.normal.copy(t);
        }
      }
    }, {
      key: "computeVertexNormals",
      value: function computeVertexNormals() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
        var e = new Array(this.vertices.length);
        for (var r = 0, i = this.vertices.length; r < i; r++) e[r] = new _();
        if (t) {
          var _r21 = new _(),
            _i48 = new _();
          for (var s = 0, o = this.faces.length; s < o; s++) {
            var a = this.faces[s],
              l = this.vertices[a.a],
              u = this.vertices[a.b],
              c = this.vertices[a.c];
            _r21.subVectors(c, u), _i48.subVectors(l, u), _r21.cross(_i48), e[a.a].add(_r21), e[a.b].add(_r21), e[a.c].add(_r21);
          }
        } else {
          this.computeFaceNormals();
          for (var _r22 = 0, _i49 = this.faces.length; _r22 < _i49; _r22++) {
            var _s23 = this.faces[_r22];
            e[_s23.a].add(_s23.normal), e[_s23.b].add(_s23.normal), e[_s23.c].add(_s23.normal);
          }
        }
        for (var _r23 = 0, _i50 = this.vertices.length; _r23 < _i50; _r23++) e[_r23].normalize();
        for (var _r24 = 0, _i51 = this.faces.length; _r24 < _i51; _r24++) {
          var _s24 = this.faces[_r24],
            _o23 = _s24.vertexNormals;
          _o23.length === 3 ? (_o23[0].copy(e[_s24.a]), _o23[1].copy(e[_s24.b]), _o23[2].copy(e[_s24.c])) : (_o23[0] = e[_s24.a].clone(), _o23[1] = e[_s24.b].clone(), _o23[2] = e[_s24.c].clone());
        }
        this.faces.length > 0 && (this.normalsNeedUpdate = !0);
      }
    }, {
      key: "computeFlatVertexNormals",
      value: function computeFlatVertexNormals() {
        this.computeFaceNormals();
        for (var t = 0, e = this.faces.length; t < e; t++) {
          var r = this.faces[t],
            i = r.vertexNormals;
          i.length === 3 ? (i[0].copy(r.normal), i[1].copy(r.normal), i[2].copy(r.normal)) : (i[0] = r.normal.clone(), i[1] = r.normal.clone(), i[2] = r.normal.clone());
        }
        this.faces.length > 0 && (this.normalsNeedUpdate = !0);
      }
    }, {
      key: "computeMorphNormals",
      value: function computeMorphNormals() {
        for (var e = 0, r = this.faces.length; e < r; e++) {
          var i = this.faces[e];
          i.__originalFaceNormal ? i.__originalFaceNormal.copy(i.normal) : i.__originalFaceNormal = i.normal.clone(), i.__originalVertexNormals || (i.__originalVertexNormals = []);
          for (var s = 0, o = i.vertexNormals.length; s < o; s++) i.__originalVertexNormals[s] ? i.__originalVertexNormals[s].copy(i.vertexNormals[s]) : i.__originalVertexNormals[s] = i.vertexNormals[s].clone();
        }
        var t = new Il();
        t.faces = this.faces;
        for (var _e46 = 0, _r25 = this.morphTargets.length; _e46 < _r25; _e46++) {
          if (!this.morphNormals[_e46]) {
            this.morphNormals[_e46] = {}, this.morphNormals[_e46].faceNormals = [], this.morphNormals[_e46].vertexNormals = [];
            var _s25 = this.morphNormals[_e46].faceNormals,
              _o24 = this.morphNormals[_e46].vertexNormals;
            for (var a = 0, l = this.faces.length; a < l; a++) {
              var u = new _(),
                c = {
                  a: new _(),
                  b: new _(),
                  c: new _()
                };
              _s25.push(u), _o24.push(c);
            }
          }
          var _i52 = this.morphNormals[_e46];
          t.vertices = this.morphTargets[_e46].vertices, t.computeFaceNormals(), t.computeVertexNormals();
          for (var _s26 = 0, _o25 = this.faces.length; _s26 < _o25; _s26++) {
            var _a27 = this.faces[_s26],
              _l51 = _i52.faceNormals[_s26],
              _u27 = _i52.vertexNormals[_s26];
            _l51.copy(_a27.normal), _u27.a.copy(_a27.vertexNormals[0]), _u27.b.copy(_a27.vertexNormals[1]), _u27.c.copy(_a27.vertexNormals[2]);
          }
        }
        for (var _e47 = 0, _r26 = this.faces.length; _e47 < _r26; _e47++) {
          var _i53 = this.faces[_e47];
          _i53.normal = _i53.__originalFaceNormal, _i53.vertexNormals = _i53.__originalVertexNormals;
        }
      }
    }, {
      key: "computeBoundingBox",
      value: function computeBoundingBox() {
        this.boundingBox === null && (this.boundingBox = new Bt()), this.boundingBox.setFromPoints(this.vertices);
      }
    }, {
      key: "computeBoundingSphere",
      value: function computeBoundingSphere() {
        this.boundingSphere === null && (this.boundingSphere = new Er()), this.boundingSphere.setFromPoints(this.vertices);
      }
    }, {
      key: "merge",
      value: function merge(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        if (!(t && t.isGeometry)) {
          console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.", t);
          return;
        }
        var i,
          s = this.vertices.length,
          o = this.vertices,
          a = t.vertices,
          l = this.faces,
          u = t.faces,
          c = this.colors,
          d = t.colors;
        e !== void 0 && (i = new Qt().getNormalMatrix(e));
        for (var h = 0, f = a.length; h < f; h++) {
          var m = a[h].clone();
          e !== void 0 && m.applyMatrix4(e), o.push(m);
        }
        for (var _h48 = 0, _f57 = d.length; _h48 < _f57; _h48++) c.push(d[_h48].clone());
        for (var _h49 = 0, _f58 = u.length; _h49 < _f58; _h49++) {
          var p = u[_h49],
            _m30 = void 0,
            g = void 0,
            y = p.vertexNormals,
            v = p.vertexColors,
            x = new Ah(p.a + s, p.b + s, p.c + s);
          x.normal.copy(p.normal), i !== void 0 && x.normal.applyMatrix3(i).normalize();
          for (var S = 0, w = y.length; S < w; S++) _m30 = y[S].clone(), i !== void 0 && _m30.applyMatrix3(i).normalize(), x.vertexNormals.push(_m30);
          x.color.copy(p.color);
          for (var _S27 = 0, _w25 = v.length; _S27 < _w25; _S27++) g = v[_S27], x.vertexColors.push(g.clone());
          x.materialIndex = p.materialIndex + r, l.push(x);
        }
        for (var _h50 = 0, _f59 = t.faceVertexUvs.length; _h50 < _f59; _h50++) {
          var _p37 = t.faceVertexUvs[_h50];
          this.faceVertexUvs[_h50] === void 0 && (this.faceVertexUvs[_h50] = []);
          for (var _m31 = 0, _g25 = _p37.length; _m31 < _g25; _m31++) {
            var _y29 = _p37[_m31],
              _v25 = [];
            for (var _x25 = 0, _S28 = _y29.length; _x25 < _S28; _x25++) _v25.push(_y29[_x25].clone());
            this.faceVertexUvs[_h50].push(_v25);
          }
        }
      }
    }, {
      key: "mergeMesh",
      value: function mergeMesh(t) {
        if (!(t && t.isMesh)) {
          console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.", t);
          return;
        }
        t.matrixAutoUpdate && t.updateMatrix(), this.merge(t.geometry, t.matrix);
      }
    }, {
      key: "mergeVertices",
      value: function mergeVertices() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 4;
        var e = {},
          r = [],
          i = [],
          s = Math.pow(10, t);
        for (var l = 0, u = this.vertices.length; l < u; l++) {
          var c = this.vertices[l],
            d = Math.round(c.x * s) + "_" + Math.round(c.y * s) + "_" + Math.round(c.z * s);
          e[d] === void 0 ? (e[d] = l, r.push(this.vertices[l]), i[l] = r.length - 1) : i[l] = i[e[d]];
        }
        var o = [];
        for (var _l52 = 0, _u28 = this.faces.length; _l52 < _u28; _l52++) {
          var _c24 = this.faces[_l52];
          _c24.a = i[_c24.a], _c24.b = i[_c24.b], _c24.c = i[_c24.c];
          var _d38 = [_c24.a, _c24.b, _c24.c];
          for (var h = 0; h < 3; h++) if (_d38[h] === _d38[(h + 1) % 3]) {
            o.push(_l52);
            break;
          }
        }
        for (var _l53 = o.length - 1; _l53 >= 0; _l53--) {
          var _u29 = o[_l53];
          this.faces.splice(_u29, 1);
          for (var _c25 = 0, _d39 = this.faceVertexUvs.length; _c25 < _d39; _c25++) this.faceVertexUvs[_c25].splice(_u29, 1);
        }
        var a = this.vertices.length - r.length;
        return this.vertices = r, a;
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t) {
        this.vertices = [];
        for (var e = 0, r = t.length; e < r; e++) {
          var i = t[e];
          this.vertices.push(new _(i.x, i.y, i.z || 0));
        }
        return this;
      }
    }, {
      key: "sortFacesByMaterialIndex",
      value: function sortFacesByMaterialIndex() {
        var t = this.faces,
          e = t.length;
        for (var l = 0; l < e; l++) t[l]._id = l;
        function r(l, u) {
          return l.materialIndex - u.materialIndex;
        }
        t.sort(r);
        var i = this.faceVertexUvs[0],
          s = this.faceVertexUvs[1],
          o,
          a;
        i && i.length === e && (o = []), s && s.length === e && (a = []);
        for (var _l54 = 0; _l54 < e; _l54++) {
          var u = t[_l54]._id;
          o && o.push(i[u]), a && a.push(s[u]);
        }
        o && (this.faceVertexUvs[0] = o), a && (this.faceVertexUvs[1] = a);
      }
    }, {
      key: "toJSON",
      value: function toJSON() {
        var t = {
          metadata: {
            version: 4.5,
            type: "Geometry",
            generator: "Geometry.toJSON"
          }
        };
        if (t.uuid = this.uuid, t.type = this.type, this.name !== "" && (t.name = this.name), this.parameters !== void 0) {
          var p = this.parameters;
          for (var m in p) p[m] !== void 0 && (t[m] = p[m]);
          return t;
        }
        var e = [];
        for (var _p38 = 0; _p38 < this.vertices.length; _p38++) {
          var _m32 = this.vertices[_p38];
          e.push(_m32.x, _m32.y, _m32.z);
        }
        var r = [],
          i = [],
          s = {},
          o = [],
          a = {},
          l = [],
          u = {};
        for (var _p39 = 0; _p39 < this.faces.length; _p39++) {
          var _m33 = this.faces[_p39],
            g = !0,
            y = !1,
            v = this.faceVertexUvs[0][_p39] !== void 0,
            x = _m33.normal.length() > 0,
            S = _m33.vertexNormals.length > 0,
            w = _m33.color.r !== 1 || _m33.color.g !== 1 || _m33.color.b !== 1,
            A = _m33.vertexColors.length > 0,
            E = 0;
          if (E = c(E, 0, 0), E = c(E, 1, g), E = c(E, 2, y), E = c(E, 3, v), E = c(E, 4, x), E = c(E, 5, S), E = c(E, 6, w), E = c(E, 7, A), r.push(E), r.push(_m33.a, _m33.b, _m33.c), r.push(_m33.materialIndex), v) {
            var b = this.faceVertexUvs[0][_p39];
            r.push(f(b[0]), f(b[1]), f(b[2]));
          }
          if (x && r.push(d(_m33.normal)), S) {
            var _b19 = _m33.vertexNormals;
            r.push(d(_b19[0]), d(_b19[1]), d(_b19[2]));
          }
          if (w && r.push(h(_m33.color)), A) {
            var _b20 = _m33.vertexColors;
            r.push(h(_b20[0]), h(_b20[1]), h(_b20[2]));
          }
        }
        function c(p, m, g) {
          return g ? p | 1 << m : p & ~(1 << m);
        }
        function d(p) {
          var m = p.x.toString() + p.y.toString() + p.z.toString();
          return s[m] !== void 0 || (s[m] = i.length / 3, i.push(p.x, p.y, p.z)), s[m];
        }
        function h(p) {
          var m = p.r.toString() + p.g.toString() + p.b.toString();
          return a[m] !== void 0 || (a[m] = o.length, o.push(p.getHex())), a[m];
        }
        function f(p) {
          var m = p.x.toString() + p.y.toString();
          return u[m] !== void 0 || (u[m] = l.length / 2, l.push(p.x, p.y)), u[m];
        }
        return t.data = {}, t.data.vertices = e, t.data.normals = i, o.length > 0 && (t.data.colors = o), l.length > 0 && (t.data.uvs = [l]), t.data.faces = r, t;
      }
    }, {
      key: "clone",
      value: function clone() {
        return new Il().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.vertices = [], this.colors = [], this.faces = [], this.faceVertexUvs = [[]], this.morphTargets = [], this.morphNormals = [], this.skinWeights = [], this.skinIndices = [], this.lineDistances = [], this.boundingBox = null, this.boundingSphere = null, this.name = t.name;
        var e = t.vertices;
        for (var h = 0, f = e.length; h < f; h++) this.vertices.push(e[h].clone());
        var r = t.colors;
        for (var _h51 = 0, _f60 = r.length; _h51 < _f60; _h51++) this.colors.push(r[_h51].clone());
        var i = t.faces;
        for (var _h52 = 0, _f61 = i.length; _h52 < _f61; _h52++) this.faces.push(i[_h52].clone());
        for (var _h53 = 0, _f62 = t.faceVertexUvs.length; _h53 < _f62; _h53++) {
          var p = t.faceVertexUvs[_h53];
          this.faceVertexUvs[_h53] === void 0 && (this.faceVertexUvs[_h53] = []);
          for (var m = 0, g = p.length; m < g; m++) {
            var y = p[m],
              v = [];
            for (var x = 0, S = y.length; x < S; x++) {
              var w = y[x];
              v.push(w.clone());
            }
            this.faceVertexUvs[_h53].push(v);
          }
        }
        var s = t.morphTargets;
        for (var _h54 = 0, _f63 = s.length; _h54 < _f63; _h54++) {
          var _p40 = {};
          if (_p40.name = s[_h54].name, s[_h54].vertices !== void 0) {
            _p40.vertices = [];
            for (var _m34 = 0, _g26 = s[_h54].vertices.length; _m34 < _g26; _m34++) _p40.vertices.push(s[_h54].vertices[_m34].clone());
          }
          if (s[_h54].normals !== void 0) {
            _p40.normals = [];
            for (var _m35 = 0, _g27 = s[_h54].normals.length; _m35 < _g27; _m35++) _p40.normals.push(s[_h54].normals[_m35].clone());
          }
          this.morphTargets.push(_p40);
        }
        var o = t.morphNormals;
        for (var _h55 = 0, _f64 = o.length; _h55 < _f64; _h55++) {
          var _p41 = {};
          if (o[_h55].vertexNormals !== void 0) {
            _p41.vertexNormals = [];
            for (var _m36 = 0, _g28 = o[_h55].vertexNormals.length; _m36 < _g28; _m36++) {
              var _y30 = o[_h55].vertexNormals[_m36],
                _v26 = {};
              _v26.a = _y30.a.clone(), _v26.b = _y30.b.clone(), _v26.c = _y30.c.clone(), _p41.vertexNormals.push(_v26);
            }
          }
          if (o[_h55].faceNormals !== void 0) {
            _p41.faceNormals = [];
            for (var _m37 = 0, _g29 = o[_h55].faceNormals.length; _m37 < _g29; _m37++) _p41.faceNormals.push(o[_h55].faceNormals[_m37].clone());
          }
          this.morphNormals.push(_p41);
        }
        var a = t.skinWeights;
        for (var _h56 = 0, _f65 = a.length; _h56 < _f65; _h56++) this.skinWeights.push(a[_h56].clone());
        var l = t.skinIndices;
        for (var _h57 = 0, _f66 = l.length; _h57 < _f66; _h57++) this.skinIndices.push(l[_h57].clone());
        var u = t.lineDistances;
        for (var _h58 = 0, _f67 = u.length; _h58 < _f67; _h58++) this.lineDistances.push(u[_h58]);
        var c = t.boundingBox;
        c !== null && (this.boundingBox = c.clone());
        var d = t.boundingSphere;
        return d !== null && (this.boundingSphere = d.clone()), this.elementsNeedUpdate = t.elementsNeedUpdate, this.verticesNeedUpdate = t.verticesNeedUpdate, this.uvsNeedUpdate = t.uvsNeedUpdate, this.normalsNeedUpdate = t.normalsNeedUpdate, this.colorsNeedUpdate = t.colorsNeedUpdate, this.lineDistancesNeedUpdate = t.lineDistancesNeedUpdate, this.groupsNeedUpdate = t.groupsNeedUpdate, this;
      }
    }, {
      key: "toBufferGeometry",
      value: function toBufferGeometry() {
        var t = new cA().fromGeometry(this),
          e = new we(),
          r = new Float32Array(t.vertices.length * 3);
        if (e.setAttribute("position", w0.call(new Ge(r, 3), t.vertices)), t.normals.length > 0) {
          var i = new Float32Array(t.normals.length * 3);
          e.setAttribute("normal", w0.call(new Ge(i, 3), t.normals));
        }
        if (t.colors.length > 0) {
          var _i54 = new Float32Array(t.colors.length * 3);
          e.setAttribute("color", $O.call(new Ge(_i54, 3), t.colors));
        }
        if (t.uvs.length > 0) {
          var _i55 = new Float32Array(t.uvs.length * 2);
          e.setAttribute("uv", eI.call(new Ge(_i55, 2), t.uvs));
        }
        if (t.uvs2.length > 0) {
          var _i56 = new Float32Array(t.uvs2.length * 2);
          e.setAttribute("uv2", eI.call(new Ge(_i56, 2), t.uvs2));
        }
        e.groups = t.groups;
        for (var _i57 in t.morphTargets) {
          var s = [],
            o = t.morphTargets[_i57];
          for (var a = 0, l = o.length; a < l; a++) {
            var u = o[a],
              c = new be(u.data.length * 3, 3);
            c.name = u.name, s.push(w0.call(c, u.data));
          }
          e.morphAttributes[_i57] = s;
        }
        if (t.skinIndices.length > 0) {
          var _i58 = new be(t.skinIndices.length * 4, 4);
          e.setAttribute("skinIndex", tI.call(_i58, t.skinIndices));
        }
        if (t.skinWeights.length > 0) {
          var _i59 = new be(t.skinWeights.length * 4, 4);
          e.setAttribute("skinWeight", tI.call(_i59, t.skinWeights));
        }
        return t.boundingSphere !== null && (e.boundingSphere = t.boundingSphere.clone()), t.boundingBox !== null && (e.boundingBox = t.boundingBox.clone()), e;
      }
    }, {
      key: "computeTangents",
      value: function computeTangents() {
        console.error("THREE.Geometry: .computeTangents() has been removed.");
      }
    }, {
      key: "computeLineDistances",
      value: function computeLineDistances() {
        console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.");
      }
    }, {
      key: "applyMatrix",
      value: function applyMatrix(t) {
        return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."), this.applyMatrix4(t);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.dispatchEvent({
          type: "dispose"
        });
      }
    }], [{
      key: "createBufferGeometryFromObject",
      value: function createBufferGeometryFromObject(t) {
        var e = new we(),
          r = t.geometry;
        if (t.isPoints || t.isLine) {
          var i = new be(r.vertices.length * 3, 3),
            s = new be(r.colors.length * 3, 3);
          if (e.setAttribute("position", w0.call(i, r.vertices)), e.setAttribute("color", $O.call(s, r.colors)), r.lineDistances && r.lineDistances.length === r.vertices.length) {
            var o = new be(r.lineDistances.length, 1);
            e.setAttribute("lineDistance", oY.call(o, r.lineDistances));
          }
          r.boundingSphere !== null && (e.boundingSphere = r.boundingSphere.clone()), r.boundingBox !== null && (e.boundingBox = r.boundingBox.clone());
        } else t.isMesh && (e = r.toBufferGeometry());
        return e;
      }
    }]);
    return Il;
  }(ir);
Il.prototype.isGeometry = !0;
var cA = /*#__PURE__*/function () {
    function cA() {
      _classCallCheck(this, cA);
      this.vertices = [], this.normals = [], this.colors = [], this.uvs = [], this.uvs2 = [], this.groups = [], this.morphTargets = {}, this.skinWeights = [], this.skinIndices = [], this.boundingBox = null, this.boundingSphere = null, this.verticesNeedUpdate = !1, this.normalsNeedUpdate = !1, this.colorsNeedUpdate = !1, this.uvsNeedUpdate = !1, this.groupsNeedUpdate = !1;
    }
    _createClass(cA, [{
      key: "computeGroups",
      value: function computeGroups(t) {
        var e = [],
          r,
          i,
          s,
          o = t.faces;
        for (i = 0; i < o.length; i++) {
          var a = o[i];
          a.materialIndex !== s && (s = a.materialIndex, r !== void 0 && (r.count = i * 3 - r.start, e.push(r)), r = {
            start: i * 3,
            materialIndex: s
          });
        }
        r !== void 0 && (r.count = i * 3 - r.start, e.push(r)), this.groups = e;
      }
    }, {
      key: "fromGeometry",
      value: function fromGeometry(t) {
        var e = t.faces,
          r = t.vertices,
          i = t.faceVertexUvs,
          s = i[0] && i[0].length > 0,
          o = i[1] && i[1].length > 0,
          a = t.morphTargets,
          l = a.length,
          u;
        if (l > 0) {
          u = [];
          for (var y = 0; y < l; y++) u[y] = {
            name: a[y].name,
            data: []
          };
          this.morphTargets.position = u;
        }
        var c = t.morphNormals,
          d = c.length,
          h;
        if (d > 0) {
          h = [];
          for (var _y31 = 0; _y31 < d; _y31++) h[_y31] = {
            name: c[_y31].name,
            data: []
          };
          this.morphTargets.normal = h;
        }
        var f = t.skinIndices,
          p = t.skinWeights,
          m = f.length === r.length,
          g = p.length === r.length;
        r.length > 0 && e.length === 0 && console.error("THREE.DirectGeometry: Faceless geometries are not supported.");
        for (var _y32 = 0; _y32 < e.length; _y32++) {
          var v = e[_y32];
          this.vertices.push(r[v.a], r[v.b], r[v.c]);
          var x = v.vertexNormals;
          if (x.length === 3) this.normals.push(x[0], x[1], x[2]);else {
            var w = v.normal;
            this.normals.push(w, w, w);
          }
          var S = v.vertexColors;
          if (S.length === 3) this.colors.push(S[0], S[1], S[2]);else {
            var _w26 = v.color;
            this.colors.push(_w26, _w26, _w26);
          }
          if (s === !0) {
            var _w27 = i[0][_y32];
            _w27 !== void 0 ? this.uvs.push(_w27[0], _w27[1], _w27[2]) : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ", _y32), this.uvs.push(new N(), new N(), new N()));
          }
          if (o === !0) {
            var _w28 = i[1][_y32];
            _w28 !== void 0 ? this.uvs2.push(_w28[0], _w28[1], _w28[2]) : (console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ", _y32), this.uvs2.push(new N(), new N(), new N()));
          }
          for (var _w29 = 0; _w29 < l; _w29++) {
            var A = a[_w29].vertices;
            u[_w29].data.push(A[v.a], A[v.b], A[v.c]);
          }
          for (var _w30 = 0; _w30 < d; _w30++) {
            var _A22 = c[_w30].vertexNormals[_y32];
            h[_w30].data.push(_A22.a, _A22.b, _A22.c);
          }
          m && this.skinIndices.push(f[v.a], f[v.b], f[v.c]), g && this.skinWeights.push(p[v.a], p[v.b], p[v.c]);
        }
        return this.computeGroups(t), this.verticesNeedUpdate = t.verticesNeedUpdate, this.normalsNeedUpdate = t.normalsNeedUpdate, this.colorsNeedUpdate = t.colorsNeedUpdate, this.uvsNeedUpdate = t.uvsNeedUpdate, this.groupsNeedUpdate = t.groupsNeedUpdate, t.boundingSphere !== null && (this.boundingSphere = t.boundingSphere.clone()), t.boundingBox !== null && (this.boundingBox = t.boundingBox.clone()), this;
      }
    }]);
    return cA;
  }(),
  Ah = /*#__PURE__*/function () {
    function Ah(t, e, r, i, s) {
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
      _classCallCheck(this, Ah);
      this.a = t, this.b = e, this.c = r, this.normal = i && i.isVector3 ? i : new _(), this.vertexNormals = Array.isArray(i) ? i : [], this.color = s && s.isColor ? s : new Le(), this.vertexColors = Array.isArray(s) ? s : [], this.materialIndex = o;
    }
    _createClass(Ah, [{
      key: "clone",
      value: function clone() {
        return new this.constructor().copy(this);
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.a = t.a, this.b = t.b, this.c = t.c, this.normal.copy(t.normal), this.color.copy(t.color), this.materialIndex = t.materialIndex;
        for (var e = 0, r = t.vertexNormals.length; e < r; e++) this.vertexNormals[e] = t.vertexNormals[e].clone();
        for (var _e48 = 0, _r27 = t.vertexColors.length; _e48 < _r27; _e48++) this.vertexColors[_e48] = t.vertexColors[_e48].clone();
        return this;
      }
    }]);
    return Ah;
  }();
function oY(n) {
  return this.array.set(n), this;
}
function $O(n) {
  var t = this.array,
    e = 0;
  for (var r = 0, i = n.length; r < i; r++) {
    var s = n[r];
    s === void 0 && (console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined", r), s = new Le()), t[e++] = s.r, t[e++] = s.g, t[e++] = s.b;
  }
  return this;
}
function eI(n) {
  var t = this.array,
    e = 0;
  for (var r = 0, i = n.length; r < i; r++) {
    var s = n[r];
    s === void 0 && (console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined", r), s = new N()), t[e++] = s.x, t[e++] = s.y;
  }
  return this;
}
function w0(n) {
  var t = this.array,
    e = 0;
  for (var r = 0, i = n.length; r < i; r++) {
    var s = n[r];
    s === void 0 && (console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined", r), s = new _()), t[e++] = s.x, t[e++] = s.y, t[e++] = s.z;
  }
  return this;
}
function tI(n) {
  var t = this.array,
    e = 0;
  for (var r = 0, i = n.length; r < i; r++) {
    var s = n[r];
    s === void 0 && (console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined", r), s = new He()), t[e++] = s.x, t[e++] = s.y, t[e++] = s.z, t[e++] = s.w;
  }
  return this;
}
var aY = ["a", "b", "c"];
function lY(n, t) {
  switch (t) {
    case "c":
      return n.c;
    case "b":
      return n.b;
    case "a":
    default:
      return n.a;
  }
}
function uA(n, t, e) {
  var r = Math.min(n, t),
    i = Math.max(n, t),
    s = r + "_" + i;
  return e.get(s);
}
function dA(n, t, e, r, i, s) {
  var o = Math.min(n, t),
    a = Math.max(n, t),
    l = o + "_" + a,
    u;
  if (r.has(l)) u = r.get(l);else {
    var c = e[o],
      d = e[a];
    u = {
      a: c,
      b: d,
      newEdge: null,
      faces: []
    }, r.set(l, u);
  }
  u.faces.push(i), s[n].edges.push(u), s[t].edges.push(u);
}
function cY(n, t, e, r) {
  var i, s, o;
  for (i = 0, s = n.length; i < s; i++) e[i] = {
    edges: []
  };
  for (i = 0, s = t.length; i < s; i++) o = t[i], dA(o.a, o.b, n, r, o, e), dA(o.b, o.c, n, r, o, e), dA(o.c, o.a, n, r, o, e);
}
function A0(n, t, e, r, i) {
  n.push(new Ah(t, e, r, void 0, void 0, i));
}
function _h(n, t) {
  return Math.abs(t - n) / 2 + Math.min(n, t);
}
function _0(n, t, e, r) {
  n.push([t.clone(), e.clone(), r.clone()]);
}
var E0 = /*#__PURE__*/function () {
  function E0() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    _classCallCheck(this, E0);
    this.subdivisions = t;
  }
  _createClass(E0, [{
    key: "modify",
    value: function modify(t) {
      t instanceof we ? t = new Il().fromBufferGeometry(t) : t = t.clone(), t.mergeVertices();
      var e = this.subdivisions;
      for (; e-- > 0;) this._smooth(t);
      return t.computeFaceNormals(), t.computeVertexNormals(), t;
    }
  }, {
    key: "_smooth",
    value: function _smooth(t) {
      var e = new _(),
        r,
        i,
        s,
        o,
        a,
        l = t.vertices,
        u = t.faces,
        c = t.faceVertexUvs[0],
        d = c !== void 0 && c.length > 0,
        h = [],
        f = new Map();
      cY(l, u, h, f);
      var p = [],
        m,
        g,
        y,
        v,
        x,
        S,
        w;
      for (var _i60 = 0, _Array$from = Array.from(f.keys()); _i60 < _Array$from.length; _i60++) {
        var Z = _Array$from[_i60];
        for (g = f.get(Z), y = new _(), x = 3 / 8, S = 1 / 8, w = g.faces.length, w != 2 && (x = .5, S = 0, w != 1), y.addVectors(g.a, g.b).multiplyScalar(x), e.set(0, 0, 0), o = 0; o < w; o++) {
          for (v = g.faces[o], a = 0; a < 3 && (m = l[lY(v, aY[a])], !(m !== g.a && m !== g.b)); a++);
          m && e.add(m);
        }
        e.multiplyScalar(S), y.add(e), g.newEdge = p.length, p.push(y);
      }
      var A,
        E,
        b,
        T,
        M,
        C,
        P,
        D = [];
      for (i = 0, s = l.length; i < s; i++) {
        for (C = l[i], M = h[i].edges, r = M.length, r == 3 ? A = 3 / 16 : r > 3 && (A = 3 / (8 * r)), E = 1 - r * Number(A), b = A, r <= 2 && (r == 2 ? (E = 3 / 4, b = 1 / 8) : r == 1 || r == 0), P = C.clone().multiplyScalar(E), e.set(0, 0, 0), o = 0; o < r; o++) T = M[o], m = T.a !== C ? T.a : T.b, e.add(m);
        e.multiplyScalar(Number(b)), P.add(e), D.push(P);
      }
      var O = D.concat(p),
        I = D.length,
        z,
        B,
        V,
        U = [],
        j = [],
        W,
        k,
        H,
        X,
        q = new N(),
        G = new N(),
        J = new N();
      for (i = 0, s = u.length; i < s; i++) v = u[i], z = Number(uA(v.a, v.b, f).newEdge) + I, B = Number(uA(v.b, v.c, f).newEdge) + I, V = Number(uA(v.c, v.a, f).newEdge) + I, A0(U, z, B, V, v.materialIndex), A0(U, v.a, z, V, v.materialIndex), A0(U, v.b, B, z, v.materialIndex), A0(U, v.c, V, B, v.materialIndex), d && (W = c[i], k = W[0], H = W[1], X = W[2], q.set(_h(k.x, H.x), _h(k.y, H.y)), G.set(_h(H.x, X.x), _h(H.y, X.y)), J.set(_h(k.x, X.x), _h(k.y, X.y)), _0(j, q, G, J), _0(j, k, q, J), _0(j, H, G, q), _0(j, X, J, G));
      t.vertices = O, t.faces = U, d && (t.faceVertexUvs[0] = j);
    }
  }]);
  return E0;
}();
var Ai = new _(),
  rI = /*#__PURE__*/function () {
    function rI() {
      _classCallCheck(this, rI);
    }
    _createClass(rI, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _ref26, _n$geometry;
        var e = (_ref26 = (_n$geometry = n.geometry) !== null && _n$geometry !== void 0 ? _n$geometry : t === null || t === void 0 ? void 0 : t.geometry) !== null && _ref26 !== void 0 ? _ref26 : new we().copy(new li(100, 100, 100)),
          r;
        t === void 0 ? (e.computeBoundingBox(), e.boundingBox.getSize(Ai), r = {
          width: Ai.x,
          height: Ai.y,
          depth: Ai.z,
          subdivisions: 0
        }) : r = t.parameters;
        var i = _objectSpread(_objectSpread({}, r), n.parameters);
        return {
          parameters: {
            width: Math.abs(i.width),
            height: Math.abs(i.height),
            depth: Math.abs(i.depth),
            subdivisions: Math.abs(i.subdivisions)
          },
          geometry: e
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$geometry2;
        var _n$parameters13 = n.parameters,
          t = _n$parameters13.width,
          e = _n$parameters13.height,
          r = _n$parameters13.depth,
          i = _n$parameters13.subdivisions,
          s = (_n$geometry2 = n.geometry) !== null && _n$geometry2 !== void 0 ? _n$geometry2 : new we().copy(new li(100, 100, 100)),
          o = s.userData.parameters;
        o === void 0 ? (s.computeBoundingBox(), s.boundingBox.getSize(Ai)) : Ai.set(o.width, o.height, o.depth), (t !== Ai.x || e !== Ai.y || r !== Ai.z) && s.scale(Ai.x === 0 ? 1 : t / Ai.x, Ai.y === 0 ? 1 : e / Ai.y, Ai.z === 0 ? 1 : r / Ai.z);
        var a = s.originalGeometry;
        try {
          i > 0 ? (a === void 0 || (o === null || o === void 0 ? void 0 : o.subdivisions) !== i) && (a === void 0 && (a = s), s = new E0(i).modify(a).toBufferGeometry()) : (a !== void 0 && (s = a), a = void 0, s.getAttribute("normal") === void 0 && s.computeVertexNormals());
        } catch (_unused20) {
          a !== void 0 && (s = a), a = void 0, s.getAttribute("normal") === void 0 && s.computeVertexNormals();
        }
        return a !== void 0 && Object.assign(s, {
          originalGeometry: a
        }), delete n.geometry, Object.assign(s, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "NonParametricGeometry"
          })
        });
      }
    }, {
      key: "loadFromUrl",
      value: function loadFromUrl(n, t, e) {
        var _this120 = this;
        new qu(e).load(n, function (i) {
          var s = _this120.normalizeInputs({
            geometry: i
          });
          i.boundingBox.getSize(Ai);
          var o = 100 / Ai.x;
          Object.assign(s.parameters, {
            width: 100,
            height: Ai.y * o,
            depth: Ai.z * o
          }), t(_this120.build(s));
        });
      }
    }]);
    return rI;
  }();
var T0 = /*#__PURE__*/function () {
  function T0() {
    _classCallCheck(this, T0);
  }
  _createClass(T0, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters10, _e$height10, _e$depth10;
      var e = Object.assign({}, (_t$parameters10 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters10 !== void 0 ? _t$parameters10 : {
        width: 100,
        depth: 0,
        spikes: 5,
        cornerRadius: 0,
        extrudeBevelSize: 0,
        extrudeBevelSegments: 3
      }, n.parameters);
      return {
        shape: n.shape && n.shape instanceof kt ? n.shape : new kt(),
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height10 = e.height) !== null && _e$height10 !== void 0 ? _e$height10 : e.width),
          depth: Math.abs((_e$depth10 = e.depth) !== null && _e$depth10 !== void 0 ? _e$depth10 : 0)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters14 = n.parameters,
        t = _n$parameters14.width,
        e = _n$parameters14.height,
        r = _n$parameters14.spikes,
        i = _n$parameters14.cornerRadius,
        s = _n$parameters14.depth,
        o = _n$parameters14.extrudeBevelSize,
        a = _n$parameters14.extrudeBevelSegments,
        l = n.shape,
        u = t * .5,
        c = e * .5,
        d = 0,
        h = 0,
        f = 2 * Math.PI / r;
      for (var m = 0; m < r; m++) {
        var g = f * m,
          y = d + Math.sin(g) * u,
          v = h + Math.cos(g) * c;
        l.addPoint(l.createPoint(y, v));
      }
      l.isClosed = !0;
      for (var _m38 = 0, _g30 = l.points.length; _m38 < _g30; _m38++) l.points[_m38].roundness = i;
      l.roundness = i, l.update();
      var p = Dn.create({
        shape: l,
        parameters: {
          roundness: i,
          depth: s,
          extrudeBevelSize: o,
          extrudeBevelSegments: a
        }
      });
      return Object.assign(p, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "PolygonGeometry"
        })
      });
    }
  }]);
  return T0;
}();
var iI = /*#__PURE__*/function () {
  function iI() {
    _classCallCheck(this, iI);
  }
  _createClass(iI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters11, _e$height11, _e$depth11;
      var e = Object.assign({}, (_t$parameters11 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters11 !== void 0 ? _t$parameters11 : {
        width: 100,
        radialSegments: 4,
        heightSegments: 1,
        cornerRadius: 0,
        cornerSegments: 8,
        openEnded: !1
      }, n.parameters);
      return {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height11 = e.height) !== null && _e$height11 !== void 0 ? _e$height11 : e.width),
          depth: Math.abs((_e$depth11 = e.depth) !== null && _e$depth11 !== void 0 ? _e$depth11 : e.width)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters15 = n.parameters,
        t = _n$parameters15.width,
        e = _n$parameters15.height,
        r = _n$parameters15.depth,
        i = _n$parameters15.radialSegments,
        s = _n$parameters15.heightSegments,
        o = _n$parameters15.openEnded,
        a = _n$parameters15.cornerRadius,
        l = _n$parameters15.cornerSegments,
        u = new fA(t * .5, e, i, s, o, a, l);
      return u.scale(1, 1, r / t), Object.assign(u, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "PyramidGeometry"
        })
      });
    }
  }]);
  return iI;
}();
function hm(n, t, e) {
  e.x = n.x * t.x, e.y = n.y, e.z = n.x * t.y;
}
function hA(n, t, e, r, i, s) {
  var o = t.clone().sub(n),
    a = e.clone().sub(n),
    l = o.angleTo(a);
  if (o.normalize(), a.normalize(), r === i) {
    var u = o.add(a).normalize();
    s.copy(n).addScaledVector(u, r / Math.sin(l / 2));
  } else {
    var _u30 = o.angleTo(a);
    s.copy(n), s.addScaledVector(o, i / Math.sin(_u30)), s.addScaledVector(a, r / Math.sin(_u30));
  }
}
function uY(n, t, e) {
  var r = n.clone().sub(t),
    i = e.clone().sub(t);
  return r.projectOnVector(i), r.add(t);
}
var fA = /*#__PURE__*/function (_we16) {
  _inherits(fA, _we16);
  var _super130 = _createSuper(fA);
  function fA() {
    var _this121;
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : .5;
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
    var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 4;
    var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
    var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
    var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
    var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 4;
    _classCallCheck(this, fA);
    _this121 = _super130.call(this), r = Math.floor(Math.max(3, r)), i = Math.floor(i), a = Math.floor(a);
    var l = [],
      u = [],
      c = [],
      d = [],
      h = 0,
      f = e / 2,
      p = Math.PI / r,
      m = t * Math.cos(Math.PI / r),
      g = 2 * Math.PI / r,
      y = (r - 2) * Math.PI / r,
      v = Math.PI - y,
      x = new _(0, -f, 0),
      S = new _(0, f, 0),
      w = new N(t, -f),
      A = new N(m, -f),
      E = new N(0, S.y).sub(A),
      b = new N(0, S.y).sub(w),
      T = new N(E.y, -E.x).normalize(),
      M = new N(b.y, -b.x).normalize(),
      P = t * Math.cos(Math.PI / r) * Math.tan((Math.PI - E.angle()) / 2) - 1e-8;
    o = Math.min(o, P);
    var D;
    {
      var j = new _(T.x, T.y, 0),
        W = new _(Math.cos(g) * j.x, j.y, Math.sin(g) * j.x);
      D = j.angleTo(W);
    }
    var O = o / Math.tan((Math.PI - E.angle()) / 2),
      I = o / Math.tan((Math.PI - D) / 2),
      z = new _();
    if (!s) {
      u.push(x.x, x.y, x.z), c.push(0, -1, 0), d.push(0, 0);
      var _j9 = h++,
        _W6 = [],
        k = w.clone(),
        H = O / Math.cos(Math.PI / r);
      k.x -= H;
      for (var X = 0; X < r; X++) {
        var q = X / r * Math.PI * 2 + p,
          _G17 = new N(Math.sin(q), Math.cos(q));
        hm(k, _G17, z), u.push(z.x, z.y, z.z), c.push(0, -1, 0), d.push(0, 0), _W6.push(h++);
      }
      for (var _X11 = 0; _X11 < _W6.length; _X11++) l.push(_W6[_X11], _j9, _W6[(_X11 + 1) % _W6.length]);
    }
    var B = [];
    {
      var _j10 = new _(),
        _W7 = new _(),
        _k7 = new _(),
        _H9 = new _(),
        _X12 = new _(),
        _q12 = new _();
      for (var _G18 = 0; _G18 < r; _G18++) {
        var _J17 = _G18 / r * Math.PI * 2 + p,
          Z = (_G18 + .5) / r * Math.PI * 2 + p,
          K = (_G18 + 1) / r * Math.PI * 2 + p,
          Y = new N(Math.sin(_J17), Math.cos(_J17)),
          ye = new N(Math.sin(Z), Math.cos(Z)),
          fe = new N(Math.sin(K), Math.cos(K));
        hm(w, Y, _W7), hm(w, fe, _k7), hm(T, ye, _j10), hA(S, _W7, _k7, I, I, _H9), u.push(_H9.x, _H9.y, _H9.z), hA(_W7, S, _k7, I, O, _X12), u.push(_X12.x, _X12.y, _X12.z), hA(_k7, _W7, S, O, I, _q12), u.push(_q12.x, _q12.y, _q12.z), c.push(_j10.x, _j10.y, _j10.z), c.push(_j10.x, _j10.y, _j10.z), c.push(_j10.x, _j10.y, _j10.z), d.push(0, 0), d.push(0, 0), d.push(0, 0);
        var oe = h++,
          _e = h++,
          xe = h++;
        if (l.push(oe, _e, xe), o > 0) {
          {
            var Pe = _W7.clone().add(_k7).multiplyScalar(.5),
              Te = S.clone().sub(Pe).normalize(),
              Ue = x.clone().sub(Pe).normalize().add(Te).normalize().multiplyScalar(-1),
              L = _q12.clone().sub(_X12);
            V(Pe, L, Ue, E.angle());
          }
          var Ie = void 0,
            Oe = void 0;
          {
            var _Pe7 = new _();
            hm(M, fe, _Pe7);
            var _Te4 = _q12.clone().add(_H9).multiplyScalar(.5);
            _Te4 = uY(_Te4, _k7, S);
            var Ve = _q12.clone().sub(_H9);
            var _V8 = V(_Te4, Ve, _Pe7, D, _H9.y);
            var _V9 = _slicedToArray(_V8, 2);
            Ie = _V9[0];
            Oe = _V9[1];
          }
          {
            var _Pe8 = Ie,
              _Te5 = _Pe8.clone().setY(0).normalize(),
              _Ve4 = new _(0, -1, 0),
              _Ue4 = _Te5.clone().cross(_Ve4);
            U(_Pe8, _Te5, _Ve4, _Ue4);
          }
          B.concat(Oe);
          {
            var _Pe9 = E.angle(),
              _Te6 = Math.PI - _Pe9,
              _Ve5 = S.clone();
            _Ve5.y -= o / Math.sin(_Pe9 - Math.PI / 2);
            var _Ue5 = new _(),
              _L4 = [];
            for (var ie = 0; ie < a; ie++) {
              var ue = [],
                me = Math.PI / 2 - _Te6 * ie / a,
                De = Math.cos(me),
                Me = Math.sin(me),
                Ee = Z;
              for (var le = 0; le <= ie; le++) {
                var Je = Math.cos(Ee),
                  ke = Math.sin(Ee);
                _j10.x = De * ke, _j10.y = Me, _j10.z = De * Je, _Ue5.copy(_Ve5).addScaledVector(_j10, o), u.push(_Ue5.x, _Ue5.y, _Ue5.z), c.push(_j10.x, _j10.y, _j10.z), d.push(0, 0), ue.push(h++), Ee += Math.PI * 2 / ie / r;
              }
              _L4.push(ue);
            }
            Oe.reverse(), _L4.push(Oe);
            var R = _L4.length - 1;
            for (var _ie3 = 0; _ie3 < R; _ie3++) {
              var _ue5 = _L4[_ie3],
                _me5 = _L4[_ie3 + 1],
                _De4 = _ue5.length - 1;
              l.push(_me5[1], _ue5[0], _me5[0]);
              for (var _Me7 = 1; _Me7 <= _De4; _Me7++) l.push(_ue5[_Me7], _ue5[_Me7 - 1], _me5[_Me7]), l.push(_me5[_Me7 + 1], _ue5[_Me7], _me5[_Me7]);
            }
          }
        }
      }
    }
    _this121.setIndex(l), _this121.setAttribute("position", new be(u, 3)), _this121.setAttribute("normal", new be(c, 3)), _this121.setAttribute("uv", new be(d, 2));
    function V(j, W, k, H, X) {
      var q = -H / 2,
        G = (Math.PI - H) / 2,
        J = W.clone().normalize().cross(k);
      j.addScaledVector(k, -o / Math.sin(G));
      var Z = new _(),
        K = new _(),
        Y = 1,
        ye = h,
        fe = [];
      for (var _oe7 = 0; _oe7 <= a; _oe7++) {
        var _e49 = q + _oe7 / a * H;
        K.set(0, 0, 0), K.addScaledVector(J, Math.sin(_e49)), K.addScaledVector(k, Math.cos(_e49));
        for (var _xe7 = 0; _xe7 <= Y; _xe7++) {
          var _Ie7 = _xe7 / Y - .5;
          if (Z.copy(j), Z.addScaledVector(W, _Ie7), Z.addScaledVector(K, o), X != null) {
            var _Oe7 = Math.max(0, Z.y - X);
            Z.addScaledVector(W, -_Oe7 / W.y);
          }
          u.push(Z.x, Z.y, Z.z), c.push(K.x, K.y, K.z), d.push(0, 0), _xe7 === 0 && fe.push(h), h++;
        }
      }
      for (var _oe8 = 0; _oe8 < a; _oe8++) for (var _e50 = 0; _e50 < Y; _e50++) {
        var _xe8 = ye + _e50 + (Y + 1) * _oe8,
          _Ie8 = _xe8 + (Y + 1),
          _Oe8 = _Ie8 + 1,
          _Pe10 = _xe8 + 1;
        l.push(_xe8, _Ie8, _Pe10), l.push(_Ie8, _Oe8, _Pe10);
      }
      return [j.clone().addScaledVector(W, .5), fe];
    }
    function U(j, W, k, H) {
      var X = Math.PI / 2,
        q = b.angle() - X,
        G = [],
        J = new _(),
        Z = new _();
      for (var _Y14 = 0; _Y14 <= a; _Y14++) {
        var _ye5 = [],
          _fe5 = _Y14 / a;
        for (var _oe9 = 0; _oe9 <= _Y14; _oe9++) {
          var _xe9 = ((_Y14 ? _oe9 / _Y14 : 0) - .5) * v,
            _Ie9 = Math.cos(_xe9),
            _Oe9 = Math.sin(_xe9),
            _Pe11 = Math.atan(Math.tan(q) * _Ie9),
            _Te7 = (X + _Pe11) * _fe5,
            _Ve6 = Math.cos(_Te7),
            _Ue6 = Math.sin(_Te7);
          J.set(0, 0, 0), J.addScaledVector(W, _Ue6 * _Ie9), J.addScaledVector(k, _Ve6), J.addScaledVector(H, _Ue6 * _Oe9), Z.copy(j).addScaledVector(J, o), u.push(Z.x, Z.y, Z.z), c.push(J.x, J.y, J.z), d.push(0, 0), _ye5.push(h++);
        }
        G.push(_ye5);
      }
      var K = G.length - 1;
      for (var _Y15 = 0; _Y15 < K; _Y15++) {
        var _ye6 = G[_Y15],
          _fe6 = G[_Y15 + 1],
          _oe10 = _ye6.length - 1;
        l.push(_ye6[0], _fe6[1], _fe6[0]);
        for (var _e51 = 1; _e51 <= _oe10; _e51++) l.push(_ye6[_e51 - 1], _ye6[_e51], _fe6[_e51]), l.push(_ye6[_e51], _fe6[_e51 + 1], _fe6[_e51]);
      }
    }
    return _this121;
  }
  return _createClass(fA);
}(we);
var Eh = /*#__PURE__*/function () {
  function Eh() {
    _classCallCheck(this, Eh);
  }
  _createClass(Eh, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters12, _t$ui, _e$height12, _e$depth12;
      var e = Object.assign({}, (_t$parameters12 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters12 !== void 0 ? _t$parameters12 : {
          width: 100,
          depth: 0,
          cornerRadius: [0, 0, 0, 0],
          cornerType: 1,
          extrudeBevelSize: 0,
          extrudeBevelSegments: 1
        }, n.parameters),
        r = Object.assign((_t$ui = t === null || t === void 0 ? void 0 : t.ui) !== null && _t$ui !== void 0 ? _t$ui : {
          enabledIndieCorners: !1
        }, n.ui);
      return {
        shape: n.shape && n.shape instanceof kt ? n.shape : new kt(),
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height12 = e.height) !== null && _e$height12 !== void 0 ? _e$height12 : e.width),
          depth: Math.abs((_e$depth12 = e.depth) !== null && _e$depth12 !== void 0 ? _e$depth12 : 0)
        }),
        ui: r
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var t = n.shape,
        _n$parameters16 = n.parameters,
        e = _n$parameters16.width,
        r = _n$parameters16.height,
        i = _n$parameters16.cornerRadius,
        s = _n$parameters16.cornerType,
        o = _n$parameters16.depth,
        a = _n$parameters16.extrudeBevelSize,
        l = _n$parameters16.extrudeBevelSegments,
        u = {
          x: e * .5,
          y: r * .5
        },
        c = {
          x: -u.x,
          y: -u.y
        },
        d = {
          x: u.x,
          y: u.y
        };
      function h(S, w, A) {
        return w > e && A > r ? Math.min(S * e / w, S * r / A) : w > e ? S * e / w : A > r ? S * r / A : S;
      }
      var f = [];
      f[0] = i[0] === 0 ? 0 : h(i[0], i[0] + i[3], i[0] + i[1]), f[1] = i[1] === 0 ? 0 : h(i[1], i[1] + i[2], i[1] + i[0]), f[2] = i[2] === 0 ? 0 : h(i[2], i[2] + i[1], i[2] + i[3]), f[3] = i[3] === 0 ? 0 : h(i[3], i[3] + i[0], i[3] + i[2]);
      var p = c.x,
        m = d.x,
        g = d.y,
        y = c.y;
      t.addPoint(t.createPoint(p, g)), t.addPoint(t.createPoint(m, g)), t.addPoint(t.createPoint(m, y)), t.addPoint(t.createPoint(p, y)), t.isClosed = !0;
      var v = !0;
      for (var S = 0, w = t.points.length; S < w; S++) t.points[S].roundness = f[S], S > 0 && f[S] !== f[S - 1] && (v = !1);
      v && (t.roundness = f[0]), t.useCubicForRoundedCorners = s !== 1, t.update();
      var x = Dn.create({
        shape: t,
        parameters: {
          depth: o,
          extrudeBevelSize: a,
          extrudeBevelSegments: l
        }
      });
      return Object.assign(x, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "RectangleGeometry"
        })
      });
    }
  }]);
  return Eh;
}();
var nI = /*#__PURE__*/function () {
  function nI() {
    _classCallCheck(this, nI);
  }
  _createClass(nI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters13, _e$height13, _e$depth13;
      var e = Object.assign({}, (_t$parameters13 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters13 !== void 0 ? _t$parameters13 : {
        width: 100,
        widthSegments: 64,
        heightSegments: 64,
        phiStart: 0,
        phiLength: 2 * Math.PI,
        thetaStart: 0,
        thetaLength: 180
      }, n.parameters);
      return e.thetaLength = Se.clamp(e.thetaLength, 0, 180), {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height13 = e.height) !== null && _e$height13 !== void 0 ? _e$height13 : e.width),
          depth: Math.abs((_e$depth13 = e.depth) !== null && _e$depth13 !== void 0 ? _e$depth13 : e.width)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters17 = n.parameters,
        _n$parameters17$width = _n$parameters17.width,
        t = _n$parameters17$width === void 0 ? 100 : _n$parameters17$width,
        _n$parameters17$heigh = _n$parameters17.height,
        e = _n$parameters17$heigh === void 0 ? t : _n$parameters17$heigh,
        _n$parameters17$depth = _n$parameters17.depth,
        r = _n$parameters17$depth === void 0 ? t : _n$parameters17$depth,
        _n$parameters17$width2 = _n$parameters17.widthSegments,
        i = _n$parameters17$width2 === void 0 ? 64 : _n$parameters17$width2,
        _n$parameters17$heigh2 = _n$parameters17.heightSegments,
        s = _n$parameters17$heigh2 === void 0 ? 64 : _n$parameters17$heigh2,
        o = _n$parameters17.phiStart,
        a = _n$parameters17.phiLength,
        l = _n$parameters17.thetaStart,
        u = _n$parameters17.thetaLength,
        c;
      return u === 0 ? (c = new we(), c.setAttribute("position", new be([], 3))) : c = new Bs(.5 * t, i, s, o, a, l, u * Se.DEG2RAD), c.scale(1, e / t, r / t), Object.assign(c, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "SphereGeometry"
        })
      });
    }
  }]);
  return nI;
}();
var sI = /*#__PURE__*/function () {
  function sI() {
    _classCallCheck(this, sI);
  }
  _createClass(sI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters14, _e$height14;
      var e = Object.assign({}, (_t$parameters14 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters14 !== void 0 ? _t$parameters14 : {
        width: 100,
        depth: 0,
        widthSegments: 8,
        heightSegments: 8
      }, n.parameters);
      return {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height14 = e.height) !== null && _e$height14 !== void 0 ? _e$height14 : e.width),
          depth: 0
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters18 = n.parameters,
        _n$parameters18$width = _n$parameters18.width,
        t = _n$parameters18$width === void 0 ? 100 : _n$parameters18$width,
        _n$parameters18$heigh = _n$parameters18.height,
        e = _n$parameters18$heigh === void 0 ? t : _n$parameters18$heigh,
        _n$parameters18$width2 = _n$parameters18.widthSegments,
        r = _n$parameters18$width2 === void 0 ? 8 : _n$parameters18$width2,
        _n$parameters18$heigh2 = _n$parameters18.heightSegments,
        i = _n$parameters18$heigh2 === void 0 ? 8 : _n$parameters18$heigh2,
        s = new hn(t, e, r, i);
      return s.scale(1, 1, 1), Object.assign(s, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "PlaneGeometry"
        })
      });
    }
  }]);
  return sI;
}();
var oI = /*#__PURE__*/function () {
    function oI() {
      _classCallCheck(this, oI);
    }
    _createClass(oI, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters15, _e$height15, _e$depth14;
        var e = Object.assign({}, (_t$parameters15 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters15 !== void 0 ? _t$parameters15 : {
          width: 100,
          angle: 90,
          cornerRadius: 24,
          cornerSegments: 8
        }, n.parameters);
        return {
          parameters: Object.assign(e, {
            width: Math.abs(e.width),
            height: Math.abs((_e$height15 = e.height) !== null && _e$height15 !== void 0 ? _e$height15 : e.width),
            depth: Math.abs((_e$depth14 = e.depth) !== null && _e$depth14 !== void 0 ? _e$depth14 : e.width)
          })
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        var _n$parameters19 = n.parameters,
          t = _n$parameters19.width,
          e = _n$parameters19.height,
          r = _n$parameters19.depth,
          i = _n$parameters19.angle,
          s = _n$parameters19.cornerRadius,
          o = _n$parameters19.cornerSegments,
          a = new pA(t, e, r, i, s, o);
        return Object.assign(a, {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "BackdropGeometry"
          })
        });
      }
    }]);
    return oI;
  }(),
  pA = /*#__PURE__*/function (_we17) {
    _inherits(pA, _we17);
    var _super131 = _createSuper(pA);
    function pA() {
      var _this122;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 90;
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 10;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 24;
      _classCallCheck(this, pA);
      _this122 = _super131.call(this), _this122.type = "BackdropGeometry";
      var a = [],
        l = [],
        u = [],
        c = .001;
      s == 0 && (o = 1), o = Math.max(1, Math.floor(o)), s = Math.min(s, 100), i = Math.min(180 - c, i), i *= Math.PI / 180;
      var d = [],
        h = Math.PI / 2,
        f = function f() {
          var Z = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          var K = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          var Y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
          return new _(Z, K, Y);
        },
        p = f(),
        m = f(),
        g = e / 2,
        y = t / 2,
        v = r / 2,
        x = -y,
        S = +y,
        _ref27 = [f(x, -g, +v), f(x, -g, -v), f(x, +g, -v)],
        w = _ref27[0],
        A = _ref27[1],
        E = _ref27[2],
        b = function b(Z) {
          var K = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
          return Math.sin(Z - Math.PI / (1 + +K));
        },
        T = function T(Z) {
          var K = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
          return Math.cos(Z - Math.PI / (1 + +K));
        };
      E.y = Math.sin(i) * e - g;
      var M = Math.cos(i) * e - v,
        C = w.z - c;
      i <= h ? (E.z = Math.min(M, C), E.z == C && (E.y -= (M - C) / Math.tan(h - i))) : A.z = Math.min(A.z - M - v, w.z - c), p.subVectors(w, A), m.subVectors(E, A);
      var P = Math.min(p.length(), m.length()) * s / 100,
        D = P * Math.tan(i / 2),
        O = P / Math.cos(i / 2),
        I = p.clone().normalize().add(m.normalize()).setLength(O).add(A);
      p.set(0, b(i, !0), T(i, !0)), d.push([E, p.clone()]);
      var z = (Math.PI - i) / o;
      for (var Z = 0; Z <= o; Z++) {
        var K = h + i + Z * z;
        p.set(0, Math.sin(K) * D, Math.cos(K) * D), p.add(I), m.set(0, b(K), T(K)), d.push([p.clone(), m.clone()]);
      }
      d.push([w, f(0, 1, 0)]);
      var B = Math.sin(z / 2) * D * 2,
        V = d.length - 1,
        U = d[0][0].distanceTo(d[1][0]),
        j = d[V - 1][0].distanceTo(d[V][0]),
        W = U + B * o + j;
      d[0].push(1);
      for (var _Z9 = 0; _Z9 <= o; _Z9++) d[_Z9 + 1].push(1 - (U + _Z9 * B) / W);
      d[V].push(0);
      var _d$ = _slicedToArray(d[0], 3),
        k = _d$[0],
        H = _d$[1],
        X = _d$[2],
        q,
        G,
        J;
      for (var _Z10 = 1; _Z10 < d.length; _Z10++) {
        var _d$_Z;
        (_d$_Z = _slicedToArray(d[_Z10], 3), q = _d$_Z[0], G = _d$_Z[1], J = _d$_Z[2]), a.push(x, k.y, k.z, x, q.y, q.z, S, k.y, k.z, S, k.y, k.z, x, q.y, q.z, S, q.y, q.z), l.push(0, H.y, H.z, 0, G.y, G.z, 0, H.y, H.z, 0, H.y, H.z, 0, G.y, G.z, 0, G.y, G.z), u.push(0, X, 0, J, 1, X, 1, X, 0, J, 1, J), (k = q, H = G, X = J);
      }
      _this122.setAttribute("position", new be(a, 3)), _this122.setAttribute("normal", new be(l, 3)), _this122.setAttribute("uv", new be(u, 2));
      return _this122;
    }
    return _createClass(pA);
  }(we);
var M0 = /*#__PURE__*/function () {
  function M0() {
    _classCallCheck(this, M0);
  }
  _createClass(M0, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters16, _e$height16, _e$depth15;
      var e = Object.assign({}, (_t$parameters16 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters16 !== void 0 ? _t$parameters16 : {
        width: 100,
        depth: 0,
        innerRadiusPercent: 38.19,
        spikes: 5,
        cornerRadius: 0,
        angle: 360,
        extrudeBevelSize: 0,
        extrudeBevelSegments: 1
      }, n.parameters);
      return {
        shape: n.shape && n.shape instanceof kt ? n.shape : new kt(),
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height16 = e.height) !== null && _e$height16 !== void 0 ? _e$height16 : e.width),
          depth: Math.abs((_e$depth15 = e.depth) !== null && _e$depth15 !== void 0 ? _e$depth15 : 0)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters20 = n.parameters,
        t = _n$parameters20.width,
        e = _n$parameters20.height,
        r = _n$parameters20.innerRadiusPercent,
        i = _n$parameters20.spikes,
        s = _n$parameters20.cornerRadius,
        o = _n$parameters20.angle,
        a = _n$parameters20.depth,
        l = _n$parameters20.extrudeBevelSize,
        u = _n$parameters20.extrudeBevelSegments,
        c = n.shape,
        d = t * .5,
        h = e * .5,
        f = 0,
        p = 0,
        m = o * Math.PI / 360 / i,
        g = Math.PI / 2 * 3 * -1,
        y = d * r / 100,
        v = h * r / 100;
      if (i === 3 && r === 50) {
        m = 2 * Math.PI / i;
        for (var S = 0; S < i; S++) {
          var w = m * S,
            A = f + Math.sin(w) * d,
            E = p + Math.cos(w) * h;
          c.addPoint(c.createPoint(A, E));
        }
      } else for (var _S29 = 0; _S29 < i; _S29++) {
        var _w31 = f + Math.cos(g) * d,
          _A23 = p + Math.sin(g) * h;
        c.addPoint(c.createPoint(_w31, _A23)), g += m, _w31 = f + Math.cos(g) * y, _A23 = p + Math.sin(g) * v, _S29 <= i, c.addPoint(c.createPoint(_w31, _A23)), g += m;
      }
      c.isClosed = !0;
      for (var _S30 = 0, _w32 = c.points.length; _S30 < _w32; _S30++) c.points[_S30].roundness = s;
      c.roundness = s, c.update();
      var x = Dn.create({
        shape: c,
        parameters: {
          roundness: s,
          depth: a,
          extrudeBevelSize: l,
          extrudeBevelSegments: u
        }
      });
      return Object.assign(x, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "StarGeometry"
        })
      });
    }
  }]);
  return M0;
}();
var aI = /*#__PURE__*/function () {
  function aI() {
    _classCallCheck(this, aI);
  }
  _createClass(aI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters17, _e$height17, _e$depth16;
      var e = Object.assign({}, (_t$parameters17 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters17 !== void 0 ? _t$parameters17 : {
        width: 100,
        depth: 0
      }, n.parameters);
      return {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height17 = e.height) !== null && _e$height17 !== void 0 ? _e$height17 : e.width),
          depth: Math.abs((_e$depth16 = e.depth) !== null && _e$depth16 !== void 0 ? _e$depth16 : 0)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters21 = n.parameters,
        t = _n$parameters21.width,
        e = _n$parameters21.height,
        r = new hn(t, e);
      return Object.assign(r, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "TextFrameGeometry"
        })
      });
    }
  }]);
  return aI;
}();
var lI = /*#__PURE__*/function () {
  function lI() {
    _classCallCheck(this, lI);
  }
  _createClass(lI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters18, _e$height18, _e$depth17;
      var e = Object.assign({}, (_t$parameters18 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters18 !== void 0 ? _t$parameters18 : {
          width: 100,
          radialSegments: 32,
          tubularSegments: 64,
          arc: 360,
          cornerRadius: 30,
          cornerSegments: 8
        }, n.parameters),
        r = Math.abs(e.width),
        i = Math.abs((_e$height18 = e.height) !== null && _e$height18 !== void 0 ? _e$height18 : e.width),
        s = Math.round(Math.abs((_e$depth17 = e.depth) !== null && _e$depth17 !== void 0 ? _e$depth17 : e.width * .25));
      return {
        parameters: Object.assign(e, {
          width: r,
          height: i,
          depth: s
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters22 = n.parameters,
        t = _n$parameters22.width,
        e = _n$parameters22.height,
        r = _n$parameters22.depth,
        i = _n$parameters22.radialSegments,
        s = _n$parameters22.tubularSegments,
        o = _n$parameters22.arc,
        a = _n$parameters22.cornerRadius,
        l = _n$parameters22.cornerSegments,
        u = dY(t, e, r, t * .5, o, s, 0, 0, i, a, l);
      return u.scale(1, e / t, 1), Object.assign(u, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "TorusGeometry"
        })
      });
    }
  }]);
  return lI;
}();
function dY(n, t, e, r, i, s, o, a, l, u, c) {
  var _ref28;
  (_ref28 = [e, t], t = _ref28[0], e = _ref28[1]), o = t / 2;
  var d = Se.clamp(i / 360, 0, 1);
  if (d === 0) {
    var h = new we();
    return h.setAttribute("position", new be([], 3)), h;
  }
  return d === 1 && (u = 0), new um(!0, n, t, e, r, d, s, o, a, l, u, c);
}
var cI = /*#__PURE__*/function () {
  function cI() {
    _classCallCheck(this, cI);
  }
  _createClass(cI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters19, _e$height19, _e$depth18, _e$tube;
      var e = Object.assign({}, (_t$parameters19 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters19 !== void 0 ? _t$parameters19 : {
        width: 100,
        tubularSegments: 64,
        radialSegments: 32,
        p: 2,
        q: 3
      }, n.parameters);
      return {
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height19 = e.height) !== null && _e$height19 !== void 0 ? _e$height19 : e.width),
          depth: Math.abs((_e$depth18 = e.depth) !== null && _e$depth18 !== void 0 ? _e$depth18 : e.width),
          tube: (_e$tube = e.tube) !== null && _e$tube !== void 0 ? _e$tube : e.width * .125
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters23 = n.parameters,
        t = _n$parameters23.width,
        e = _n$parameters23.tube,
        r = _n$parameters23.tubularSegments,
        i = _n$parameters23.radialSegments,
        s = _n$parameters23.p,
        o = _n$parameters23.q,
        a = t * .5;
      a !== e && (a -= e);
      var l = new Vu(a, e, r, i, s, o);
      return Object.assign(l, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "TorusKnotGeometry"
        })
      });
    }
  }]);
  return cI;
}();
var uI = /*#__PURE__*/function () {
  function uI() {
    _classCallCheck(this, uI);
  }
  _createClass(uI, null, [{
    key: "create",
    value: function create(n) {
      return this.build(this.normalizeInputs(n));
    }
  }, {
    key: "normalizeInputs",
    value: function normalizeInputs(n, t) {
      var _t$parameters20, _e$height20, _e$depth19;
      var e = Object.assign({}, (_t$parameters20 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters20 !== void 0 ? _t$parameters20 : {
        width: 100,
        depth: 0,
        spikes: 5,
        cornerRadius: 0,
        extrudeBevelSize: 0,
        extrudeBevelSegments: 1,
        isRect: !1
      }, n.parameters);
      return {
        shape: n.shape && n.shape instanceof kt ? n.shape : new kt(),
        parameters: Object.assign(e, {
          width: Math.abs(e.width),
          height: Math.abs((_e$height20 = e.height) !== null && _e$height20 !== void 0 ? _e$height20 : e.width * (e.isRect ? 1 : Math.sqrt(3) / 2)),
          depth: Math.abs((_e$depth19 = e.depth) !== null && _e$depth19 !== void 0 ? _e$depth19 : 0)
        })
      };
    }
  }, {
    key: "build",
    value: function build(n) {
      var _n$parameters24 = n.parameters,
        _n$parameters24$width = _n$parameters24.width,
        t = _n$parameters24$width === void 0 ? 100 : _n$parameters24$width,
        e = _n$parameters24.height,
        r = _n$parameters24.cornerRadius,
        i = _n$parameters24.depth,
        s = _n$parameters24.extrudeBevelSize,
        o = _n$parameters24.extrudeBevelSegments,
        a = _n$parameters24.isRect,
        l = n.shape,
        u = t * .5,
        c = e * .5;
      a ? (l.addPoint(l.createPoint(-u, c)), l.addPoint(l.createPoint(u, -c)), l.addPoint(l.createPoint(-u, -c))) : (l.addPoint(l.createPoint(0, c)), l.addPoint(l.createPoint(u, -c)), l.addPoint(l.createPoint(-u, -c))), l.isClosed = !0;
      for (var h = 0, f = l.points.length; h < f; h++) l.points[h].roundness = r;
      l.roundness = r, l.update();
      var d = Dn.create({
        shape: l,
        parameters: {
          roundness: r,
          depth: i,
          extrudeBevelSize: s,
          extrudeBevelSegments: o
        }
      });
      return Object.assign(d, {
        userData: _objectSpread(_objectSpread({}, n), {}, {
          type: "TriangleGeometry"
        })
      });
    }
  }]);
  return uI;
}();
function dI(n, t) {
  var e = 2 * Math.PI;
  return (n % e + e) % e === (t % e + e) % e;
}
var mA = /*#__PURE__*/function () {
    function mA() {
      _classCallCheck(this, mA);
    }
    _createClass(mA, [{
      key: "add",
      value: function add(t, e, r) {
        if (typeof arguments[0] != "string") for (var i in arguments[0]) this.add(i, arguments[0][i], arguments[1]);else (Array.isArray(t) ? t : [t]).forEach(function (i) {
          this[i] = this[i] || [], e && this[i][r ? "unshift" : "push"](e);
        }, this);
      }
    }, {
      key: "run",
      value: function run(t, e) {
        this[t] = this[t] || [], this[t].forEach(function (r) {
          r.call(e && e.context ? e.context : e, e);
        });
      }
    }]);
    return mA;
  }(),
  gA = /*#__PURE__*/function () {
    function gA(t) {
      _classCallCheck(this, gA);
      this.jsep = t, this.registered = {};
    }
    _createClass(gA, [{
      key: "register",
      value: function register() {
        var _this123 = this;
        for (var _len4 = arguments.length, t = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
          t[_key4] = arguments[_key4];
        }
        t.forEach(function (e) {
          if (_typeof(e) != "object" || !e.name || !e.init) throw new Error("Invalid JSEP plugin format");
          _this123.registered[e.name] || (e.init(_this123.jsep), _this123.registered[e.name] = e);
        });
      }
    }]);
    return gA;
  }(),
  ae = /*#__PURE__*/function () {
    function ae(t) {
      _classCallCheck(this, ae);
      this.expr = t, this.index = 0;
    }
    _createClass(ae, [{
      key: "char",
      get: function get() {
        return this.expr.charAt(this.index);
      }
    }, {
      key: "code",
      get: function get() {
        return this.expr.charCodeAt(this.index);
      }
    }, {
      key: "throwError",
      value: function throwError(t) {
        var e = new Error(t + " at character " + this.index);
        throw e.index = this.index, e.description = t, e;
      }
    }, {
      key: "runHook",
      value: function runHook(t, e) {
        if (ae.hooks[t]) {
          var r = {
            context: this,
            node: e
          };
          return ae.hooks.run(t, r), r.node;
        }
        return e;
      }
    }, {
      key: "searchHook",
      value: function searchHook(t) {
        if (ae.hooks[t]) {
          var e = {
            context: this
          };
          return ae.hooks[t].find(function (r) {
            return r.call(e.context, e), e.node;
          }), e.node;
        }
      }
    }, {
      key: "gobbleSpaces",
      value: function gobbleSpaces() {
        var t = this.code;
        for (; t === ae.SPACE_CODE || t === ae.TAB_CODE || t === ae.LF_CODE || t === ae.CR_CODE;) t = this.expr.charCodeAt(++this.index);
        this.runHook("gobble-spaces");
      }
    }, {
      key: "parse",
      value: function parse() {
        this.runHook("before-all");
        var t = this.gobbleExpressions(),
          e = t.length === 1 ? t[0] : {
            type: ae.COMPOUND,
            body: t
          };
        return this.runHook("after-all", e);
      }
    }, {
      key: "gobbleExpressions",
      value: function gobbleExpressions(t) {
        var e = [],
          r,
          i;
        for (; this.index < this.expr.length;) if (r = this.code, r === ae.SEMCOL_CODE || r === ae.COMMA_CODE) this.index++;else if (i = this.gobbleExpression()) e.push(i);else if (this.index < this.expr.length) {
          if (r === t) break;
          this.throwError('Unexpected "' + this.char + '"');
        }
        return e;
      }
    }, {
      key: "gobbleExpression",
      value: function gobbleExpression() {
        var t = this.searchHook("gobble-expression") || this.gobbleBinaryExpression();
        return this.gobbleSpaces(), this.runHook("after-expression", t);
      }
    }, {
      key: "gobbleBinaryOp",
      value: function gobbleBinaryOp() {
        this.gobbleSpaces();
        var t = this.expr.substr(this.index, ae.max_binop_len),
          e = t.length;
        for (; e > 0;) {
          if (ae.binary_ops.hasOwnProperty(t) && (!ae.isIdentifierStart(this.code) || this.index + t.length < this.expr.length && !ae.isIdentifierPart(this.expr.charCodeAt(this.index + t.length)))) return this.index += e, t;
          t = t.substr(0, --e);
        }
        return !1;
      }
    }, {
      key: "gobbleBinaryExpression",
      value: function gobbleBinaryExpression() {
        var t, e, r, i, s, o, a, l, u;
        if (o = this.gobbleToken(), !o || (e = this.gobbleBinaryOp(), !e)) return o;
        for (s = {
          value: e,
          prec: ae.binaryPrecedence(e),
          right_a: ae.right_associative.has(e)
        }, a = this.gobbleToken(), a || this.throwError("Expected expression after " + e), i = [o, s, a]; e = this.gobbleBinaryOp();) {
          if (r = ae.binaryPrecedence(e), r === 0) {
            this.index -= e.length;
            break;
          }
          s = {
            value: e,
            prec: r,
            right_a: ae.right_associative.has(e)
          }, u = e;
          var c = function c(d) {
            return s.right_a && d.right_a ? r > d.prec : r <= d.prec;
          };
          for (; i.length > 2 && c(i[i.length - 2]);) a = i.pop(), e = i.pop().value, o = i.pop(), t = {
            type: ae.BINARY_EXP,
            operator: e,
            left: o,
            right: a
          }, i.push(t);
          t = this.gobbleToken(), t || this.throwError("Expected expression after " + u), i.push(s, t);
        }
        for (l = i.length - 1, t = i[l]; l > 1;) t = {
          type: ae.BINARY_EXP,
          operator: i[l - 1].value,
          left: i[l - 2],
          right: t
        }, l -= 2;
        return t;
      }
    }, {
      key: "gobbleToken",
      value: function gobbleToken() {
        var t, e, r, i;
        if (this.gobbleSpaces(), i = this.searchHook("gobble-token"), i) return this.runHook("after-token", i);
        if (t = this.code, ae.isDecimalDigit(t) || t === ae.PERIOD_CODE) return this.gobbleNumericLiteral();
        if (t === ae.SQUOTE_CODE || t === ae.DQUOTE_CODE) i = this.gobbleStringLiteral();else if (t === ae.OBRACK_CODE) i = this.gobbleArray();else {
          for (e = this.expr.substr(this.index, ae.max_unop_len), r = e.length; r > 0;) {
            if (ae.unary_ops.hasOwnProperty(e) && (!ae.isIdentifierStart(this.code) || this.index + e.length < this.expr.length && !ae.isIdentifierPart(this.expr.charCodeAt(this.index + e.length)))) {
              this.index += r;
              var s = this.gobbleToken();
              return s || this.throwError("missing unaryOp argument"), this.runHook("after-token", {
                type: ae.UNARY_EXP,
                operator: e,
                argument: s,
                prefix: !0
              });
            }
            e = e.substr(0, --r);
          }
          ae.isIdentifierStart(t) ? (i = this.gobbleIdentifier(), ae.literals.hasOwnProperty(i.name) ? i = {
            type: ae.LITERAL,
            value: ae.literals[i.name],
            raw: i.name
          } : i.name === ae.this_str && (i = {
            type: ae.THIS_EXP
          })) : t === ae.OPAREN_CODE && (i = this.gobbleGroup());
        }
        return i ? (i = this.gobbleTokenProperty(i), this.runHook("after-token", i)) : this.runHook("after-token", !1);
      }
    }, {
      key: "gobbleTokenProperty",
      value: function gobbleTokenProperty(t) {
        this.gobbleSpaces();
        var e = this.code;
        for (; e === ae.PERIOD_CODE || e === ae.OBRACK_CODE || e === ae.OPAREN_CODE || e === ae.QUMARK_CODE;) {
          var r = void 0;
          if (e === ae.QUMARK_CODE) {
            if (this.expr.charCodeAt(this.index + 1) !== ae.PERIOD_CODE) break;
            r = !0, this.index += 2, this.gobbleSpaces(), e = this.code;
          }
          this.index++, e === ae.OBRACK_CODE ? (t = {
            type: ae.MEMBER_EXP,
            computed: !0,
            object: t,
            property: this.gobbleExpression()
          }, this.gobbleSpaces(), e = this.code, e !== ae.CBRACK_CODE && this.throwError("Unclosed ["), this.index++) : e === ae.OPAREN_CODE ? t = {
            type: ae.CALL_EXP,
            arguments: this.gobbleArguments(ae.CPAREN_CODE),
            callee: t
          } : (e === ae.PERIOD_CODE || r) && (r && this.index--, this.gobbleSpaces(), t = {
            type: ae.MEMBER_EXP,
            computed: !1,
            object: t,
            property: this.gobbleIdentifier()
          }), r && (t.optional = !0), this.gobbleSpaces(), e = this.code;
        }
        return t;
      }
    }, {
      key: "gobbleNumericLiteral",
      value: function gobbleNumericLiteral() {
        var t = "",
          e,
          r;
        for (; ae.isDecimalDigit(this.code);) t += this.expr.charAt(this.index++);
        if (this.code === ae.PERIOD_CODE) for (t += this.expr.charAt(this.index++); ae.isDecimalDigit(this.code);) t += this.expr.charAt(this.index++);
        if (e = this.char, e === "e" || e === "E") {
          for (t += this.expr.charAt(this.index++), e = this.char, (e === "+" || e === "-") && (t += this.expr.charAt(this.index++)); ae.isDecimalDigit(this.code);) t += this.expr.charAt(this.index++);
          ae.isDecimalDigit(this.expr.charCodeAt(this.index - 1)) || this.throwError("Expected exponent (" + t + this.char + ")");
        }
        return r = this.code, ae.isIdentifierStart(r) ? this.throwError("Variable names cannot start with a number (" + t + this.char + ")") : (r === ae.PERIOD_CODE || t.length === 1 && t.charCodeAt(0) === ae.PERIOD_CODE) && this.throwError("Unexpected period"), {
          type: ae.LITERAL,
          value: parseFloat(t),
          raw: t
        };
      }
    }, {
      key: "gobbleStringLiteral",
      value: function gobbleStringLiteral() {
        var t = "",
          e = this.index,
          r = this.expr.charAt(this.index++),
          i = !1;
        for (; this.index < this.expr.length;) {
          var s = this.expr.charAt(this.index++);
          if (s === r) {
            i = !0;
            break;
          } else if (s === "\\") switch (s = this.expr.charAt(this.index++), s) {
            case "n":
              t += "\n";
              break;
            case "r":
              t += "\r";
              break;
            case "t":
              t += "	";
              break;
            case "b":
              t += "\b";
              break;
            case "f":
              t += "\f";
              break;
            case "v":
              t += "\v";
              break;
            default:
              t += s;
          } else t += s;
        }
        return i || this.throwError('Unclosed quote after "' + t + '"'), {
          type: ae.LITERAL,
          value: t,
          raw: this.expr.substring(e, this.index)
        };
      }
    }, {
      key: "gobbleIdentifier",
      value: function gobbleIdentifier() {
        var t = this.code,
          e = this.index;
        for (ae.isIdentifierStart(t) ? this.index++ : this.throwError("Unexpected " + this.char); this.index < this.expr.length && (t = this.code, ae.isIdentifierPart(t));) this.index++;
        return {
          type: ae.IDENTIFIER,
          name: this.expr.slice(e, this.index)
        };
      }
    }, {
      key: "gobbleArguments",
      value: function gobbleArguments(t) {
        var e = [],
          r = !1,
          i = 0;
        for (; this.index < this.expr.length;) {
          this.gobbleSpaces();
          var s = this.code;
          if (s === t) {
            r = !0, this.index++, t === ae.CPAREN_CODE && i && i >= e.length && this.throwError("Unexpected token " + String.fromCharCode(t));
            break;
          } else if (s === ae.COMMA_CODE) {
            if (this.index++, i++, i !== e.length) {
              if (t === ae.CPAREN_CODE) this.throwError("Unexpected token ,");else if (t === ae.CBRACK_CODE) for (var o = e.length; o < i; o++) e.push(null);
            }
          } else if (e.length !== i && i !== 0) this.throwError("Expected comma");else {
            var _o26 = this.gobbleExpression();
            (!_o26 || _o26.type === ae.COMPOUND) && this.throwError("Expected comma"), e.push(_o26);
          }
        }
        return r || this.throwError("Expected " + String.fromCharCode(t)), e;
      }
    }, {
      key: "gobbleGroup",
      value: function gobbleGroup() {
        this.index++;
        var t = this.gobbleExpressions(ae.CPAREN_CODE);
        if (this.code === ae.CPAREN_CODE) return this.index++, t.length === 1 ? t[0] : t.length ? {
          type: ae.SEQUENCE_EXP,
          expressions: t
        } : !1;
        this.throwError("Unclosed (");
      }
    }, {
      key: "gobbleArray",
      value: function gobbleArray() {
        return this.index++, {
          type: ae.ARRAY_EXP,
          elements: this.gobbleArguments(ae.CBRACK_CODE)
        };
      }
    }], [{
      key: "version",
      get: function get() {
        return "1.3.8";
      }
    }, {
      key: "toString",
      value: function toString() {
        return "JavaScript Expression Parser (JSEP) v" + ae.version;
      }
    }, {
      key: "addUnaryOp",
      value: function addUnaryOp(t) {
        return ae.max_unop_len = Math.max(t.length, ae.max_unop_len), ae.unary_ops[t] = 1, ae;
      }
    }, {
      key: "addBinaryOp",
      value: function addBinaryOp(t, e, r) {
        return ae.max_binop_len = Math.max(t.length, ae.max_binop_len), ae.binary_ops[t] = e, r ? ae.right_associative.add(t) : ae.right_associative.delete(t), ae;
      }
    }, {
      key: "addIdentifierChar",
      value: function addIdentifierChar(t) {
        return ae.additional_identifier_chars.add(t), ae;
      }
    }, {
      key: "addLiteral",
      value: function addLiteral(t, e) {
        return ae.literals[t] = e, ae;
      }
    }, {
      key: "removeUnaryOp",
      value: function removeUnaryOp(t) {
        return delete ae.unary_ops[t], t.length === ae.max_unop_len && (ae.max_unop_len = ae.getMaxKeyLen(ae.unary_ops)), ae;
      }
    }, {
      key: "removeAllUnaryOps",
      value: function removeAllUnaryOps() {
        return ae.unary_ops = {}, ae.max_unop_len = 0, ae;
      }
    }, {
      key: "removeIdentifierChar",
      value: function removeIdentifierChar(t) {
        return ae.additional_identifier_chars.delete(t), ae;
      }
    }, {
      key: "removeBinaryOp",
      value: function removeBinaryOp(t) {
        return delete ae.binary_ops[t], t.length === ae.max_binop_len && (ae.max_binop_len = ae.getMaxKeyLen(ae.binary_ops)), ae.right_associative.delete(t), ae;
      }
    }, {
      key: "removeAllBinaryOps",
      value: function removeAllBinaryOps() {
        return ae.binary_ops = {}, ae.max_binop_len = 0, ae;
      }
    }, {
      key: "removeLiteral",
      value: function removeLiteral(t) {
        return delete ae.literals[t], ae;
      }
    }, {
      key: "removeAllLiterals",
      value: function removeAllLiterals() {
        return ae.literals = {}, ae;
      }
    }, {
      key: "parse",
      value: function parse(t) {
        return new ae(t).parse();
      }
    }, {
      key: "getMaxKeyLen",
      value: function getMaxKeyLen(t) {
        return Math.max.apply(Math, [0].concat(_toConsumableArray(Object.keys(t).map(function (e) {
          return e.length;
        }))));
      }
    }, {
      key: "isDecimalDigit",
      value: function isDecimalDigit(t) {
        return t >= 48 && t <= 57;
      }
    }, {
      key: "binaryPrecedence",
      value: function binaryPrecedence(t) {
        return ae.binary_ops[t] || 0;
      }
    }, {
      key: "isIdentifierStart",
      value: function isIdentifierStart(t) {
        return t >= 65 && t <= 90 || t >= 97 && t <= 122 || t >= 128 && !ae.binary_ops[String.fromCharCode(t)] || ae.additional_identifier_chars.has(String.fromCharCode(t));
      }
    }, {
      key: "isIdentifierPart",
      value: function isIdentifierPart(t) {
        return ae.isIdentifierStart(t) || ae.isDecimalDigit(t);
      }
    }]);
    return ae;
  }(),
  hY = new mA();
Object.assign(ae, {
  hooks: hY,
  plugins: new gA(ae),
  COMPOUND: "Compound",
  SEQUENCE_EXP: "SequenceExpression",
  IDENTIFIER: "Identifier",
  MEMBER_EXP: "MemberExpression",
  LITERAL: "Literal",
  THIS_EXP: "ThisExpression",
  CALL_EXP: "CallExpression",
  UNARY_EXP: "UnaryExpression",
  BINARY_EXP: "BinaryExpression",
  ARRAY_EXP: "ArrayExpression",
  TAB_CODE: 9,
  LF_CODE: 10,
  CR_CODE: 13,
  SPACE_CODE: 32,
  PERIOD_CODE: 46,
  COMMA_CODE: 44,
  SQUOTE_CODE: 39,
  DQUOTE_CODE: 34,
  OPAREN_CODE: 40,
  CPAREN_CODE: 41,
  OBRACK_CODE: 91,
  CBRACK_CODE: 93,
  QUMARK_CODE: 63,
  SEMCOL_CODE: 59,
  COLON_CODE: 58,
  unary_ops: {
    "-": 1,
    "!": 1,
    "~": 1,
    "+": 1
  },
  binary_ops: {
    "||": 1,
    "&&": 2,
    "|": 3,
    "^": 4,
    "&": 5,
    "==": 6,
    "!=": 6,
    "===": 6,
    "!==": 6,
    "<": 7,
    ">": 7,
    "<=": 7,
    ">=": 7,
    "<<": 8,
    ">>": 8,
    ">>>": 8,
    "+": 9,
    "-": 9,
    "*": 10,
    "/": 10,
    "%": 10
  },
  right_associative: new Set(),
  additional_identifier_chars: new Set(["$", "_"]),
  literals: {
    true: !0,
    false: !1,
    null: null
  },
  this_str: "this"
});
ae.max_unop_len = ae.getMaxKeyLen(ae.unary_ops);
ae.max_binop_len = ae.getMaxKeyLen(ae.binary_ops);
var Nc = function Nc(n) {
    return new ae(n).parse();
  },
  fY = Object.getOwnPropertyNames(ae);
fY.forEach(function (n) {
  Nc[n] === void 0 && n !== "prototype" && (Nc[n] = ae[n]);
});
Nc.Jsep = ae;
var pY = "ConditionalExpression",
  mY = {
    name: "ternary",
    init: function init(n) {
      n.hooks.add("after-expression", function (e) {
        if (e.node && this.code === n.QUMARK_CODE) {
          this.index++;
          var r = e.node,
            i = this.gobbleExpression();
          if (i || this.throwError("Expected expression"), this.gobbleSpaces(), this.code === n.COLON_CODE) {
            this.index++;
            var s = this.gobbleExpression();
            if (s || this.throwError("Expected expression"), e.node = {
              type: pY,
              test: r,
              consequent: i,
              alternate: s
            }, r.operator && n.binary_ops[r.operator] <= .9) {
              var o = r;
              for (; o.right.operator && n.binary_ops[o.right.operator] <= .9;) o = o.right;
              e.node.test = o.right, o.right = e.node, e.node = r;
            }
          } else this.throwError("Expected :");
        }
      });
    }
  };
Nc.plugins.register(mY);
var gY = ["+", "-", "*", "/", "(", ")", "==", "!=", ">", "<", ">=", "<=", "and", "or", "!", "%", "^", ","],
  yY = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "."],
  vY = ["sin", "cos", "tan", "asin", "acos", "atan", "atan2", "sqrt", "abs", "log", "exp", "floor", "ceil", "round", "min", "max", "random"];
function xY(n) {
  return typeof n != "string" ? !1 : !isNaN(n) && !isNaN(parseFloat(n));
}
Nc.addBinaryOp("^", 11, !0);
function C0(n, t) {
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "number";
  var r = "";
  for (var o = 0; o < n.length; o++) {
    var a = n[o];
    if ("id" in a) {
      var l = n[o - 1];
      if (o > 0 && "id" in l) {
        console.error("Two variables in a row", n);
        return;
      }
      var u = t.getVariable(a.id),
        c = Fi.getDisplayedValue(u);
      e === "number" && Fi.isTextValue(u) && Array.isArray(u.textValue) && u.textValue.length === 1 ? c = parseFloat(c).toString() : e === "boolean" && Fi.isBoolean(u) ? c = u ? "true" : "false" : e === "boolean" && Fi.isTextValue(u) && !Array.isArray(u.textValue) && (c = '"' + c + '"'), r += c;
      continue;
    } else if (e === "string") {
      a.name !== '"' && a.name !== "+" && (r += a.name), a.name === "+" && r[r.length - 1] === "\\" && (r = r.slice(0, -1) + a.name);
      continue;
    }
    if (a.name === "and") {
      r += "&&";
      continue;
    }
    if (a.name === "or") {
      r += "||";
      continue;
    }
    if (a.name === "True") {
      r += "true";
      continue;
    }
    if (a.name === "False") {
      r += "false";
      continue;
    }
    if (e === "boolean" && !xY(a.name) && !yY.includes(a.name) && !gY.includes(a.name) && !vY.includes(a.name.replace(/\($/g, ""))) {
      r += '"' + a.name + '"';
      continue;
    }
    r += a.name;
  }
  if (e === "string") return r;
  if (n.length === 0) {
    if (e === "number") return 0;
    if (e === "boolean") return !1;
  }
  var i;
  try {
    i = Nc(r);
  } catch (o) {
    console.error(r, o);
    return;
  }
  var s;
  try {
    s = Nt(i);
  } catch (o) {
    console.error(r, i, o);
  }
  return s;
}
function Nt(n) {
  switch (n.type) {
    case "BinaryExpression":
      switch (n.operator) {
        case "==":
          return Number(Nt(n.left) === Nt(n.right));
        case "!=":
          return Number(Nt(n.left) !== Nt(n.right));
        case ">":
          return Number(Nt(n.left) > Nt(n.right));
        case ">=":
          return Number(Nt(n.left) >= Nt(n.right));
        case "<":
          return Number(Nt(n.left) < Nt(n.right));
        case "<=":
          return Number(Nt(n.left) <= Nt(n.right));
        case "+":
          return Nt(n.left) + Nt(n.right);
        case "-":
          return Nt(n.left) - Nt(n.right);
        case "*":
          return Nt(n.left) * Nt(n.right);
        case "/":
          return Nt(n.left) / Nt(n.right);
        case "%":
          return Nt(n.left) % Nt(n.right);
        case "&&":
          return Nt(n.left) && Nt(n.right);
        case "||":
          return Nt(n.left) || Nt(n.right);
        case "^":
          return Math.pow(Nt(n.left), Nt(n.right));
        default:
          throw new Error("Unknown operator: " + n.operator);
      }
    case "UnaryExpression":
      switch (n.operator) {
        case "-":
          return -Nt(n.argument);
        case "!":
          return Number(!Nt(n.argument));
        default:
          throw new Error("Unknown operator: " + n.operator);
      }
    case "Identifier":
      throw new Error("Unknown identifier: " + n.name);
    case "Literal":
      return n.value;
    case "CallExpression":
      if (n.callee.type === "Identifier") {
        if (n.callee.name === "random") {
          var t = 0,
            e = 1;
          if (n.arguments.length >= 1) try {
            t = Nt(n.arguments[0]);
          } catch (r) {
            console.warn(r);
          }
          if (n.arguments.length >= 2) try {
            e = Nt(n.arguments[1]);
          } catch (r) {
            console.warn(r);
          }
          return t = Math.min(e, t), e = Math.max(e, t), t + Math.random() * (e - t);
        }
        return Math[n.callee.name].apply(null, n.arguments.map(Nt));
      } else throw new Error("Unknown node");
    default:
      throw new Error("Unknown node type: " + n.type);
  }
}
var bY = new te(),
  SY = new te();
function wY(n, t, e) {
  var r = [new _(), new _(), new _()],
    i = [new _(), new _(), new _()];
  return n.extractBasis(r[0], r[1], r[2]), t.extractBasis(i[0], i[1], i[2]), r.forEach(function (s, o) {
    var a = i[o],
      l = Se.lerp(s.length(), a.length(), e);
    s.lerp(a, e).setLength(l);
  }), new te().makeBasis(r[0], r[1], r[2]);
}
var hI = /*#__PURE__*/function () {
    function hI() {
      _classCallCheck(this, hI);
    }
    _createClass(hI, null, [{
      key: "create",
      value: function create(n) {
        return this.build(this.normalizeInputs(n));
      }
    }, {
      key: "normalizeInputs",
      value: function normalizeInputs(n, t) {
        var _t$parameters21, _e$height21, _e$depth20, _t$shapeData, _n$path;
        var e = Object.assign({}, (_t$parameters21 = t === null || t === void 0 ? void 0 : t.parameters) !== null && _t$parameters21 !== void 0 ? _t$parameters21 : {
            width: 100,
            height: 100,
            depth: 1,
            subdivisions: 12,
            roundness: 0,
            extrudeBevelSize: 0,
            extrudeBevelSegments: 3
          }, n.parameters),
          r = Math.abs(e.width),
          i = Math.abs((_e$height21 = e.height) !== null && _e$height21 !== void 0 ? _e$height21 : e.width),
          s = Math.abs((_e$depth20 = e.depth) !== null && _e$depth20 !== void 0 ? _e$depth20 : 0),
          o = (_t$shapeData = t === null || t === void 0 ? void 0 : t.shapeData) !== null && _t$shapeData !== void 0 ? _t$shapeData : wh.create({
            parameters: l1
          }).userData.shape;
        return {
          path: (_n$path = n.path) !== null && _n$path !== void 0 ? _n$path : Vd.defaultData(),
          parameters: Object.assign(e, {
            width: r,
            height: i,
            depth: s,
            extrusion: _objectSpread(_objectSpread({}, Vv), e.extrusion)
          }),
          shapeData: o
        };
      }
    }, {
      key: "build",
      value: function build(n) {
        if (n.path.points.length >= 2) {
          var e = new yA(n);
          return Object.assign(e, {
            userData: _objectSpread(_objectSpread({}, n), {}, {
              type: "PathGeometry"
            })
          });
        } else return Object.assign(new we(), {
          userData: _objectSpread(_objectSpread({}, n), {}, {
            type: "PathGeometry"
          })
        });
      }
    }]);
    return hI;
  }(),
  yA = /*#__PURE__*/function (_we18) {
    _inherits(yA, _we18);
    var _super132 = _createSuper(yA);
    function yA(e) {
      var _this124;
      _classCallCheck(this, yA);
      _this124 = _super132.call(this);
      _this124.type = "PathExtrusionGeometry", _this124.inputs = e, _this124.build();
      return _this124;
    }
    _createClass(yA, [{
      key: "_isGeometryClosed",
      value: function _isGeometryClosed() {
        return this.inputs.path.isClosed && this.inputs.parameters.extrusion.depth === 1;
      }
    }, {
      key: "_isOpenEnded",
      value: function _isOpenEnded() {
        var e = this.inputs.parameters.extrusion;
        return !(this.inputs.path.isClosed && e.depth === 1) || !dI(e.twist, 0) || e.startScale !== e.endScale;
      }
    }, {
      key: "build",
      value: function build() {
        var _this125 = this;
        var e = this._extractPathPoints();
        if (e.length < 2) return;
        var r = this._computeBasisMatrices(e),
          _this$inputs$paramete = this.inputs.parameters.extrusion,
          i = _this$inputs$paramete.depth,
          s = _this$inputs$paramete.offset;
        i = Math.max(0, Math.min(i, 1)), s = Math.max(0, Math.min(s, 1));
        var o = this.inputs.path.isClosed ? e.length : e.length - 1,
          a = Math.floor(s * o),
          l = this.inputs.path.isClosed ? Math.ceil((i + s) * o) : Math.ceil(Math.min(1, i + s) * o),
          u = Math.min(Math.max(2, l - a + 1), o + 2),
          c = [],
          d = [];
        for (var _U9 = 0; _U9 < u; _U9++) {
          var j = this.inputs.path.isClosed ? (_U9 + a) % e.length : Math.min(_U9 + a, e.length - 1);
          c.push(e[j].clone()), d.push(r[j].clone());
        }
        var h = function h(U, j, W) {
            c[U] = c[U].clone().lerp(c[j], W), d[U] = wY(d[U], d[j], W);
          },
          f = 0,
          p = s * o % 1;
        (!this.inputs.path.isClosed || i <= 1) && (p || s === 0) && (f = p, h(0, 1, f));
        var m = 0,
          g = (s + i) * o % 1;
        if ((this.inputs.path.isClosed && i <= 1 || !this.inputs.path.isClosed && s + i < 1) && g && (m = g, h(c.length - 1, c.length - 2, 1 - m)), i === 0) {
          var _U10 = c.length - 1;
          c[_U10].copy(c[0]), d[_U10].copy(d[0]);
        }
        this._applyPathModifiers(d, f, m);
        var _this$inputs$paramete2 = this.inputs.parameters.extrusion,
          y = _this$inputs$paramete2.bevel,
          v = _this$inputs$paramete2.bevelSides,
          x = y > 0 ? this.inputs.parameters.extrusion.capType : "flat",
          S = 5;
        this.inputs.parameters.extrusion.shape.type === "Custom" && (S = this.inputs.parameters.extrusion.shape.shapeQuality === "low" ? 5 : 12);
        var _this$_computeShapePo = this._computeShapePoints(S),
          w = _this$_computeShapePo.regions,
          A = _this$_computeShapePo.infos,
          E = _this$_computeShapePo.vertices,
          b = 0,
          T;
        x === "round" && (T = new Ol(this.inputs.shapeData, 2 * y, y, S, v, void 0, !0), b = T.getAttribute("position").count);
        var M = 0,
          C = 0;
        A.sort(function (U, j) {
          return U.start - j.start;
        }), A.forEach(function (U) {
          U.verticesStart = M, U.verticesCount = U.continuous.reduce(function (j, W, k) {
            return j + (k === 0 || !W ? 2 : 1);
          }, 0), C += U.verticesCount, M = C;
        });
        var P = C * u,
          D,
          O = 0;
        if (this._isOpenEnded() && x === "flat") {
          try {
            D = Hs({
              windingRule: Mt.ODD,
              elementType: Rr.POLYGONS,
              polySize: 3,
              vertexSize: 2,
              strict: !0,
              contours: w
            });
          } catch (_unused21) {
            D = oA;
          }
          O = D.vertexCount;
        }
        var I = P + 2 * O + b * 2,
          z = P + 2 * O,
          B = {
            positions: new Float32Array(I * 3),
            normals: new Float32Array(I * 3),
            uvs: new Float32Array(I * 2)
          },
          V = [];
        if (A.forEach(function (U) {
          _this125._extrudeRegion(U, E, d, c, B, V, _this125._isGeometryClosed() && !_this125._isOpenEnded());
        }), D && (this._closeEnd(D, P, V, B, d[0], c[0], !1), this._closeEnd(D, P + O, V, B, d[d.length - 1], c[c.length - 1], !0)), T) {
          B.positions.set(T.getAttribute("position").array, z * 3), B.normals.set(T.getAttribute("normal").array, z * 3), B.uvs.set(T.getAttribute("uv").array, z * 2);
          var _U11 = V.length;
          V.push.apply(V, _toConsumableArray(T.getIndex().array.map(function (k) {
            return k + z;
          }))), z += b, B.positions.set(T.getAttribute("position").array, z * 3), B.normals.set(T.getAttribute("normal").array, z * 3), B.uvs.set(T.getAttribute("uv").array, z * 2);
          var _j11 = V.length;
          V.push.apply(V, _toConsumableArray(T.getIndex().array.map(function (k) {
            return k + z;
          }))), this.setAttribute("position", new Ge(B.positions, 3)), this.setAttribute("normal", new Ge(B.normals, 3)), this.setAttribute("uv", new Ge(B.uvs, 2)), this.setIndex(V);
          var W = bY;
          W.copy(d[d.length - 1]).setPosition(c[c.length - 1]), this.applyMatrix4OnRange(W, z, I), W.copy(d[0]).setPosition(c[0]).multiply(SY.makeScale(1, 1, -1)), this.applyMatrix4OnRange(W, z - b, z), this.reverseIndicesOnRange(_U11, _j11);
        } else this.setAttribute("position", new Ge(B.positions, 3)), this.setAttribute("normal", new Ge(B.normals, 3)), this.setAttribute("uv", new Ge(B.uvs, 2)), this.setIndex(V);
      }
    }, {
      key: "_extractPathPoints",
      value: function _extractPathPoints() {
        var r = p0(this.inputs.path).getPoints(this.inputs.path.subdivisions);
        if (r.length < 2) return [];
        var i = [r[0]];
        return r.forEach(function (o) {
          i[i.length - 1].distanceToSquared(o) > .001 && i.push(o);
        }), this.inputs.path.isClosed && i[i.length - 1].distanceTo(i[0]) < .001 && i.pop(), i;
      }
    }, {
      key: "_computeBasisMatrices",
      value: function _computeBasisMatrices(e) {
        var r = [],
          i = e.length,
          s = this.inputs.path.isClosed,
          o = new _(),
          a = new _(),
          l = new _(),
          u = new _(),
          c = new _(0, 1, 0);
        for (var g = 0; g < i; g++) {
          var y = e[g],
            v = void 0;
          g === 0 ? v = s ? e[e.length - 2] : y.clone().multiplyScalar(2).sub(e[1]) : v = e[g - 1];
          var x = void 0;
          g === i - 1 ? x = s ? e[1] : y.clone().multiplyScalar(2).sub(e[g - 1]) : x = e[g + 1];
          var S = y.clone().sub(v).normalize(),
            w = x.clone().sub(y).normalize(),
            A = S.clone().add(w).normalize();
          l.copy(A), g === 0 && (A.equals(c) || A.clone().negate().equals(c)) && c.set(0, 0, 1);
          var E = c.clone().cross(A).normalize(),
            b = A.clone().cross(E).normalize();
          c.copy(b), u.copy(E), g === 0 && (o.copy(b), a.copy(A));
          var T = new te().makeBasis(E, b, A);
          r.push(T);
        }
        var d = s ? a : l,
          h = s ? o : new _(0, 1, 0),
          f = d.clone().cross(u).normalize(),
          p = Math.acos(h.dot(f));
        if (isNaN(p)) return r;
        var m = h.clone().cross(f);
        d.dot(m) > 0 && (p *= -1);
        for (var _g31 = 1; _g31 < r.length; _g31++) {
          var _y33 = new te().makeRotationZ(p * _g31 / r.length);
          r[_g31].multiply(_y33);
        }
        return r;
      }
    }, {
      key: "_applyPathModifiers",
      value: function _applyPathModifiers(e, r, i) {
        var s = e.length,
          _this$inputs$paramete3 = this.inputs.parameters.extrusion,
          o = _this$inputs$paramete3.angle,
          a = _this$inputs$paramete3.twist,
          l = _this$inputs$paramete3.startScale,
          u = _this$inputs$paramete3.endScale,
          c = new te(),
          d = new te();
        return e.forEach(function (h, f) {
          var p = f === 0 ? 0 : f === s - 1 ? 1 : (f - r) / (s - (i === 0 ? 0 : 1) - (r + (1 - i)));
          c.makeRotationZ(Se.lerp(o, o + a, p) * Se.DEG2RAD);
          var m = Se.lerp(l, u, p);
          d.makeScale(m, m, m), h.multiply(c).multiply(d);
        }), e;
      }
    }, {
      key: "_computeShapePoints",
      value: function _computeShapePoints() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 12;
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Mt.ODD;
        var i = this.inputs.shapeData,
          s = i.extractShapePointsToFlatArray([], e),
          o = i.shapeHoles.map(function (m) {
            var g = m.extractShapePointsToFlatArray([], e),
              y = [];
            for (var v = g.length - 1; v >= 1; v -= 2) {
              var x = g[v - 1],
                S = g[v - 0];
              y.push(x, S);
            }
            return y;
          }),
          a;
        try {
          a = Hs({
            windingRule: r,
            elementType: Rr.BOUNDARY_CONTOURS,
            vertexSize: 2,
            strict: !0,
            contours: [s]
          });
        } catch (_unused22) {
          a = cm;
        }
        var l;
        try {
          l = Hs({
            windingRule: Mt.ODD,
            elementType: Rr.BOUNDARY_CONTOURS,
            vertexSize: 2,
            strict: !0,
            contours: _toConsumableArray(o)
          });
        } catch (_unused23) {
          l = sA;
        }
        if (!a) throw new Error("error generating geometry");
        var u = a.elementCount;
        if (l) {
          a.elementCount += l.elementCount;
          for (var m = 0; m < l.elements.length; m++) {
            var g = l.elements[m],
              y = m % 2 === 0 ? a.vertexCount : 0;
            a.elements.push(g + y);
          }
          for (var _m39 = 0; _m39 < l.vertexIndices.length; _m39++) {
            var _g32 = l.vertexIndices[_m39],
              _y34 = a.vertexCount;
            a.vertexIndices.push(_g32 + _y34);
          }
          for (var _m40 = 0; _m40 < l.vertices.length; _m40++) {
            var _g33 = l.vertices[_m40];
            a.vertices.push(_g33);
          }
        }
        var c = 1 / 0,
          d = -1 / 0,
          h = 1 / 0,
          f = -1 / 0;
        for (var _m41 = 0, _g34 = a.vertexCount; _m41 < _g34; _m41++) {
          var _y35 = _m41 * 2,
            v = a.vertices[_y35 + 0],
            x = a.vertices[_y35 + 1];
          v < c && (c = v), v > d && (d = v), x < h && (h = x), x > f && (f = x);
        }
        var p = [];
        for (var _m42 = a.elementCount - 1; _m42 >= 0; _m42--) {
          var _g35 = _m42 >= u,
            _y36 = _m42 * 2,
            _v27 = a.elements[_y36 + 0],
            _x26 = a.elements[_y36 + 1],
            S = _v27 + _x26,
            w = {
              start: _v27,
              count: _x26,
              normals: [],
              isHole: _g35,
              continuous: [],
              verticesStart: 0,
              verticesCount: 0
            };
          p.push(w);
          var A = _v27,
            E = S - 1,
            b = _v27 + 1,
            T = i.roundedCurves.length;
          do {
            var _ref29;
            var M = A - _v27,
              C = a.vertices[E * 2 + 0],
              P = a.vertices[E * 2 + 1],
              D = a.vertices[A * 2 + 0],
              O = a.vertices[A * 2 + 1],
              I = a.vertices[b * 2 + 0],
              z = a.vertices[b * 2 + 1],
              B = D - C,
              _V10 = O - P,
              _U12 = Math.sqrt(B * B + _V10 * _V10);
            B /= _U12, _V10 /= _U12;
            var j = D - I,
              W = O - z,
              k = Math.sqrt(j * j + W * W);
            j /= k, W /= k, w.normals[M * 2 + 0] = -W, w.normals[M * 2 + 1] = j;
            var H = a.vertexIndices[A];
            if (Array.isArray(H)) w.continuous[M] = !1;else {
              var _i$getCurveIndexFromV = i.getCurveIndexFromVertexId(H - 1, !0),
                _i$getCurveIndexFromV2 = _slicedToArray(_i$getCurveIndexFromV, 2),
                X = _i$getCurveIndexFromV2[0],
                q = _i$getCurveIndexFromV2[1];
              if (q > 0 && q < 1) w.continuous[M] = !0;else {
                var _G19 = q === 1 ? X + 1 : X - 1;
                _G19 = (_G19 + T) % T;
                var _J18 = q === 1 ? 0 : 1,
                  Z = i.roundedCurves[X].getTangent(q),
                  K = i.roundedCurves[_G19].getTangent(_J18);
                w.continuous[M] = Z.dot(K) > .95;
              }
            }
            _g35 && (w.normals[M * 2 + 0] *= -1, w.normals[M * 2 + 1] *= -1), (_ref29 = [A, b, b + 1], E = _ref29[0], A = _ref29[1], b = _ref29[2]), b >= S && (b -= _x26);
          } while (b !== _v27 + 1);
        }
        return {
          regions: [s].concat(_toConsumableArray(o)),
          infos: p,
          vertices: a.vertices
        };
      }
    }, {
      key: "_insertVertex",
      value: function _insertVertex(e, r, i, s, o) {
        var a = r * 2,
          l = r * 3;
        e.positions[l + 0] = i.x, e.positions[l + 1] = i.y, e.positions[l + 2] = i.z, e.normals[l + 0] = s.x, e.normals[l + 1] = s.y, e.normals[l + 2] = s.z, e.uvs[a + 0] = o.x, e.uvs[a + 1] = o.y;
      }
    }, {
      key: "_extrudeRegion",
      value: function _extrudeRegion(e, r, i, s, o, a, l) {
        var _this126 = this;
        var u = new _(),
          c = new _(),
          d = new _(),
          h = new _(),
          f = new N();
        i.forEach(function (m, g) {
          var y = s[g],
            v = e.verticesStart * i.length + e.verticesCount * g;
          for (var x = 0; x < e.count; x++) {
            var S = (e.start + x) * 2;
            if (u.set(r[S + 0], r[S + 1], 0), d.copy(u).applyMatrix4(m).add(y), e.continuous[x]) h.set(e.normals[x * 2 + 0], e.normals[x * 2 + 1], 0);else {
              var w = x === 0 ? (e.start + e.count - 1) * 2 : S - 2;
              c.set(r[w + 0], r[w + 1], 0), h.copy(u).sub(c), h.set(-h.y, h.x, 0), e.isHole || h.negate();
            }
            if (h.applyMatrix4(m).normalize(), f.set(x === 0 ? 1 : x / e.count, g / (i.length - 1)), _this126._insertVertex(o, v, d, h, f), v++, !e.continuous[x] || x === 0) {
              if (x === 0) h.set(e.normals[x * 2 + 0], e.normals[x * 2 + 1], 0), f.set(0, g / (i.length - 1));else {
                var _w33 = x === e.count - 1 ? e.start * 2 : S + 2;
                c.set(r[_w33 + 0], r[_w33 + 1], 0), h.copy(c).sub(u), h.set(-h.y, h.x, 0), e.isHole || h.negate();
              }
              h.applyMatrix4(m).normalize(), _this126._insertVertex(o, v, d, h, f), v++;
            }
          }
        });
        var p = i.length - 1;
        for (var m = 0; m < p; m++) {
          var g = e.verticesStart * i.length + e.verticesCount * m,
            y = e.verticesStart * i.length + e.verticesCount * (m + 1),
            v = 0;
          for (var x = 0; x < e.count; x++) {
            (!e.continuous[x] || x === 0) && v++;
            var S = x === e.count - 1 ? 0 : v + 1,
              w = g + v,
              A = g + S,
              E = y + S,
              b = y + v;
            e.isHole ? a.push(w, E, A, w, b, E) : a.push(w, A, E, w, E, b), v++;
          }
        }
      }
    }, {
      key: "_closeEnd",
      value: function _closeEnd(e, r, i, s, o, a, l) {
        var u = e.vertexCount,
          c = new _(0, 0, l ? -1 : 1).applyMatrix4(o),
          d = new _(),
          h = new N();
        for (var p = 0; p < u; p++) {
          var m = 2 * p;
          d.set(e.vertices[m + 0], e.vertices[m + 1], 0).applyMatrix4(o).add(a), this._insertVertex(s, r + p, d, c, h);
        }
        var f = e.elements;
        for (var _p42 = 0; _p42 < e.elementCount; _p42++) {
          var _m43 = 3 * _p42,
            g = f[_m43 + 0] + r,
            y = f[_m43 + (l ? 1 : 2)] + r,
            v = f[_m43 + (l ? 2 : 1)] + r;
          i.push(g, y, v);
        }
      }
    }, {
      key: "applyMatrix4OnRange",
      value: function applyMatrix4OnRange(e, r, i) {
        var s = e.elements,
          o = new Qt().getNormalMatrix(e).elements,
          a,
          l,
          u,
          c,
          d = this.attributes.position,
          h = this.attributes.normal;
        if (!d || !h) return;
        var f = d.array,
          p = h.array,
          m = d.itemSize;
        for (var g = r * m, y = i * m; g < y; g += m) {
          if (g === r) debugger;
          a = f[g + 0], l = f[g + 1], u = f[g + 2], c = 1 / (s[3] * a + s[7] * l + s[11] * u + s[15]), f[g + 0] = (s[0] * a + s[4] * l + s[8] * u + s[12]) * c, f[g + 1] = (s[1] * a + s[5] * l + s[9] * u + s[13]) * c, f[g + 2] = (s[2] * a + s[6] * l + s[10] * u + s[14]) * c, a = p[g + 0], l = p[g + 1], u = p[g + 2], p[g + 0] = o[0] * a + o[3] * l + o[6] * u, p[g + 1] = o[1] * a + o[4] * l + o[7] * u, p[g + 2] = o[2] * a + o[5] * l + o[8] * u;
        }
        d.needsUpdate = !0, h.needsUpdate = !0;
      }
    }, {
      key: "reverseIndicesOnRange",
      value: function reverseIndicesOnRange(e, r) {
        var i = this.index;
        if (i) {
          for (var s = e; s < r; s += 3) {
            var o = i.getX(s),
              a = i.getX(s + 1),
              l = i.getX(s + 2);
            i.setXYZ(s, l, a, o);
          }
          i.needsUpdate = !0;
        }
      }
    }]);
    return yA;
  }(we);
function fI() {
  var n = new we();
  return n.setAttribute("position", new Ge(new Float32Array([]), 3)), n.setIndex(new Ge(new Uint16Array([]), 1)), n;
}
var _Y = fI().attributes,
  EY = 12,
  TY = 1,
  Th = /*#__PURE__*/function (_we19) {
    _inherits(Th, _we19);
    var _super133 = _createSuper(Th);
    function Th(e, r) {
      var _this127;
      _classCallCheck(this, Th);
      _this127 = _super133.call(this);
      _this127.charWidths = [];
      _this127.charCoords = [];
      _this127.wrappedText = [];
      _this127.isLowResolution = !1;
      _this127.vectorShapes = [];
      Object.assign(_this127.attributes, _Y), _this127.userData = {
        parameters: e,
        type: "TextGeometry"
      };
      var i = r.getFont(e.font);
      i !== null && i !== void 0 && i.isLoaded ? (_this127.font = i, _this127.update(e)) : _this127.updateFont(e.font, r).then(function () {
        _this127.update(e), r === null || r === void 0 ? void 0 : r.requestRender();
      });
      return _this127;
    }
    _createClass(Th, [{
      key: "updateFont",
      value: function () {
        var _updateFont = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e, r) {
          var i;
          return _regeneratorRuntime().wrap(function _callee4$(_context10) {
            while (1) switch (_context10.prev = _context10.next) {
              case 0:
                i = r.getFont(e);
                _context10.t0 = i;
                if (!_context10.t0) {
                  _context10.next = 6;
                  break;
                }
                this.font = i;
                _context10.next = 6;
                return i.loadingPromise;
              case 6:
              case "end":
                return _context10.stop();
            }
          }, _callee4, this);
        }));
        function updateFont(_x27, _x28) {
          return _updateFont.apply(this, arguments);
        }
        return updateFont;
      }()
    }, {
      key: "update",
      value: function update(e) {
        var _this128 = this;
        var r = this.font;
        if (this.userData = {
          parameters: e,
          type: "TextGeometry"
        }, !(r !== null && r !== void 0 && r.isLoaded)) {
          console.warn("Cannot update text because its font is not loaded");
          return;
        }
        var i = e.width,
          s = e.height,
          o = e.depth,
          a = e.extrudeBevelSize,
          l = e.extrudeBevelSegments,
          u = e.text,
          c = e.textTransform,
          d = Fi.getDisplayedValue(u),
          h = c === 2 ? d.toUpperCase() : c === 3 ? d.toLowerCase() : d,
          f = MY(e, r, h),
          _r$generateShapes = r.generateShapes(f, e),
          p = _r$generateShapes.shapes,
          m = _r$generateShapes.charWidths,
          g = _r$generateShapes.charCoords,
          y = (typeof i == "number" ? i : 1) * .5,
          v = (typeof s == "number" ? s : 1) * .5,
          x = p.map(function (A) {
            return new kt().fromShape(A, !0);
          });
        this.vectorShapes = x;
        var S = x.map(function (A) {
            return Dn.create({
              shape: A,
              parameters: {
                depth: o,
                extrudeBevelSegments: l,
                extrudeBevelSize: a,
                windingRule: o <= 0 ? Mt.NONZERO : Mt.ODD,
                subdivisions: _this128.isLowResolution && o > 0 ? TY : EY
              }
            });
          }),
          w = S.length ? Vs(S) : fI();
        w.translate(-y, v, 0), this.dispose(), this.wrappedText = f, this.charCoords = g, this.charWidths = m, this.deleteAttribute("extrudeNormal"), Object.entries(w.attributes).forEach(function (_ref30) {
          var _ref31 = _slicedToArray(_ref30, 2),
            A = _ref31[0],
            E = _ref31[1];
          _this128.setAttribute(A, E);
        }), this.setIndex(w.index), this.computeBoundingSphere();
      }
    }, {
      key: "clone",
      value: function clone() {
        var e = pn(new we(), Th.prototype);
        return e.copy(this), console.log("CloneGeometry", this, e), e;
      }
    }, {
      key: "copy",
      value: function copy(e) {
        var _this129 = this;
        return Object.entries(e.attributes).forEach(function (_ref32) {
          var _ref33 = _slicedToArray(_ref32, 2),
            r = _ref33[0],
            i = _ref33[1];
          _this129.setAttribute(r, i);
        }), this.setIndex(e.index), this.userData = {
          parameters: _objectSpread({}, e.userData.parameters),
          type: "TextGeometry"
        }, this;
      }
    }, {
      key: "setText",
      value: function () {
        var _setText = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {
          return _regeneratorRuntime().wrap(function _callee5$(_context11) {
            while (1) switch (_context11.prev = _context11.next) {
              case 0:
                _context11.t0 = this.font;
                if (!_context11.t0) {
                  _context11.next = 4;
                  break;
                }
                _context11.next = 4;
                return this.font.loadingPromise;
              case 4:
                _context11.next = 6;
                return this.update(_objectSpread(_objectSpread({}, this.userData.parameters), {}, {
                  text: e
                }));
              case 6:
              case "end":
                return _context11.stop();
            }
          }, _callee5, this);
        }));
        function setText(_x29) {
          return _setText.apply(this, arguments);
        }
        return setText;
      }()
    }, {
      key: "text",
      get: function get() {
        var _this$userData$parame;
        return (_this$userData$parame = this.userData.parameters.text) !== null && _this$userData$parame !== void 0 ? _this$userData$parame : "";
      }
    }]);
    return Th;
  }(we);
function MY(n, t, e) {
  var r = [""],
    i = "";
  var _iterator54 = _createForOfIteratorHelper(e),
    _step54;
  try {
    for (_iterator54.s(); !(_step54 = _iterator54.n()).done;) {
      var s = _step54.value;
      i += s, s === " " || s === "\n" ? (r[r.length - 1] += i, i = "", s === "\n" && r.push("")) : t.getTextWidth(r[r.length - 1] + i, n) > n.width && (r[r.length - 1].length && r.push(""), t.getTextWidth(r[r.length - 1] + i, n) > n.width && (i.length === 1 ? (r[r.length - 1] += i, i = "") : (r[r.length - 1] += i.slice(0, -1), i = i[i.length - 1], r.push(""))));
    }
  } catch (err) {
    _iterator54.e(err);
  } finally {
    _iterator54.f();
  }
  return r[r.length - 1] += i, r;
}
var mI,
  D0 = new Promise(function (n) {
    mI = n;
  }),
  pI = !1;
var P0;
function gI() {
  if (pI) return;
  if (P0) return P0;
  function n() {
    return _n5.apply(this, arguments);
  }
  function _n5() {
    _n5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {
      var e, i, _yield$Promise$all3, _yield$Promise$all4, s, o, a, l;
      return _regeneratorRuntime().wrap(function _callee6$(_context12) {
        while (1) switch (_context12.prev = _context12.next) {
          case 0:
            e = !1 ? "." : "https://unpkg.com/@splinetool/modelling-wasm@1.0.17/build";
            i = require("_bundle_loader")(require.resolve("./process.js"));
            _context12.next = 4;
            return Promise.all([i, fetch("".concat(e, "/process.wasm")).then(function (u) {
              return u.arrayBuffer();
            })]);
          case 4:
            _yield$Promise$all3 = _context12.sent;
            _yield$Promise$all4 = _slicedToArray(_yield$Promise$all3, 2);
            s = _yield$Promise$all4[0];
            o = _yield$Promise$all4[1];
            a = s.default;
            _context12.next = 11;
            return a({
              wasmBinary: o
            });
          case 11:
            l = _context12.sent;
            mI(l), pI = !0;
          case 13:
          case "end":
            return _context12.stop();
        }
      }, _callee6);
    }));
    return _n5.apply(this, arguments);
  }
  return P0 = n(), P0;
}
var CY = ["font"];
function Ta(n, t, e, r) {
  var _s$data$groups;
  var i, s, o;
  n.type === "PathGeometry" ? (s = JSON.parse(JSON.stringify(n)), o = [[], ["extrusion"]]) : (s = _objectSpread({}, n), o = [[]]);
  var _iterator55 = _createForOfIteratorHelper(o),
    _step55;
  try {
    for (_iterator55.s(); !(_step55 = _iterator55.n()).done;) {
      var _u33 = _step55.value;
      var c = s;
      var _iterator56 = _createForOfIteratorHelper(_u33),
        _step56;
      try {
        for (_iterator56.s(); !(_step56 = _iterator56.n()).done;) {
          var _d40 = _step56.value;
          c = c[_d40];
        }
      } catch (err) {
        _iterator56.e(err);
      } finally {
        _iterator56.f();
      }
      for (i in c) {
        var d = c[i];
        $w(d) && !CY.includes(i) && (c[i] = t.getVariable(d, [r.uuid, "geometry"].concat(_toConsumableArray(_u33), [i])), $w(c[i]) && (c[i] = 1));
      }
    }
  } catch (err) {
    _iterator55.e(err);
  } finally {
    _iterator55.f();
  }
  var a = {
    parameters: s,
    type: s.type
  };
  if (s.type === "PathGeometry") a.path = s.path;else if (s.type === "VectorGeometry") {
    var u = kt.createFromState(s.shape, s.width, s.height);
    a.shape = u;
  } else if (s.type === "NonParametricGeometry") s.data.groups && (_s$data$groups = s.data.groups) !== null && _s$data$groups !== void 0 && _s$data$groups.forEach(function (u) {
    var _u$materialIndex;
    return u.materialIndex = Math.max((_u$materialIndex = u.materialIndex) !== null && _u$materialIndex !== void 0 ? _u$materialIndex : 0, 0);
  }), a.geometry = new qu().parse(s);else if (s.type === "SubdivGeometry") {
    var _u31 = new Kr(s, e);
    return _u31.data = n, _u31;
  } else {
    if (s.type === "TextGeometry") return new Th(s, t);
    if (s.type === "UIGeometry") return Eh.create({
      parameters: {
        width: s.width,
        height: s.height,
        cornerRadius: s.cornerRadius,
        cornerType: s.cornerType
      }
    });
  }
  var l;
  try {
    l = vA(a);
  } catch (u) {
    console.error(u);
  }
  if (!l) {
    var _u32 = kt.createFromState(zd.defaultData(), 100, 100);
    a.shape = _u32, l = vA(a);
  }
  return l;
}
var PY = new te();
function fm(n, t, e, r) {
  var i = n.position.array,
    s = n.normal.array,
    o = PY.makeScale(t, e, r).invert().elements,
    a,
    l,
    u;
  for (var c = 0, d = i.length; c < d; c += 3) i[c] *= t, i[c + 1] *= e, i[c + 2] *= r, a = s[c], l = s[c + 1], u = s[c + 2], s[c] = o[0] * a + o[4] * l + o[8] * u, s[c + 1] = o[1] * a + o[5] * l + o[9] * u, s[c + 2] = o[2] * a + o[6] * l + o[10] * u;
  n.position.needsUpdate = !0, n.normal.needsUpdate = !0;
}
var O0 = new Bt(),
  Mh = new _(),
  it;
D0.then(function (n) {
  it = n;
});
var yI = new Float32Array([10, 10, 0, -10, 10, 0, -10, -10, 0, 10, -10, 0]),
  vI = new Uint32Array([0, 1, 2, 3]),
  xI = new Uint8Array([4]),
  Kr = /*#__PURE__*/function (_we20) {
    _inherits(Kr, _we20);
    var _super134 = _createSuper(Kr);
    function Kr(e, r) {
      var _this130;
      _classCallCheck(this, Kr);
      _this130 = _super134.call(this);
      _this130.data = e;
      _this130.flatShading = r;
      _this130.subdivPointer = 0;
      _this130.rebuild(), _this130.freeSubdivPointer();
      return _this130;
    }
    _createClass(Kr, [{
      key: "mutateDirectlyScaleBaked",
      value: function mutateDirectlyScaleBaked(e, r) {
        this.freeSubdivPointer();
        var i = this.data.scaleBaked,
          s = bo.div(r, i);
        this.subdividedGeometry && fm.apply(void 0, [this.subdividedGeometry.attributes].concat(_toConsumableArray(s))), this.originalGeometry && fm.apply(void 0, [this.originalGeometry.attributes].concat(_toConsumableArray(s))), this.data = e;
        var o = this.userData.parameters;
        this.userData.parameters = {
          width: o.width * s[0],
          height: o.height * s[1],
          depth: o.depth * s[2]
        }, this.originalGeometry.boundingSphere.center.multiply(Mh.fromArray(s));
        var a = Mh.set(o.width, o.height, o.depth).length();
        this.originalGeometry.boundingSphere.radius = a / 2;
      }
    }, {
      key: "ensureSubdivPointer",
      value: function ensureSubdivPointer() {
        return this.subdivPointer === 0 && this.rebuild(), this.subdivPointer;
      }
    }, {
      key: "rebuild",
      value: function rebuild() {
        var _r28, _this$subdividedGeome;
        var e, r, i;
        try {
          var _Kr$build = Kr.build(this.data, void 0, !this.flatShading, void 0);
          e = _Kr$build.originalGeometry;
          r = _Kr$build.subdividedGeometry;
          i = _Kr$build.subdivPointer;
        } catch (_unused24) {
          e = new li(100, 100, 100), i = 0;
        }
        this.subdivPointer = i, this.originalGeometry = e, this.subdividedGeometry = (_r28 = r) !== null && _r28 !== void 0 ? _r28 : void 0;
        var s = (_this$subdividedGeome = this.subdividedGeometry) !== null && _this$subdividedGeome !== void 0 ? _this$subdividedGeome : this.originalGeometry;
        Object.assign(this, s), this.calcBoundingBox();
      }
    }, {
      key: "freeSubdivPointer",
      value: function freeSubdivPointer() {
        this.subdivPointer && (Kr.freeSubdivPointer(this.subdivPointer), this.subdivPointer = 0);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        _get(_getPrototypeOf(Kr.prototype), "dispose", this).call(this), this.freeSubdivPointer();
      }
    }, {
      key: "calcBoundingBox",
      value: function calcBoundingBox() {
        var e = this.originalGeometry;
        e.boundingSphere === null && (e.boundingSphere = new Er(), this.subdividedGeometry && (this.subdividedGeometry.boundingSphere = e.boundingSphere));
        var r = e.attributes.position,
          i = e.boundingSphere.center;
        O0.setFromBufferAttribute(r), O0.getCenter(i), e.boundingSphere.radius = i.distanceTo(O0.max), isNaN(e.boundingSphere.radius) && console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.', this), O0.getSize(Mh);
        var s = {
          width: Mh.x,
          height: Mh.y,
          depth: Mh.z
        };
        return this.userData.parameters = s, s;
      }
    }], [{
      key: "build",
      value: function build(e, r, i, s) {
        var _e$phongAngle;
        var o,
          a,
          l,
          u = (_e$phongAngle = e === null || e === void 0 ? void 0 : e.phongAngle) !== null && _e$phongAngle !== void 0 ? _e$phongAngle : 35;
        i === !1 && (u = -1), r && (it.free_bvh(r), it.free_subdivision_surface(r));
        try {
          o = Kr.allocate(e, s);
        } catch (c) {
          console.error(c, e), o = Kr.allocate({
            positionWASM: yI,
            indexWASM: vI,
            verticesPerFaceWASM: xI
          }, s);
        }
        if (it.set_destination_refinement_level(o, 0), a = Kr.buildLevel(o, !0, u), e.subdivisions > 0) try {
          it.set_destination_refinement_level(o, e.subdivisions), l = Kr.buildLevel(o, !1, u);
        } catch (_unused25) {
          try {
            it.set_destination_refinement_level(o, e.subdivisions - 1), l = Kr.buildLevel(o, !1, u);
          } catch (_unused26) {
            l = null;
          }
        } else l = null;
        return {
          subdivPointer: o,
          originalGeometry: a,
          subdividedGeometry: l
        };
      }
    }, {
      key: "primitiveToQuads",
      value: function primitiveToQuads(e, r, i) {
        var _wA;
        e.widthSegments > 16 && (e.widthSegments = 16), e.heightSegments > 16 && (e.heightSegments = 16), e.depthSegments > 16 && (e.depthSegments = 16), e.radialSegments > 16 && (e.radialSegments = 16), e.type === "DodecahedronGeometry" && (e.detail = 0);
        var s = e.shape !== void 0 || e.path !== void 0 ? r.geometry : Ta(e, i, !1),
          o;
        e.type === "TorusGeometry" && e.arc === Math.PI * 2 ? o = s.getClosedTorusIndicesForBooleanOrSubdiv() : o = s.getIndex();
        var a, l, u, c;
        var _Fc = Fc(s.getAttribute("position"), o);
        a = _Fc.positions;
        c = _Fc.triIndices;
        var d;
        if (e.type === "CylinderGeometry" && e.cornerRadius === 0 && e.hollow === 0 && e.openEnded === !1) {
          var h = e.radialSegments * e.heightSegments * 3 * 2,
            f = h + e.radialSegments * 3;
          d = [h, f];
        }
        return (_wA = wA(a, c, s, d), l = _wA.indices, u = _wA.verticesPerFace), {
          positions: a,
          indices: l,
          verticesPerFace: u
        };
      }
    }, {
      key: "allocate",
      value: function allocate(e, r) {
        var _e$scaleBaked, _te;
        var i,
          s,
          o,
          a = [],
          l = [];
        e.positionWASM && e.positionWASM.length > 0 ? (i = e.positionWASM, s = e.indexWASM, o = e.verticesPerFaceWASM) : (i = yI, s = vI, o = xI);
        var u = i.length,
          c = s.length,
          d = o.length,
          h = i.length + a.length + l.length,
          f = s.length + o.length,
          p = h * Float32Array.BYTES_PER_ELEMENT + f * Uint32Array.BYTES_PER_ELEMENT,
          m = h * Float32Array.BYTES_PER_ELEMENT,
          g = f * Uint32Array.BYTES_PER_ELEMENT,
          y = it._malloc(p),
          v = new Float32Array(it.HEAPF32.buffer, y, h),
          x = new Uint32Array(it.HEAPU32.buffer, y + m, f);
        v.set(i, 0), v.set(a, i.length), v.set(l, i.length + a.length), x.set(s, 0), x.set(o, s.length);
        var S;
        e !== null && e !== void 0 && (_e$scaleBaked = e.scaleBaked) !== null && _e$scaleBaked !== void 0 && _e$scaleBaked.some(function (A) {
          return A !== 1;
        }) && (S = (_te = new te()).makeScale.apply(_te, _toConsumableArray(e.scaleBaked))), r && (S ? S.premultiply(r) : S = r);
        var w = S ? it.alloc_subdivision_surface2(y, u, y + m, c, y + m + s.length * Uint32Array.BYTES_PER_ELEMENT, d, S.elements) : it.alloc_subdivision_surface(y, u, y + m, c, y + m + s.length * Uint32Array.BYTES_PER_ELEMENT, d);
        return it._free(y), w;
      }
    }, {
      key: "buildLevel",
      value: function buildLevel(e, r, i, s, o) {
        var a = o ? it.get_mesh_data2(e, r ? it.Level.CONTROL : it.Level.REFINED, i, o.elements) : it.get_mesh_data(e, r ? it.Level.CONTROL : it.Level.REFINED, i),
          l = 8,
          u = it.HEAPU32.subarray(a >> 2, (a >> 2) + l),
          c = u.subarray(4, 4 + 4),
          d = 0,
          h = it.HEAPU32[u[d] >> 2],
          f = it.HEAPF32.subarray(h >> 2, (h >> 2) + c[d]);
        d++;
        var p = it.HEAPU32[u[d] >> 2],
          m = it.HEAPF32.subarray(p >> 2, (p >> 2) + c[d]);
        d++;
        var g = it.HEAPU32[u[d] >> 2],
          y = it.HEAPU32.subarray(g >> 2, (g >> 2) + c[d]);
        d++;
        var v = it.HEAPU32[u[d] >> 2],
          x = it.HEAPU32.subarray(v >> 2, (v >> 2) + c[d]);
        if (d++, s === void 0) {
          var S = new we();
          if (S.setIndex(new co(x, 1)), S.setAttribute("position", new be(f, 3)), S.setAttribute("normal", new be(m, 3)), r) {
            S.setAttribute("faceMap", new co(y, 1));
            var w = new Float32Array(m.length / 3 * 4).fill(0);
            S.setAttribute("color", new Ge(w, 4));
          }
          return it.free_mesh_data(a), S.userData.type = "SubdivGeometry", S;
        }
        s.getAttribute("position").copyArray(f), s.getAttribute("normal").copyArray(m), s.attributes.position.needsUpdate = !0, s.attributes.normal.needsUpdate = !0, it.free_mesh_data(a);
      }
    }, {
      key: "freeSubdivPointer",
      value: function freeSubdivPointer(e) {
        it.free_bvh(e), it.free_subdivision_surface(e);
      }
    }, {
      key: "buildControlCageWireframe",
      value: function buildControlCageWireframe(e, r, i) {
        var s = it.get_wireframe_data_for_base_level(e),
          o = 4,
          a = it.HEAPU32.subarray(s >> 2, (s >> 2) + o),
          l = a.subarray(2, 2 + 2),
          u = 0,
          c = it.HEAPU32[a[u] >> 2],
          d = it.HEAPF32.subarray(c >> 2, (c >> 2) + l[u]);
        u++;
        var h = it.HEAPU32[a[u] >> 2],
          f = it.HEAPU32.subarray(h >> 2, (h >> 2) + l[u]);
        if (r === void 0) {
          var p = new we();
          p.setAttribute("position", new be(d, 3));
          var m = new Float32Array(d.length);
          for (var g = 0, y = d.length; g < y;) m[g++] = i.r, m[g++] = i.g, m[g++] = i.b;
          return p.setAttribute("color", new Ge(m, 3)), p.setIndex(new co(f, 1)), it.free_wireframe_data_for_base_level(s), p;
        }
        r.getAttribute("position").copyArray(d), r.attributes.position.needsUpdate = !0, it.free_wireframe_data_for_base_level(s);
      }
    }, {
      key: "updateCollabMesh",
      value: function updateCollabMesh(e, r, i) {
        var s = r === 0;
        s || it.set_destination_refinement_level(e, r);
        var o = i ? it.get_topological_data2(e, s ? it.Level.CONTROL : it.Level.REFINED, i.elements) : it.get_topological_data(e, s ? it.Level.CONTROL : it.Level.REFINED),
          a = 6,
          l = it.HEAPU32.subarray(o >> 2, (o >> 2) + a),
          u = l.subarray(3, 3 + 3),
          c = 0,
          d = it.HEAPU32[l[c] >> 2],
          h = new Float32Array(it.HEAPF32.subarray(d >> 2, (d >> 2) + u[c]));
        c++;
        var f = it.HEAPU32[l[c] >> 2],
          p = new Uint32Array(it.HEAPU32.subarray(f >> 2, (f >> 2) + u[c]));
        c++;
        var m = it.HEAPU32[l[c] >> 2],
          g = new Uint8Array(it.HEAPU32.subarray(m >> 2, (m >> 2) + u[c]));
        return it.free_topological_data(o), {
          positions: h,
          indices: p,
          verticesPerFace: g
        };
      }
    }]);
    return Kr;
  }(we);
var bI = ["getX", "getY", "getZ"];
function Fc(n, t) {
  var e = {},
    r = t ? t.count : n.count,
    i = 0,
    s = [],
    o = [],
    a = 1e4;
  for (var u = 0; u < r; u++) {
    var c = t ? t.getX(u) : u,
      d = "";
    for (var h = 0; h < 3; h++) d += "".concat(~~(n[bI[h]](c) * a), ",");
    if (d in e) s.push(e[d]);else {
      for (var _h59 = 0; _h59 < 3; _h59++) o.push(n[bI[_h59]](c));
      e[d] = i, s.push(i), i++;
    }
  }
  var l = [];
  for (var _u34 = 0; _u34 < s.length; _u34 += 3) s[_u34] === s[_u34 + 1] || s[_u34] === s[_u34 + 2] || s[_u34 + 1] === s[_u34 + 2] || l.push(s[_u34], s[_u34 + 1], s[_u34 + 2]);
  return {
    positions: o,
    triIndices: l
  };
}
var I0 = new _(),
  xA = new _(),
  bA = new _(),
  SA = new _();
function wA(n, t, e, r) {
  var i = [],
    s = [];
  if (e.userData.shape !== void 0 && e.userData.parameters.depth === 0 && e.userData.shape.shapeHoles.length === 0) {
    var l = e.userData.shape.extractShapePointsToFlatArray([]),
      u = e.userData.parameters.spikes;
    if (e.userData.type === "EllipseGeometry" && u <= 24 && u % 4 === 0 && e.userData.parameters.angle >= 360) {
      var h = l.length / 2 / u;
      l = l.filter(function (f, p) {
        return Math.floor(p / 2) % h === 0;
      });
    }
    var c = 0;
    for (var _h60 = 0; _h60 < l.length; _h60 += 2) c += (l[_h60] - l[(_h60 === 0 ? l.length : _h60) - 2]) * (l[_h60 + 1] + l[(_h60 === 0 ? l.length : _h60) - 1]);
    n.length = 0;
    var d = 0;
    if (c < 0) for (var _h61 = 0; _h61 < l.length; _h61 += 2) n.push(l[_h61], l[_h61 + 1], 0), i.push(d++);else for (var _h62 = l.length - 2; _h62 >= 0; _h62 -= 2) n.push(l[_h62], l[_h62 + 1], 0), i.push(d++);
    return s.push(d), {
      indices: i,
      verticesPerFace: s
    };
  }
  var o = new Float32Array([e.userData.parameters.depth])[0],
    a = 0;
  for (; a < t.length;) {
    if (e.useNgonForTopBottomFaceDuringBake) {
      var _l55 = 0;
      if ((n[t[a] * 3 + 2] === o || n[t[a] * 3 + 2] === 0) && _l55++, (n[t[a + 1] * 3 + 2] === o || n[t[a + 1] * 3 + 2] === 0) && _l55++, (n[t[a + 2] * 3 + 2] === o || n[t[a + 2] * 3 + 2] === 0) && _l55++, _l55 === 3) break;
    }
    if (t[a + 1] === t[a + 3] && t[a + 2] === t[a + 5] || t[a + 0] === t[a + 3] && t[a + 2] === t[a + 4]) {
      I0.set(n[t[a] * 3], n[t[a] * 3 + 1], n[t[a] * 3 + 2]), xA.set(n[t[a + 1] * 3], n[t[a + 1] * 3 + 1], n[t[a + 1] * 3 + 2]), bA.set(n[t[a + 4] * 3], n[t[a + 4] * 3 + 1], n[t[a + 4] * 3 + 2]), SA.set(n[t[a + 5] * 3], n[t[a + 5] * 3 + 1], n[t[a + 5] * 3 + 2]), xA.sub(I0).normalize(), bA.sub(I0).normalize(), SA.sub(I0).normalize();
      var _l56 = xA.cross(bA).dot(SA);
      Math.abs(_l56) > .005 || r && r.some(function (u, c) {
        return c % 2 === 1 ? !1 : a >= r[c] && a < r[c + 1];
      }) ? (i.push(t[a], t[a + 1], t[a + 2]), s.push(3), a += 3) : (i.push(t[a], t[a + 1], t[a + 4], t[a + 5]), s.push(4), a += 6);
    } else i.push(t[a], t[a + 1], t[a + 2]), s.push(3), a += 3;
  }
  if (e.useNgonForTopBottomFaceDuringBake) {
    var _l57 = [],
      _u35 = [],
      _c26 = 0;
    for (var _d41 = 0, _h63 = 0; _d41 < n.length; _d41 += 3, _h63++) n[_d41 + 2] === 0 && (_l57.push(_h63), _c26++), n[_d41 + 2] === o && _u35.push(_h63);
    if (e.userData.parameters.extrudeBevelSize === 0) {
      var _d42 = _u35[0];
      _u35[0] = _u35[1], _u35[1] = _d42;
    }
    _l57.reverse(), i.push.apply(i, _l57.concat(_u35)), s.push(_c26, _c26);
  }
  return {
    indices: i,
    verticesPerFace: s
  };
}
var ps = {};
FN(ps, {
  calcBoolean: function calcBoolean() {
    return IY;
  },
  calcBooleanTopological: function calcBooleanTopological() {
    return OY;
  },
  freeMeshSet: function freeMeshSet() {
    return NY;
  },
  getMeshSet: function getMeshSet() {
    return RY;
  },
  hasOpenEdges: function hasOpenEdges() {
    return LY;
  },
  transformMeshSet: function transformMeshSet() {
    return BY;
  }
});
var SI,
  wI = new Promise(function (n) {
    SI = n;
  });
var R0;
function AI() {
  if (R0) return R0;
  function n() {
    return _n6.apply(this, arguments);
  }
  function _n6() {
    _n6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {
      var e, i, _yield$Promise$all5, _yield$Promise$all6, s, o, a, l;
      return _regeneratorRuntime().wrap(function _callee7$(_context13) {
        while (1) switch (_context13.prev = _context13.next) {
          case 0:
            e = !1 ? "." : "https://unpkg.com/@splinetool/boolean-wasm@1.0.17/build";
            i = require("_bundle_loader")(require.resolve("./boolean.js"));
            _context13.next = 4;
            return Promise.all([i, fetch("".concat(e, "/boolean.wasm")).then(function (u) {
              return u.arrayBuffer();
            })]);
          case 4:
            _yield$Promise$all5 = _context13.sent;
            _yield$Promise$all6 = _slicedToArray(_yield$Promise$all5, 2);
            s = _yield$Promise$all6[0];
            o = _yield$Promise$all6[1];
            a = s.default;
            _context13.next = 11;
            return a({
              wasmBinary: o
            });
          case 11:
            l = _context13.sent;
            SI(l);
          case 13:
          case "end":
            return _context13.stop();
        }
      }, _callee7);
    }));
    return _n6.apply(this, arguments);
  }
  return R0 = n(), R0;
}
var gt, Ch;
wI.then(function (n) {
  return gt = n;
});
function DY(n, t, e) {
  var r, i;
  n.userData.parameters.type === "TorusGeometry" && n.userData.parameters.arc === Math.PI * 2 ? i = n.getClosedTorusIndicesForBooleanOrSubdiv() : i = n.getIndex();
  var _Fc2 = Fc(n.getAttribute("position"), i),
    s = _Fc2.positions,
    o = _Fc2.triIndices,
    a;
  if (t && e) {
    var _wA2 = wA(s, o, n),
      l = _wA2.indices,
      u = _wA2.verticesPerFace;
    a = u.length, r = [];
    for (var c = 0, d = 0; c < a; c++) {
      r.push(u[c]);
      for (var h = 0; h < u[c]; h++) r.push(l[d++]);
    }
  } else {
    var _l58 = o.length;
    r = Array(_l58 + _l58 / 3), a = 0;
    for (var _u36 = 0, _c27 = 0; _c27 < r.length;) r[_c27++] = 3, a++, r[_c27++] = o[_u36++], r[_c27++] = o[_u36++], r[_c27++] = o[_u36++];
  }
  return {
    positions: s,
    faceIndices: r,
    nFaces: a
  };
}
function _I(n) {
  var t = n.length,
    e = t * Uint32Array.BYTES_PER_ELEMENT,
    r = t * Float32Array.BYTES_PER_ELEMENT,
    i = Number.isInteger(n[0]) ? e : r,
    s = gt._malloc(i);
  return (Number.isInteger(n[0]) ? new Uint32Array(gt.HEAPU32.buffer, s, t) : new Float32Array(gt.HEAPF32.buffer, s, t)).set(n, 0), s;
}
function EI(n) {
  switch (n) {
    case 0:
      return gt.OP.UNION;
    case 1:
      return gt.OP.INTERSECTION;
    case 2:
      return gt.OP.A_MINUS_B;
    case 3:
      return gt.OP.B_MINUS_A;
    case 4:
      return gt.OP.SYMMETRIC_DIFFERENCE;
    case 5:
      return gt.OP.ALL;
    default:
      throw new Error("Unknown boolean operation " + n);
  }
}
function OY(n, t) {
  Ch === void 0 && (Ch = gt.init_csg());
  var e = _I(n),
    r = gt.csg_calc_topological(Ch, e, n.length, EI(t));
  gt._free(e);
  var i = 6,
    s = gt.HEAPU32.subarray(r >> 2, (r >> 2) + i),
    o = s.subarray(3, 3 + 3),
    a = 0,
    l = gt.HEAPU32[s[a] >> 2],
    u = new Float32Array(gt.HEAPF32.subarray(l >> 2, (l >> 2) + o[a]));
  a++;
  var c = gt.HEAPU32[s[a] >> 2],
    d = new Uint32Array(gt.HEAPU32.subarray(c >> 2, (c >> 2) + o[a]));
  a++;
  var h = gt.HEAPU32[s[a] >> 2],
    f = new Uint8Array(gt.HEAPU32.subarray(h >> 2, (h >> 2) + o[a]));
  return gt.free_mesh_data(r), {
    positions: u,
    indices: d,
    verticesPerFace: f
  };
}
function IY(n, t, e, r) {
  Ch === void 0 && (Ch = gt.init_csg());
  var i = _I(n),
    s = gt.csg_calc(Ch, i, n.length, r, EI(t));
  gt._free(i);
  var o = 5,
    a = gt.HEAPU32.subarray(s >> 2, (s >> 2) + o),
    l = a.subarray(2, 2 + 3),
    u = 0,
    c = gt.HEAPU32[a[u] >> 2],
    d = gt.HEAPF32.subarray(c >> 2, (c >> 2) + l[u]);
  u++;
  var h = gt.HEAPU32[a[u] >> 2],
    f = gt.HEAPF32.subarray(h >> 2, (h >> 2) + l[u]);
  u++;
  var p = l[u];
  e.setAttribute("position", new be(d, 3)), e.setAttribute("normal", new be(f, 3));
  var m = gt.HEAPF32.subarray((s >> 2) + 5, (s >> 2) + 5 + 6);
  return e.boundingSphere === null && (e.boundingSphere = new Er()), e.boundingSphere.radius = -1, e.userData.parameters = {
    width: m[3] * 2,
    height: m[4] * 2,
    depth: m[5] * 2
  }, gt.free_mesh_data(s), p;
}
function RY(n, t, e) {
  if (gt === void 0) return -1;
  var r, i, s;
  if (t && n.userData.positions !== void 0) {
    var y = n.userData;
    s = y.verticesPerFace.length, r = y.positions, i = Array(y.verticesPerFace.reduce(function (v, x) {
      return v + x;
    }, 0) + s);
    for (var v = 0, x = 0, S = 0; v < y.verticesPerFace.length; v++) {
      i[S++] = y.verticesPerFace[v];
      for (var w = 0; w < y.verticesPerFace[v]; w++) i[S++] = y.indices[x++];
    }
  } else {
    var _DY = DY(n, t, e);
    r = _DY.positions;
    i = _DY.faceIndices;
    s = _DY.nFaces;
  }
  var o = r.length,
    a = i.length,
    l = r.length,
    u = i.length,
    c = l * Float32Array.BYTES_PER_ELEMENT + u * Uint32Array.BYTES_PER_ELEMENT,
    d = l * Float32Array.BYTES_PER_ELEMENT,
    h = u * Uint32Array.BYTES_PER_ELEMENT,
    f = gt._malloc(c),
    p = new Float32Array(gt.HEAPF32.buffer, f, l),
    m = new Uint32Array(gt.HEAPU32.buffer, f + d, u);
  p.set(r, 0), m.set(i, 0);
  var g = gt.get_csg_mesh(f, o, f + d, a, s);
  return gt._free(f), g;
}
function LY(n) {
  return gt.has_open_edges(n);
}
function BY(n, t) {
  gt.transform_csg_mesh(n, t.elements);
}
function NY(n) {
  gt.free_csg_mesh(n);
}
var FY = {
    ConeGeometry: xO,
    CubeGeometry: bO,
    CylinderGeometry: m0,
    DodecahedronGeometry: SO,
    EllipseGeometry: wh,
    HelixGeometry: KO,
    IcosahedronGeometry: ZO,
    LatheGeometry: JO,
    NonParametricGeometry: rI,
    PolygonGeometry: T0,
    PyramidGeometry: iI,
    RectangleGeometry: Eh,
    SphereGeometry: nI,
    PlaneGeometry: sI,
    BackdropGeometry: oI,
    StarGeometry: M0,
    TextFrameGeometry: aI,
    TorusGeometry: lI,
    TorusKnotGeometry: cI,
    TriangleGeometry: uI,
    PathGeometry: hI,
    VectorGeometry: Dn
  },
  vA = function vA(n) {
    return FY[n.type].create(n);
  };
function Ph(n) {
  return n !== null && "booleanOp" in n;
}
var Dh = /*#__PURE__*/function (_ph) {
  _inherits(Dh, _ph);
  var _super135 = _createSuper(Dh);
  function Dh() {
    var _this131;
    _classCallCheck(this, Dh);
    _this131 = _super135.apply(this, arguments);
    _this131.booleanMeshSetAddress = -1;
    _this131.booleanWasTransformed = !1;
    _this131.booleanMatrixInvOld = new te();
    return _this131;
  }
  _createClass(Dh, [{
    key: "updateVisible",
    value: function updateVisible(e) {
      _get(_getPrototypeOf(Dh.prototype), "updateVisible", this).call(this, e), this.visible = !Ph(this.parent) && this.visible, Ph(this.parent) && this.parent.invalidateDownstreamBooleanData();
    }
  }, {
    key: "freeBooleanPointer",
    value: function freeBooleanPointer() {
      this.booleanMeshSetAddress !== -1 && (ps.freeMeshSet(this.booleanMeshSetAddress), this.booleanMeshSetAddress = -1);
    }
  }, {
    key: "invalidateDownstreamBooleanData",
    value: function invalidateDownstreamBooleanData() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      return e ? this.booleanWasTransformed = !0 : this.freeBooleanPointer(), Ph(this.parent) ? this.parent.invalidateDownstreamBooleanData() : this;
    }
  }, {
    key: "invalidateUpstreamBooleanData",
    value: function invalidateUpstreamBooleanData() {
      this.freeBooleanPointer();
      var _iterator57 = _createForOfIteratorHelper(this.children),
        _step57;
      try {
        for (_iterator57.s(); !(_step57 = _iterator57.n()).done;) {
          var e = _step57.value;
          e instanceof Dh && (e.freeBooleanPointer(), Ph(e) && e.invalidateUpstreamBooleanData());
        }
      } catch (err) {
        _iterator57.e(err);
      } finally {
        _iterator57.f();
      }
    }
  }, {
    key: "updateTransformState",
    value: function updateTransformState(e, r) {
      var i = _get(_getPrototypeOf(Dh.prototype), "updateTransformState", this).call(this, e, r);
      return i && Ph(this.parent) && this.invalidateDownstreamBooleanData(!0), i;
    }
  }, {
    key: "onVariableUpdate",
    value: function onVariableUpdate() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      _get(_getPrototypeOf(Dh.prototype), "onVariableUpdate", this).call(this, e), Ph(this.parent) && this.invalidateDownstreamBooleanData(!0);
    }
  }]);
  return Dh;
}(ph(rr));
var L0 = new Bt();
function pm(n) {
  var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : n.count;
  var r = arguments.length > 3 ? arguments[3] : undefined;
  var i = arguments.length > 4 ? arguments[4] : undefined;
  var s = 1 / 0,
    o = 1 / 0,
    a = 1 / 0,
    l = -1 / 0,
    u = -1 / 0,
    c = -1 / 0;
  for (var d = t; d < e; d++) {
    var h = n.getX(d),
      f = n.getY(d),
      p = n.getZ(d);
    h < s && (s = h), f < o && (o = f), p < a && (a = p), h > l && (l = h), f > u && (u = f), p > c && (c = p);
  }
  L0.min.set(s, o, a), L0.max.set(l, u, c), L0.getCenter(r), L0.getSize(i).multiplyScalar(.5);
}
var kY = new we(),
  zY = new Ls(),
  nr = /*#__PURE__*/function (_Dh) {
    _inherits(nr, _Dh);
    var _super136 = _createSuper(nr);
    function nr(t, e) {
      var _this132;
      _classCallCheck(this, nr);
      _this132 = _super136.call(this, kY, zY), _this132.super_Entity(t, e);
      return _this132;
    }
    _createClass(nr, [{
      key: "updateState",
      value: function updateState(t, e) {
        this.updateState_Entity(t, e);
      }
    }, {
      key: "updateEntityBoxSize",
      value: function updateEntityBoxSize(t, e) {
        var r = this.geometry.getAttribute("position");
        r !== void 0 ? pm(r, this.geometry.drawRange.start, this.geometry.drawRange.count < 1 / 0 ? this.geometry.drawRange.count : r.count, t, e) : _get(_getPrototypeOf(nr.prototype), "updateEntityBoxSize", this).call(this, t, e);
      }
    }]);
    return nr;
  }(Dh);
var mm = /*#__PURE__*/function () {
  function mm(t) {
    var _t25;
    _classCallCheck(this, mm);
    t = (_t25 = t) !== null && _t25 !== void 0 ? _t25 : {}, this.name = t.name, this.type = t.type, this.node = t.node, this.size = t.size, this.needsUpdate = t.needsUpdate;
  }
  _createClass(mm, [{
    key: "value",
    get: function get() {
      return this.node.value;
    },
    set: function set(t) {
      this.node.value = t;
    }
  }]);
  return mm;
}();
var ki = /*#__PURE__*/function () {
  function ki(t) {
    _classCallCheck(this, ki);
    this.hashProperties = void 0;
    this.isNode = !0;
    this.shortcuts = {};
    this.uuid = Se.generateUUID(), this.type = t, this.name = "";
  }
  _createClass(ki, [{
    key: "analyze",
    value: function analyze(t, e) {
      var _e52;
      e = (_e52 = e) !== null && _e52 !== void 0 ? _e52 : {}, t.analyzing = !0, this.build(t.addFlow(e.slot, e.cache, e.context), "v4"), t.clearVertexNodeCode(), t.clearFragmentNodeCode(), t.removeFlow(), t.analyzing = !1;
    }
  }, {
    key: "analyzeAndFlow",
    value: function analyzeAndFlow(t, e, r) {
      var _r29;
      return r = (_r29 = r) !== null && _r29 !== void 0 ? _r29 : {}, this.analyze(t, r), this.flow(t, e, r);
    }
  }, {
    key: "flow",
    value: function flow(t, e, r) {
      var _r30;
      r = (_r30 = r) !== null && _r30 !== void 0 ? _r30 : {}, t.addFlow(r.slot, r.cache, r.context);
      var i = {
        result: this.build(t, e),
        code: t.clearNodeCode(),
        extra: t.context.extra
      };
      return t.removeFlow(), i;
    }
  }, {
    key: "build",
    value: function build(t, e, r) {
      var _e53;
      e = (_e53 = e) !== null && _e53 !== void 0 ? _e53 : this.getType(t, e);
      var i = t.getNodeData(r !== null && r !== void 0 ? r : this);
      return t.analyzing && this.appendDepsNode(t, i, e), t.nodes.indexOf(this) === -1 && t.nodes.push(this), this.updateFrame !== void 0 && t.updaters.indexOf(this) === -1 && t.updaters.push(this), this.generate(t, e, r);
    }
  }, {
    key: "updateFrame",
    value: function updateFrame(t) {}
  }, {
    key: "generateReadonly",
    value: function generateReadonly(t, e, r, i, s, o) {
      return "";
    }
  }, {
    key: "generate",
    value: function generate(t, e, r, i, s) {
      return "";
    }
  }, {
    key: "parse",
    value: function parse(t, e, r, i) {}
  }, {
    key: "appendDepsNode",
    value: function appendDepsNode(t, e, r) {
      e.deps = (e.deps || 0) + 1;
      var i = t.getTypeLength(r);
      (i > (e.outputMax || 0) || this.getType(t, r)) && (e.outputMax = i, e.output = r);
    }
  }, {
    key: "setName",
    value: function setName(t) {
      this.name = t;
    }
  }, {
    key: "getName",
    value: function getName() {
      return this.name;
    }
  }, {
    key: "getType",
    value: function getType(t, e) {
      return e === "sampler2D" || e === "samplerCube" ? e : this.type;
    }
  }, {
    key: "getHash",
    value: function getHash() {
      var t = "{",
        e,
        r;
      for (e in this) r = this[e], r instanceof ki && (t += '"' + e + '":' + r.getHash() + ",");
      if (this.hashProperties) for (var i = 0; i < this.hashProperties.length; i++) e = this.hashProperties[i], r = this[e], t += '"' + e + '":"' + String(r) + '",';
      return t += '"id":"' + this.uuid + '"}', t;
    }
  }]);
  return ki;
}();
var AA = /*#__PURE__*/function () {
    function AA() {
      _classCallCheck(this, AA);
      this.nodes = {};
      this.keywords = {};
    }
    _createClass(AA, [{
      key: "add",
      value: function add(t) {
        this.nodes[t.name] = t;
      }
    }, {
      key: "addKeyword",
      value: function addKeyword(t, e, r) {
        r = r !== void 0 ? r : !0, this.keywords[t] = {
          callback: e,
          cache: r
        };
      }
    }, {
      key: "remove",
      value: function remove(t) {
        delete this.nodes[t.name];
      }
    }, {
      key: "removeKeyword",
      value: function removeKeyword(t) {
        delete this.keywords[t];
      }
    }, {
      key: "get",
      value: function get(t) {
        return this.nodes[t];
      }
    }, {
      key: "getKeyword",
      value: function getKeyword(t, e) {
        return this.keywords[t].callback(e);
      }
    }, {
      key: "getKeywordData",
      value: function getKeywordData(t) {
        return this.keywords[t];
      }
    }, {
      key: "contains",
      value: function contains(t) {
        return this.nodes[t] !== void 0;
      }
    }, {
      key: "containsKeyword",
      value: function containsKeyword(t) {
        return this.keywords[t] !== void 0;
      }
    }]);
    return AA;
  }(),
  _i = new AA();
var Xe = /*#__PURE__*/function (_ki) {
  _inherits(Xe, _ki);
  var _super137 = _createSuper(Xe);
  function Xe(e, r) {
    var _r31;
    var _this133;
    _classCallCheck(this, Xe);
    _this133 = _super137.call(this, e);
    _this133.scope = "";
    r = (_r31 = r) !== null && _r31 !== void 0 ? _r31 : {}, _this133.shared = r.shared !== void 0 ? r.shared : !0, _this133.unique = r.unique !== void 0 ? r.unique : !1;
    return _this133;
  }
  _createClass(Xe, [{
    key: "build",
    value: function build(e, r, i, s) {
      var _r32;
      if (r = (_r32 = r) !== null && _r32 !== void 0 ? _r32 : this.getType(e), this.getShared(e, r)) {
        var _i61;
        var o = this.getUnique(e, r);
        o && this.uuid === void 0 && (this.uuid = Se.generateUUID()), i = e.getUUID((_i61 = i) !== null && _i61 !== void 0 ? _i61 : this.getUUID(), !o);
        var a = e.getNodeData(i),
          l = a.output || this.getType(e);
        if (e.analyzing) return (a.deps || 0) > 0 || this.getLabel() ? (this.appendDepsNode(e, a, r), this.generate(e, r, i)) : _get(_getPrototypeOf(Xe.prototype), "build", this).call(this, e, r, i);
        if (o) return a.name = a.name || _get(_getPrototypeOf(Xe.prototype), "build", this).call(this, e, r, i), a.name;
        if (!this.getLabel() && (!this.getShared(e, l) || e.context.ignoreCache || a.deps === 1)) return _get(_getPrototypeOf(Xe.prototype), "build", this).call(this, e, r, i);
        i = this.getUUID(!1);
        var u = this.getTemp(e, i);
        if (u) return e.format(u, l, r);
        {
          u = _get(_getPrototypeOf(Xe.prototype), "generate", this).call(this, e, r, i, a.output, s);
          var c = this.generate(e, l, i);
          return e.addNodeCode(u + " = " + c + ";"), e.format(u, l, r);
        }
      }
      return _get(_getPrototypeOf(Xe.prototype), "build", this).call(this, e, r, i);
    }
  }, {
    key: "getShared",
    value: function getShared(e, r) {
      return r !== "sampler2D" && r !== "samplerCube" && this.shared;
    }
  }, {
    key: "getUnique",
    value: function getUnique(e, r) {
      return this.unique;
    }
  }, {
    key: "setLabel",
    value: function setLabel(e) {
      return this.label = e, this;
    }
  }, {
    key: "getLabel",
    value: function getLabel() {
      return this.label;
    }
  }, {
    key: "getUUID",
    value: function getUUID(e) {
      var r = this.uuid;
      return typeof this.scope == "string" && (r = this.scope + "-" + r), r;
    }
  }, {
    key: "getTemp",
    value: function getTemp(e, r) {
      r = r || this.uuid;
      var i = e.getVars()[r];
      return i ? i.name : void 0;
    }
  }, {
    key: "generate",
    value: function generate(e, r, i, s, o) {
      var _i62;
      return this.getShared(e, r) || console.error("TempNode is not shared"), i = (_i62 = i) !== null && _i62 !== void 0 ? _i62 : this.uuid, e.getTempVar(i, s !== null && s !== void 0 ? s : this.getType(e), o, this.getLabel()).name;
    }
  }]);
  return Xe;
}(ki);
var Jt = /*#__PURE__*/function (_Xe) {
  _inherits(Jt, _Xe);
  var _super138 = _createSuper(Jt);
  function Jt(e, r) {
    var _r33;
    var _this134;
    _classCallCheck(this, Jt);
    r = (_r33 = r) !== null && _r33 !== void 0 ? _r33 : {}, r.shared = r.shared !== void 0 ? r.shared : !1;
    _this134 = _super138.call(this, e, r);
    _this134.readonly = !1;
    return _this134;
  }
  _createClass(Jt, [{
    key: "setReadonly",
    value: function setReadonly(e) {
      return this.readonly = e, this.hashProperties = this.readonly ? ["value"] : void 0, this;
    }
  }, {
    key: "getReadonly",
    value: function getReadonly() {
      return this.readonly;
    }
  }, {
    key: "generate",
    value: function generate(e, r, i, s, o, a) {
      var _i63, _s27;
      i = e.getUUID((_i63 = i) !== null && _i63 !== void 0 ? _i63 : this.getUUID()), s = (_s27 = s) !== null && _s27 !== void 0 ? _s27 : this.getType(e);
      var l = e.getNodeData(i);
      return this.getReadonly() && this.generateReadonly !== void 0 ? this.generateReadonly(e, r, i, s, o, a) : e.isShader("vertex") ? (l.vertex || (l.vertex = e.createVertexUniform(s, this, o, a, this.getLabel())), e.format(l.vertex.name, s, r)) : (l.fragment || (l.fragment = e.createFragmentUniform(s, this, o, a, this.getLabel())), e.format(l.fragment.name, s, r));
    }
  }]);
  return Jt;
}(Xe);
var Lr = /*#__PURE__*/function (_Jt) {
  _inherits(Lr, _Jt);
  var _super139 = _createSuper(Lr);
  function Lr() {
    var _this135;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var r = arguments.length > 1 ? arguments[1] : undefined;
    _classCallCheck(this, Lr);
    _this135 = _super139.call(this, "v2");
    _this135.nodeType = "Vector2";
    _this135.value = e instanceof N ? e : new N(e, r);
    return _this135;
  }
  _createClass(Lr, [{
    key: "x",
    get: function get() {
      return this.value.x;
    },
    set: function set(e) {
      this.value.x = e;
    }
  }, {
    key: "y",
    get: function get() {
      return this.value.y;
    },
    set: function set(e) {
      this.value.y = e;
    }
  }, {
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("vec2(" + this.value.x + ", " + this.value.y + ")", s, r);
    }
  }]);
  return Lr;
}(Jt);
var Xi = /*#__PURE__*/function (_Jt2) {
  _inherits(Xi, _Jt2);
  var _super140 = _createSuper(Xi);
  function Xi() {
    var _this136;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    _classCallCheck(this, Xi);
    _this136 = _super140.call(this, "v3");
    _this136.nodeType = "Vector3";
    _this136.value = e instanceof _ ? e : new _(e, r, i);
    return _this136;
  }
  _createClass(Xi, [{
    key: "x",
    get: function get() {
      return this.value.x;
    },
    set: function set(e) {
      this.value.x = e;
    }
  }, {
    key: "y",
    get: function get() {
      return this.value.y;
    },
    set: function set(e) {
      this.value.y = e;
    }
  }, {
    key: "z",
    get: function get() {
      return this.value.z;
    },
    set: function set(e) {
      this.value.z = e;
    }
  }, {
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("vec3(" + this.value.x + ", " + this.value.y + ", " + this.value.z + ")", s, r);
    }
  }]);
  return Xi;
}(Jt);
var cr = /*#__PURE__*/function (_Le) {
  _inherits(cr, _Le);
  var _super141 = _createSuper(cr);
  function cr(e, r, i, s) {
    var _this137;
    _classCallCheck(this, cr);
    _this137 = _super141.call(this, e, r, i);
    _this137.isColorA = !0;
    _this137.a = s;
    return _this137;
  }
  _createClass(cr, [{
    key: "setRGBA",
    value: function setRGBA(e, r, i, s) {
      _get(_getPrototypeOf(cr.prototype), "setRGB", this).call(this, e, r, i), this.a = s;
    }
  }, {
    key: "copy",
    value: function copy(e) {
      return _get(_getPrototypeOf(cr.prototype), "copy", this).call(this, e), this.a = "a" in e ? e.a : 1, this;
    }
  }, {
    key: "clone",
    value: function clone() {
      return new this.constructor(this.r, this.g, this.b, this.a);
    }
  }, {
    key: "equals",
    value: function equals(e) {
      return _get(_getPrototypeOf(cr.prototype), "equals", this).call(this, e) && this.a === e.a;
    }
  }, {
    key: "setStyle",
    value: function setStyle(e) {
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "srgb";
      var i;
      if (e === "transparent") return this.setRGBA(0, 0, 0, 0), this;
      if (i = /^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)) {
        var s,
          o = i[1],
          a = i[2];
        switch (o) {
          case "rgb":
          case "rgba":
            if (s = /^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)) return this.a = o === "rgba" ? parseFloat(s[4]) : 1, _get(_getPrototypeOf(cr.prototype), "setStyle", this).call(this, e, r);
            break;
          case "hsl":
          case "hsla":
            if (s = /^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)) return this.a = o === "hsla" ? parseFloat(s[4]) : 1, _get(_getPrototypeOf(cr.prototype), "setStyle", this).call(this, e, r);
            break;
        }
      }
      return _get(_getPrototypeOf(cr.prototype), "setStyle", this).call(this, e, r);
    }
  }, {
    key: "x",
    get: function get() {
      return this.r;
    },
    set: function set(e) {
      this.r = e;
    }
  }, {
    key: "y",
    get: function get() {
      return this.g;
    },
    set: function set(e) {
      this.g = e;
    }
  }, {
    key: "z",
    get: function get() {
      return this.b;
    },
    set: function set(e) {
      this.b = e;
    }
  }, {
    key: "w",
    get: function get() {
      return this.a;
    },
    set: function set(e) {
      this.a = e;
    }
  }]);
  return cr;
}(Le);
var On = /*#__PURE__*/function (_Jt3) {
  _inherits(On, _Jt3);
  var _super142 = _createSuper(On);
  function On(e) {
    var _this138;
    _classCallCheck(this, On);
    _this138 = _super142.call(this, "v4");
    _this138.nodeType = "Vector4";
    _this138.value = e instanceof cr ? e : new cr(e.r, e.g, e.b, e.a);
    return _this138;
  }
  _createClass(On, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("vec4(" + this.value.r + ", " + this.value.g + ", " + this.value.b + ", " + this.value.a + ")", s, r);
    }
  }]);
  return On;
}(Jt);
var VY = /^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,
  TI = /[a-z_0-9]+/gi,
  ge = /*#__PURE__*/function (_Xe2) {
    _inherits(ge, _Xe2);
    var _super143 = _createSuper(ge);
    function ge(e, r, i, s, o) {
      var _this139;
      _classCallCheck(this, ge);
      _this139 = _super143.call(this, o);
      _this139.src = "";
      _this139.nodeType = "Function";
      _this139.useKeywords = !0;
      _this139.includes = [];
      _this139.extensions = {};
      _this139.keywords = {};
      _this139.isMethod = o === void 0, _this139.isInterface = !1, _this139.parse(e, r, i, s);
      return _this139;
    }
    _createClass(ge, [{
      key: "getShared",
      value: function getShared(e, r) {
        return !this.isMethod;
      }
    }, {
      key: "getType",
      value: function getType(e) {
        return e.getTypeByFormat(this.type);
      }
    }, {
      key: "getInputByName",
      value: function getInputByName(e) {
        if (this.inputs) {
          var r = this.inputs.length;
          for (; r--;) if (this.inputs[r].name === e) return this.inputs[r];
        }
      }
    }, {
      key: "getIncludeByName",
      value: function getIncludeByName(e) {
        if (this.includes) {
          var r = this.includes.length;
          for (; r--;) if (this.includes[r].name === e) return this.includes[r];
        }
      }
    }, {
      key: "generate",
      value: function generate(e, r, i, s, o) {
        var a,
          l = 0,
          u = this.src;
        if (this.includes) for (var d = 0; d < this.includes.length; d++) e.include(this.includes[d], this);
        for (var _d43 in this.extensions) e.extensions[_d43] = !0;
        var c = [];
        for (; a = TI.exec(this.src);) c.push(a);
        for (var _d44 = 0; _d44 < c.length; _d44++) {
          var h = c[_d44],
            f = h[0],
            p = this.isMethod ? !this.getInputByName(f) : !0,
            m = f;
          if (this.keywords[f] || this.useKeywords && p && _i.containsKeyword(f)) {
            var g = this.keywords[f];
            if (!g) {
              var y = _i.getKeywordData(f);
              y.cache && (g = e.keywords[f]), g = g || _i.getKeyword(f, e), y.cache && (e.keywords[f] = g);
            }
            m = g.build(e);
          }
          f !== m && u[h.index + l - 1] !== "." && (u = u.substring(0, h.index + l) + m + u.substring(h.index + f.length + l), l += m.length - f.length), this.getIncludeByName(m) === void 0 && _i.contains(m) && e.include(_i.get(m));
        }
        return r === "source" ? u : this.isMethod ? (this.isInterface || e.include(this, void 0, u), this.name) : e.format("( " + u + " )", this.getType(e), r);
      }
    }, {
      key: "parse",
      value: function parse(e, r, i, s) {
        if (this.src = e || "", this.includes = r !== null && r !== void 0 ? r : [], this.extensions = i !== null && i !== void 0 ? i : {}, this.keywords = s !== null && s !== void 0 ? s : {}, this.isMethod) {
          var o = VY.exec(this.src);
          if (this.inputs = [], o && o.length == 4) {
            this.type = o[1], this.name = o[2];
            var a = o[3].match(TI);
            if (a) {
              var l = 0;
              for (; l < a.length;) {
                var u = a[l++],
                  c = void 0;
                u === "in" || u === "out" || u === "inout" ? c = a[l++] : (c = u, u = "");
                var d = a[l++];
                this.inputs.push({
                  name: d,
                  type: c,
                  qualifier: u
                });
              }
            }
            this.isInterface = this.src.indexOf("{") === -1;
          } else this.type = "", this.name = "";
        }
      }
    }]);
    return ge;
  }(Xe);
var UY = /^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,
  _A = /*#__PURE__*/function (_Xe3) {
    _inherits(_A, _Xe3);
    var _super144 = _createSuper(_A);
    function _A() {
      var _this140;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      var r = arguments.length > 1 ? arguments[1] : undefined;
      _classCallCheck(this, _A);
      _this140 = _super144.call(this);
      _this140.src = "";
      _this140.useDefine = !1;
      _this140.nodeType = "Const";
      _this140.parse(e || _A.PI, void 0, void 0, void 0, r);
      return _this140;
    }
    _createClass(_A, [{
      key: "getType",
      value: function getType(e) {
        return e.getTypeByFormat(this.type);
      }
    }, {
      key: "parse",
      value: function parse(e, r, i, s, o) {
        this.src = e || "";
        var a,
          l,
          u = "",
          c = UY.exec(e);
        this.useDefine = o !== null && o !== void 0 ? o : this.src.charAt(0) === "#", c && c.length > 1 ? (l = c[1], a = c[2], u = c[3]) : (a = this.src, l = "f"), this.name = a, this.type = l, this.value = u;
      }
    }, {
      key: "build",
      value: function build(e, r) {
        if (r === "source") {
          if (this.value) return this.useDefine ? "#define " + this.name + " " + this.value : "const " + this.type + " " + this.name + " = " + this.value + ";";
          if (this.useDefine) return this.src;
        }
        return e.include(this), e.format(this.name, this.getType(e), r);
      }
    }, {
      key: "generate",
      value: function generate(e, r, i, s, o) {
        return e.format(this.name, this.getType(e), r);
      }
    }]);
    return _A;
  }(Xe),
  Ft = _A;
Ft.PI = "PI", Ft.PI2 = "PI2", Ft.RECIPROCAL_PI = "RECIPROCAL_PI", Ft.RECIPROCAL_PI2 = "RECIPROCAL_PI2", Ft.LOG2 = "LOG2", Ft.EPSILON = "EPSILON";
var GY = new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}", "gim"),
  jY = new RegExp("s*(w*?)s*(w*?)(=|;)", "gim"),
  Oh = /*#__PURE__*/function (_Xe4) {
    _inherits(Oh, _Xe4);
    var _super145 = _createSuper(Oh);
    function Oh() {
      var _this141;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      _classCallCheck(this, Oh);
      _this141 = _super145.call(this);
      _this141.inputs = [];
      _this141.src = "";
      _this141.nodeType = "Struct";
      _this141.parse(e);
      return _this141;
    }
    _createClass(Oh, [{
      key: "getType",
      value: function getType(e) {
        return e.getTypeByFormat(this.name);
      }
    }, {
      key: "getInputByName",
      value: function getInputByName(e) {
        var r = this.inputs.length;
        for (; r--;) if (this.inputs[r].name === e) return this.inputs[r];
      }
    }, {
      key: "generate",
      value: function generate(e, r, i, s, o) {
        return r === "source" ? this.src + ";" : e.format("( " + this.src + " )", this.getType(e), r);
      }
    }, {
      key: "parse",
      value: function parse() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
        this.src = e, this.inputs = [];
        var r = GY.exec(e);
        if (r) {
          var i = r[2],
            s;
          for (; s = jY.exec(i);) this.inputs.push({
            type: s[1],
            name: s[2]
          });
          this.name = r[1];
        } else this.name = "";
        this.type = this.name;
      }
    }]);
    return Oh;
  }(Xe);
var Ih = /*#__PURE__*/function (_Xe5) {
  _inherits(Ih, _Xe5);
  var _super146 = _createSuper(Ih);
  function Ih(e) {
    var _this142;
    _classCallCheck(this, Ih);
    _this142 = _super146.call(this, "v2", {
      shared: !1
    });
    _this142.nodeType = "UV";
    _this142.index = e !== null && e !== void 0 ? e : 0;
    return _this142;
  }
  _createClass(Ih, [{
    key: "generate",
    value: function generate(e, r) {
      e.requires.uv[this.index] = !0;
      var i = this.index > 0 ? this.index + 1 : "",
        s = e.isShader("vertex") ? "uv" + i : "vUv" + i;
      return e.format(s, this.getType(e), r);
    }
  }]);
  return Ih;
}(Xe);
_i.addKeyword("uv", function () {
  return new Ih();
});
_i.addKeyword("uv2", function () {
  return new Ih(1);
});
var kc = /*#__PURE__*/function (_Xe6) {
    _inherits(kc, _Xe6);
    var _super147 = _createSuper(kc);
    function kc(e, r) {
      var _this143;
      _classCallCheck(this, kc);
      _this143 = _super147.call(this, "v4");
      _this143.nodeType = "ColorSpace";
      _this143.input = e, _this143.method = r !== null && r !== void 0 ? r : kc.LINEAR_TO_LINEAR, _this143.hashProperties = ["method"];
      return _this143;
    }
    _createClass(kc, [{
      key: "generate",
      value: function generate(e, r) {
        var _o$inputs;
        var i = this.input.build(e, "v4"),
          s = this.getType(e),
          o = kc.Nodes[this.method],
          a = e.include(o);
        if (a === kc.LINEAR_TO_LINEAR) return e.format(i, s, r);
        if (((_o$inputs = o.inputs) === null || _o$inputs === void 0 ? void 0 : _o$inputs.length) === 2) {
          var l = this.factor.build(e, "f");
          return e.format(a + "( " + i + ", " + l + " )", s, r);
        } else return e.format(a + "( " + i + " )", s, r);
      }
    }, {
      key: "fromEncoding",
      value: function fromEncoding(e) {
        var r = kc.getEncodingComponents(e);
        this.method = "LinearTo" + r[0], this.factor = r[1];
      }
    }, {
      key: "fromDecoding",
      value: function fromDecoding(e) {
        var r = kc.getEncodingComponents(e);
        this.method = r[0] + "ToLinear", this.factor = r[1];
      }
    }], [{
      key: "getEncodingComponents",
      value: function getEncodingComponents(e) {
        switch (e) {
          case dn:
            return ["Linear"];
          case tt:
            return ["sRGB"];
          default:
            return [];
        }
      }
    }]);
    return kc;
  }(Xe),
  vn = kc;
vn.Nodes = {
  LinearToLinear: new ge(["vec4 LinearToLinear( in vec4 value ) {", "	return value;", "}"].join("\n")),
  sRGBToLinear: new ge(["vec4 sRGBToLinear( in vec4 value ) {", "	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );", "}"].join("\n")),
  LinearTosRGB: new ge(["vec4 LinearTosRGB( in vec4 value ) {", "	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );", "}"].join("\n"))
}, vn.LINEAR_TO_LINEAR = "LinearToLinear", vn.SRGB_TO_LINEAR = "sRGBToLinear", vn.LINEAR_TO_SRGB = "LinearTosRGB";
var zt = /*#__PURE__*/function (_ge) {
  _inherits(zt, _ge);
  var _super148 = _createSuper(zt);
  function zt() {
    var _this144;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    var s = arguments.length > 3 ? arguments[3] : undefined;
    var o = arguments.length > 4 ? arguments[4] : undefined;
    _classCallCheck(this, zt);
    _this144 = _super148.call(this, e, o, s, i, r);
    _this144.nodeType = "Expression";
    return _this144;
  }
  return _createClass(zt);
}(ge);
var xn = /*#__PURE__*/function (_Jt4) {
  _inherits(xn, _Jt4);
  var _super149 = _createSuper(xn);
  function xn() {
    var _this145;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new qt();
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    var s = arguments.length > 3 ? arguments[3] : undefined;
    _classCallCheck(this, xn);
    _this145 = _super149.call(this, "v4", {
      shared: !0
    });
    _this145.nodeType = "Texture";
    _this145.value = e, _this145.uv = r !== null && r !== void 0 ? r : new Ih(), _this145.bias = i, _this145.project = s !== void 0 ? s : !1;
    return _this145;
  }
  _createClass(xn, [{
    key: "getTexture",
    value: function getTexture(e, r) {
      return _get(_getPrototypeOf(xn.prototype), "generate", this).call(this, e, r, this.value.uuid, "t");
    }
  }, {
    key: "generate",
    value: function generate(e, r) {
      var _this$colorSpace;
      if (r === "sampler2D") return this.getTexture(e, r);
      var i = this.getTexture(e, r),
        s = this.uv.build(e, this.project ? "v4" : "v2"),
        o = this.bias ? this.bias.build(e, "f") : void 0;
      o === void 0 && e.context.bias && (o = e.context.bias.setTexture(this).build(e, "f"));
      var a, l;
      this.project ? a = "texture2DProj" : a = o ? "tex2DBias" : "tex2D", o ? l = a + "( " + i + ", " + s + ", " + o + " )" : l = a + "( " + i + ", " + s + " )";
      var u = {
          include: e.isShader("vertex"),
          ignoreCache: !0
        },
        c = this.getType(e);
      return e.addContext(u), this.colorSpace = (_this$colorSpace = this.colorSpace) !== null && _this$colorSpace !== void 0 ? _this$colorSpace : new vn(new zt("", c)), this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)), this.colorSpace.input.parse(l), l = this.colorSpace.build(e, c), e.removeContext(), e.format(l, c, r);
    }
  }]);
  return xn;
}(Jt);
var Ce = /*#__PURE__*/function (_Jt5) {
  _inherits(Ce, _Jt5);
  var _super150 = _createSuper(Ce);
  function Ce(e) {
    var _this146;
    _classCallCheck(this, Ce);
    _this146 = _super150.call(this, "f");
    _this146.nodeType = "Float";
    _this146.value = e !== null && e !== void 0 ? e : 0;
    return _this146;
  }
  _createClass(Ce, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format(this.value + (this.value % 1 ? "" : ".0"), s, r);
    }
  }]);
  return Ce;
}(Jt);
var gm = /*#__PURE__*/function (_Xe7) {
  _inherits(gm, _Xe7);
  var _super151 = _createSuper(gm);
  function gm(e, r) {
    var _this147;
    _classCallCheck(this, gm);
    _this147 = _super151.call(this);
    _this147.inputs = [];
    _this147.nodeType = "FunctionCall";
    _this147.value = e, _this147.inputs = r !== null && r !== void 0 ? r : [];
    return _this147;
  }
  _createClass(gm, [{
    key: "getFunction",
    value: function getFunction() {
      return this.value;
    }
  }, {
    key: "getType",
    value: function getType(e) {
      return this.value.getType(e);
    }
  }, {
    key: "generate",
    value: function generate(e, r, i, s, o) {
      s = this.getType(e);
      var a = this.value,
        l = a.build(e, r) + "( ",
        u = [];
      if (a.inputs) {
        for (var c = 0; c < a.inputs.length; c++) {
          var d = a.inputs[c],
            h = this.inputs[c] || this.inputs[d.name];
          u.push(h.build(e, e.getTypeByFormat(d.type)));
        }
        l += u.join(", ") + " )";
      }
      return e.format(l, s, r);
    }
  }]);
  return gm;
}(Xe);
var EA = /*#__PURE__*/function (_Xe8) {
    _inherits(EA, _Xe8);
    var _super152 = _createSuper(EA);
    function EA(e, r) {
      var _this148;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : EA.ADD;
      _classCallCheck(this, EA);
      _this148 = _super152.call(this);
      _this148.nodeType = "Operator";
      _this148.type = e.type, _this148.a = e, _this148.b = r, _this148.op = i;
      return _this148;
    }
    _createClass(EA, [{
      key: "getType",
      value: function getType(e) {
        var r = this.a.getType(e),
          i = this.b.getType(e);
        return e.isTypeMatrix(r) ? "v4" : e.getTypeLength(i) > e.getTypeLength(r) ? i : r;
      }
    }, {
      key: "generate",
      value: function generate(e, r) {
        var i = this.getType(e);
        this.type = i;
        var s = this.a.build(e, i),
          o = this.b.build(e, i);
        return e.format("( " + s + " " + this.op + " " + o + " )", i, r);
      }
    }]);
    return EA;
  }(Xe),
  zi = EA;
zi.ADD = "+", zi.SUB = "-", zi.MUL = "*", zi.DIV = "/";
var $t = /*#__PURE__*/function (_Xe9) {
    _inherits($t, _Xe9);
    var _super153 = _createSuper($t);
    function $t(e) {
      var _this149;
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : $t.ABS;
      var i = arguments.length > 2 ? arguments[2] : undefined;
      var s = arguments.length > 3 ? arguments[3] : undefined;
      _classCallCheck(this, $t);
      _this149 = _super153.call(this);
      _this149.nodeType = "Math";
      _this149.a = e, typeof r != "string" ? _this149.b = r : s = r, typeof i != "string" ? _this149.c = i : s = i, _this149.method = s, _this149.hashProperties = ["method"];
      return _this149;
    }
    _createClass($t, [{
      key: "getNumInputs",
      value: function getNumInputs(e) {
        switch (this.method) {
          case $t.MIX:
          case $t.CLAMP:
          case $t.REFRACT:
          case $t.SMOOTHSTEP:
          case $t.FACEFORWARD:
            return 3;
          case $t.MIN:
          case $t.MAX:
          case $t.MOD:
          case $t.STEP:
          case $t.REFLECT:
          case $t.DISTANCE:
          case $t.DOT:
          case $t.CROSS:
          case $t.POW:
            return 2;
          default:
            return 1;
        }
      }
    }, {
      key: "getInputType",
      value: function getInputType(e) {
        var r = e.getTypeLength(this.a.getType(e)),
          i = this.b ? e.getTypeLength(this.b.getType(e)) : 0,
          s = this.c ? e.getTypeLength(this.c.getType(e)) : 0;
        return r > i && r > s ? this.a.getType(e) : i > s ? this.b.getType(e) : this.c.getType(e);
      }
    }, {
      key: "getType",
      value: function getType(e) {
        switch (this.method) {
          case $t.LENGTH:
          case $t.DISTANCE:
          case $t.DOT:
            return "f";
          case $t.CROSS:
            return "v3";
        }
        return this.getInputType(e);
      }
    }, {
      key: "generate",
      value: function generate(e, r) {
        var i,
          s,
          o,
          a = this.a ? e.getTypeLength(this.a.getType(e)) : 0,
          l = this.b ? e.getTypeLength(this.b.getType(e)) : 0,
          u = this.c ? e.getTypeLength(this.c.getType(e)) : 0,
          c = this.getInputType(e),
          d = this.getType(e);
        switch (this.type = d, this.method) {
          case $t.NEGATE:
            return e.format("( -" + this.a.build(e, c) + " )", c, r);
          case $t.INVERT:
            return e.format("( 1.0 - " + this.a.build(e, c) + " )", c, r);
          case $t.CROSS:
            i = this.a.build(e, "v3"), s = this.b.build(e, "v3");
            break;
          case $t.STEP:
            i = this.a.build(e, a === 1 ? "f" : c), s = this.b.build(e, c);
            break;
          case $t.MIN:
          case $t.MAX:
          case $t.MOD:
            i = this.a.build(e, c), s = this.b.build(e, l === 1 ? "f" : c);
            break;
          case $t.REFRACT:
            i = this.a.build(e, c), s = this.b.build(e, c), o = this.c.build(e, "f");
            break;
          case $t.MIX:
            i = this.a.build(e, c), s = this.b.build(e, c), o = this.c.build(e, u === 1 ? "f" : c);
            break;
          default:
            i = this.a.build(e, c), this.b && (s = this.b.build(e, c)), this.c && (o = this.c.build(e, c));
            break;
        }
        var h = [];
        h.push(i), s && h.push(s), o && h.push(o);
        var f = this.getNumInputs(e);
        if (h.length !== f) throw Error("Arguments not match used in \"".concat(this.method, "\". Require ").concat(f, ", currently ").concat(h.length, "."));
        return e.format(this.method + "( " + h.join(", ") + " )", d, r);
      }
    }]);
    return $t;
  }(Xe),
  lt = $t;
lt.RAD = "radians", lt.DEG = "degrees", lt.EXP = "exp", lt.EXP2 = "exp2", lt.LOG = "log", lt.LOG2 = "log2", lt.SQRT = "sqrt", lt.INV_SQRT = "inversesqrt", lt.FLOOR = "floor", lt.CEIL = "ceil", lt.NORMALIZE = "normalize", lt.FRACT = "fract", lt.SATURATE = "saturate", lt.SIN = "sin", lt.COS = "cos", lt.TAN = "tan", lt.ASIN = "asin", lt.ACOS = "acos", lt.ARCTAN = "atan", lt.ABS = "abs", lt.SIGN = "sign", lt.LENGTH = "length", lt.NEGATE = "negate", lt.INVERT = "invert", lt.MIN = "min", lt.MAX = "max", lt.MOD = "mod", lt.STEP = "step", lt.REFLECT = "reflect", lt.DISTANCE = "distance", lt.DOT = "dot", lt.CROSS = "cross", lt.POW = "pow", lt.MIX = "mix", lt.CLAMP = "clamp", lt.REFRACT = "refract", lt.SMOOTHSTEP = "smoothstep", lt.FACEFORWARD = "faceforward";
var Rh = /*#__PURE__*/function (_Xe10) {
    _inherits(Rh, _Xe10);
    var _super154 = _createSuper(Rh);
    function Rh(e, r, i) {
      var _this150;
      _classCallCheck(this, Rh);
      _this150 = _super154.call(this, "v4");
      _this150.nodeType = "TextureCubeUV";
      _this150.value = e, _this150.uv = r, _this150.bias = i;
      return _this150;
    }
    _createClass(Rh, [{
      key: "bilinearCubeUV",
      value: function bilinearCubeUV(e, r, i, s) {
        var _this$colorSpaceTL, _this$colorSpaceTR, _this$colorSpaceBL, _this$colorSpaceBR;
        var o = new gm(Rh.Nodes.bilinearCubeUV, [r, i, s]);
        this.colorSpaceTL = (_this$colorSpaceTL = this.colorSpaceTL) !== null && _this$colorSpaceTL !== void 0 ? _this$colorSpaceTL : new vn(new zt("", "v4")), this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)), this.colorSpaceTL.input.parse(o.build(e) + ".tl"), this.colorSpaceTR = (_this$colorSpaceTR = this.colorSpaceTR) !== null && _this$colorSpaceTR !== void 0 ? _this$colorSpaceTR : new vn(new zt("", "v4")), this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)), this.colorSpaceTR.input.parse(o.build(e) + ".tr"), this.colorSpaceBL = (_this$colorSpaceBL = this.colorSpaceBL) !== null && _this$colorSpaceBL !== void 0 ? _this$colorSpaceBL : new vn(new zt("", "v4")), this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)), this.colorSpaceBL.input.parse(o.build(e) + ".bl"), this.colorSpaceBR = (_this$colorSpaceBR = this.colorSpaceBR) !== null && _this$colorSpaceBR !== void 0 ? _this$colorSpaceBR : new vn(new zt("", "v4")), this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)), this.colorSpaceBR.input.parse(o.build(e) + ".br");
        var a = {
          include: e.isShader("vertex"),
          ignoreCache: !0
        };
        e.addContext(a), this.colorSpaceTLExp = new zt(this.colorSpaceTL.build(e, "v4"), "v4"), this.colorSpaceTRExp = new zt(this.colorSpaceTR.build(e, "v4"), "v4"), this.colorSpaceBLExp = new zt(this.colorSpaceBL.build(e, "v4"), "v4"), this.colorSpaceBRExp = new zt(this.colorSpaceBR.build(e, "v4"), "v4"), e.removeContext();
        var l = new zt("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )", "v4");
        return l.keywords.cubeUV_TL = this.colorSpaceTLExp, l.keywords.cubeUV_TR = this.colorSpaceTRExp, l.keywords.cubeUV_BL = this.colorSpaceBLExp, l.keywords.cubeUV_BR = this.colorSpaceBRExp, l.keywords.cubeUV = o, l;
      }
    }, {
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          var i = this.uv,
            s = this.bias || e.context.roughness,
            o = new gm(Rh.Nodes.roughnessToMip, [s]),
            a = new lt(o, Rh.Nodes.m0, Rh.Nodes.cubeUV_maxMipLevel, lt.CLAMP),
            l = new lt(a, lt.FLOOR),
            u = new lt(a, lt.FRACT),
            c = this.bilinearCubeUV(e, this.value, i, l),
            d = this.bilinearCubeUV(e, this.value, i, new zi(l, new Ce(1).setReadonly(!0), zi.ADD)),
            h = new lt(c, d, u, lt.MIX);
          return e.format(h.build(e), "v4", r);
        } else return console.warn("TextureCubeUVNode is not compatible with " + e.shader + " shader."), e.format("vec4( 0.0 )", this.getType(e), r);
      }
    }]);
    return Rh;
  }(Xe),
  Lh = Rh;
Lh.Nodes = function () {
  var e = new Oh("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),
    r = new Ft("float cubeUV_maxMipLevel 8.0", !0),
    i = new Ft("float cubeUV_minMipLevel 4.0", !0),
    s = new Ft("float cubeUV_maxTileSize 256.0", !0),
    o = new Ft("float cubeUV_minTileSize 16.0", !0),
    a = new ge("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");
  a.useKeywords = !1;
  var l = new ge("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");
  l.useKeywords = !1;
  var u = new ge("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}", [e, a, l, r, i, s, o]);
  u.useKeywords = !1;
  var c = new Ft("float r0 1.0", !0),
    d = new Ft("float v0 0.339", !0),
    h = new Ft("float m0 -2.0", !0),
    f = new Ft("float r1 0.8", !0),
    p = new Ft("float v1 0.276", !0),
    m = new Ft("float m1 -1.0", !0),
    g = new Ft("float r4 0.4", !0),
    y = new Ft("float v4 0.046", !0),
    v = new Ft("float m4 2.0", !0),
    x = new Ft("float r5 0.305", !0),
    S = new Ft("float v5 0.016", !0),
    w = new Ft("float m5 3.0", !0),
    A = new Ft("float r6 0.21", !0),
    E = new Ft("float v6 0.0038", !0),
    b = new Ft("float m6 4.0", !0),
    T = [c, d, h, f, p, m, g, y, v, x, S, w, A, E, b],
    M = new ge("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}", T);
  return {
    bilinearCubeUV: u,
    roughnessToMip: M,
    m0: h,
    cubeUV_maxMipLevel: r
  };
}();
var zc = /*#__PURE__*/function (_Xe11) {
    _inherits(zc, _Xe11);
    var _super155 = _createSuper(zc);
    function zc(e) {
      var _this151;
      _classCallCheck(this, zc);
      _this151 = _super155.call(this, "v3");
      _this151.nodeType = "Normal";
      _this151.scope = e !== null && e !== void 0 ? e : zc.VIEW;
      return _this151;
    }
    _createClass(zc, [{
      key: "getShared",
      value: function getShared() {
        return this.scope === zc.WORLD;
      }
    }, {
      key: "build",
      value: function build(e, r, i, s) {
        var o = e.context[this.scope + "Normal"];
        return o ? o.build(e, r, i, s) : _get(_getPrototypeOf(zc.prototype), "build", this).call(this, e, r, i);
      }
    }, {
      key: "generate",
      value: function generate(e, r, i, s, o) {
        var a;
        switch (this.scope) {
          case zc.VIEW:
            e.isShader("vertex") ? a = "transformedNormal" : a = "geometryNormal";
            break;
          case zc.LOCAL:
            e.isShader("vertex") ? a = "objectNormal" : (e.requires.normal = !0, a = "vObjectNormal");
            break;
          case zc.WORLD:
            e.isShader("vertex") ? a = "inverseTransformDirection( transformedNormal, viewMatrix ).xyz" : (e.requires.worldNormal = !0, a = "vWNormal");
            break;
        }
        return e.format(a, this.getType(e), r);
      }
    }]);
    return zc;
  }(Xe),
  Vi = zc;
Vi.LOCAL = "local", Vi.WORLD = "world", Vi.VIEW = "view", Vi.NORMAL = "normal";
_i.addKeyword("viewNormal", function () {
  return new Vi(Vi.VIEW);
});
_i.addKeyword("localNormal", function () {
  return new Vi(Vi.NORMAL);
});
_i.addKeyword("worldNormal", function () {
  return new Vi(Vi.WORLD);
});
var Po = /*#__PURE__*/function (_Xe12) {
    _inherits(Po, _Xe12);
    var _super156 = _createSuper(Po);
    function Po(e) {
      var _this152;
      _classCallCheck(this, Po);
      _this152 = _super156.call(this, "v3");
      _this152.nodeType = "Position";
      _this152.scope = e !== null && e !== void 0 ? e : Po.LOCAL;
      return _this152;
    }
    _createClass(Po, [{
      key: "getType",
      value: function getType() {
        switch (this.scope) {
          case Po.PROJECTION:
            return "v4";
        }
        return this.type;
      }
    }, {
      key: "getShader",
      value: function getShader() {
        switch (this.scope) {
          case Po.LOCAL:
          case Po.WORLD:
            return !1;
        }
        return !0;
      }
    }, {
      key: "generate",
      value: function generate(e, r, i, s, o) {
        var a;
        switch (this.scope) {
          case Po.LOCAL:
            e.isShader("vertex") ? a = "transformed" : (e.requires.position = !0, a = "vPosition");
            break;
          case Po.WORLD:
            if (e.isShader("vertex")) return "( modelMatrix * vec4( transformed, 1.0 ) ).xyz";
            e.requires.worldPosition = !0, a = "vWPosition";
            break;
          case Po.VIEW:
            a = e.isShader("vertex") ? "-mvPosition.xyz" : "vViewPosition";
            break;
          case Po.PROJECTION:
            a = e.isShader("vertex") ? "( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )" : "vec4( 0.0 )";
            break;
        }
        return e.format(a, this.getType(), r);
      }
    }]);
    return Po;
  }(Xe),
  In = Po;
In.LOCAL = "local", In.WORLD = "world", In.VIEW = "view", In.PROJECTION = "projection";
_i.addKeyword("position", function () {
  return new In();
});
_i.addKeyword("worldPosition", function () {
  return new In(In.WORLD);
});
_i.addKeyword("viewPosition", function () {
  return new In(In.VIEW);
});
var Ws = /*#__PURE__*/function (_Xe13) {
    _inherits(Ws, _Xe13);
    var _super157 = _createSuper(Ws);
    function Ws(e) {
      var _this153;
      _classCallCheck(this, Ws);
      _this153 = _super157.call(this, "v3");
      _this153.nodeType = "Reflect";
      _this153.scope = e !== null && e !== void 0 ? e : Ws.CUBE;
      return _this153;
    }
    _createClass(Ws, [{
      key: "getUnique",
      value: function getUnique(e) {
        return !e.context.viewNormal;
      }
    }, {
      key: "getType",
      value: function getType() {
        switch (this.scope) {
          case Ws.SPHERE:
            return "v2";
        }
        return this.type;
      }
    }, {
      key: "generate",
      value: function generate(e, r) {
        var i = this.getUnique(e);
        if (e.isShader("fragment")) {
          var s;
          switch (this.scope) {
            case Ws.VECTOR:
              {
                var o = new Vi(Vi.VIEW),
                  a = e.context.roughness,
                  l = o.build(e, "v3"),
                  u = new In(In.VIEW).build(e, "v3"),
                  c = a ? a.build(e, "f") : void 0,
                  d = "reflect( -normalize( ".concat(u, " ), ").concat(l, " )");
                c && (d = "normalize( mix( ".concat(d, ", ").concat(l, ", ").concat(c, " * ").concat(c, " ) )"));
                var h = "inverseTransformDirection( ".concat(d, ", viewMatrix )");
                i ? (e.addNodeCode("vec3 reflectVec = ".concat(h, ";")), s = "reflectVec") : s = h;
                break;
              }
            case Ws.CUBE:
              {
                var _o27 = new Ws(Ws.VECTOR).build(e, "v3"),
                  _a28 = "vec3( -" + _o27 + ".x, " + _o27 + ".yz )";
                i ? (e.addNodeCode("vec3 reflectCubeVec = ".concat(_a28, ";")), s = "reflectCubeVec") : s = _a28;
                break;
              }
            case Ws.SPHERE:
              {
                var _a29 = "normalize( ( viewMatrix * vec4( " + new Ws(Ws.VECTOR).build(e, "v3") + ", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";
                i ? (e.addNodeCode("vec2 reflectSphereVec = ".concat(_a29, ";")), s = "reflectSphereVec") : s = _a29;
                break;
              }
          }
          return e.format(s, this.getType(), r);
        } else return console.warn("ReflectNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.type, r);
      }
    }]);
    return Ws;
  }(Xe),
  Do = Ws;
Do.CUBE = "cube", Do.SPHERE = "sphere", Do.VECTOR = "vector";
var B0 = /*#__PURE__*/function (_Xe14) {
  _inherits(B0, _Xe14);
  var _super158 = _createSuper(B0);
  function B0() {
    var _this154;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new xn();
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    _classCallCheck(this, B0);
    _this154 = _super158.call(this, "v4");
    _this154.nodeType = "TextureCube";
    _this154.value = e, _this154.radianceNode = new Lh(_this154.value, r !== null && r !== void 0 ? r : new Do(Do.VECTOR), i), _this154.irradianceNode = new Lh(_this154.value, new Vi(Vi.WORLD), new Ce(1).setReadonly(!0));
    return _this154;
  }
  _createClass(B0, [{
    key: "generate",
    value: function generate(e, r) {
      return e.isShader("fragment") ? (e.require("irradiance"), e.context.bias && e.context.bias.setTexture(this.value), (e.slot === "irradiance" ? this.irradianceNode : this.radianceNode).build(e, r)) : (console.warn("TextureCubeNode is not compatible with " + e.shader + " shader."), e.format("vec4( 0.0 )", this.getType(e), r));
    }
  }]);
  return B0;
}(Xe);
var N0 = /*#__PURE__*/function (_Jt6) {
  _inherits(N0, _Jt6);
  var _super159 = _createSuper(N0);
  function N0() {
    var _this155;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Du();
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    _classCallCheck(this, N0);
    _this155 = _super159.call(this, "v4", {
      shared: !0
    });
    _this155.nodeType = "CubeTexture";
    _this155.value = e, _this155.uv = r !== null && r !== void 0 ? r : new Do(), _this155.bias = i;
    return _this155;
  }
  _createClass(N0, [{
    key: "getTexture",
    value: function getTexture(e, r) {
      return _get(_getPrototypeOf(N0.prototype), "generate", this).call(this, e, r, this.value.uuid, "tc");
    }
  }, {
    key: "generate",
    value: function generate(e, r) {
      var _this$uv, _this$colorSpace2;
      if (r === "samplerCube") return this.getTexture(e, r);
      var i = this.getTexture(e, r),
        s = (_this$uv = this.uv) === null || _this$uv === void 0 ? void 0 : _this$uv.build(e, "v3"),
        o = this.bias ? this.bias.build(e, "f") : void 0;
      o === void 0 && e.context.bias && (o = e.context.bias.setTexture(this).build(e, "f"));
      var a;
      o ? a = "texCubeBias( " + i + ", " + s + ", " + o + " )" : a = "texCube( " + i + ", " + s + " )";
      var l = {
          include: e.isShader("vertex"),
          ignoreCache: !0
        },
        u = this.getType(e);
      return e.addContext(l), this.colorSpace = (_this$colorSpace2 = this.colorSpace) !== null && _this$colorSpace2 !== void 0 ? _this$colorSpace2 : new vn(new zt("", u)), this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)), this.colorSpace.input.parse(a), a = this.colorSpace.build(e, u), e.removeContext(), e.format(a, u, r);
    }
  }]);
  return N0;
}(Jt);
var MI = "\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n",
  CI = "\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n",
  PI = "\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n",
  DI = "\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n",
  OI = "\nlayout(location = 1) out vec4 gVelocity;\n",
  II = "\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n";
var RI = ["x", "y", "z", "w"],
  HY = ["float", "vec2", "vec3", "vec4"],
  WY = {
    float: "f",
    vec2: "v2",
    vec3: "v3",
    vec4: "v4",
    mat4: "v4",
    int: "i",
    bool: "b",
    "float[]": "f[]",
    "vec4[]": "v4[]"
  },
  qY = {
    t: "sampler2D",
    tc: "samplerCube",
    b: "bool",
    i: "int",
    f: "float",
    c: "vec3",
    v2: "vec2",
    v3: "vec3",
    v4: "vec4",
    m3: "mat3",
    m4: "mat4",
    "f[]": "float[]",
    "v4[]": "vec4[]"
  },
  Bh = /*#__PURE__*/function () {
    function Bh() {
      _classCallCheck(this, Bh);
      this.includes = {
        consts: {},
        functions: {},
        structs: {}
      };
      this.cache = "";
      this.slot = "";
      this.shader = "";
      this.context = {};
      this.needsJitter = !0;
      this.getIncludesCode = function () {
        function t(e, r) {
          return e.deps.length - r.deps.length;
        }
        return function (r, i) {
          var s = this.getIncludes(r, i);
          if (!s) return "";
          var o = "";
          s = s.sort(t);
          for (var a = 0; a < s.length; a++) s[a].src && (o += s[a].src + "\n");
          return o;
        };
      }();
      this.slots = [], this.caches = [], this.contexts = [], this.keywords = {}, this.nodeData = {}, this.fragmentVariables = {}, this.fragmentParsVariables = {}, this.vertexParsVariables = {}, this.requires = {
        uv: [],
        color: [],
        transparent: !1,
        irradiance: !1,
        position: !1,
        worldPosition: !1,
        normal: !1,
        worldNormal: !1,
        vWorldViewDir: !1,
        modelMatrix: !1,
        viewMatrix: !1,
        projectionMatrix: !1
      }, this.includes = {
        consts: [],
        functions: [],
        structs: []
      }, this.attributes = {}, this.prefixCode = ["#ifdef TEXTURE_LOD_EXT", "	#define texCube(a, b) textureCube(a, b)", "	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)", "	#define tex2D(a, b) texture2D(a, b)", "	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)", "#else", "	#define texCube(a, b) textureCube(a, b)", "	#define texCubeBias(a, b, c) textureCube(a, b, c)", "	#define tex2D(a, b) texture2D(a, b)", "	#define tex2DBias(a, b, c) texture2D(a, b, c)", "#endif", "\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t", "#include <packing>", "#include <common>"].join("\n"), this.parsCode = {
        vertex: ["float neighbor_offset = 0.0001;", ""].join("\n"),
        fragment: ["float accumAlpha = 0.0;", "void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}", ""].join("\n")
      }, this.code = {
        vertex: "",
        fragment: ""
      }, this.nodeCode = {
        vertex: "",
        fragment: ""
      }, this.resultCode = {
        vertex: "",
        fragment: ""
      }, this.finalCode = {
        vertex: "",
        fragment: ""
      }, this.inputs = {
        uniforms: {
          list: [],
          vertex: [],
          fragment: []
        },
        arrayUniforms: {
          list: [],
          vertex: [],
          fragment: []
        },
        vars: {
          varying: [],
          vertex: [],
          fragment: []
        }
      }, this.defines = {}, this.uniforms = {}, this.extensions = {
        derivatives: !1,
        fragDepth: !1,
        drawBuffers: !1,
        shaderTextureLOD: !1
      }, this.updaters = [], this.nodes = [], this.analyzing = !1;
    }
    _createClass(Bh, [{
      key: "build",
      value: function build(t, e) {
        this.addVertexParsCode(MI), this.addFragmentParsCode(CI), this.buildShader("vertex", t), this.buildShader("fragment", e);
        for (var r = 0; r < this.requires.uv.length; r++) if (this.requires.uv[r]) {
          var i = r > 0 ? r + 1 : "";
          this.addVaryCode("varying vec2 vUv" + i + ";"), r > 0 && this.addVertexParsCode("attribute vec2 uv" + i + ";"), this.addVertexFinalCode("vUv" + i + " = uv" + i + ";");
        }
        return this.requires.color[0] && (this.addVaryCode("varying vec4 vColor;"), this.addVertexParsCode("attribute vec4 color;"), this.addVertexFinalCode("vColor = color;")), this.requires.color[1] && (this.addVaryCode("varying vec4 vColor2;"), this.addVertexParsCode("attribute vec4 color2;"), this.addVertexFinalCode("vColor2 = color2;")), this.requires.position && (this.addVaryCode("varying vec3 vPosition;"), this.addVertexFinalCode("vPosition = transformed;")), this.requires.worldPosition, this.requires.normal && (this.addVaryCode("varying vec3 vObjectNormal;"), this.addVertexFinalCode("vObjectNormal = normal;")), this.requires.modelMatrix && this.addFragmentParsCode("uniform mat4 modelMatrix;"), this.requires.viewMatrix && this.addFragmentParsCode("uniform mat4 viewMatrix;"), this.requires.projectionMatrix && this.addFragmentParsCode("uniform mat4 projectionMatrix;"), this.requires.worldNormal && (this.addVaryCode("varying vec3 vWNormal;"), this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")), this.requires.vWorldViewDir && (this.addVaryCode("varying vec3 vWorldViewDir;"), this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")), this.needsJitter && (this.addVertexFinalCode(PI), this.addFragmentFinalCode(DI)), this;
      }
    }, {
      key: "buildShader",
      value: function buildShader(t, e) {
        this.resultCode[t] = e.build(this.setShader(t), "v4");
      }
    }, {
      key: "setMaterial",
      value: function setMaterial(t, e) {
        return this.defines = {}, this;
      }
    }, {
      key: "addFlow",
      value: function addFlow(t, e, r) {
        return this.addSlot(t).addCache(e).addContext(r);
      }
    }, {
      key: "removeFlow",
      value: function removeFlow() {
        return this.removeSlot().removeCache().removeContext();
      }
    }, {
      key: "addCache",
      value: function addCache(t) {
        return this.cache = t !== null && t !== void 0 ? t : "", this.caches.push(this.cache), this;
      }
    }, {
      key: "removeCache",
      value: function removeCache() {
        return this.caches.pop(), this.cache = this.caches[this.caches.length - 1] || "", this;
      }
    }, {
      key: "addContext",
      value: function addContext(t) {
        return this.context = Object.assign({}, this.context, t), this.context.extra = this.context.extra || {}, this.contexts.push(this.context), this;
      }
    }, {
      key: "removeContext",
      value: function removeContext() {
        return this.contexts.pop(), this.context = this.contexts[this.contexts.length - 1] || {}, this;
      }
    }, {
      key: "addSlot",
      value: function addSlot(t) {
        return this.slot = t || "", this.slots.push(this.slot), this;
      }
    }, {
      key: "removeSlot",
      value: function removeSlot() {
        return this.slots.pop(), this.slot = this.slots[this.slots.length - 1] || "", this;
      }
    }, {
      key: "addFragmentVariable",
      value: function addFragmentVariable(t, e) {
        this.fragmentVariables[t] === void 0 && (this.addFragmentCode("".concat(e, " ").concat(t, ";")), this.fragmentVariables[t] = "");
      }
    }, {
      key: "addFragmentParsVariable",
      value: function addFragmentParsVariable(t, e) {
        this.fragmentParsVariables[t] === void 0 && (this.addFragmentParsCode("".concat(e, " ").concat(t, ";")), this.fragmentParsVariables[t] = "");
      }
    }, {
      key: "addVertexParsVariable",
      value: function addVertexParsVariable(t, e) {
        this.vertexParsVariables[t] === void 0 && (this.addVertexParsCode("".concat(e, " ").concat(t, ";")), this.vertexParsVariables[t] = "");
      }
    }, {
      key: "addVertexCode",
      value: function addVertexCode(t) {
        this.addCode(t, "vertex");
      }
    }, {
      key: "addFragmentCode",
      value: function addFragmentCode(t) {
        this.addCode(t, "fragment");
      }
    }, {
      key: "addCode",
      value: function addCode(t, e) {
        this.code[e !== null && e !== void 0 ? e : this.shader] += t + "\n";
      }
    }, {
      key: "addVertexNodeCode",
      value: function addVertexNodeCode(t) {
        this.addNodeCode(t, "vertex");
      }
    }, {
      key: "addFragmentNodeCode",
      value: function addFragmentNodeCode(t) {
        this.addNodeCode(t, "fragment");
      }
    }, {
      key: "addNodeCode",
      value: function addNodeCode(t, e) {
        this.nodeCode[e !== null && e !== void 0 ? e : this.shader] += t + "\n";
      }
    }, {
      key: "clearNodeCode",
      value: function clearNodeCode(t) {
        var _t26;
        t = (_t26 = t) !== null && _t26 !== void 0 ? _t26 : this.shader;
        var e = this.nodeCode[t];
        return this.nodeCode[t] = "", e;
      }
    }, {
      key: "clearVertexNodeCode",
      value: function clearVertexNodeCode() {
        return this.clearNodeCode("vertex");
      }
    }, {
      key: "clearFragmentNodeCode",
      value: function clearFragmentNodeCode() {
        return this.clearNodeCode("fragment");
      }
    }, {
      key: "addVertexFinalCode",
      value: function addVertexFinalCode(t) {
        this.addFinalCode(t, "vertex");
      }
    }, {
      key: "addFragmentFinalCode",
      value: function addFragmentFinalCode(t) {
        this.addFinalCode(t, "fragment");
      }
    }, {
      key: "addFinalCode",
      value: function addFinalCode(t, e) {
        this.finalCode[e !== null && e !== void 0 ? e : this.shader] += t + "\n";
      }
    }, {
      key: "addVertexParsCode",
      value: function addVertexParsCode(t) {
        this.addParsCode(t, "vertex");
      }
    }, {
      key: "addFragmentParsCode",
      value: function addFragmentParsCode(t) {
        this.addParsCode(t, "fragment");
      }
    }, {
      key: "addParsCode",
      value: function addParsCode(t, e) {
        this.parsCode[e !== null && e !== void 0 ? e : this.shader] += t + "\n";
      }
    }, {
      key: "addVaryCode",
      value: function addVaryCode(t) {
        this.addVertexParsCode(t), this.addFragmentParsCode(t);
      }
    }, {
      key: "isCache",
      value: function isCache(t) {
        return this.caches.indexOf(t) !== -1;
      }
    }, {
      key: "isSlot",
      value: function isSlot(t) {
        return this.slots.indexOf(t) !== -1;
      }
    }, {
      key: "define",
      value: function define(t, e) {
        this.defines[t] = e === void 0 ? 1 : e;
      }
    }, {
      key: "require",
      value: function require(t) {
        this.requires[t] = !0;
      }
    }, {
      key: "isDefined",
      value: function isDefined(t) {
        return this.defines[t] !== void 0;
      }
    }, {
      key: "getVar",
      value: function getVar(t, e, r) {
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "varying";
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : "V";
        var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : "";
        var a = this.getVars(i),
          l = a[t];
        if (!l) {
          var u = a.length;
          l = {
            name: r || "node" + s + u + (o ? "_" + o : ""),
            type: e
          }, a.push(l), a[t] = l;
        }
        return l;
      }
    }, {
      key: "getTempVar",
      value: function getTempVar(t, e, r, i) {
        return this.getVar(t, e, r, this.shader, "T", i);
      }
    }, {
      key: "getAttribute",
      value: function getAttribute(t, e) {
        if (!this.attributes[t]) {
          var r = this.getVar(t, e);
          this.addVertexParsCode("attribute " + e + " " + t + ";"), this.addVertexFinalCode(r.name + " = " + t + ";"), this.attributes[t] = {
            varying: r,
            name: t,
            type: e
          };
        }
        return this.attributes[t];
      }
    }, {
      key: "getCode",
      value: function getCode(t) {
        return [this.prefixCode, this.parsCode[t], this.getVarListCode(this.getVars("varying"), "varying"), this.getVarListCode(this.inputs.uniforms[t], "uniform"), this.getVarListCode(this.inputs.arrayUniforms[t], "uniform"), this.getIncludesCode("consts", t), this.getIncludesCode("structs", t), this.getIncludesCode("functions", t), "void main() {", this.getVarListCode(this.getVars(t)), this.code[t], this.resultCode[t], this.finalCode[t], "}"].join("\n");
      }
    }, {
      key: "getVarListCode",
      value: function getVarListCode(t, e) {
        var _e54;
        e = (_e54 = e) !== null && _e54 !== void 0 ? _e54 : "";
        var r = "";
        for (var i = 0, s = t.length; i < s; ++i) {
          var o = t[i],
            a = o.type,
            l = o.name,
            u = o.size,
            c = this.getFormatByType(a);
          if (c === void 0) throw new Error("Node pars " + c + " not found.");
          c.includes("[]") ? r += e + " " + c.substring(0, c.length - 2) + " " + l + "[".concat(u, "];\n") : r += e + " " + c + " " + l + ";\n";
        }
        return r;
      }
    }, {
      key: "getVars",
      value: function getVars(t) {
        return this.inputs.vars[t !== null && t !== void 0 ? t : this.shader];
      }
    }, {
      key: "getNodeData",
      value: function getNodeData(t) {
        var e = t instanceof ki ? t.uuid : t;
        return this.nodeData[e] = this.nodeData[e] || {};
      }
    }, {
      key: "createUniform",
      value: function createUniform(t, e, r, i, s, o) {
        if (e.includes("[]")) {
          var a = this.inputs.arrayUniforms,
            l = a.list.length,
            u = new mm({
              type: e,
              size: r.size,
              name: i || "nodeUA" + l + (o ? "_" + o : ""),
              node: r,
              needsUpdate: s
            });
          return a.list.push(u), a[t].push(u), a[t][u.name] = u, this.uniforms[u.name] = u, u;
        } else {
          var _a30 = this.inputs.uniforms,
            _l59 = _a30.list.length,
            _u37 = new mm({
              type: e,
              name: i || "nodeU" + _l59 + (o ? "_" + o : ""),
              node: r,
              needsUpdate: s
            });
          return _a30.list.push(_u37), _a30[t].push(_u37), _a30[t][_u37.name] = _u37, this.uniforms[_u37.name] = _u37, _u37;
        }
      }
    }, {
      key: "createVertexUniform",
      value: function createVertexUniform(t, e, r, i, s) {
        return this.createUniform("vertex", t, e, r, i, s);
      }
    }, {
      key: "createFragmentUniform",
      value: function createFragmentUniform(t, e, r, i, s) {
        return this.createUniform("fragment", t, e, r, i, s);
      }
    }, {
      key: "include",
      value: function include(t, e, r) {
        var i;
        if (t = typeof t == "string" ? _i.get(t) : t, this.context.include === !1) return t.name;
        t instanceof ge ? i = this.includes.functions : t instanceof Ft ? i = this.includes.consts : t instanceof Oh && (i = this.includes.structs);
        var s = i[this.shader] = i[this.shader] || [];
        if (t) {
          var _t$includes;
          var o = s[t.name];
          if (o || (o = s[t.name] = {
            node: t,
            deps: []
          }, s.push(o), o.src = t.build(this, "source")), t instanceof ge && e && s[e.name] && s[e.name].deps.indexOf(t) === -1 && (s[e.name].deps.push(t), (_t$includes = t.includes) !== null && _t$includes !== void 0 && _t$includes.length)) {
            var a = 0;
            do this.include(t.includes[a++], e); while (a < t.includes.length);
          }
          return r && (o.src = r), t.name;
        } else throw new Error("Include not found.");
      }
    }, {
      key: "colorToVectorProperties",
      value: function colorToVectorProperties(t) {
        return t.replace("r", "x").replace("g", "y").replace("b", "z").replace("a", "w");
      }
    }, {
      key: "colorToVector",
      value: function colorToVector(t) {
        return t.replace(/c/g, "v3");
      }
    }, {
      key: "getIncludes",
      value: function getIncludes(t, e) {
        return this.includes[t][e || this.shader];
      }
    }, {
      key: "getConstructorFromLength",
      value: function getConstructorFromLength(t) {
        return HY[t - 1];
      }
    }, {
      key: "isTypeMatrix",
      value: function isTypeMatrix(t) {
        return /^m/.test(t);
      }
    }, {
      key: "getTypeLength",
      value: function getTypeLength(t) {
        return t === "f" ? 1 : parseInt(this.colorToVector(t).substr(1));
      }
    }, {
      key: "getTypeFromLength",
      value: function getTypeFromLength(t) {
        return t === 1 ? "f" : "v" + t;
      }
    }, {
      key: "findNode",
      value: function findNode() {
        for (var _len5 = arguments.length, t = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
          t[_key5] = arguments[_key5];
        }
        for (var e = 0; e < arguments.length; e++) {
          var r = t[e];
          if (r !== null && r !== void 0 && r.isNode) return r;
        }
      }
    }, {
      key: "resolve",
      value: function resolve() {
        for (var _len6 = arguments.length, t = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {
          t[_key6] = arguments[_key6];
        }
        for (var e = 0; e < arguments.length; e++) {
          var r = t[e];
          if (r !== void 0) {
            if (r.isNode) return r;
            if (r.isTexture) switch (r.mapping) {
              case Xa:
              case Qa:
                return new N0(r);
              case Qu:
                return new B0(new xn(r));
              default:
                return new xn(r);
            } else {
              if (r.isVector2) return new Lr(r);
              if (r.isVector3) return new Xi(r);
              if (r.isVector4) return new On(r);
            }
          }
        }
      }
    }, {
      key: "format",
      value: function format(t, e, r) {
        switch (this.colorToVector(r + " <- " + e)) {
          case "f <- v2":
            return t + ".x";
          case "f <- v3":
            return t + ".x";
          case "f <- v4":
            return t + ".x";
          case "f <- i":
          case "f <- b":
            return "float( " + t + " )";
          case "v2 <- f":
            return "vec2( " + t + " )";
          case "v2 <- v3":
            return t + ".xy";
          case "v2 <- v4":
            return t + ".xy";
          case "v2 <- i":
          case "v2 <- b":
            return "vec2( float( " + t + " ) )";
          case "v3 <- f":
            return "vec3( " + t + " )";
          case "v3 <- v2":
            return "vec3( " + t + ", 0.0 )";
          case "v3 <- v4":
            return t + ".xyz";
          case "v3 <- i":
          case "v3 <- b":
            return "vec2( float( " + t + " ) )";
          case "v4 <- f":
            return "vec4( " + t + " )";
          case "v4 <- v2":
            return "vec4( " + t + ", 0.0, 1.0 )";
          case "v4 <- v3":
            return "vec4( " + t + ", 1.0 )";
          case "v4 <- i":
          case "v4 <- b":
            return "vec4( float( " + t + " ) )";
          case "i <- f":
          case "i <- b":
            return "int( " + t + " )";
          case "i <- v2":
            return "int( " + t + ".x )";
          case "i <- v3":
            return "int( " + t + ".x )";
          case "i <- v4":
            return "int( " + t + ".x )";
          case "b <- f":
            return "( " + t + " != 0.0 )";
          case "b <- v2":
            return "( " + t + " != vec2( 0.0 ) )";
          case "b <- v3":
            return "( " + t + " != vec3( 0.0 ) )";
          case "b <- v4":
            return "( " + t + " != vec4( 0.0 ) )";
          case "b <- i":
            return "( " + t + " != 0 )";
        }
        return t;
      }
    }, {
      key: "getTypeByFormat",
      value: function getTypeByFormat(t) {
        return WY[t] || t;
      }
    }, {
      key: "getFormatByType",
      value: function getFormatByType(t) {
        return qY[t] || t;
      }
    }, {
      key: "getUUID",
      value: function getUUID(t, e) {
        return e = e !== void 0 ? e : !0, e && this.cache && (t = this.cache + "-" + t), t;
      }
    }, {
      key: "getElementByIndex",
      value: function getElementByIndex(t) {
        return RI[t];
      }
    }, {
      key: "getIndexByElement",
      value: function getIndexByElement(t) {
        return RI.indexOf(t);
      }
    }, {
      key: "isShader",
      value: function isShader(t) {
        return this.shader === t;
      }
    }, {
      key: "setShader",
      value: function setShader(t) {
        return this.shader = t, this;
      }
    }, {
      key: "mergeDefines",
      value: function mergeDefines(t) {
        for (var e in t) this.defines[e] = t[e];
        return this.defines;
      }
    }, {
      key: "mergeUniform",
      value: function mergeUniform(t) {
        for (var e in t) this.uniforms[e] = t[e];
        return this.uniforms;
      }
    }, {
      key: "getTextureEncodingFromMap",
      value: function getTextureEncodingFromMap(t) {
        var e;
        return t ? t.isTexture && (e = t.encoding) : e = dn, e === dn && this.context.gamma && (e = tt), e;
      }
    }]);
    return Bh;
  }();
var Yt = /*#__PURE__*/function (_Jt7) {
  _inherits(Yt, _Jt7);
  var _super160 = _createSuper(Yt);
  function Yt() {
    var _this156;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var r = arguments.length > 1 ? arguments[1] : undefined;
    var i = arguments.length > 2 ? arguments[2] : undefined;
    var s = arguments.length > 3 ? arguments[3] : undefined;
    _classCallCheck(this, Yt);
    _this156 = _super160.call(this, "c");
    _this156.nodeType = "Color";
    _this156.value = e instanceof cr ? e : new cr(e || 0, r, i, s);
    return _this156;
  }
  _createClass(Yt, [{
    key: "setRGBA",
    value: function setRGBA(e) {
      this.value.setRGBA(e.r, e.g, e.b, e.a);
    }
  }, {
    key: "generate",
    value: function generate(e, r, i, s, o, a) {
      var _i64, _s28;
      i = e.getUUID((_i64 = i) !== null && _i64 !== void 0 ? _i64 : this.getUUID()), s = (_s28 = s) !== null && _s28 !== void 0 ? _s28 : this.getType(e);
      var l = e.getNodeData(i),
        u = this.getReadonly() && this.generateReadonly !== void 0;
      if (this.alpha) {
        var c = this.alpha.build(e, "f");
        e.addFragmentNodeCode("accumAlpha += ( 1.0 - accumAlpha ) * ".concat(c, ";"));
      }
      return u ? this.generateReadonly(e, r, i, s, o, a) : e.isShader("vertex") ? (l.vertex || (l.vertex = e.createVertexUniform(s, this, o, a, this.getLabel())), e.format(l.vertex.name, s, r)) : (l.fragment || (l.fragment = e.createFragmentUniform(s, this, o, a, this.getLabel())), e.format(l.fragment.name, s, r));
    }
  }, {
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("vec3(" + this.value.r + ", " + this.value.g + ", " + this.value.b + ")", s, r);
    }
  }]);
  return Yt;
}(Jt);
var xt = /*#__PURE__*/function (_Jt8) {
  _inherits(xt, _Jt8);
  var _super161 = _createSuper(xt);
  function xt(e) {
    var _this157;
    _classCallCheck(this, xt);
    _this157 = _super161.call(this, "i");
    _this157.nodeType = "Int";
    _this157.value = Math.floor(e !== null && e !== void 0 ? e : 0);
    return _this157;
  }
  _createClass(xt, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format(this.value.toString(), s, r);
    }
  }]);
  return xt;
}(Jt);
var Vr = /*#__PURE__*/function (_Jt9) {
  _inherits(Vr, _Jt9);
  var _super162 = _createSuper(Vr);
  function Vr(e) {
    var _this158;
    _classCallCheck(this, Vr);
    _this158 = _super162.call(this, "b");
    _this158.nodeType = "Bool";
    _this158.value = e !== null && e !== void 0 ? e : !1;
    return _this158;
  }
  _createClass(Vr, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s) {
      return e.format(this.value ? "true" : "false", s, r);
    }
  }]);
  return Vr;
}(Jt);
var qs = /*#__PURE__*/function (_Jt10) {
  _inherits(qs, _Jt10);
  var _super163 = _createSuper(qs);
  function qs() {
    var _this159;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var r = arguments.length > 1 ? arguments[1] : undefined;
    _classCallCheck(this, qs);
    _this159 = _super163.call(this, "f[]");
    _this159.nodeType = "FloatArray";
    _this159.size = e, _this159.value = Array.isArray(r) ? r : typeof r == "number" ? new Array(e).fill(r) : new Array(e).fill(0);
    return _this159;
  }
  return _createClass(qs);
}(Jt);
var Rl = /*#__PURE__*/function (_Jt11) {
  _inherits(Rl, _Jt11);
  var _super164 = _createSuper(Rl);
  function Rl() {
    _classCallCheck(this, Rl);
    return _super164.apply(this, arguments);
  }
  return _createClass(Rl);
}(Jt);
var F0 = /*#__PURE__*/function (_Rl) {
  _inherits(F0, _Rl);
  var _super165 = _createSuper(F0);
  function F0(e) {
    var _this160;
    _classCallCheck(this, F0);
    _this160 = _super165.call(this, "v3");
    _this160.image = e;
    _this160._value = new _();
    return _this160;
  }
  _createClass(F0, [{
    key: "value",
    get: function get() {
      var _this$image$img$video, _this$image$img$video2;
      return this._value.x = this.image.isVideo ? (_this$image$img$video = this.image.img.videoWidth) !== null && _this$image$img$video !== void 0 ? _this$image$img$video : 0 : this.image.img.width, this._value.y = this.image.isVideo ? (_this$image$img$video2 = this.image.img.videoHeight) !== null && _this$image$img$video2 !== void 0 ? _this$image$img$video2 : 0 : this.image.img.height, this._value;
    }
  }]);
  return F0;
}(Rl);
var Vc = /*#__PURE__*/function (_Rl2) {
  _inherits(Vc, _Rl2);
  var _super166 = _createSuper(Vc);
  function Vc(e, r) {
    var _this161;
    _classCallCheck(this, Vc);
    _this161 = _super166.call(this, "t");
    _this161.image = e;
    _this161.wrap = r;
    return _this161;
  }
  _createClass(Vc, [{
    key: "value",
    get: function get() {
      return this.image.getTexture(this.wrap);
    }
  }]);
  return Vc;
}(Rl);
var Nh = /*#__PURE__*/function (_Jt12) {
  _inherits(Nh, _Jt12);
  var _super167 = _createSuper(Nh);
  function Nh(e) {
    var _this162;
    _classCallCheck(this, Nh);
    _this162 = _super167.call(this, "m3");
    _this162.nodeType = "Matrix3";
    _this162.value = e !== null && e !== void 0 ? e : new Qt();
    return _this162;
  }
  _createClass(Nh, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("mat3(" + this.value.elements.join(", ") + ")", s, r);
    }
  }, {
    key: "elements",
    get: function get() {
      return this.value.elements;
    },
    set: function set(e) {
      this.value.fromArray(e);
    }
  }]);
  return Nh;
}(Jt);
var Qi = /*#__PURE__*/function (_Jt13) {
  _inherits(Qi, _Jt13);
  var _super168 = _createSuper(Qi);
  function Qi(e) {
    var _this163;
    _classCallCheck(this, Qi);
    _this163 = _super168.call(this, "m4");
    _this163.nodeType = "Matrix4";
    _this163.value = e !== null && e !== void 0 ? e : new te();
    return _this163;
  }
  _createClass(Qi, [{
    key: "generateReadonly",
    value: function generateReadonly(e, r, i, s, o, a) {
      return e.format("mat4(" + this.value.elements.join(", ") + ")", s, r);
    }
  }, {
    key: "elements",
    get: function get() {
      return this.value.elements;
    },
    set: function set(e) {
      this.value.fromArray(e);
    }
  }]);
  return Qi;
}(Jt);
function LI(n, t, e) {
  n.setUvTransform(e[0], e[1], t[0], t[1], 0, 0, 0);
}
var k0 = /*#__PURE__*/function (_Nh) {
  _inherits(k0, _Nh);
  var _super169 = _createSuper(k0);
  function k0(e, r) {
    var _this164;
    _classCallCheck(this, k0);
    _this164 = _super169.call(this, new Qt());
    _this164.repeat = e;
    _this164.offset = r;
    LI(_this164.value, e, r);
    return _this164;
  }
  _createClass(k0, [{
    key: "updateMatrix",
    value: function updateMatrix() {
      LI(this.value, this.repeat, this.offset);
    }
  }]);
  return k0;
}(Nh);
var Ys = /*#__PURE__*/function (_Jt14) {
  _inherits(Ys, _Jt14);
  var _super170 = _createSuper(Ys);
  function Ys() {
    var _this165;
    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var r = arguments.length > 1 ? arguments[1] : undefined;
    _classCallCheck(this, Ys);
    _this165 = _super170.call(this, "v4[]");
    _this165.nodeType = "Vector4Array";
    _this165.size = e, _this165.value = Array.isArray(r) ? r : r instanceof He ? new Array(e).fill(r) : new Array(e).fill(new He(0));
    return _this165;
  }
  return _createClass(Ys);
}(Jt);
var Fh = /*#__PURE__*/function (_Xe15) {
  _inherits(Fh, _Xe15);
  var _super171 = _createSuper(Fh);
  function Fh(e, r, i, s) {
    var _this166;
    _classCallCheck(this, Fh);
    _this166 = _super171.call(this, "v3");
    _this166.nodeType = "Blend";
    _this166.a = e, _this166.b = r, _this166.alpha = i, _this166.mode = s;
    return _this166;
  }
  _createClass(Fh, [{
    key: "generate",
    value: function generate(e, r) {
      if (e.isShader("fragment")) {
        var i = [];
        return i.push(this.a.build(e, "c")), i.push(this.b.build(e, "c")), i.push(this.alpha.build(e, "f")), i.push(this.mode.build(e, "i")), e.format("spe_blend(" + i.join(",") + ")", this.getType(e), r);
      } else return console.warn("BlendNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
    }
  }]);
  return Fh;
}(Xe);
var TA = /*#__PURE__*/function (_Xe16) {
    _inherits(TA, _Xe16);
    var _super172 = _createSuper(TA);
    function TA(e, r) {
      var _this167;
      _classCallCheck(this, TA);
      _this167 = _super172.call(this, "v3");
      _this167.nodeType = "CustomColor";
      _this167.color = e, _this167.alpha = r, _this167.calpha = "g".concat(_this167.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this167;
    }
    _createClass(TA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          var i = e.include(TA.Nodes.customColor);
          e.addFragmentVariable(this.calpha, "float");
          var s = [];
          return s.push(this.color.build(e, "v3")), s.push(this.mask ? "luminance(".concat(this.mask.build(e, "v3"), ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("CustomColorNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return TA;
  }(Xe),
  Uc = TA;
Uc.Nodes = function () {
  return {
    customColor: new ge("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")
  };
}();
var MA = /*#__PURE__*/function (_Xe17) {
    _inherits(MA, _Xe17);
    var _super173 = _createSuper(MA);
    function MA(e, r) {
      var _this168;
      _classCallCheck(this, MA);
      _this168 = _super173.call(this, "v3");
      _this168.nodeType = "CustomNormal";
      _this168.cnormal = e, _this168.alpha = r, _this168.calpha = "g".concat(_this168.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this168;
    }
    _createClass(MA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          var i = e.include(MA.Nodes.customNormal);
          e.addFragmentVariable(this.calpha, "float");
          var s = [];
          return s.push(this.cnormal.build(e, "v3")), s.push("normal"), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("CustomNormalNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return MA;
  }(Xe),
  kh = MA;
kh.Nodes = function () {
  return {
    customNormal: new ge("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")
  };
}();
var zh = /*#__PURE__*/function (_Xe18) {
    _inherits(zh, _Xe18);
    var _super174 = _createSuper(zh);
    function zh(e, r, i, s, o, a, l, u, c, d, h, f) {
      var _this169;
      _classCallCheck(this, zh);
      _this169 = _super174.call(this, "v3");
      _this169.nodeType = "CustomTexture";
      _this169.texture = e, _this169.textureSize = r, _this169.crop = i, _this169.projection = s, _this169.axis = o, _this169.side = a, _this169.size = l, _this169.blending = u, _this169.mat = c, _this169.isMask = f, _this169.alpha = d, _this169.mode = h, _this169.calpha = "g".concat(_this169.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this169;
    }
    _createClass(zh, [{
      key: "generate",
      value: function generate(e, r) {
        e.require("position"), e.require("normal"), e.require("uv"), e.requires.uv = [!0], e.extensions.shaderTextureLOD = !0, e.extensions.derivatives = !0;
        var i = "g".concat(this.uuid.toString().replace(/-/g, "")),
          s;
        switch (this.projection.value) {
          case 3:
            s = e.include(zh.Nodes.cylindrical);
            break;
          case 2:
            s = e.include(zh.Nodes.spherical);
            break;
          case 1:
            var a = ["vec3(1.0, 0.0, 0.0)", "vec3(0.0, 1.0, 0.0)", "vec3(0.0, 0.0, 1.0)"][this.axis.value],
              l = ["zy", "xz", "xy"][this.axis.value],
              u = new ge("\n\t\tvec3 ".concat(i, "_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.").concat(l, ")) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t").concat(this.side.value === 2 ? "" : "lalpha *= step(0.0, ".concat(this.side.value === 1 ? "-1.0 * " : "", "dot(vObjectNormal, ").concat(a, "));"), "\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"));
            s = e.include(u);
            break;
          case 4:
            s = e.include(zh.Nodes.triplanar);
            break;
          default:
            s = e.include(zh.Nodes.uv);
            break;
        }
        e.addFragmentVariable(this.calpha, "float");
        var o = [];
        if (o.push("normal"), o.push(this.texture.generate(e, "t")), o.push(this.textureSize.build(e, "v2")), o.push(this.crop.build(e, "f")), o.push(this.mat.build(e, "mat3")), o.push(this.size.build(e, "v2")), o.push(this.blending.build(e, "f")), o.push(this.isMask.build(e, "b")), o.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), o.push(this.alpha.build(e, "f")), o.push(this.mode.build(e, "i")), o.push(this.calpha), this.projection.value === 4) {
          var _a31 = "".concat(i, "_writeUvs"),
            _l60 = _a31 + "0",
            _u38 = _a31 + "1",
            c = _a31 + "2",
            d = "".concat(i, "_triplanarWeights");
          e.addFragmentVariable(_l60, "vec2"), e.addFragmentVariable(_u38, "vec2"), e.addFragmentVariable(c, "vec2"), e.addFragmentVariable(d, "vec3"), o.push(_l60), o.push(_u38), o.push(c), o.push(d);
        } else {
          var _a32 = "".concat(i, "_writeUvs");
          e.addFragmentVariable(_a32, "vec2"), o.push(_a32);
        }
        return e.format(s + "(" + o.join(",") + ")", this.getType(e), r);
      }
    }]);
    return zh;
  }(Xe),
  Ll = zh;
Ll.Nodes = function () {
  var e = new ge("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),
    r = new ge("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),
    i = new ge("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),
    s = new ge("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t");
  return {
    cylindrical: e,
    spherical: r,
    uv: i,
    triplanar: s
  };
}();
var Vh = /*#__PURE__*/function (_Xe19) {
    _inherits(Vh, _Xe19);
    var _super175 = _createSuper(Vh);
    function Vh(e, r, i, s, o, a, l, u, c, d, h, f) {
      var _this170;
      _classCallCheck(this, Vh);
      _this170 = _super175.call(this, "v3");
      _this170.nodeType = "Depth";
      _this170.gradientType = e, _this170.smooth = r, _this170.near = i, _this170.far = s, _this170.isVector = o, _this170.isWorldSpace = a, _this170.origin = l, _this170.direction = u, _this170.colors = c, _this170.steps = d, _this170.isMask = f, _this170.alpha = h, _this170.calpha = "g".concat(_this170.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this170;
    }
    _createClass(Vh, [{
      key: "generate",
      value: function generate(e, r) {
        var i = "g".concat(this.uuid.toString().replace(/-/g, "")),
          s = new ge("vec3 ".concat(i, "_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[").concat(i, "_MAX_COLORS], float steps[").concat(i, "_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ").concat(i, "_IS_VECTOR\n                   #ifdef ").concat(i, "_LINEAR\n                       #ifdef ").concat(i, "_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ").concat(i, "_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ").concat(i, "_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ").concat(i, "_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ").concat(i, "_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}"), [Vh.Nodes.vectorLinearWorldSpaceDepth, Vh.Nodes.vectorLinearObjectSpaceDepth, Vh.Nodes.vectorSphericalObjectSpaceDepth, Vh.Nodes.vectorSphericalWorldSpaceDepth]);
        if (e.isShader("fragment")) {
          e.define("".concat(i, "_MAX_COLORS"), this.colors.value.length), this.smooth.value && e.define("".concat(i, "_SMOOTH")), this.isVector.value > .5 && e.define("".concat(i, "_IS_VECTOR")), this.gradientType.value === 0 && e.define("".concat(i, "_LINEAR")), this.isWorldSpace.value > .5 && e.define("".concat(i, "_WORLDSPACE")), e.require("worldPosition"), e.addFragmentVariable(this.calpha, "float");
          var o = e.include(s),
            a = [];
          return a.push(this.near.build(e, "f")), a.push(this.far.build(e, "f")), a.push(this.origin.build(e, "v3")), a.push(this.direction.build(e, "v3")), a.push(this.colors.build(e, "v4[]")), a.push(this.steps.build(e, "f[]")), a.push(this.isMask.build(e, "b")), a.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), a.push(this.alpha.build(e, "f")), a.push(this.calpha), e.format(o + "(" + a.join(",") + ")", this.getType(e), r);
        } else return console.warn("DepthNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return Vh;
  }(Xe),
  Uh = Vh;
Uh.Nodes = function () {
  var e = new ge("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),
    r = new ge("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),
    i = new ge("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),
    s = new ge("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }");
  return {
    vectorLinearWorldSpaceDepth: e,
    vectorLinearObjectSpaceDepth: r,
    vectorSphericalWorldSpaceDepth: i,
    vectorSphericalObjectSpaceDepth: s
  };
}();
var ym = /*#__PURE__*/function (_Xe20) {
  _inherits(ym, _Xe20);
  var _super176 = _createSuper(ym);
  function ym(e, r, i, s, o, a, l, u) {
    var _this171;
    _classCallCheck(this, ym);
    _this171 = _super176.call(this, "v3");
    _this171.nodeType = "Fresnel";
    _this171.color = e, _this171.bias = r, _this171.scale = i, _this171.intensity = s, _this171.factor = o, _this171.isMask = u, _this171.alpha = a, _this171.mode = l, _this171.calpha = "g".concat(_this171.uuid.toString().replace(/-/g, ""), "_calpha");
    return _this171;
  }
  _createClass(ym, [{
    key: "generate",
    value: function generate(e, r) {
      if (e.require("vWorldViewDir"), e.require("worldNormal"), e.isShader("fragment")) {
        e.addFragmentVariable(this.calpha, "float");
        var i = new ge("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),
          s = e.include(i),
          o = [];
        return o.push(this.color.build(e, "c")), o.push(this.bias.build(e, "f")), o.push(this.scale.build(e, "f")), o.push(this.intensity.build(e, "f")), o.push(this.factor.build(e, "f")), o.push(this.isMask.build(e, "b")), o.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), o.push(this.alpha.build(e, "f")), o.push(this.mode.build(e, "i")), o.push(this.calpha), e.format(s + "(" + o.join(",") + ")", this.getType(e), r);
      } else return console.warn("FresnelNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
    }
  }]);
  return ym;
}(Xe);
var CA = /*#__PURE__*/function (_Xe21) {
    _inherits(CA, _Xe21);
    var _super177 = _createSuper(CA);
    function CA(e, r, i, s, o, a, l, u, c) {
      var _this172;
      _classCallCheck(this, CA);
      _this172 = _super177.call(this, "v3");
      _this172.nodeType = "Gradient";
      _this172.gradientType = e, _this172.smooth = r, _this172.colors = i, _this172.steps = s, _this172.offset = o, _this172.morph = a, _this172.angle = l, _this172.isMask = c, _this172.alpha = u, _this172.calpha = "g".concat(_this172.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this172;
    }
    _createClass(CA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          e.define("GRAD_MAX", 10), e.require("uv"), e.requires.uv = [!0], e.addFragmentVariable(this.calpha, "float");
          var i = e.include(CA.Nodes.gradient),
            s = [];
          return s.push(this.gradientType.build(e, "i")), s.push(this.smooth.build(e, "b")), s.push(this.colors.build(e, "v4[]")), s.push(this.steps.build(e, "f[]")), s.push(this.offset.build(e, "v2")), s.push(this.morph.build(e, "v2")), s.push(this.angle.build(e, "f")), s.push(this.isMask.build(e, "b")), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("GradientNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return CA;
  }(Xe),
  Gh = CA;
Gh.Nodes = function () {
  return {
    gradient: new ge("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")
  };
}();
var PA = /*#__PURE__*/function (_Xe22) {
    _inherits(PA, _Xe22);
    var _super178 = _createSuper(PA);
    function PA(e, r, i, s) {
      var _this173;
      _classCallCheck(this, PA);
      _this173 = _super178.call(this, "v3");
      _this173.nodeType = "Matcap";
      _this173.texture = e, _this173.isMask = s, _this173.alpha = r, _this173.mode = i, _this173.calpha = "g".concat(_this173.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this173;
    }
    _createClass(PA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          e.addFragmentVariable(this.calpha, "float");
          var i = e.include(PA.Nodes.matcap);
          e.require("normal"), e.requires.normal = !0;
          var s = [];
          return s.push(this.texture.generate(e, "t")), s.push("normal"), s.push(this.isMask.build(e, "b")), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.mode.build(e, "i")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("MatcapNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return PA;
  }(Xe),
  jh = PA;
jh.Nodes = function () {
  return {
    matcap: new ge("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")
  };
}();
var vm = function (o) {
    return o.SIMPLEX = "simplex3d", o.SIMPLEX_FRACTAL = "simplex3dFractal", o.ASHIMA = "simplexAshima", o.FBM = "fbm", o.PERLIN = "perlin", o.VORONOI = "voronoi", o;
  }(vm || {}),
  Ui = function () {
    var t = new ge("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),
      e = new ge("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}", [t]);
    e.keywords.F3 = new Ft("float F3 0.3333333"), e.keywords.G3 = new Ft("float G3 0.1666667");
    var r = new ge("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}", [e]),
      i = new ge("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),
      s = new ge("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),
      o = new ge("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}", [i, s]),
      a = new ge("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),
      l = new ge("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}", [a]),
      u = new ge("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}", [l]),
      c = new ge("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}", [u]);
    c.keywords.NUM_OCTAVES = new Ft("int NUM_OCTAVES ".concat(5));
    var d = new ge("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),
      h = new ge("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}", [i, s, d]),
      f = new ge("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),
      p = new ge("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),
      m = new ge("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),
      g = new ge("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),
      y = new ge("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),
      v = new ge("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}"),
      x = new ge("float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point's coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute \"smooth\" versions of all of the above quantites, essentially\n\t\t\t// replacing \"hard\" minimums with \"smooth\" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to \"x\" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes \"r - mr\" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// \"Pebbles\" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t", [f, p, m, g, y, v]);
    return {
      simplex: e,
      simplexFractal: r,
      simplexAshima: o,
      fbm: c,
      perlin: h,
      voronoi: x
    };
  }();
var Hh = /*#__PURE__*/function (_Xe23) {
  _inherits(Hh, _Xe23);
  var _super179 = _createSuper(Hh);
  function Hh(e, r, i, s, o, a, l, u, c, d, h, f, p, m, g, y, v, x, S) {
    var _this174;
    _classCallCheck(this, Hh);
    _this174 = _super179.call(this, "v3");
    _this174.nodeType = "Noise";
    _this174.scale = e, _this174.size = r, _this174.move = i, _this174.fA = s, _this174.fB = o, _this174.distortion = a, _this174.colorA = l, _this174.colorB = u, _this174.colorC = c, _this174.colorD = d, _this174.noiseType = f, _this174.voronoiStyle = m, _this174.highCut = g, _this174.lowCut = y, _this174.smoothness = v, _this174.seed = x, _this174.quality = S, _this174.isMask = p, _this174.alpha = h, _this174.calpha = "g".concat(_this174.uuid.toString().replace(/-/g, ""), "_calpha");
    return _this174;
  }
  _createClass(Hh, [{
    key: "generate",
    value: function generate(e, r, i, s, o) {
      e.require("uv"), e.requires.uv = [!0], e.addFragmentVariable(this.calpha, "float");
      var a = Object.values(vm)[this.noiseType.value],
        l = a == "voronoi" ? "\n\t\tfloat v = ".concat(a, "(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors \"A\" and \"C\" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t") : "\n\t\tvec3 q = vec3(".concat(a, "(st),\n\t\t\t\t\t   ").concat(a, "(st + vec3(1.0)),\n\t\t\t\t\t   ").concat(a, "(st + vec3(1.0)));\n\t\tvec3 r = vec3(").concat(a, "(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ").concat(a, "(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ").concat(a, "(st * q));\n\t\tfloat f = ").concat(a, "(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t"),
        u = new ge("vec3 ".concat(a, "customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t").concat(l, "\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}"), [Ui.simplex, Ui.simplexFractal, Ui.simplexAshima, Ui.fbm, Ui.perlin, Ui.voronoi]),
        c = e.include(u),
        d = [];
      return d.push(this.scale.build(e, "f")), d.push(this.size.build(e, "v3")), d.push(this.move.build(e, "f")), d.push(this.fA.build(e, "v2")), d.push(this.fB.build(e, "v2")), d.push(this.distortion.build(e, "v2")), d.push(this.colorA.build(e, "v4")), d.push(this.colorB.build(e, "v4")), d.push(this.colorC.build(e, "v4")), d.push(this.colorD.build(e, "v4")), d.push(this.voronoiStyle.build(e, "i")), d.push(this.highCut.build(e, "f")), d.push(this.lowCut.build(e, "f")), d.push(this.smoothness.build(e, "f")), d.push(this.seed.build(e, "f")), d.push(this.quality.build(e, "i")), d.push(this.isMask.build(e, "b")), d.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), d.push(this.alpha.build(e, "f")), d.push(this.calpha), e.format(c + "(" + d.join(",") + ")", this.getType(e), r);
    }
  }]);
  return Hh;
}(Xe);
Hh.numOctaves = 5;
var DA = /*#__PURE__*/function (_Xe24) {
    _inherits(DA, _Xe24);
    var _super180 = _createSuper(DA);
    function DA(e, r, i, s, o, a, l, u, c, d, h, f, p, m, g, y) {
      var _this175;
      _classCallCheck(this, DA);
      _this175 = _super180.call(this, "v3");
      _this175.nodeType = "Outline";
      _this175.firstTime = !0, _this175.outlineColor = e, _this175.contourColor = r, _this175.outlineWidth = i, _this175.contourWidth = s, _this175.contourThreshold = o, _this175.outlineThreshold = a, _this175.contourFrequency = l, _this175.outlineSmoothing = u, _this175.contourDirection = c, _this175.positionalLines = d, _this175.compensation = h, _this175.resolution = f, _this175.normalMap = p, _this175.depthMap = m, _this175.pixelRatio = g, _this175.alpha = y, _this175.calpha = "g".concat(_this175.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this175;
    }
    _createClass(DA, [{
      key: "generate",
      value: function generate(e, r) {
        var i = "g".concat(this.uuid.toString().replace(/-/g, ""));
        if (e.require("vWorldViewDir"), e.require("worldNormal"), e.extensions.derivatives = !0, this.compensation.value && e.define("OUTLINE_COMPENSATION", "".concat(i, "_offset")), this.firstTime) {
          var s = this.outlineWidth.build(e, "f"),
            o = this.resolution.build(e, "v2"),
            a = this.compensation.build(e, "b"),
            l = this.pixelRatio.build(e, "f");
          e.addVertexParsVariable("randomColor", "attribute vec3"), e.addVertexParsVariable("extrudeNormal", "attribute vec3"), e.addVertexParsVariable(s, "uniform float"), e.addVertexParsVariable(o, "uniform vec2"), e.addVertexParsVariable(a, "uniform bool"), e.addVertexParsVariable(l, "uniform float"), e.addVertexParsVariable("vID", "flat out float"), e.addFragmentParsVariable("vID", "flat in float"), e.addVertexFinalCode("\n                vID = randomColor.r;\n                vec2 ".concat(i, "_offset = vec2(0.0);\n                if (").concat(a, ") {\n                    vec4 ").concat(i, "_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ").concat(i, "_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ").concat(i, "_offset = normalize(").concat(i, "_clipNormal.xy) / ").concat(o, " * (").concat(s, " / 2.0) * ").concat(i, "_clipPosition.w * 2.0 * ").concat(l, ";\n                    ").concat(i, "_clipPosition.xy += ").concat(i, "_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ").concat(i, "_clipPosition;\n                }\n            "));
        }
        if (e.isShader("fragment")) {
          e.require("uv"), e.requires.uv = [!0], e.addFragmentVariable(this.calpha, "float");
          var _s29 = e.include(DA.Nodes.outline),
            _o28 = [];
          return _o28.push(this.outlineColor.build(e, "c")), _o28.push(this.contourColor.build(e, "c")), _o28.push(this.outlineWidth.build(e, "f")), _o28.push(this.contourWidth.build(e, "f")), _o28.push(this.contourThreshold.build(e, "f")), _o28.push(this.outlineThreshold.build(e, "f")), _o28.push(this.contourFrequency.build(e, "f")), _o28.push(this.outlineSmoothing.build(e, "f")), _o28.push(this.contourDirection.build(e, "v3")), _o28.push(this.positionalLines.build(e, "b")), _o28.push(this.resolution.build(e, "v2")), _o28.push(this.normalMap.getTexture(e, "t")), _o28.push(this.depthMap.getTexture(e, "t")), _o28.push(this.pixelRatio.build(e, "f")), _o28.push(this.compensation.build(e, "b")), _o28.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), _o28.push(this.alpha.build(e, "f")), _o28.push(this.calpha), this.firstTime = !this.firstTime, e.format(_s29 + "(" + _o28.join(",") + ")", this.getType(e), r);
        } else return console.warn("OutlineNode is not compatible with " + e.shader + " shader."), "";
      }
    }]);
    return DA;
  }(Xe),
  Wh = DA;
Wh.Nodes = function () {
  var e = new ge("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");
  return {
    outline: new ge("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }", [e])
  };
}();
var Oo = /*#__PURE__*/function (_Xe25) {
    _inherits(Oo, _Xe25);
    var _super181 = _createSuper(Oo);
    function Oo(e, r, i, s, o, a, l, u, c, d, h, f, p, m, g, y, v, x) {
      var _this176;
      _classCallCheck(this, Oo);
      _this176 = _super181.call(this, "v3");
      _this176.nodeType = "Pattern";
      _this176.style = e, _this176.projection = r, _this176.axis = i, _this176.blending = s, _this176.offset = o, _this176.colorA = a, _this176.colorB = l, _this176.frequency = u, _this176.size = c, _this176.variation = d, _this176.smoothness = h, _this176.zigzag = f, _this176.rotation = p, _this176.vertical = m, _this176.horizontal = g, _this176.sides = y, _this176.isMask = x, _this176.alpha = v, _this176.calpha = "g".concat(_this176.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this176;
    }
    _createClass(Oo, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("fragment")) {
          e.require("position"), e.require("uv"), e.requires.uv = [!0], e.require("normal"), e.requires.normal = !0, e.addFragmentVariable(this.calpha, "float");
          var i;
          switch (this.style.value) {
            case 0:
              i = "circle";
              break;
            case 1:
              i = "ring";
              break;
            case 2:
              i = "polygon";
              break;
            case 3:
              i = "xcross";
              break;
            case 4:
              i = "diamond";
              break;
            case 5:
              i = "checkerboard";
              break;
            case 6:
              i = "line";
              break;
            case 7:
              i = "wave";
              break;
            default:
              i = "circle";
              break;
          }
          var s = "g".concat(this.uuid.toString().replace(/-/g, "")),
            o = new ge("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),
            a = new ge("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),
            l = "";
          if (this.projection.value === 4) {
            var h = this.style.value === 2 ? "".concat(i, "(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)") : "".concat(i, "(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),
              f = this.style.value === 2 ? "".concat(i, "(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)") : "".concat(i, "(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),
              p = this.style.value === 2 ? "".concat(i, "(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)") : "".concat(i, "(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)");
            l = "\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ".concat(h, ";\n\t\t\t\tfloat d1 = ").concat(f, ";\n\t\t\t\tfloat d2 = ").concat(p, ";\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t");
          } else {
            var _h64 = this.style.value === 2 ? "".concat(i, "(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)") : "".concat(i, "(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),
              _f68 = "";
            this.axis.value === 0 ? _f68 = "float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);" : this.axis.value === 1 ? _f68 = "float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);" : (this.axis.value, _f68 = "float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");
            var _p43 = "";
            switch (this.projection.value) {
              case 0:
                _p43 = "custom_uv = vUv.st;";
                break;
              case 1:
                break;
              case 2:
                _p43 = "\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t".concat(_f68, "\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t");
                break;
              case 3:
                break;
              default:
                break;
            }
            l = "\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t".concat(_p43, "\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ").concat(_h64, ";\n\t\t\t\t");
          }
          var u = new ge("vec3 ".concat(s, "_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t").concat(l, "\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}"), [a, o, Oo.DrawFunctions.circle, Oo.DrawFunctions.ring, Oo.DrawFunctions.polygon, Oo.DrawFunctions.cross, Oo.DrawFunctions.diamond, Oo.DrawFunctions.checkerboard, Oo.DrawFunctions.line, Oo.DrawFunctions.wave]),
            c = e.include(u),
            d = [];
          return d.push("normal"), d.push(this.blending.build(e, "f")), d.push(this.style.build(e, "i")), d.push(this.offset.build(e, "v2")), d.push(this.colorA.build(e, "v4")), d.push(this.colorB.build(e, "v4")), d.push(this.frequency.build(e, "v2")), d.push(this.size.build(e, "f")), d.push(this.variation.build(e, "f")), d.push(this.smoothness.build(e, "f")), d.push(this.zigzag.build(e, "f")), d.push(this.rotation.build(e, "f")), d.push(this.vertical.build(e, "v2")), d.push(this.horizontal.build(e, "v2")), d.push(this.sides.build(e, "i")), d.push(this.isMask.build(e, "b")), d.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), d.push(this.alpha.build(e, "f")), d.push(this.calpha), e.format(c + "(" + d.join(",") + ")", this.getType(e), r);
        } else return console.warn("PatterNode is not compatible with " + e.shader + " shader."), e.format("vec3(0.0)", this.getType(e), r);
      }
    }]);
    return Oo;
  }(Xe),
  qh = Oo;
qh.DrawFunctions = function () {
  var e = new ge("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),
    r = new ge("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }", [e]),
    i = new ge("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }", [r]),
    s = new ge("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }", [r]),
    o = new ge("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }", [r]),
    a = new ge("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }", [r]),
    l = new ge("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }", [r]),
    u = new ge("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),
    c = new ge("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }", [r]),
    d = new ge("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }");
  return {
    tileAndCenter: r,
    circle: i,
    ring: s,
    polygon: o,
    cross: a,
    diamond: l,
    checkerboard: u,
    line: c,
    wave: d
  };
}();
var OA = /*#__PURE__*/function (_Xe26) {
    _inherits(OA, _Xe26);
    var _super182 = _createSuper(OA);
    function OA(e, r, i, s, o, a, l, u) {
      var _this177;
      _classCallCheck(this, OA);
      _this177 = _super182.call(this, "v3");
      _this177.nodeType = "Rainbow";
      _this177.filmThickness = e, _this177.movement = r, _this177.wavelengths = i, _this177.noiseStrength = s, _this177.noiseScale = o, _this177.offset = a, _this177.isMask = u, _this177.alpha = l, _this177.calpha = "g".concat(_this177.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this177;
    }
    _createClass(OA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.require("vWorldViewDir"), e.require("worldNormal"), e.isShader("fragment")) {
          e.require("uv"), e.requires.uv = [!0], e.addFragmentVariable(this.calpha, "float");
          var i = e.include(OA.Nodes.rainbow),
            s = [];
          return s.push(this.filmThickness.build(e, "f")), s.push(this.movement.build(e, "f")), s.push(this.wavelengths.build(e, "v3")), s.push(this.noiseStrength.build(e, "f")), s.push(this.noiseScale.build(e, "f")), s.push(this.offset.build(e, "v3")), s.push(this.isMask.build(e, "b")), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("RainbowNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return OA;
  }(Xe),
  Yh = OA;
Yh.Nodes = function () {
  var e = new ge("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }", [Ui.simplex]);
  return {
    rainbow: new ge("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n             }", [e])
  };
}();
var IA = /*#__PURE__*/function (_Xe27) {
    _inherits(IA, _Xe27);
    var _super183 = _createSuper(IA);
    function IA(e, r, i, s, o, a, l, u, c, d) {
      var _this178;
      _classCallCheck(this, IA);
      _this178 = _super183.call(this, "v3");
      _this178.nodeType = "Toon";
      _this178.positioning = e, _this178.colors = r, _this178.steps = i, _this178.source = s, _this178.isWorldSpace = o, _this178.noiseStrength = a, _this178.noiseScale = l, _this178.shadowColor = u, _this178.offset = c, _this178.alpha = d, _this178.calpha = "g".concat(_this178.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this178;
    }
    _createClass(IA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.require("worldNormal"), e.require("worldPosition"), e.isShader("fragment")) {
          e.define("COLORS_MAX", 10), e.addFragmentVariable(this.calpha, "float");
          var i = e.include(IA.Nodes.toon),
            s = [];
          return s.push(this.positioning.build(e, "i")), s.push(this.colors.build(e, "v4[]")), s.push(this.steps.build(e, "f[]")), s.push(this.source.build(e, "v3")), s.push(this.isWorldSpace.build(e, "b")), s.push(this.noiseStrength.build(e, "f")), s.push(this.noiseScale.build(e, "f")), s.push(this.shadowColor.build(e, "v4")), s.push(this.offset.build(e, "v3")), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("ToonNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return IA;
  }(Xe),
  Xh = IA;
Xh.Nodes = function () {
  var e = new ge("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),
    r = new ge("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),
    i = new ge("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}", [r]),
    s = new ge("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),
    o = new ge("vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the \"+ hash(p + b);\" part below to get \"square\" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t", [s]);
  return {
    toon: new ge("vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can't do this mode if lighting is \"none\"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use \"intensity\" but it isn't available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi \"smooth\" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }", [Ui.simplex, e, i, o])
  };
}();
var BI = function () {
  return {
    textureBicubic: new ge("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")
  };
}();
function NI(n, t) {
  return n >= t ? new N(t / n, 1) : new N(1, n / t);
}
var RA = /*#__PURE__*/function (_Xe28) {
    _inherits(RA, _Xe28);
    var _super184 = _createSuper(RA);
    function RA(e, r, i, s, o, a, l, u) {
      var _this179;
      _classCallCheck(this, RA);
      _this179 = _super184.call(this, "v3");
      _this179.nodeType = "Transmission";
      _this179.thickness = e, _this179.ior = r, _this179.roughness = i, _this179.transmissionSamplerSize = s, _this179.transmissionSamplerMap = o, _this179.transmissionDepthMap = a, _this179.aspectRatio = l, _this179.alpha = u, _this179.calpha = "g".concat(_this179.uuid.toString().replace(/-/g, ""), "_calpha");
      return _this179;
    }
    _createClass(RA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.extensions.shaderTextureLOD = !0, e.extensions.derivatives = !0, e.isShader("fragment")) {
          e.define("NUM_SAMPLES", 6), e.define("BLUR_SLOD", Math.pow(2, We.transmissionLod.value)), e.require("worldPosition"), e.requires.worldNormal = !0, e.requires.modelMatrix = !0, e.requires.projectionMatrix = !0, e.addFragmentVariable(this.calpha, "float");
          var i = e.include(RA.Nodes.transmission),
            s = [];
          return s.push(this.thickness.build(e, "f")), s.push(this.ior.build(e, "f")), s.push(this.roughness.build(e, "f")), s.push(this.transmissionSamplerSize.build(e, "v2")), s.push(this.transmissionSamplerMap.getTexture(e, "t")), s.push(this.transmissionDepthMap.getTexture(e, "t")), s.push(this.aspectRatio.build(e, "v2")), s.push("normal"), s.push(this.mask ? "luminance(".concat(this.mask.flow(e, "v3").result, ")") : "1.0"), s.push(this.alpha.build(e, "f")), s.push(this.calpha), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("TransmissionNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return RA;
  }(Xe),
  Qh = RA;
Qh.Nodes = function () {
  var e = new ge("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),
    r = new ge("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),
    i = new ge("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),
    s = new ge("vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the \"Threejs method of blurring\" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}", [BI.textureBicubic, i, e]),
    o = new ge("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}", [s, r]);
  return {
    transmission: new ge("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }", [o])
  };
}();
var LA = function (e) {
    return e.NOISE = "noise", e.MAP = "map", e;
  }(LA || {}),
  BA = /*#__PURE__*/function (_Xe29) {
    _inherits(BA, _Xe29);
    var _super185 = _createSuper(BA);
    function BA(e, r, i, s, o, a, l, u, c, d, h) {
      var _this180;
      _classCallCheck(this, BA);
      _this180 = _super185.call(this, "v3");
      _this180.displacementTypeIndex = new xt(0);
      _this180.nodeType = "VertexDisplacement";
      _this180.intensity = e, _this180.movementOrTexture = r, Object.values(LA)[_this180.displacementTypeIndex.value] === "map" && (_this180.mat = new Nh(_this180.movementOrTexture.value.matrix)), _this180.cropOrOffset = i, _this180.scale = d, _this180.noiseFunctionIndex = h, _this180.voronoiStyle = s, _this180.smoothness = o, _this180.seed = a, _this180.highCut = l, _this180.lowCut = u, _this180.quality = c;
      return _this180;
    }
    _createClass(BA, [{
      key: "generate",
      value: function generate(e, r) {
        if (e.isShader("vertex")) {
          e.define("USE_LAYER_DISPLACE");
          var i,
            s = [];
          switch (s.push("displaced_position"), s.push("displaced_normal"), Object.values(LA)[this.displacementTypeIndex.value]) {
            case "map":
              {
                i = e.include(BA.Nodes.map), s.push(this.movementOrTexture.getTexture(e, "t")), s.push("uv"), s.push(this.cropOrOffset.build(e, "f")), this.mat && s.push(this.mat.build(e, "mat3"));
                break;
              }
            case "noise":
              {
                var a = Object.values(vm)[this.noiseFunctionIndex.value],
                  l = new ge("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),
                  u = a == "voronoi" ? "\n\t\t\t\t\tfloat v = ".concat(a, "((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t") : "\n\t\t\t\t\treturn p + n * ".concat(a, "((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t"),
                  c = new ge("vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t".concat(u, "\n\t\t\t\t\t\t}"), [Ui.simplex, Ui.simplexFractal, Ui.simplexAshima, Ui.fbm, Ui.perlin, Ui.voronoi]),
                  d = new ge("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}", [c, l]);
                i = e.include(d), s.push(this.scale.build(e, "f")), s.push(this.cropOrOffset.build(e, "v3")), s.push(this.movementOrTexture.build(e, "f")), s.push(this.voronoiStyle.build(e, "i")), s.push(this.smoothness.build(e, "f")), s.push(this.seed.build(e, "f")), s.push(this.highCut.build(e, "f")), s.push(this.lowCut.build(e, "f")), s.push(this.quality.build(e, "i"));
                break;
              }
          }
          return s.push(this.intensity.build(e, "f")), s.push("displaced_normal"), e.format(i + "(" + s.join(",") + ")", this.getType(e), r);
        } else return console.warn("VertexDisplacementNode is not compatible with " + e.shader + " shader."), e.format("vec3( 0.0 )", this.getType(e), r);
      }
    }]);
    return BA;
  }(Xe),
  Kh = BA;
Kh.Nodes = function () {
  var e = new ge("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),
    r = new ge("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");
  return {
    map: new ge("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}", [e, r])
  };
}();
var We = {
  normalRenderTarget: new xn(),
  normalRenderTargetDepth: new xn(),
  transmissionRenderTarget: new xn(),
  aspectRatio: new Lr(),
  transmissionSize: new Lr(2048, 2048),
  transmissionRenderTargetDepth: new xn(),
  aoRenderTarget: new xn(),
  aoEnabled: new Vr(),
  pixelRatioNode: new Ce(1),
  resolution: new Lr(),
  penumbraSize: new qs(5, .5),
  frameIndex: new xt(0),
  transmissionLod: new xt(2)
};
for (var _i65 = 0, _Object$values3 = Object.values(We); _i65 < _Object$values3.length; _i65++) {
  var _n7 = _Object$values3[_i65];
  _n7.isRenderGlobal = !0;
}
var z0 = {
  skiaWasmUrl: "https://unpkg.com/@splinetool/ui-wasm@1.0.17/build/ui.wasm"
};
var Ma = /*#__PURE__*/function (_ki2) {
  _inherits(Ma, _ki2);
  var _super186 = _createSuper(Ma);
  function Ma() {
    var _this181;
    _classCallCheck(this, Ma);
    _this181 = _super186.call(this, "basic");
    _this181.nodeType = "Basic";
    _this181.color = new Yt(Xr), _this181.shadingAlpha = new Ce(1), _this181.shadingBlend = new xt(0), _this181.previousModelViewMatrix = new Qi(), _this181.previouseProjectionMatrix = new Qi();
    return _this181;
  }
  _createClass(Ma, [{
    key: "category",
    get: function get() {
      return "phong";
    }
  }, {
    key: "generate",
    value: function generate(e) {
      var r;
      if (e.isShader("vertex")) {
        var i = this.position ? this.position.analyzeAndFlow(e, "v3", {
          cache: "position"
        }) : void 0;
        e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          resolution: We.resolution
        }), e.mergeUniform({
          previousModelViewMatrix: this.previousModelViewMatrix
        }), e.mergeUniform({
          previousProjectionMatrix: this.previouseProjectionMatrix
        }), e.mergeUniform(Ns.merge([Ae.fog])), e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "#include <fog_pars_vertex>", "#include <normal_pars_vertex>"].join("\n"));
        var s = ["#include <beginnormal_vertex>", "\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t", "#include <normal_vertex>", "\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];
        i && s.push(i.code, i.result ? "displaced_position = " + i.result + ";" : ""), s.push("transformed = displaced_position;", "transformedNormal = normalMatrix * displaced_normal;", "#ifndef FLAT_SHADED", "	vNormal = transformedNormal;", "#endif"), s.push("#include <project_vertex>", "#include <fog_vertex>", "#include <clipping_planes_vertex>", "	vViewPosition = - mvPosition.xyz;", "#include <worldpos_vertex>"), s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"), r = s.join("\n");
      } else {
        this.color === void 0 && (this.color = new Yt(Xr)), this.color.analyze(e, {
          slot: "color"
        }), this.alpha && this.alpha.analyze(e), this.afterColor && this.afterColor.analyze(e, {
          slot: "afterColor"
        });
        var _i66 = this.color.flow(e, "c", {
            slot: "color"
          }),
          _s30 = this.alpha ? this.alpha.flow(e, "f") : void 0,
          o = this.alphaOverride ? this.alphaOverride.flow(e, "f") : void 0,
          a = this.afterColor ? this.afterColor.flow(e, "c", {
            slot: "afterColor"
          }) : void 0;
        e.requires.transparent = _s30 !== void 0, e.addParsCode(["varying vec3 vWPosition;", "#include <fog_pars_fragment>", "#include <dithering_pars_fragment>", "varying vec3 vViewPosition;", "#include <normal_pars_fragment>"].join("\n"));
        var l = ["#include <normal_fragment_begin>", _i66.code];
        _s30 && l.push(_s30.code, "#ifdef ALPHATEST", " if ( " + _s30.result + " <= ALPHATEST ) discard;", "#endif"), a ? l.push(a.code, "vec3 outgoingLight = ".concat(_i66.result, ";"), "vec3 finalColor = spe_blend(outgoingLight, ".concat(a.result, ", 1.0, SPE_BLENDING_NORMAL);")) : l.push("vec3 finalColor = ".concat(_i66.result, ";"));
        var u = "1.0";
        this.mask && (this.mask.analyze(e), u = "luminance(".concat(this.mask.flow(e, "v3").result, ")")), _s30 ? l.push("gl_FragColor = vec4( finalColor, accumAlpha * ".concat(_s30.result, " * ").concat(u, " );")) : l.push("gl_FragColor = vec4(" + _i66.result + ", 1.0 );"), o && l.push("gl_FragColor.a *= ".concat(o.result, ";")), l.push("#include <fog_fragment>", "#include <dithering_fragment>"), r = l.join("\n");
      }
      return r;
    }
  }]);
  return Ma;
}(ki);
var xm = /*#__PURE__*/function (_ki3) {
  _inherits(xm, _ki3);
  var _super187 = _createSuper(xm);
  function xm() {
    var _this182;
    _classCallCheck(this, xm);
    _this182 = _super187.call(this, "lambert");
    _this182.nodeType = "Lambert";
    _this182.color = new Yt(Xr), _this182.emissive = new Yt(0), _this182.emissiveIntensity = new Ce(1), _this182.previousModelViewMatrix = new Qi(), _this182.previouseProjectionMatrix = new Qi(), _this182.shadingAlpha = new Ce(1), _this182.shadingBlend = new xt(0), _this182.occlusion = new Vr(!0);
    return _this182;
  }
  _createClass(xm, [{
    key: "category",
    get: function get() {
      return "lambert";
    }
  }, {
    key: "build",
    value: function build(e) {
      var r;
      if (e.define("LAMBERT"), e.requires.lights = !0, e.extensions.derivatives = !0, e.isShader("vertex")) {
        var i = this.position ? this.position.analyzeAndFlow(e, "v3", {
          cache: "position"
        }) : void 0;
        e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          resolution: We.resolution
        }), e.mergeUniform({
          previousModelViewMatrix: this.previousModelViewMatrix
        }), e.mergeUniform({
          previousProjectionMatrix: this.previouseProjectionMatrix
        }), e.mergeUniform(Ns.merge([Ae.fog, Ae.lights])), e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "varying vec3 vLightFront;", "varying vec3 vIndirectFront;", "#ifndef DOUBLE_SIDED", "   #define DOUBLE_SIDED", "#endif", "#ifdef DOUBLE_SIDED", "	varying vec3 vLightBack;", "	varying vec3 vIndirectBack;", "#endif", "#include <bsdfs>", "#include <lights_pars_begin>", "#include <color_pars_vertex>", "#include <fog_pars_vertex>", "#include <normal_pars_vertex>", "#include <shadowmap_pars_vertex>", "#include <clipping_planes_pars_vertex>"].join("\n"));
        var s = ["#include <beginnormal_vertex>", "\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t", "#include <normal_vertex>", "\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];
        i && s.push(i.code, i.result ? "displaced_position = " + i.result + ";" : ""), s.push("transformed = displaced_position;", "transformedNormal = normalMatrix * displaced_normal;", "#ifndef FLAT_SHADED", "    vNormal = transformedNormal;", "#endif"), s.push("	#include <project_vertex>", "	#include <clipping_planes_vertex>", "	vViewPosition = - mvPosition.xyz;", "	#include <worldpos_vertex>", "\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"), s.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t", "	#include <shadowmap_vertex>", "	#include <fog_vertex>"), s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"), r = s.join("\n");
      } else {
        e.mergeUniform({
          penumbraSize: We.penumbraSize
        }), e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          aoMap: We.aoRenderTarget
        }), e.mergeUniform({
          aoEnabled: We.aoEnabled
        }), this.color === void 0 && (this.color = new Yt(Xr)), this.color.analyze(e, {
          slot: "color"
        }), this.shadingAlpha.analyze(e), this.shadingBlend.analyze(e), this.afterColor && this.afterColor.analyze(e, {
          slot: "afterColor"
        }), this.alpha && this.alpha.analyze(e);
        var _i67 = this.color.flow(e, "c", {
            slot: "color"
          }),
          _s31 = this.emissive.flow(e, "c", {
            slot: "emissive"
          }),
          o = this.emissiveIntensity.flow(e, "f", {
            slot: "emissive"
          }),
          a = this.occlusion.flow(e, "b", {
            slot: "occlusion"
          }),
          l = this.shadingAlpha.flow(e, "f"),
          u = this.shadingBlend.flow(e, "i"),
          c = this.afterColor ? this.afterColor.flow(e, "c", {
            slot: "afterColor"
          }) : void 0,
          d = this.alpha ? this.alpha.flow(e, "f") : void 0,
          h = this.alphaOverride ? this.alphaOverride.flow(e, "f") : void 0;
        e.requires.transparent = d !== void 0, e.addParsCode(["uniform float penumbraSize[".concat(5, "];"), "uniform sampler2D aoMap;", "uniform bool aoEnabled;", "varying vec3 vViewPosition;", "varying vec3 vWPosition;", "varying vec3 vLightFront;", "varying vec3 vIndirectFront;", "#ifndef DOUBLE_SIDED", "   #define DOUBLE_SIDED", "#endif", "#include <normal_pars_fragment>", "#ifdef DOUBLE_SIDED", "	varying vec3 vLightBack;", "	varying vec3 vIndirectBack;", "#endif", "#include <bsdfs>", "#include <lights_pars_begin>", "#include <fog_pars_fragment>", "#include <shadowmap_pars_fragment>", "#include <shadowmask_pars_fragment>", "#include <clipping_planes_pars_fragment>", "#include <dithering_pars_fragment>"].join("\n"));
        var f = ["#include <normal_fragment_begin>", "\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t", "#include <clipping_planes_fragment>"];
        f.push(_i67.code, "vec3 diffuseColor = " + _i67.result + ";", "ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"), d && f.push(d.code, "#ifdef ALPHATEST", "if ( " + d.result + " <= ALPHATEST ) discard;", "#endif"), f.push("#ifdef DOUBLE_SIDED", "	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;", "#else", "	reflectedLight.indirectDiffuse += vIndirectFront;", "#endif", "#include <lightmap_fragment>", "reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );", "#ifdef DOUBLE_SIDED", "	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;", "#else", "	reflectedLight.directDiffuse = vLightFront;", "#endif", "reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"), _s31 && f.push(_s31.code, "reflectedLight.directDiffuse += " + _s31.result + " * " + o.result + ";"), f.push("vec3 ao = aoEnabled && " + a.result + " ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);", "vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");
        var p = "1.0";
        this.mask && (this.mask.analyze(e), p = "luminance(".concat(this.mask.flow(e, "v3").result, ")")), f.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(l.result, " * ").concat(p, " * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(l.result, " * ").concat(p, ", ").concat(u.result, " );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")), c && f.push(c.code, "outgoingLight = spe_blend(outgoingLight, ".concat(c.result, ", 1.0, SPE_BLENDING_NORMAL);")), d ? f.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(d.result, " );")) : f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"), h && f.push("gl_FragColor.a *= ".concat(h.result, ";")), f.push("#include <encodings_fragment>", "#include <fog_fragment>", "#include <dithering_fragment>"), r = f.join("\n");
      }
      return r;
    }
  }]);
  return xm;
}(ki);
var Ca = function () {
  var n = new ge("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),
    t = new ge("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }");
  return {
    dHdxy: n,
    perturbNormalArb: t
  };
}();
var bm = /*#__PURE__*/function (_ki4) {
  _inherits(bm, _ki4);
  var _super188 = _createSuper(bm);
  function bm() {
    var _this183;
    _classCallCheck(this, bm);
    _this183 = _super188.call(this, "phong");
    _this183.nodeType = "Phong";
    _this183.color = new Yt(Xr), _this183.specular = new Yt(1118481), _this183.shininess = new Ce(30), _this183.previousModelViewMatrix = new Qi(), _this183.previouseProjectionMatrix = new Qi(), _this183.shadingAlpha = new Ce(1), _this183.shadingBlend = new xt(0), _this183.occlusion = new Vr(!0);
    return _this183;
  }
  _createClass(bm, [{
    key: "category",
    get: function get() {
      return "phong";
    }
  }, {
    key: "build",
    value: function build(e) {
      var r;
      if (e.define("PHONG"), e.requires.lights = !0, e.extensions.derivatives = !0, e.isShader("vertex")) {
        var i = this.position ? this.position.analyzeAndFlow(e, "v3", {
          cache: "position"
        }) : void 0;
        e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          resolution: We.resolution
        }), e.mergeUniform({
          previousModelViewMatrix: this.previousModelViewMatrix
        }), e.mergeUniform({
          previousProjectionMatrix: this.previouseProjectionMatrix
        }), e.mergeUniform(Ns.merge([Ae.fog, Ae.lights])), e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "#include <fog_pars_vertex>", "#include <skinning_pars_vertex>", "#include <normal_pars_vertex>", "#include <shadowmap_pars_vertex>", "#include <clipping_planes_pars_vertex>"].join("\n"));
        var s = ["#include <beginnormal_vertex>", "\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t", "#include <normal_vertex>", "\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];
        i && s.push(i.code, i.result ? "displaced_position = " + i.result + ";" : ""), s.push("transformed = displaced_position;", "#include <skinning_vertex>", "transformedNormal = normalMatrix * displaced_normal;", "#ifndef FLAT_SHADED", "    vNormal = transformedNormal;", "#endif"), s.push("	#include <project_vertex>", "	#include <clipping_planes_vertex>", "	vViewPosition = - mvPosition.xyz;", "	#include <worldpos_vertex>", "	#include <shadowmap_vertex>", "	#include <fog_vertex>"), s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"), r = s.join("\n");
      } else {
        e.mergeUniform({
          penumbraSize: We.penumbraSize
        }), e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          aoMap: We.aoRenderTarget
        }), e.mergeUniform({
          aoEnabled: We.aoEnabled
        }), this.color === void 0 && (this.color = new Yt(Xr)), this.color.analyze(e, {
          slot: "color"
        }), this.specular.analyze(e), this.shininess.analyze(e);
        var _i68 = this.occlusion.flow(e, "b", {
          slot: "occlusion"
        });
        this.shadingAlpha.analyze(e), this.shadingBlend.analyze(e), this.afterColor && this.afterColor.analyze(e, {
          slot: "afterColor"
        }), this.alpha && this.alpha.analyze(e);
        var _s32 = this.color.flow(e, "c", {
            slot: "color"
          }),
          o = this.specular.flow(e, "c"),
          a = this.shininess.flow(e, "f"),
          l = this.shadingAlpha.flow(e, "f"),
          u = this.shadingBlend.flow(e, "i"),
          c = this.afterColor ? this.afterColor.flow(e, "c", {
            slot: "afterColor"
          }) : void 0,
          d = this.alpha ? this.alpha.flow(e, "f") : void 0,
          h = this.alphaOverride ? this.alphaOverride.flow(e, "f") : void 0;
        e.requires.transparent = d !== void 0, e.addParsCode(["varying vec3 vWPosition;", "uniform vec3 emissive;", "uniform float penumbraSize[".concat(5, "];"), "uniform sampler2D aoMap;", "uniform bool aoEnabled;", "#include <normal_pars_fragment>", "#include <fog_pars_fragment>", "#include <bsdfs>", "#include <lights_pars_begin>", "#include <lights_phong_pars_fragment>", "#include <shadowmap_pars_fragment>", "#include <dithering_pars_fragment>"].join("\n"));
        var f = ["#include <normal_fragment_begin>", "\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t", "	BlinnPhongMaterial material;"];
        if (this.bumpMap) {
          e.include(Ca.dHdxy), e.include(Ca.perturbNormalArb);
          var m = this.bumpMap.texture.flow(e, "t"),
            g = this.bumpMap.flow(e, "v3"),
            y = this.bumpMapIntensity ? this.bumpMapIntensity.flow(e, "f").result : "1.0",
            v = "";
          this.bumpMap.projection.value === 4 ? v = "\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(m.result, ", uv0, ").concat(y, ");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(m.result, ", uv1, ").concat(y, ");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(m.result, ", uv2, ").concat(y, ");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t") : v = "\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(m.result, ", bumpMapCachedUv, ").concat(y, ");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"), f.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(g.result, ";\n\t\t\t\t\t").concat(v, "\n\t\t\t\t\t"));
        }
        f.push(_s32.code, "	vec3 diffuseColor = " + _s32.result + ";", "	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );", "	vec3 totalEmissiveRadiance = emissive;", o.code, "	vec3 specular = " + o.result + ";", a.code, "	float shininess = max( 0.0001, " + a.result + " );", "	float specularStrength = 1.0;"), d && f.push(d.code, "#ifdef ALPHATEST", "if ( " + d.result + " <= ALPHATEST ) discard;", "#endif"), f.push("material.diffuseColor = diffuseColor;"), f.push("material.specularColor = specular;", "material.specularShininess = shininess;", "material.specularStrength = specularStrength;", "#include <lights_fragment_begin>", "#include <lights_fragment_end>"), f.push("vec3 ao = aoEnabled && " + _i68.result + " ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);", "vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");
        var p = "1.0";
        this.mask && (this.mask.analyze(e), p = "luminance(".concat(this.mask.flow(e, "v3").result, ")")), f.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(l.result, " * ").concat(p, " * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(l.result, " * ").concat(p, ", ").concat(u.result, " );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")), c && f.push(c.code, "outgoingLight = spe_blend(outgoingLight, ".concat(c.result, ", 1.0, SPE_BLENDING_NORMAL);")), d ? f.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(d.result, ");")) : f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"), h && f.push("gl_FragColor.a *= ".concat(h.result, ";")), f.push("#include <encodings_fragment>", "#include <fog_fragment>", "#include <dithering_fragment>"), r = f.join("\n");
      }
      return r;
    }
  }]);
  return bm;
}(ki);
var Sm = /*#__PURE__*/function (_ki5) {
  _inherits(Sm, _ki5);
  var _super189 = _createSuper(Sm);
  function Sm() {
    var _this184;
    _classCallCheck(this, Sm);
    _this184 = _super189.call(this, "standard");
    _this184.nodeType = "Standard";
    _this184.color = new Yt(Xr), _this184.roughness = new Ce(.3), _this184.metalness = new Ce(0), _this184.reflectivity = new Ce(.5), _this184.previousModelViewMatrix = new Qi(), _this184.previouseProjectionMatrix = new Qi(), _this184.shadingAlpha = new Ce(1), _this184.shadingBlend = new xt(0), _this184.occlusion = new Vr(!0);
    return _this184;
  }
  _createClass(Sm, [{
    key: "category",
    get: function get() {
      return "physical";
    }
  }, {
    key: "build",
    value: function build(e) {
      var r;
      if (e.define("STANDARD"), e.requires.lights = !0, e.extensions.derivatives = !0, e.extensions.shaderTextureLOD = !0, e.isShader("vertex")) {
        var i = this.position ? this.position.analyzeAndFlow(e, "v3", {
          cache: "position"
        }) : void 0;
        e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          resolution: We.resolution
        }), e.mergeUniform({
          previousModelViewMatrix: this.previousModelViewMatrix
        }), e.mergeUniform({
          previousProjectionMatrix: this.previouseProjectionMatrix
        }), e.mergeUniform(Ns.merge([Ae.fog, Ae.lights])), Ae.LTC_1 && (e.uniforms.ltc_1 = {
          value: void 0
        }, e.uniforms.ltc_2 = {
          value: void 0
        }), e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "#include <fog_pars_vertex>", "#include <normal_pars_vertex>", "#include <shadowmap_pars_vertex>", "#include <clipping_planes_pars_vertex>"].join("\n"));
        var s = ["#include <beginnormal_vertex>", "\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t", "#include <normal_vertex>", "\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];
        i && s.push(i.code, i.result ? "displaced_position = " + i.result + ";" : ""), s.push("transformed = displaced_position;", "transformedNormal = normalMatrix * displaced_normal;", "#ifndef FLAT_SHADED", "    vNormal = transformedNormal;", "#endif"), s.push("#include <project_vertex>", "#include <fog_vertex>", "#include <clipping_planes_vertex>", "	vViewPosition = - mvPosition.xyz;", "#include <worldpos_vertex>", "#include <shadowmap_vertex>"), s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"), r = s.join("\n");
      } else {
        e.mergeUniform({
          penumbraSize: We.penumbraSize
        }), e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          aoMap: We.aoRenderTarget
        }), e.mergeUniform({
          aoEnabled: We.aoEnabled
        });
        var _i69 = {
          gamma: !0
        };
        this.color === void 0 && (this.color = new Yt(Xr)), this.color.analyze(e, {
          slot: "color",
          context: _i69
        }), this.roughness.analyze(e), this.metalness.analyze(e);
        var _s33 = this.occlusion.flow(e, "b", {
          slot: "occlusion"
        });
        this.shadingAlpha.analyze(e), this.shadingBlend.analyze(e), this.afterColor && this.afterColor.analyze(e, {
          slot: "afterColor"
        }), this.alpha && this.alpha.analyze(e), this.reflectivity && this.reflectivity.analyze(e);
        var o = this.color.flow(e, "c", {
            slot: "color",
            context: _i69
          }),
          a = this.roughness.flow(e, "f"),
          l = this.metalness.flow(e, "f"),
          u = this.shadingAlpha.flow(e, "f"),
          c = this.shadingBlend.flow(e, "i"),
          d = this.afterColor ? this.afterColor.flow(e, "c", {
            slot: "afterColor"
          }) : void 0,
          h = this.alpha ? this.alpha.flow(e, "f") : void 0,
          f = this.alphaOverride ? this.alphaOverride.flow(e, "f") : void 0,
          p = this.reflectivity ? this.reflectivity.flow(e, "f") : void 0;
        e.requires.transparent = h !== void 0, e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "uniform float penumbraSize[".concat(5, "];"), "uniform sampler2D aoMap;", "uniform bool aoEnabled;", "#include <normal_pars_fragment>", "#include <dithering_pars_fragment>", "#include <fog_pars_fragment>", "#include <bsdfs>", "#include <lights_pars_begin>", "#include <lights_physical_pars_fragment>", "#include <shadowmap_pars_fragment>"].join("\n"));
        var m = ["#include <clipping_planes_fragment>", "	#include <normal_fragment_begin>", "\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t", "	PhysicalMaterial material;", "	material.diffuseColor = vec3( 1.0 );"];
        if (this.bumpMap) {
          e.include(Ca.dHdxy), e.include(Ca.perturbNormalArb);
          var y = this.bumpMap.texture.flow(e, "t"),
            v = this.bumpMap.flow(e, "v3"),
            x = this.bumpMapIntensity ? this.bumpMapIntensity.flow(e, "f").result : "1.0",
            S = "";
          this.bumpMap.projection.value === 4 ? S = "\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(y.result, ", uv0, ").concat(x, ");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(y.result, ", uv1, ").concat(x, ");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(y.result, ", uv2, ").concat(x, ");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t") : S = "\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(y.result, ", bumpMapCachedUv, ").concat(x, ");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"), m.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(v.result, ";\n\t\t\t\t\t").concat(S, "\n\t\t\t\t\t"));
        }
        if (m.push(o.code, "	vec3 diffuseColor = " + o.result + ";", "	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );", l.code, "	float metalnessFactor = " + l.result + ";"), this.roughnessMap) {
          var _y37 = this.roughnessMap.texture.flow(e, "t"),
            _v28 = this.roughnessMap.flow(e, "v3"),
            _x30 = "";
          this.roughnessMap.projection.value === 4 ? _x30 = "\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.roughnessMap.uuid.toString().replace(/-/g, ""), "_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g, ""), "_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g, ""), "_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.roughnessMap.uuid.toString().replace(/-/g, ""), "_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(").concat(_y37.result, ", uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(").concat(_y37.result, ", uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(").concat(_y37.result, ", uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ").concat(a.result, ";\n\t\t\t\t\t") : _x30 = "\n\t\t\t\t\tvec2 roughnessMapCachedUv = g".concat(this.roughnessMap.uuid.toString().replace(/-/g, ""), "_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(").concat(_y37.result, ",  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ").concat(a.result, ";\n\t\t\t\t\t"), m.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(_v28.result, ";\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t").concat(_x30, "\n\t\t\t\t"));
        } else m.push(a.code, "	float roughnessFactor = " + a.result + ";");
        h && m.push(h.code, "#ifdef ALPHATEST", "	if ( " + h.result + " <= ALPHATEST ) discard;", "#endif"), m.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );", "float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"), m.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );", "material.roughness = max( roughnessFactor, 0.0525 );", "material.roughness += geometryRoughness;", "material.roughness = min( material.roughness, 1.0 );", "material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"), p ? m.push(p.code, "material.specularColor = mix( vec3( 0.16 * pow2( " + p.result + " ) ), diffuseColor, metalnessFactor );") : m.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"), m.push("#include <lights_fragment_begin>"), m.push("#include <lights_fragment_end>"), m.push("vec3 ao = aoEnabled && " + _s33.result + " ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);", "vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");
        var g = "1.0";
        this.mask && (this.mask.analyze(e), g = "luminance(".concat(this.mask.flow(e, "v3").result, ")")), m.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(u.result, " * ").concat(g, " * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(u.result, " * ").concat(g, ", ").concat(c.result, " );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")), d && m.push(d.code, "outgoingLight = spe_blend(outgoingLight, ".concat(d.result, ", 1.0, SPE_BLENDING_NORMAL);")), h ? m.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(h.result, " );")) : m.push("gl_FragColor = vec4( outgoingLight, 1.0 );"), f && m.push("gl_FragColor.a *= ".concat(f.result, ";")), m.push("#include <encodings_fragment>", "#include <fog_fragment>", "#include <dithering_fragment>"), r = m.join("\n");
      }
      return r;
    }
  }]);
  return Sm;
}(ki);
var wm = /*#__PURE__*/function (_ki6) {
  _inherits(wm, _ki6);
  var _super190 = _createSuper(wm);
  function wm() {
    var _this185;
    _classCallCheck(this, wm);
    _this185 = _super190.call(this, "toon");
    _this185.nodeType = "Toon";
    _this185.color = new Yt(Xr), _this185.specular = new Yt(1118481), _this185.shininess = new Ce(30), _this185.previousModelViewMatrix = new Qi(), _this185.previouseProjectionMatrix = new Qi(), _this185.shadingAlpha = new Ce(1), _this185.shadingBlend = new xt(0);
    return _this185;
  }
  _createClass(wm, [{
    key: "category",
    get: function get() {
      return "toon";
    }
  }, {
    key: "build",
    value: function build(e) {
      var r;
      if (e.define("TOON"), e.requires.lights = !0, e.extensions.derivatives = !0, e.isShader("vertex")) {
        var i = this.position ? this.position.analyzeAndFlow(e, "v3", {
          cache: "position"
        }) : void 0;
        e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          resolution: We.resolution
        }), e.mergeUniform({
          previousModelViewMatrix: this.previousModelViewMatrix
        }), e.mergeUniform({
          previousProjectionMatrix: this.previouseProjectionMatrix
        }), e.mergeUniform(Ns.merge([Ae.fog, Ae.lights])), e.addParsCode(["varying vec3 vViewPosition;", "varying vec3 vWPosition;", "#include <fog_pars_vertex>", "#include <normal_pars_vertex>", "#include <shadowmap_pars_vertex>", "#include <clipping_planes_pars_vertex>"].join("\n"));
        var s = ["#include <beginnormal_vertex>", "\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t", "#include <normal_vertex>", "\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];
        i && s.push(i.code, i.result ? "displaced_position = " + i.result + ";" : ""), s.push("transformed = displaced_position;", "transformedNormal = normalMatrix * displaced_normal;", "#ifndef FLAT_SHADED", "    vNormal = transformedNormal;", "#endif"), s.push("	#include <project_vertex>", "	#include <fog_vertex>", "	#include <clipping_planes_vertex>", "	vViewPosition = - mvPosition.xyz;", "	#include <worldpos_vertex>", "	#include <shadowmap_vertex>", "	#include <fog_vertex>"), s.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"), r = s.join("\n");
      } else {
        e.mergeUniform({
          penumbraSize: We.penumbraSize
        }), e.mergeUniform({
          frameIndex: We.frameIndex
        }), e.mergeUniform({
          aoMap: We.aoRenderTarget
        }), e.mergeUniform({
          aoEnabled: We.aoEnabled
        }), this.color === void 0 && (this.color = new Yt(Xr)), this.color.analyze(e, {
          slot: "color"
        }), this.specular.analyze(e), this.shininess.analyze(e), this.shadingAlpha.analyze(e), this.shadingBlend.analyze(e), this.afterColor && this.afterColor.analyze(e, {
          slot: "afterColor"
        }), this.alpha && this.alpha.analyze(e);
        var _i70 = this.color.flow(e, "c", {
            slot: "color"
          }),
          _s34 = this.specular.flow(e, "c"),
          o = this.shininess.flow(e, "f"),
          a = this.shadingAlpha.flow(e, "f"),
          l = this.shadingBlend.flow(e, "i"),
          u = this.afterColor ? this.afterColor.flow(e, "c", {
            slot: "afterColor"
          }) : void 0,
          c = this.alpha ? this.alpha.flow(e, "f") : void 0,
          d = this.alphaOverride ? this.alphaOverride.flow(e, "f") : void 0;
        e.requires.transparent = c !== void 0, e.addParsCode(["uniform float penumbraSize[".concat(5, "];"), "uniform sampler2D aoMap;", "uniform bool aoEnabled;", "varying vec3 vWPosition;", "#include <normal_pars_fragment>", "#include <gradientmap_pars_fragment>", "#include <fog_pars_fragment>", "#include <bsdfs>", "#include <lights_pars_begin>", "#include <dithering_pars_fragment>", "\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t", "#include <shadowmap_pars_fragment>", "#include <bumpmap_pars_fragment>", "#include <normalmap_pars_fragment>"].join("\n"));
        var h = ["#include <normal_fragment_begin>", "\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t", "	ToonMaterial material;"];
        if (this.bumpMap) {
          e.include(Ca.dHdxy), e.include(Ca.perturbNormalArb);
          var p = this.bumpMap.texture.flow(e, "t"),
            m = this.bumpMap.flow(e, "v3"),
            g = this.bumpMapIntensity ? this.bumpMapIntensity.flow(e, "f").result : "1.0",
            y = "";
          this.bumpMap.projection.value === 4 ? y = "\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(p.result, ", uv0, ").concat(g, ");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(p.result, ", uv1, ").concat(g, ");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(p.result, ", uv2, ").concat(g, ");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t") : y = "\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g, ""), "_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(p.result, ", bumpMapCachedUv, ").concat(g, ");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"), h.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(m.result, ";\n\t\t\t\t\t").concat(y, "\n\t\t\t\t\t"));
        }
        h.push(_i70.code, "	vec3 diffuseColor = " + _i70.result + ";", "	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );", _s34.code, "	vec3 specular = " + _s34.result + ";", o.code, "	float shininess = max( 0.0001, " + o.result + " );", "	float specularStrength = 1.0;"), c && h.push(c.code, "#ifdef ALPHATEST", "if ( " + c.result + " <= ALPHATEST ) discard;", "#endif"), h.push("material.diffuseColor = diffuseColor;"), h.push("material.specularColor = specular;", "material.specularShininess = shininess;", "material.specularStrength = specularStrength;", "#include <lights_fragment_begin>", "#include <lights_fragment_end>"), h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);", "vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");
        var f = "1.0";
        this.mask && (this.mask.analyze(e), f = "luminance(".concat(this.mask.flow(e, "v3").result, ")")), h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(a.result, " * ").concat(f, " * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(a.result, " * ").concat(f, ", ").concat(l.result, " );\n\t\t\t\t}\n\t\t\t\t")), u && h.push(u.code, "outgoingLight = spe_blend(outgoingLight, ".concat(u.result, ", 1.0, SPE_BLENDING_NORMAL);")), c ? h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result, " );")) : h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"), d && h.push("gl_FragColor.a *= ".concat(d.result, ";")), h.push("#include <encodings_fragment>", "#include <fog_fragment>", "#include <dithering_fragment>"), r = h.join("\n");
      }
      return r;
    }
  }]);
  return wm;
}(ki);
var V0 = /*#__PURE__*/function () {
  function V0() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1e3 * 10;
    _classCallCheck(this, V0);
    this.timeout = t;
    this.cache = new Map();
    this.head = {
      data: null,
      time: 0,
      src: null,
      next: null,
      prev: null
    };
    this.tail = {
      data: null,
      time: 1 / 0,
      src: null,
      next: null,
      prev: null
    };
    this.hasClean = !1;
    this.head.next = this.tail, this.tail.prev = this.head;
  }
  _createClass(V0, [{
    key: "log",
    value: function log() {}
  }, {
    key: "remove",
    value: function remove(t) {
      var e = this.cache.get(t);
      e && (this.dispose(t, e.data), this.cache.delete(t), e.prev.next = e.next, e.next.prev = e.prev);
    }
  }, {
    key: "scheduleCleanup",
    value: function scheduleCleanup() {
      var _this186 = this;
      this.hasClean || (this.log("scheduled cleanup"), this.hasClean = !0, setTimeout(function () {
        _this186.hasClean = !1, _this186.log("cleaning");
        var t = Date.now(),
          e = _this186.head.next;
        for (; e.time < t - _this186.timeout;) _this186.dispose(e.src, e.data), _this186.cache.delete(e.src), e = e.next, e.prev = _this186.head, _this186.head.next = e;
        _this186.head.next !== _this186.tail ? _this186.scheduleCleanup() : _this186.log("no more cleanup");
      }, this.timeout + 1e3));
    }
  }, {
    key: "has",
    value: function has(t) {
      var _this$cache$get;
      return (_this$cache$get = this.cache.get(t)) === null || _this$cache$get === void 0 ? void 0 : _this$cache$get.data;
    }
  }, {
    key: "load",
    value: function load(t) {
      var e = Date.now(),
        r = this.cache.get(t);
      return r === void 0 ? (r = {
        data: this.create(t),
        src: t,
        time: e,
        next: null,
        prev: null
      }, this.cache.set(t, r)) : (r.time = e, r.prev.next = r.next, r.next.prev = r.prev), r.prev = this.tail.prev, r.next = this.tail, this.tail.prev.next = r, this.tail.prev = r, this.scheduleCleanup(), r.data;
    }
  }]);
  return V0;
}();
var FA = /*#__PURE__*/function (_V11) {
    _inherits(FA, _V11);
    var _super191 = _createSuper(FA);
    function FA() {
      _classCallCheck(this, FA);
      return _super191.apply(this, arguments);
    }
    _createClass(FA, [{
      key: "create",
      value: function create(t) {
        return URL.createObjectURL(new Blob([t]));
      }
    }, {
      key: "dispose",
      value: function dispose(t, e) {
        URL.revokeObjectURL(e);
      }
    }]);
    return FA;
  }(V0),
  NA;
function FI(n) {
  return typeof n == "string" ? n : (NA || (NA = new FA()), NA.load(n));
}
var U0 = /*#__PURE__*/function () {
    function U0(t, e) {
      _classCallCheck(this, U0);
      this.data = t;
      this.cache = e;
      this.refCount = 0;
    }
    _createClass(U0, [{
      key: "deref",
      value: function deref() {
        if (this.refCount === 0 && !1) throw new Error("ref count -1?");
        this.refCount -= 1, this.refCount === 0 && (this.cache.remove(this), this.dispose());
      }
    }, {
      key: "dispose",
      value: function dispose() {
        if (this.refCount !== 0 && !1) throw new Error("ref count is not 0");
      }
    }]);
    return U0;
  }(),
  G0 = /*#__PURE__*/function () {
    function G0() {
      _classCallCheck(this, G0);
      this.cache = new Map();
    }
    _createClass(G0, [{
      key: "remove",
      value: function remove(t) {
        if (this.cache.delete(t.data) === !1 && !1) throw new Error("ref count remove non-exists");
      }
    }, {
      key: "load",
      value: function load(t) {
        var e = this.cache.get(t);
        return e === void 0 && (e = this.create(t), this.cache.set(t, e)), e.refCount += 1, e;
      }
    }]);
    return G0;
  }();
var Zh = /*#__PURE__*/function (_U13) {
  _inherits(Zh, _U13);
  var _super192 = _createSuper(Zh);
  function Zh(e, r) {
    var _this187;
    _classCallCheck(this, Zh);
    _this187 = _super192.call(this, e, r.imageHolderCache);
    _this187.data = e;
    _this187.shared = r;
    _this187.loaded = !1;
    _this187.isVideo = !1;
    _this187.isCanvas = !1;
    _this187.isVideo = e.type === "video", _this187.isCanvas = e.nodeName === "CANVAS", _this187.updateSrc(_this187.isCanvas ? e : e.data);
    return _this187;
  }
  _createClass(Zh, [{
    key: "updateSrc",
    value: function () {
      var _updateSrc = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e) {
        var _this188 = this;
        var r, i, s;
        return _regeneratorRuntime().wrap(function _callee8$(_context14) {
          while (1) switch (_context14.prev = _context14.next) {
            case 0:
              if (!((typeof document === "undefined" ? "undefined" : _typeof(document)) > "u")) {
                _context14.next = 2;
                break;
              }
              return _context14.abrupt("return");
            case 2:
              this.disposeTextures(), this.loaded = !1;
              r = function r() {
                _this188.loaded = !0;
                var s = [1e3, 1001, 1002];
                for (var _i71 = 0, _s35 = s; _i71 < _s35.length; _i71++) {
                  var o = _s35[_i71];
                  var a = _this188[o];
                  a && (a.image = _this188.img, a.needsUpdate = !0);
                }
                _this188.shared.requestRender();
              };
              if (!this.isCanvas) {
                _context14.next = 8;
                break;
              }
              this.img = e, this.loaded = !0;
              _context14.next = 22;
              break;
            case 8:
              if (!this.isVideo) {
                _context14.next = 21;
                break;
              }
              if (!(this.img = document.createElement("video"), this.img.preload = "auto", this.img.playsInline = !0, this.img.currentTime = .01, typeof e != "string")) {
                _context14.next = 17;
                break;
              }
              i = new FileReader();
              i.readAsDataURL(new Blob([e], {
                type: "video/mp4"
              }));
              _context14.next = 14;
              return new Promise(function (o) {
                i.onloadend = function (a) {
                  var _a$target;
                  s = (_a$target = a.target) === null || _a$target === void 0 ? void 0 : _a$target.result, o(null);
                };
              });
            case 14:
              this.img.src = s;
              _context14.next = 18;
              break;
            case 17:
              this.img.src = e;
            case 18:
              this.img.onloadeddata = function () {
                r();
              };
              _context14.next = 22;
              break;
            case 21:
              this.img = new Image(), this.img.src = FI(e), this.img.onload = r;
            case 22:
            case "end":
              return _context14.stop();
          }
        }, _callee8, this);
      }));
      function updateSrc(_x31) {
        return _updateSrc.apply(this, arguments);
      }
      return updateSrc;
    }()
  }, {
    key: "getTexture",
    value: function getTexture(e) {
      var r = this[e];
      if (r) return r;
      {
        var i;
        return this.isCanvas && (i = new dy(this.img, void 0, e, e)), this.isVideo ? i = new uy(this.img, void 0, e, e) : i = new qt(this.img, void 0, e, e), this.loaded && (i.needsUpdate = !0), this[e] = i, i;
      }
    }
  }, {
    key: "setNeedsUpdate",
    value: function setNeedsUpdate(e) {
      var r = [1e3, 1001, 1002];
      for (var _i72 = 0, _r34 = r; _i72 < _r34.length; _i72++) {
        var i = _r34[_i72];
        var s = this[i];
        s && (s.needsUpdate = e);
      }
    }
  }, {
    key: "disposeTextures",
    value: function disposeTextures() {
      var _this$, _this$2, _this$3;
      (_this$ = this[1e3]) !== null && _this$ !== void 0 && _this$.dispose(), this[1e3] = void 0, (_this$2 = this[1001]) !== null && _this$2 !== void 0 && _this$2.dispose(), this[1001] = void 0, (_this$3 = this[1002]) !== null && _this$3 !== void 0 && _this$3.dispose(), this[1002] = void 0;
    }
  }, {
    key: "dispose",
    value: function dispose() {
      _get(_getPrototypeOf(Zh.prototype), "dispose", this).call(this), this.disposeTextures();
    }
  }]);
  return Zh;
}(U0);
1e3, 1001, 1002;
var Zn = /*#__PURE__*/function (_Zh) {
  _inherits(Zn, _Zh);
  var _super193 = _createSuper(Zn);
  function Zn() {
    _classCallCheck(this, Zn);
    return _super193.apply(this, arguments);
  }
  return _createClass(Zn);
}(Zh);
function zA(n, t) {
  var e = KY(t);
  return e.formatToParts ? XY(e, n) : QY(e, n);
}
var YY = {
  year: 0,
  month: 1,
  day: 2,
  hour: 3,
  minute: 4,
  second: 5
};
function XY(n, t) {
  try {
    for (var e = n.formatToParts(t), r = [], i = 0; i < e.length; i++) {
      var s = YY[e[i].type];
      s >= 0 && (r[s] = parseInt(e[i].value, 10));
    }
    return r;
  } catch (o) {
    if (o instanceof RangeError) return [NaN];
    throw o;
  }
}
function QY(n, t) {
  var e = n.format(t).replace(/\u200E/g, ""),
    r = /(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(e);
  return [r[3], r[1], r[2], r[4], r[5], r[6]];
}
var kA = {};
function KY(n) {
  if (!kA[n]) {
    var t = new Intl.DateTimeFormat("en-US", {
        hour12: !1,
        timeZone: "America/New_York",
        year: "numeric",
        month: "numeric",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      }).format(new Date("2014-06-25T04:00:00.123Z")),
      e = t === "06/25/2014, 00:00:00" || t === "\u200E06\u200E/\u200E25\u200E/\u200E2014\u200E \u200E00\u200E:\u200E00\u200E:\u200E00";
    kA[n] = e ? new Intl.DateTimeFormat("en-US", {
      hour12: !1,
      timeZone: n,
      year: "numeric",
      month: "numeric",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    }) : new Intl.DateTimeFormat("en-US", {
      hourCycle: "h23",
      timeZone: n,
      year: "numeric",
      month: "numeric",
      day: "2-digit",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit"
    });
  }
  return kA[n];
}
function j0(n, t, e, r, i, s, o) {
  var a = new Date(0);
  return a.setUTCFullYear(n, t, e), a.setUTCHours(r, i, s, o), a;
}
var kI = 36e5,
  ZY = 6e4,
  VA = {
    timezone: /([Z+-].*)$/,
    timezoneZ: /^(Z)$/,
    timezoneHH: /^([+-]\d{2})$/,
    timezoneHHMM: /^([+-]\d{2}):?(\d{2})$/
  };
function Am(n, t, e) {
  var r, i;
  if (!n || (r = VA.timezoneZ.exec(n), r)) return 0;
  var s;
  if (r = VA.timezoneHH.exec(n), r) return s = parseInt(r[1], 10), zI(s) ? -(s * kI) : NaN;
  if (r = VA.timezoneHHMM.exec(n), r) {
    s = parseInt(r[1], 10);
    var o = parseInt(r[2], 10);
    return zI(s, o) ? (i = Math.abs(s) * kI + o * ZY, s > 0 ? -i : i) : NaN;
  }
  if (e7(n)) {
    t = new Date(t || Date.now());
    var a = e ? t : JY(t),
      l = UA(a, n),
      u = e ? l : $Y(t, l, n);
    return -u;
  }
  return NaN;
}
function JY(n) {
  return j0(n.getFullYear(), n.getMonth(), n.getDate(), n.getHours(), n.getMinutes(), n.getSeconds(), n.getMilliseconds());
}
function UA(n, t) {
  var e = zA(n, t),
    r = j0(e[0], e[1] - 1, e[2], e[3] % 24, e[4], e[5], 0).getTime(),
    i = n.getTime(),
    s = i % 1e3;
  return i -= s >= 0 ? s : 1e3 + s, r - i;
}
function $Y(n, t, e) {
  var r = n.getTime(),
    i = r - t,
    s = UA(new Date(i), e);
  if (t === s) return t;
  i -= s - t;
  var o = UA(new Date(i), e);
  return s === o ? s : Math.max(s, o);
}
function zI(n, t) {
  return -23 <= n && n <= 23 && (t == null || 0 <= t && t <= 59);
}
var VI = {};
function e7(n) {
  if (VI[n]) return !0;
  try {
    return new Intl.DateTimeFormat(void 0, {
      timeZone: n
    }), VI[n] = !0, !0;
  } catch (_unused27) {
    return !1;
  }
}
var KI = Pi(GI(), 1),
  HA = Pi(HI(), 1);
var i7 = /(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,
  WI = i7;
var GA = 36e5,
  qI = 6e4,
  n7 = 2,
  bn = {
    dateTimePattern: /^([0-9W+-]+)(T| )(.*)/,
    datePattern: /^([0-9W+-]+)(.*)/,
    plainTime: /:/,
    YY: /^(\d{2})$/,
    YYY: [/^([+-]\d{2})$/, /^([+-]\d{3})$/, /^([+-]\d{4})$/],
    YYYY: /^(\d{4})/,
    YYYYY: [/^([+-]\d{4})/, /^([+-]\d{5})/, /^([+-]\d{6})/],
    MM: /^-(\d{2})$/,
    DDD: /^-?(\d{3})$/,
    MMDD: /^-?(\d{2})-?(\d{2})$/,
    Www: /^-?W(\d{2})$/,
    WwwD: /^-?W(\d{2})-?(\d{1})$/,
    HH: /^(\d{2}([.,]\d*)?)$/,
    HHMM: /^(\d{2}):?(\d{2}([.,]\d*)?)$/,
    HHMMSS: /^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,
    timeZone: WI
  };
function WA(n, t) {
  if (arguments.length < 1) throw new TypeError("1 argument required, but only " + arguments.length + " present");
  if (n === null) return new Date(NaN);
  var e = t || {},
    r = e.additionalDigits == null ? n7 : (0, KI.default)(e.additionalDigits);
  if (r !== 2 && r !== 1 && r !== 0) throw new RangeError("additionalDigits must be 0, 1 or 2");
  if (n instanceof Date || _typeof(n) == "object" && Object.prototype.toString.call(n) === "[object Date]") return new Date(n.getTime());
  if (typeof n == "number" || Object.prototype.toString.call(n) === "[object Number]") return new Date(n);
  if (!(typeof n == "string" || Object.prototype.toString.call(n) === "[object String]")) return new Date(NaN);
  var i = s7(n),
    s = o7(i.date, r),
    o = s.year,
    a = s.restDateString,
    l = a7(a, o);
  if (isNaN(l)) return new Date(NaN);
  if (l) {
    var u = l.getTime(),
      c = 0,
      d;
    if (i.time && (c = l7(i.time), isNaN(c))) return new Date(NaN);
    if (i.timeZone || e.timeZone) {
      if (d = Am(i.timeZone || e.timeZone, new Date(u + c)), isNaN(d)) return new Date(NaN);
    } else d = (0, HA.default)(new Date(u + c)), d = (0, HA.default)(new Date(u + c + d));
    return new Date(u + c + d);
  } else return new Date(NaN);
}
function s7(n) {
  var t = {},
    e = bn.dateTimePattern.exec(n),
    r;
  if (e ? (t.date = e[1], r = e[3]) : (e = bn.datePattern.exec(n), e ? (t.date = e[1], r = e[2]) : (t.date = null, r = n)), r) {
    var i = bn.timeZone.exec(r);
    i ? (t.time = r.replace(i[1], ""), t.timeZone = i[1].trim()) : t.time = r;
  }
  return t;
}
function o7(n, t) {
  var e = bn.YYY[t],
    r = bn.YYYYY[t],
    i;
  if (i = bn.YYYY.exec(n) || r.exec(n), i) {
    var s = i[1];
    return {
      year: parseInt(s, 10),
      restDateString: n.slice(s.length)
    };
  }
  if (i = bn.YY.exec(n) || e.exec(n), i) {
    var o = i[1];
    return {
      year: parseInt(o, 10) * 100,
      restDateString: n.slice(o.length)
    };
  }
  return {
    year: null
  };
}
function a7(n, t) {
  if (t === null) return null;
  var e, r, i, s;
  if (n.length === 0) return r = new Date(0), r.setUTCFullYear(t), r;
  if (e = bn.MM.exec(n), e) return r = new Date(0), i = parseInt(e[1], 10) - 1, XI(t, i) ? (r.setUTCFullYear(t, i), r) : new Date(NaN);
  if (e = bn.DDD.exec(n), e) {
    r = new Date(0);
    var o = parseInt(e[1], 10);
    return d7(t, o) ? (r.setUTCFullYear(t, 0, o), r) : new Date(NaN);
  }
  if (e = bn.MMDD.exec(n), e) {
    r = new Date(0), i = parseInt(e[1], 10) - 1;
    var a = parseInt(e[2], 10);
    return XI(t, i, a) ? (r.setUTCFullYear(t, i, a), r) : new Date(NaN);
  }
  if (e = bn.Www.exec(n), e) return s = parseInt(e[1], 10) - 1, QI(t, s) ? YI(t, s) : new Date(NaN);
  if (e = bn.WwwD.exec(n), e) {
    s = parseInt(e[1], 10) - 1;
    var l = parseInt(e[2], 10) - 1;
    return QI(t, s, l) ? YI(t, s, l) : new Date(NaN);
  }
  return null;
}
function l7(n) {
  var t, e, r;
  if (t = bn.HH.exec(n), t) return e = parseFloat(t[1].replace(",", ".")), jA(e) ? e % 24 * GA : NaN;
  if (t = bn.HHMM.exec(n), t) return e = parseInt(t[1], 10), r = parseFloat(t[2].replace(",", ".")), jA(e, r) ? e % 24 * GA + r * qI : NaN;
  if (t = bn.HHMMSS.exec(n), t) {
    e = parseInt(t[1], 10), r = parseInt(t[2], 10);
    var i = parseFloat(t[3].replace(",", "."));
    return jA(e, r, i) ? e % 24 * GA + r * qI + i * 1e3 : NaN;
  }
  return null;
}
function YI(n, t, e) {
  t = t || 0, e = e || 0;
  var r = new Date(0);
  r.setUTCFullYear(n, 0, 4);
  var i = r.getUTCDay() || 7,
    s = t * 7 + e + 1 - i;
  return r.setUTCDate(r.getUTCDate() + s), r;
}
var c7 = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],
  u7 = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
function ZI(n) {
  return n % 400 === 0 || n % 4 === 0 && n % 100 !== 0;
}
function XI(n, t, e) {
  if (t < 0 || t > 11) return !1;
  if (e != null) {
    if (e < 1) return !1;
    var r = ZI(n);
    if (r && e > u7[t] || !r && e > c7[t]) return !1;
  }
  return !0;
}
function d7(n, t) {
  if (t < 1) return !1;
  var e = ZI(n);
  return !(e && t > 366 || !e && t > 365);
}
function QI(n, t, e) {
  return !(t < 0 || t > 52 || e != null && (e < 0 || e > 6));
}
function jA(n, t, e) {
  return !(n != null && (n < 0 || n >= 25) || t != null && (t < 0 || t >= 60) || e != null && (e < 0 || e >= 60));
}
function q0(n, t, e) {
  var r = WA(n, e),
    i = Am(t, r, !0),
    s = new Date(r.getTime() - i),
    o = new Date(0);
  return o.setFullYear(s.getUTCFullYear(), s.getUTCMonth(), s.getUTCDate()), o.setHours(s.getUTCHours(), s.getUTCMinutes(), s.getUTCSeconds(), s.getUTCMilliseconds()), o;
}
function Ki(n, t) {
  return t.color(n);
}
function qA() {
  var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new Date();
  var t = arguments.length > 1 ? arguments[1] : undefined;
  var e = t.format,
    r = n.getSeconds(),
    i = n;
  t && t.timeZone !== null && (i = q0(new Date(), t.timeZone));
  var s = i.getHours(),
    o = i.getMinutes(),
    a;
  t.format12h24h === "12ampm" && (a = s >= 12 ? "PM" : "AM");
  var l = s;
  t.format12h24h !== "24" && (l = s % 12, l === 0 && (l = 12));
  var u, c;
  switch (e) {
    case "HH:mm:ss":
      u = [l, o, r];
      break;
    case "HH:mm":
      u = [l, o];
      break;
    case "HH":
      u = [l], a = void 0;
      break;
    case "mm":
      u = [o], a = void 0;
      break;
    case "ss":
      u = [r], a = void 0;
      break;
    case "year":
      c = i.getFullYear();
      break;
    case "month":
      c = i.getMonth() + 1;
      break;
    case "dayOfYear":
      c = Math.floor((i.getTime() - new Date(i.getFullYear(), 0, 0).getTime()) / 864e5);
      break;
    case "dayOfMonth":
      c = i.getDate();
      break;
    case "secondOfDay":
      c = s * 60 * 60 + o * 60 + r;
      break;
    default:
      console.error("Unknown time format", e), c = 0;
      break;
  }
  return u !== void 0 ? {
    textValue: u,
    suffix: a
  } : c;
}
function JI(n, t) {
  switch (n.type) {
    case "fresnel":
      return p7(n, t);
    case "gradient":
      return m7(n, t);
    case "depth":
      return g7(n, t);
    case "normal":
      return y7(n, t);
    case "noise":
      return v7(n, t);
    case "rainbow":
      return x7(n, t);
    case "toon":
      return b7(n, t);
    case "outline":
      return S7(n, t);
    case "transmission":
      return w7(n, t);
    case "color":
      return f7(n, t);
    case "pattern":
      return A7(n, t);
  }
}
function h7(n) {
  return {
    type: n.type
  };
}
function Xs(n, t) {
  var _Number;
  var e = n.alpha,
    r = n.mode,
    i = n.isMask,
    s = typeof e == "string" ? ((_Number = Number(t.getVariable(e))) !== null && _Number !== void 0 ? _Number : 100) / 100 : e;
  return _objectSpread(_objectSpread({}, h7(n)), {}, {
    alpha: s,
    mode: r,
    isMask: i
  });
}
function f7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    color: Ki(n.color, t)
  });
}
function p7(n, t) {
  var e = n.bias,
    r = n.scale,
    i = n.intensity,
    s = n.factor,
    o = n.color;
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    color: Ki(o, t),
    bias: e,
    scale: r,
    intensity: i,
    factor: s
  });
}
function m7(n, t) {
  var e = n.gradientType,
    r = n.smooth,
    i = n.colors,
    s = n.steps,
    o = n.angle,
    a = n.offset,
    l = n.morph;
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    gradientType: e,
    smooth: r,
    colors: i.map(function (u) {
      return new He(u[0], u[1], u[2], u[3]);
    }),
    num: i.length,
    steps: s,
    offset: _construct(N, _toConsumableArray(a)),
    morph: _construct(N, _toConsumableArray(l)),
    angle: o
  });
}
function g7(n, t) {
  var e = n.gradientType,
    r = n.near,
    i = n.far,
    s = n.isVector,
    o = n.isWorldSpace,
    a = n.origin,
    l = n.direction,
    u = n.colors,
    c = n.steps,
    d = n.smooth;
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    gradientType: e,
    near: r,
    far: i,
    isVector: s,
    isWorldSpace: o,
    origin: _construct(_, _toConsumableArray(a)),
    direction: l ? _construct(_, _toConsumableArray(l)) : new _(1, 0, 0),
    colors: u.map(function (h) {
      return h !== void 0 ? new He(h[0], h[1], h[2], h[3]) : new He(0, 0, 0, 0);
    }),
    steps: c.slice(0, u.length),
    smooth: d
  });
}
function y7(n, t) {
  var e = n.cnormal;
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    cnormal: new _(e[0], e[1], e[2])
  });
}
function v7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    scale: n.scale,
    move: n.move,
    fA: _construct(N, _toConsumableArray(n.fA)),
    fB: _construct(N, _toConsumableArray(n.fB)),
    size: _construct(_, _toConsumableArray(n.size)),
    distortion: _construct(N, _toConsumableArray(n.distortion)),
    colorA: Ki(n.colorA, t),
    colorB: Ki(n.colorB, t),
    colorC: Ki(n.colorC, t),
    colorD: Ki(n.colorD, t),
    noiseType: n.noiseType,
    voronoiStyle: n.voronoiStyle,
    highCut: n.highCut,
    lowCut: n.lowCut,
    smoothness: n.smoothness,
    seed: n.seed,
    quality: n.quality
  });
}
function x7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    filmThickness: n.filmThickness,
    movement: n.movement,
    wavelengths: _construct(_, _toConsumableArray(n.wavelengths)),
    noiseStrength: n.noiseStrength,
    noiseScale: n.noiseScale,
    offset: _construct(_, _toConsumableArray(n.offset))
  });
}
function b7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    positioning: n.positioning,
    colors: n.colors.map(function (e) {
      return new He(e[0], e[1], e[2], e[3]);
    }),
    num: n.colors.length,
    steps: n.steps,
    source: _construct(_, _toConsumableArray(n.source)),
    isWorldSpace: n.isWorldSpace,
    noiseStrength: n.noiseStrength,
    noiseScale: n.noiseScale,
    shadowColor: Ki(n.shadowColor, t),
    offset: _construct(_, _toConsumableArray(n.offset))
  });
}
function S7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    outlineColor: Ki(n.outlineColor, t),
    contourColor: Ki(n.contourColor, t),
    outlineWidth: n.outlineWidth,
    contourWidth: n.contourWidth,
    outlineThreshold: n.outlineThreshold,
    contourThreshold: n.contourThreshold,
    outlineSmoothing: n.outlineSmoothing,
    contourFrequency: n.contourFrequency,
    contourDirection: _construct(_, _toConsumableArray(n.contourDirection)),
    positionalLines: n.positionalLines,
    compensation: n.compensation
  });
}
function w7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    thickness: n.thickness,
    ior: n.ior,
    roughness: n.roughness
  });
}
function A7(n, t) {
  return _objectSpread(_objectSpread({}, Xs(n, t)), {}, {
    style: n.style,
    projection: n.projection,
    axis: n.axis,
    blending: n.blending,
    offset: _construct(N, _toConsumableArray(n.offset)),
    colorA: Ki(n.colorA, t),
    colorB: Ki(n.colorB, t),
    frequency: _construct(N, _toConsumableArray(n.frequency)),
    size: n.size,
    variation: n.variation,
    smoothness: n.smoothness,
    zigzag: n.zigzag,
    rotation: n.rotation,
    vertical: _construct(N, _toConsumableArray(n.vertical)),
    horizontal: _construct(N, _toConsumableArray(n.horizontal)),
    sides: n.sides
  });
}
var Bl = /*#__PURE__*/function (_cr) {
  _inherits(Bl, _cr);
  var _super194 = _createSuper(Bl);
  function Bl() {
    _classCallCheck(this, Bl);
    return _super194.apply(this, arguments);
  }
  return _createClass(Bl);
}(cr);
var YA = {
    noise: ["noiseType"],
    texture: ["projection", "axis", "side"],
    video: ["projection", "axis", "side"],
    displace: ["noiseType"],
    light: ["roughnessMap", "bumpMap"],
    depth: ["smooth", "isWorldSpace", "gradientType", "isVector"],
    pattern: ["style", "projection", "axis"]
  },
  XA = {
    depth: ["colors"]
  };
function _7(n, t, e) {
  if (t === "isMask") return !0;
  var r = YA[n.type],
    i = XA[n.type];
  if (i !== void 0) {
    var s = n.color;
    if (i.includes(t)) {
      var _s$t;
      var o = (_s$t = s[t]) === null || _s$t === void 0 || (_s$t = _s$t.value) === null || _s$t === void 0 ? void 0 : _s$t.length;
      if (o !== void 0 && o !== e.length) return !0;
    }
  }
  return r !== void 0 ? r.includes(t) : !1;
}
function QA(n, t, e) {
  var r = e.uniforms["f".concat(e.id, "_texture")];
  if (!r) return !1;
  var i = !1,
    s = n;
  if ("image" in s) {
    var o = s.image,
      a = t.image(o),
      l = r;
    l.image instanceof Zn || l.image.deref(), l.image = a;
  }
  if ("video" in s) {
    var _o29 = s.video,
      _a33 = t.video(_o29),
      _l61 = r;
    _l61.image instanceof Zn || _l61.image.deref(), _l61.image = _a33;
  }
  if ("wrapping" in s) {
    var _o30 = r;
    _o30.wrap = s.wrapping;
  }
  if ("repeat" in s || "offset" in s) {
    var _o31 = "mat",
      _a34 = e.uniforms["f".concat(e.id, "_").concat(_o31)];
    "repeat" in s && (_a34.repeat = s.repeat), "offset" in s && (_a34.offset = s.offset), _a34.updateMatrix();
  }
  return i;
}
function $I(n, t, e, r) {
  var i = !1;
  for (var _i73 = 0, _Object$entries13 = Object.entries(n); _i73 < _Object$entries13.length; _i73++) {
    var _Object$entries13$_i = _slicedToArray(_Object$entries13[_i73], 2),
      s = _Object$entries13$_i[0],
      o = _Object$entries13$_i[1];
    if (s === "bumpMap" || s === "roughnessMap") {
      i = !0;
      continue;
    }
    if (!s || o === void 0) continue;
    if (KA(s, e, r, t)) {
      s === "visible" && e.type === "light" && (i = !0);
      continue;
    }
    e.visible = r.visible;
    var a = e.uniforms["f".concat(e.id, "_").concat(s)];
    if (!!a && !(a instanceof Rl)) switch (i = i || _7(e, s, o), a.constructor) {
      case Yt:
        if (typeof o == "string") {
          var l = t.getColor(o);
          l && (a.value = l);
          break;
        } else {
          var _l62 = o;
          a.value instanceof Bl ? a.value = new cr(_l62.r, _l62.g, _l62.b, _l62.a) : a.setRGBA(_l62);
          break;
        }
      case On:
        if (typeof o == "string") {
          var _l63 = t.getColor(o);
          _l63 && (a.value = _l63);
          break;
        } else {
          var _l64 = o;
          a.value instanceof Bl ? a.value = new cr(_l64.r, _l64.g, _l64.b, _l64.a) : a.value.setRGBA(_l64.r, _l64.g, _l64.b, _l64.a);
          break;
        }
      case Lr:
        {
          var _l65 = o;
          a.value.setX(_l65[0]), a.value.setY(_l65[1]);
          break;
        }
      case Xi:
        {
          var _l66 = o;
          a.value.setX(_l66[0]), a.value.setY(_l66[1]), a.value.setZ(_l66[2]);
          break;
        }
      case xn:
        {
          QA(o, t, e);
          break;
        }
      case Ys:
        {
          a.value = o.map(function (l) {
            return _construct(He, _toConsumableArray(l));
          });
          break;
        }
      default:
        {
          a.value = o;
          break;
        }
    }
  }
  return i;
}
var Nl = function Nl(n, t, e) {
    var _Math$max, _t$getVariable;
    return (_Math$max = Math.max(0, Math.min(1, Number((_t$getVariable = t.getVariable(typeof n == "number" ? n * 100 : n, e)) !== null && _t$getVariable !== void 0 ? _t$getVariable : 100) / 100))) !== null && _Math$max !== void 0 ? _Math$max : 1;
  },
  Io = /*#__PURE__*/function () {
    function Io(t, e, r, i, s) {
      _classCallCheck(this, Io);
      this.id = t;
      this.uuid = e;
      this.data = r;
      this.uniforms = {};
      for (var o in i) this.uniforms["f".concat(this.id, "_").concat(o)] = i[o];
      for (var _o32 in r) KA(_o32, this, r, s);
    }
    _createClass(Io, [{
      key: "type",
      get: function get() {
        return this.data.type;
      }
    }, {
      key: "updateByOp",
      value: function updateByOp(t, e, r) {
        var i = t;
        if (i.path[0] === void 0) {
          if (i.type === 0) return "type" in i.props || "category" in i.props || "visible" in i.props ? (r.scene.markNeedsUpdateRendererDirty(), !0) : $I(i.props, r.shared, this, e);
        } else if (i.path[0] === "texture") return "texture" in e || "video" in e ? QA(i.props, r.shared, this) : !0;
        return !1;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        if (E7(this)) {
          var t = this.uniforms["f".concat(this.id, "_texture")];
          if (!t) return !1;
          var e = t;
          e.image instanceof Zn || e.image.deref();
        }
      }
    }, {
      key: "hasValueByKey",
      value: function hasValueByKey(t) {
        return this.uniforms[t] !== void 0;
      }
    }, {
      key: "hasValue",
      value: function hasValue(t) {
        return this.hasValueByKey("f".concat(this.id, "_").concat(t));
      }
    }, {
      key: "setValue",
      value: function setValue(t, e) {
        var r = "f".concat(this.id, "_").concat(t);
        this.hasValueByKey(r) && e !== void 0 && (this.uniforms[r].value = e);
      }
    }, {
      key: "getNode",
      value: function getNode(t) {
        var e = "f".concat(this.id, "_").concat(t);
        if (this.hasValueByKey(e)) return this.uniforms[e];
      }
    }, {
      key: "getValue",
      value: function getValue(t) {
        var e = "f".concat(this.id, "_").concat(t);
        if (this.hasValueByKey(e)) return this.uniforms[e].value;
      }
    }, {
      key: "getName",
      value: function getName(t) {
        var r = /f\d+_(.*)/.exec(t);
        if (r && r.length > 1) return r[1];
        console.log("Layer.getName: error ".concat(t));
      }
    }, {
      key: "getNames",
      value: function getNames() {
        var t = [];
        for (var e in this.uniforms) {
          var r = this.getName(e);
          r && t.push(r);
        }
        return t;
      }
    }], [{
      key: "create",
      value: function create(t, e, r, i) {
        if (r.type === "light") return Sn.createLigherLayer(t, e, r, i);
        if (r.type === "texture" || r.type === "video") {
          var _i$canvas, _r$projection, _indexOf, _r$side, _r$blending, _r$mode, _r$isMask;
          var s = r.type === "texture" ? (_i$canvas = i.canvas(r.texture.image)) !== null && _i$canvas !== void 0 ? _i$canvas : i.image(r.texture.image) : i.video(r.texture.video),
            o = new Vc(s, r.texture.wrapping),
            a = new F0(s),
            l = new k0(r.texture.repeat, r.texture.offset),
            u = new Ce(r.crop ? 1 : 0),
            c = new xt((_r$projection = r.projection) !== null && _r$projection !== void 0 ? _r$projection : 0),
            d = new xt((_indexOf = ["x", "y", "z"].indexOf(r.axis)) !== null && _indexOf !== void 0 ? _indexOf : 0),
            h = new xt((_r$side = r.side) !== null && _r$side !== void 0 ? _r$side : 0),
            f = new Lr(r.size ? new N(r.size[0], r.size[1]) : new N(100, 100)),
            p = new Ce((_r$blending = r.blending) !== null && _r$blending !== void 0 ? _r$blending : 0),
            m = new Ce(Nl(r.alpha, i)),
            g = new xt((_r$mode = r.mode) !== null && _r$mode !== void 0 ? _r$mode : 0),
            y = new Vr((_r$isMask = r.isMask) !== null && _r$isMask !== void 0 ? _r$isMask : !1),
            v = new Ll(o, a, u, c, d, h, f, p, l, m, g, y),
            x = new zt(v.calpha, "f");
          return new wr(t, e, r, {
            texture: o,
            textureSize: a,
            crop: u,
            projection: c,
            axis: d,
            side: h,
            size: f,
            blending: p,
            mat: l,
            alpha: m,
            mode: g,
            isMask: y
          }, v, g, x, y, i);
        } else if (r.type === "matcap") {
          var _r$mode2, _r$isMask2;
          var _s36 = i.image(r.texture.image),
            _o33 = new Vc(_s36, r.texture.wrapping),
            _a35 = new Ce(Nl(r.alpha, i)),
            _l67 = new xt((_r$mode2 = r.mode) !== null && _r$mode2 !== void 0 ? _r$mode2 : 0),
            _u39 = new Vr((_r$isMask2 = r.isMask) !== null && _r$isMask2 !== void 0 ? _r$isMask2 : !1),
            _c28 = new jh(_o33, _a35, _l67, _u39),
            _d45 = new zt(_c28.calpha, "f");
          return new wr(t, e, r, {
            texture: _o33,
            alpha: _a35,
            mode: _l67,
            isMask: _u39
          }, _c28, _l67, _d45, _u39, i);
        } else if (r.type === "displace") {
          if (r.displacementType === "noise") {
            var _r$scale, _r$intensity, _r$movement, _r$noiseType, _r$voronoiStyle, _r$smoothness, _r$seed, _r$highCut, _r$lowCut, _r$quality;
            var _s37 = new Xi(_construct(_, _toConsumableArray(r.offset))),
              _o34 = new Ce((_r$scale = r.scale) !== null && _r$scale !== void 0 ? _r$scale : 10),
              _a36 = new Ce((_r$intensity = r.intensity) !== null && _r$intensity !== void 0 ? _r$intensity : 8),
              _l68 = new Ce((_r$movement = r.movement) !== null && _r$movement !== void 0 ? _r$movement : 1),
              _u40 = new xt((_r$noiseType = r.noiseType) !== null && _r$noiseType !== void 0 ? _r$noiseType : 0),
              _c29 = new xt((_r$voronoiStyle = r.voronoiStyle) !== null && _r$voronoiStyle !== void 0 ? _r$voronoiStyle : 0),
              _d46 = new Ce((_r$smoothness = r.smoothness) !== null && _r$smoothness !== void 0 ? _r$smoothness : .5),
              _h65 = new Ce((_r$seed = r.seed) !== null && _r$seed !== void 0 ? _r$seed : 0),
              _f69 = new Ce((_r$highCut = r.highCut) !== null && _r$highCut !== void 0 ? _r$highCut : 1),
              _p44 = new Ce((_r$lowCut = r.lowCut) !== null && _r$lowCut !== void 0 ? _r$lowCut : 0),
              _m44 = new xt((_r$quality = r.quality) !== null && _r$quality !== void 0 ? _r$quality : 1),
              _g36 = new Kh(_a36, _l68, _s37, _c29, _d46, _h65, _f69, _p44, _m44, _o34, _u40);
            return new _m(t, e, r, {
              offset: _s37,
              scale: _o34,
              intensity: _a36,
              movement: _l68,
              noiseType: _u40,
              voronoiStyle: _c29,
              smoothness: _d46,
              seed: _h65,
              highCut: _f69,
              lowCut: _p44,
              quality: _m44
            }, _g36, i);
          } else throw new Error();
        } else return M7(t, e, r, i);
      }
    }]);
    return Io;
  }(),
  wr = /*#__PURE__*/function (_Io) {
    _inherits(wr, _Io);
    var _super195 = _createSuper(wr);
    function wr(e, r, i, s, o, a, l, u, c) {
      var _this189;
      _classCallCheck(this, wr);
      _this189 = _super195.call(this, e, r, i, s, c);
      _this189.params = s;
      _this189.color = o;
      _this189.mode = a;
      _this189.alpha = l;
      _this189.isMask = u;
      return _this189;
    }
    return _createClass(wr);
  }(Io),
  _m = /*#__PURE__*/function (_Io2) {
    _inherits(_m, _Io2);
    var _super196 = _createSuper(_m);
    function _m(e, r, i, s, o, a) {
      var _this190;
      _classCallCheck(this, _m);
      _this190 = _super196.call(this, e, r, i, s, a);
      _this190.position = o;
      return _this190;
    }
    return _createClass(_m);
  }(Io),
  Sn = /*#__PURE__*/function (_Io3) {
    _inherits(Sn, _Io3);
    var _super197 = _createSuper(Sn);
    function Sn(e, r, i, s, o, a) {
      var _this191;
      _classCallCheck(this, Sn);
      _this191 = _super197.call(this, e, r, i, o, a);
      _this191.node = s;
      return _this191;
    }
    _createClass(Sn, [{
      key: "category",
      get: function get() {
        return this.node.category;
      }
    }], [{
      key: "createLigherLayer",
      value: function createLigherLayer(e, r, i, s) {
        var o,
          a = new Ce(Nl(i.alpha, s)),
          l = new xt(i.mode),
          u = new Ce(i.bumpMapIntensity),
          c = new Ce(Nl(i.alphaOverride, s)),
          d;
        if (!i.visible) o = new Ma(), d = {};else if (i.category === "lambert") {
          var _s$color, _i$occlusion;
          o = new xm();
          var h = new Yt((_s$color = s.color(i.emissive)) !== null && _s$color !== void 0 ? _s$color : 0),
            f = new Vr((_i$occlusion = i.occlusion) !== null && _i$occlusion !== void 0 ? _i$occlusion : !0);
          d = {
            emissive: h,
            occlusion: f
          }, o.emissive = h, o.occlusion = f;
        } else if (i.category === "toon") {
          var _i$shininess, _s$color2;
          o = new wm();
          var _h66 = new Ce((_i$shininess = i.shininess) !== null && _i$shininess !== void 0 ? _i$shininess : 30),
            _f70 = new Yt((_s$color2 = s.color(i.specular)) !== null && _s$color2 !== void 0 ? _s$color2 : 1118481);
          d = {
            shininess: _h66,
            specular: _f70
          }, o.shininess = _h66, o.specular = _f70;
        } else if (i.category === "physical") {
          var _i$roughness, _i$metalness, _i$reflectivity, _i$occlusion2;
          o = new Sm();
          var _h67 = new Ce((_i$roughness = i.roughness) !== null && _i$roughness !== void 0 ? _i$roughness : .3),
            _f71 = new Ce((_i$metalness = i.metalness) !== null && _i$metalness !== void 0 ? _i$metalness : 0),
            p = new Ce((_i$reflectivity = i.reflectivity) !== null && _i$reflectivity !== void 0 ? _i$reflectivity : .5),
            m = new Vr((_i$occlusion2 = i.occlusion) !== null && _i$occlusion2 !== void 0 ? _i$occlusion2 : !0);
          d = {
            roughness: _h67,
            metalness: _f71,
            reflectivity: p,
            occlusion: m
          }, o.roughness = _h67, o.metalness = _f71, o.reflectivity = p, o.occlusion = m;
        } else {
          var _i$shininess2, _s$color3, _i$occlusion3;
          o = new bm();
          var _h68 = new Ce((_i$shininess2 = i.shininess) !== null && _i$shininess2 !== void 0 ? _i$shininess2 : 30),
            _f72 = new Yt(i.specular !== void 0 ? (_s$color3 = s.color(i.specular)) !== null && _s$color3 !== void 0 ? _s$color3 : 1118481 : 1118481),
            _p45 = new Vr((_i$occlusion3 = i.occlusion) !== null && _i$occlusion3 !== void 0 ? _i$occlusion3 : !0);
          d = {
            shininess: _h68,
            specular: _f72,
            occlusion: _p45
          }, o.shininess = _h68, o.specular = _f72, o.occlusion = _p45;
        }
        return o.alpha = new Ce(1), o.shadingAlpha = a, o.shadingBlend = l, o.bumpMapIntensity = u, o.alphaOverride = c, d.alpha = o.shadingAlpha, d.mode = o.shadingBlend, d.bumpMapIntensity = o.bumpMapIntensity, d.alphaOverride = o.alphaOverride, new Sn(e, r, i, o, d, s);
      }
    }]);
    return Sn;
  }(Io);
function E7(n) {
  var t = n instanceof Io ? n.type : n;
  return t === "texture" || t === "video" || t === "displace_map" || t === "matcap";
}
function ms(n) {
  var _n$alpha, _n$mode, _n$isMask;
  return {
    alpha: new Ce((_n$alpha = n.alpha) !== null && _n$alpha !== void 0 ? _n$alpha : 1),
    mode: new xt((_n$mode = n.mode) !== null && _n$mode !== void 0 ? _n$mode : 0),
    isMask: new Vr((_n$isMask = n.isMask) !== null && _n$isMask !== void 0 ? _n$isMask : !1)
  };
}
function T7(n, t, e, r, i) {
  switch (n.type) {
    case "color":
      {
        var _r$color;
        var s = new Yt((_r$color = r.color) !== null && _r$color !== void 0 ? _r$color : Xr),
          o = ms(r),
          a = new Uc(s, o.alpha),
          l = new zt(a.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          color: s
        }, o), a, o.mode, l, o.isMask, i);
      }
    case "fresnel":
      {
        var _r$color2, _r$bias, _r$scale2, _r$intensity2, _r$factor;
        var _s38 = new Yt((_r$color2 = r.color) !== null && _r$color2 !== void 0 ? _r$color2 : 16777215),
          _o35 = new Ce((_r$bias = r.bias) !== null && _r$bias !== void 0 ? _r$bias : .1),
          _a37 = new Ce((_r$scale2 = r.scale) !== null && _r$scale2 !== void 0 ? _r$scale2 : 1),
          _l69 = new Ce((_r$intensity2 = r.intensity) !== null && _r$intensity2 !== void 0 ? _r$intensity2 : 2),
          u = new Ce((_r$factor = r.factor) !== null && _r$factor !== void 0 ? _r$factor : 1),
          c = ms(r),
          d = new ym(_s38, _o35, _a37, _l69, u, c.alpha, c.mode, c.isMask),
          h = new zt(d.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          color: _s38,
          bias: _o35,
          scale: _a37,
          intensity: _l69,
          factor: u
        }, c), d, c.mode, h, c.isMask, i);
      }
    case "rainbow":
      {
        var _r$filmThickness, _r$movement2, _r$wavelengths, _r$noiseStrength, _r$noiseScale, _r$offset;
        var _s39 = new Ce((_r$filmThickness = r.filmThickness) !== null && _r$filmThickness !== void 0 ? _r$filmThickness : 30),
          _o36 = new Ce((_r$movement2 = r.movement) !== null && _r$movement2 !== void 0 ? _r$movement2 : 0),
          _a38 = new Xi((_r$wavelengths = r.wavelengths) !== null && _r$wavelengths !== void 0 ? _r$wavelengths : new _(0, 0, 0)),
          _l70 = new Ce((_r$noiseStrength = r.noiseStrength) !== null && _r$noiseStrength !== void 0 ? _r$noiseStrength : 0),
          _u41 = new Ce((_r$noiseScale = r.noiseScale) !== null && _r$noiseScale !== void 0 ? _r$noiseScale : 1),
          _c30 = new Xi((_r$offset = r.offset) !== null && _r$offset !== void 0 ? _r$offset : new _(0, 0, 0)),
          _d47 = ms(r),
          _h69 = new Yh(_s39, _o36, _a38, _l70, _u41, _c30, _d47.alpha, _d47.isMask),
          f = new zt(_h69.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          filmThickness: _s39,
          movement: _o36,
          wavelengths: _a38,
          noiseStrength: _l70,
          noiseScale: _u41,
          offset: _c30
        }, _d47), _h69, _d47.mode, f, _d47.isMask, i);
      }
    case "transmission":
      {
        var _r$thickness, _r$ior, _r$roughness;
        var _s40 = new Ce((_r$thickness = r.thickness) !== null && _r$thickness !== void 0 ? _r$thickness : 10),
          _o37 = new Ce((_r$ior = r.ior) !== null && _r$ior !== void 0 ? _r$ior : 1.5),
          _a39 = new Ce((_r$roughness = r.roughness) !== null && _r$roughness !== void 0 ? _r$roughness : .5),
          _l71 = We.transmissionSize,
          _u42 = We.transmissionRenderTarget,
          _c31 = We.transmissionRenderTargetDepth,
          _d48 = window.innerWidth,
          _h70 = window.innerHeight,
          _f73 = _d48 >= _h70 ? new Lr(_h70 / _d48, 1) : new Lr(1, _d48 / _h70),
          p = ms(r),
          m = new Qh(_s40, _o37, _a39, _l71, _u42, _c31, _f73, p.alpha),
          g = new zt(m.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          thickness: _s40,
          ior: _o37,
          roughness: _a39,
          aspectRatio: _f73
        }, p), m, p.mode, g, p.isMask, i);
      }
    case "toon":
      {
        var _r$positioning, _r$source, _r$isWorldSpace, _r$noiseStrength2, _r$noiseScale2, _r$offset2;
        var _s41 = new xt((_r$positioning = r.positioning) !== null && _r$positioning !== void 0 ? _r$positioning : 0),
          _o38;
        r.colors ? _o38 = new Ys(r.colors.length, r.colors) : (_o38 = new Ys(10, new He(0, 0, 0, 1)), _o38.value[1] = new He(1, 1, 1, 1));
        var _a40;
        r.steps ? _a40 = new qs(r.steps.length, r.steps) : (_a40 = new qs(10, 1), _a40.value[0] = 0);
        var _l72 = new Xi((_r$source = r.source) !== null && _r$source !== void 0 ? _r$source : new _(0, 0, 0)),
          _u43 = new Vr((_r$isWorldSpace = r.isWorldSpace) !== null && _r$isWorldSpace !== void 0 ? _r$isWorldSpace : !0),
          _c32 = new Ce((_r$noiseStrength2 = r.noiseStrength) !== null && _r$noiseStrength2 !== void 0 ? _r$noiseStrength2 : 0),
          _d49 = new Ce((_r$noiseScale2 = r.noiseScale) !== null && _r$noiseScale2 !== void 0 ? _r$noiseScale2 : 1),
          _h71 = new On(r.shadowColor),
          _f74 = new Xi((_r$offset2 = r.offset) !== null && _r$offset2 !== void 0 ? _r$offset2 : new _(0, 0, 0)),
          _p46 = ms(r),
          _m45 = new Xh(_s41, _o38, _a40, _l72, _u43, _c32, _d49, _h71, _f74, _p46.alpha),
          _g37 = new zt(_m45.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          positioning: _s41,
          colors: _o38,
          steps: _a40,
          source: _l72,
          isWorldSpace: _u43,
          noiseStrength: _c32,
          noiseScale: _d49,
          shadowColor: _h71,
          offset: _f74
        }, _p46), _m45, _p46.mode, _g37, _p46.isMask, i);
      }
    case "outline":
      {
        var _r$outlineColor, _r$contourColor, _r$outlineWidth, _r$contourWidth, _r$outlineThreshold, _r$contourThreshold, _r$outlineSmoothing, _r$contourFrequency, _r$contourDirection, _r$positionalLines, _r$compensation;
        var _s42 = new Yt((_r$outlineColor = r.outlineColor) !== null && _r$outlineColor !== void 0 ? _r$outlineColor : 16777215),
          _o39 = new Yt((_r$contourColor = r.contourColor) !== null && _r$contourColor !== void 0 ? _r$contourColor : 16777215),
          _a41 = new Ce((_r$outlineWidth = r.outlineWidth) !== null && _r$outlineWidth !== void 0 ? _r$outlineWidth : .1),
          _l73 = new Ce((_r$contourWidth = r.contourWidth) !== null && _r$contourWidth !== void 0 ? _r$contourWidth : .1),
          _u44 = new Ce((_r$outlineThreshold = r.outlineThreshold) !== null && _r$outlineThreshold !== void 0 ? _r$outlineThreshold : .1),
          _c33 = new Ce((_r$contourThreshold = r.contourThreshold) !== null && _r$contourThreshold !== void 0 ? _r$contourThreshold : .1),
          _d50 = new Ce((_r$outlineSmoothing = r.outlineSmoothing) !== null && _r$outlineSmoothing !== void 0 ? _r$outlineSmoothing : .1),
          _h72 = new Ce((_r$contourFrequency = r.contourFrequency) !== null && _r$contourFrequency !== void 0 ? _r$contourFrequency : .1),
          _f75 = new Xi((_r$contourDirection = r.contourDirection) !== null && _r$contourDirection !== void 0 ? _r$contourDirection : new _(0, 1, 0)),
          _p47 = new Vr((_r$positionalLines = r.positionalLines) !== null && _r$positionalLines !== void 0 ? _r$positionalLines : !1),
          _m46 = new Vr((_r$compensation = r.compensation) !== null && _r$compensation !== void 0 ? _r$compensation : !0),
          _g38 = We.normalRenderTarget,
          y = We.normalRenderTargetDepth,
          v = We.pixelRatioNode,
          x = We.resolution,
          S = ms(r),
          w = new Wh(_s42, _o39, _a41, _l73, _u44, _c33, _d50, _h72, _f75, _p47, _m46, x, _g38, y, v, S.alpha),
          A = new zt(w.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          outlineColor: _s42,
          contourColor: _o39,
          outlineWidth: _a41,
          contourWidth: _l73,
          outlineThreshold: _u44,
          contourThreshold: _c33,
          outlineSmoothing: _d50,
          contourFrequency: _h72,
          contourDirection: _f75,
          positionalLines: _p47,
          compensation: _m46
        }, S), w, S.mode, A, S.isMask, i);
      }
    case "depth":
      {
        var _r$gradientType, _r$smooth, _r$near, _r$far, _r$isVector, _r$isWorldSpace2, _r$origin, _r$direction;
        var _s43 = new xt((_r$gradientType = r.gradientType) !== null && _r$gradientType !== void 0 ? _r$gradientType : 0),
          _o40 = new Vr((_r$smooth = r.smooth) !== null && _r$smooth !== void 0 ? _r$smooth : !1),
          _a42 = new Ce((_r$near = r.near) !== null && _r$near !== void 0 ? _r$near : 50),
          _l74 = new Ce((_r$far = r.far) !== null && _r$far !== void 0 ? _r$far : 200),
          _u45 = new Ce((_r$isVector = r.isVector) !== null && _r$isVector !== void 0 ? _r$isVector : 1),
          _c34 = new Ce((_r$isWorldSpace2 = r.isWorldSpace) !== null && _r$isWorldSpace2 !== void 0 ? _r$isWorldSpace2 : 0),
          _d51 = new Xi((_r$origin = r.origin) !== null && _r$origin !== void 0 ? _r$origin : new _()),
          _h73 = new Xi((_r$direction = r.direction) !== null && _r$direction !== void 0 ? _r$direction : new _()),
          _f76;
        r.colors ? _f76 = new Ys(r.colors.length, r.colors) : (_f76 = new Ys(2, new He(0, 0, 0, 1)), _f76.value[1] = new He(1, 1, 1, 1));
        var _p48;
        r.steps ? _p48 = new qs(r.steps.length, r.steps) : (_p48 = new qs(2, 1), _p48.value[0] = 0);
        var _m47 = ms(r),
          _g39 = new Uh(_s43, _o40, _a42, _l74, _u45, _c34, _d51, _h73, _f76, _p48, _m47.alpha, _m47.isMask),
          _y38 = new zt(_g39.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          gradientType: _s43,
          smooth: _o40,
          near: _a42,
          far: _l74,
          isVector: _u45,
          isWorldSpace: _c34,
          origin: _d51,
          direction: _h73,
          colors: _f76,
          steps: _p48
        }, _m47), _g39, _m47.mode, _y38, _m47.isMask, i);
      }
    case "noise":
      {
        var _r$scale3, _r$size, _r$move, _r$fA, _r$fB, _r$distortion, _r$noiseType2, _r$voronoiStyle2, _r$highCut2, _r$lowCut2, _r$smoothness2, _r$seed2, _r$quality2;
        var _s44 = new Ce((_r$scale3 = r.scale) !== null && _r$scale3 !== void 0 ? _r$scale3 : 1),
          _o41 = new Xi((_r$size = r.size) !== null && _r$size !== void 0 ? _r$size : new _(100, 100, 100)),
          _a43 = new Ce((_r$move = r.move) !== null && _r$move !== void 0 ? _r$move : 1),
          _l75 = new Lr((_r$fA = r.fA) !== null && _r$fA !== void 0 ? _r$fA : new N(1.7, 9.2)),
          _u46 = new Lr((_r$fB = r.fB) !== null && _r$fB !== void 0 ? _r$fB : new N(8.3, 2.8)),
          _c35 = new Lr((_r$distortion = r.distortion) !== null && _r$distortion !== void 0 ? _r$distortion : new N(1, 1)),
          _d52 = new On(r.colorA),
          _h74 = new On(r.colorB),
          _f77 = new On(r.colorC),
          _p49 = new On(r.colorD),
          _m48 = new xt((_r$noiseType2 = r.noiseType) !== null && _r$noiseType2 !== void 0 ? _r$noiseType2 : 0),
          _g40 = new xt((_r$voronoiStyle2 = r.voronoiStyle) !== null && _r$voronoiStyle2 !== void 0 ? _r$voronoiStyle2 : 0),
          _y39 = new Ce((_r$highCut2 = r.highCut) !== null && _r$highCut2 !== void 0 ? _r$highCut2 : 1),
          _v29 = new Ce((_r$lowCut2 = r.lowCut) !== null && _r$lowCut2 !== void 0 ? _r$lowCut2 : 0),
          _x32 = new Ce((_r$smoothness2 = r.smoothness) !== null && _r$smoothness2 !== void 0 ? _r$smoothness2 : .5),
          _S31 = new Ce((_r$seed2 = r.seed) !== null && _r$seed2 !== void 0 ? _r$seed2 : .5),
          _w34 = new xt((_r$quality2 = r.quality) !== null && _r$quality2 !== void 0 ? _r$quality2 : 1),
          _A24 = ms(r),
          E = new Hh(_s44, _o41, _a43, _l75, _u46, _c35, _d52, _h74, _f77, _p49, _A24.alpha, _m48, _A24.isMask, _g40, _y39, _v29, _x32, _S31, _w34),
          b = new zt(E.calpha, "f");
        return new wr(t, e, n, _objectSpread(_objectSpread({
          scale: _s44,
          size: _o41,
          move: _a43,
          fA: _l75,
          fB: _u46,
          distortion: _c35,
          colorA: _d52,
          colorB: _h74,
          colorC: _f77,
          colorD: _p49,
          noiseType: _m48
        }, _A24), {}, {
          voronoiStyle: _g40,
          highCut: _y39,
          lowCut: _v29,
          smoothness: _x32,
          seed: _S31,
          quality: _w34
        }), E, _A24.mode, b, _A24.isMask, i);
      }
    case "normal":
      {
        var _r$cnormal;
        var _s45 = new Xi((_r$cnormal = r.cnormal) !== null && _r$cnormal !== void 0 ? _r$cnormal : new _(1, 1, 1)),
          _o42 = ms(r),
          _a44 = new kh(_s45, _o42.alpha),
          _l76 = new zt(_a44.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          cnormal: _s45
        }, _o42), _a44, _o42.mode, _l76, _o42.isMask, i);
      }
    case "gradient":
      {
        var _r$gradientType2, _r$smooth2, _r$offset3, _r$morph, _r$angle;
        var _s46 = new xt((_r$gradientType2 = r.gradientType) !== null && _r$gradientType2 !== void 0 ? _r$gradientType2 : 0),
          _o43 = new Vr((_r$smooth2 = r.smooth) !== null && _r$smooth2 !== void 0 ? _r$smooth2 : !1),
          _a45;
        r.colors ? _a45 = new Ys(r.colors.length, r.colors) : (_a45 = new Ys(10, new He(0, 0, 0, 1)), _a45.value[1] = new He(1, 1, 1, 1));
        var _l77;
        r.steps ? _l77 = new qs(r.steps.length, r.steps) : (_l77 = new qs(10, 1), _l77.value[0] = 0);
        var _u47 = new Lr((_r$offset3 = r.offset) !== null && _r$offset3 !== void 0 ? _r$offset3 : new N(0, 0)),
          _c36 = new Lr((_r$morph = r.morph) !== null && _r$morph !== void 0 ? _r$morph : new N(0, 0)),
          _d53 = new Ce((_r$angle = r.angle) !== null && _r$angle !== void 0 ? _r$angle : 0),
          _h75 = ms(r),
          _f78 = new Gh(_s46, _o43, _a45, _l77, _u47, _c36, _d53, _h75.alpha, _h75.isMask),
          _p50 = new zt(_f78.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          gradientType: _s46,
          smooth: _o43,
          colors: _a45,
          steps: _l77,
          offset: _u47,
          morph: _c36,
          angle: _d53
        }, _h75), _f78, _h75.mode, _p50, _h75.isMask, i);
      }
    case "pattern":
      {
        var _r$style, _r$projection2, _indexOf2, _r$blending2, _r$offset4, _r$frequency, _r$size2, _r$variation, _r$smoothness3, _r$zigzag, _r$rotation, _r$vertical, _r$horizontal, _r$sides;
        var _s47 = new xt((_r$style = r.style) !== null && _r$style !== void 0 ? _r$style : 0),
          _o44 = new xt((_r$projection2 = r.projection) !== null && _r$projection2 !== void 0 ? _r$projection2 : 0),
          _a46 = new xt((_indexOf2 = ["x", "y", "z"].indexOf(r.axis)) !== null && _indexOf2 !== void 0 ? _indexOf2 : 0),
          _l78 = new Ce((_r$blending2 = r.blending) !== null && _r$blending2 !== void 0 ? _r$blending2 : 0),
          _u48 = new Lr((_r$offset4 = r.offset) !== null && _r$offset4 !== void 0 ? _r$offset4 : new N(0, 0)),
          _c37 = new On(r.colorA),
          _d54 = new On(r.colorB),
          _h76 = new Lr((_r$frequency = r.frequency) !== null && _r$frequency !== void 0 ? _r$frequency : new N(10, 10)),
          _f79 = new Ce((_r$size2 = r.size) !== null && _r$size2 !== void 0 ? _r$size2 : .5),
          _p51 = new Ce((_r$variation = r.variation) !== null && _r$variation !== void 0 ? _r$variation : 0),
          _m49 = new Ce((_r$smoothness3 = r.smoothness) !== null && _r$smoothness3 !== void 0 ? _r$smoothness3 : .5),
          _g41 = new Ce((_r$zigzag = r.zigzag) !== null && _r$zigzag !== void 0 ? _r$zigzag : 0),
          _y40 = new Ce((_r$rotation = r.rotation) !== null && _r$rotation !== void 0 ? _r$rotation : 0),
          _v30 = new Lr((_r$vertical = r.vertical) !== null && _r$vertical !== void 0 ? _r$vertical : new N(0, 1)),
          _x33 = new Lr((_r$horizontal = r.horizontal) !== null && _r$horizontal !== void 0 ? _r$horizontal : new N(0, 1)),
          _S32 = new xt((_r$sides = r.sides) !== null && _r$sides !== void 0 ? _r$sides : 6),
          _w35 = ms(r),
          _A25 = new qh(_s47, _o44, _a46, _l78, _u48, _c37, _d54, _h76, _f79, _p51, _m49, _g41, _y40, _v30, _x33, _S32, _w35.alpha, _w35.isMask),
          _E22 = new zt(_A25.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          style: _s47,
          projection: _o44,
          axis: _a46,
          blending: _l78,
          offset: _u48,
          colorA: _c37,
          colorB: _d54,
          frequency: _h76,
          size: _f79,
          variation: _p51,
          smoothness: _m49,
          zigzag: _g41,
          rotation: _y40,
          vertical: _v30,
          horizontal: _x33,
          sides: _S32
        }, _w35), _A25, _w35.mode, _E22, _w35.isMask, i);
      }
    default:
      {
        var _s48 = new Yt(1, 0, 0, 1),
          _o45 = ms(r),
          _a47 = new Uc(_s48, _o45.alpha),
          _l79 = new zt(_a47.calpha, "f");
        return new wr(t, e, n, _objectSpread({
          color: _s48
        }, _o45), _a47, _o45.mode, _l79, _o45.isMask, i);
      }
  }
}
function M7(n, t, e, r) {
  var i = JI(e, r);
  return T7(e, n, t, i, r);
}
function KA(n, t, e, r) {
  if (e.type === "displace" && (n === "intensity" || n === "visible")) {
    var i = t.uniforms["f".concat(t.id, "_intensity")];
    return i ? (i.value = e.intensity * (e.visible ? 1 : 0), i) : void 0;
  }
  if (e.type !== "displace" && (n === "alpha" || n === "visible")) {
    var _i74 = t.uniforms["f".concat(t.id, "_alpha")];
    if (!_i74) return;
    if (_i74.value = Nl(e.alpha, r) * (e.visible ? 1 : 0), e.type === "outline" && n === "visible") {
      var s = t.uniforms["f".concat(t.id, "_compensation")];
      s && (s.value = e.compensation && e.visible);
    }
    return _i74;
  }
}
function jc(n, t) {
  var e = 0,
    r = n.layers.find(function (i) {
      return i.data.type === "light";
    });
  if (r) {
    var i = r.data,
      s = Number(t.getVariable(i.alphaOverride));
    if ((typeof i.alphaOverride == "string" ? s / 100 : i.alphaOverride) < 1) return !0;
  }
  var _iterator58 = _createForOfIteratorHelper(n.layers),
    _step58;
  try {
    for (_iterator58.s(); !(_step58 = _iterator58.n()).done;) {
      var _i75 = _step58.value;
      if (_i75.data.type !== "displace" && _i75.data.isMask) return !0;
      if (_i75.data.type !== "displace" && "alpha" in _i75.data && _i75.data.type !== "light" && _i75.data.type !== "fresnel" && _i75.data.type !== "texture" && _i75.data.type !== "matcap" && _i75.data.type !== "rainbow" && _i75.data.type !== "outline" && _i75.data.type !== "pattern") {
        var _t$getVariable2;
        var _s49 = _i75.data.visible ? _i75.data.alpha : 0;
        if (typeof _s49 == "string" && (_s49 = Math.max(0, Math.min(1, Number((_t$getVariable2 = t.getVariable(_s49)) !== null && _t$getVariable2 !== void 0 ? _t$getVariable2 : 100) / 100))), _s49 === 1 && _i75.data.type === "depth" || _i75.data.type === "gradient") {
          var _iterator59 = _createForOfIteratorHelper(_i75.data.colors),
            _step59;
          try {
            for (_iterator59.s(); !(_step59 = _iterator59.n()).done;) {
              var o = _step59.value;
              if (o[3] < 1) {
                _s49 = o[3];
                break;
              }
            }
          } catch (err) {
            _iterator59.e(err);
          } finally {
            _iterator59.f();
          }
        } else if (_s49 === 1 && _i75.data.type === "noise") {
          var _o46 = t.color(_i75.data.colorA).a,
            a = t.color(_i75.data.colorB).a,
            l = t.color(_i75.data.colorC).a,
            u = t.color(_i75.data.colorD).a,
            c = Math.min(_o46, Math.min(a, Math.min(l, u)));
          c < 1 && (_s49 = c);
        }
        e += (1 - e) * _s49;
      }
    }
  } catch (err) {
    _iterator58.e(err);
  } finally {
    _iterator58.f();
  }
  return e < 1;
}
var Rn = /*#__PURE__*/function (_rt) {
    _inherits(Rn, _rt);
    var _super198 = _createSuper(Rn);
    function Rn() {
      var _this192;
      _classCallCheck(this, Rn);
      _this192 = _super198.call(this, void 0);
      _this192.flatShading = !1;
      _this192.needsJitter = !0;
      _this192.cacheKey = "";
      _this192.fog = !0, _this192.dithering = !0, _this192.vertexColors = !0, _this192.transparent = !0;
      return _this192;
    }
    _createClass(Rn, [{
      key: "customProgramCacheKey",
      value: function customProgramCacheKey() {
        return this.cacheKey;
      }
    }]);
    return Rn;
  }(rt),
  Y0 = /*#__PURE__*/function (_Rn) {
    _inherits(Y0, _Rn);
    var _super199 = _createSuper(Y0);
    function Y0(e, r, i, s) {
      var _this193;
      _classCallCheck(this, Y0);
      _this193 = _super199.call(this);
      _this193.flatShading = e;
      _this193.side = r;
      _this193.wireframe = i;
      _this193.root = s;
      return _this193;
    }
    _createClass(Y0, [{
      key: "updateAfterBuild",
      value: function updateAfterBuild() {
        var e = this.root;
        this.lights = e.lights, this.vertexShader = e.vertexShader, this.fragmentShader = e.fragmentShader, this.defines = e.defines, this.uniforms = e.uniforms, this.extensions = e.extensions, this.transparent = e.transparent, this.cacheKey = e.customProgramCacheKey() + "flat" + this.flatShading + this.side;
      }
    }, {
      key: "onBeforeCompile",
      value: function onBeforeCompile(e, r) {
        this.root.onBeforeCompile(e);
      }
    }, {
      key: "data",
      get: function get() {
        return this.root.data;
      }
    }, {
      key: "category",
      get: function get() {
        return this.root.category;
      }
    }, {
      key: "hasAO",
      get: function get() {
        return this.root.hasAO;
      }
    }, {
      key: "getFlavor",
      value: function getFlavor(e, r, i) {
        return this.root.getFlavor(e, r, i);
      }
    }, {
      key: "layers",
      get: function get() {
        return this.root.layers;
      }
    }, {
      key: "fragment",
      get: function get() {
        return this.root.fragment;
      }
    }, {
      key: "getLayersOfType",
      value: function getLayersOfType(e) {
        return this.root.getLayersOfType(e);
      }
    }, {
      key: "getLayerByUuid",
      value: function getLayerByUuid(e) {
        return this.root.getLayerByUuid(e);
      }
    }, {
      key: "updateByOp",
      value: function updateByOp(e, r, i) {
        this.root.updateByOp(e, r, i);
      }
    }, {
      key: "nodeMaterialDispose",
      value: function nodeMaterialDispose() {
        this.root.nodeMaterialDispose();
      }
    }]);
    return Y0;
  }(Rn),
  Pa = /*#__PURE__*/function (_Rn2) {
    _inherits(Pa, _Rn2);
    var _super200 = _createSuper(Pa);
    function Pa(e, r) {
      var _this194;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
      _classCallCheck(this, Pa);
      _this194 = _super200.call(this);
      _this194.data = e;
      _this194.allowVariableSaves = i;
      _this194.layerIdGen = 0;
      _this194.flavors = [];
      _this194.masks = {};
      _this194.type = "NodeMaterial";
      _this194.updaters = [], _this194.reset0(e, r);
      return _this194;
    }
    _createClass(Pa, [{
      key: "nodeMaterial",
      get: function get() {
        return this;
      }
    }, {
      key: "getFlavor",
      value: function getFlavor(e, r, i) {
        var s = i ? 6 : (e ? 3 : 0) + r;
        if (s === 0) return this;
        this.flavors === void 0 && (this.flavors = []), s -= 1;
        var o = this.flavors[s];
        return o === void 0 && (o = new Y0(e, r, i, this), this.flavors[s] = o, o.flatShading = e, o.side = r, o.updateAfterBuild()), o;
      }
    }, {
      key: "fragment",
      get: function get() {
        return this.lightLayer.node;
      }
    }, {
      key: "category",
      get: function get() {
        return this.lightLayer.category;
      }
    }, {
      key: "hasAO",
      get: function get() {
        var _this$lightLayer$getN, _this$lightLayer$getN2;
        return (_this$lightLayer$getN = (_this$lightLayer$getN2 = this.lightLayer.getNode("occlusion")) === null || _this$lightLayer$getN2 === void 0 ? void 0 : _this$lightLayer$getN2.value) !== null && _this$lightLayer$getN !== void 0 ? _this$lightLayer$getN : !1;
      }
    }, {
      key: "reset",
      value: function reset(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        (this.data !== e || i) && this.reset0(e, r);
      }
    }, {
      key: "reset0",
      value: function reset0(e, r) {
        var _e$layers,
          _this195 = this,
          _e$name;
        this.data = e;
        var i = (_e$layers = e.layers) !== null && _e$layers !== void 0 ? _e$layers : Qr.defaultTwoLayerData("phong").layers;
        try {
          this.layers = i.map(function (s) {
            return Io.create(_this195.layerIdGen++, s.id, s.data, r.shared);
          });
        } catch (_unused28) {
          this.layers = [];
        }
        this.layers.reverse(), this.name = (_e$name = e.name) !== null && _e$name !== void 0 ? _e$name : "Untitled Material", this.onUpdate(r.shared), this.transparent = jc(e, r.shared), this.saveVariableLocations(r);
      }
    }, {
      key: "onVariableUpdate",
      value: function onVariableUpdate(e, r, i) {
        if (e[0] === "alphaOverride") this.transparent = jc(this.data, i.shared), this.lightLayer.setValue("alphaOverride", Math.max(0, Math.min(Number(r) / 100, 1)));else if (e[0] === "layer") {
          var s = e[1],
            o = e[2];
          if (s && o) {
            var a = this.layers.find(function (l) {
              return l.uuid === s;
            });
            (a === null || a === void 0 ? void 0 : a.hasValue(o)) && (o === "alpha" ? (this.transparent = jc(this.data, i.shared), a.setValue(o, Math.max(0, Math.min(Number(r) / 100, 1)))) : a.setValue(o, r));
          }
        }
      }
    }, {
      key: "saveVariableLocations",
      value: function saveVariableLocations(e) {
        var _this196 = this;
        if (!this.allowVariableSaves) return;
        var r = this.data.layers.find(function (i) {
          return i.data.type === "light";
        });
        r && e.shared.getVariable(r.data.alphaOverride, ["material", this.uuid, "alphaOverride"]), this.data.layers.forEach(function (i) {
          "alpha" in i.data && typeof i.data.alpha == "string" && e.shared.getVariable(i.data.alpha, ["material", _this196.uuid, "layer", i.id, "alpha"]);
        });
      }
    }, {
      key: "getLayersOfType",
      value: function getLayersOfType(e) {
        return this.layers.filter(function (r) {
          return r.type === e;
        });
      }
    }, {
      key: "getLayerByUuid",
      value: function getLayerByUuid(e) {
        return this.layers.find(function (r) {
          return r.uuid === e;
        });
      }
    }, {
      key: "onUpdate",
      value: function onUpdate(e) {
        this.cacheKey = this.computeCacheKey(), this.lightLayer = this.layers.find(function (r) {
          return r instanceof Sn;
        }), this.lightLayer === void 0 && (this.lightLayer = new Sn(0, "", _objectSpread(_objectSpread({}, Ir.defaultData("light", "phong")), {}, {
          visible: !1
        }), new Ma(), {}, e)), this.dispose();
        var _iterator60 = _createForOfIteratorHelper(this.flavors),
          _step60;
        try {
          for (_iterator60.s(); !(_step60 = _iterator60.n()).done;) {
            var r = _step60.value;
            r && r.dispose();
          }
        } catch (err) {
          _iterator60.e(err);
        } finally {
          _iterator60.f();
        }
        this.applyTextureMaps(), this.applyMasks(), this.blendColors(), this.blendAfterColors(), this.blendPositions();
      }
    }, {
      key: "applyTextureMaps",
      value: function applyTextureMaps() {
        var e = this.layers.find(function (o) {
          return o instanceof Sn;
        });
        if (!e) return;
        var r = e.data,
          i = r.bumpMap,
          s = r.roughnessMap;
        e.node.bumpMap = void 0, e.node.roughnessMap = void 0;
        for (var o = 0; o < this.layers.length; ++o) {
          var a = this.layers[o];
          a instanceof wr && a.color instanceof Ll && (a.uuid === i && (e.node.bumpMap = a.color), a.uuid === s && (e.node.roughnessMap = a.color));
        }
      }
    }, {
      key: "updateByOp",
      value: function updateByOp(e, r, i) {
        if (r !== void 0 ? this.data = r : r = this.data, this.transparent = jc(r, i.shared), e.path[0] === "layers") {
          this.data = r;
          var s = i.shared,
            o = e.path[1];
          if (o === void 0) {
            if (this.layers.reverse(), e.type === 4) {
              var a = Io.create(this.layerIdGen++, e.id, e.data, i.shared);
              this.layers.splice(e.localIndex, 0, a), i.scene.markNeedsUpdateRendererDirty();
            } else if (e.type === 5) this.layers.splice(e.localIndex, 1)[0].dispose(), i.scene.markNeedsUpdateRendererDirty();else if (e.type === 6) {
              var _a48 = this.layers.findIndex(function (u) {
                  return u.uuid === e.id;
                }),
                l = this.layers[_a48];
              this.layers.splice(_a48, 1), this.layers.splice(e.localIndex, 0, l), i.scene.markNeedsUpdateRendererDirty();
            }
            this.layers.reverse(), this.onUpdate(i.shared);
          } else {
            e.type === 0 && e.props.occlusion !== void 0 && i.scene.markNeedsUpdateRendererDirty();
            var _a49 = this.layers.find(function (l) {
              return l.uuid === o;
            });
            if (_a49) {
              var _l80 = r.layers.data(o),
                u;
              if (e.type === 0 && ("alpha" in e.props || "alphaOverride" in e.props) && ("alpha" in e.props ? u = _objectSpread(_objectSpread({}, e.props), {}, {
                alpha: Nl(e.props.alpha, s, ["material", this.uuid, "layer", o, "alpha"])
              }) : u = _objectSpread(_objectSpread({}, e.props), {}, {
                alphaOverride: Nl(e.props.alphaOverride, s, ["material", this.uuid, "alphaOverride"])
              })), _a49.updateByOp(_objectSpread(_objectSpread(_objectSpread({}, e), u ? {
                props: u
              } : {}), {}, {
                path: e.path.slice(2)
              }), _l80, i)) {
                var d = Io.create(this.layerIdGen++, o, _l80, s);
                this.layers.splice(this.layers.findIndex(function (h) {
                  return h.uuid === o;
                }), 1, d), this.onUpdate(i.shared);
              }
            }
          }
        } else this.reset(r, i);
      }
    }, {
      key: "applyMasks",
      value: function applyMasks() {
        for (var e = 0; e < this.layers.length; ++e) {
          var r = this.layers[e];
          r instanceof wr ? r.color.mask = void 0 : r instanceof Sn && (r.node.mask = void 0);
        }
        for (var _e55 = 0; _e55 < this.layers.length; ++_e55) {
          var _r35 = this.layers[_e55];
          if (_r35 instanceof wr && _r35.isMask.value && _r35.data.visible && _e55 > 0) {
            var i = _e55 - 1,
              s = this.layers[i];
            s instanceof Sn ? s.node.mask = new zi(_r35.color, _r35.alpha, zi.MUL) : s instanceof wr && (s.isMask.value || (s.color.mask = new zi(_r35.color, _r35.alpha, zi.MUL)));
          }
        }
      }
    }, {
      key: "blendColors",
      value: function blendColors() {
        var e = this.layers.findIndex(function (i) {
            return i instanceof wr;
          }),
          r = this.layers.findIndex(function (i) {
            return i instanceof Sn;
          });
        if (e !== -1 && e < r) {
          var i = this.layers[e].color;
          for (var s = e + 1; s < r; ++s) {
            var o = this.layers[s];
            if (o instanceof wr) {
              if (o.isMask.value) continue;
              i = new Fh(i, o.color, o.alpha, o.mode);
            }
          }
          this.fragment.color = i;
        } else this.fragment.color = void 0;
      }
    }, {
      key: "blendAfterColors",
      value: function blendAfterColors() {
        var e = new zt("outgoingLight", "f"),
          r = this.layers.findIndex(function (i) {
            return i instanceof Sn;
          });
        if (this.layers.length > r + 1) {
          for (var i = r + 1; i < this.layers.length; ++i) {
            var s = this.layers[i];
            if (s instanceof wr) {
              if (s.isMask.value) continue;
              e = new Fh(e, s.color, s.alpha, s.mode);
            }
          }
          this.fragment.afterColor = e;
        } else this.fragment.afterColor = void 0;
      }
    }, {
      key: "blendPositions",
      value: function blendPositions() {
        var e = this.layers.filter(function (r) {
          return r instanceof _m;
        });
        if (e.length > 0) {
          var r = e[0].position;
          for (var i = 1; i < e.length; ++i) e[i] && (r = new zi(r, e[i].position, zi.ADD), r = new zi(r, new Ce(.5).setReadonly(!0), zi.MUL));
          this.fragment.position = r;
        } else this.fragment.position = void 0;
      }
    }, {
      key: "getDefines",
      value: function getDefines() {
        return this.defines;
      }
    }, {
      key: "getUniforms",
      value: function getUniforms() {
        return this.uniforms;
      }
    }, {
      key: "getVertexShader",
      value: function getVertexShader() {
        return this.vertexShader;
      }
    }, {
      key: "getFragmentShader",
      value: function getFragmentShader() {
        return this.fragmentShader;
      }
    }, {
      key: "onBeforeCompile",
      value: function onBeforeCompile(e) {
        this.build(), e.defines = this.defines, e.uniforms = this.uniforms, e.vertexShader = this.vertexShader, e.fragmentShader = this.fragmentShader, e.extensionDerivatives = this.extensions.derivatives === !0, e.extensionFragDepth = this.extensions.fragDepth === !0, e.extensionDrawBuffers = this.extensions.drawBuffers === !0, e.extensionShaderTextureLOD = this.extensions.shaderTextureLOD === !0;
      }
    }, {
      key: "clampUniformsForPreview",
      value: function clampUniformsForPreview(e, r) {
        var i = function i(s, o, a) {
          return Math.min(Math.max(s, o), a);
        };
        var _iterator61 = _createForOfIteratorHelper(this.layers),
          _step61;
        try {
          for (_iterator61.s(); !(_step61 = _iterator61.n()).done;) {
            var s = _step61.value;
            if (s.type === "displace") {
              var o = i(s.uniforms["f".concat(s.id, "_intensity")].value, e, r);
              s.uniforms["f".concat(s.id, "_intensity")].value = o;
            }
          }
        } catch (err) {
          _iterator61.e(err);
        } finally {
          _iterator61.f();
        }
      }
    }, {
      key: "computeCacheKey",
      value: function computeCacheKey() {
        var e = "[";
        var _iterator62 = _createForOfIteratorHelper(this.data.layers),
          _step62;
        try {
          var _loop11 = function _loop11() {
            var r = _step62.value.data;
            if (r.type === "light") e += "\"".concat(r.visible ? r.category.toUpperCase() : "Basic", "\"");else {
              var _YA$r$type, _XA$r$type;
              var i = ((_YA$r$type = YA[r.type]) !== null && _YA$r$type !== void 0 ? _YA$r$type : []).map(function (u) {
                  return r[u];
                }),
                s = ((_XA$r$type = XA[r.type]) !== null && _XA$r$type !== void 0 ? _XA$r$type : []).map(function (u) {
                  var _r$u$length, _r$u;
                  return (_r$u$length = (_r$u = r[u]) === null || _r$u === void 0 ? void 0 : _r$u.length) !== null && _r$u$length !== void 0 ? _r$u$length : 0;
                }),
                o = [].concat(_toConsumableArray(i), _toConsumableArray(s)),
                a = "isMask" in r && r.isMask,
                l = "\"".concat(r.type, "-").concat(r.visible, "-").concat(a, "\"");
              o.length ? e += "[".concat(l, ", \"").concat(o.join('","'), "\"],") : e += l;
            }
          };
          for (_iterator62.s(); !(_step62 = _iterator62.n()).done;) {
            _loop11();
          }
        } catch (err) {
          _iterator62.e(err);
        } finally {
          _iterator62.f();
        }
        return e = e.slice(0, -1) + "]", e;
      }
    }, {
      key: "updateFrame",
      value: function updateFrame(e) {
        for (var r = 0; r < this.updaters.length; ++r) e.updateNode(this.updaters[r]);
      }
    }, {
      key: "build",
      value: function build() {
        var e = new Bh();
        e.needsJitter = this.needsJitter, this.lights = this.lightLayer.data.visible, e.build(this.fragment, this.fragment), this.vertexShader = e.getCode("vertex"), this.fragmentShader = e.getCode("fragment"), this.defines = e.defines, this.uniforms = e.uniforms, this.extensions = e.extensions, this.updaters = e.updaters;
        var _iterator63 = _createForOfIteratorHelper(this.flavors),
          _step63;
        try {
          for (_iterator63.s(); !(_step63 = _iterator63.n()).done;) {
            var r = _step63.value;
            r && r.updateAfterBuild();
          }
        } catch (err) {
          _iterator63.e(err);
        } finally {
          _iterator63.f();
        }
        return this;
      }
    }, {
      key: "nodeMaterialDispose",
      value: function nodeMaterialDispose() {
        this.layers.forEach(function (e) {
          return e.dispose();
        }), _get(_getPrototypeOf(Pa.prototype), "dispose", this).call(this);
        var _iterator64 = _createForOfIteratorHelper(this.flavors),
          _step64;
        try {
          for (_iterator64.s(); !(_step64 = _iterator64.n()).done;) {
            var e = _step64.value;
            e && e.dispose();
          }
        } catch (err) {
          _iterator64.e(err);
        } finally {
          _iterator64.f();
        }
      }
    }, {
      key: "assetsLoaded",
      value: function assetsLoaded() {
        var _iterator65 = _createForOfIteratorHelper(this.layers),
          _step65;
        try {
          for (_iterator65.s(); !(_step65 = _iterator65.n()).done;) {
            var e = _step65.value;
            if (e instanceof wr) {
              var r = e.params.texture;
              if (r instanceof Vc && !r.image.loaded) return !1;
            }
          }
        } catch (err) {
          _iterator65.e(err);
        } finally {
          _iterator65.f();
        }
        return !0;
      }
    }, {
      key: "getHash",
      value: function getHash() {
        var e = "{";
        return e += '"fragment":' + this.fragment.getHash(), e += "}", e;
      }
    }]);
    return Pa;
  }(Rn);
Object.defineProperties(Rn.prototype, {
  properties: {
    get: function get() {
      return this.fragment.properties;
    }
  }
});
var Hc = /*#__PURE__*/function (_Pa) {
  _inherits(Hc, _Pa);
  var _super201 = _createSuper(Hc);
  function Hc(t, e, r) {
    var _this197;
    _classCallCheck(this, Hc);
    _this197 = _super201.call(this, t, e, !1), _this197.uuid = r, _this197.allowVariableSaves = !0, _this197.saveVariableLocations(e);
    return _this197;
  }
  return _createClass(Hc);
}(Pa);
var iR = Pi(eR());
var tR = new Map();
function rR(n) {
  if (typeof n == "string") return n;
  var t = tR.get(n);
  return t || (t = {
    url: URL.createObjectURL(new Blob([n]))
  }, tR.set(n, t)), t.url;
}
var Da = /*#__PURE__*/function () {
  function Da(_ref34) {
    var _this198 = this;
    var t = _ref34.src,
      e = _ref34.volume,
      r = _ref34.delay,
      i = _ref34.loop;
    _classCallCheck(this, Da);
    this._volume = 1;
    this.delay = 0;
    this._loop = 1;
    this.loopsRemaining = 0;
    this._status = "stopped";
    this.onEnd = function () {
      _this198.loopsRemaining === 1 / 0 ? _this198.replay() : _this198.loopsRemaining > 1 ? (_this198.replay(), _this198.loopsRemaining--) : (_this198._status = "stopped", _this198.loopsRemaining = _this198._loop);
    };
    var s;
    typeof t == "string" ? s = {
      src: t
    } : s = {
      src: rR(t),
      format: "wav"
    }, this.sound = new iR.Howl(s), this.sound.on("end", this.onEnd), this.src = t, e !== void 0 && (this.volume = e), r !== void 0 && (this.delay = r), i !== void 0 && (this.loop = i);
  }
  _createClass(Da, [{
    key: "status",
    get: function get() {
      return this._status;
    }
  }, {
    key: "volume",
    get: function get() {
      return this._volume;
    },
    set: function set(t) {
      this._volume = t, this.sound.volume(t);
    }
  }, {
    key: "loop",
    get: function get() {
      return this._loop;
    },
    set: function set(t) {
      this._loop = t, this.loopsRemaining = t;
    }
  }, {
    key: "replay",
    value: function replay() {
      var _this199 = this;
      this.clearDelay(), this.delayTimerId = window.setTimeout(function () {
        _this199.sound.play(), _this199.clearDelay();
      }, this.delay);
    }
  }, {
    key: "fade",
    value: function fade(t) {
      var _this200 = this;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1e3;
      t ? (this.sound.volume(this._volume), this.clearFade(), this.fadeTimerId = window.setTimeout(function () {
        _this200.sound.fade(_this200._volume, 0, e), _this200.clearFade();
      }, t)) : this.sound.fade(this._volume, 0, e);
    }
  }, {
    key: "on",
    value: function on(t, e, r) {
      this.sound.on(t, e, r);
    }
  }, {
    key: "off",
    value: function off(t, e, r) {
      this.sound.off(t, e, r);
    }
  }, {
    key: "play",
    value: function play() {
      this._status === "playing" || this.sound.playing() || (this._status === "paused" ? (this.sound.seek() === 0 ? this.replay() : this.sound.play(), this._status = "playing") : this._status === "stopped" && (this.replay(), this._status = "playing"));
    }
  }, {
    key: "pause",
    value: function pause() {
      this._status === "playing" && (this.sound.pause(), this.clearFade(), this.clearDelay(), this._status = "paused");
    }
  }, {
    key: "stop",
    value: function stop() {
      this.sound.stop(), this.loopsRemaining = this._loop, this.clearFade(), this.clearDelay(), this._status = "stopped";
    }
  }, {
    key: "clearFade",
    value: function clearFade() {
      this.fadeTimerId && (clearTimeout(this.fadeTimerId), delete this.fadeTimerId);
    }
  }, {
    key: "clearDelay",
    value: function clearDelay() {
      this.delayTimerId && (clearTimeout(this.delayTimerId), delete this.delayTimerId);
    }
  }, {
    key: "dispose",
    value: function dispose() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      this.off(), this.stop(), this.clearFade(), this.clearDelay();
    }
  }]);
  return Da;
}();
var Q0 = /*#__PURE__*/function () {
  function Q0() {
    _classCallCheck(this, Q0);
    this.type = "ShapePath";
    this.color = new Le();
    this.subPaths = [];
    this.currentPath = null;
  }
  _createClass(Q0, [{
    key: "moveTo",
    value: function moveTo(t, e) {
      return this.currentPath = new yc(), this.subPaths.push(this.currentPath), this.currentPath.moveTo(t, e), this;
    }
  }, {
    key: "lineTo",
    value: function lineTo(t, e) {
      var _this$currentPath;
      return (_this$currentPath = this.currentPath) !== null && _this$currentPath !== void 0 && _this$currentPath.lineTo(t, e), this;
    }
  }, {
    key: "quadraticCurveTo",
    value: function quadraticCurveTo(t, e, r, i) {
      var _this$currentPath2;
      return (_this$currentPath2 = this.currentPath) !== null && _this$currentPath2 !== void 0 && _this$currentPath2.quadraticCurveTo(t, e, r, i), this;
    }
  }, {
    key: "bezierCurveTo",
    value: function bezierCurveTo(t, e, r, i, s, o) {
      var _this$currentPath3;
      return (_this$currentPath3 = this.currentPath) !== null && _this$currentPath3 !== void 0 && _this$currentPath3.bezierCurveTo(t, e, r, i, s, o), this;
    }
  }, {
    key: "splineThru",
    value: function splineThru(t) {
      var _this$currentPath4;
      return (_this$currentPath4 = this.currentPath) !== null && _this$currentPath4 !== void 0 && _this$currentPath4.splineThru(t), this;
    }
  }, {
    key: "toShapes",
    value: function toShapes() {
      var _this201 = this;
      var e = {
          ORIGIN: 0,
          DESTINATION: 1,
          BETWEEN: 2,
          LEFT: 3,
          RIGHT: 4,
          BEHIND: 5,
          BEYOND: 6
        },
        r = {
          loc: e.ORIGIN,
          t: 0
        };
      function i(m, g, y, v) {
        var x = m.x,
          S = g.x,
          w = y.x,
          A = v.x,
          E = m.y,
          b = g.y,
          T = y.y,
          M = v.y,
          C = (A - w) * (E - T) - (M - T) * (x - w),
          P = (S - x) * (E - T) - (b - E) * (x - w),
          D = (M - T) * (S - x) - (A - w) * (b - E),
          O = C / D,
          I = P / D;
        if (D === 0 && C !== 0 || O <= 0 || O >= 1 || I < 0 || I > 1) return null;
        if (C === 0 && D === 0) {
          for (var z = 0; z < 2; z++) if (s(z === 0 ? y : v, m, g), r.loc === e.ORIGIN) {
            var B = z === 0 ? y : v;
            return {
              x: B.x,
              y: B.y,
              t: r.t
            };
          } else if (r.loc === e.BETWEEN) {
            var _B7 = +(x + r.t * (S - x)).toPrecision(10),
              _V12 = +(E + r.t * (b - E)).toPrecision(10);
            return {
              x: _B7,
              y: _V12,
              t: r.t
            };
          }
          return null;
        } else {
          for (var _V13 = 0; _V13 < 2; _V13++) if (s(_V13 === 0 ? y : v, m, g), r.loc === e.ORIGIN) {
            var _U14 = _V13 === 0 ? y : v;
            return {
              x: _U14.x,
              y: _U14.y,
              t: r.t
            };
          }
          var _z5 = +(x + O * (S - x)).toPrecision(10),
            _B8 = +(E + O * (b - E)).toPrecision(10);
          return {
            x: _z5,
            y: _B8,
            t: O
          };
        }
      }
      function s(m, g, y) {
        var v = y.x - g.x,
          x = y.y - g.y,
          S = m.x - g.x,
          w = m.y - g.y,
          A = v * w - S * x;
        if (m.x === g.x && m.y === g.y) {
          r.loc = e.ORIGIN, r.t = 0;
          return;
        }
        if (m.x === y.x && m.y === y.y) {
          r.loc = e.DESTINATION, r.t = 1;
          return;
        }
        if (A < -Number.EPSILON) {
          r.loc = e.LEFT;
          return;
        }
        if (A > Number.EPSILON) {
          r.loc = e.RIGHT;
          return;
        }
        if (v * S < 0 || x * w < 0) {
          r.loc = e.BEHIND;
          return;
        }
        if (Math.sqrt(v * v + x * x) < Math.sqrt(S * S + w * w)) {
          r.loc = e.BEYOND;
          return;
        }
        var E;
        v !== 0 ? E = S / v : E = w / x, r.loc = e.BETWEEN, r.t = E;
      }
      function o(m, g) {
        var y = [],
          v = [];
        for (var x = 1; x < m.length; x++) {
          var S = m[x - 1],
            w = m[x];
          var _loop12 = function _loop12() {
            var E = g[A - 1],
              b = g[A],
              T = i(S, w, E, b);
            T !== null && y.find(function (M) {
              return M.t <= T.t + Number.EPSILON && M.t >= T.t - Number.EPSILON;
            }) === void 0 && (y.push(T), v.push(new N(T.x, T.y)));
          };
          for (var A = 1; A < g.length; A++) {
            _loop12();
          }
        }
        return v;
      }
      function a(m, g, y) {
        var v = new N();
        g.getCenter(v);
        var x = [];
        return y.forEach(function (S) {
          S.boundingBox.containsPoint(v) && o(m, S.points).forEach(function (A) {
            x.push({
              identifier: S.identifier,
              isCW: S.isCW,
              point: A
            });
          });
        }), x.sort(function (S, w) {
          return S.point.x - w.point.x;
        }), x;
      }
      function l(m, g, y, v, x) {
        (x == null || x === "") && (x = "nonzero");
        var S = new N();
        m.boundingBox.getCenter(S);
        var w = [new N(y, S.y), new N(v, S.y)],
          A = a(w, m.boundingBox, g);
        A.sort(function (P, D) {
          return P.point.x - D.point.x;
        });
        var E = [],
          b = [];
        A.forEach(function (P) {
          P.identifier === m.identifier ? E.push(P) : b.push(P);
        });
        var T = E[0].point.x,
          M = [],
          C = 0;
        for (; C < b.length && b[C].point.x < T;) M.length > 0 && M[M.length - 1] === b[C].identifier ? M.pop() : M.push(b[C].identifier), C++;
        if (M.push(m.identifier), x === "evenodd") {
          var P = M.length % 2 === 0,
            D = M[M.length - 2];
          return {
            identifier: m.identifier,
            isHole: P,
            for: D
          };
        } else if (x === "nonzero") {
          var _P21 = !0,
            _D16 = null,
            O = null;
          for (var I = 0; I < M.length; I++) {
            var z = M[I];
            g[z] && (_P21 ? (O = g[z].isCW, _P21 = !1, _D16 = z) : O !== g[z].isCW && (O = g[z].isCW, _P21 = !0));
          }
          return {
            identifier: m.identifier,
            isHole: _P21,
            for: _D16
          };
        } else console.warn('fill-rule: "' + x + '" is currently not implemented.');
      }
      var u = 0,
        c = 999999999,
        d = -999999999,
        h = [];
      this.subPaths.forEach(function (m) {
        var g = m.getPoints(),
          y = -999999999,
          v = 999999999,
          x = -999999999,
          S = 999999999;
        for (var w = 0; w < g.length; w++) {
          var A = g[w];
          A.y > y && (y = A.y), A.y < v && (v = A.y), A.x > x && (x = A.x), A.x < S && (S = A.x);
        }
        d <= x && (d = x + 1), c >= S && (c = S - 1), g.length && h.push({
          curves: m.curves,
          points: g,
          isCW: Fu.isClockWise(g),
          identifier: u++,
          boundingBox: new Xu(new N(S, v), new N(x, y))
        });
      });
      var f = h.map(function (m) {
          var _this201$userData;
          return l(m, h, c, d, (_this201$userData = _this201.userData) === null || _this201$userData === void 0 ? void 0 : _this201$userData.style.fillRule);
        }),
        p = [];
      return h.forEach(function (m) {
        var g = f[m.identifier];
        if (g && !g.isHole) {
          var y = new oa();
          y.curves = m.curves, f.filter(function (x) {
            return (x === null || x === void 0 ? void 0 : x.isHole) && x.for === m.identifier;
          }).forEach(function (x) {
            if (x) {
              var S = h[x.identifier],
                w = new yc();
              w.curves = S.curves, y.holes.push(w);
            }
          }), p.push(y);
        }
      }), p;
    }
  }]);
  return Q0;
}();
var ZA = !1,
  sR,
  JA = new Promise(function (n) {
    sR = n;
  }),
  nR = !1;
var K0;
function oR() {
  if (ZA = !0, nR) return;
  if (K0) return K0;
  function n() {
    return _n8.apply(this, arguments);
  }
  function _n8() {
    _n8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {
      var e;
      return _regeneratorRuntime().wrap(function _callee9$(_context15) {
        while (1) switch (_context15.prev = _context15.next) {
          case 0:
            _context15.next = 2;
            return require("_bundle_loader")(require.resolve("./opentype.js"));
          case 2:
            e = _context15.sent;
            sR(e), nR = !0;
          case 4:
          case "end":
            return _context15.stop();
        }
      }, _callee9);
    }));
    return _n8.apply(this, arguments);
  }
  return K0 = n(), K0;
}
var Em = /*#__PURE__*/function () {
  function Em() {
    _classCallCheck(this, Em);
  }
  _createClass(Em, [{
    key: "load",
    value: function () {
      var _load = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(t, e) {
        var r,
          _yield$JA,
          i,
          _args7 = arguments;
        return _regeneratorRuntime().wrap(function _callee10$(_context16) {
          while (1) switch (_context16.prev = _context16.next) {
            case 0:
              r = _args7.length > 2 && _args7[2] !== undefined ? _args7[2] : function () {};
              _context16.next = 3;
              return JA;
            case 3:
              _yield$JA = _context16.sent;
              i = _yield$JA.load;
              i(t, function (s, o) {
                s || !o ? r(s !== null && s !== void 0 ? s : "Something went wrong") : e(o);
              });
            case 6:
            case "end":
              return _context16.stop();
          }
        }, _callee10);
      }));
      function load(_x34, _x35) {
        return _load.apply(this, arguments);
      }
      return load;
    }()
  }, {
    key: "parse",
    value: function () {
      var _parse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(t) {
        var _yield$JA2, e, r, i, s, o;
        return _regeneratorRuntime().wrap(function _callee11$(_context17) {
          while (1) switch (_context17.prev = _context17.next) {
            case 0:
              _context17.next = 2;
              return JA;
            case 2:
              _yield$JA2 = _context17.sent;
              e = _yield$JA2.parse;
              r = _yield$JA2.Bidi;
              _context17.prev = 5;
              i = e(t), s = new r(), o = function o(a) {
                return i.charToGlyphIndex(a.char);
              };
              return _context17.abrupt("return", (s.registerModifier("glyphIndex", null, o), s.applyFeatures(i, i.defaultRenderOptions.features), {
                font: i,
                bidi: s
              }));
            case 10:
              _context17.prev = 10;
              _context17.t0 = _context17["catch"](5);
              console.error(_context17.t0);
            case 13:
            case "end":
              return _context17.stop();
          }
        }, _callee11, null, [[5, 10]]);
      }));
      function parse(_x36) {
        return _parse.apply(this, arguments);
      }
      return parse;
    }()
  }]);
  return Em;
}();
function C7(_x37) {
  return _C19.apply(this, arguments);
}
function _C19() {
  _C19 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(n) {
    return _regeneratorRuntime().wrap(function _callee22$(_context28) {
      while (1) switch (_context28.prev = _context28.next) {
        case 0:
          _context28.next = 2;
          return fetch(n);
        case 2:
          _context28.next = 4;
          return _context28.sent.arrayBuffer();
        case 4:
          return _context28.abrupt("return", _context28.sent);
        case 5:
        case "end":
          return _context28.stop();
      }
    }, _callee22);
  }));
  return _C19.apply(this, arguments);
}
var P7 = new Em();
function $A(_x38) {
  return _$A.apply(this, arguments);
}
function _$A() {
  _$A = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23(n) {
    var t, e, r, _i221;
    return _regeneratorRuntime().wrap(function _callee23$(_context29) {
      while (1) switch (_context29.prev = _context29.next) {
        case 0:
          r = !1;
          if (!n.url) {
            _context29.next = 9;
            break;
          }
          _context29.next = 4;
          return C7(n.url);
        case 4:
          t = _context29.sent;
          e = n.url;
          r = n.url.startsWith("/");
          _context29.next = 10;
          break;
        case 9:
          n.data && (t = n.data.buffer.slice(n.data.byteOffset, n.data.byteOffset + n.data.byteLength));
        case 10:
          if (!t) {
            _context29.next = 20;
            break;
          }
          if (!ZA) {
            _context29.next = 19;
            break;
          }
          _context29.next = 14;
          return P7.parse(t);
        case 14:
          _i221 = _context29.sent;
          if (!_i221) {
            _context29.next = 17;
            break;
          }
          return _context29.abrupt("return", {
            font: _i221.font,
            url: e,
            intercepted: r,
            arr: t,
            bidi: _i221.bidi
          });
        case 17:
          _context29.next = 20;
          break;
        case 19:
          return _context29.abrupt("return", {
            font: void 0,
            url: e,
            intercepted: r,
            arr: t,
            bidi: null
          });
        case 20:
        case "end":
          return _context29.stop();
      }
    }, _callee23);
  }));
  return _$A.apply(this, arguments);
}
function D7(n, t) {
  return t.state.glyphIndex === n || t.state.fina === n || t.state.medi === n || t.state.init === n;
}
var Z0 = /*#__PURE__*/function () {
  function Z0(t) {
    var _t$isUserFont,
      _this202 = this;
    _classCallCheck(this, Z0);
    this._arrayBuffer = new ArrayBuffer(1);
    this._isLoaded = !1;
    this._intercepted = !1;
    this._isUserFont = (_t$isUserFont = t.isUserFont) !== null && _t$isUserFont !== void 0 ? _t$isUserFont : !1, this._loadingPromise = $A(t).then(function (e) {
      e && (_this202._arrayBuffer = e.arr, _this202._url = e.url, _this202.font = e.font, _this202._intercepted = e.intercepted, _this202._isLoaded = !0, _this202._bidi = e.bidi);
    });
  }
  _createClass(Z0, [{
    key: "update",
    value: function update(t) {
      var _t$isUserFont2,
        _this203 = this;
      this._isLoaded = !1, this._isUserFont = (_t$isUserFont2 = t.isUserFont) !== null && _t$isUserFont2 !== void 0 ? _t$isUserFont2 : !1, this._loadingPromise = $A(t).then(function (e) {
        e && (_this203._arrayBuffer = e.arr, _this203._url = e.url, _this203.font = e.font, _this203._intercepted = e.intercepted, _this203._isLoaded = !0, _this203._bidi = e.bidi);
      });
    }
  }, {
    key: "url",
    get: function get() {
      return this._url;
    }
  }, {
    key: "intercepted",
    get: function get() {
      return this._intercepted;
    }
  }, {
    key: "isLoaded",
    get: function get() {
      return this._isLoaded;
    }
  }, {
    key: "loadingPromise",
    get: function get() {
      return this._loadingPromise;
    }
  }, {
    key: "reverseLigaturesTable",
    value: function reverseLigaturesTable(t, e, r) {
      if (!this._bidi) return [];
      var i = this._bidi;
      i.getTextGlyphs(e);
      var s = i.tokenizer.tokens,
        o = [],
        a = 0,
        l = r.length === s.length;
      for (var u = 0; u < r.length; u++) {
        var c = r[u].index,
          d = String.fromCharCode(r[u].unicode),
          h = s[a];
        if (D7(c, h) || l) o.push({
          char: d,
          index: c,
          replacements: [h.state.glyphIndex],
          replacementChars: [h.char]
        }), a++;else {
          var f = h.char,
            p = "",
            m = [h.state.glyphIndex],
            g = [],
            y = !1;
          for (; !y;) a++, p = e.charAt(a), f += p, m.push(t.charToGlyphIndex(p)), g = t.stringToGlyphs(f), g.length === 1 && g[0].index === c && (y = !0), a > e.length && (y = !0);
          o.push({
            char: d,
            index: c,
            replacements: m,
            replacementChars: Array.from(f)
          }), a++;
        }
      }
      return o;
    }
  }, {
    key: "generateShapes",
    value: function generateShapes(t, e) {
      var _this204 = this;
      if (!this._isLoaded) return;
      var r = this.font,
        i = e.fontSize / this.unitsPerEm,
        s = e.fontSize * e.lineHeight,
        o = t.map(function (v) {
          return _this204.getTextWidth(v, e);
        }),
        a = e.width,
        l = this.getCharWidth("\n", e),
        u = e.horizontalAlign === 1 ? l : 0,
        c = this.computeSpaceWidthForLine(t, 0, e),
        d = this.getLineInitialOffsetX(o[0], a, e.horizontalAlign, t[0], l),
        h = this.getLineInitialOffsetY(s, t.length, e.height, i, e.verticalAlign),
        f = [],
        p = t.map(function (v) {
          return [];
        }),
        m = t.map(function (v) {
          return [];
        }),
        g;
      for (var v = 0; v < t.length; v++) {
        var x = t[v],
          S = {
            features: {
              liga: !0
            }
          },
          w = [];
        try {
          w = r.stringToGlyphs(x, S);
        } catch (E) {
          console.warn(E);
        }
        d = this.getLineInitialOffsetX(o[v], a, e.horizontalAlign, x, l);
        var A = [];
        try {
          A = this.reverseLigaturesTable(r, x, w);
        } catch (E) {
          console.warn(E);
        }
        c = this.computeSpaceWidthForLine(t, v, e);
        var _loop13 = function _loop13() {
          var b = w[E],
            T = b.index === 0 ? "\n" : b.unicode ? String.fromCharCode(b.unicode) : void 0,
            M = A[E],
            C = 0,
            P = 0;
          E === 0 && e.horizontalAlign === 2 && b.leftSideBearing !== void 0 && (P = -b.leftSideBearing * i), g && (C = r.getKerningValue(b, g) * i), d += P + C;
          var D = 0;
          if (T === "\n") D = u;else if (T === " ") D = c;else {
            var O = _this204.createPath(b, i, d, h, e);
            O && (D = O.offsetX - (C + P), f.push(O.path));
          }
          if (M.replacements.length === 1) m[v].push([d, h]), p[v].push(D);else {
            var _O22 = M.replacements.map(function (V) {
                var _r$glyphs$get$advance;
                return ((_r$glyphs$get$advance = r.glyphs.get(V).advanceWidth) !== null && _r$glyphs$get$advance !== void 0 ? _r$glyphs$get$advance : 0) * i;
              }),
              I = _O22.reduce(function (V, U) {
                return V += U;
              }, 0),
              z = _O22.map(function (V) {
                return V / I;
              }),
              B = d;
            for (var _V14 = 0; _V14 < z.length; _V14++) {
              var _U15 = D * z[_V14];
              m[v].push([B, h]), p[v].push(_U15), B += _U15;
            }
          }
          d += D, g = b;
        };
        for (var E = 0; E < w.length; E++) {
          _loop13();
        }
        h -= s;
      }
      var y = [];
      for (var _v31 = 0, _x39 = f.length; _v31 < _x39; _v31++) y.push.apply(y, _toConsumableArray(f[_v31].toShapes()));
      return {
        shapes: y,
        charWidths: p,
        lineWidths: o,
        charCoords: m
      };
    }
  }, {
    key: "isUserFont",
    get: function get() {
      return this._isUserFont;
    }
  }, {
    key: "arrayBuffer",
    get: function get() {
      return this._arrayBuffer;
    }
  }, {
    key: "ascender",
    get: function get() {
      var _this$font$ascender, _this$font;
      return (_this$font$ascender = (_this$font = this.font) === null || _this$font === void 0 ? void 0 : _this$font.ascender) !== null && _this$font$ascender !== void 0 ? _this$font$ascender : 0;
    }
  }, {
    key: "descender",
    get: function get() {
      var _this$font$descender, _this$font2;
      return (_this$font$descender = (_this$font2 = this.font) === null || _this$font2 === void 0 ? void 0 : _this$font2.descender) !== null && _this$font$descender !== void 0 ? _this$font$descender : 0;
    }
  }, {
    key: "familyName",
    get: function get() {
      var _this$font$names$font, _this$font3;
      return (_this$font$names$font = (_this$font3 = this.font) === null || _this$font3 === void 0 ? void 0 : _this$font3.names.fontFamily) !== null && _this$font$names$font !== void 0 ? _this$font$names$font : "";
    }
  }, {
    key: "subfamilyName",
    get: function get() {
      var _this$font$names$font2, _this$font4;
      return (_this$font$names$font2 = (_this$font4 = this.font) === null || _this$font4 === void 0 ? void 0 : _this$font4.names.fontSubfamily) !== null && _this$font$names$font2 !== void 0 ? _this$font$names$font2 : "";
    }
  }, {
    key: "unitsPerEm",
    get: function get() {
      var _this$font$unitsPerEm, _this$font5;
      return (_this$font$unitsPerEm = (_this$font5 = this.font) === null || _this$font5 === void 0 ? void 0 : _this$font5.unitsPerEm) !== null && _this$font$unitsPerEm !== void 0 ? _this$font$unitsPerEm : 1;
    }
  }, {
    key: "getLineInitialOffsetX",
    value: function getLineInitialOffsetX(t, e, r, i, s) {
      return (r === 3 || r === 2) && i.indexOf("\n") >= 0 && (t -= s), r === 3 ? e * .5 - t * .5 : r === 2 ? e - t : 0;
    }
  }, {
    key: "getLineInitialOffsetY",
    value: function getLineInitialOffsetY(t, e, r, i, s) {
      var o = e * t,
        a = Math.abs(this.ascender - this.descender) * i,
        l = t - a,
        u = -this.ascender * i - l / 2;
      return s === 3 ? -(r - o - u) : s === 2 ? -(r * .5 - o * .5 - u) : u;
    }
  }, {
    key: "createPath",
    value: function createPath(t, e, r, i, s) {
      var _t$advanceWidth;
      var o = t.getPath(r, -i, s.fontSize, {
        kerning: !1,
        letterSpacing: s.letterSpacing
      });
      if (!o) {
        console.error('THREE.Font: character "' + t + '" does not exists in font family ' + this.familyName + ".");
        return;
      }
      var a = new Q0(),
        l = ((_t$advanceWidth = t.advanceWidth) !== null && _t$advanceWidth !== void 0 ? _t$advanceWidth : 1) * e;
      if (t) {
        var _iterator66 = _createForOfIteratorHelper(o.commands),
          _step66;
        try {
          for (_iterator66.s(); !(_step66 = _iterator66.n()).done;) {
            var _a$currentPath;
            var u = _step66.value;
            var c = (_a$currentPath = a.currentPath) === null || _a$currentPath === void 0 ? void 0 : _a$currentPath.currentPoint;
            if (!(c && u.type !== "Z" && c.x === u.x && -c.y === u.y)) switch (u.type) {
              case "M":
                a.moveTo(u.x, -u.y);
                break;
              case "L":
                a.lineTo(u.x, -u.y);
                break;
              case "Q":
                a.quadraticCurveTo(u.x1, -u.y1, u.x, -u.y);
                break;
              case "C":
                a.bezierCurveTo(u.x1, -u.y1, u.x2, -u.y2, u.x, -u.y);
                break;
            }
          }
        } catch (err) {
          _iterator66.e(err);
        } finally {
          _iterator66.f();
        }
      }
      return a.subPaths.forEach(function (u) {
        var c = O7(u.curves);
        c !== void 0 && u.currentPoint.distanceTo(c) > 0 && u.lineTo(c.x, c.y);
      }), {
        offsetX: l + s.fontSize * s.letterSpacing,
        path: a
      };
    }
  }, {
    key: "getCharWidth",
    value: function getCharWidth(t, e) {
      var _this$font$getAdvance, _this$font6;
      return (_this$font$getAdvance = (_this$font6 = this.font) === null || _this$font6 === void 0 ? void 0 : _this$font6.getAdvanceWidth(t, e.fontSize, {
        kerning: !0,
        letterSpacing: e.letterSpacing
      })) !== null && _this$font$getAdvance !== void 0 ? _this$font$getAdvance : 0;
    }
  }, {
    key: "getTextWidth",
    value: function getTextWidth(t, e) {
      var _this$font$getAdvance2, _this$font7;
      return (_this$font$getAdvance2 = (_this$font7 = this.font) === null || _this$font7 === void 0 ? void 0 : _this$font7.getAdvanceWidth(t, e.fontSize, {
        kerning: !0,
        letterSpacing: e.letterSpacing
      })) !== null && _this$font$getAdvance2 !== void 0 ? _this$font$getAdvance2 : 0;
    }
  }, {
    key: "computeSpaceWidthForLine",
    value: function computeSpaceWidthForLine(t, e, r) {
      var i = this.getCharWidth(" ", r),
        s = t[e];
      if (s) {
        var o = this.countSpaces(s.trimEnd());
        if (r.horizontalAlign === 4 && e < t.length - 1 && o) {
          var a = r.width,
            l = this.getTextWidth(s, r);
          return (a - (l - o * i)) / o;
        }
      }
      return i;
    }
  }, {
    key: "countSpaces",
    value: function countSpaces(t) {
      return (t.match(/ /g) || []).length;
    }
  }]);
  return Z0;
}();
function O7(n) {
  if (n.length) {
    var t = n[0];
    if (t instanceof nn) return t.v1;
    if (t instanceof rn || t instanceof Wn) return t.v0;
  }
}
var e_ = /*#__PURE__*/function () {
    function e_() {
      _classCallCheck(this, e_);
      this.objects = new Map();
      this.unreachable = new Set();
    }
    _createClass(e_, [{
      key: "getCached",
      value: function getCached(t) {
        return this.objects.get(t);
      }
    }, {
      key: "size",
      get: function get() {
        return this.objects.size;
      }
    }, {
      key: "get",
      value: function get(t, e, r) {
        var i = this.objects.get(t);
        return i === void 0 ? (i = this.createObject(t, e, r), this.objects.set(t, i)) : i.isShared = !0, i;
      }
    }, {
      key: "forceDelete",
      value: function forceDelete(t) {
        var e = this.objects.get(t);
        e && (this.disposeObject(e), this.objects.delete(t));
      }
    }, {
      key: "mutateIfUnique",
      value: function mutateIfUnique(t, e) {
        var r = this.objects.get(t);
        if (r && r.isShared !== !0) return this.objects.delete(t), this.objects.set(e, r), r;
      }
    }, {
      key: "startGc",
      value: function startGc() {
        this.unreachable = new Set(this.objects.keys());
      }
    }, {
      key: "markAsReachable",
      value: function markAsReachable(t, e) {
        var r = this.objects.get(t);
        e === r ? this.unreachable.delete(t) : !1 && console.warn("Reachable but deleted", t);
      }
    }, {
      key: "endGc",
      value: function endGc() {
        var _this205 = this;
        this.unreachable.forEach(function (t) {
          _this205.disposeObject(_this205.objects.get(t)), _this205.objects.delete(t);
        }), this.unreachable.clear();
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this206 = this;
        this.objects.forEach(function (t) {
          _this206.disposeObject(t);
        }), this.objects.clear();
      }
    }]);
    return e_;
  }(),
  Tm = /*#__PURE__*/function (_e_) {
    _inherits(Tm, _e_);
    var _super202 = _createSuper(Tm);
    function Tm(e) {
      var _this207;
      _classCallCheck(this, Tm);
      _this207 = _super202.call(this);
      _this207.flatShading = e;
      return _this207;
    }
    _createClass(Tm, [{
      key: "disposeObject",
      value: function disposeObject(e) {
        e.dispose();
      }
    }, {
      key: "createObject",
      value: function createObject(e, r, i) {
        var s = Ta(e, r, this.flatShading, i);
        return s.computeBoundingSphere(), s;
      }
    }]);
    return Tm;
  }(e_);
var aR = {
  markNeedsUpdateRendererDirty: function markNeedsUpdateRendererDirty() {}
};
var t_ = /*#__PURE__*/function (_G20) {
    _inherits(t_, _G20);
    var _super203 = _createSuper(t_);
    function t_(e) {
      var _this208;
      _classCallCheck(this, t_);
      _this208 = _super203.call(this);
      _this208.shared = e;
      return _this208;
    }
    _createClass(t_, [{
      key: "create",
      value: function create(e) {
        return new Zh(e, this.shared);
      }
    }]);
    return t_;
  }(G0),
  Wc = /*#__PURE__*/function () {
    function Wc(t) {
      var _this209 = this;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      _classCallCheck(this, Wc);
      this.data = t;
      this.geometryCache = new Tm(!0);
      this.geometryCache2 = new Tm(!1);
      this.imageHolderCache = new t_(this);
      this.thisContext = {
        scene: aR,
        shared: this
      };
      this.deletedMaterial = new Hc(Qr.defaultTwoLayerData("phong"), this.thisContext, "");
      this.deletedImage = new Zn(Yd.emptyImage, this);
      this.deletedVideo = new Zn(kd.defaultVideo, this);
      this.materials = {};
      this.images = {};
      this.canvases = {};
      this.videos = {};
      this.colors = {};
      this.audios = {};
      this.particles = {};
      this.fonts = {};
      this.variables = {};
      this.mouseProperty = null;
      this.raycastProperty = null;
      this.requestRender = function () {
        _this209._requestRender && _this209._requestRender();
      };
      if (e.images) for (var _i76 = 0, _Object$entries14 = Object.entries(e.images); _i76 < _Object$entries14.length; _i76++) {
        var _Object$entries14$_i = _slicedToArray(_Object$entries14[_i76], 2),
          r = _Object$entries14$_i[0],
          _i77 = _Object$entries14$_i[1];
        this.addImage(r, _i77);
      }
      if (e.videos) for (var _i78 = 0, _Object$entries15 = Object.entries(e.videos); _i78 < _Object$entries15.length; _i78++) {
        var _Object$entries15$_i = _slicedToArray(_Object$entries15[_i78], 2),
          _r36 = _Object$entries15$_i[0],
          _i79 = _Object$entries15$_i[1];
        this.addVideo(_r36, _i79);
      }
      if (e.audios) for (var _i80 = 0, _Object$entries16 = Object.entries(e.audios); _i80 < _Object$entries16.length; _i80++) {
        var _Object$entries16$_i = _slicedToArray(_Object$entries16[_i80], 2),
          _r37 = _Object$entries16$_i[0],
          _i81 = _Object$entries16$_i[1];
        this.addAudio(_r37, _i81);
      }
      if (e.particles) for (var _i82 = 0, _Object$entries17 = Object.entries(e.particles); _i82 < _Object$entries17.length; _i82++) {
        var _Object$entries17$_i = _slicedToArray(_Object$entries17[_i82], 2),
          _r38 = _Object$entries17$_i[0],
          _i83 = _Object$entries17$_i[1];
        this.addParticle(_r38, _i83);
      }
      this.reset(t);
    }
    _createClass(Wc, [{
      key: "setRequestRender",
      value: function setRequestRender(t) {
        this._requestRender = t;
      }
    }, {
      key: "setEntityOpContext",
      value: function setEntityOpContext(t) {
        this.entityOpContext = t;
      }
    }, {
      key: "reset",
      value: function reset(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        this.resetLib(t.lib);
        var _iterator67 = _createForOfIteratorHelper(t.variables),
          _step67;
        try {
          for (_iterator67.s(); !(_step67 = _iterator67.n()).done;) {
            var _step67$value = _step67.value,
              _r45 = _step67$value.id,
              _i98 = _step67$value.data;
            this.addVariableHolder(_r45, _i98), e && this.updateVariableHolder(_r45, _i98);
          }
        } catch (err) {
          _iterator67.e(err);
        } finally {
          _iterator67.f();
        }
        for (var _i84 = 0, _Object$entries18 = Object.entries(t.images); _i84 < _Object$entries18.length; _i84++) {
          var _Object$entries18$_i = _slicedToArray(_Object$entries18[_i84], 2),
            r = _Object$entries18$_i[0],
            _i85 = _Object$entries18$_i[1];
          this.addImage(r, _i85);
        }
        for (var _i86 = 0, _Object$entries19 = Object.entries(t.videos); _i86 < _Object$entries19.length; _i86++) {
          var _Object$entries19$_i = _slicedToArray(_Object$entries19[_i86], 2),
            _r39 = _Object$entries19$_i[0],
            _i87 = _Object$entries19$_i[1];
          this.addVideo(_r39, _i87);
        }
        for (var _i88 = 0, _Object$entries20 = Object.entries(t.colors); _i88 < _Object$entries20.length; _i88++) {
          var _Object$entries20$_i = _slicedToArray(_Object$entries20[_i88], 2),
            _r40 = _Object$entries20$_i[0],
            _i89 = _Object$entries20$_i[1];
          this.addColor(_r40, _i89);
        }
        for (var _i90 = 0, _Object$entries21 = Object.entries(t.materials); _i90 < _Object$entries21.length; _i90++) {
          var _Object$entries21$_i = _slicedToArray(_Object$entries21[_i90], 2),
            _r41 = _Object$entries21$_i[0],
            _i91 = _Object$entries21$_i[1];
          this.addMaterial(_r41, _i91);
        }
        for (var _i92 = 0, _Object$entries22 = Object.entries(t.audios); _i92 < _Object$entries22.length; _i92++) {
          var _Object$entries22$_i = _slicedToArray(_Object$entries22[_i92], 2),
            _r42 = _Object$entries22$_i[0],
            _i93 = _Object$entries22$_i[1];
          this.addAudio(_r42, _i93);
        }
        for (var _i94 = 0, _Object$entries23 = Object.entries(t.particles); _i94 < _Object$entries23.length; _i94++) {
          var _Object$entries23$_i = _slicedToArray(_Object$entries23[_i94], 2),
            _r43 = _Object$entries23$_i[0],
            _i95 = _Object$entries23$_i[1];
          this.addParticle(_r43, _i95);
        }
        for (var _i96 = 0, _Object$entries24 = Object.entries(t.fonts); _i96 < _Object$entries24.length; _i96++) {
          var _Object$entries24$_i = _slicedToArray(_Object$entries24[_i96], 2),
            _r44 = _Object$entries24$_i[0],
            _i97 = _Object$entries24$_i[1];
          this.addFont(_r44, _i97);
        }
      }
    }, {
      key: "addMaterial",
      value: function addMaterial(t, e) {
        if (this.materials[t]) {
          var r = this.materials[t];
          r.reset(e, this.thisContext), r.dispose();
        } else {
          var _r46 = new Hc(e, this.thisContext, t);
          this.materials[t] = _r46;
        }
      }
    }, {
      key: "deleteMaterial",
      value: function deleteMaterial(t) {
        this.materials[t] && (this.materials[t].nodeMaterialDispose(), delete this.materials[t]);
      }
    }, {
      key: "getMaterial",
      value: function getMaterial(t) {
        var e = this.materials[t];
        return e;
      }
    }, {
      key: "getMaterialOrDeletedPlaceholder",
      value: function getMaterialOrDeletedPlaceholder(t) {
        var _this$materials$t;
        return (_this$materials$t = this.materials[t]) !== null && _this$materials$t !== void 0 ? _this$materials$t : this.deletedMaterial;
      }
    }, {
      key: "material",
      value: function material(t) {
        return typeof t == "string" ? this.getMaterialOrDeletedPlaceholder(t) : t == null ? (console.error("material is undefined or null"), this.deletedMaterial) : new Pa(t, this.thisContext);
      }
    }, {
      key: "getMaterials",
      value: function getMaterials() {
        return this.materials;
      }
    }, {
      key: "addImage",
      value: function addImage(t, e) {
        return this.images[t] ? (this.onColorOrImageUpdate && this.onColorOrImageUpdate(), this.images[t].updateSrc(e.data), !0) : (this.images[t] = new Zn(e, this), !1);
      }
    }, {
      key: "deleteImage",
      value: function deleteImage(t) {
        var e = this.images[t];
        e && (e.dispose(), delete this.images[t]);
      }
    }, {
      key: "getDefaultImage",
      value: function getDefaultImage() {
        return this.images.image_0;
      }
    }, {
      key: "getImage",
      value: function getImage(t) {
        var _this$images$t;
        return (_this$images$t = this.images[t]) !== null && _this$images$t !== void 0 ? _this$images$t : this.deletedImage;
      }
    }, {
      key: "image",
      value: function image(t) {
        return typeof t == "string" ? this.getImage(t) : this.imageHolderCache.load(t);
      }
    }, {
      key: "addCanvas",
      value: function addCanvas(t, e) {
        return this.canvases[t] ? (this.onColorOrImageUpdate && this.onColorOrImageUpdate(), this.canvases[t].updateSrc(e), !0) : (this.canvases[t] = new Zn(e, this), !1);
      }
    }, {
      key: "canvas",
      value: function canvas(t) {
        return this.canvases[t];
      }
    }, {
      key: "addVideo",
      value: function addVideo(t, e) {
        return this.videos[t] ? (this.videos[t].updateSrc(e.data), !0) : (this.videos[t] = new Zn(e, this), !1);
      }
    }, {
      key: "deleteVideo",
      value: function deleteVideo(t) {
        var e = this.videos[t];
        e && (e.dispose(), delete this.videos[t]);
      }
    }, {
      key: "getVideo",
      value: function getVideo(t) {
        var _this$videos$t;
        return (_this$videos$t = this.videos[t]) !== null && _this$videos$t !== void 0 ? _this$videos$t : this.deletedVideo;
      }
    }, {
      key: "video",
      value: function video(t) {
        return typeof t == "string" ? this.getVideo(t) : this.imageHolderCache.load(t);
      }
    }, {
      key: "addColor",
      value: function addColor(t, e) {
        return this.colors[t] ? (this.onColorOrImageUpdate && this.onColorOrImageUpdate(), "a" in e ? this.colors[t].setRGBA(e.r, e.g, e.b, e.a) : this.colors[t].setRGBA(e.r, e.g, e.b, 1), !0) : ("a" in e ? this.colors[t] = new Bl(e.r, e.g, e.b, e.a) : this.colors[t] = new Bl(e.r, e.g, e.b, 1), !1);
      }
    }, {
      key: "updateColor",
      value: function updateColor(t, e) {
        if (this.colors[t]) {
          var _e$r, _e$g, _e$b, _e$a;
          this.onColorOrImageUpdate && this.onColorOrImageUpdate();
          var r = this.colors[t];
          return this.colors[t].r = (_e$r = e.r) !== null && _e$r !== void 0 ? _e$r : r.r, this.colors[t].g = (_e$g = e.g) !== null && _e$g !== void 0 ? _e$g : r.g, this.colors[t].b = (_e$b = e.b) !== null && _e$b !== void 0 ? _e$b : r.b, this.colors[t].a = (_e$a = e.a) !== null && _e$a !== void 0 ? _e$a : r.a, !0;
        }
        return !1;
      }
    }, {
      key: "deleteColor",
      value: function deleteColor(t) {
        this.colors[t] && delete this.colors[t];
      }
    }, {
      key: "getColor",
      value: function getColor(t) {
        return this.colors[t];
      }
    }, {
      key: "color",
      value: function color(t) {
        var e;
        if (typeof t == "string") {
          var r = this.getColor(t);
          r ? e = r : (console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"), e = new cr(0, 0, 0, 0));
        } else return "a" in t ? new cr(t.r, t.g, t.b, t.a) : new cr(t.r, t.g, t.b, 1);
        return e;
      }
    }, {
      key: "addAudio",
      value: function addAudio(t, e) {
        this.audios[t] = e;
      }
    }, {
      key: "getAudio",
      value: function getAudio(t) {
        var e = this.audios[t];
        if (e instanceof Da) return e;
        {
          var r = new Da({
            src: e.data
          });
          return this.audios[t] = r, r;
        }
      }
    }, {
      key: "addParticle",
      value: function addParticle(t, e) {
        this.particles[t] = e;
      }
    }, {
      key: "getParticle",
      value: function getParticle(t) {
        return this.particles[t];
      }
    }, {
      key: "deleteParticle",
      value: function deleteParticle(t) {
        this.particles[t] && delete this.particles[t];
      }
    }, {
      key: "deleteAudio",
      value: function deleteAudio(t) {
        var e = this.audios[t];
        e && (e instanceof Da && e.dispose(), delete this.audios[t]);
      }
    }, {
      key: "addFont",
      value: function addFont(t, e) {
        var _this210 = this;
        this.fonts[t] = new Z0(e), this.fonts[t].loadingPromise.then(function () {
          return _this210.requestRender();
        });
      }
    }, {
      key: "getFont",
      value: function getFont(t) {
        return this.fonts[t];
      }
    }, {
      key: "deleteFont",
      value: function deleteFont(t) {
        this.fonts[t] && delete this.fonts[t];
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this211 = this;
        Object.keys(this.materials).forEach(function (e) {
          return _this211.deleteMaterial(e);
        }), this._requestRender = void 0, Object.values(this.audios).forEach(function (e) {
          e instanceof Da && e.dispose();
        }), this.audios = {}, this.particles = {}, this.geometryCache.dispose(), this.geometryCache2.dispose();
      }
    }, {
      key: "addVariableHolder",
      value: function addVariableHolder(t, e) {
        return this.variables[t] === void 0 ? (this.variables[t] = {
          value: e.value,
          locations: []
        }, "dynamicVariableType" in e && (this.variables[t].dynamicVariablePlayState = "Playing", this.variables[t].dynamicVariableToggleIsForward = void 0), !0) : (this.variables[t].value = e.value, !1);
      }
    }, {
      key: "resetDynamicVariablePlayState",
      value: function resetDynamicVariablePlayState() {
        for (var t in this.variables) this.variables[t].dynamicVariablePlayState !== void 0 && (this.variables[t].dynamicVariablePlayState = "Playing", this.variables[t].dynamicVariableToggleIsForward = void 0);
      }
    }, {
      key: "updateVariableHolder",
      value: function updateVariableHolder(t, e) {
        this.updateVariable(t, e.value);
      }
    }, {
      key: "updateVariable",
      value: function updateVariable(t, e) {
        var _this212 = this;
        if (this.variables[t] === void 0) return !1;
        this.variables[t].value = e;
        var r = e;
        for (; typeof r == "string";) r = this.variables[r].value;
        var i = this.entityOpContext.scene;
        var _loop14 = function _loop14() {
          var o = _this212.variables[t].locations[s];
          if (o[0] === "material") {
            var a = o[1],
              l = r,
              u = {
                scene: i,
                shared: _this212
              },
              c = o.slice(2);
            i.traverseMaterial(function (h) {
              var _h$root;
              var f = (_h$root = h.root) !== null && _h$root !== void 0 ? _h$root : h;
              f.uuid === a && f.onVariableUpdate(c, l, u);
            });
            var d = _this212.materials[a];
            d && d.onVariableUpdate(c, l, u);
          } else {
            var _a50 = i.find(o[0]);
            if (_a50 === void 0) {
              _this212.variables[t].locations.splice(s, 1);
              return 1; // continue
            }
            if (o[1] !== "geometry" && o[1] !== "particles") {
              for (var _l81 = 1; _l81 < o.length - 1; _l81++) _a50 = _a50[o[_l81]];
              o[1] === "rotation" ? _a50[o[o.length - 1]] = r * Se.DEG2RAD : _a50[o[o.length - 1]] = r;
            }
            if (_a50 = i.find(o[0]), _a50.type === "ParticleEmitter" && _a50.updateVariableState(r, o), ut.is(_a50)) {
              if (o[1] === "position" || o[1] === "rotation" || o[1] === "scale") _a50.onVariableUpdate();else if (o[1] === "geometry") {
                var _l82 = _a50;
                _a50.component && (_l82 = _a50.component);
                var _u49 = _l82.dataPatched;
                _l82.chooseGeoemtryCache(_this212).forceDelete(_u49.geometry), _l82.createGeometryDelayed(_this212.entityOpContext), _l82.onVariableUpdate(!0), _l82.instances.forEach(function (c) {
                  var d = c.dataPatched;
                  c.chooseGeoemtryCache(_this212).forceDelete(d.geometry), c.createGeometryDelayed(_this212.entityOpContext), c.onVariableUpdate(!0);
                });
              }
            }
          }
        };
        for (var s = this.variables[t].locations.length - 1; s >= 0; s--) {
          if (_loop14()) continue;
        }
        return !0;
      }
    }, {
      key: "deleteVariable",
      value: function deleteVariable(t) {
        this.variables[t] && delete this.variables[t];
      }
    }, {
      key: "getVariable",
      value: function getVariable(t, e) {
        if (Array.isArray(t)) {
          var _this$mouseProperty$t, _this$mouseProperty, _this$raycastProperty, _this$raycastProperty2;
          if (t[0] === "mouse") return (_this$mouseProperty$t = (_this$mouseProperty = this.mouseProperty) === null || _this$mouseProperty === void 0 ? void 0 : _this$mouseProperty[t[1]]) !== null && _this$mouseProperty$t !== void 0 ? _this$mouseProperty$t : 0;
          if (t[0] === "raycast") return (_this$raycastProperty = (_this$raycastProperty2 = this.raycastProperty) === null || _this$raycastProperty2 === void 0 ? void 0 : _this$raycastProperty2[t[1]]) !== null && _this$raycastProperty !== void 0 ? _this$raycastProperty : 0;
          var r = this.entityOpContext.scene.find(t[0]);
          if (t[1] === "width" || t[1] === "height" || t[1] === "depth") return r.geometry.userData.parameters[t[1]];
          for (var _i99 = 1; _i99 < t.length; _i99++) r = r[t[_i99]];
          return t[1] === "rotation" && (r *= Se.RAD2DEG), r;
        }
        for (var _r47 in this.variables) {
          var _i100$locations;
          if (e === void 0) break;
          var _i100 = this.variables[_r47],
            s = (_i100$locations = _i100.locations) === null || _i100$locations === void 0 ? void 0 : _i100$locations.findIndex(function (o) {
              return Tr.equal(o, e);
            });
          s !== void 0 && s !== -1 && _i100.locations.splice(s, 1);
        }
        if (typeof t == "string") {
          var _r48 = t,
            _i101 = t;
          do {
            if (_i101 = _r48, this.variables[_r48] === void 0) break;
            _r48 = this.variables[_r48].value;
          } while (typeof _r48 == "string");
          return e && this.variables[_i101] !== void 0 && this.variables[_i101].locations.push(e), _r48;
        } else return t;
      }
    }, {
      key: "getVariables",
      value: function getVariables() {
        return this.variables;
      }
    }, {
      key: "getDynamicVariablePlayState",
      value: function getDynamicVariablePlayState(t) {
        var _this$variables$t;
        return (_this$variables$t = this.variables[t]) === null || _this$variables$t === void 0 ? void 0 : _this$variables$t.dynamicVariablePlayState;
      }
    }, {
      key: "setDynamicVariablePlayState",
      value: function setDynamicVariablePlayState(t, e) {
        this.variables[t] !== void 0 && (this.variables[t].dynamicVariablePlayState = e);
      }
    }, {
      key: "getDynamicVariableToggleIsForward",
      value: function getDynamicVariableToggleIsForward(t) {
        var _this$variables$t2;
        return (_this$variables$t2 = this.variables[t]) === null || _this$variables$t2 === void 0 ? void 0 : _this$variables$t2.dynamicVariableToggleIsForward;
      }
    }, {
      key: "setDynamicVariableToggleIsForward",
      value: function setDynamicVariableToggleIsForward(t, e) {
        this.variables[t] !== void 0 && (this.variables[t].dynamicVariableToggleIsForward = e);
      }
    }, {
      key: "resetLib",
      value: function resetLib(t) {
        for (var _i102 = 0, _Object$entries25 = Object.entries(t.images); _i102 < _Object$entries25.length; _i102++) {
          var _Object$entries25$_i = _slicedToArray(_Object$entries25[_i102], 2),
            e = _Object$entries25$_i[0],
            r = _Object$entries25$_i[1];
          this.addImage(e, r.asset);
        }
        for (var _i103 = 0, _Object$entries26 = Object.entries(t.audios); _i103 < _Object$entries26.length; _i103++) {
          var _Object$entries26$_i = _slicedToArray(_Object$entries26[_i103], 2),
            _e56 = _Object$entries26$_i[0],
            _r49 = _Object$entries26$_i[1];
          this.addAudio(_e56, _r49.asset);
        }
        for (var _i104 = 0, _Object$entries27 = Object.entries(t.particles); _i104 < _Object$entries27.length; _i104++) {
          var _Object$entries27$_i = _slicedToArray(_Object$entries27[_i104], 2),
            _e57 = _Object$entries27$_i[0],
            _r50 = _Object$entries27$_i[1];
          this.addParticle(_e57, _r50.asset);
        }
        for (var _i105 = 0, _Object$entries28 = Object.entries(t.colors); _i105 < _Object$entries28.length; _i105++) {
          var _Object$entries28$_i = _slicedToArray(_Object$entries28[_i105], 2),
            _e58 = _Object$entries28$_i[0],
            _r51 = _Object$entries28$_i[1];
          this.addColor(_e58, _r51.asset);
        }
        for (var _i106 = 0, _Object$entries29 = Object.entries(t.fonts); _i106 < _Object$entries29.length; _i106++) {
          var _Object$entries29$_i = _slicedToArray(_Object$entries29[_i106], 2),
            _e59 = _Object$entries29$_i[0],
            _r52 = _Object$entries29$_i[1];
          this.addFont(_e59, _r52.asset);
        }
        for (var _i107 = 0, _Object$entries30 = Object.entries(t.materials); _i107 < _Object$entries30.length; _i107++) {
          var _Object$entries30$_i = _slicedToArray(_Object$entries30[_i107], 2),
            _e60 = _Object$entries30$_i[0],
            _r53 = _Object$entries30$_i[1];
          this.addMaterial(_e60, _r53.asset);
        }
        for (var _i108 = 0, _Object$entries31 = Object.entries(t.videos); _i108 < _Object$entries31.length; _i108++) {
          var _Object$entries31$_i = _slicedToArray(_Object$entries31[_i108], 2),
            _e61 = _Object$entries31$_i[0],
            _r54 = _Object$entries31$_i[1];
          this.addVideo(_e61, _r54.asset);
        }
        for (var _i109 = 0, _Object$entries32 = Object.entries(t.variables); _i109 < _Object$entries32.length; _i109++) {
          var _Object$entries32$_i = _slicedToArray(_Object$entries32[_i109], 2),
            _e62 = _Object$entries32$_i[0],
            _r55 = _Object$entries32$_i[1];
          this.addVariableHolder(_e62, _r55.asset);
        }
      }
    }, {
      key: "updateLibByOp",
      value: function updateLibByOp(t, e) {
        t.path[0] === "images" ? t.path.length === 1 && t.type === 1 ? this.addImage(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteImage(t.id) : t.path[0] === "videos" ? t.path.length === 1 && t.type === 1 ? this.addVideo(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteVideo(t.id) : t.path[0] === "audios" ? t.path.length === 1 && t.type === 1 ? this.addAudio(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteAudio(t.id) : t.path[0] === "particles" ? t.path.length === 1 && t.type === 1 ? this.addParticle(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteParticle(t.id) : t.path[0] === "colors" ? t.path.length === 1 && t.type === 1 ? this.addColor(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteColor(t.id) : t.path[0] === "materials" ? t.path.length === 1 && t.type === 1 ? this.addMaterial(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteMaterial(t.id) : t.path[0] === "fonts" ? t.path.length === 1 && t.type === 1 ? this.addFont(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteFont(t.id) : t.path[0] === "variables" ? t.path.length === 1 && t.type === 1 ? this.addVariableHolder(t.id, t.data.asset) : t.path.length === 1 && t.type === 2 && this.deleteVariable(t.id) : t.path[0] === "components" && e.updateByLibOp(t, this);
      }
    }, {
      key: "updateByOp",
      value: function updateByOp(t, e, r) {
        this.data = e, t.path[0] === "images" ? t.path.length === 2 && t.type === 0 ? t.props.data && this.getImage(t.path[1]).updateSrc(t.props.data) : t.path.length === 1 && t.type === 1 ? this.addImage(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteImage(t.id) : t.path[0] === "videos" ? t.path.length === 2 && t.type === 0 ? t.props.data && this.getVideo(t.path[1]).updateSrc(t.props.data) : t.path.length === 1 && t.type === 1 ? this.addVideo(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteVideo(t.id) : t.path[0] === "audios" ? t.path.length === 2 && t.type === 0 ? t.props.data && this.addAudio(t.path[1], e.audios[t.path[1]]) : t.path.length === 1 && t.type === 1 ? this.addAudio(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteAudio(t.id) : t.path[0] === "particles" ? t.path.length === 2 && t.type === 0 ? t.props.data && this.addParticle(t.path[1], e.particles[t.path[1]]) : t.path.length === 1 && t.type === 1 ? this.addParticle(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteParticle(t.id) : t.path[0] === "colors" ? t.path.length === 2 && t.type === 0 ? this.updateColor(t.path[1], t.props) : t.path.length === 1 && t.type === 1 ? this.addColor(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteColor(t.id) : t.path[0] === "materials" ? t.path.length === 1 && t.type === 1 ? this.addMaterial(t.id, t.data) : t.path.length === 1 && t.type === 2 ? this.deleteMaterial(t.id) : t.path.length > 1 && this.getMaterial(t.path[1]).updateByOp(Mr.drop(t, 2), e.materials[t.path[1]], {
          shared: this,
          scene: r
        }) : t.path[0] === "fonts" ? t.path.length === 2 && t.type === 0 ? this.updateFont(t.path[1], t, r) : t.path.length === 1 && t.type === 1 ? this.addFont(t.id, t.data) : t.path.length === 1 && t.type === 2 && this.deleteFont(t.id) : t.path[0] === "variables" ? t.path.length === 2 && t.type === 0 && "value" in t.props ? this.updateVariable(t.path[1], t.props.value) : t.path.length === 1 && t.type === 4 ? this.addVariableHolder(t.id, t.data) : t.path.length === 1 && t.type === 5 && this.deleteVariable(t.id) : t.path[0] === "lib" && this.updateLibByOp(Mr.drop(t, 1), r);
      }
    }, {
      key: "updateFont",
      value: function updateFont(t, e, r) {
        var _this213 = this;
        if (e.props.url) {
          var _i110 = this.getFont(t),
            s = _objectSpread(_objectSpread({}, this.data.fonts[t]), {}, {
              url: e.props.url
            });
          _i110.update(s), _i110.loadingPromise.then(function () {
            return _this213.requestRender();
          }), r.updateFont(t, this);
        }
      }
    }]);
    return Wc;
  }(),
  nMe = new Wc(yn.emptyData());
var gs = /*#__PURE__*/function (_nr) {
  _inherits(gs, _nr);
  var _super204 = _createSuper(gs);
  function gs() {
    _classCallCheck(this, gs);
    return _super204.apply(this, arguments);
  }
  _createClass(gs, [{
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(e, r, i) {
      if (_get(_getPrototypeOf(gs.prototype), "updateByPatchedOp", this).call(this, e, r, i), U2(e.path, ["materials"]) !== null && e.type === 0 && Array.isArray(this.material)) for (var _i111 = 0, _Object$entries33 = Object.entries(e.props); _i111 < _Object$entries33.length; _i111++) {
        var _Object$entries33$_i = _slicedToArray(_Object$entries33[_i111], 2),
          s = _Object$entries33$_i[0],
          o = _Object$entries33$_i[1];
        var a = i.shared.material(o);
        this.material[Number(s)] = a;
      } else if (wt(e.path, ["material"]) && this.material instanceof Rn) "material" in r && typeof r.material != "string" && this.material.updateByOp(Mr.drop(e, 1), r.material, i);else if (wt(e.path, ["materials", "*"]) && Array.isArray(this.material)) {
        var _s50 = e.path[1];
        if ("materials" in r && _s50 < this.material.length) {
          var _o47 = r.materials[_s50];
          typeof _o47 != "string" && this.material[_s50].updateByOp(Mr.drop(e, 2), _o47, i);
        }
      }
    }
  }, {
    key: "needsAO",
    get: function get() {
      return this.material !== void 0 ? (Array.isArray(this.material) ? this.material[0] : this.material).hasAO : !1;
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      var _e$geometry, _e$geometry2;
      _get(_getPrototypeOf(gs.prototype), "updateState", this).call(this, e, r), e.castShadow !== void 0 && (this.castShadow = e.castShadow), e.receiveShadow !== void 0 && (this.receiveShadow = e.receiveShadow);
      var i = this.dataPatched;
      if (((_e$geometry = e.geometry) === null || _e$geometry === void 0 ? void 0 : _e$geometry.type) !== "NonParametricGeometry" && "material" in e && e.material !== void 0 && (this.disposeMaterial(), this.material = r.shared.material(e.material).getFlavor(i.flatShading, i.side, i.wireframe), r.scene.markNeedsUpdateRendererDirty()), (((_e$geometry2 = e.geometry) === null || _e$geometry2 === void 0 ? void 0 : _e$geometry2.type) === "NonParametricGeometry" || "materials" in e) && ("materials" in e && e.materials !== void 0 ? (this.disposeMaterial(), this.material = e.materials.map(function (s) {
        return r.shared.material(s).getFlavor(i.flatShading, i.side, i.wireframe);
      }), r.scene.markNeedsUpdateRendererDirty()) : "material" in e && e.material !== void 0 && (this.disposeMaterial(), this.material = [r.shared.material(e.material).getFlavor(i.flatShading, i.side, i.wireframe)], r.scene.markNeedsUpdateRendererDirty())), e.flatShading !== void 0 || e.wireframe !== void 0 || e.side !== void 0) if (Array.isArray(this.material)) for (var s = 0; s < this.material.length; s++) this.material[s] = this.material[s].getFlavor(i.flatShading, i.side, i.wireframe);else this.material = this.material.getFlavor(i.flatShading, i.side, i.wireframe);
    }
  }, {
    key: "disposeMaterial",
    value: function disposeMaterial() {
      this.material && iv(this.material).forEach(function (e) {
        e instanceof Rn && (e instanceof Hc || e.nodeMaterialDispose());
      });
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.disposeMaterial(), _get(_getPrototypeOf(gs.prototype), "dispose", this).call(this);
    }
  }]);
  return gs;
}(nr);
var lR = new _(),
  cR = new He(),
  uR = new He(),
  R7 = new _(),
  dR = new te(),
  er = /*#__PURE__*/function (_gs) {
    _inherits(er, _gs);
    var _super205 = _createSuper(er);
    function er(e, r, i) {
      var _this214;
      _classCallCheck(this, er);
      _this214 = _super205.call(this, e, r);
      _this214.data = r;
      _this214.isSkinnedMesh = !1;
      _this214.localGeometry = void 0, r.bindMode && r.bindMatrix && (_this214.bindMode = r.bindMode, _this214.bindMatrix = new te().fromArray(r.bindMatrix), _this214.bindMatrixInverse = new te());
      return _this214;
    }
    _createClass(er, [{
      key: "chooseGeoemtryCache",
      value: function chooseGeoemtryCache(e) {
        return e.geometryCache;
      }
    }, {
      key: "markGeometryAsReachable",
      value: function markGeometryAsReachable(e) {
        this.geometryCreateDeleyed instanceof we && this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry, this.geometryCreateDeleyed);
      }
    }, {
      key: "geometry",
      get: function get() {
        if (this.localGeometry !== void 0) return this.localGeometry;
        if (this.geometryCreateDeleyed instanceof Wc) {
          var e = this.geometryCreateDeleyed,
            r = this.chooseGeoemtryCache(e);
          this.geometryCreateDeleyed = r.get(this.dataPatched.geometry, e, this);
        }
        return this.geometryCreateDeleyed;
      },
      set: function set(e) {
        this.localGeometry = e;
      }
    }, {
      key: "is2DAndNoDepth",
      get: function get() {
        var e = this.dataPatched.geometry;
        return Wp.is2DParametricMesh(e.type) && e.depth === 0;
      }
    }, {
      key: "is2DType",
      get: function get() {
        return Wp.is2DParametricMesh(this.geometry.userData.type);
      }
    }, {
      key: "isNonParametric",
      get: function get() {
        return this.geometry.userData.type === "NonParametricGeometry";
      }
    }, {
      key: "updateByPatchedOp",
      value: function updateByPatchedOp(e, r, i) {
        _get(_getPrototypeOf(er.prototype), "updateByPatchedOp", this).call(this, e, r, i), wt(e.path, ["geometry"]) && this.updateByPatchedOpGeometry(Mr.drop(e, 1), r.geometry, i);
      }
    }, {
      key: "removeInteractionGeometry",
      value: function removeInteractionGeometry(e) {
        var _this$localGeometry;
        (_this$localGeometry = this.localGeometry) !== null && _this$localGeometry !== void 0 && _this$localGeometry.dispose(), this.localGeometry = void 0;
      }
    }, {
      key: "updateGeometryInteractions",
      value: function updateGeometryInteractions(e, r) {
        this.invalidateDownstreamBooleanData();
        var i = this.data.geometry.type;
        if (i === "NonParametricGeometry" || i === "SubdivGeometry") {
          var _s$scaleBaked, _s$scaleBaked2, _s51;
          var s = e;
          if (this.localGeometry === void 0) {
            var c = _objectSpread(_objectSpread({}, this.data.geometry), s);
            this.localGeometry = Ta(c, r, this.data.flatShading, this);
          }
          var o, a, l;
          s.scaleBaked ? (_s$scaleBaked = s.scaleBaked, _s$scaleBaked2 = _slicedToArray(_s$scaleBaked, 3), o = _s$scaleBaked2[0], a = _s$scaleBaked2[1], l = _s$scaleBaked2[2], _s$scaleBaked) : (_s51 = s, o = _s51.width, a = _s51.height, l = _s51.depth, _s51);
          var u = this.localGeometry.userData;
          u.sxPrev !== void 0 && fm(this.localGeometry.attributes, o / u.sxPrev, a / u.syPrev, l / u.szPrev), u.sxPrev = o, u.syPrev = a, u.szPrev = l;
        } else {
          var _this$localGeometry2;
          var _s52 = _objectSpread(_objectSpread({}, this.data.geometry), e);
          (_this$localGeometry2 = this.localGeometry) !== null && _this$localGeometry2 !== void 0 && _this$localGeometry2.dispose(), this.localGeometry = Ta(_s52, r, this.data.flatShading, this);
        }
      }
    }, {
      key: "refreshAttachedCloners",
      value: function refreshAttachedCloners(e) {
        var _iterator68 = _createForOfIteratorHelper(this.attachedSurfaceCloners),
          _step68;
        try {
          for (_iterator68.s(); !(_step68 = _iterator68.n()).done;) {
            var r = _step68.value;
            e.scene.addPendingUpdateCloner(r.object);
          }
        } catch (err) {
          _iterator68.e(err);
        } finally {
          _iterator68.f();
        }
      }
    }, {
      key: "refreshAttachedPaths",
      value: function refreshAttachedPaths(e) {
        var _iterator69 = _createForOfIteratorHelper(this.attachedPaths),
          _step69;
        try {
          var _loop15 = function _loop15() {
            var r = _step69.value;
            e.scene.addPendingCommand(function () {
              return r.updateShape();
            });
          };
          for (_iterator69.s(); !(_step69 = _iterator69.n()).done;) {
            _loop15();
          }
        } catch (err) {
          _iterator69.e(err);
        } finally {
          _iterator69.f();
        }
      }
    }, {
      key: "createGeometryDelayed",
      value: function createGeometryDelayed(e) {
        this.geometryCreateDeleyed = e.shared, this.refreshAttachedCloners(e), this.refreshAttachedPaths(e);
      }
    }, {
      key: "updateByPatchedOpGeometry",
      value: function updateByPatchedOpGeometry(e, r, i) {
        var _i$scene;
        var s = !1;
        e.type === 0 && e.path.length === 0 && Object.keys(e.props).includes("scaleBaked") && this.geometryCreateDeleyed instanceof Kr && this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data, r) === this.geometryCreateDeleyed && (s = !0, this.geometryCreateDeleyed.mutateDirectlyScaleBaked(r, e.props.scaleBaked), this.refreshAttachedCloners(i), this.refreshAttachedPaths(i)), s || ((_i$scene = i.scene) !== null && _i$scene !== void 0 && _i$scene.markGeometryCacheDirty(), this.createGeometryDelayed(i)), this.resetBBoxNeedsUpdate(), this.invalidateDownstreamBooleanData();
      }
    }, {
      key: "updateGeometryOnStateUpdate",
      value: function updateGeometryOnStateUpdate(e, r) {
        this.createGeometryDelayed(r);
      }
    }, {
      key: "updateState",
      value: function updateState(e, r) {
        e.geometry !== void 0 && this.updateGeometryOnStateUpdate(e.geometry, r), _get(_getPrototypeOf(er.prototype), "updateState", this).call(this, e, r);
      }
    }, {
      key: "updateGeometryGroupsIfNeeded",
      value: function updateGeometryGroupsIfNeeded() {
        var _this$geometry$getInd, _this$geometry$getInd2;
        Array.isArray(this.material) && this.geometry.groups.length === 0 && this.geometry.addGroup(0, Math.max((_this$geometry$getInd = (_this$geometry$getInd2 = this.geometry.getIndex()) === null || _this$geometry$getInd2 === void 0 ? void 0 : _this$geometry$getInd2.count) !== null && _this$geometry$getInd !== void 0 ? _this$geometry$getInd : 0, this.geometry.getAttribute("position").count), 0);
      }
    }, {
      key: "updateEntityBoxSize",
      value: function updateEntityBoxSize(e, r) {
        var _i$depth, _i$depth2;
        var i = this.geometry.userData.parameters;
        this.is2DType ? e.set(0, 0, i.depth * .5) : this.isNonParametric ? (e.setScalar(0), this.geometry.boundingSphere && e.copy(this.geometry.boundingSphere.center), r.set(i.width, i.height, (_i$depth = i.depth) !== null && _i$depth !== void 0 ? _i$depth : 0).multiplyScalar(.5)) : e.setScalar(0), r.set(i.width, i.height, (_i$depth2 = i.depth) !== null && _i$depth2 !== void 0 ? _i$depth2 : 0).multiplyScalar(.5);
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(e) {
        _get(_getPrototypeOf(er.prototype), "updateMatrixWorld", this).call(this, e), this.bindMode === "attached" ? this.bindMatrixInverse.copy(this.matrixWorld).invert() : this.bindMode === "detached" && this.bindMatrixInverse.copy(this.bindMatrix).invert();
      }
    }, {
      key: "bind",
      value: function bind(e, r) {
        this.skeleton = e, this.isSkinnedMesh = !0, r === void 0 && (this.updateMatrixWorld(!0), this.skeleton.calculateInverses(), r = this.matrixWorld), this.bindMatrix.copy(r), this.bindMatrixInverse.copy(r).invert();
      }
    }, {
      key: "pose",
      value: function pose() {
        this.skeleton.pose();
      }
    }, {
      key: "normalizeSkinWeights",
      value: function normalizeSkinWeights(e) {
        var r = new He(),
          i = this.geometry.attributes.skinWeight;
        for (var s = 0, o = i.count; s < o; s++) {
          r.fromBufferAttribute(i, s);
          var a = 1 / r.manhattanLength();
          a !== 1 / 0 ? r.multiplyScalar(a) : r.set(1, 0, 0, 0), i.setXYZW(s, r.x, r.y, r.z, r.w);
        }
      }
    }, {
      key: "boneTransform",
      value: function boneTransform(e, r) {
        var i = this.skeleton;
        if (i === void 0) return;
        var s = this.geometry;
        cR.fromBufferAttribute(s.attributes.skinIndex, e), uR.fromBufferAttribute(s.attributes.skinWeight, e), lR.copy(r).applyMatrix4(this.bindMatrix), r.set(0, 0, 0);
        for (var o = 0; o < 4; o++) {
          var a = uR.getComponent(o);
          if (a !== 0) {
            var l = cR.getComponent(o);
            dR.multiplyMatrices(i.bones[l].matrixWorld, i.boneInverses[l]), r.addScaledVector(R7.copy(lR).applyMatrix4(dR), a);
          }
        }
        return r.applyMatrix4(this.bindMatrixInverse);
      }
    }]);
    return er;
  }(gs);
function L7(n) {
  if (n.geometry.attributes.extrudeNormal || !n.geometry.attributes.position || !n.geometry.attributes.normal) return;
  var t = new Map(),
    e = n.geometry.attributes,
    r = e.position.array,
    i = e.normal.array,
    s = new Float32Array(r.length);
  for (var o = 0; o < r.length; o += 3) {
    var _t$get;
    var a = "".concat(r[o], "_").concat(r[o + 1], "_").concat(r[o + 2]),
      l = new _(i[o], i[o + 1], i[o + 2]);
    t.has(a) ? (_t$get = t.get(a)) === null || _t$get === void 0 ? void 0 : _t$get.normals.push(l) : t.set(a, {
      normals: [l],
      result: new _()
    });
  }
  t.forEach(function (o, a) {
    var _iterator70 = _createForOfIteratorHelper(o.normals),
      _step70;
    try {
      for (_iterator70.s(); !(_step70 = _iterator70.n()).done;) {
        var _l83 = _step70.value;
        o.result.add(_l83);
      }
    } catch (err) {
      _iterator70.e(err);
    } finally {
      _iterator70.f();
    }
    o.result.divideScalar(o.normals.length);
  });
  for (var _o48 = 0; _o48 < r.length; _o48 += 3) {
    var _t$get2;
    var _a51 = "".concat(r[_o48], "_").concat(r[_o48 + 1], "_").concat(r[_o48 + 2]),
      _l84 = (_t$get2 = t.get(_a51)) === null || _t$get2 === void 0 ? void 0 : _t$get2.result;
    _l84 && (s[_o48] = _l84.x, s[_o48 + 1] = _l84.y, s[_o48 + 2] = _l84.z);
  }
  n.geometry.setAttribute("extrudeNormal", new be(s, 3));
}
function B7(n) {
  if (n.geometry.attributes.extrudeNormals || !n.geometry.attributes.position) return;
  var e = n.geometry.attributes.position.array,
    r = new Float32Array(e.length),
    i = new _();
  for (var s = 0; s < e.length; s += 3) i.set(e[s], e[s + 1], e[s + 2]).normalize(), r[s] = i.x, r[s + 1] = i.y, r[s + 2] = i.z;
  n.geometry.setAttribute("extrudeNormal", new be(r, 3));
}
function Jh(n) {
  if (Array.isArray(n.material)) {
    var _iterator71 = _createForOfIteratorHelper(n.material),
      _step71;
    try {
      for (_iterator71.s(); !(_step71 = _iterator71.n()).done;) {
        var t = _step71.value;
        if (t.getLayersOfType("outline").length === 0) return;
      }
    } catch (err) {
      _iterator71.e(err);
    } finally {
      _iterator71.f();
    }
  } else if (!(n.material instanceof Rn) || n.material.getLayersOfType("outline").length === 0) return;
  n instanceof er && n.is2DAndNoDepth ? B7(n) : L7(n);
}
function $h(n) {
  if (!n.geometry.attributes.position) return;
  var e = n.geometry.attributes.position.array,
    r = new Float32Array(e.length),
    i = parseInt(n.uuid.replace(/\D/g, "")),
    s = [Se.seededRandom(i), Se.seededRandom(i + 1e4), Se.seededRandom(i + 2e4)];
  for (var o = 0; o < e.length; o++) r[o] = s[o % 3];
  n.geometry.setAttribute("randomColor", new Ge(r, 3));
}
var Ro = new Bt(),
  Mm = new _();
function hR(n) {
  var t = !1;
  return n.scene.objects.traverse(function (e, r) {
    r.type === "Mesh" && r.geometry.type === "SubdivGeometry" && (t = !0);
  }), t;
}
var Qs = /*#__PURE__*/function (_er) {
  _inherits(Qs, _er);
  var _super206 = _createSuper(Qs);
  function Qs(e, r, i) {
    var _this215;
    _classCallCheck(this, Qs);
    _this215 = _super206.call(this, e, r, i);
    _this215.data = r;
    _this215.hiddenMatrixOld = new te();
    _this215.smoothShading = !0;
    _this215.skipReactionUpdate = !1;
    return _this215;
  }
  _createClass(Qs, [{
    key: "chooseGeoemtryCache",
    value: function chooseGeoemtryCache(e) {
      return this.dataPatched.flatShading ? e.geometryCache : e.geometryCache2;
    }
  }, {
    key: "subdivPointerNew",
    get: function get() {
      return this.localGeometry !== void 0 ? this.subdivPointer : this.geometry.ensureSubdivPointer();
    }
  }, {
    key: "originalGeometryNew",
    get: function get() {
      return this.localGeometry !== void 0 ? this.originalGeometry : this.geometry.originalGeometry;
    }
  }, {
    key: "phongAngle",
    get: function get() {
      var _this$data$geometry$p;
      return (_this$data$geometry$p = this.data.geometry.phongAngle) !== null && _this$data$geometry$p !== void 0 ? _this$data$geometry$p : 45;
    }
  }, {
    key: "updateEntityBoxSize",
    value: function updateEntityBoxSize(e, r) {
      var _i$depth3;
      var i = this.geometry.userData.parameters;
      e.copy(this.originalGeometryNew.boundingSphere.center), r.set(i.width, i.height, (_i$depth3 = i.depth) !== null && _i$depth3 !== void 0 ? _i$depth3 : 0).multiplyScalar(.5);
    }
  }, {
    key: "createGeometryByControls",
    value: function createGeometryByControls(e) {
      var _this$localGeometry3, _this$originalGeometr, _this$subdividedGeome2, _this$subdividedGeome3;
      if (this.skipReactionUpdate === !0) return;
      var r = (_this$localGeometry3 = this.localGeometry) === null || _this$localGeometry3 === void 0 ? void 0 : _this$localGeometry3.uuid,
        _Kr$build2 = Kr.build(e, this.subdivPointer, this.smoothShading, this.hasNonUniformScale ? this.shearScale : void 0),
        i = _Kr$build2.originalGeometry,
        s = _Kr$build2.subdividedGeometry,
        o = _Kr$build2.subdivPointer;
      this.subdivPointer = o, i !== void 0 && ((_this$originalGeometr = this.originalGeometry) !== null && _this$originalGeometr !== void 0 && _this$originalGeometr.dispose(), this.originalGeometry = i), s !== void 0 && ((_this$subdividedGeome2 = this.subdividedGeometry) !== null && _this$subdividedGeome2 !== void 0 && _this$subdividedGeome2.dispose(), this.subdividedGeometry = s !== null && s !== void 0 ? s : void 0), this.localGeometry = (_this$subdividedGeome3 = this.subdividedGeometry) !== null && _this$subdividedGeome3 !== void 0 ? _this$subdividedGeome3 : this.originalGeometry, Jh(this), $h(this), this.calcBoundingBox(), r && (this.localGeometry.uuid = r);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      if (_get(_getPrototypeOf(Qs.prototype), "updateState", this).call(this, e, r), e.flatShading !== void 0) {
        var _i112 = this.material;
        this.material = Array.isArray(_i112) ? _i112.map(function (s) {
          return s.getFlavor(!1, s.side, s.wireframe);
        }) : _i112.getFlavor(!1, _i112.side, _i112.wireframe), this.smoothShading = !e.flatShading, this.createGeometryDelayed(r);
      }
    }
  }, {
    key: "updateMesh",
    value: function updateMesh() {
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      Kr.buildLevel(this.subdivPointer, !0, this.smoothShading ? this.phongAngle : -1, this.originalGeometry, e && this.hasNonUniformScale ? this.shearScaleInv : void 0), this.subdividedGeometry && Kr.buildLevel(this.subdivPointer, !1, this.smoothShading ? this.phongAngle : -1, this.subdividedGeometry, e && this.hasNonUniformScale ? this.shearScaleInv : void 0);
    }
  }, {
    key: "updateTopology",
    value: function updateTopology() {
      var _this$subdividedGeome4;
      this.originalGeometry.dispose(), this.originalGeometry = Kr.buildLevel(this.subdivPointer, !0, this.smoothShading ? this.phongAngle : -1), this.subdividedGeometry && (this.subdividedGeometry.dispose(), this.subdividedGeometry = Kr.buildLevel(this.subdivPointer, !1, this.smoothShading ? this.phongAngle : -1)), this.localGeometry = (_this$subdividedGeome4 = this.subdividedGeometry) !== null && _this$subdividedGeome4 !== void 0 ? _this$subdividedGeome4 : this.originalGeometry;
    }
  }, {
    key: "raycast",
    value: function raycast(e, r) {
      var i = this.localGeometry;
      this.localGeometry = this.originalGeometryNew, nr.prototype.raycast.call(this, e, r), this.localGeometry = i;
    }
  }, {
    key: "activateSVDCompensation",
    value: function activateSVDCompensation() {
      !this.hasNonUniformScale || (this.matrix.copy(this.matrixWorldRigid), this.hiddenMatrixOld.copy(this.hiddenMatrix), this.hiddenMatrix.copy(this.parent.matrixWorld).invert());
    }
  }, {
    key: "deactivateSVDCompensation",
    value: function deactivateSVDCompensation() {
      !this.hasNonUniformScale || (this.updateMatrix(), this.hasNonUniformScale = void 0, this.hiddenMatrix.copy(this.hiddenMatrixOld));
    }
  }, {
    key: "calcBoundingBox",
    value: function calcBoundingBox() {
      var e = this.originalGeometry;
      e.boundingSphere === null && (e.boundingSphere = new Er(), this.subdividedGeometry && (this.subdividedGeometry.boundingSphere = e.boundingSphere));
      var r = e.attributes.position,
        i = e.boundingSphere.center;
      Ro.setFromBufferAttribute(r), Ro.getCenter(i), e.boundingSphere.radius = i.distanceTo(Ro.max), isNaN(e.boundingSphere.radius) && console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.', this), Ro.getSize(Mm), this.hasNonUniformScale && Mm.divide(this.scale);
      var s = {
        width: Mm.x,
        height: Mm.y,
        depth: Mm.z
      };
      return this.geometry.userData.parameters = s, s;
    }
  }, {
    key: "updateBoundingSphere",
    value: function updateBoundingSphere(e) {
      var r = this.originalGeometry;
      Ro.min.set(e[0], e[2], e[4]), Ro.max.set(e[1], e[3], e[5]), this.hasNonUniformScale && (Ro.min.applyMatrix4(this.shearScaleInv), Ro.max.applyMatrix4(this.shearScaleInv)), r.boundingSphere === null && (r.boundingSphere = new Er());
      var i = r.boundingSphere.center;
      Ro.getCenter(i), r.boundingSphere.radius = i.distanceTo(Ro.max);
    }
  }, {
    key: "freeSubdivPointer",
    value: function freeSubdivPointer() {
      var _this$originalGeometr2, _this$subdividedGeome5;
      this.subdivPointer && (Kr.freeSubdivPointer(this.subdivPointer), this.subdivPointer = 0), this.localGeometry = void 0, (_this$originalGeometr2 = this.originalGeometry) !== null && _this$originalGeometr2 !== void 0 && _this$originalGeometr2.dispose(), (_this$subdividedGeome5 = this.subdividedGeometry) === null || _this$subdividedGeome5 === void 0 ? void 0 : _this$subdividedGeome5.dispose();
    }
  }, {
    key: "dispose",
    value: function dispose() {
      _get(_getPrototypeOf(Qs.prototype), "dispose", this).call(this), this.freeSubdivPointer();
    }
  }, {
    key: "updateByPatchedOpGeometry",
    value: function updateByPatchedOpGeometry(e, r, i) {
      _get(_getPrototypeOf(Qs.prototype), "updateByPatchedOpGeometry", this).call(this, e, r, i), this.localGeometry && this.createGeometryByControls(r);
    }
  }]);
  return Qs;
}(er);
var fR = -1,
  N7 = 1,
  pR = {
    x: [1, 0, 0],
    "-x": [-1, 0, 0],
    y: [0, 1, 0],
    "-y": [0, -1, 0],
    z: [0, 0, 1],
    "-z": [0, 0, -1]
  },
  mR = {
    polygon_center: 0,
    edge: 1,
    vertex: 2
  },
  Cm = function Cm(n, t) {
    return function (e, r) {
      return !t || e === 0 || n === 0 ? 0 : n * r / 100;
    };
  },
  dt = function dt(n, t) {
    var e = Math.abs(t),
      r = e * -1;
    return (n - fR) * (e - r) / (N7 - fR) + r;
  };
function gR(n) {
  var t = [],
    e = {};
  for (var r = 0, i = n.length; r < i; r++) {
    var s = JSON.stringify(n[r].pos.map(function (o) {
      return Math.round(o * 1e4) / 1e4;
    }));
    e[s] || (t.push(n[r]), e[s] = !0);
  }
  return t;
}
var F7 = new _(),
  J0 = new _(),
  k7 = new _(),
  z7 = new _();
function ef(n, t) {
  var e = k7.fromArray(n),
    r = z7.fromArray(t);
  J0.copy(r).sub(e);
  var i = J0.length();
  return J0.normalize().multiplyScalar(i * .5), F7.copy(e).add(J0).toArray();
}
var ys = new vr(),
  $0 = new _(),
  ex = new _(),
  qc = new _();
function yR(n) {
  var t = [];
  for (var e = 0; e <= n.index.count; e++) if ($0.fromArray(n.index.array, e * 3), ys.setFromAttributeAndIndices(n.attributes.position, $0.x, $0.y, $0.z), ys.getNormal(ex), ys.getMidpoint(qc), !(isNaN(qc.x) || isNaN(qc.y) || isNaN(qc.z))) {
    var r = ys.a,
      _i113 = ys.b,
      s = ys.c,
      o = r.toArray(),
      a = _i113.toArray(),
      l = s.toArray(),
      u = r.distanceTo(_i113),
      c = _i113.distanceTo(s),
      d = s.distanceTo(r),
      h = ef(o, a),
      f = ef(a, l),
      p = ef(l, o),
      m = [u, c, d],
      g = Math.max.apply(Math, m),
      y = m.filter(function (S) {
        return Math.round(S) === Math.round(g);
      }).length > 1,
      v = [],
      x = ys.getMidpoint(qc).toArray();
    g === u && !y && (v = [f, p, p], x = h), g === c && !y && (v = [h, p, p], x = f), g === d && !y && (v = [h, f, f], x = p), y && (v = [h, f, p]), t.push({
      vertices: [o, a, l],
      faceCenters: v,
      midpoint: x,
      norm: ys.getNormal(ex).toArray()
    });
  }
  return t;
}
function vR(n) {
  var t = [],
    e = n.attributes.position;
  for (var r = 0; r < e.count; r++) {
    ys.setFromAttributeAndIndices(e, r * 3, r * 3 + 1, r * 3 + 2), ys.getNormal(ex), ys.getMidpoint(qc);
    var _i114 = ys.a.toArray(),
      s = ys.b.toArray(),
      o = ys.c.toArray();
    t.push({
      vertices: [_i114, s, o],
      faceCenters: [ef(_i114, s), ef(s, o), ef(o, _i114)],
      midpoint: qc.toArray(),
      norm: ex.toArray()
    });
  }
  return t;
}
var V7 = 4,
  U7 = .5,
  r_ = function r_(n) {
    return .5 * (1 - Math.cos(n * Math.PI));
  },
  i_ = /*#__PURE__*/function () {
    function i_() {
      _classCallCheck(this, i_);
      this.perlin = new Array(4095 + 1);
    }
    _createClass(i_, [{
      key: "noise",
      value: function noise(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        if (this.perlin == null) {
          this.perlin = new Array(4095 + 1);
          for (var y = 0; y < 4095 + 1; y++) this.perlin[y] = Math.random();
        }
        t < 0 && (t = -t), e < 0 && (e = -e), r < 0 && (r = -r);
        var i = Math.floor(t),
          s = Math.floor(e),
          o = Math.floor(r),
          a = t - i,
          l = e - s,
          u = r - o,
          c,
          d,
          h = 0,
          f = .5,
          p,
          m,
          g;
        for (var _y41 = 0; _y41 < V7; _y41++) {
          var v = i + (s << 4) + (o << 8);
          c = r_(a), d = r_(l), p = this.perlin[v & 4095], p += c * (this.perlin[v + 1 & 4095] - p), m = this.perlin[v + 16 & 4095], m += c * (this.perlin[v + 16 + 1 & 4095] - m), p += d * (m - p), v += 256, m = this.perlin[v & 4095], m += c * (this.perlin[v + 1 & 4095] - m), g = this.perlin[v + 16 & 4095], g += c * (this.perlin[v + 16 + 1 & 4095] - g), m += d * (g - m), p += r_(u) * (m - p), h += p * f, f *= U7, i <<= 1, a *= 2, s <<= 1, l *= 2, o <<= 1, u *= 2, a >= 1 && (i++, a--), l >= 1 && (s++, l--), u >= 1 && (o++, u--);
        }
        return h;
      }
    }, {
      key: "noiseSeed",
      value: function noiseSeed(t) {
        var e = function () {
          var o, a;
          return {
            setSeed: function setSeed(l) {
              a = o = (l !== null && l !== void 0 ? l : Math.random() * 4294967296) >>> 0;
            },
            getSeed: function getSeed() {
              return o;
            },
            rand: function rand() {
              return a = (1664525 * a + 1013904223) % 4294967296, a / 4294967296;
            }
          };
        }();
        e.setSeed(t), this.perlin = new Array(4095 + 1);
        for (var r = 0; r < 4095 + 1; r++) this.perlin[r] = e.rand();
      }
    }]);
    return i_;
  }(),
  xR = i_;
var bR = new _(),
  SR = new te(),
  wR = new Rs();
function n_(n) {
  var t = !1;
  return n.scene.objects.traverse(function (e, r) {
    r.type === "Mesh" && r.geometry.type === "TextGeometry" && (t = !0);
  }), t;
}
var tf = /*#__PURE__*/function (_er2) {
  _inherits(tf, _er2);
  var _super207 = _createSuper(tf);
  function tf(e, r, i) {
    var _this216;
    _classCallCheck(this, tf);
    _this216 = _super207.call(this, e, r, i);
    _this216.data = r;
    return _this216;
  }
  _createClass(tf, [{
    key: "textGeometry",
    get: function get() {
      return this.geometry;
    }
  }, {
    key: "charWidths",
    get: function get() {
      return this.textGeometry.charWidths;
    }
  }, {
    key: "charCoords",
    get: function get() {
      return this.textGeometry.charCoords;
    }
  }, {
    key: "wrappedText",
    get: function get() {
      return this.textGeometry.wrappedText;
    }
  }, {
    key: "font",
    get: function get() {
      return this.textGeometry.font;
    }
  }, {
    key: "initialOffsetY",
    get: function get() {
      var _this$font$getLineIni, _this$font8;
      var e = this.dataPatched;
      return (_this$font$getLineIni = (_this$font8 = this.font) === null || _this$font8 === void 0 ? void 0 : _this$font8.getLineInitialOffsetY(this.lineHeight, this.wrappedText.length, e.geometry.height, this.fontScale, e.geometry.verticalAlign)) !== null && _this$font$getLineIni !== void 0 ? _this$font$getLineIni : 0;
    }
  }, {
    key: "fontScale",
    get: function get() {
      var e = this.dataPatched;
      return this.font ? e.geometry.fontSize / this.font.unitsPerEm : 1;
    }
  }, {
    key: "AD",
    get: function get() {
      return Math.abs(this.ascender - this.descender);
    }
  }, {
    key: "ascender",
    get: function get() {
      var _this$font$ascender2, _this$font9;
      return ((_this$font$ascender2 = (_this$font9 = this.font) === null || _this$font9 === void 0 ? void 0 : _this$font9.ascender) !== null && _this$font$ascender2 !== void 0 ? _this$font$ascender2 : 1) * this.fontScale;
    }
  }, {
    key: "descender",
    get: function get() {
      var _this$font$descender2, _this$font10;
      return ((_this$font$descender2 = (_this$font10 = this.font) === null || _this$font10 === void 0 ? void 0 : _this$font10.descender) !== null && _this$font$descender2 !== void 0 ? _this$font$descender2 : 1) * this.fontScale;
    }
  }, {
    key: "lineHeight",
    get: function get() {
      var e = this.dataPatched;
      return e.geometry.fontSize * e.geometry.lineHeight;
    }
  }, {
    key: "raycast",
    value: function raycast(e, r) {
      var i = this.matrixWorld;
      if (!(isNaN(e.ray.origin.x) || this.scale.x === 0 || this.scale.y === 0 || this.scale.z === 0) && (SR.copy(i).invert(), wR.copy(e.ray).applyMatrix4(SR), wR.intersectBox(this.singleBBox, bR))) {
        var s = bR.applyMatrix4(i),
          o = e.ray.origin.distanceTo(s);
        r.push({
          distance: o,
          point: s.clone(),
          object: this
        });
      }
    }
  }]);
  return tf;
}(er);
var wn = 1e-4,
  Lo,
  ER,
  TR,
  MR,
  AR = new _(),
  _R = new _();
D0.then(function (n) {
  Lo = n, ER = [Lo.get_face_center, Lo.get_edge_midpoint, Lo.get_vertex_position], TR = [Lo.get_face_normal, Lo.get_edge_normal, Lo.get_vertex_normal], MR = [Lo.face_count, Lo.edge_count, Lo.vertex_count];
});
var G7 = new te(),
  j7 = new te(),
  Fl = new _(),
  Yc = new _(),
  Pm = new _(),
  s_ = new _(),
  H7 = new _(),
  W7 = new _();
var Oa = new xR(),
  Gi = /*#__PURE__*/function (_hh3) {
    _inherits(Gi, _hh3);
    var _super208 = _createSuper(Gi);
    function Gi(e, r) {
      var _this217;
      _classCallCheck(this, Gi);
      _this217 = _super208.call(this);
      _this217.parameters = r;
      _this217.objectForSample = void 0;
      _this217._pendingMediaLoad = !1;
      _this217.object = e;
      return _this217;
    }
    _createClass(Gi, [{
      key: "resetOnMove",
      value: function resetOnMove() {
        this.removeFromParent(), this.parent = null;
      }
    }, {
      key: "expandClones",
      value: function expandClones(e) {
        if (this.parent === null) this.updateState(this.parameters, e);else {
          var _iterator72 = _createForOfIteratorHelper(this.children),
            _step72;
          try {
            for (_iterator72.s(); !(_step72 = _iterator72.n()).done;) {
              var r = _step72.value;
              r instanceof Pr && r.expand();
            }
          } catch (err) {
            _iterator72.e(err);
          } finally {
            _iterator72.f();
          }
        }
      }
    }, {
      key: "invalidateTransform",
      value: function invalidateTransform(e) {
        this.matrixWorldNeedsUpdate = !0, this.traverse(function (r) {
          r instanceof Pr && r.object === e && (r.matrixWorldNeedsUpdate = !0);
        });
      }
    }, {
      key: "onObjUpdateMatrix",
      value: function onObjUpdateMatrix() {
        this.parameters.type !== "toObject" && (this.matrixWorldNeedsUpdate = !0);
      }
    }, {
      key: "update",
      value: function update() {
        switch (this._updateCount(), this.parameters.type) {
          case "radial":
            this._updateRadial(this.parameters);
            break;
          case "linear":
            this._updateLinear(this.parameters);
            break;
          case "grid":
            this._updateGrid(this.parameters);
            break;
          case "toObject":
            this._updateToObject(this.parameters);
        }
        var _iterator73 = _createForOfIteratorHelper(this.children),
          _step73;
        try {
          for (_iterator73.s(); !(_step73 = _iterator73.n()).done;) {
            var e = _step73.value;
            e.updateMatrix(), e.hasNonUniformScale && (e.updateMatrixWorld(), e.updateMatrixWorldSVD());
          }
        } catch (err) {
          _iterator73.e(err);
        } finally {
          _iterator73.f();
        }
      }
    }, {
      key: "_updateCount",
      value: function _updateCount(e) {
        var r;
        if (e !== void 0 ? r = e : r = this.parameters.type === "grid" ? Math.round(this.parameters.grid.count[0]) * Math.round(this.parameters.grid.count[1]) * Math.round(this.parameters.grid.count[2]) : this.parameters.count, this.parameters.type === "toObject" && !this.parameters.toObject.object && (r = 0), this.parameters.type === "toObject" && this.objectForSample) {
          for (var s = 0, o = this.children.length; s < o; ++s) this.remove(this.children[0]);
          var _i115 = this.children;
          if (_i115.length === r) return;
          if (_i115.length < r) for (var _s53 = 0, _o49 = r - _i115.length; _s53 < _o49; ++_s53) {
            var a = new Pr(this.object);
            a.expand(), this.add(a);
          } else for (var _s54 = 0, _o50 = _i115.length - r; _s54 < _o50; ++_s54) this.remove(_i115[_s54]);
        } else {
          if (this.children.length === r) return;
          if (this.children.length < r) for (var _i116 = 0, _s55 = r - this.children.length; _i116 < _s55; ++_i116) {
            var _o51 = new Pr(this.object);
            _o51.expand(), this.add(_o51);
          } else for (var _i117 = 0, _s56 = this.children.length - r; _i117 < _s56; ++_i117) this.remove(this.children[0]);
        }
      }
    }, {
      key: "_updateRadial",
      value: function _updateRadial(e) {
        var _e$randomnessObject;
        var r = e.radial,
          i = r.start * Se.DEG2RAD,
          s = r.end * Se.DEG2RAD,
          o = i - s,
          a = new Kt(r.rotation[0], r.rotation[1], r.rotation[2]),
          l;
        switch (r.axis) {
          case "z":
            l = new _(0, 0, 1);
            break;
          case "y":
            l = new _(0, 1, 0);
            break;
          default:
          case "x":
            l = new _(1, 0, 0);
            break;
        }
        var u = (_e$randomnessObject = e.randomnessObject) !== null && _e$randomnessObject !== void 0 ? _e$randomnessObject : So.defaultData([1, 1, 1]).randomnessObject,
          c = u.noiseType === "perlin";
        Oa.noiseSeed(u.seed);
        var d = d0((0, rf.default)(u.seed)),
          h = Cm(u.strength, this.parameters.randomness);
        var _iterator74 = _createForOfIteratorHelper(this.children.entries()),
          _step74;
        try {
          for (_iterator74.s(); !(_step74 = _iterator74.n()).done;) {
            var _step74$value = _slicedToArray(_step74.value, 2),
              f = _step74$value[0],
              p = _step74$value[1];
            var m = f * (u.freqScale / 10) + u.movement,
              g = c ? Oa.noise(m) : d(m, m),
              y = f + 1;
            p.scale.x = r.scale[0] + h(y, dt(g, u.scale[0])) || wn, p.scale.y = r.scale[1] + h(y, dt(g, u.scale[1])) || wn, p.scale.z = r.scale[2] + h(y, dt(g, u.scale[2])) || wn, p.position.setScalar(0);
            var v = o / e.count * f - i;
            switch (r.axis) {
              case "x":
                p.rotation.set(0, v, 0);
                break;
              case "y":
                p.rotation.set(0, 0, v);
                break;
              case "z":
                p.rotation.set(v, 0, 0);
                break;
            }
            p.translateOnAxis(l, r.radius), p.position.x += r.position[0] + h(y, dt(g, u.position[0])), p.position.y += r.position[1] + h(y, dt(g, u.position[1])), p.position.z += r.position[2] + h(y, dt(g, u.position[2]));
            var x = h(y, dt(g, u.rotation[0])),
              S = h(y, dt(g, u.rotation[1])),
              w = h(y, dt(g, u.rotation[2]));
            r.alignment === !0 ? (p.rotation.x += a.x + x, p.rotation.y += a.y + S, p.rotation.z += a.z + w) : p.rotation.set(a.x + x, a.y + S, a.z + w);
          }
        } catch (err) {
          _iterator74.e(err);
        } finally {
          _iterator74.f();
        }
      }
    }, {
      key: "_updateLinear",
      value: function _updateLinear(e) {
        var _e$randomnessObject2;
        if (e.type !== "linear") throw new Error();
        var r = e.linear,
          i = new Kt(r.rotation[0], r.rotation[1], r.rotation[2]),
          s = (_e$randomnessObject2 = e.randomnessObject) !== null && _e$randomnessObject2 !== void 0 ? _e$randomnessObject2 : So.defaultData([1, 1, 1]).randomnessObject,
          o = s.noiseType === "perlin";
        Oa.noiseSeed(s.seed);
        var a = d0((0, rf.default)(s.seed)),
          l = Cm(s.strength, this.parameters.randomness);
        var _iterator75 = _createForOfIteratorHelper(this.children.entries()),
          _step75;
        try {
          for (_iterator75.s(); !(_step75 = _iterator75.n()).done;) {
            var _step75$value = _slicedToArray(_step75.value, 2),
              u = _step75$value[0],
              c = _step75$value[1];
            var d = u * (s.freqScale / 10) + s.movement,
              h = o ? Oa.noise(d) : a(d, d),
              f = u + 1,
              p = l(f, dt(h, s.rotation[0])),
              m = l(f, dt(h, s.rotation[1])),
              g = l(f, dt(h, s.rotation[2]));
            c.scale.x = 1 + (r.scale[0] - 1) * u + l(f, dt(h, s.scale[0])) || wn, c.scale.y = 1 + (r.scale[1] - 1) * u + l(f, dt(h, s.scale[1])) || wn, c.scale.z = 1 + (r.scale[2] - 1) * u + l(f, dt(h, s.scale[2])) || wn, c.rotation.x = i.x * u + p, c.rotation.y = i.y * u + m, c.rotation.z = i.z * u + g, c.position.x = r.position[0] * u + l(f, dt(h, s.position[0])), c.position.y = r.position[1] * u + l(f, dt(h, s.position[1])), c.position.z = r.position[2] * u + l(f, dt(h, s.position[2]));
          }
        } catch (err) {
          _iterator75.e(err);
        } finally {
          _iterator75.f();
        }
      }
    }, {
      key: "_updateGrid",
      value: function _updateGrid(e) {
        var _e$randomnessObject3;
        var r = 0,
          i = e.grid,
          s = (_e$randomnessObject3 = e.randomnessObject) !== null && _e$randomnessObject3 !== void 0 ? _e$randomnessObject3 : So.defaultData([1, 1, 1]).randomnessObject,
          o = Cm(s.strength, this.parameters.randomness),
          a = s.noiseType === "perlin";
        Oa.noiseSeed(s.seed);
        var l = hO((0, rf.default)(s.seed));
        if (i.useCenter === !0) {
          var u = {
              x: i.count[0] % 2 === 0 ? 2 : 1,
              y: i.count[1] % 2 === 0 ? 2 : 1,
              z: i.count[2] % 2 === 0 ? 2 : 1
            },
            c = new _(i.size[0] * (i.count[0] - u.x) * .5, i.size[1] * (i.count[1] - u.y) * .5, i.size[2] * (i.count[2] - u.z) * .5);
          for (var d = 0; d < i.count[0]; d++) for (var h = 0; h < i.count[1]; h++) for (var f = 0; f < i.count[2]; f++) {
            var p = [(d + 1) * (s.freqScale / 10) + s.movement, (h + 1) * (s.freqScale / 10) + s.movement, (f + 1) * (s.freqScale / 10) + s.movement],
              m = a ? Oa.noise.apply(Oa, p) : l.apply(void 0, p),
              g = this.children[r++];
            g.scale.x = 1 + o(r, dt(m, s.scale[0])) || wn, g.scale.y = 1 + o(r, dt(m, s.scale[1])) || wn, g.scale.z = 1 + o(r, dt(m, s.scale[2])) || wn;
            var y = o(r, dt(m, s.rotation[0])),
              v = o(r, dt(m, s.rotation[1])),
              x = o(r, dt(m, s.rotation[2]));
            g.rotation.set(y, v, x), g.position.x = i.size[0] * d - c.x + o(r, dt(m, s.position[0])), g.position.y = i.size[1] * h - c.y + o(r, dt(m, s.position[1])), g.position.z = i.size[2] * f - c.z + o(r, dt(m, s.position[2]));
          }
        } else for (var _u50 = 0; _u50 < i.count[0]; _u50++) for (var _c38 = 0; _c38 < i.count[1]; _c38++) for (var _d55 = 0; _d55 < i.count[2]; _d55++) {
          var _h77 = [(_u50 + 1) * (s.freqScale / 10) + s.movement, (_c38 + 1) * (s.freqScale / 10) + s.movement, (_d55 + 1) * (s.freqScale / 10) + s.movement],
            _f80 = a ? Oa.noise.apply(Oa, _h77) : l.apply(void 0, _h77),
            _p52 = this.children[r++];
          _p52.scale.x = 1 + o(r, dt(_f80, s.scale[0])) || wn, _p52.scale.y = 1 + o(r, dt(_f80, s.scale[1])) || wn, _p52.scale.z = 1 + o(r, dt(_f80, s.scale[2])) || wn;
          var _m50 = o(r, dt(_f80, s.rotation[0])),
            _g42 = o(r, dt(_f80, s.rotation[1])),
            _y42 = o(r, dt(_f80, s.rotation[2]));
          _p52.rotation.set(_m50, _g42, _y42), _p52.position.x = i.size[0] * _u50 + o(r, dt(_f80, s.position[0])), _p52.position.y = -i.size[1] * _c38 + o(r, dt(_f80, s.position[1])), _p52.position.z = -i.size[2] * _d55 + o(r, dt(_f80, s.position[2]));
        }
      }
    }, {
      key: "_updateToObject",
      value: function _updateToObject(e) {
        var _e$randomnessObject4, _this$objectForSample;
        if (e.type !== "toObject") throw new Error();
        var r = e.toObject,
          i = new Kt(r.rotation[0], r.rotation[1], r.rotation[2]),
          s = (_e$randomnessObject4 = e.randomnessObject) !== null && _e$randomnessObject4 !== void 0 ? _e$randomnessObject4 : So.defaultData([1, 1, 1]).randomnessObject,
          o = s.noiseType === "perlin";
        Oa.noiseSeed(s.seed);
        var a = d0((0, rf.default)(s.seed)),
          l = Cm(s.strength, this.parameters.randomness);
        if (!r.object) {
          var _iterator76 = _createForOfIteratorHelper(this.children.entries()),
            _step76;
          try {
            for (_iterator76.s(); !(_step76 = _iterator76.n()).done;) {
              var _step76$value = _slicedToArray(_step76.value, 2),
                y = _step76$value[1];
              y.position.set(0, 0, 0), y.scale.setScalar(1), y.rotation.set(0, 0, 0);
            }
          } catch (err) {
            _iterator76.e(err);
          } finally {
            _iterator76.f();
          }
          this.objectForSample = void 0;
          return;
        }
        if (!this.objectForSample) return;
        if (this.objectForSample instanceof tf) if (!((_this$objectForSample = this.objectForSample.font) !== null && _this$objectForSample !== void 0 && _this$objectForSample.isLoaded) || this.objectForSample.geometry.attributes.position === void 0) {
          this._pendingMediaLoad = !0;
          return;
        } else this._pendingMediaLoad = !1;
        if (this.objectForSample.geometry === void 0 && this.objectForSample.isAncestorOf(this.object.uuid)) {
          console.warn("Oh no! The object \"".concat(this.object.name, "\" (").concat(this.object.uuid, ") seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead."));
          return;
        }
        var u = this.getSubdivData(),
          c = [],
          d = function d(y) {
            var v = y.length,
              x = y.map(function (A) {
                return A[0];
              }).reduce(function (A, E) {
                return A + E;
              }, 0),
              S = y.map(function (A) {
                return A[1];
              }).reduce(function (A, E) {
                return A + E;
              }, 0),
              w = y.map(function (A) {
                return A[2];
              }).reduce(function (A, E) {
                return A + E;
              }, 0);
            return [x / v, S / v, w / v];
          },
          h = function h(y) {
            return Math.round(y * 1e6) / 1e6;
          };
        u.forEach(function (y) {
          var v = u.filter(function (x) {
            return h(y.pos[0]) === h(x.pos[0]) && h(y.pos[1]) === h(x.pos[1]) && h(y.pos[2]) === h(x.pos[2]);
          });
          v.length > 1 ? c.push({
            pos: y.pos,
            norm: d(v.map(function (x) {
              return x.norm;
            }))
          }) : c.push(y);
        });
        var f = gR(c);
        if (f.length > 0) {
          var _y43 = Math.round(f.length * r.count / 100);
          this._updateCount(_y43);
        } else {
          var _y44 = this.objectForSample.geometry.getAttribute("position");
          if (!_y44 || isNaN(_y44.count) || _y44.count === 0) {
            console.warn("Oh no! The object \"".concat(this.object.name, "\" (").concat(this.object.uuid, ") cannot be cloned on the surface of \"").concat(this.objectForSample.name, "\" (").concat(this.objectForSample.uuid, ") because the latter does not have a valid geometry."));
            return;
          }
        }
        this.objectForSample.updateMatrixWorld();
        var p = new h0(this.objectForSample).build(),
          m = pR[r.axis],
          g = this.children;
        p.setRandomGenerator((0, rf.default)(this.object.uuid + r.seed));
        var _iterator77 = _createForOfIteratorHelper(g.entries()),
          _step77;
        try {
          for (_iterator77.s(); !(_step77 = _iterator77.n()).done;) {
            var _step77$value = _slicedToArray(_step77.value, 2),
              _y45 = _step77$value[0],
              v = _step77$value[1];
            var x = _y45 * (s.freqScale / 10) + s.movement,
              S = o ? Oa.noise(x) : a(x, x),
              w = _y45 + 1,
              A = l(w, dt(S, s.rotation[0])),
              E = l(w, dt(S, s.rotation[1])),
              b = l(w, dt(S, s.rotation[2]));
            r.spreadType === "random" ? p.sample(Pm, s_) : (f.length && (Pm.fromArray(f[_y45].pos), s_.fromArray(f[_y45].norm)), this.objectForSample instanceof Qs && Pm.applyMatrix4(G7.copy(this.objectForSample.matrixWorld).invert())), Pm.applyMatrix4(this.object.hiddenMatrix.clone().invert()), v.position.copy(Pm), Fl.fromArray(m);
            var T = r.align === "normal" ? s_ : this.object.getWorldDirection(W7),
              M = Yc.fromArray(r.position);
            Yc.x += Yc.x + l(w, dt(S, s.position[0])), Yc.y += Yc.y + l(w, dt(S, s.position[1])), Yc.z += Yc.z + l(w, dt(S, s.position[2]));
            var C = Math.acos(T.dot(Fl)),
              P = H7.crossVectors(Fl, T).normalize(),
              D = j7.makeRotationAxis(P, C),
              O = T.clone().cross(this.object.up).normalize(),
              I = O.clone().cross(T).normalize(),
              z = new te().makeBasis(O, T, I),
              B = new _(Fl.y, Fl.z, Fl.x).normalize(),
              _V15 = B.clone().cross(Fl).normalize(),
              _U16 = new te().makeBasis(B, Fl, _V15).invert(),
              j = new te().multiplyMatrices(z, _U16);
            v.rotation.setFromRotationMatrix(j), M.applyMatrix4(D), v.position.add(M), v.rotation.x = v.rotation.x + i.x + A, v.rotation.y = v.rotation.y + i.y + E, v.rotation.z = v.rotation.z + i.z + b, v.scale.setScalar(1), v.scale.x = v.scale.x + r.scale[0] + l(w, dt(S, s.scale[0])) || wn, v.scale.y = v.scale.y + r.scale[1] + l(w, dt(S, s.scale[1])) || wn, v.scale.z = v.scale.z + r.scale[2] + l(w, dt(S, s.scale[2])) || wn, v.scale.multiply(this.object.scale), v.hiddenMatrix = this.object.hiddenMatrix;
          }
        } catch (err) {
          _iterator77.e(err);
        } finally {
          _iterator77.f();
        }
      }
    }, {
      key: "getSubdivData",
      value: function getSubdivData() {
        if (!this.objectForSample) return [];
        var e = this.parameters.toObject.spreadType;
        if (e === "random") return [];
        if (this.objectForSample instanceof Qs) {
          var r = this.objectForSample,
            _i118 = mR[e],
            s = MR[_i118],
            o = ER[_i118],
            a = TR[_i118],
            l = [],
            u = s(r.subdivPointerNew);
          for (var c = 0; c <= u - 1; c++) {
            var d = o(r.subdivPointerNew, c),
              h = a(r.subdivPointerNew, c);
            AR.fromArray(d).applyMatrix4(r.matrixWorld), _R.fromArray(h), l.push({
              pos: AR.toArray(),
              norm: _R.toArray()
            });
          }
          return l;
        } else return (this.objectForSample.geometry.index ? yR(this.objectForSample.geometry) : vR(this.objectForSample.geometry)).map(function (i, s) {
          return e === "polygon_center" ? {
            pos: i.midpoint,
            norm: i.norm
          } : e === "vertex" ? [{
            pos: i.vertices[0],
            norm: i.norm
          }, {
            pos: i.vertices[1],
            norm: i.norm
          }, {
            pos: i.vertices[2],
            norm: i.norm
          }] : e === "edge" ? [{
            pos: i.faceCenters[0],
            norm: i.norm
          }, {
            pos: i.faceCenters[1],
            norm: i.norm
          }, {
            pos: i.faceCenters[2],
            norm: i.norm
          }] : [];
        }).flat();
      }
    }, {
      key: "updateState",
      value: function updateState(e, r) {
        var _this$object$parent;
        if (this.parameters = ha(e), this.parameters.type !== "toObject") (this.parent === null || this.parent !== this.object) && (this.removeFromParent(), (_this$object$parent = this.object.parent) !== null && _this$object$parent !== void 0 && _this$object$parent.add(this), this.matrix = this.object.matrix, this.hiddenMatrix = this.object.hiddenMatrix, this.matrixWorldNeedsUpdate = !0, this.matrixAutoUpdate = !1);else if (this.parent === null || this.parent.uuid !== this.parameters.toObject.object) {
          this.removeFromParent();
          var _i119 = r.find(this.parameters.toObject.object);
          _i119 instanceof nr ? this.objectForSample = _i119 : this.objectForSample = void 0, this.matrix = new te(), this.hiddenMatrix = new te(), this.matrixWorldNeedsUpdate = !0, this.matrixAutoUpdate = !1, _i119 && _i119.add(this);
        }
        this.update();
      }
    }, {
      key: "pendingMediaLoad",
      get: function get() {
        return this._pendingMediaLoad;
      }
    }]);
    return Gi;
  }(hh(mt));
var Bo = function Bo(n) {
  var t;
  return t = /*#__PURE__*/function (_n9) {
    _inherits(t, _n9);
    var _super209 = _createSuper(t);
    function t() {
      _classCallCheck(this, t);
      return _super209.apply(this, arguments);
    }
    return _createClass(t);
  }(n), t.geometryHelper = new li(30, 30, 30), t;
};
var tx = new Rs(),
  o_ = new Er(),
  CR = new te(),
  No = function No(n, t, e, r) {
    var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
    var s = t,
      o = n.matrixWorld;
    if (s.boundingSphere === null && s.computeBoundingSphere(), o_.copy(s.boundingSphere), o_.applyMatrix4(o), e.ray.intersectsSphere(o_) === !1 || (CR.copy(o).invert(), tx.copy(e.ray).applyMatrix4(CR), s.boundingBox !== null && tx.intersectsBox(s.boundingBox) === !1)) return;
    var a,
      l,
      u,
      c,
      d = s.index,
      h = s.attributes.position,
      f = s.drawRange,
      p,
      m;
    if (i === !1) {
      var y = Math.max(0, f.start),
        v = Math.min(d.count, f.start + f.count);
      for (p = y, m = v; p < m; p += 3) if (l = d.getX(p), u = d.getX(p + 1), c = d.getX(p + 2), a = g(n, e, tx, h, l, u, c), a) {
        a.faceIndex = Math.floor(p / 3), r.push(a);
        return;
      }
    } else {
      var _v32 = s.attributes.position,
        x = new _(),
        S = new _(),
        w = new _(),
        A = new _(),
        E = 2,
        T = 1 / ((n.scale.x + n.scale.y + n.scale.z) / 3),
        M = T * T,
        C = Math.max(0, f.start),
        P = Math.min(_v32.count, f.start + f.count);
      for (var D = C, O = P - 1; D < O; D += E) {
        if (x.fromBufferAttribute(_v32, D), S.fromBufferAttribute(_v32, D + 1), tx.distanceSqToSegment(x, S, A, w) > M) continue;
        A.applyMatrix4(n.matrixWorld);
        var z = e.ray.origin.distanceTo(A);
        z < e.near || z > e.far || r.push({
          distance: z,
          point: w.clone().applyMatrix4(n.matrixWorld),
          object: n
        });
      }
    }
    function g(y, v, x, S, w, A, E) {
      var b = new _(),
        T = new _(),
        M = new _(),
        C = new _(),
        P = new _();
      if (b.fromBufferAttribute(S, w), T.fromBufferAttribute(S, A), M.fromBufferAttribute(S, E), x.intersectTriangle(b, T, M, !1, C) === null) return null;
      P.copy(C), P.applyMatrix4(y.matrixWorld);
      var O = v.ray.origin.distanceTo(P);
      return O < v.near || O > v.far ? null : {
        faceIndex: 1,
        distance: O,
        point: P.clone(),
        object: y
      };
    }
  };
var rx = new _(),
  vs = new Hn(),
  a_ = /*#__PURE__*/function (_Ja4) {
    _inherits(a_, _Ja4);
    var _super210 = _createSuper(a_);
    function a_(e) {
      var _this218;
      _classCallCheck(this, a_);
      var r = new we(),
        i = new ns({
          color: 16777215,
          vertexColors: !0,
          toneMapped: !1
        }),
        s = [],
        o = [],
        a = {},
        l = new Le(15711266),
        u = new Le(15711266),
        c = new Le(2857471);
      d("n1", "n2", l), d("n2", "n4", l), d("n4", "n3", l), d("n3", "n1", l), d("f1", "f2", l), d("f2", "f4", l), d("f4", "f3", l), d("f3", "f1", l), d("n1", "f1", l), d("n2", "f2", l), d("n3", "f3", l), d("n4", "f4", l), d("p", "n1", u), d("p", "n2", u), d("p", "n3", u), d("p", "n4", u), d("u1", "u2", c), d("u2", "u3", c), d("u3", "u1", c);
      function d(f, p, m) {
        h(f, m), h(p, m);
      }
      function h(f, p) {
        s.push(0, 0, 0), o.push(p.r, p.g, p.b), a[f] === void 0 && (a[f] = []), a[f].push(s.length / 3 - 1);
      }
      r.setAttribute("position", new be(s, 3)), r.setAttribute("color", new be(o, 3));
      _this218 = _super210.call(this, r, i);
      _this218.type = "CameraHelper", _this218.camera = e, _this218.camera.updateProjectionMatrix && _this218.camera.updateProjectionMatrix(), _this218.matrix = e.matrixWorld, _this218.matrixAutoUpdate = !1, _this218.pointMap = a, _this218.update();
      return _this218;
    }
    _createClass(a_, [{
      key: "update",
      value: function update() {
        var e = this.geometry,
          r = this.pointMap,
          i = !0;
        vs.projectionMatrixInverse.elements = [.5112609807824982, -0, -0, -0, -0, .41421356237309503, -0, -0, -0, -0, -0, -.099999, -0, -0, -1.0000000000000002, .100001];
        var s = 1,
          o = 1,
          a = i ? .8 : 1e-4;
        Ks("n1", r, e, vs, -s, -o, a), Ks("n2", r, e, vs, s, -o, a), Ks("n3", r, e, vs, -s, o, a), Ks("n4", r, e, vs, s, o, a);
        var l = a;
        Ks("f1", r, e, vs, -s, -o, l), Ks("f2", r, e, vs, s, -o, l), Ks("f3", r, e, vs, -s, o, l), Ks("f4", r, e, vs, s, o, l);
        var u = l,
          c = .5;
        Ks("u1", r, e, vs, s * .7 * c, o * 1.1, u), Ks("u2", r, e, vs, -s * .7 * c, o * 1.1, u), Ks("u3", r, e, vs, 0, o * (1.1 + .9 * c), u), e.getAttribute("position").needsUpdate = !0;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.geometry.dispose(), this.material.dispose();
      }
    }]);
    return a_;
  }(Ja);
function Ks(n, t, e, r, i, s, o) {
  rx.set(i, s, o).unproject(r);
  var a = t[n];
  if (a !== void 0) {
    var l = e.getAttribute("position");
    for (var u = 0, c = a.length; u < c; u++) l.setXYZ(a[u], rx.x, rx.y, rx.z);
  }
}
var ix = /*#__PURE__*/function (_Bo) {
  _inherits(ix, _Bo);
  var _super211 = _createSuper(ix);
  function ix(e) {
    var _this219;
    _classCallCheck(this, ix);
    _this219 = _super211.call(this, e);
    _this219.object = e;
    _this219.object = e, _this219.name = "CombinedCameraHelper: ".concat(e.uuid);
    return _this219;
  }
  _createClass(ix, [{
    key: "updateMatrixWorld",
    value: function updateMatrixWorld(e) {
      _get(_getPrototypeOf(ix.prototype), "updateMatrixWorld", this).call(this, e), this.updateTarget();
    }
  }, {
    key: "updateTarget",
    value: function updateTarget() {
      var e = this.object.getTarget();
      this.updateWorldMatrix(!0, !1), this.worldToLocal(e);
    }
  }, {
    key: "raycast",
    value: function raycast(e, r) {
      No(this.object, this.geometry, e, r, !0);
    }
  }]);
  return ix;
}(Bo(a_));
var nx;
(function (t) {
  return t.is = function (e) {
    return "objectHelper" in e;
  };
})(nx || (nx = {}));
var xs = function xs(n, t) {
  return /*#__PURE__*/function (_ph2) {
    _inherits(_class3, _ph2);
    var _super212 = _createSuper(_class3);
    function _class3() {
      var _this220;
      _classCallCheck(this, _class3);
      _this220 = _super212.apply(this, arguments);
      _this220.objectHelper = new t(_assertThisInitialized(_this220));
      _this220.gizmos = {};
      return _this220;
    }
    _createClass(_class3, [{
      key: "geometryHelper",
      get: function get() {
        return t.geometryHelper;
      }
    }, {
      key: "raycast",
      value: function raycast(i, s) {
        this.objectHelper.raycast(i, s);
      }
    }, {
      key: "showGizmos",
      value: function showGizmos() {
        for (var _i120 in this.gizmos) {
          var s = this.gizmos[_i120];
          s instanceof sl && (s.visible = !0);
        }
      }
    }, {
      key: "updateEntityBoxSize",
      value: function updateEntityBoxSize(i, s) {
        this.objectHelper.visible && this.geometryHelper instanceof li ? (i.setScalar(0), s.set(this.geometryHelper.parameters.width, this.geometryHelper.parameters.height, this.geometryHelper.parameters.height).multiplyScalar(.5)) : _get(_getPrototypeOf(_class3.prototype), "updateEntityBoxSize", this).call(this, i, s);
      }
    }, {
      key: "hideGizmos",
      value: function hideGizmos() {
        for (var _i121 in this.gizmos) {
          var s = this.gizmos[_i121];
          s instanceof sl && (s.visible = !1);
        }
      }
    }]);
    return _class3;
  }(ph(n));
};
var sx = 790,
  nf = new _(),
  l_ = new _(),
  c_ = new je(),
  u_ = new _(),
  Dm = new _(),
  d_ = new _(),
  hr = /*#__PURE__*/function (_xs) {
    _inherits(hr, _xs);
    var _super213 = _createSuper(hr);
    function hr() {
      var _this221;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _objectSpread(_objectSpread({}, Dc.defaultData), {}, {
        name: ""
      });
      _classCallCheck(this, hr);
      _this221 = _super213.call(this);
      _this221._cameraType = "OrthographicCamera";
      _this221.targetOffset = xl.DefaultTargetOffset;
      _this221.isUpVectorFlipped = !1;
      _this221.angleOffsetFromUp = 0;
      _this221.wasMovedByUser = !1;
      _this221.wasMovedBySwitchCameraAction = !1;
      _this221.super_Entity(e, r), _this221.previousProjectionMatrix = new te(), _this221.matrixAutoUpdate = !0, _this221.width = window.innerWidth, _this221.height = window.innerHeight;
      var i = _this221.width,
        s = _this221.height;
      _this221.orthoCamera = new Ou(i * -.5, i * .5, s * .5, s * -.5, -5e4, 1e4), _this221.perspCamera = new Wr(45, i / s, 50, 1e4), _this221.left = _this221.orthoCamera.left, _this221.right = _this221.orthoCamera.right, _this221.top = _this221.orthoCamera.top, _this221.bottom = _this221.orthoCamera.bottom, _this221.far = _this221.orthoCamera.far, _this221.view = _this221.orthoCamera.view, _this221.aspect = _this221.perspCamera.aspect, _this221.focus = _this221.perspCamera.focus, _this221.filmGauge = _this221.perspCamera.filmGauge, _this221.filmOffset = _this221.perspCamera.filmOffset, _this221.objectHelper.update();
      return _this221;
    }
    _createClass(hr, [{
      key: "isPerspectiveCamera",
      get: function get() {
        return this.cameraType === "PerspectiveCamera";
      }
    }, {
      key: "isOrthographicCamera",
      get: function get() {
        return !this.isPerspectiveCamera;
      }
    }, {
      key: "cameraType",
      get: function get() {
        return this._cameraType;
      },
      set: function set(e) {
        e === "PerspectiveCamera" ? this.toPerspective() : e === "OrthographicCamera" && this.toOrthographic();
      }
    }, {
      key: "fov",
      get: function get() {
        return this.perspCamera.fov;
      },
      set: function set(e) {
        this.perspCamera.fov = e;
      }
    }, {
      key: "setNear",
      value: function setNear(e, r) {
        e === "PerspectiveCamera" ? this.perspCamera.near = r : this.orthoCamera.near = r;
      }
    }, {
      key: "setZoom",
      value: function setZoom(e, r) {
        r >= 0 && (e === "PerspectiveCamera" ? this.perspCamera.zoom = r : this.orthoCamera.zoom = r);
      }
    }, {
      key: "near",
      get: function get() {
        return this._cameraType === "PerspectiveCamera" ? this.perspCamera.near : this.orthoCamera.near;
      },
      set: function set(e) {
        this._cameraType === "PerspectiveCamera" ? this.perspCamera.near = e : this.orthoCamera.near = e;
      }
    }, {
      key: "zoom",
      get: function get() {
        return this._cameraType === "PerspectiveCamera" ? this.perspCamera.zoom : this.orthoCamera.zoom;
      },
      set: function set(e) {
        e >= 0 && (this._cameraType === "PerspectiveCamera" ? this.perspCamera.zoom = e : this.orthoCamera.zoom = e);
      }
    }, {
      key: "lookAt",
      value: function lookAt(e, r, i) {
        typeof e == "number" && (e = new _(e, r, i)), _get(_getPrototypeOf(hr.prototype), "lookAt", this).call(this, e), this.getWorldPosition(nf), this.targetOffset = nf.distanceTo(e);
      }
    }, {
      key: "getTarget",
      value: function getTarget() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new _();
        return this.getWorldDirection(l_), this.getWorldPosition(nf), l_.multiplyScalar(this.targetOffset), e.copy(nf).add(l_), e;
      }
    }, {
      key: "getDistanceToTarget",
      value: function getDistanceToTarget() {
        var e = this.getTarget();
        return this.getWorldPosition(nf), nf.distanceTo(e);
      }
    }, {
      key: "updateUp",
      value: function updateUp() {
        this.getWorldQuaternion(c_), u_.set(0, 0, 1).applyQuaternion(c_), Dm.copy(mt.DEFAULT_UP), this.isUpVectorFlipped && Dm.negate(), Dm.applyQuaternion(c_), d_.copy(mt.DEFAULT_UP).projectOnPlane(u_), this.angleOffsetFromUp = d_.angleTo(Dm), this.angleOffsetFromUp *= d_.cross(Dm).dot(u_) >= 0 ? 1 : -1;
      }
    }, {
      key: "updateTransformState",
      value: function updateTransformState(e, r) {
        var i = _get(_getPrototypeOf(hr.prototype), "updateTransformState", this).call(this, e, r);
        return e.isUpVectorFlipped !== void 0 && (this.isUpVectorFlipped = e.isUpVectorFlipped), this.updateUp(), i;
      }
    }, {
      key: "getViewFrontToObject",
      value: function getViewFrontToObject(e) {
        var r = e.getWorldPosition(new _()),
          s = e.getWorldDirection(new _()).multiplyScalar(this.targetOffset);
        return {
          position: r.clone().add(s),
          target: r
        };
      }
    }, {
      key: "getViewToTarget",
      value: function getViewToTarget(e) {
        var i = this.getWorldDirection(new _()).multiplyScalar(this.targetOffset);
        return {
          position: e.clone().sub(i),
          target: e
        };
      }
    }, {
      key: "getViewToObject",
      value: function getViewToObject(e) {
        var r = new _(),
          i = e.getWorldPosition(r);
        return this.getViewToTarget(r);
      }
    }, {
      key: "setViewplaneSize",
      value: function setViewplaneSize(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        if (this.aspect = e / r, i) {
          var s = e > r ? this.aspect : 1,
            o = e > r ? 1 : this.aspect;
          this.left = -sx * .5 * s, this.right = sx * .5 * s, this.top = sx * .5 * (1 / o), this.bottom = -sx * .5 * (1 / o);
        } else this.left = -e * .5, this.right = e * .5, this.top = r * .5, this.bottom = -r * .5;
        this.updateProjectionMatrix();
      }
    }, {
      key: "copyViewPlaneSize",
      value: function copyViewPlaneSize(e) {
        this.aspect = e.aspect, this.left = e.left, this.right = e.right, this.top = e.top, this.bottom = e.bottom, this.updateProjectionMatrix();
      }
    }, {
      key: "toOrthographic",
      value: function toOrthographic() {
        this.orthoCamera.left = this.left, this.orthoCamera.right = this.right, this.orthoCamera.top = this.top, this.orthoCamera.bottom = this.bottom, this.orthoCamera.view = this.view, this.orthoCamera.far = this.far, this.orthoCamera.updateProjectionMatrix(), this.projectionMatrix = this.orthoCamera.projectionMatrix, this.projectionMatrixInverse = this.orthoCamera.projectionMatrixInverse, this._cameraType = "OrthographicCamera", this.objectHelper && this.objectHelper.update();
      }
    }, {
      key: "toPerspective",
      value: function toPerspective() {
        this.perspCamera.aspect = this.aspect, this.perspCamera.fov = this.fov, this.perspCamera.view = this.view, this.perspCamera.far = this.far, this.perspCamera.updateProjectionMatrix(), this.projectionMatrix = this.perspCamera.projectionMatrix, this.projectionMatrixInverse = this.perspCamera.projectionMatrixInverse, this._cameraType = "PerspectiveCamera", this.objectHelper && this.objectHelper.update();
      }
    }, {
      key: "setFocalLength",
      value: function setFocalLength(e) {
        this.perspCamera.setFocalLength(e), this.toPerspective();
      }
    }, {
      key: "getFocalLength",
      value: function getFocalLength() {
        return this.perspCamera.getFocalLength();
      }
    }, {
      key: "getEffectiveFOV",
      value: function getEffectiveFOV() {
        return this.perspCamera.getEffectiveFOV();
      }
    }, {
      key: "getFilmWidth",
      value: function getFilmWidth() {
        return this.perspCamera.getFilmWidth();
      }
    }, {
      key: "getFilmHeight",
      value: function getFilmHeight() {
        return this.perspCamera.getFilmHeight();
      }
    }, {
      key: "setViewOffset",
      value: function setViewOffset(e, r, i, s, o, a) {
        this._cameraType === "PerspectiveCamera" ? this.perspCamera.setViewOffset(e, r, i, s, o, a) : this.orthoCamera.setViewOffset(e, r, i, s, o, a);
      }
    }, {
      key: "clearViewOffset",
      value: function clearViewOffset() {
        this._cameraType === "PerspectiveCamera" ? (this.perspCamera.clearViewOffset(), this.toPerspective()) : (this.orthoCamera.clearViewOffset(), this.toOrthographic());
      }
    }, {
      key: "copyHistory",
      value: function copyHistory() {
        this.previousProjectionMatrix && this.previousProjectionMatrix.copy(this.projectionMatrix);
      }
    }, {
      key: "updateProjectionMatrix",
      value: function updateProjectionMatrix() {
        this._cameraType === "PerspectiveCamera" ? this.toPerspective() : this._cameraType === "OrthographicCamera" && this.toOrthographic();
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(e) {
        _get(_getPrototypeOf(hr.prototype), "updateMatrixWorld", this).call(this, e), this.matrixWorldInverse.copy(this.matrixWorld).invert();
      }
    }, {
      key: "updateWorldMatrix",
      value: function updateWorldMatrix(e, r) {
        _get(_getPrototypeOf(hr.prototype), "updateWorldMatrix", this).call(this, e, r), this.matrixWorldInverse.copy(this.matrixWorld).invert();
      }
    }, {
      key: "copy",
      value: function copy(e, r) {
        return _get(_getPrototypeOf(hr.prototype), "copy", this).call(this, e, r), this.parent = e.parent, this.orthoCamera.copy(e.orthoCamera), this.perspCamera.copy(e.perspCamera), this.left = e.left, this.right = e.right, this.top = e.top, this.bottom = e.bottom, this.far = e.far, this.view = e.view === null ? null : Object.assign({}, e.view), this._cameraType = e._cameraType, this.aspect = e.aspect, this.fov = e.fov, this.focus = e.focus, this.filmGauge = e.filmGauge, this.filmOffset = e.filmOffset, this.targetOffset = e.targetOffset, this.updateProjectionMatrix(), this;
      }
    }, {
      key: "toCameraState",
      value: function toCameraState() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var r = {
          type: this.cameraType,
          far: this.far,
          orthographic: {
            near: this.orthoCamera.near,
            zoom: this.orthoCamera.zoom
          },
          perspective: {
            near: this.perspCamera.near,
            fov: this.perspCamera.fov,
            zoom: this.perspCamera.zoom
          },
          up: this.up.toArray(),
          targetOffset: this.targetOffset,
          isUpVectorFlipped: this.isUpVectorFlipped
        };
        return Ed(r, e);
      }
    }, {
      key: "updateCameraSubtype",
      value: function updateCameraSubtype(e, r) {
        var i = e === "perspective" ? "PerspectiveCamera" : "OrthographicCamera";
        r.zoom !== void 0 && this.setZoom(i, r.zoom), r.near !== void 0 && this.setNear(i, r.near), r.fov !== void 0 && i === "PerspectiveCamera" && (this.fov = r.fov);
      }
    }, {
      key: "updateState",
      value: function updateState(e, r) {
        this.updateCameraState(e, r);
      }
    }, {
      key: "updateCameraState",
      value: function updateCameraState(e, r) {
        this.updateState_Entity(e, r), e.far !== void 0 && (this.far = e.far), e.orthographic !== void 0 && this.updateCameraSubtype("orthographic", e.orthographic), e.perspective !== void 0 && this.updateCameraSubtype("perspective", e.perspective), e.type !== void 0 && (this.cameraType = e.type), e.up !== void 0 && this.up.fromArray(e.up), e.targetOffset !== void 0 && (this.targetOffset = e.targetOffset), e.isUpVectorFlipped !== void 0 && (this.isUpVectorFlipped = e.isUpVectorFlipped), this.updateProjectionMatrix();
      }
    }, {
      key: "updateByPatchedOp",
      value: function updateByPatchedOp(e, r, i) {
        _get(_getPrototypeOf(hr.prototype), "updateByPatchedOp", this).call(this, e, r, i), e.path.length === 1 && e.type === 0 && this.updateCameraSubtype(e.path[0], e.props);
      }
    }, {
      key: "toState",
      value: function toState(e) {
        return _objectSpread(_objectSpread(_objectSpread({}, _get(_getPrototypeOf(hr.prototype), "toState", this).call(this, e)), this.toCameraState(e)), {}, {
          type: this.cameraType
        });
      }
    }]);
    return hr;
  }(xs(Hn, ix));
var sf = new te(),
  Y7 = new te(),
  ox = new te(),
  PR = new _(),
  DR = new _();
function h_(n) {
  var t = !1;
  return n.scene.objects.traverse(function (e, r) {
    var _r$geometry;
    ((_r$geometry = r.geometry) === null || _r$geometry === void 0 ? void 0 : _r$geometry.type) === "BooleanGeometry" && (t = !0);
  }), t;
}
var Ln = /*#__PURE__*/function (_gs2) {
  _inherits(Ln, _gs2);
  var _super214 = _createSuper(Ln);
  function Ln(e, r, i) {
    var _thisSuper, _this222;
    _classCallCheck(this, Ln);
    _this222 = _super214.call(this, e, r);
    _this222.data = r;
    _this222.meshSetAddresses = [];
    _this222.needsTransformForDownstream = !1;
    _this222.geometry = new we();
    _this222.onAfterRender = function (e, r, i, s, o, a) {
      _get((_thisSuper = _assertThisInitialized(_this222), _getPrototypeOf(Ln.prototype)), "onAfterRender", _thisSuper).call(_thisSuper, e, r, i, s, o, a), _this222.recomputeBoolean();
    };
    _this222.geometry.userData.parameters = {
      width: 0,
      height: 0,
      depth: 0
    };
    return _this222;
  }
  _createClass(Ln, [{
    key: "booleanOp",
    get: function get() {
      return this.data.geometry.operation;
    }
  }, {
    key: "phongAngle",
    get: function get() {
      var _this$data$geometry$p2;
      return (_this$data$geometry$p2 = this.data.geometry.phongAngle) !== null && _this$data$geometry$p2 !== void 0 ? _this$data$geometry$p2 : 45;
    }
  }, {
    key: "isLOD",
    get: function get() {
      return this.recomputeBoolean(), !1;
    }
  }, {
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(e, r, i) {
      _get(_getPrototypeOf(Ln.prototype), "updateByPatchedOp", this).call(this, e, r, i), e.path.length === 1 && e.path[0] === "geometry" && e.type === 0 && e.props.operation !== void 0 && (this.freeBooleanPointer(), this.resetBBoxNeedsUpdate());
    }
  }, {
    key: "freeBooleanPointer",
    value: function freeBooleanPointer() {
      _get(_getPrototypeOf(Ln.prototype), "freeBooleanPointer", this).call(this), this.geometry.dispose();
    }
  }, {
    key: "recomputeBoolean",
    value: function recomputeBoolean(e) {
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      if (this.booleanMeshSetAddress !== -1 && !e) return;
      for (var s = 0; s < this.children.length; s++) {
        var o = this.children[s];
        o instanceof Ln && o.dataPatched.visible === !0 && o.recomputeBoolean(e === !0, r);
      }
      this.meshSetAddresses = [];
      for (var _s57 = 0; _s57 < this.children.length; _s57++) {
        var _o52$geometry$attribu;
        var _o52 = this.children[_s57];
        if (_o52 instanceof nr && _o52.dataPatched.visible === !0 && ((_o52$geometry$attribu = _o52.geometry.attributes.position) === null || _o52$geometry$attribu === void 0 ? void 0 : _o52$geometry$attribu.count) > 0 && _o52.geometry.drawRange.count > 0 && _o52.booleanMeshSetAddress !== 0) {
          sf.multiplyMatrices(_o52.hiddenMatrix, _o52.matrix);
          try {
            if (_o52.booleanMeshSetAddress === -1) {
              var _o52$geometry$index;
              if (((_o52$geometry$index = _o52.geometry.index) !== null && _o52$geometry$index !== void 0 ? _o52$geometry$index : _o52.geometry.getAttribute("position")).count / 3 < 15e5 && (_o52.booleanMeshSetAddress = ps.getMeshSet(_o52.geometry, e === !0, r)), _o52.booleanMeshSetAddress === -1) return;
              ps.transformMeshSet(_o52.booleanMeshSetAddress, sf), _o52.booleanMatrixInvOld.copy(sf).invert(), _o52.booleanWasTransformed = !1;
            } else _o52 instanceof Ln && _o52.needsTransformForDownstream === !0 ? (ps.transformMeshSet(_o52.booleanMeshSetAddress, sf), _o52.needsTransformForDownstream = !1) : _o52.booleanWasTransformed === !0 && (ps.transformMeshSet(_o52.booleanMeshSetAddress, Y7.multiplyMatrices(sf, _o52.booleanMatrixInvOld)), _o52.booleanMatrixInvOld.copy(sf).invert(), _o52.booleanWasTransformed = !1);
          } catch (a) {
            console.error(a), _o52.booleanMeshSetAddress = 0, _o52.geometry.userData.booleanOperationDidFail = !0;
            continue;
          }
          ps.hasOpenEdges(_o52.booleanMeshSetAddress) === !1 || _s57 === this.children.length - 1 && this.booleanOp === 2 ? (this.meshSetAddresses.push(_o52.booleanMeshSetAddress), _o52.geometry.userData.booleanOperationDidFail = !1) : _o52.geometry.userData.booleanOperationDidFail = "openEdges";
        }
      }
      if (this.meshSetAddresses.length === 0) {
        this.geometry.setAttribute("position", new be([], 0)), this.geometry.setDrawRange(0, 0);
        return;
      }
      if (e === !0) return ps.calcBooleanTopological(this.meshSetAddresses, this.booleanOp);
      var i = this.geometry;
      i.dispose(), this.geometry = new we(), this.geometry.userData = i.userData, this.geometry.boundingSphere = i.boundingSphere;
      try {
        this.booleanMeshSetAddress = ps.calcBoolean(this.meshSetAddresses, this.booleanOp, this.geometry, this.phongAngle);
      } catch (s) {
        this.booleanMeshSetAddress = 0, this.geometry.userData.booleanOperationDidFail = !0, console.error(s);
      }
      this.booleanMatrixInvOld.copy(this.matrix).invert(), this.needsTransformForDownstream = !0, Jh(this), $h(this);
    }
  }, {
    key: "dispose",
    value: function dispose() {
      _get(_getPrototypeOf(Ln.prototype), "dispose", this).call(this), this.geometry.dispose();
    }
  }, {
    key: "recursiveBBox",
    get: function get() {
      var _this$geometry$boundi;
      var e = _get(_getPrototypeOf(Ln.prototype), "recursiveBBox", this);
      return ((_this$geometry$boundi = this.geometry.boundingSphere) === null || _this$geometry$boundi === void 0 ? void 0 : _this$geometry$boundi.radius) === -1 && (e.getCenter(this.geometry.boundingSphere.center), ox.copy(this.matrixWorld).invert(), this.geometry.boundingSphere.center.applyMatrix4(ox), PR.copy(e.max).applyMatrix4(ox), DR.copy(e.min).applyMatrix4(ox), this.geometry.boundingSphere.radius = PR.distanceTo(DR) / 2), e;
    }
  }]);
  return Ln;
}(gs);
var ax;
(function (t) {
  function n(e) {
    return ut.is(e) && e instanceof il;
  }
  t.is = n;
})(ax || (ax = {}));
var of = function of(n, t) {
  return /*#__PURE__*/function (_xs2) {
    _inherits(_class4, _xs2);
    var _super215 = _createSuper(_class4);
    function _class4() {
      _classCallCheck(this, _class4);
      return _super215.apply(this, arguments);
    }
    _createClass(_class4, [{
      key: "updateState_Light",
      value: function updateState_Light(r, i) {
        this.updateState_Entity(r, i), r.color !== void 0 && (this.color = i.shared.color(r.color)), r.intensity !== void 0 && (this.intensity = r.intensity), r.depth !== void 0 && (this.shadow.camera.far = r.depth, this.shadow.needsUpdate = !0), r.shadows !== void 0 && (this.castShadow = r.shadows);
      }
    }]);
    return _class4;
  }(xs(n, t));
};
var sn = function sn(n) {
    return n instanceof nr;
  },
  An = function An(n) {
    return n !== null && n instanceof Ln;
  },
  OR = function OR(n) {
    return n instanceof hr;
  },
  IR = function IR(n) {
    return ax.is(n);
  },
  Om = function Om(n) {
    return nx.is(n);
  };
var bs = /*#__PURE__*/function (_Bo2) {
  _inherits(bs, _Bo2);
  var _super216 = _createSuper(bs);
  function bs(e) {
    var _this223;
    var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 15;
    _classCallCheck(this, bs);
    _this223 = _super216.call(this, r);
    _this223.object = e;
    _this223.object.updateMatrixWorld(), _this223.name = "EmptyObjectHelper: ".concat(e.uuid), _this223.matrix = e.matrixWorld, _this223.matrixAutoUpdate = !1, _this223.object.isBone && (_this223.visible = !1);
    return _this223;
  }
  _createClass(bs, [{
    key: "raycast",
    value: function raycast(e, r) {
      No(this.object, bs.geometryHelper, e, r);
    }
  }, {
    key: "update",
    value: function update() {}
  }]);
  return bs;
}(Bo(Ey));
var Ss = /*#__PURE__*/function (_xs3) {
  _inherits(Ss, _xs3);
  var _super217 = _createSuper(Ss);
  function Ss(t, e) {
    var _this224;
    _classCallCheck(this, Ss);
    _this224 = _super217.call(this), _this224.super_Entity(t, e), _this224.objectHelper.update();
    return _this224;
  }
  _createClass(Ss, [{
    key: "updateState",
    value: function updateState(t, e) {
      this.updateState_Entity(t, e), "buffer" in t && Object.keys(t).length === 1 && e.scene.reloadSplats();
    }
  }]);
  return Ss;
}(xs(ts, bs));
var Xc = /*#__PURE__*/function (_xs4) {
  _inherits(Xc, _xs4);
  var _super218 = _createSuper(Xc);
  function Xc(e, r, i) {
    var _this225;
    _classCallCheck(this, Xc);
    _this225 = _super218.call(this);
    _this225.super_Entity(e, r), _this225.context = i, _this225.objectHelper.update();
    return _this225;
  }
  _createClass(Xc, [{
    key: "updateState",
    value: function updateState(e, r) {
      this.updateState_Entity(e, r);
    }
  }]);
  return Xc;
}(xs(ts, bs));
var zR = {
  RED: 0,
  GREEN: 1,
  BLUE: 2,
  ALPHA: 3
};
var Im = "varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}";
var X7 = "#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;\n#if PASS == 1\nuniform vec4 kernel64[32];\n#else\nuniform vec4 kernel16[8];\n#endif\nvarying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\n#if PASS == 1\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;\n#else\nvec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;\n#endif\n}}",
  lx = /*#__PURE__*/function (_rt2) {
    _inherits(lx, _rt2);
    var _super219 = _createSuper(lx);
    function lx() {
      var _this226;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
      _classCallCheck(this, lx);
      _this226 = _super219.call(this, {
        name: "BokehMaterial",
        defines: {
          PASS: n ? "2" : "1"
        },
        uniforms: {
          kernel64: new se(null),
          kernel16: new se(null),
          inputBuffer: new se(null),
          cocBuffer: new se(null),
          texelSize: new se(new N()),
          scale: new se(1)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: X7,
        vertexShader: Im
      }), _this226.toneMapped = !1, t && (_this226.defines.FOREGROUND = "1"), _this226.generateKernel();
      return _this226;
    }
    _createClass(lx, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "cocBuffer",
      set: function set(n) {
        this.uniforms.cocBuffer.value = n;
      }
    }, {
      key: "setCoCBuffer",
      value: function setCoCBuffer(n) {
        this.uniforms.cocBuffer.value = n;
      }
    }, {
      key: "scale",
      get: function get() {
        return this.uniforms.scale.value;
      },
      set: function set(n) {
        this.uniforms.scale.value = n;
      }
    }, {
      key: "getScale",
      value: function getScale(n) {
        return this.uniforms.scale.value = n;
      }
    }, {
      key: "setScale",
      value: function setScale(n) {
        this.uniforms.scale.value = n;
      }
    }, {
      key: "generateKernel",
      value: function generateKernel() {
        var n = 2.39996323,
          t = new Float32Array(128),
          e = new Float32Array(32),
          r = 0,
          i = 0;
        for (var a = 0; a < 80; ++a) {
          var l = a * n,
            u = Math.sqrt(a) / Math.sqrt(80),
            c = u * Math.cos(l),
            d = u * Math.sin(l);
          a % 5 === 0 ? (e[i++] = c, e[i++] = d) : (t[r++] = c, t[r++] = d);
        }
        var s = [],
          o = [];
        for (var _a52 = 0; _a52 < 128;) s.push(new He(t[_a52++], t[_a52++], t[_a52++], t[_a52++]));
        for (var _a53 = 0; _a53 < 32;) o.push(new He(e[_a53++], e[_a53++], e[_a53++], e[_a53++]));
        this.uniforms.kernel64.value = s, this.uniforms.kernel16.value = o;
      }
    }, {
      key: "setTexelSize",
      value: function setTexelSize(n, t) {
        this.uniforms.texelSize.value.set(n, t);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.uniforms.texelSize.value.set(1 / n, 1 / t);
      }
    }]);
    return lx;
  }(rt);
function RR(n, t, e) {
  return n * (t - e) - t;
}
function y_(n, t, e) {
  return Math.min(Math.max((n + t) / (t - e), 0), 1);
}
var Q7 = "#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",
  K7 = /*#__PURE__*/function (_rt3) {
    _inherits(K7, _rt3);
    var _super220 = _createSuper(K7);
    function K7(n) {
      var _this227;
      _classCallCheck(this, K7);
      _this227 = _super220.call(this, {
        name: "CircleOfConfusionMaterial",
        defines: {
          DEPTH_PACKING: "0"
        },
        uniforms: {
          depthBuffer: new se(null),
          focusDistance: new se(0),
          focusRange: new se(0),
          cameraNear: new se(.3),
          cameraFar: new se(1e3)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: Q7,
        vertexShader: Im
      }), _this227.toneMapped = !1, _this227.uniforms.focalLength = _this227.uniforms.focusRange, _this227.adoptCameraSettings(n);
      return _this227;
    }
    _createClass(K7, [{
      key: "near",
      get: function get() {
        return this.uniforms.cameraNear.value;
      }
    }, {
      key: "far",
      get: function get() {
        return this.uniforms.cameraFar.value;
      }
    }, {
      key: "depthBuffer",
      set: function set(n) {
        this.uniforms.depthBuffer.value = n;
      }
    }, {
      key: "depthPacking",
      set: function set(n) {
        this.defines.DEPTH_PACKING = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "setDepthBuffer",
      value: function setDepthBuffer(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.depthBuffer = n, this.depthPacking = t;
      }
    }, {
      key: "focusDistance",
      get: function get() {
        return this.uniforms.focusDistance.value;
      },
      set: function set(n) {
        this.uniforms.focusDistance.value = n;
      }
    }, {
      key: "worldFocusDistance",
      get: function get() {
        return -RR(this.focusDistance, this.near, this.far);
      },
      set: function set(n) {
        this.focusDistance = y_(-n, this.near, this.far);
      }
    }, {
      key: "getFocusDistance",
      value: function getFocusDistance(n) {
        this.uniforms.focusDistance.value = n;
      }
    }, {
      key: "setFocusDistance",
      value: function setFocusDistance(n) {
        this.uniforms.focusDistance.value = n;
      }
    }, {
      key: "focalLength",
      get: function get() {
        return this.focusRange;
      },
      set: function set(n) {
        this.focusRange = n;
      }
    }, {
      key: "focusRange",
      get: function get() {
        return this.uniforms.focusRange.value;
      },
      set: function set(n) {
        this.uniforms.focusRange.value = n;
      }
    }, {
      key: "worldFocusRange",
      get: function get() {
        return -RR(this.focusRange, this.near, this.far);
      },
      set: function set(n) {
        this.focusRange = y_(-n, this.near, this.far);
      }
    }, {
      key: "getFocalLength",
      value: function getFocalLength(n) {
        return this.focusRange;
      }
    }, {
      key: "setFocalLength",
      value: function setFocalLength(n) {
        this.focusRange = n;
      }
    }, {
      key: "adoptCameraSettings",
      value: function adoptCameraSettings(n) {
        n && (this.uniforms.cameraNear.value = n.near, this.uniforms.cameraFar.value = n.far, n instanceof Wr ? this.defines.PERSPECTIVE_CAMERA = "1" : delete this.defines.PERSPECTIVE_CAMERA, this.needsUpdate = !0);
      }
    }]);
    return K7;
  }(rt),
  Z7 = "#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",
  J7 = "uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",
  LR = /*#__PURE__*/function (_rt4) {
    _inherits(LR, _rt4);
    var _super221 = _createSuper(LR);
    function LR() {
      var _this228;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      _classCallCheck(this, LR);
      _this228 = _super221.call(this, {
        name: "KawaseBlurMaterial",
        uniforms: {
          inputBuffer: new se(null),
          texelSize: new se(new N()),
          halfTexelSize: new se(new N()),
          kernel: new se(0),
          scale: new se(1)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: Z7,
        vertexShader: J7
      }), _this228.toneMapped = !1, _this228.setTexelSize(n.x, n.y);
      return _this228;
    }
    _createClass(LR, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.inputBuffer = n;
      }
    }, {
      key: "scale",
      get: function get() {
        return this.uniforms.scale.value;
      },
      set: function set(n) {
        this.uniforms.scale.value = n;
      }
    }, {
      key: "getScale",
      value: function getScale() {
        return this.uniforms.scale.value;
      }
    }, {
      key: "setScale",
      value: function setScale(n) {
        this.uniforms.scale.value = n;
      }
    }, {
      key: "getKernel",
      value: function getKernel() {
        return null;
      }
    }, {
      key: "kernel",
      get: function get() {
        return this.uniforms.kernel.value;
      },
      set: function set(n) {
        this.uniforms.kernel.value = n;
      }
    }, {
      key: "setKernel",
      value: function setKernel(n) {
        this.kernel = n;
      }
    }, {
      key: "setTexelSize",
      value: function setTexelSize(n, t) {
        this.uniforms.texelSize.value.set(n, t), this.uniforms.halfTexelSize.value.set(n, t).multiplyScalar(.5);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.uniforms;
        e.texelSize.value.set(1 / n, 1 / t), e.halfTexelSize.value.copy(e.texelSize.value).multiplyScalar(.5);
      }
    }]);
    return LR;
  }(rt),
  $7 = "#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",
  eX = /*#__PURE__*/function (_rt5) {
    _inherits(eX, _rt5);
    var _super222 = _createSuper(eX);
    function eX() {
      var _this229;
      _classCallCheck(this, eX);
      _this229 = _super222.call(this, {
        name: "CopyMaterial",
        uniforms: {
          inputBuffer: new se(null),
          opacity: new se(1)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: $7,
        vertexShader: Im
      }), _this229.toneMapped = !1;
      return _this229;
    }
    _createClass(eX, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "getOpacity",
      value: function getOpacity(n) {
        return this.uniforms.opacity.value;
      }
    }, {
      key: "setOpacity",
      value: function setOpacity(n) {
        this.uniforms.opacity.value = n;
      }
    }]);
    return eX;
  }(rt);
var tX = "varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",
  rX = "uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}",
  af = {
    DEPTH: 0,
    LUMA: 1,
    COLOR: 2
  },
  iX = {
    DISABLED: 0,
    DEPTH: 1,
    CUSTOM: 2
  },
  nX = /*#__PURE__*/function (_rt6) {
    _inherits(nX, _rt6);
    var _super223 = _createSuper(nX);
    function nX() {
      var _this230;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : af.COLOR;
      _classCallCheck(this, nX);
      _this230 = _super223.call(this, {
        name: "EdgeDetectionMaterial",
        defines: {
          THREE_REVISION: aa.replace(/\D+/g, ""),
          LOCAL_CONTRAST_ADAPTATION_FACTOR: "2.0",
          EDGE_THRESHOLD: "0.1",
          DEPTH_THRESHOLD: "0.01",
          PREDICATION_MODE: "0",
          PREDICATION_THRESHOLD: "0.01",
          PREDICATION_SCALE: "2.0",
          PREDICATION_STRENGTH: "1.0",
          DEPTH_PACKING: "0"
        },
        uniforms: {
          inputBuffer: new se(null),
          depthBuffer: new se(null),
          predicationBuffer: new se(null),
          texelSize: new se(n)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: tX,
        vertexShader: rX
      }), _this230.toneMapped = !1, _this230.edgeDetectionMode = t;
      return _this230;
    }
    _createClass(nX, [{
      key: "depthBuffer",
      set: function set(n) {
        this.uniforms.depthBuffer.value = n;
      }
    }, {
      key: "depthPacking",
      set: function set(n) {
        this.defines.DEPTH_PACKING = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "setDepthBuffer",
      value: function setDepthBuffer(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.depthBuffer = n, this.depthPacking = t;
      }
    }, {
      key: "edgeDetectionMode",
      get: function get() {
        return Number(this.defines.EDGE_DETECTION_MODE);
      },
      set: function set(n) {
        this.defines.EDGE_DETECTION_MODE = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "getEdgeDetectionMode",
      value: function getEdgeDetectionMode() {
        return this.edgeDetectionMode;
      }
    }, {
      key: "setEdgeDetectionMode",
      value: function setEdgeDetectionMode(n) {
        this.edgeDetectionMode = n;
      }
    }, {
      key: "localContrastAdaptationFactor",
      get: function get() {
        return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR);
      },
      set: function set(n) {
        this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR = n.toFixed("6"), this.needsUpdate = !0;
      }
    }, {
      key: "getLocalContrastAdaptationFactor",
      value: function getLocalContrastAdaptationFactor() {
        return this.localContrastAdaptationFactor;
      }
    }, {
      key: "setLocalContrastAdaptationFactor",
      value: function setLocalContrastAdaptationFactor(n) {
        this.localContrastAdaptationFactor = n;
      }
    }, {
      key: "edgeDetectionThreshold",
      get: function get() {
        return Number(this.defines.EDGE_THRESHOLD);
      },
      set: function set(n) {
        this.defines.EDGE_THRESHOLD = n.toFixed("6"), this.defines.DEPTH_THRESHOLD = (n * .1).toFixed("6"), this.needsUpdate = !0;
      }
    }, {
      key: "getEdgeDetectionThreshold",
      value: function getEdgeDetectionThreshold() {
        return this.edgeDetectionThreshold;
      }
    }, {
      key: "setEdgeDetectionThreshold",
      value: function setEdgeDetectionThreshold(n) {
        this.edgeDetectionThreshold = n;
      }
    }, {
      key: "predicationMode",
      get: function get() {
        return Number(this.defines.PREDICATION_MODE);
      },
      set: function set(n) {
        this.defines.PREDICATION_MODE = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "getPredicationMode",
      value: function getPredicationMode() {
        return this.predicationMode;
      }
    }, {
      key: "setPredicationMode",
      value: function setPredicationMode(n) {
        this.predicationMode = n;
      }
    }, {
      key: "predicationBuffer",
      set: function set(n) {
        this.uniforms.predicationBuffer.value = n;
      }
    }, {
      key: "setPredicationBuffer",
      value: function setPredicationBuffer(n) {
        this.uniforms.predicationBuffer.value = n;
      }
    }, {
      key: "predicationThreshold",
      get: function get() {
        return Number(this.defines.PREDICATION_THRESHOLD);
      },
      set: function set(n) {
        this.defines.PREDICATION_THRESHOLD = n.toFixed("6"), this.needsUpdate = !0;
      }
    }, {
      key: "getPredicationThreshold",
      value: function getPredicationThreshold() {
        return this.predicationThreshold;
      }
    }, {
      key: "setPredicationThreshold",
      value: function setPredicationThreshold(n) {
        this.predicationThreshold = n;
      }
    }, {
      key: "predicationScale",
      get: function get() {
        return Number(this.defines.PREDICATION_SCALE);
      },
      set: function set(n) {
        this.defines.PREDICATION_SCALE = n.toFixed("6"), this.needsUpdate = !0;
      }
    }, {
      key: "getPredicationScale",
      value: function getPredicationScale() {
        return this.predicationScale;
      }
    }, {
      key: "setPredicationScale",
      value: function setPredicationScale(n) {
        this.predicationScale = n;
      }
    }, {
      key: "predicationStrength",
      get: function get() {
        return Number(this.defines.PREDICATION_STRENGTH);
      },
      set: function set(n) {
        this.defines.PREDICATION_STRENGTH = n.toFixed("6"), this.needsUpdate = !0;
      }
    }, {
      key: "getPredicationStrength",
      value: function getPredicationStrength() {
        return this.predicationStrength;
      }
    }, {
      key: "setPredicationStrength",
      value: function setPredicationStrength(n) {
        this.predicationStrength = n;
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.uniforms.texelSize.value.set(1 / n, 1 / t);
      }
    }]);
    return nX;
  }(rt),
  sX = "#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}",
  oX = "uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",
  Zs = {
    FRAGMENT_HEAD: "FRAGMENT_HEAD",
    FRAGMENT_MAIN_UV: "FRAGMENT_MAIN_UV",
    FRAGMENT_MAIN_IMAGE: "FRAGMENT_MAIN_IMAGE",
    VERTEX_HEAD: "VERTEX_HEAD",
    VERTEX_MAIN_SUPPORT: "VERTEX_MAIN_SUPPORT"
  },
  v_ = /*#__PURE__*/function (_rt7) {
    _inherits(v_, _rt7);
    var _super224 = _createSuper(v_);
    function v_(n, t, e, r) {
      var _this231;
      var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
      _classCallCheck(this, v_);
      _this231 = _super224.call(this, {
        name: "EffectMaterial",
        defines: {
          THREE_REVISION: aa.replace(/\D+/g, ""),
          DEPTH_PACKING: "0",
          ENCODE_OUTPUT: "1"
        },
        uniforms: {
          inputBuffer: new se(null),
          depthBuffer: new se(null),
          resolution: new se(new N()),
          texelSize: new se(new N()),
          cameraNear: new se(.3),
          cameraFar: new se(1e3),
          aspect: new se(1),
          time: new se(0)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        dithering: i
      }), _this231.toneMapped = !1, n && _this231.setShaderParts(n), t && _this231.setDefines(t), e && _this231.setUniforms(e), _this231.adoptCameraSettings(r);
      return _this231;
    }
    _createClass(v_, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "depthBuffer",
      get: function get() {
        return this.uniforms.depthBuffer.value;
      },
      set: function set(n) {
        this.uniforms.depthBuffer.value = n;
      }
    }, {
      key: "depthPacking",
      get: function get() {
        return Number(this.defines.DEPTH_PACKING);
      },
      set: function set(n) {
        this.defines.DEPTH_PACKING = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "setDepthBuffer",
      value: function setDepthBuffer(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.depthBuffer = n, this.depthPacking = t;
      }
    }, {
      key: "setShaderParts",
      value: function setShaderParts(n) {
        return this.fragmentShader = sX.replace(Zs.FRAGMENT_HEAD, n.get(Zs.FRAGMENT_HEAD)).replace(Zs.FRAGMENT_MAIN_UV, n.get(Zs.FRAGMENT_MAIN_UV)).replace(Zs.FRAGMENT_MAIN_IMAGE, n.get(Zs.FRAGMENT_MAIN_IMAGE)), this.vertexShader = oX.replace(Zs.VERTEX_HEAD, n.get(Zs.VERTEX_HEAD)).replace(Zs.VERTEX_MAIN_SUPPORT, n.get(Zs.VERTEX_MAIN_SUPPORT)), this.needsUpdate = !0, this;
      }
    }, {
      key: "setDefines",
      value: function setDefines(n) {
        var _iterator78 = _createForOfIteratorHelper(n.entries()),
          _step78;
        try {
          for (_iterator78.s(); !(_step78 = _iterator78.n()).done;) {
            var t = _step78.value;
            this.defines[t[0]] = t[1];
          }
        } catch (err) {
          _iterator78.e(err);
        } finally {
          _iterator78.f();
        }
        return this.needsUpdate = !0, this;
      }
    }, {
      key: "setUniforms",
      value: function setUniforms(n) {
        var _iterator79 = _createForOfIteratorHelper(n.entries()),
          _step79;
        try {
          for (_iterator79.s(); !(_step79 = _iterator79.n()).done;) {
            var t = _step79.value;
            this.uniforms[t[0]] = t[1];
          }
        } catch (err) {
          _iterator79.e(err);
        } finally {
          _iterator79.f();
        }
        return this;
      }
    }, {
      key: "setExtensions",
      value: function setExtensions(n) {
        this.extensions = {};
        var _iterator80 = _createForOfIteratorHelper(n),
          _step80;
        try {
          for (_iterator80.s(); !(_step80 = _iterator80.n()).done;) {
            var t = _step80.value;
            this.extensions[t] = !0;
          }
        } catch (err) {
          _iterator80.e(err);
        } finally {
          _iterator80.f();
        }
        return this;
      }
    }, {
      key: "encodeOutput",
      get: function get() {
        return this.defines.ENCODE_OUTPUT !== void 0;
      },
      set: function set(n) {
        this.encodeOutput !== n && (n ? this.defines.ENCODE_OUTPUT = "1" : delete this.defines.ENCODE_OUTPUT, this.needsUpdate = !0);
      }
    }, {
      key: "isOutputEncodingEnabled",
      value: function isOutputEncodingEnabled(n) {
        return this.encodeOutput;
      }
    }, {
      key: "setOutputEncodingEnabled",
      value: function setOutputEncodingEnabled(n) {
        this.encodeOutput = n;
      }
    }, {
      key: "time",
      get: function get() {
        return this.uniforms.time.value;
      },
      set: function set(n) {
        this.uniforms.time.value = n;
      }
    }, {
      key: "setDeltaTime",
      value: function setDeltaTime(n) {
        this.uniforms.time.value += n;
      }
    }, {
      key: "adoptCameraSettings",
      value: function adoptCameraSettings(n) {
        n && (this.uniforms.cameraNear.value = n.near, this.uniforms.cameraFar.value = n.far, n instanceof Wr ? this.defines.PERSPECTIVE_CAMERA = "1" : delete this.defines.PERSPECTIVE_CAMERA, this.needsUpdate = !0);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.uniforms;
        e.resolution.value.set(n, t), e.texelSize.value.set(1 / n, 1 / t), e.aspect.value = n / t;
      }
    }], [{
      key: "Section",
      get: function get() {
        return Zs;
      }
    }]);
    return v_;
  }(rt);
var aX = "#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",
  lX = /*#__PURE__*/function (_rt8) {
    _inherits(lX, _rt8);
    var _super225 = _createSuper(lX);
    function lX() {
      var _this232;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
      _classCallCheck(this, lX);
      _this232 = _super225.call(this, {
        name: "LuminanceMaterial",
        defines: {
          THREE_REVISION: aa.replace(/\D+/g, "")
        },
        uniforms: {
          inputBuffer: new se(null),
          threshold: new se(0),
          smoothing: new se(1),
          range: new se(null)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: aX,
        vertexShader: Im
      }), _this232.toneMapped = !1, _this232.colorOutput = n, _this232.luminanceRange = t;
      return _this232;
    }
    _createClass(lX, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "threshold",
      get: function get() {
        return this.uniforms.threshold.value;
      },
      set: function set(n) {
        this.smoothing > 0 || n > 0 ? this.defines.THRESHOLD = "1" : delete this.defines.THRESHOLD, this.uniforms.threshold.value = n;
      }
    }, {
      key: "getThreshold",
      value: function getThreshold() {
        return this.threshold;
      }
    }, {
      key: "setThreshold",
      value: function setThreshold(n) {
        this.threshold = n;
      }
    }, {
      key: "smoothing",
      get: function get() {
        return this.uniforms.smoothing.value;
      },
      set: function set(n) {
        this.threshold > 0 || n > 0 ? this.defines.THRESHOLD = "1" : delete this.defines.THRESHOLD, this.uniforms.smoothing.value = n;
      }
    }, {
      key: "getSmoothingFactor",
      value: function getSmoothingFactor() {
        return this.smoothing;
      }
    }, {
      key: "setSmoothingFactor",
      value: function setSmoothingFactor(n) {
        this.smoothing = n;
      }
    }, {
      key: "useThreshold",
      get: function get() {
        return this.threshold > 0 || this.smoothing > 0;
      },
      set: function set(n) {}
    }, {
      key: "colorOutput",
      get: function get() {
        return this.defines.COLOR !== void 0;
      },
      set: function set(n) {
        n ? this.defines.COLOR = "1" : delete this.defines.COLOR, this.needsUpdate = !0;
      }
    }, {
      key: "isColorOutputEnabled",
      value: function isColorOutputEnabled(n) {
        return this.colorOutput;
      }
    }, {
      key: "setColorOutputEnabled",
      value: function setColorOutputEnabled(n) {
        this.colorOutput = n;
      }
    }, {
      key: "useRange",
      get: function get() {
        return this.luminanceRange !== null;
      },
      set: function set(n) {
        this.luminanceRange = null;
      }
    }, {
      key: "luminanceRange",
      get: function get() {
        return this.uniforms.range.value;
      },
      set: function set(n) {
        n !== null ? this.defines.RANGE = "1" : delete this.defines.RANGE, this.uniforms.range.value = n, this.needsUpdate = !0;
      }
    }, {
      key: "getLuminanceRange",
      value: function getLuminanceRange() {
        return this.luminanceRange;
      }
    }, {
      key: "setLuminanceRange",
      value: function setLuminanceRange(n) {
        this.luminanceRange = n;
      }
    }]);
    return lX;
  }(rt),
  cX = "#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",
  VR = {
    DISCARD: 0,
    MULTIPLY: 1,
    MULTIPLY_RGB_SET_ALPHA: 2
  },
  uX = /*#__PURE__*/function (_rt9) {
    _inherits(uX, _rt9);
    var _super226 = _createSuper(uX);
    function uX() {
      var _this233;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      _classCallCheck(this, uX);
      _this233 = _super226.call(this, {
        name: "MaskMaterial",
        uniforms: {
          maskTexture: new se(n),
          inputBuffer: new se(null),
          strength: new se(1)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: cX,
        vertexShader: Im
      }), _this233.toneMapped = !1, _this233.setColorChannel(zR.RED), _this233.setMaskFunction(VR.DISCARD);
      return _this233;
    }
    _createClass(uX, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "maskTexture",
      set: function set(n) {
        this.uniforms.maskTexture.value = n, delete this.defines.MASK_PRECISION_HIGH, n.type !== br && (this.defines.MASK_PRECISION_HIGH = "1"), this.needsUpdate = !0;
      }
    }, {
      key: "setMaskTexture",
      value: function setMaskTexture(n) {
        this.maskTexture = n;
      }
    }, {
      key: "colorChannel",
      set: function set(n) {
        this.defines.COLOR_CHANNEL = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "setColorChannel",
      value: function setColorChannel(n) {
        this.colorChannel = n;
      }
    }, {
      key: "maskFunction",
      set: function set(n) {
        this.defines.MASK_FUNCTION = n.toFixed(0), this.needsUpdate = !0;
      }
    }, {
      key: "setMaskFunction",
      value: function setMaskFunction(n) {
        this.maskFunction = n;
      }
    }, {
      key: "inverted",
      get: function get() {
        return this.defines.INVERTED !== void 0;
      },
      set: function set(n) {
        this.inverted && !n ? delete this.defines.INVERTED : n && (this.defines.INVERTED = "1"), this.needsUpdate = !0;
      }
    }, {
      key: "isInverted",
      value: function isInverted() {
        return this.inverted;
      }
    }, {
      key: "setInverted",
      value: function setInverted(n) {
        this.inverted = n;
      }
    }, {
      key: "strength",
      get: function get() {
        return this.uniforms.strength.value;
      },
      set: function set(n) {
        this.uniforms.strength.value = n;
      }
    }, {
      key: "getStrength",
      value: function getStrength() {
        return this.strength;
      }
    }, {
      key: "setStrength",
      value: function setStrength(n) {
        this.strength = n;
      }
    }]);
    return uX;
  }(rt);
var dX = "#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",
  hX = "uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",
  fX = /*#__PURE__*/function (_rt10) {
    _inherits(fX, _rt10);
    var _super227 = _createSuper(fX);
    function fX() {
      var _this234;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new N();
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new N();
      _classCallCheck(this, fX);
      _this234 = _super227.call(this, {
        name: "SMAAWeightsMaterial",
        defines: {
          MAX_SEARCH_STEPS_INT: "16",
          MAX_SEARCH_STEPS_FLOAT: "16.0",
          MAX_SEARCH_STEPS_DIAG_INT: "8",
          MAX_SEARCH_STEPS_DIAG_FLOAT: "8.0",
          CORNER_ROUNDING: "25",
          CORNER_ROUNDING_NORM: "0.25",
          AREATEX_MAX_DISTANCE: "16.0",
          AREATEX_MAX_DISTANCE_DIAG: "20.0",
          AREATEX_PIXEL_SIZE: "(1.0 / vec2(160.0, 560.0))",
          AREATEX_SUBTEX_SIZE: "(1.0 / 7.0)",
          SEARCHTEX_SIZE: "vec2(66.0, 33.0)",
          SEARCHTEX_PACKED_SIZE: "vec2(64.0, 16.0)"
        },
        uniforms: {
          inputBuffer: new se(null),
          searchTexture: new se(null),
          areaTexture: new se(null),
          resolution: new se(t),
          texelSize: new se(n)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        fragmentShader: dX,
        vertexShader: hX
      }), _this234.toneMapped = !1;
      return _this234;
    }
    _createClass(fX, [{
      key: "inputBuffer",
      set: function set(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "setInputBuffer",
      value: function setInputBuffer(n) {
        this.uniforms.inputBuffer.value = n;
      }
    }, {
      key: "searchTexture",
      get: function get() {
        return this.uniforms.searchTexture.value;
      },
      set: function set(n) {
        this.uniforms.searchTexture.value = n;
      }
    }, {
      key: "areaTexture",
      get: function get() {
        return this.uniforms.areaTexture.value;
      },
      set: function set(n) {
        this.uniforms.areaTexture.value = n;
      }
    }, {
      key: "setLookupTextures",
      value: function setLookupTextures(n, t) {
        this.searchTexture = n, this.areaTexture = t;
      }
    }, {
      key: "orthogonalSearchSteps",
      get: function get() {
        return Number(this.defines.MAX_SEARCH_STEPS_INT);
      },
      set: function set(n) {
        var t = Math.min(Math.max(n, 0), 112);
        this.defines.MAX_SEARCH_STEPS_INT = t.toFixed("0"), this.defines.MAX_SEARCH_STEPS_FLOAT = t.toFixed("1"), this.needsUpdate = !0;
      }
    }, {
      key: "setOrthogonalSearchSteps",
      value: function setOrthogonalSearchSteps(n) {
        this.orthogonalSearchSteps = n;
      }
    }, {
      key: "diagonalSearchSteps",
      get: function get() {
        return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT);
      },
      set: function set(n) {
        var t = Math.min(Math.max(n, 0), 20);
        this.defines.MAX_SEARCH_STEPS_DIAG_INT = t.toFixed("0"), this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT = t.toFixed("1"), this.needsUpdate = !0;
      }
    }, {
      key: "setDiagonalSearchSteps",
      value: function setDiagonalSearchSteps(n) {
        this.diagonalSearchSteps = n;
      }
    }, {
      key: "diagonalDetection",
      get: function get() {
        return this.defines.DISABLE_DIAG_DETECTION === void 0;
      },
      set: function set(n) {
        n ? delete this.defines.DISABLE_DIAG_DETECTION : this.defines.DISABLE_DIAG_DETECTION = "1", this.needsUpdate = !0;
      }
    }, {
      key: "isDiagonalDetectionEnabled",
      value: function isDiagonalDetectionEnabled() {
        return this.diagonalDetection;
      }
    }, {
      key: "setDiagonalDetectionEnabled",
      value: function setDiagonalDetectionEnabled(n) {
        this.diagonalDetection = n;
      }
    }, {
      key: "cornerRounding",
      get: function get() {
        return Number(this.defines.CORNER_ROUNDING);
      },
      set: function set(n) {
        var t = Math.min(Math.max(n, 0), 100);
        this.defines.CORNER_ROUNDING = t.toFixed("4"), this.defines.CORNER_ROUNDING_NORM = (t / 100).toFixed("4"), this.needsUpdate = !0;
      }
    }, {
      key: "setCornerRounding",
      value: function setCornerRounding(n) {
        this.cornerRounding = n;
      }
    }, {
      key: "cornerDetection",
      get: function get() {
        return this.defines.DISABLE_CORNER_DETECTION === void 0;
      },
      set: function set(n) {
        n ? delete this.defines.DISABLE_CORNER_DETECTION : this.defines.DISABLE_CORNER_DETECTION = "1", this.needsUpdate = !0;
      }
    }, {
      key: "isCornerRoundingEnabled",
      value: function isCornerRoundingEnabled() {
        return this.cornerDetection;
      }
    }, {
      key: "setCornerRoundingEnabled",
      value: function setCornerRoundingEnabled(n) {
        this.cornerDetection = n;
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.uniforms;
        e.texelSize.value.set(1 / n, 1 / t), e.resolution.value.set(n, t);
      }
    }]);
    return fX;
  }(rt);
var pX = new Hn(),
  kl = null;
function mX() {
  if (kl === null) {
    var _n10 = new Float32Array([-1, -1, 0, 3, -1, 0, -1, 3, 0]),
      t = new Float32Array([0, 0, 2, 0, 0, 2]);
    kl = new we(), kl.setAttribute !== void 0 ? (kl.setAttribute("position", new Ge(_n10, 3)), kl.setAttribute("uv", new Ge(t, 2))) : (kl.addAttribute("position", new Ge(_n10, 3)), kl.addAttribute("uv", new Ge(t, 2)));
  }
  return kl;
}
var hi = /*#__PURE__*/function () {
    function hi() {
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "Pass";
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new vi();
      var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : pX;
      _classCallCheck(this, hi);
      this.name = n, this.renderer = null, this.scene = t, this.camera = e, this.screen = null, this.rtt = !0, this.needsSwap = !0, this.needsDepthTexture = !1, this.enabled = !0;
    }
    _createClass(hi, [{
      key: "renderToScreen",
      get: function get() {
        return !this.rtt;
      },
      set: function set(n) {
        if (this.rtt === n) {
          var t = this.getFullscreenMaterial();
          t !== null && (t.needsUpdate = !0), this.rtt = !n;
        }
      }
    }, {
      key: "setRenderer",
      value: function setRenderer(n) {
        this.renderer = n;
      }
    }, {
      key: "isEnabled",
      value: function isEnabled() {
        return this.enabled;
      }
    }, {
      key: "setEnabled",
      value: function setEnabled(n) {
        this.enabled = n;
      }
    }, {
      key: "fullscreenMaterial",
      get: function get() {
        return this.screen !== null ? this.screen.material : null;
      },
      set: function set(n) {
        var t = this.screen;
        t !== null ? t.material = n : (t = new rr(mX(), n), t.frustumCulled = !1, this.scene === null && (this.scene = new vi()), this.scene.add(t), this.screen = t);
      }
    }, {
      key: "getFullscreenMaterial",
      value: function getFullscreenMaterial() {
        return this.fullscreenMaterial;
      }
    }, {
      key: "setFullscreenMaterial",
      value: function setFullscreenMaterial(n) {
        this.fullscreenMaterial = n;
      }
    }, {
      key: "getDepthTexture",
      value: function getDepthTexture() {
        return null;
      }
    }, {
      key: "setDepthTexture",
      value: function setDepthTexture(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        throw new Error("Render method not implemented!");
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {}
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {}
    }, {
      key: "dispose",
      value: function dispose() {
        for (var _i122 = 0, _Object$keys9 = Object.keys(this); _i122 < _Object$keys9.length; _i122++) {
          var _n11 = _Object$keys9[_i122];
          var t = this[_n11];
          if (t !== null && typeof t.dispose == "function") {
            if (t instanceof vi || t === this.renderer) continue;
            this[_n11].dispose();
          }
        }
      }
    }]);
    return hi;
  }(),
  Rm = /*#__PURE__*/function (_hi) {
    _inherits(Rm, _hi);
    var _super228 = _createSuper(Rm);
    function Rm(n) {
      var _this235;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      _classCallCheck(this, Rm);
      _this235 = _super228.call(this, "CopyPass"), _this235.fullscreenMaterial = new eX(), _this235.needsSwap = !1, _this235.renderTarget = n, n === void 0 && (_this235.renderTarget = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this235.renderTarget.texture.name = "CopyPass.Target"), _this235.autoResize = t;
      return _this235;
    }
    _createClass(Rm, [{
      key: "resize",
      get: function get() {
        return this.autoResize;
      },
      set: function set(n) {
        this.autoResize = n;
      }
    }, {
      key: "texture",
      get: function get() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getTexture",
      value: function getTexture() {
        return this.renderTarget.texture;
      }
    }, {
      key: "setAutoResizeEnabled",
      value: function setAutoResizeEnabled(n) {
        this.autoResize = n;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        this.fullscreenMaterial.inputBuffer = t.texture, n.setRenderTarget(this.renderToScreen ? null : this.renderTarget), n.render(this.scene, this.camera);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.autoResize && this.renderTarget.setSize(n, t);
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        e !== void 0 && (this.renderTarget.texture.type = e, e !== br ? this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1" : n.outputEncoding === tt && (this.renderTarget.texture.encoding = tt));
      }
    }]);
    return Rm;
  }(hi);
var UR = /*#__PURE__*/function (_hi2) {
    _inherits(UR, _hi2);
    var _super229 = _createSuper(UR);
    function UR() {
      var _this236;
      _classCallCheck(this, UR);
      _this236 = _super229.call(this, "ClearMaskPass", null, null), _this236.needsSwap = !1;
      return _this236;
    }
    _createClass(UR, [{
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = n.state.buffers.stencil;
        s.setLocked(!1), s.setTest(!1);
      }
    }]);
    return UR;
  }(hi),
  f_ = new Le(),
  x_ = /*#__PURE__*/function (_hi3) {
    _inherits(x_, _hi3);
    var _super230 = _createSuper(x_);
    function x_() {
      var _this237;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      _classCallCheck(this, x_);
      _this237 = _super230.call(this, "ClearPass", null, null), _this237.needsSwap = !1, _this237.color = n, _this237.depth = t, _this237.stencil = e, _this237.overrideClearColor = null, _this237.overrideClearAlpha = -1;
      return _this237;
    }
    _createClass(x_, [{
      key: "setClearFlags",
      value: function setClearFlags(n, t, e) {
        this.color = n, this.depth = t, this.stencil = e;
      }
    }, {
      key: "getOverrideClearColor",
      value: function getOverrideClearColor() {
        return this.overrideClearColor;
      }
    }, {
      key: "setOverrideClearColor",
      value: function setOverrideClearColor(n) {
        this.overrideClearColor = n;
      }
    }, {
      key: "getOverrideClearAlpha",
      value: function getOverrideClearAlpha() {
        return this.overrideClearAlpha;
      }
    }, {
      key: "setOverrideClearAlpha",
      value: function setOverrideClearAlpha(n) {
        this.overrideClearAlpha = n;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = this.overrideClearColor,
          o = this.overrideClearAlpha,
          a = n.getClearAlpha(),
          l = s !== null,
          u = o >= 0;
        l ? (f_.copy(n.getClearColor(f_)), n.setClearColor(s, u ? o : a)) : u && n.setClearAlpha(o), n.setRenderTarget(this.renderToScreen ? null : t), n.clear(this.color, this.depth, this.stencil), l ? n.setClearColor(f_, a) : u && n.setClearAlpha(a);
      }
    }]);
    return x_;
  }(hi),
  zl = -1,
  Nn = /*#__PURE__*/function (_ir9) {
    _inherits(Nn, _ir9);
    var _super231 = _createSuper(Nn);
    function Nn(n) {
      var _this238;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : zl;
      var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : zl;
      var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
      _classCallCheck(this, Nn);
      _this238 = _super231.call(this), _this238.resizable = n, _this238.base = new N(1, 1), _this238.preferred = new N(t, e), _this238.target = _this238.preferred, _this238.s = r;
      return _this238;
    }
    _createClass(Nn, [{
      key: "width",
      get: function get() {
        var n = this.base,
          t = this.preferred,
          e = this.scale,
          r;
        return t.width !== zl ? r = t.width : t.height !== zl ? r = Math.round(t.height * (n.width / Math.max(n.height, 1))) : r = Math.round(n.width * e), r;
      },
      set: function set(n) {
        this.preferredWidth = n;
      }
    }, {
      key: "height",
      get: function get() {
        var n = this.base,
          t = this.preferred,
          e = this.scale,
          r;
        return t.height !== zl ? r = t.height : t.width !== zl ? r = Math.round(t.width / Math.max(n.width / Math.max(n.height, 1), 1)) : r = Math.round(n.height * e), r;
      },
      set: function set(n) {
        this.preferredHeight = n;
      }
    }, {
      key: "getWidth",
      value: function getWidth() {
        return this.width;
      }
    }, {
      key: "getHeight",
      value: function getHeight() {
        return this.height;
      }
    }, {
      key: "scale",
      get: function get() {
        return this.s;
      },
      set: function set(n) {
        this.s !== n && (this.s = n, this.preferred.setScalar(zl), this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "getScale",
      value: function getScale() {
        return this.scale;
      }
    }, {
      key: "setScale",
      value: function setScale(n) {
        this.scale = n;
      }
    }, {
      key: "baseWidth",
      get: function get() {
        return this.base.width;
      },
      set: function set(n) {
        this.base.width !== n && (this.base.width = n, this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "getBaseWidth",
      value: function getBaseWidth() {
        return this.base.width;
      }
    }, {
      key: "setBaseWidth",
      value: function setBaseWidth(n) {
        this.base.width !== n && (this.base.width = n, this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "baseHeight",
      get: function get() {
        return this.base.height;
      },
      set: function set(n) {
        this.base.height !== n && (this.base.height = n, this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "getBaseHeight",
      value: function getBaseHeight() {
        return this.baseHeight;
      }
    }, {
      key: "setBaseHeight",
      value: function setBaseHeight(n) {
        this.baseHeight = n;
      }
    }, {
      key: "setBaseSize",
      value: function setBaseSize(n, t) {
        (this.base.width !== n || this.base.height !== t) && (this.base.set(n, t), this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "preferredWidth",
      get: function get() {
        return this.preferred.width;
      },
      set: function set(n) {
        this.preferred.width !== n && (this.preferred.width = n, this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "getPreferredWidth",
      value: function getPreferredWidth() {
        return this.preferredWidth;
      }
    }, {
      key: "setPreferredWidth",
      value: function setPreferredWidth(n) {
        this.preferredWidth = n;
      }
    }, {
      key: "preferredHeight",
      get: function get() {
        return this.preferred.height;
      },
      set: function set(n) {
        this.preferred.height !== n && (this.preferred.height = n, this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "getPreferredHeight",
      value: function getPreferredHeight() {
        return this.preferredHeight;
      }
    }, {
      key: "setPreferredHeight",
      value: function setPreferredHeight(n) {
        this.preferredHeight = n;
      }
    }, {
      key: "setPreferredSize",
      value: function setPreferredSize(n, t) {
        (this.preferred.width !== n || this.preferred.height !== t) && (this.preferred.set(n, t), this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height));
      }
    }, {
      key: "copy",
      value: function copy(n) {
        this.base.set(n.getBaseWidth(), n.getBaseHeight()), this.preferred.set(n.getPreferredWidth(), n.getPreferredHeight()), this.dispatchEvent({
          type: "change"
        }), this.resizable.setSize(this.base.width, this.base.height);
      }
    }], [{
      key: "AUTO_SIZE",
      get: function get() {
        return zl;
      }
    }]);
    return Nn;
  }(ir),
  p_ = !1,
  BR = /*#__PURE__*/function () {
    function BR() {
      var _this239 = this;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
      _classCallCheck(this, BR);
      this.originalMaterials = new Map(), this.material = null, this.materials = null, this.materialsBackSide = null, this.materialsDoubleSide = null, this.materialsFlatShaded = null, this.materialsFlatShadedBackSide = null, this.materialsFlatShadedDoubleSide = null, this.setMaterial(n), this.meshCount = 0, this.replaceMaterial = function (t) {
        if (t.isMesh) {
          var e;
          if (t.material.flatShading) switch (t.material.side) {
            case qi:
              e = _this239.materialsFlatShadedDoubleSide;
              break;
            case ai:
              e = _this239.materialsFlatShadedBackSide;
              break;
            default:
              e = _this239.materialsFlatShaded;
              break;
          } else switch (t.material.side) {
            case qi:
              e = _this239.materialsDoubleSide;
              break;
            case ai:
              e = _this239.materialsBackSide;
              break;
            default:
              e = _this239.materials;
              break;
          }
          _this239.originalMaterials.set(t, t.material), t.isSkinnedMesh ? t.material = e[2] : t.isInstancedMesh ? t.material = e[1] : t.material = e[0], ++_this239.meshCount;
        }
      };
    }
    _createClass(BR, [{
      key: "setMaterial",
      value: function setMaterial(n) {
        if (this.disposeMaterials(), this.material = n, n !== null) {
          var t = this.materials = [n.clone(), n.clone(), n.clone()];
          for (var _i123 = 0, _t27 = t; _i123 < _t27.length; _i123++) {
            var e = _t27[_i123];
            e.uniforms = Object.assign({}, n.uniforms), e.side = jn;
          }
          t[2].skinning = !0, this.materialsBackSide = t.map(function (e) {
            var r = e.clone();
            return r.uniforms = Object.assign({}, n.uniforms), r.side = ai, r;
          }), this.materialsDoubleSide = t.map(function (e) {
            var r = e.clone();
            return r.uniforms = Object.assign({}, n.uniforms), r.side = qi, r;
          }), this.materialsFlatShaded = t.map(function (e) {
            var r = e.clone();
            return r.uniforms = Object.assign({}, n.uniforms), r.flatShading = !0, r;
          }), this.materialsFlatShadedBackSide = t.map(function (e) {
            var r = e.clone();
            return r.uniforms = Object.assign({}, n.uniforms), r.flatShading = !0, r.side = ai, r;
          }), this.materialsFlatShadedDoubleSide = t.map(function (e) {
            var r = e.clone();
            return r.uniforms = Object.assign({}, n.uniforms), r.flatShading = !0, r.side = qi, r;
          });
        }
      }
    }, {
      key: "render",
      value: function render(n, t, e) {
        var r = n.shadowMap.enabled;
        if (n.shadowMap.enabled = !1, p_) {
          var _i124 = this.originalMaterials;
          this.meshCount = 0, t.traverse(this.replaceMaterial), n.render(t, e);
          var _iterator81 = _createForOfIteratorHelper(_i124),
            _step81;
          try {
            for (_iterator81.s(); !(_step81 = _iterator81.n()).done;) {
              var s = _step81.value;
              s[0].material = s[1];
            }
          } catch (err) {
            _iterator81.e(err);
          } finally {
            _iterator81.f();
          }
          this.meshCount !== _i124.size && _i124.clear();
        } else {
          var _i125 = t.overrideMaterial;
          t.overrideMaterial = this.material, n.render(t, e), t.overrideMaterial = _i125;
        }
        n.shadowMap.enabled = r;
      }
    }, {
      key: "disposeMaterials",
      value: function disposeMaterials() {
        if (this.material !== null) {
          var _n12 = this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);
          var _iterator82 = _createForOfIteratorHelper(_n12),
            _step82;
          try {
            for (_iterator82.s(); !(_step82 = _iterator82.n()).done;) {
              var t = _step82.value;
              t.dispose();
            }
          } catch (err) {
            _iterator82.e(err);
          } finally {
            _iterator82.f();
          }
        }
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.originalMaterials.clear(), this.disposeMaterials();
      }
    }], [{
      key: "workaroundEnabled",
      get: function get() {
        return p_;
      },
      set: function set(n) {
        p_ = n;
      }
    }]);
    return BR;
  }(),
  gX = /*#__PURE__*/function (_hi4) {
    _inherits(gX, _hi4);
    var _super232 = _createSuper(gX);
    function gX(n, t) {
      var _this240;
      var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;
      _classCallCheck(this, gX);
      _this240 = _super232.call(this, "RenderPass", n, t), _this240.needsSwap = !1, _this240.clearPass = new x_(), _this240.overrideMaterialManager = e === null ? null : new BR(e), _this240.ignoreBackground = !1, _this240.skipShadowMapUpdate = !1, _this240.selection = null;
      return _this240;
    }
    _createClass(gX, [{
      key: "renderToScreen",
      get: function get() {
        return _get(_getPrototypeOf(gX.prototype), "renderToScreen", this);
      },
      set: function set(n) {
        _set(_getPrototypeOf(gX.prototype), "renderToScreen", n, this, true), this.clearPass.renderToScreen = n;
      }
    }, {
      key: "overrideMaterial",
      get: function get() {
        var n = this.overrideMaterialManager;
        return n !== null ? n.material : null;
      },
      set: function set(n) {
        var t = this.overrideMaterialManager;
        n !== null ? t !== null ? t.setMaterial(n) : this.overrideMaterialManager = new BR(n) : t !== null && (t.dispose(), this.overrideMaterialManager = null);
      }
    }, {
      key: "getOverrideMaterial",
      value: function getOverrideMaterial() {
        return this.overrideMaterial;
      }
    }, {
      key: "setOverrideMaterial",
      value: function setOverrideMaterial(n) {
        this.overrideMaterial = n;
      }
    }, {
      key: "clear",
      get: function get() {
        return this.clearPass.enabled;
      },
      set: function set(n) {
        this.clearPass.enabled = n;
      }
    }, {
      key: "getSelection",
      value: function getSelection() {
        return this.selection;
      }
    }, {
      key: "setSelection",
      value: function setSelection(n) {
        this.selection = n;
      }
    }, {
      key: "isBackgroundDisabled",
      value: function isBackgroundDisabled() {
        return this.ignoreBackground;
      }
    }, {
      key: "setBackgroundDisabled",
      value: function setBackgroundDisabled(n) {
        this.ignoreBackground = n;
      }
    }, {
      key: "isShadowMapDisabled",
      value: function isShadowMapDisabled() {
        return this.skipShadowMapUpdate;
      }
    }, {
      key: "setShadowMapDisabled",
      value: function setShadowMapDisabled(n) {
        this.skipShadowMapUpdate = n;
      }
    }, {
      key: "getClearPass",
      value: function getClearPass() {
        return this.clearPass;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = this.scene,
          o = this.camera,
          a = this.selection,
          l = o.layers.mask,
          u = s.background,
          c = n.shadowMap.autoUpdate,
          d = this.renderToScreen ? null : t;
        a !== null && o.layers.set(a.getLayer()), this.skipShadowMapUpdate && (n.shadowMap.autoUpdate = !1), (this.ignoreBackground || this.clearPass.overrideClearColor !== null) && (s.background = null), this.clearPass.enabled && this.clearPass.render(n, t), n.setRenderTarget(d), this.overrideMaterialManager !== null ? this.overrideMaterialManager.render(n, s, o) : n.render(s, o), o.layers.mask = l, s.background = u, n.shadowMap.autoUpdate = c;
      }
    }]);
    return gX;
  }(hi),
  b_ = /*#__PURE__*/function (_hi5) {
    _inherits(b_, _hi5);
    var _super233 = _createSuper(b_);
    function b_(n, t) {
      var _this241;
      var _ref35 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref35$resolutionScal = _ref35.resolutionScale,
        e = _ref35$resolutionScal === void 0 ? 1 : _ref35$resolutionScal,
        _ref35$width = _ref35.width,
        r = _ref35$width === void 0 ? Nn.AUTO_SIZE : _ref35$width,
        _ref35$height = _ref35.height,
        i = _ref35$height === void 0 ? Nn.AUTO_SIZE : _ref35$height,
        s = _ref35.renderTarget;
      _classCallCheck(this, b_);
      _this241 = _super233.call(this, "DepthPass"), _this241.needsSwap = !1, _this241.renderPass = new gX(n, t, new hp({
        depthPacking: lw
      }));
      var o = _this241.renderPass;
      o.skipShadowMapUpdate = !0, o.ignoreBackground = !0;
      var a = o.getClearPass();
      a.overrideClearColor = new Le(16777215), a.overrideClearAlpha = 1, _this241.renderTarget = s, _this241.renderTarget === void 0 && (_this241.renderTarget = new at(1, 1, {
        minFilter: Et,
        magFilter: Et,
        stencilBuffer: !1
      }), _this241.renderTarget.texture.name = "DepthPass.Target");
      var l = _this241.resolution = new Nn(_assertThisInitialized(_this241), r, i, e);
      l.addEventListener("change", function (u) {
        return _this241.setSize(l.baseWidth, l.baseHeight);
      });
      return _this241;
    }
    _createClass(b_, [{
      key: "texture",
      get: function get() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getTexture",
      value: function getTexture() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getResolution",
      value: function getResolution() {
        return this.resolution;
      }
    }, {
      key: "getResolutionScale",
      value: function getResolutionScale() {
        return this.resolution.scale;
      }
    }, {
      key: "setResolutionScale",
      value: function setResolutionScale(n) {
        this.resolution.scale = n;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = this.renderToScreen ? null : this.renderTarget;
        this.renderPass.render(n, s);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.resolution;
        e.setBaseSize(n, t), this.renderTarget.setSize(e.width, e.height);
      }
    }]);
    return b_;
  }(hi);
var u2e = new Float32Array([255 / 256 / Math.pow(256, 3), 255 / 256 / Math.pow(256, 2), 255 / 256 / 256, 255 / 256]);
var yt = {
    SKIP: 0,
    ADD: 1,
    ALPHA: 2,
    AVERAGE: 3,
    COLOR_BURN: 4,
    COLOR_DODGE: 5,
    DARKEN: 6,
    DIFFERENCE: 7,
    EXCLUSION: 8,
    LIGHTEN: 9,
    MULTIPLY: 10,
    DIVIDE: 11,
    NEGATION: 12,
    NORMAL: 13,
    OVERLAY: 14,
    REFLECT: 15,
    SCREEN: 16,
    SOFT_LIGHT: 17,
    SUBTRACT: 18
  },
  yX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",
  vX = "vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",
  xX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",
  bX = "float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  SX = "float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  wX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",
  AX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",
  _X = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",
  EX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",
  TX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",
  MX = "float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  CX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",
  PX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",
  DX = "float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  OX = "float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  IX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",
  RX = "float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",
  LX = "vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",
  BX = new Map([[yt.SKIP, null], [yt.ADD, yX], [yt.ALPHA, vX], [yt.AVERAGE, xX], [yt.COLOR_BURN, bX], [yt.COLOR_DODGE, SX], [yt.DARKEN, wX], [yt.DIFFERENCE, AX], [yt.EXCLUSION, _X], [yt.LIGHTEN, EX], [yt.MULTIPLY, TX], [yt.DIVIDE, MX], [yt.NEGATION, CX], [yt.NORMAL, PX], [yt.OVERLAY, DX], [yt.REFLECT, OX], [yt.SCREEN, IX], [yt.SOFT_LIGHT, RX], [yt.SUBTRACT, LX]]),
  NX = /*#__PURE__*/function (_ir10) {
    _inherits(NX, _ir10);
    var _super234 = _createSuper(NX);
    function NX(n) {
      var _this242;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      _classCallCheck(this, NX);
      _this242 = _super234.call(this), _this242.f = n, _this242.opacity = new se(t);
      return _this242;
    }
    _createClass(NX, [{
      key: "getOpacity",
      value: function getOpacity() {
        return this.opacity.value;
      }
    }, {
      key: "setOpacity",
      value: function setOpacity(n) {
        this.opacity.value = n;
      }
    }, {
      key: "blendFunction",
      get: function get() {
        return this.f;
      },
      set: function set(n) {
        this.f = n, this.dispatchEvent({
          type: "change"
        });
      }
    }, {
      key: "getBlendFunction",
      value: function getBlendFunction() {
        return this.blendFunction;
      }
    }, {
      key: "setBlendFunction",
      value: function setBlendFunction(n) {
        this.blendFunction = n;
      }
    }, {
      key: "getShaderCode",
      value: function getShaderCode() {
        return BX.get(this.blendFunction);
      }
    }]);
    return NX;
  }(ir),
  Fo = {
    NONE: 0,
    DEPTH: 1,
    CONVOLUTION: 2
  };
var ko = /*#__PURE__*/function (_ir11) {
  _inherits(ko, _ir11);
  var _super235 = _createSuper(ko);
  function ko(n, t) {
    var _this243;
    var _ref36 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
      _ref36$attributes = _ref36.attributes,
      e = _ref36$attributes === void 0 ? Fo.NONE : _ref36$attributes,
      _ref36$blendFunction = _ref36.blendFunction,
      r = _ref36$blendFunction === void 0 ? yt.SCREEN : _ref36$blendFunction,
      _ref36$defines = _ref36.defines,
      i = _ref36$defines === void 0 ? new Map() : _ref36$defines,
      _ref36$uniforms = _ref36.uniforms,
      s = _ref36$uniforms === void 0 ? new Map() : _ref36$uniforms,
      _ref36$extensions = _ref36.extensions,
      o = _ref36$extensions === void 0 ? null : _ref36$extensions,
      _ref36$vertexShader = _ref36.vertexShader,
      a = _ref36$vertexShader === void 0 ? null : _ref36$vertexShader;
    _classCallCheck(this, ko);
    _this243 = _super235.call(this), _this243.name = n, _this243.renderer = null, _this243.attributes = e, _this243.fragmentShader = t, _this243.vertexShader = a, _this243.defines = i, _this243.uniforms = s, _this243.extensions = o, _this243.blendMode = new NX(r), _this243.blendMode.addEventListener("change", function (l) {
      return _this243.setChanged();
    });
    return _this243;
  }
  _createClass(ko, [{
    key: "getName",
    value: function getName() {
      return this.name;
    }
  }, {
    key: "setRenderer",
    value: function setRenderer(n) {
      this.renderer = n;
    }
  }, {
    key: "getDefines",
    value: function getDefines() {
      return this.defines;
    }
  }, {
    key: "getUniforms",
    value: function getUniforms() {
      return this.uniforms;
    }
  }, {
    key: "getExtensions",
    value: function getExtensions() {
      return this.extensions;
    }
  }, {
    key: "getBlendMode",
    value: function getBlendMode() {
      return this.blendMode;
    }
  }, {
    key: "getAttributes",
    value: function getAttributes() {
      return this.attributes;
    }
  }, {
    key: "setAttributes",
    value: function setAttributes(n) {
      this.attributes = n, this.setChanged();
    }
  }, {
    key: "getFragmentShader",
    value: function getFragmentShader() {
      return this.fragmentShader;
    }
  }, {
    key: "setFragmentShader",
    value: function setFragmentShader(n) {
      this.fragmentShader = n, this.setChanged();
    }
  }, {
    key: "getVertexShader",
    value: function getVertexShader() {
      return this.vertexShader;
    }
  }, {
    key: "setVertexShader",
    value: function setVertexShader(n) {
      this.vertexShader = n, this.setChanged();
    }
  }, {
    key: "setChanged",
    value: function setChanged() {
      this.dispatchEvent({
        type: "change"
      });
    }
  }, {
    key: "setDepthTexture",
    value: function setDepthTexture(n) {
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
    }
  }, {
    key: "update",
    value: function update(n, t, e) {}
  }, {
    key: "setSize",
    value: function setSize(n, t) {}
  }, {
    key: "initialize",
    value: function initialize(n, t, e) {}
  }, {
    key: "dispose",
    value: function dispose() {
      for (var _i126 = 0, _Object$keys10 = Object.keys(this); _i126 < _Object$keys10.length; _i126++) {
        var _n13 = _Object$keys10[_i126];
        var t = this[_n13];
        if (t !== null && typeof t.dispose == "function") {
          if (t instanceof vi || t === this.renderer) continue;
          this[_n13].dispose();
        }
      }
    }
  }]);
  return ko;
}(ir);
function NR(n, t, e) {
  var _iterator83 = _createForOfIteratorHelper(t),
    _step83;
  try {
    for (_iterator83.s(); !(_step83 = _iterator83.n()).done;) {
      var r = _step83.value;
      var _i127 = "$1" + n + r.charAt(0).toUpperCase() + r.slice(1),
        s = new RegExp("([^\\.])(\\b" + r + "\\b)", "g");
      var _iterator84 = _createForOfIteratorHelper(e.entries()),
        _step84;
      try {
        for (_iterator84.s(); !(_step84 = _iterator84.n()).done;) {
          var o = _step84.value;
          o[1] !== null && e.set(o[0], o[1].replace(s, _i127));
        }
      } catch (err) {
        _iterator84.e(err);
      } finally {
        _iterator84.f();
      }
    }
  } catch (err) {
    _iterator83.e(err);
  } finally {
    _iterator83.f();
  }
}
function FX(n, t, e, r, i, s, o) {
  var a = new Map([["fragment", t.getFragmentShader()], ["vertex", t.getVertexShader()]]),
    l = a.get("fragment") !== void 0 && /mainImage/.test(a.get("fragment")),
    u = a.get("fragment") !== void 0 && /mainUv/.test(a.get("fragment")),
    c = [],
    d = [],
    h = !1,
    f = !1;
  if (a.get("fragment") === void 0) console.error("Missing fragment shader", t);else if (u && (o & Fo.CONVOLUTION) !== 0) console.error("Effects that transform UV coordinates are incompatible with convolution effects", t);else if (!l && !u) console.error("The fragment shader contains neither a mainImage nor a mainUv function", t);else {
    var p = /(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,
      m = v_.Section;
    if (u) {
      var y = "\t".concat(n, "MainUv(UV);\n");
      e.set(m.FRAGMENT_MAIN_UV, e.get(m.FRAGMENT_MAIN_UV) + y), h = !0;
    }
    if (a.get("vertex") !== null && /mainSupport/.test(a.get("vertex"))) {
      var _y46 = "\t".concat(n, "MainSupport(");
      _y46 += /mainSupport *\([\w\s]*?uv\s*?\)/.test(a.get("vertex")) ? "vUv);\n" : ");\n", e.set(m.VERTEX_MAIN_SUPPORT, e.get(m.VERTEX_MAIN_SUPPORT) + _y46), c = c.concat(_toConsumableArray(a.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)).map(function (v) {
        return v[1];
      })), d = d.concat(c).concat(_toConsumableArray(a.get("vertex").matchAll(p)).map(function (v) {
        return v[1];
      }));
    }
    d = d.concat(_toConsumableArray(a.get("fragment").matchAll(p)).map(function (y) {
      return y[1];
    })), d = d.concat(_toConsumableArray(t.defines.keys()).map(function (y) {
      return y.replace(/\([\w\s,]*\)/g, "");
    })), d = d.concat(_toConsumableArray(t.uniforms.keys())), t.uniforms.forEach(function (y, v) {
      return s.set(n + v.charAt(0).toUpperCase() + v.slice(1), y);
    }), t.defines.forEach(function (y, v) {
      return i.set(n + v.charAt(0).toUpperCase() + v.slice(1), y);
    }), NR(n, d, i), NR(n, d, a);
    var g = t.blendMode;
    if (r.set(g.blendFunction, g), l) {
      var _y47 = /MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,
        v = "".concat(n, "MainImage(color0, UV, ");
      (o & Fo.DEPTH) !== 0 && _y47.test(a.get("fragment")) && (v += "depth, ", f = !0), v += "color1);\n\t";
      var x = n + "BlendOpacity";
      s.set(x, g.opacity), v += "color0 = blend".concat(g.blendFunction, "(color0, color1, ").concat(x, ");\n\n\t"), e.set(m.FRAGMENT_MAIN_IMAGE, e.get(m.FRAGMENT_MAIN_IMAGE) + v), v = "uniform float ".concat(x, ";\n\n"), e.set(m.FRAGMENT_HEAD, e.get(m.FRAGMENT_HEAD) + v);
    }
    e.set(m.FRAGMENT_HEAD, e.get(m.FRAGMENT_HEAD) + a.get("fragment") + "\n"), a.get("vertex") !== null && e.set(m.VERTEX_HEAD, e.get(m.VERTEX_HEAD) + a.get("vertex") + "\n");
  }
  return {
    varyings: c,
    transformedUv: h,
    readDepth: f
  };
}
var Qc = /*#__PURE__*/function (_hi6) {
    _inherits(Qc, _hi6);
    var _super236 = _createSuper(Qc);
    function Qc(n) {
      var _this244;
      _classCallCheck(this, Qc);
      for (var _len7 = arguments.length, t = new Array(_len7 > 1 ? _len7 - 1 : 0), _key7 = 1; _key7 < _len7; _key7++) {
        t[_key7 - 1] = arguments[_key7];
      }
      _this244 = _super236.call(this, "EffectPass"), _this244.fullscreenMaterial = new v_(null, null, null, n), _this244.effects = t.sort(function (e, r) {
        return r.attributes - e.attributes;
      }), _this244.skipRendering = !1, _this244.uniformCount = 0, _this244.varyingCount = 0, _this244.minTime = 1, _this244.maxTime = Number.POSITIVE_INFINITY;
      return _this244;
    }
    _createClass(Qc, [{
      key: "encodeOutput",
      get: function get() {
        return this.fullscreenMaterial.encodeOutput;
      },
      set: function set(n) {
        this.fullscreenMaterial.encodeOutput = n;
      }
    }, {
      key: "dithering",
      get: function get() {
        return this.fullscreenMaterial.dithering;
      },
      set: function set(n) {
        var t = this.fullscreenMaterial;
        t.dithering = n, t.needsUpdate = !0;
      }
    }, {
      key: "verifyResources",
      value: function verifyResources() {
        var n = this.renderer.capabilities,
          t = Math.min(n.maxFragmentUniforms, n.maxVertexUniforms);
        this.uniformCount > t && console.warn("The current rendering context doesn't support more than " + t + " uniforms, but " + this.uniformCount + " were defined"), t = n.maxVaryings, this.varyingCount > t && console.warn("The current rendering context doesn't support more than " + t + " varyings, but " + this.varyingCount + " were defined");
      }
    }, {
      key: "updateMaterial",
      value: function updateMaterial() {
        var n = v_.Section,
          t = new Map([[n.FRAGMENT_HEAD, ""], [n.FRAGMENT_MAIN_UV, ""], [n.FRAGMENT_MAIN_IMAGE, ""], [n.VERTEX_HEAD, ""], [n.VERTEX_MAIN_SUPPORT, ""]]),
          e = new Map(),
          r = new Map(),
          i = new Map(),
          s = new Set(),
          o = 0,
          a = 0,
          l = 0,
          u = !1,
          c = !1;
        var _iterator85 = _createForOfIteratorHelper(this.effects),
          _step85;
        try {
          for (_iterator85.s(); !(_step85 = _iterator85.n()).done;) {
            var _h80 = _step85.value;
            if (_h80.blendMode.blendFunction === yt.SKIP) l |= _h80.getAttributes() & Fo.DEPTH;else if ((l & _h80.getAttributes() & Fo.CONVOLUTION) !== 0) console.error("Convolution effects cannot be merged", _h80);else {
              l |= _h80.getAttributes();
              var f = "e" + o++,
                p = FX(f, _h80, t, e, r, i, l);
              if (a += p.varyings.length, u = u || p.transformedUv, c = c || p.readDepth, _h80.extensions !== null) {
                var _iterator87 = _createForOfIteratorHelper(_h80.extensions),
                  _step87;
                try {
                  for (_iterator87.s(); !(_step87 = _iterator87.n()).done;) {
                    var m = _step87.value;
                    s.add(m);
                  }
                } catch (err) {
                  _iterator87.e(err);
                } finally {
                  _iterator87.f();
                }
              }
            }
          }
        } catch (err) {
          _iterator85.e(err);
        } finally {
          _iterator85.f();
        }
        var d = /\bblend\b/g;
        var _iterator86 = _createForOfIteratorHelper(e.values()),
          _step86;
        try {
          for (_iterator86.s(); !(_step86 = _iterator86.n()).done;) {
            var _h81 = _step86.value;
            var _f81 = _h81.getShaderCode().replace(d, "blend".concat(_h81.blendFunction));
            t.set(n.FRAGMENT_HEAD, t.get(n.FRAGMENT_HEAD) + _f81 + "\n");
          }
        } catch (err) {
          _iterator86.e(err);
        } finally {
          _iterator86.f();
        }
        if ((l & Fo.DEPTH) !== 0) {
          if (c) {
            var _h78 = "float depth = readDepth(UV);\n\n\t";
            t.set(n.FRAGMENT_MAIN_IMAGE, _h78 + t.get(n.FRAGMENT_MAIN_IMAGE));
          }
          this.needsDepthTexture = this.getDepthTexture() === null;
        } else this.needsDepthTexture = !1;
        if (u) {
          var _h79 = "vec2 transformedUv = vUv;\n";
          t.set(n.FRAGMENT_MAIN_UV, _h79 + t.get(n.FRAGMENT_MAIN_UV)), r.set("UV", "transformedUv");
        } else r.set("UV", "vUv");
        t.forEach(function (h, f, p) {
          return p.set(f, h.trim().replace(/^#/, "\n#"));
        }), this.uniformCount = i.size, this.varyingCount = a, this.skipRendering = o === 0, this.needsSwap = !this.skipRendering, this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(i).setDefines(r);
      }
    }, {
      key: "recompile",
      value: function recompile() {
        this.updateMaterial(), this.verifyResources();
      }
    }, {
      key: "getDepthTexture",
      value: function getDepthTexture() {
        return this.fullscreenMaterial.depthBuffer;
      }
    }, {
      key: "setDepthTexture",
      value: function setDepthTexture(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.fullscreenMaterial.depthBuffer = n, this.fullscreenMaterial.depthPacking = t;
        var _iterator88 = _createForOfIteratorHelper(this.effects),
          _step88;
        try {
          for (_iterator88.s(); !(_step88 = _iterator88.n()).done;) {
            var e = _step88.value;
            e.setDepthTexture(n, t);
          }
        } catch (err) {
          _iterator88.e(err);
        } finally {
          _iterator88.f();
        }
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var _iterator89 = _createForOfIteratorHelper(this.effects),
          _step89;
        try {
          for (_iterator89.s(); !(_step89 = _iterator89.n()).done;) {
            var _s58 = _step89.value;
            _s58.update(n, t, r);
          }
        } catch (err) {
          _iterator89.e(err);
        } finally {
          _iterator89.f();
        }
        if (!this.skipRendering || this.renderToScreen) {
          var s = this.fullscreenMaterial;
          s.inputBuffer = t.texture, s.time += r, n.setRenderTarget(this.renderToScreen ? null : e), n.render(this.scene, this.camera);
        }
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.fullscreenMaterial.setSize(n, t);
        var _iterator90 = _createForOfIteratorHelper(this.effects),
          _step90;
        try {
          for (_iterator90.s(); !(_step90 = _iterator90.n()).done;) {
            var e = _step90.value;
            e.setSize(n, t);
          }
        } catch (err) {
          _iterator90.e(err);
        } finally {
          _iterator90.f();
        }
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        var _this245 = this;
        this.renderer = n;
        var _iterator91 = _createForOfIteratorHelper(this.effects),
          _step91;
        try {
          for (_iterator91.s(); !(_step91 = _iterator91.n()).done;) {
            var r = _step91.value;
            r.initialize(n, t, e), r.addEventListener("change", function (i) {
              return _this245.handleEvent(i);
            });
          }
        } catch (err) {
          _iterator91.e(err);
        } finally {
          _iterator91.f();
        }
        this.updateMaterial(), this.verifyResources(), e !== void 0 && e !== br && (this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1");
      }
    }, {
      key: "dispose",
      value: function dispose() {
        _get(_getPrototypeOf(Qc.prototype), "dispose", this).call(this);
        var _iterator92 = _createForOfIteratorHelper(this.effects),
          _step92;
        try {
          for (_iterator92.s(); !(_step92 = _iterator92.n()).done;) {
            var _n14 = _step92.value;
            _n14.dispose();
          }
        } catch (err) {
          _iterator92.e(err);
        } finally {
          _iterator92.f();
        }
      }
    }, {
      key: "handleEvent",
      value: function handleEvent(n) {
        switch (n.type) {
          case "change":
            this.recompile();
            break;
        }
      }
    }]);
    return Qc;
  }(hi),
  kX = [new Float32Array([0, 0]), new Float32Array([0, 1, 1]), new Float32Array([0, 1, 1, 2]), new Float32Array([0, 1, 2, 2, 3]), new Float32Array([0, 1, 2, 3, 4, 4, 5]), new Float32Array([0, 1, 2, 3, 4, 5, 7, 8, 9, 10])],
  ux = /*#__PURE__*/function (_hi7) {
    _inherits(ux, _hi7);
    var _super237 = _createSuper(ux);
    function ux() {
      var _this246;
      var _ref37 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref37$resolutionScal = _ref37.resolutionScale,
        n = _ref37$resolutionScal === void 0 ? .5 : _ref37$resolutionScal,
        _ref37$width = _ref37.width,
        t = _ref37$width === void 0 ? Nn.AUTO_SIZE : _ref37$width,
        _ref37$height = _ref37.height,
        e = _ref37$height === void 0 ? Nn.AUTO_SIZE : _ref37$height,
        _ref37$kernelSize = _ref37.kernelSize,
        r = _ref37$kernelSize === void 0 ? Lm.LARGE : _ref37$kernelSize;
      _classCallCheck(this, ux);
      _this246 = _super237.call(this, "KawaseBlurPass"), _this246.renderTargetA = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this246.renderTargetA.texture.name = "Blur.Target.A", _this246.renderTargetB = _this246.renderTargetA.clone(), _this246.renderTargetB.texture.name = "Blur.Target.B";
      var i = _this246.resolution = new Nn(_assertThisInitialized(_this246), t, e, n);
      i.addEventListener("change", function (s) {
        return _this246.setSize(i.baseWidth, i.baseHeight);
      }), _this246.blurMaterial = new LR(), _this246.ditheredBlurMaterial = new LR(), _this246.ditheredBlurMaterial.uniforms.scale = _this246.blurMaterial.uniforms.scale, _this246.ditheredBlurMaterial.dithering = !0, _this246.dithering = !1, _this246.kernelSize = r;
      return _this246;
    }
    _createClass(ux, [{
      key: "getResolution",
      value: function getResolution() {
        return this.resolution;
      }
    }, {
      key: "width",
      get: function get() {
        return this.resolution.width;
      },
      set: function set(n) {
        this.resolution.preferredWidth = n;
      }
    }, {
      key: "height",
      get: function get() {
        return this.resolution.height;
      },
      set: function set(n) {
        this.resolution.preferredHeight = n;
      }
    }, {
      key: "scale",
      get: function get() {
        return this.blurMaterial.scale;
      },
      set: function set(n) {
        this.blurMaterial.scale = n;
      }
    }, {
      key: "getScale",
      value: function getScale() {
        return this.blurMaterial.scale;
      }
    }, {
      key: "setScale",
      value: function setScale(n) {
        this.blurMaterial.scale = n;
      }
    }, {
      key: "getKernelSize",
      value: function getKernelSize() {
        return this.kernelSize;
      }
    }, {
      key: "setKernelSize",
      value: function setKernelSize(n) {
        this.kernelSize = n;
      }
    }, {
      key: "getResolutionScale",
      value: function getResolutionScale() {
        return this.resolution.scale;
      }
    }, {
      key: "setResolutionScale",
      value: function setResolutionScale(n) {
        this.resolution.scale = n;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = this.scene,
          o = this.camera,
          a = this.renderTargetA,
          l = this.renderTargetB,
          u = kX[this.kernelSize],
          c = this.blurMaterial,
          d = t,
          h,
          f;
        for (this.fullscreenMaterial = c, h = 0, f = u.length - 1; h < f; ++h) {
          var p = (h & 1) === 0 ? a : l;
          c.kernel = u[h], c.inputBuffer = d.texture, n.setRenderTarget(p), n.render(s, o), d = p;
        }
        this.dithering && (c = this.ditheredBlurMaterial, this.fullscreenMaterial = c), c.kernel = u[h], c.inputBuffer = d.texture, n.setRenderTarget(this.renderToScreen ? null : e), n.render(s, o);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.resolution;
        e.setBaseSize(n, t);
        var r = e.width,
          i = e.height;
        this.renderTargetA.setSize(r, i), this.renderTargetB.setSize(r, i), this.blurMaterial.setSize(r, i), this.ditheredBlurMaterial.setSize(r, i);
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        e !== void 0 && (this.renderTargetA.texture.type = e, this.renderTargetB.texture.type = e, e !== br ? (this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1", this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1") : n.outputEncoding === tt && (this.renderTargetA.texture.encoding = tt, this.renderTargetB.texture.encoding = tt));
      }
    }], [{
      key: "AUTO_SIZE",
      get: function get() {
        return Nn.AUTO_SIZE;
      }
    }]);
    return ux;
  }(hi);
var zX = /*#__PURE__*/function (_hi8) {
    _inherits(zX, _hi8);
    var _super238 = _createSuper(zX);
    function zX() {
      var _this247;
      var _ref38 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref38$width = _ref38.width,
        n = _ref38$width === void 0 ? Nn.AUTO_SIZE : _ref38$width,
        _ref38$height = _ref38.height,
        t = _ref38$height === void 0 ? Nn.AUTO_SIZE : _ref38$height,
        e = _ref38.renderTarget,
        r = _ref38.luminanceRange,
        i = _ref38.colorOutput;
      _classCallCheck(this, zX);
      _this247 = _super238.call(this, "LuminancePass"), _this247.fullscreenMaterial = new lX(i, r), _this247.needsSwap = !1, _this247.renderTarget = e, _this247.renderTarget === void 0 && (_this247.renderTarget = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this247.renderTarget.texture.name = "LuminancePass.Target", _this247.renderTarget.texture.generateMipmaps = !1);
      var s = _this247.resolution = new Nn(_assertThisInitialized(_this247), n, t);
      s.addEventListener("change", function (o) {
        return _this247.setSize(s.baseWidth, s.baseHeight);
      });
      return _this247;
    }
    _createClass(zX, [{
      key: "texture",
      get: function get() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getTexture",
      value: function getTexture() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getResolution",
      value: function getResolution() {
        return this.resolution;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = this.fullscreenMaterial;
        s.inputBuffer = t.texture, n.setRenderTarget(this.renderToScreen ? null : this.renderTarget), n.render(this.scene, this.camera);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.resolution;
        e.setBaseSize(n, t), this.renderTarget.setSize(e.width, e.height);
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        e !== void 0 && e !== br && (this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1");
      }
    }]);
    return zX;
  }(hi),
  GR = /*#__PURE__*/function (_hi9) {
    _inherits(GR, _hi9);
    var _super239 = _createSuper(GR);
    function GR(n, t) {
      var _this248;
      _classCallCheck(this, GR);
      _this248 = _super239.call(this, "MaskPass", n, t), _this248.needsSwap = !1, _this248.clearPass = new x_(!1, !1, !0), _this248.inverse = !1;
      return _this248;
    }
    _createClass(GR, [{
      key: "inverted",
      get: function get() {
        return this.inverse;
      },
      set: function set(n) {
        this.inverse = n;
      }
    }, {
      key: "clear",
      get: function get() {
        return this.clearPass.enabled;
      },
      set: function set(n) {
        this.clearPass.enabled = n;
      }
    }, {
      key: "getClearPass",
      value: function getClearPass() {
        return this.clearPass;
      }
    }, {
      key: "isInverted",
      value: function isInverted() {
        return this.inverted;
      }
    }, {
      key: "setInverted",
      value: function setInverted(n) {
        this.inverted = n;
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        var s = n.getContext(),
          o = n.state.buffers,
          a = this.scene,
          l = this.camera,
          u = this.clearPass,
          c = this.inverted ? 0 : 1,
          d = 1 - c;
        o.color.setMask(!1), o.depth.setMask(!1), o.color.setLocked(!0), o.depth.setLocked(!0), o.stencil.setTest(!0), o.stencil.setOp(s.REPLACE, s.REPLACE, s.REPLACE), o.stencil.setFunc(s.ALWAYS, c, 4294967295), o.stencil.setClear(d), o.stencil.setLocked(!0), this.clearPass.enabled && (this.renderToScreen ? u.render(n, null) : (u.render(n, t), u.render(n, e))), this.renderToScreen ? (n.setRenderTarget(null), n.render(a, l)) : (n.setRenderTarget(t), n.render(a, l), n.setRenderTarget(e), n.render(a, l)), o.color.setLocked(!1), o.depth.setLocked(!1), o.stencil.setLocked(!1), o.stencil.setFunc(s.EQUAL, 1, 4294967295), o.stencil.setOp(s.KEEP, s.KEEP, s.KEEP), o.stencil.setLocked(!0);
      }
    }]);
    return GR;
  }(hi);
var Bn = /*#__PURE__*/function (_hi10) {
    _inherits(Bn, _hi10);
    var _super240 = _createSuper(Bn);
    function Bn(n) {
      var _this249;
      var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "inputBuffer";
      _classCallCheck(this, Bn);
      _this249 = _super240.call(this, "ShaderPass"), _this249.fullscreenMaterial = n, _this249.inputBufferUniform = null, _this249.setInput(t);
      return _this249;
    }
    _createClass(Bn, [{
      key: "setInput",
      value: function setInput(n) {
        if (this.inputBufferUniform = null, this.fullscreenMaterial !== null) {
          var t = this.fullscreenMaterial.uniforms;
          t !== void 0 && t[n] !== void 0 && (this.inputBufferUniform = t[n]);
        }
      }
    }, {
      key: "render",
      value: function render(n, t, e, r, i) {
        this.inputBufferUniform !== null && t !== null && (this.inputBufferUniform.value = t.texture), n.setRenderTarget(this.renderToScreen ? null : e), n.render(this.scene, this.camera);
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        e !== void 0 && e !== br && (this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH = "1");
      }
    }]);
    return Bn;
  }(hi),
  m_ = 1 / 1e3,
  VX = 1e3,
  jR = /*#__PURE__*/function () {
    function jR() {
      _classCallCheck(this, jR);
      this.previousTime = 0, this.currentTime = 0, this.delta = 0, this.fixedDelta = 1e3 / 60, this.elapsed = 0, this.timescale = 1, this.fixedDeltaEnabled = !1, this.autoReset = !1;
    }
    _createClass(jR, [{
      key: "setFixedDeltaEnabled",
      value: function setFixedDeltaEnabled(n) {
        return this.fixedDeltaEnabled = n, this;
      }
    }, {
      key: "isAutoResetEnabled",
      value: function isAutoResetEnabled(n) {
        return this.autoReset;
      }
    }, {
      key: "setAutoResetEnabled",
      value: function setAutoResetEnabled(n) {
        return (typeof document === "undefined" ? "undefined" : _typeof(document)) < "u" && document.hidden !== void 0 && (n ? document.addEventListener("visibilitychange", this) : document.removeEventListener("visibilitychange", this), this.autoReset = n), this;
      }
    }, {
      key: "getDelta",
      value: function getDelta() {
        return this.delta * m_;
      }
    }, {
      key: "getFixedDelta",
      value: function getFixedDelta() {
        return this.fixedDelta * m_;
      }
    }, {
      key: "setFixedDelta",
      value: function setFixedDelta(n) {
        return this.fixedDelta = n * VX, this;
      }
    }, {
      key: "getElapsed",
      value: function getElapsed() {
        return this.elapsed * m_;
      }
    }, {
      key: "getTimescale",
      value: function getTimescale() {
        return this.timescale;
      }
    }, {
      key: "setTimescale",
      value: function setTimescale(n) {
        return this.timescale = n, this;
      }
    }, {
      key: "update",
      value: function update(n) {
        return this.fixedDeltaEnabled ? this.delta = this.fixedDelta : (this.previousTime = this.currentTime, this.currentTime = n !== void 0 ? n : performance.now(), this.delta = this.currentTime - this.previousTime), this.delta *= this.timescale, this.elapsed += this.delta, this;
      }
    }, {
      key: "reset",
      value: function reset() {
        return this.delta = 0, this.elapsed = 0, this.currentTime = performance.now(), this;
      }
    }, {
      key: "handleEvent",
      value: function handleEvent(n) {
        document.hidden || (this.currentTime = performance.now());
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.setAutoResetEnabled(!1);
      }
    }]);
    return jR;
  }();
var Lm = {
  VERY_SMALL: 0,
  SMALL: 1,
  MEDIUM: 2,
  LARGE: 3,
  VERY_LARGE: 4,
  HUGE: 5
};
var UX = "#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",
  HR = /*#__PURE__*/function (_ko) {
    _inherits(HR, _ko);
    var _super241 = _createSuper(HR);
    function HR() {
      var _this250;
      var _ref39 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref39$blendFunction = _ref39.blendFunction,
        n = _ref39$blendFunction === void 0 ? yt.SCREEN : _ref39$blendFunction,
        _ref39$luminanceThres = _ref39.luminanceThreshold,
        t = _ref39$luminanceThres === void 0 ? .9 : _ref39$luminanceThres,
        _ref39$luminanceSmoot = _ref39.luminanceSmoothing,
        e = _ref39$luminanceSmoot === void 0 ? .025 : _ref39$luminanceSmoot,
        _ref39$resolutionScal = _ref39.resolutionScale,
        r = _ref39$resolutionScal === void 0 ? .5 : _ref39$resolutionScal,
        _ref39$intensity = _ref39.intensity,
        i = _ref39$intensity === void 0 ? 1 : _ref39$intensity,
        _ref39$width = _ref39.width,
        s = _ref39$width === void 0 ? Nn.AUTO_SIZE : _ref39$width,
        _ref39$height = _ref39.height,
        o = _ref39$height === void 0 ? Nn.AUTO_SIZE : _ref39$height,
        _ref39$kernelSize = _ref39.kernelSize,
        a = _ref39$kernelSize === void 0 ? Lm.LARGE : _ref39$kernelSize;
      _classCallCheck(this, HR);
      _this250 = _super241.call(this, "BloomEffect", UX, {
        blendFunction: n,
        uniforms: new Map([["map", new se(null)], ["intensity", new se(i)]])
      }), _this250.renderTarget = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this250.renderTarget.texture.name = "Bloom.Target", _this250.renderTarget.texture.generateMipmaps = !1, _this250.uniforms.get("map").value = _this250.renderTarget.texture, _this250.luminancePass = new zX({
        renderTarget: _this250.renderTarget,
        colorOutput: !0
      }), _this250.luminanceMaterial.threshold = t, _this250.luminanceMaterial.smoothingFactor = e, _this250.blurPass = new ux({
        resolutionScale: r,
        width: s,
        height: o,
        kernelSize: a
      });
      var l = _this250.blurPass.getResolution();
      l.addEventListener("change", function (u) {
        return _this250.setSize(l.baseWidth, l.baseHeight);
      });
      return _this250;
    }
    _createClass(HR, [{
      key: "texture",
      get: function get() {
        return this.renderTarget.texture;
      }
    }, {
      key: "getTexture",
      value: function getTexture() {
        return this.renderTarget.texture;
      }
    }, {
      key: "resolution",
      get: function get() {
        return this.blurPass.resolution;
      }
    }, {
      key: "getResolution",
      value: function getResolution() {
        return this.blurPass.resolution;
      }
    }, {
      key: "getBlurPass",
      value: function getBlurPass() {
        return this.blurPass;
      }
    }, {
      key: "getLuminancePass",
      value: function getLuminancePass() {
        return this.luminancePass;
      }
    }, {
      key: "luminanceMaterial",
      get: function get() {
        return this.luminancePass.fullscreenMaterial;
      }
    }, {
      key: "getLuminanceMaterial",
      value: function getLuminanceMaterial() {
        return this.luminancePass.fullscreenMaterial;
      }
    }, {
      key: "width",
      get: function get() {
        return this.resolution.width;
      },
      set: function set(n) {
        this.resolution.preferredWidth = n;
      }
    }, {
      key: "height",
      get: function get() {
        return this.resolution.height;
      },
      set: function set(n) {
        this.resolution.preferredHeight = n;
      }
    }, {
      key: "dithering",
      get: function get() {
        return this.blurPass.dithering;
      },
      set: function set(n) {
        this.blurPass.dithering = n;
      }
    }, {
      key: "kernelSize",
      get: function get() {
        return this.blurPass.kernelSize;
      },
      set: function set(n) {
        this.blurPass.kernelSize = n;
      }
    }, {
      key: "distinction",
      get: function get() {
        return console.warn(this.name, "distinction was removed"), 1;
      },
      set: function set(n) {
        console.warn(this.name, "distinction was removed");
      }
    }, {
      key: "intensity",
      get: function get() {
        return this.uniforms.get("intensity").value;
      },
      set: function set(n) {
        this.uniforms.get("intensity").value = n;
      }
    }, {
      key: "getIntensity",
      value: function getIntensity() {
        return this.intensity;
      }
    }, {
      key: "setIntensity",
      value: function setIntensity(n) {
        this.intensity = n;
      }
    }, {
      key: "getResolutionScale",
      value: function getResolutionScale() {
        return this.resolution.scale;
      }
    }, {
      key: "setResolutionScale",
      value: function setResolutionScale(n) {
        this.resolution.scale = n;
      }
    }, {
      key: "update",
      value: function update(n, t, e) {
        var r = this.renderTarget;
        this.luminancePass.enabled ? (this.luminancePass.render(n, t, r), this.blurPass.render(n, r, r)) : this.blurPass.render(n, t, r);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.resolution;
        e.setBaseSize(n, t), this.renderTarget.setSize(e.width, e.height), this.luminancePass.resolution.copy(e);
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        this.blurPass.initialize(n, t, e), e !== void 0 && (this.renderTarget.texture.type = e, n.outputEncoding === tt && (this.renderTarget.texture.encoding = tt));
      }
    }]);
    return HR;
  }(ko);
var GX = "uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",
  WR = /*#__PURE__*/function (_ko2) {
    _inherits(WR, _ko2);
    var _super242 = _createSuper(WR);
    function WR() {
      var _ref40 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref40$blendFunction = _ref40.blendFunction,
        n = _ref40$blendFunction === void 0 ? yt.NORMAL : _ref40$blendFunction,
        _ref40$brightness = _ref40.brightness,
        t = _ref40$brightness === void 0 ? 0 : _ref40$brightness,
        _ref40$contrast = _ref40.contrast,
        e = _ref40$contrast === void 0 ? 0 : _ref40$contrast;
      _classCallCheck(this, WR);
      return _super242.call(this, "BrightnessContrastEffect", GX, {
        blendFunction: n,
        uniforms: new Map([["brightness", new se(t)], ["contrast", new se(e)]])
      });
    }
    _createClass(WR, [{
      key: "brightness",
      get: function get() {
        return this.uniforms.get("brightness").value;
      },
      set: function set(n) {
        this.uniforms.get("brightness").value = n;
      }
    }, {
      key: "getBrightness",
      value: function getBrightness(n) {
        return this.brightness;
      }
    }, {
      key: "setBrightness",
      value: function setBrightness(n) {
        this.brightness = n;
      }
    }, {
      key: "contrast",
      get: function get() {
        return this.uniforms.get("contrast").value;
      },
      set: function set(n) {
        this.uniforms.get("contrast").value = n;
      }
    }, {
      key: "getContrast",
      value: function getContrast(n) {
        return this.contrast;
      }
    }, {
      key: "setContrast",
      value: function setContrast(n) {
        this.contrast = n;
      }
    }]);
    return WR;
  }(ko),
  jX = "void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",
  qR = /*#__PURE__*/function (_ko3) {
    _inherits(qR, _ko3);
    var _super243 = _createSuper(qR);
    function qR() {
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : yt.NORMAL;
      _classCallCheck(this, qR);
      return _super243.call(this, "ColorAverageEffect", jX, {
        blendFunction: n
      });
    }
    return _createClass(qR);
  }(ko);
var HX = "varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",
  WX = "uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",
  YR = /*#__PURE__*/function (_ko4) {
    _inherits(YR, _ko4);
    var _super244 = _createSuper(YR);
    function YR() {
      var _ref41 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref41$blendFunction = _ref41.blendFunction,
        n = _ref41$blendFunction === void 0 ? yt.NORMAL : _ref41$blendFunction,
        _ref41$offset = _ref41.offset,
        t = _ref41$offset === void 0 ? new N(.001, 5e-4) : _ref41$offset;
      _classCallCheck(this, YR);
      return _super244.call(this, "ChromaticAberrationEffect", HX, {
        vertexShader: WX,
        blendFunction: n,
        attributes: Fo.CONVOLUTION,
        uniforms: new Map([["offset", new se(t)]])
      });
    }
    _createClass(YR, [{
      key: "offset",
      get: function get() {
        return this.uniforms.get("offset").value;
      },
      set: function set(n) {
        this.uniforms.get("offset").value = n;
      }
    }, {
      key: "getOffset",
      value: function getOffset() {
        return this.offset;
      }
    }, {
      key: "setOffset",
      value: function setOffset(n) {
        this.offset = n;
      }
    }]);
    return YR;
  }(ko);
var qX = "#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",
  XR = /*#__PURE__*/function (_ko5) {
    _inherits(XR, _ko5);
    var _super245 = _createSuper(XR);
    function XR(n) {
      var _this251;
      var _ref42 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        _ref42$blendFunction = _ref42.blendFunction,
        t = _ref42$blendFunction === void 0 ? yt.NORMAL : _ref42$blendFunction,
        e = _ref42.worldFocusDistance,
        r = _ref42.worldFocusRange,
        _ref42$focusDistance = _ref42.focusDistance,
        i = _ref42$focusDistance === void 0 ? 0 : _ref42$focusDistance,
        _ref42$focalLength = _ref42.focalLength,
        s = _ref42$focalLength === void 0 ? .1 : _ref42$focalLength,
        _ref42$focusRange = _ref42.focusRange,
        o = _ref42$focusRange === void 0 ? s : _ref42$focusRange,
        _ref42$bokehScale = _ref42.bokehScale,
        a = _ref42$bokehScale === void 0 ? 1 : _ref42$bokehScale,
        _ref42$width = _ref42.width,
        l = _ref42$width === void 0 ? Nn.AUTO_SIZE : _ref42$width,
        _ref42$height = _ref42.height,
        u = _ref42$height === void 0 ? Nn.AUTO_SIZE : _ref42$height;
      _classCallCheck(this, XR);
      _this251 = _super245.call(this, "DepthOfFieldEffect", qX, {
        blendFunction: t,
        attributes: Fo.DEPTH,
        uniforms: new Map([["nearColorBuffer", new se(null)], ["farColorBuffer", new se(null)], ["nearCoCBuffer", new se(null)], ["scale", new se(1)]])
      }), _this251.camera = n, _this251.renderTarget = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this251.renderTarget.texture.name = "DoF.Intermediate", _this251.renderTarget.texture.generateMipmaps = !1, _this251.renderTargetMasked = _this251.renderTarget.clone(), _this251.renderTargetMasked.texture.name = "DoF.Masked.Far", _this251.renderTargetNear = _this251.renderTarget.clone(), _this251.renderTargetNear.texture.name = "DoF.Bokeh.Near", _this251.uniforms.get("nearColorBuffer").value = _this251.renderTargetNear.texture, _this251.renderTargetFar = _this251.renderTarget.clone(), _this251.renderTargetFar.texture.name = "DoF.Bokeh.Far", _this251.uniforms.get("farColorBuffer").value = _this251.renderTargetFar.texture, _this251.renderTargetCoC = _this251.renderTarget.clone(), _this251.renderTargetCoC.texture.name = "DoF.CoC", _this251.renderTargetCoCBlurred = _this251.renderTargetCoC.clone(), _this251.renderTargetCoCBlurred.texture.name = "DoF.CoC.Blurred", _this251.uniforms.get("nearCoCBuffer").value = _this251.renderTargetCoCBlurred.texture, _this251.cocPass = new Bn(new K7(n));
      var c = _this251.cocMaterial;
      c.focusDistance = i, c.focusRange = o, e !== void 0 && (c.worldFocusDistance = e), r !== void 0 && (c.worldFocusRange = r), _this251.blurPass = new ux({
        kernelSize: Lm.MEDIUM,
        width: l,
        height: u
      });
      var d = _this251.blurPass.getResolution();
      d.addEventListener("change", function (f) {
        return _this251.setSize(d.getBaseWidth(), d.getBaseHeight());
      }), _this251.maskPass = new Bn(new uX(_this251.renderTargetCoC.texture));
      var h = _this251.maskPass.fullscreenMaterial;
      h.maskFunction = VR.MULTIPLY, h.colorChannel = zR.GREEN, _this251.bokehNearBasePass = new Bn(new lx(!1, !0)), _this251.bokehNearBasePass.fullscreenMaterial.cocBuffer = _this251.renderTargetCoCBlurred.texture, _this251.bokehNearFillPass = new Bn(new lx(!0, !0)), _this251.bokehNearFillPass.fullscreenMaterial.cocBuffer = _this251.renderTargetCoCBlurred.texture, _this251.bokehFarBasePass = new Bn(new lx(!1, !1)), _this251.bokehFarBasePass.fullscreenMaterial.cocBuffer = _this251.renderTargetCoC.texture, _this251.bokehFarFillPass = new Bn(new lx(!0, !1)), _this251.bokehFarFillPass.fullscreenMaterial.cocBuffer = _this251.renderTargetCoC.texture, _this251.target = null, _this251.bokehScale = a;
      return _this251;
    }
    _createClass(XR, [{
      key: "cocTexture",
      get: function get() {
        return this.renderTargetCoC.texture;
      }
    }, {
      key: "cocMaterial",
      get: function get() {
        return this.cocPass.fullscreenMaterial;
      }
    }, {
      key: "circleOfConfusionMaterial",
      get: function get() {
        return this.cocMaterial;
      }
    }, {
      key: "getCircleOfConfusionMaterial",
      value: function getCircleOfConfusionMaterial() {
        return this.circleOfConfusionMaterial;
      }
    }, {
      key: "getBlurPass",
      value: function getBlurPass() {
        return this.blurPass;
      }
    }, {
      key: "resolution",
      get: function get() {
        return this.blurPass.getResolution();
      }
    }, {
      key: "getResolution",
      value: function getResolution() {
        return this.blurPass.getResolution();
      }
    }, {
      key: "bokehScale",
      get: function get() {
        return this.uniforms.get("scale").value;
      },
      set: function set(n) {
        var t = [this.bokehNearBasePass, this.bokehNearFillPass, this.bokehFarBasePass, this.bokehFarFillPass];
        for (var _i128 = 0, _t28 = t; _i128 < _t28.length; _i128++) {
          var e = _t28[_i128];
          e.fullscreenMaterial.setScale(n);
        }
        this.maskPass.fullscreenMaterial.setStrength(n), this.uniforms.get("scale").value = n;
      }
    }, {
      key: "getBokehScale",
      value: function getBokehScale() {
        return this.bokehScale;
      }
    }, {
      key: "setBokehScale",
      value: function setBokehScale(n) {
        this.bokehScale = n;
      }
    }, {
      key: "getTarget",
      value: function getTarget() {
        return this.target;
      }
    }, {
      key: "setTarget",
      value: function setTarget(n) {
        this.target = n;
      }
    }, {
      key: "calculateFocusDistance",
      value: function calculateFocusDistance(n) {
        var t = this.camera,
          e = t.position.distanceTo(n);
        return y_(-e, t.near, t.far);
      }
    }, {
      key: "setDepthTexture",
      value: function setDepthTexture(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.circleOfConfusionMaterial.depthBuffer = n, this.circleOfConfusionMaterial.depthPacking = t;
      }
    }, {
      key: "update",
      value: function update(n, t, e) {
        var r = this.renderTarget,
          i = this.renderTargetCoC,
          s = this.renderTargetCoCBlurred,
          o = this.renderTargetMasked;
        if (this.target !== null) {
          var a = this.calculateFocusDistance(this.target);
          this.circleOfConfusionMaterial.focusDistance = a;
        }
        this.cocPass.render(n, null, i), this.blurPass.render(n, i, s), this.maskPass.render(n, t, o), this.bokehFarBasePass.render(n, o, r), this.bokehFarFillPass.render(n, r, this.renderTargetFar), this.bokehNearBasePass.render(n, t, r), this.bokehNearFillPass.render(n, r, this.renderTargetNear);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        var e = this.resolution;
        e.setBaseSize(n, t);
        var r = e.width,
          i = e.height,
          s = [this.cocPass, this.blurPass, this.maskPass, this.bokehNearBasePass, this.bokehNearFillPass, this.bokehFarBasePass, this.bokehFarFillPass];
        s.push(this.renderTargetCoC, this.renderTargetMasked), s.forEach(function (a) {
          return a.setSize(n, t);
        }), s = [this.renderTarget, this.renderTargetNear, this.renderTargetFar, this.renderTargetCoCBlurred], s.forEach(function (a) {
          return a.setSize(r, i);
        }), [this.bokehNearBasePass, this.bokehNearFillPass, this.bokehFarBasePass, this.bokehFarFillPass].forEach(function (a) {
          return a.fullscreenMaterial.setSize(r, i);
        });
      }
    }, {
      key: "initialize",
      value: function initialize(n, t, e) {
        [this.cocPass, this.maskPass, this.bokehNearBasePass, this.bokehNearFillPass, this.bokehFarBasePass, this.bokehFarFillPass].forEach(function (i) {
          return i.initialize(n, t, e);
        }), this.blurPass.initialize(n, t, br), e !== void 0 && (this.renderTarget.texture.type = e, this.renderTargetNear.texture.type = e, this.renderTargetFar.texture.type = e, this.renderTargetMasked.texture.type = e, n.outputEncoding === tt && (this.renderTarget.texture.encoding = tt, this.renderTargetNear.texture.encoding = tt, this.renderTargetFar.texture.encoding = tt, this.renderTargetMasked.texture.encoding = tt));
      }
    }]);
    return XR;
  }(ko);
var w2e = new _(),
  A2e = new te();
var YX = "uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",
  QR = /*#__PURE__*/function (_ko6) {
    _inherits(QR, _ko6);
    var _super246 = _createSuper(QR);
    function QR() {
      var _this252;
      var _ref43 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref43$blendFunction = _ref43.blendFunction,
        n = _ref43$blendFunction === void 0 ? yt.NORMAL : _ref43$blendFunction,
        _ref43$hue = _ref43.hue,
        t = _ref43$hue === void 0 ? 0 : _ref43$hue,
        _ref43$saturation = _ref43.saturation,
        e = _ref43$saturation === void 0 ? 0 : _ref43$saturation;
      _classCallCheck(this, QR);
      _this252 = _super246.call(this, "HueSaturationEffect", YX, {
        blendFunction: n,
        uniforms: new Map([["hue", new se(new _())], ["saturation", new se(e)]])
      }), _this252.hue = t;
      return _this252;
    }
    _createClass(QR, [{
      key: "saturation",
      get: function get() {
        return this.uniforms.get("saturation").value;
      },
      set: function set(n) {
        this.uniforms.get("saturation").value = n;
      }
    }, {
      key: "getSaturation",
      value: function getSaturation() {
        return this.saturation;
      }
    }, {
      key: "setSaturation",
      value: function setSaturation(n) {
        this.saturation = n;
      }
    }, {
      key: "hue",
      get: function get() {
        var n = this.uniforms.get("hue").value;
        return Math.acos((n.x * 3 - 1) / 2);
      },
      set: function set(n) {
        var t = Math.sin(n),
          e = Math.cos(n);
        this.uniforms.get("hue").value.set((2 * e + 1) / 3, (-Math.sqrt(3) * t - e + 1) / 3, (Math.sqrt(3) * t - e + 1) / 3);
      }
    }, {
      key: "getHue",
      value: function getHue() {
        return this.hue;
      }
    }, {
      key: "setHue",
      value: function setHue(n) {
        this.hue = n;
      }
    }]);
    return QR;
  }(ko);
var T2e = new Le();
var XX = "void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",
  KR = /*#__PURE__*/function (_ko7) {
    _inherits(KR, _ko7);
    var _super247 = _createSuper(KR);
    function KR() {
      var _this253;
      var _ref44 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref44$blendFunction = _ref44.blendFunction,
        n = _ref44$blendFunction === void 0 ? yt.SCREEN : _ref44$blendFunction,
        _ref44$premultiply = _ref44.premultiply,
        t = _ref44$premultiply === void 0 ? !1 : _ref44$premultiply;
      _classCallCheck(this, KR);
      _this253 = _super247.call(this, "NoiseEffect", XX, {
        blendFunction: n
      }), _this253.premultiply = t;
      return _this253;
    }
    _createClass(KR, [{
      key: "premultiply",
      get: function get() {
        return this.defines.has("PREMULTIPLY");
      },
      set: function set(n) {
        this.premultiply !== n && (n ? this.defines.set("PREMULTIPLY", "1") : this.defines.delete("PREMULTIPLY"), this.setChanged());
      }
    }, {
      key: "isPremultiplied",
      value: function isPremultiplied() {
        return this.premultiply;
      }
    }, {
      key: "setPremultiplied",
      value: function setPremultiplied(n) {
        this.premultiply = n;
      }
    }]);
    return KR;
  }(ko);
var QX = "uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",
  ZR = /*#__PURE__*/function (_ko8) {
    _inherits(ZR, _ko8);
    var _super248 = _createSuper(ZR);
    function ZR() {
      var _this254;
      var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 30;
      _classCallCheck(this, ZR);
      _this254 = _super248.call(this, "PixelationEffect", QX, {
        uniforms: new Map([["active", new se(!1)], ["d", new se(new N())]])
      }), _this254.resolution = new N(), _this254.d = 0, _this254.granularity = n;
      return _this254;
    }
    _createClass(ZR, [{
      key: "granularity",
      get: function get() {
        return this.d;
      },
      set: function set(n) {
        var t = Math.floor(n);
        t % 2 > 0 && (t += 1), this.d = t, this.uniforms.get("active").value = t > 0, this.setSize(this.resolution.width, this.resolution.height);
      }
    }, {
      key: "getGranularity",
      value: function getGranularity() {
        return this.granularity;
      }
    }, {
      key: "setGranularity",
      value: function setGranularity(n) {
        this.granularity = n;
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.resolution.set(n, t), this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution);
      }
    }]);
    return ZR;
  }(ko);
var P2e = Math.PI * .5,
  D2e = new _(),
  O2e = new _();
var FR = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",
  kR = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",
  KX = "uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",
  ZX = "varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",
  Ia = {
    LOW: 0,
    MEDIUM: 1,
    HIGH: 2,
    ULTRA: 3
  },
  dx = /*#__PURE__*/function (_ko9) {
    _inherits(dx, _ko9);
    var _super249 = _createSuper(dx);
    function dx() {
      var _this255;
      var _ref45 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref45$preset = _ref45.preset,
        n = _ref45$preset === void 0 ? Ia.MEDIUM : _ref45$preset,
        _ref45$edgeDetectionM = _ref45.edgeDetectionMode,
        t = _ref45$edgeDetectionM === void 0 ? af.COLOR : _ref45$edgeDetectionM,
        _ref45$predicationMod = _ref45.predicationMode,
        e = _ref45$predicationMod === void 0 ? iX.DISABLED : _ref45$predicationMod;
      _classCallCheck(this, dx);
      _this255 = _super249.call(this, "SMAAEffect", KX, {
        vertexShader: ZX,
        blendFunction: yt.NORMAL,
        attributes: Fo.CONVOLUTION | Fo.DEPTH,
        uniforms: new Map([["weightMap", new se(null)]])
      });
      var r, i;
      arguments.length > 1 && (r = arguments[0], i = arguments[1], arguments.length > 2 && (n = arguments[2]), arguments.length > 3 && (t = arguments[3])), _this255.renderTargetEdges = new at(1, 1, {
        minFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this255.renderTargetEdges.texture.name = "SMAA.Edges", _this255.renderTargetWeights = _this255.renderTargetEdges.clone(), _this255.renderTargetWeights.texture.name = "SMAA.Weights", _this255.uniforms.get("weightMap").value = _this255.renderTargetWeights.texture, _this255.clearPass = new x_(!0, !1, !1), _this255.clearPass.overrideClearColor = new Le(0), _this255.clearPass.overrideClearAlpha = 1, _this255.edgeDetectionPass = new Bn(new nX()), _this255.edgeDetectionMaterial.edgeDetectionMode = t, _this255.edgeDetectionMaterial.predicationMode = e, _this255.weightsPass = new Bn(new fX());
      var s = new xp();
      s.onLoad = function () {
        var o = new qt(r);
        o.name = "SMAA.Search", o.magFilter = Et, o.minFilter = Et, o.generateMipmaps = !1, o.needsUpdate = !0, o.flipY = !0, _this255.weightsMaterial.searchTexture = o;
        var a = new qt(i);
        a.name = "SMAA.Area", a.magFilter = Qe, a.minFilter = Qe, a.generateMipmaps = !1, a.needsUpdate = !0, a.flipY = !1, _this255.weightsMaterial.areaTexture = a, _this255.dispatchEvent({
          type: "load"
        });
      }, s.itemStart("search"), s.itemStart("area"), r !== void 0 && i !== void 0 ? (s.itemEnd("search"), s.itemEnd("area")) : (typeof Image === "undefined" ? "undefined" : _typeof(Image)) < "u" && (r = new Image(), i = new Image(), r.addEventListener("load", function () {
        return s.itemEnd("search");
      }), i.addEventListener("load", function () {
        return s.itemEnd("area");
      }), r.src = FR, i.src = kR), _this255.applyPreset(n);
      return _this255;
    }
    _createClass(dx, [{
      key: "edgesTexture",
      get: function get() {
        return this.renderTargetEdges.texture;
      }
    }, {
      key: "getEdgesTexture",
      value: function getEdgesTexture() {
        return this.edgesTexture;
      }
    }, {
      key: "weightsTexture",
      get: function get() {
        return this.renderTargetWeights.texture;
      }
    }, {
      key: "getWeightsTexture",
      value: function getWeightsTexture() {
        return this.weightsTexture;
      }
    }, {
      key: "edgeDetectionMaterial",
      get: function get() {
        return this.edgeDetectionPass.fullscreenMaterial;
      }
    }, {
      key: "colorEdgesMaterial",
      get: function get() {
        return this.edgeDetectionMaterial;
      }
    }, {
      key: "getEdgeDetectionMaterial",
      value: function getEdgeDetectionMaterial() {
        return this.edgeDetectionMaterial;
      }
    }, {
      key: "weightsMaterial",
      get: function get() {
        return this.weightsPass.fullscreenMaterial;
      }
    }, {
      key: "getWeightsMaterial",
      value: function getWeightsMaterial() {
        return this.weightsMaterial;
      }
    }, {
      key: "setEdgeDetectionThreshold",
      value: function setEdgeDetectionThreshold(n) {
        this.edgeDetectionMaterial.edgeDetectionThreshold = n;
      }
    }, {
      key: "setOrthogonalSearchSteps",
      value: function setOrthogonalSearchSteps(n) {
        this.weightsMaterial.orthogonalSearchSteps = n;
      }
    }, {
      key: "applyPreset",
      value: function applyPreset(n) {
        var t = this.edgeDetectionMaterial,
          e = this.weightsMaterial;
        switch (n) {
          case Ia.LOW:
            t.edgeDetectionThreshold = .15, e.orthogonalSearchSteps = 4, e.diagonalDetection = !1, e.cornerDetection = !1;
            break;
          case Ia.MEDIUM:
            t.edgeDetectionThreshold = .1, e.orthogonalSearchSteps = 8, e.diagonalDetection = !1, e.cornerDetection = !1;
            break;
          case Ia.HIGH:
            t.edgeDetectionThreshold = .1, e.orthogonalSearchSteps = 16, e.diagonalSearchSteps = 8, e.cornerRounding = 25, e.diagonalDetection = !0, e.cornerDetection = !0;
            break;
          case Ia.ULTRA:
            t.edgeDetectionThreshold = .05, e.orthogonalSearchSteps = 32, e.diagonalSearchSteps = 16, e.cornerRounding = 25, e.diagonalDetection = !0, e.cornerDetection = !0;
            break;
        }
      }
    }, {
      key: "setDepthTexture",
      value: function setDepthTexture(n) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ii;
        this.edgeDetectionMaterial.depthBuffer = n, this.edgeDetectionMaterial.depthPacking = t;
      }
    }, {
      key: "update",
      value: function update(n, t, e) {
        this.clearPass.render(n, this.renderTargetEdges), this.edgeDetectionPass.render(n, t, this.renderTargetEdges), this.weightsPass.render(n, this.renderTargetEdges, this.renderTargetWeights);
      }
    }, {
      key: "setSize",
      value: function setSize(n, t) {
        this.edgeDetectionMaterial.setSize(n, t), this.weightsMaterial.setSize(n, t), this.renderTargetEdges.setSize(n, t), this.renderTargetWeights.setSize(n, t);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this$weightsMaterial = this.weightsMaterial,
          n = _this$weightsMaterial.searchTexture,
          t = _this$weightsMaterial.areaTexture;
        n !== null && t !== null && (n.dispose(), t.dispose()), _get(_getPrototypeOf(dx.prototype), "dispose", this).call(this);
      }
    }], [{
      key: "searchImageDataURL",
      get: function get() {
        return FR;
      }
    }, {
      key: "areaImageDataURL",
      get: function get() {
        return kR;
      }
    }]);
    return dx;
  }(ko);
var JX = "uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",
  cx = {
    DEFAULT: 0,
    ESKIL: 1
  },
  JR = /*#__PURE__*/function (_ko10) {
    _inherits(JR, _ko10);
    var _super250 = _createSuper(JR);
    function JR() {
      var _ref46 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
        _ref46$blendFunction = _ref46.blendFunction,
        n = _ref46$blendFunction === void 0 ? yt.NORMAL : _ref46$blendFunction,
        _ref46$technique = _ref46.technique,
        t = _ref46$technique === void 0 ? cx.DEFAULT : _ref46$technique,
        _ref46$eskil = _ref46.eskil,
        e = _ref46$eskil === void 0 ? !1 : _ref46$eskil,
        _ref46$offset = _ref46.offset,
        r = _ref46$offset === void 0 ? .5 : _ref46$offset,
        _ref46$darkness = _ref46.darkness,
        i = _ref46$darkness === void 0 ? .5 : _ref46$darkness;
      _classCallCheck(this, JR);
      return _super250.call(this, "VignetteEffect", JX, {
        blendFunction: n,
        defines: new Map([["VIGNETTE_TECHNIQUE", t.toFixed(0)]]),
        uniforms: new Map([["offset", new se(r)], ["darkness", new se(i)]])
      });
    }
    _createClass(JR, [{
      key: "technique",
      get: function get() {
        return Number(this.defines.get("VIGNETTE_TECHNIQUE"));
      },
      set: function set(n) {
        this.technique !== n && (this.defines.set("VIGNETTE_TECHNIQUE", n.toFixed(0)), this.setChanged());
      }
    }, {
      key: "eskil",
      get: function get() {
        return this.technique === cx.ESKIL;
      },
      set: function set(n) {
        this.technique = n ? cx.ESKIL : cx.DEFAULT;
      }
    }, {
      key: "getTechnique",
      value: function getTechnique() {
        return this.technique;
      }
    }, {
      key: "setTechnique",
      value: function setTechnique(n) {
        this.technique = n;
      }
    }, {
      key: "offset",
      get: function get() {
        return this.uniforms.get("offset").value;
      },
      set: function set(n) {
        this.uniforms.get("offset").value = n;
      }
    }, {
      key: "getOffset",
      value: function getOffset() {
        return this.offset;
      }
    }, {
      key: "setOffset",
      value: function setOffset(n) {
        this.offset = n;
      }
    }, {
      key: "darkness",
      get: function get() {
        return this.uniforms.get("darkness").value;
      },
      set: function set(n) {
        this.uniforms.get("darkness").value = n;
      }
    }, {
      key: "getDarkness",
      value: function getDarkness() {
        return this.darkness;
      }
    }, {
      key: "setDarkness",
      value: function setDarkness(n) {
        this.darkness = n;
      }
    }]);
    return JR;
  }(ko),
  L2e = [new Float32Array(3), new Float32Array(3)],
  B2e = [new Float32Array(3), new Float32Array(3), new Float32Array(3), new Float32Array(3)],
  N2e = [[new Float32Array([0, 0, 0]), new Float32Array([1, 0, 0]), new Float32Array([1, 1, 0]), new Float32Array([1, 1, 1])], [new Float32Array([0, 0, 0]), new Float32Array([1, 0, 0]), new Float32Array([1, 0, 1]), new Float32Array([1, 1, 1])], [new Float32Array([0, 0, 0]), new Float32Array([0, 0, 1]), new Float32Array([1, 0, 1]), new Float32Array([1, 1, 1])], [new Float32Array([0, 0, 0]), new Float32Array([0, 1, 0]), new Float32Array([1, 1, 0]), new Float32Array([1, 1, 1])], [new Float32Array([0, 0, 0]), new Float32Array([0, 1, 0]), new Float32Array([0, 1, 1]), new Float32Array([1, 1, 1])], [new Float32Array([0, 0, 0]), new Float32Array([0, 0, 1]), new Float32Array([0, 1, 1]), new Float32Array([1, 1, 1])]];
var F2e = [new Float32Array(2), new Float32Array(2)];
var k2e = new Float32Array([0, -.25, .25, -.125, .125, -.375, .375]),
  z2e = [new Float32Array([0, 0]), new Float32Array([.25, -.25]), new Float32Array([-.25, .25]), new Float32Array([.125, -.125]), new Float32Array([-.125, .125])],
  V2e = [new Uint8Array([0, 0]), new Uint8Array([3, 0]), new Uint8Array([0, 3]), new Uint8Array([3, 3]), new Uint8Array([1, 0]), new Uint8Array([4, 0]), new Uint8Array([1, 3]), new Uint8Array([4, 3]), new Uint8Array([0, 1]), new Uint8Array([3, 1]), new Uint8Array([0, 4]), new Uint8Array([3, 4]), new Uint8Array([1, 1]), new Uint8Array([4, 1]), new Uint8Array([1, 4]), new Uint8Array([4, 4])],
  U2e = [new Uint8Array([0, 0]), new Uint8Array([1, 0]), new Uint8Array([0, 2]), new Uint8Array([1, 2]), new Uint8Array([2, 0]), new Uint8Array([3, 0]), new Uint8Array([2, 2]), new Uint8Array([3, 2]), new Uint8Array([0, 1]), new Uint8Array([1, 1]), new Uint8Array([0, 3]), new Uint8Array([1, 3]), new Uint8Array([2, 1]), new Uint8Array([3, 1]), new Uint8Array([2, 3]), new Uint8Array([3, 3])];
var G2e = new Map([[on(0, 0, 0, 0), new Float32Array([0, 0, 0, 0])], [on(0, 0, 0, 1), new Float32Array([0, 0, 0, 1])], [on(0, 0, 1, 0), new Float32Array([0, 0, 1, 0])], [on(0, 0, 1, 1), new Float32Array([0, 0, 1, 1])], [on(0, 1, 0, 0), new Float32Array([0, 1, 0, 0])], [on(0, 1, 0, 1), new Float32Array([0, 1, 0, 1])], [on(0, 1, 1, 0), new Float32Array([0, 1, 1, 0])], [on(0, 1, 1, 1), new Float32Array([0, 1, 1, 1])], [on(1, 0, 0, 0), new Float32Array([1, 0, 0, 0])], [on(1, 0, 0, 1), new Float32Array([1, 0, 0, 1])], [on(1, 0, 1, 0), new Float32Array([1, 0, 1, 0])], [on(1, 0, 1, 1), new Float32Array([1, 0, 1, 1])], [on(1, 1, 0, 0), new Float32Array([1, 1, 0, 0])], [on(1, 1, 0, 1), new Float32Array([1, 1, 0, 1])], [on(1, 1, 1, 0), new Float32Array([1, 1, 1, 0])], [on(1, 1, 1, 1), new Float32Array([1, 1, 1, 1])]]);
function g_(n, t, e) {
  return n + (t - n) * e;
}
function on(n, t, e, r) {
  var i = g_(n, t, .75),
    s = g_(e, r, 1 - .25);
  return g_(i, s, 1 - .125);
}
var Zr = /*#__PURE__*/_createClass(function Zr(t, e) {
  _classCallCheck(this, Zr);
  this.enabled = !1;
  this.effect = new t(e), Object.defineProperty(this, "opacity", {
    enumerable: !0,
    set: function set(r) {
      this.effect.blendMode.opacity.value = r;
    },
    get: function get() {
      return this.effect.blendMode.opacity.value;
    }
  }), Object.defineProperty(this, "blendFunction", {
    enumerable: !0,
    set: function set(r) {
      this.effect.blendMode.setBlendFunction(Number(r));
    },
    get: function get() {
      return this.effect.blendMode.blendFunction;
    }
  }), this.blendFunction = yt.NORMAL;
});
var lf = /*#__PURE__*/function (_Zr) {
  _inherits(lf, _Zr);
  var _super251 = _createSuper(lf);
  function lf() {
    var _this256;
    _classCallCheck(this, lf);
    _this256 = _super251.call(this, HR), _this256.blendFunction = yt.SCREEN;
    return _this256;
  }
  _createClass(lf, [{
    key: "intensity",
    get: function get() {
      return this.effect.intensity;
    },
    set: function set(t) {
      this.effect.intensity = t;
    }
  }, {
    key: "luminanceThreshold",
    get: function get() {
      return this.effect.luminanceMaterial.threshold;
    },
    set: function set(t) {
      this.effect.luminanceMaterial.threshold = t;
    }
  }, {
    key: "luminanceSmoothing",
    get: function get() {
      return this.effect.luminanceMaterial.smoothing;
    },
    set: function set(t) {
      this.effect.luminanceMaterial.smoothing = t;
    }
  }, {
    key: "blurScale",
    get: function get() {
      return this.effect.blurPass.scale;
    },
    set: function set(t) {
      this.effect.blurPass.scale = t;
    }
  }, {
    key: "kernelSize",
    get: function get() {
      return this.effect.blurPass.kernelSize;
    },
    set: function set(t) {
      this.effect.blurPass.kernelSize = t;
    }
  }]);
  return lf;
}(Zr);
var cf = /*#__PURE__*/function (_Zr2) {
  _inherits(cf, _Zr2);
  var _super252 = _createSuper(cf);
  function cf() {
    _classCallCheck(this, cf);
    return _super252.call(this, WR);
  }
  _createClass(cf, [{
    key: "contrast",
    get: function get() {
      return this.effect.uniforms.get("contrast").value;
    },
    set: function set(t) {
      this.effect.uniforms.get("contrast").value = t;
    }
  }, {
    key: "brightness",
    get: function get() {
      return this.effect.uniforms.get("brightness").value;
    },
    set: function set(t) {
      this.effect.uniforms.get("brightness").value = t;
    }
  }]);
  return cf;
}(Zr);
var uf = /*#__PURE__*/function (_Zr3) {
  _inherits(uf, _Zr3);
  var _super253 = _createSuper(uf);
  function uf() {
    var _this257;
    _classCallCheck(this, uf);
    _this257 = _super253.call(this, YR), _this257.effect.offset = new N(.01, .01);
    return _this257;
  }
  _createClass(uf, [{
    key: "offset",
    get: function get() {
      return [this.effect.offset.x * 1e3, this.effect.offset.y * 1e3];
    },
    set: function set(t) {
      this.effect.offset.set(t[0] / 1e3, t[1] / 1e3);
    }
  }]);
  return uf;
}(Zr);
var df = /*#__PURE__*/function (_Zr4) {
  _inherits(df, _Zr4);
  var _super254 = _createSuper(df);
  function df() {
    _classCallCheck(this, df);
    return _super254.call(this, qR);
  }
  return _createClass(df);
}(Zr);
var hf = /*#__PURE__*/function (_Zr5) {
  _inherits(hf, _Zr5);
  var _super255 = _createSuper(hf);
  function hf() {
    var _this258;
    _classCallCheck(this, hf);
    _this258 = _super255.call(this, QR);
    _this258._hue = 0;
    return _this258;
  }
  _createClass(hf, [{
    key: "hue",
    get: function get() {
      return this._hue;
    },
    set: function set(e) {
      this._hue = e, this.effect.setHue(e);
    }
  }, {
    key: "saturation",
    get: function get() {
      return this.effect.uniforms.get("saturation").value;
    },
    set: function set(e) {
      this.effect.uniforms.get("saturation").value = e;
    }
  }]);
  return hf;
}(Zr);
var ff = /*#__PURE__*/function (_Zr6) {
  _inherits(ff, _Zr6);
  var _super256 = _createSuper(ff);
  function ff() {
    var _this259;
    _classCallCheck(this, ff);
    _this259 = _super256.call(this, KR), _this259.blendFunction = yt.OVERLAY;
    return _this259;
  }
  return _createClass(ff);
}(Zr);
var pf = /*#__PURE__*/function (_Zr7) {
  _inherits(pf, _Zr7);
  var _super257 = _createSuper(pf);
  function pf() {
    _classCallCheck(this, pf);
    return _super257.call(this, JR);
  }
  _createClass(pf, [{
    key: "eskil",
    get: function get() {
      return this.effect.eskil;
    },
    set: function set(t) {
      this.effect.eskil = t;
    }
  }, {
    key: "darkness",
    get: function get() {
      return this.effect.uniforms.get("darkness").value;
    },
    set: function set(t) {
      this.effect.uniforms.get("darkness").value = t;
    }
  }, {
    key: "offset",
    get: function get() {
      return this.effect.uniforms.get("offset").value;
    },
    set: function set(t) {
      this.effect.uniforms.get("offset").value = t;
    }
  }]);
  return pf;
}(Zr);
var mf = /*#__PURE__*/function (_Zr8) {
  _inherits(mf, _Zr8);
  var _super258 = _createSuper(mf);
  function mf(t) {
    _classCallCheck(this, mf);
    return _super258.call(this, XR, t);
  }
  _createClass(mf, [{
    key: "focalLength",
    get: function get() {
      return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value;
    },
    set: function set(t) {
      this.effect.circleOfConfusionMaterial.uniforms.focalLength.value = t;
    }
  }, {
    key: "focusDistance",
    get: function get() {
      return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value;
    },
    set: function set(t) {
      this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value = t;
    }
  }, {
    key: "bokehScale",
    get: function get() {
      return this.effect.bokehScale;
    },
    set: function set(t) {
      this.effect.bokehScale = t;
    }
  }]);
  return mf;
}(Zr);
var gf = /*#__PURE__*/function (_Zr9) {
  _inherits(gf, _Zr9);
  var _super259 = _createSuper(gf);
  function gf() {
    _classCallCheck(this, gf);
    return _super259.call(this, ZR);
  }
  _createClass(gf, [{
    key: "granularity",
    get: function get() {
      return this.effect.getGranularity();
    },
    set: function set(t) {
      this.effect.setGranularity(t);
    }
  }]);
  return gf;
}(Zr);
var $R = "#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}";
var e3 = "#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}";
var t3 = "#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}";
var r3 = "#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}";
var yf = /*#__PURE__*/function (_rt11) {
    _inherits(yf, _rt11);
    var _super260 = _createSuper(yf);
    function yf() {
      _classCallCheck(this, yf);
      return _super260.call(this, {
        name: "PassthroughMaterial",
        uniforms: {
          inputBuffer: new se(null)
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        vertexShader: t3,
        fragmentShader: r3
      });
    }
    _createClass(yf, [{
      key: "inputBuffer",
      set: function set(t) {
        this.uniforms.inputBuffer.value = t;
      }
    }]);
    return yf;
  }(rt),
  hx = /*#__PURE__*/function (_hi11) {
    _inherits(hx, _hi11);
    var _super261 = _createSuper(hx);
    function hx() {
      var _this260;
      _classCallCheck(this, hx);
      _this260 = _super261.call(this, "TAAResolvePass");
      _this260.MRTCompatible = !0;
      _this260.needsSwap = !1, _this260.passThroughMaterial = new yf(), _this260.resolutionVector = new N(), _this260.resolveMaterial = new rt({
        name: "TAAResolveMaterial",
        uniforms: {
          inputBuffer: new se(null),
          historyBuffer: new se(null),
          velocityBuffer: new se(null),
          depthBuffer: new se(null),
          resolution: new se(new N())
        },
        blending: Wt,
        depthWrite: !1,
        depthTest: !1,
        vertexShader: $R,
        fragmentShader: e3
      }), _this260.historyRenderTarget = new at(1024, 1024, {
        minFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this260.historyRenderTarget.texture.name = "TAA.History", _this260.resultRenderTarget = new at(1024, 1024, {
        minFilter: Qe,
        stencilBuffer: !1,
        depthBuffer: !1
      }), _this260.resultRenderTarget.texture.name = "TAA.Output";
      return _this260;
    }
    _createClass(hx, [{
      key: "setSize",
      value: function setSize(e, r) {
        this.historyRenderTarget.setSize(e, r), this.resultRenderTarget.setSize(e, r);
      }
    }, {
      key: "render",
      value: function render(e, r) {
        this.fullscreenMaterial = this.resolveMaterial, this.resolveMaterial.uniforms.inputBuffer.value = r.texture[0], this.resolveMaterial.uniforms.velocityBuffer.value = r.texture[1], this.resolveMaterial.uniforms.depthBuffer.value = r.depthTexture, this.resolveMaterial.uniforms.historyBuffer.value = this.historyRenderTarget.texture, this.resolveMaterial.uniforms.resolution.value.set(r.width, r.height), e.setRenderTarget(this.resultRenderTarget), e.render(this.scene, this.camera), this.fullscreenMaterial = this.passThroughMaterial, this.passThroughMaterial.inputBuffer = this.resultRenderTarget.texture, e.setRenderTarget(this.historyRenderTarget), e.render(this.scene, this.camera);
        var i = this.renderToScreen ? null : r;
        this.fullscreenMaterial = this.passThroughMaterial, this.passThroughMaterial.inputBuffer = this.resultRenderTarget.texture, e.setRenderTarget(i), e.render(this.scene, this.camera);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.resultRenderTarget.dispose(), this.historyRenderTarget.dispose(), this.resolveMaterial.dispose(), this.passThroughMaterial.dispose();
      }
    }]);
    return hx;
  }(hi);
var fx = /*#__PURE__*/function (_hi12) {
  _inherits(fx, _hi12);
  var _super262 = _createSuper(fx);
  function fx(e, r, i) {
    var _this261;
    _classCallCheck(this, fx);
    _this261 = _super262.call(this, "TransmissionPass", void 0, r);
    _this261.MRTCompatible = !0;
    _this261.depthPass = new b_(e, r, {
      renderTarget: i.transmissionDepthTarget
    }), _this261.passThroughMaterial = new yf(), _this261.splineScene = e, _this261.needsSwap = !1;
    return _this261;
  }
  _createClass(fx, [{
    key: "updatePasses",
    value: function updatePasses(e) {
      this.passThroughMaterial = new yf(), this.depthPass = new b_(this.splineScene, this.camera, {
        renderTarget: e.transmissionDepthTarget
      });
    }
  }, {
    key: "setCamera",
    value: function setCamera(e) {
      this.camera = e;
    }
  }, {
    key: "setScene",
    value: function setScene(e) {
      this.splineScene = e;
    }
  }, {
    key: "render",
    value: function render(e, r, i) {
      var s = this.camera.layers.mask,
        o = e;
      o.setRenderTarget(o.transmissionRenderTarget), this.fullscreenMaterial = this.passThroughMaterial, this.passThroughMaterial.inputBuffer = r.texture[0], o.clear(), o.render(this.scene, this.camera), this.camera.layers.disable(3), this.depthPass.render(e, r, i), o.shadowMap.needsUpdate = !1, o.shadowMap.autoUpdate = !1;
      var a = this.renderToScreen ? null : r;
      this.camera.layers.set(3), e.setRenderTarget(a), e.render(this.splineScene, this.camera), this.camera.layers.mask = s;
    }
  }]);
  return fx;
}(hi);
var i3 = new vi(),
  nQ = new rt({
    transparent: !0,
    vertexShader: "\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",
    fragmentShader: "\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "
  }),
  Kc = /*#__PURE__*/function (_hi13) {
    _inherits(Kc, _hi13);
    var _super263 = _createSuper(Kc);
    function Kc(e, r, i) {
      var _this262;
      _classCallCheck(this, Kc);
      _this262 = _super263.call(this, "OpaquePass", r !== null && r !== void 0 ? r : i3, i);
      _this262.MRTCompatible = !0;
      _this262.hasTransmissionPass = !1;
      _this262.clear = !0;
      _this262.clearColorOnly = !1;
      _this262.clearDepth = !1;
      _this262.needsSwap = !1, _this262.originalMaterials = new Map(), _this262.MRTCompatible = e;
      return _this262;
    }
    _createClass(Kc, [{
      key: "splatViewer",
      get: function get() {
        return this._splatViewer;
      },
      set: function set(e) {
        this._splatViewer = e;
      }
    }, {
      key: "setCamera",
      value: function setCamera(e) {
        this.camera = e;
      }
    }, {
      key: "setScene",
      value: function setScene(e) {
        this.scene = e !== null && e !== void 0 ? e : i3;
      }
    }, {
      key: "getScene",
      value: function getScene() {
        return this.scene;
      }
    }, {
      key: "render",
      value: function render(e, r) {
        var _this263 = this,
          _this$_splatViewer;
        this.camera.layers.enable(3), this.hasTransmissionPass && (this.originalMaterials.clear(), this.scene.traverse(function (s) {
          s.layers.isEnabled(3) && s instanceof nr && (_this263.originalMaterials.set(s.id, s.material), s.material = nQ);
        }), e.shadowMap.needsUpdate = !0, e.shadowMap.autoUpdate = !0), this.camera.layers.enable(8);
        var i = this.renderToScreen ? null : r;
        if (e.setRenderTarget(i), this.clearColorOnly && e.clear(!0, !1, !0), this.clear && e.clear(), ((_this$_splatViewer = this._splatViewer) === null || _this$_splatViewer === void 0 ? void 0 : _this$_splatViewer.splatRenderingInitialized) === !0) {
          var _s59 = e.autoClear;
          e.autoClear = !1, e.render(this.scene, this.camera), this._splatViewer.update(), e.render(this._splatViewer.splatMesh, this.camera), e.autoClear = _s59;
        } else e.render(this.scene, this.camera);
        this.clearDepth && e.clear(!1, !0, !1), this.hasTransmissionPass && this.originalMaterials.forEach(function (s, o) {
          var a = _this263.scene.getObjectById(o);
          a && (a.material = s);
        });
      }
    }]);
    return Kc;
  }(hi);
var px = /*#__PURE__*/function () {
  function px(t) {
    var _ref47 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      _ref47$depthBuffer = _ref47.depthBuffer,
      e = _ref47$depthBuffer === void 0 ? !0 : _ref47$depthBuffer,
      _ref47$stencilBuffer = _ref47.stencilBuffer,
      r = _ref47$stencilBuffer === void 0 ? !1 : _ref47$stencilBuffer,
      _ref47$multisampling = _ref47.multisampling,
      i = _ref47$multisampling === void 0 ? 0 : _ref47$multisampling,
      _ref47$frameBufferTyp = _ref47.frameBufferType,
      s = _ref47$frameBufferTyp === void 0 ? 0 : _ref47$frameBufferTyp;
    _classCallCheck(this, px);
    this.renderer = t;
    this.helperStartIndex = 0;
    this.copyPass = new Rm();
    this.depthTexture = null;
    this.timer = new jR();
    this._width = 1;
    this._height = 1;
    this.passes = [];
    this.helperPasses = [];
    this.autoRenderToScreen = !0;
    this.inputBuffer = this.createBuffer(e, r, s, i, !0, "input buffer mrt"), this.inputBufferSingle = this.createBuffer(e, r, s, i, !1, " input buffer single"), this.inputBufferSingle.texture.dispose(), this.inputBufferSingle.depthTexture.dispose(), this.inputBufferSingle.texture = this.inputBuffer.texture[0], this.inputBufferSingle.depthTexture = this.inputBuffer.depthTexture, this.outputBuffer = this.inputBuffer.clone(), this.outputBuffer.name = "output buffer mrt", this.outputBufferSingle = this.createBuffer(e, r, s, i, !1, "output buffer single"), this.outputBufferSingle.texture.dispose(), this.outputBufferSingle.depthTexture.dispose(), this.outputBufferSingle.texture = this.outputBuffer.texture[0], this.outputBufferSingle.depthTexture = this.outputBuffer.depthTexture, this.setRenderer(t);
  }
  _createClass(px, [{
    key: "multisampling",
    get: function get() {
      return this.inputBuffer.samples || 0;
    },
    set: function set(t) {
      var e = this.inputBuffer,
        r = this.multisampling;
      r > 0 && t > 0 ? (this.inputBuffer.samples = t, this.outputBuffer.samples = t, this.inputBuffer.dispose(), this.outputBuffer.dispose()) : r !== t && (this.inputBuffer.dispose(), this.outputBuffer.dispose(), console.log("creating new input buffer"), this.inputBuffer = this.createBuffer(e.depthBuffer, e.stencilBuffer, e.texture.type, t, !0, "new input buffer"), this.inputBuffer.depthTexture = this.depthTexture, this.outputBuffer = this.inputBuffer.clone());
    }
  }, {
    key: "getTimer",
    value: function getTimer() {
      return this.timer;
    }
  }, {
    key: "getRenderer",
    value: function getRenderer() {
      return this.renderer;
    }
  }, {
    key: "setRenderer",
    value: function setRenderer(t) {
      if (this.renderer = t, t !== null) {
        var _t$getContext$getCont, _t$getContext$getCont2;
        var e = t.getSize(new N()),
          r = (_t$getContext$getCont = (_t$getContext$getCont2 = t.getContext().getContextAttributes()) === null || _t$getContext$getCont2 === void 0 ? void 0 : _t$getContext$getCont2.alpha) !== null && _t$getContext$getCont !== void 0 ? _t$getContext$getCont : !1,
          _i129 = this.inputBuffer.texture[0].type;
        _i129 === br && t.outputEncoding === tt && (this.inputBuffer.texture[0].encoding = tt, this.outputBuffer.texture[0].encoding = tt, this.inputBuffer.dispose(), this.outputBuffer.dispose(), console.log("doing some kinda dispose??")), t.autoClear = !1, this.setSize(e.width, e.height, !1);
        var _iterator93 = _createForOfIteratorHelper(this.passes),
          _step93;
        try {
          for (_iterator93.s(); !(_step93 = _iterator93.n()).done;) {
            var _s60 = _step93.value;
            _s60.initialize(t, r, _i129);
          }
        } catch (err) {
          _iterator93.e(err);
        } finally {
          _iterator93.f();
        }
      }
    }
  }, {
    key: "replaceRenderer",
    value: function replaceRenderer(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      var r = this.renderer,
        i = r.domElement.parentNode;
      return this.setRenderer(t), e && i !== null && (i.removeChild(r.domElement), i.appendChild(t.domElement)), r;
    }
  }, {
    key: "createDepthTexture",
    value: function createDepthTexture() {
      var t = this.depthTexture = new is(this._width, this._height);
      return this.inputBuffer.depthTexture = t, this.inputBuffer.dispose(), this.inputBuffer.stencilBuffer ? (t.format = Ka, t.type = Ya) : t.type = Ds, t;
    }
  }, {
    key: "deleteDepthTexture",
    value: function deleteDepthTexture() {
      if (this.depthTexture !== null) {
        this.depthTexture.dispose(), this.depthTexture = null, this.inputBuffer.depthTexture = null, this.inputBuffer.dispose();
        var _iterator94 = _createForOfIteratorHelper(this.passes),
          _step94;
        try {
          for (_iterator94.s(); !(_step94 = _iterator94.n()).done;) {
            var t = _step94.value;
            t.setDepthTexture(null);
          }
        } catch (err) {
          _iterator94.e(err);
        } finally {
          _iterator94.f();
        }
      }
    }
  }, {
    key: "createBuffer",
    value: function createBuffer(t, e, r, i, s, o) {
      var a = this.renderer,
        l = a === null ? new N() : a.getDrawingBufferSize(new N()),
        u = {
          minFilter: Qe,
          magFilter: Qe,
          wrapS: Ut,
          wrapT: Ut,
          stencilBuffer: e,
          depthBuffer: t
        },
        c;
      return i > 0 ? (c = new at(l.width, l.height, u), c.samples = i) : (s ? (c = new sy(l.width, l.height, 2, u), c.texture[1].type = sa) : c = new at(l.width, l.height, u), c.depthTexture = new is(2048, 2048), c.depthTexture.type = dr), r === br && a !== null && a.outputEncoding === tt && (Array.isArray(c.texture) ? c.texture.forEach(function (d) {
        return d.encoding = tt;
      }) : c.texture.encoding = tt), Array.isArray(c.texture) ? c.texture.forEach(function (d, h) {
        d.name = "EffectComposer.Buffer ".concat(s, " ").concat(h), d.generateMipmaps = !1;
      }) : (c.texture.name = "EffectComposer.Buffer ".concat(s), c.texture.generateMipmaps = !1), c.name = o, c;
    }
  }, {
    key: "addPass",
    value: function addPass(t, e) {
      var _i$getContext$getCont, _i$getContext$getCont2;
      var r = this.passes,
        i = this.renderer,
        s = i.getDrawingBufferSize(new N()),
        o = (_i$getContext$getCont = (_i$getContext$getCont2 = i.getContext().getContextAttributes()) === null || _i$getContext$getCont2 === void 0 ? void 0 : _i$getContext$getCont2.alpha) !== null && _i$getContext$getCont !== void 0 ? _i$getContext$getCont : !1,
        a;
      if (t.MRTCompatible && (a = this.inputBuffer.texture[0].type), t.MRTCompatible || (a = this.inputBuffer.texture.type), t.setRenderer(i), t.setSize(s.width, s.height), t.initialize(i, o, a), this.autoRenderToScreen && (r.length > 0 && (r[r.length - 1].renderToScreen = !1), t.renderToScreen && (this.autoRenderToScreen = !1)), e !== void 0 ? r.splice(e, 0, t) : r.push(t), this.autoRenderToScreen && (r[r.length - 1].renderToScreen = !0), t.needsDepthTexture || this.depthTexture !== null) if (this.depthTexture === null) {
        var l = this.createDepthTexture();
        var _iterator95 = _createForOfIteratorHelper(r),
          _step95;
        try {
          for (_iterator95.s(); !(_step95 = _iterator95.n()).done;) {
            t = _step95.value;
            t.setDepthTexture(l);
          }
        } catch (err) {
          _iterator95.e(err);
        } finally {
          _iterator95.f();
        }
      } else t.setDepthTexture(this.depthTexture);
    }
  }, {
    key: "setHelperStartIndex",
    value: function setHelperStartIndex(t) {
      this.helperStartIndex = t;
    }
  }, {
    key: "removePass",
    value: function removePass(t) {
      var e = this.passes,
        r = e.indexOf(t);
      if (r !== -1 && e.splice(r, 1).length > 0) {
        if (this.depthTexture !== null) {
          var o = function o(l, u) {
            return l || u.needsDepthTexture;
          };
          e.reduce(o, !1) || (t.getDepthTexture() === this.depthTexture && t.setDepthTexture(null), this.deleteDepthTexture());
        }
        this.autoRenderToScreen && r === e.length && (t.renderToScreen = !1, e.length > 0 && (e[e.length - 1].renderToScreen = !0));
      }
    }
  }, {
    key: "removeAllPasses",
    value: function removeAllPasses() {
      var t = this.passes;
      this.deleteDepthTexture(), t.length > 0 && (this.autoRenderToScreen && (t[t.length - 1].renderToScreen = !1), this.passes = []);
    }
  }, {
    key: "render",
    value: function render(t) {
      var e = this.renderer,
        r = this.copyPass,
        i = this.inputBuffer,
        s = this.outputBuffer,
        o = this.inputBufferSingle,
        a = this.outputBufferSingle,
        l = !1,
        u,
        c,
        d,
        h;
      t === void 0 && (t = this.timer.update().getDelta());
      var _iterator96 = _createForOfIteratorHelper(this.passes),
        _step96;
      try {
        for (_iterator96.s(); !(_step96 = _iterator96.n()).done;) {
          var f = _step96.value;
          f.enabled && (f.MRTCompatible ? f.render(e, i, s, t, l) : f.render(e, o, a, t, l), f.needsSwap && (l && (r.renderToScreen = f.renderToScreen, u = e.getContext(), c = e.state.buffers.stencil, c.setFunc(u.NOTEQUAL, 1, 4294967295), r.render(e, i, s, t, l), c.setFunc(u.EQUAL, 1, 4294967295)), d = i, h = o, i = s, o = a, s = d, a = h), f instanceof GR ? l = !0 : f instanceof UR && (l = !1));
        }
      } catch (err) {
        _iterator96.e(err);
      } finally {
        _iterator96.f();
      }
    }
  }, {
    key: "setSize",
    value: function setSize(t, e, r) {
      var i = this.renderer;
      if (this._width = t, this._height = e, t === void 0 || e === void 0) {
        var o = i.getSize(new N());
        t = o.width, e = o.height;
      }
      i.setSize(t, e, r);
      var s = i.getDrawingBufferSize(new N());
      this.inputBuffer.setSize(s.width, s.height), this.outputBuffer.setSize(s.width, s.height), this.inputBufferSingle.setSize(s.width, s.height), this.outputBufferSingle.setSize(s.width, s.height);
      var _iterator97 = _createForOfIteratorHelper(this.passes),
        _step97;
      try {
        for (_iterator97.s(); !(_step97 = _iterator97.n()).done;) {
          var _o53 = _step97.value;
          _o53.setSize(s.width, s.height);
        }
      } catch (err) {
        _iterator97.e(err);
      } finally {
        _iterator97.f();
      }
    }
  }, {
    key: "reset",
    value: function reset() {
      var t = this.timer.isAutoResetEnabled();
      this.dispose(), this.autoRenderToScreen = !0, this.timer.setAutoResetEnabled(t);
    }
  }, {
    key: "dispose",
    value: function dispose() {
      var _iterator98 = _createForOfIteratorHelper(this.passes),
        _step98;
      try {
        for (_iterator98.s(); !(_step98 = _iterator98.n()).done;) {
          var t = _step98.value;
          t.dispose();
        }
      } catch (err) {
        _iterator98.e(err);
      } finally {
        _iterator98.f();
      }
      this.passes = [], this.inputBuffer !== null && this.inputBuffer.dispose(), this.outputBuffer !== null && this.outputBuffer.dispose(), this.inputBufferSingle !== null && this.inputBufferSingle.dispose(), this.outputBufferSingle !== null && this.outputBufferSingle.dispose(), this.deleteDepthTexture(), this.copyPass.dispose(), this.timer.dispose();
    }
  }]);
  return px;
}();
var sQ = new rt({
    name: "CombineMaterial",
    uniforms: {
      inputBufferA: new se(null),
      inputBufferB: new se(null)
    },
    blending: Wt,
    depthWrite: !1,
    depthTest: !1,
    vertexShader: "\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",
    fragmentShader: "\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"
  }),
  mx = /*#__PURE__*/function (_hi14) {
    _inherits(mx, _hi14);
    var _super264 = _createSuper(mx);
    function mx(e) {
      var _this264;
      _classCallCheck(this, mx);
      _this264 = _super264.call(this, "HelperPass", void 0, e);
      _this264.MRTCompatible = !1;
      _this264.fullscreenMaterial = sQ, _this264.helperPass = new Kc(!1, void 0, _this264.camera), _this264.helperPass.hasTransmissionPass = !1, _this264.helperPass.clear = !1, _this264.helperPass.renderToScreen = !1, _this264.helperPassOnTop = new Kc(!1, void 0, _this264.camera), _this264.helperPassOnTop.hasTransmissionPass = !1, _this264.helperPassOnTop.clear = !1, _this264.helperPassOnTop.renderToScreen = !1;
      var r = new dx({
        preset: Ia.LOW,
        edgeDetectionMode: af.COLOR
      });
      _this264.effectPass = new Qc(_this264.camera, r), _this264.rt = new at(10, 10, {
        minFilter: Qe,
        magFilter: Qe,
        wrapS: Ut,
        wrapT: Ut,
        depthBuffer: !0
      });
      return _this264;
    }
    _createClass(mx, [{
      key: "setSize",
      value: function setSize(e, r) {
        this.rt.setSize(e, r), this.effectPass.setSize(e, r);
      }
    }, {
      key: "sceneHelpers",
      get: function get() {
        return this.helperPass.getScene();
      },
      set: function set(e) {
        this.helperPass.setScene(e);
      }
    }, {
      key: "sceneHelpersOnTop",
      get: function get() {
        return this.helperPassOnTop.getScene();
      },
      set: function set(e) {
        this.helperPassOnTop.setScene(e);
      }
    }, {
      key: "setCamera",
      value: function setCamera(e) {
        this.helperPass.setCamera(e), this.helperPassOnTop.setCamera(e);
      }
    }, {
      key: "initialize",
      value: function initialize(e, r, i) {
        _get(_getPrototypeOf(mx.prototype), "initialize", this).call(this, e, r, i), this.effectPass.initialize(e, r, i);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        _get(_getPrototypeOf(mx.prototype), "dispose", this).call(this), this.rt.dispose(), this.effectPass.dispose();
      }
    }, {
      key: "render",
      value: function render(e, r, i) {
        this.rt.depthTexture = r.depthTexture;
        var s = e.getClearAlpha();
        e.setClearAlpha(0), this.helperPass.clearDepth = !0, this.helperPass.clearColorOnly = !0, this.helperPass.render(e, this.rt), this.helperPassOnTop.render(e, this.rt), this.effectPass.renderToScreen = !1, this.effectPass.render(e, this.rt, i), this.fullscreenMaterial.uniforms.inputBufferA.value = i.texture, this.fullscreenMaterial.uniforms.inputBufferB.value = r.texture, e.setClearAlpha(s), e.setRenderTarget(null), e.clear(), e.render(this.scene, this.camera);
      }
    }]);
    return mx;
  }(hi);
var n3 = "#define GLSLIFY 1\n#include <skinning_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}";
var s3 = "#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}";
var o3 = "#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}";
var a3 = "#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}";
var l3 = "#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}";
var c3 = "#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}";
var vf = [[.478712, .875764], [-.337956, -.793959], [-.955259, -.028164], [.864527, .325689], [.209342, -.395657], [-.106779, .672585], [.156213, .235113], [-.413644, -.082856], [-.415667, .323909], [.141896, -.93998], [.954932, -.182516], [-.766184, .410799], [-.434912, -.458845], [.415242, -.078724], [.728335, -.491777], [-.058086, -.066401], [.20299, .686837], [-.808362, -.556402], [.507386, -.640839], [-.723494, -.22924], [.48974, .317826], [-.622663, .765301], [-.01064, .929347], [.663146, .647618], [-.096674, -.413835], [.525945, -.321063], [-.122533, .366019], [.195235, -.687983], [-.563203, .098748], [.418563, .561335], [-.378595, .800367], [.826922, .001024], [-.085372, -.766651], [-.92192, .183673], [-.590008, -.721799], [.167751, -.164393], [.032961, -.56253], [.6329, -.107059], [-.46408, .569669], [-.173676, -.958758], [-.242648, -.234303], [-.275362, .157163], [.382295, -.795131], [.562955, .115562], [.190586, .470121], [.770764, -.297576], [.237281, .93105], [-.666642, -.455871], [-.905649, -.298379], [.33952, .157829], [.701438, -.7041], [-.062758, .160346], [-.220674, .957141], [.642692, .432706], [-.77339, -.015272], [-.671467, .24688], [.158051, .062859], [.806009, .527232], [-.05762, -.247071], [.333436, -.51671], [-.550658, -.315773], [-.652078, .589846], [.008818, .530556], [-.210004, .519896]];
var hQ = new rt({
    vertexShader: n3,
    fragmentShader: s3
  }),
  gx = new rt({
    vertexShader: l3,
    fragmentShader: c3,
    uniforms: {
      texture_ao_lrez: new se(null),
      texture_depth_lrez: new se(null),
      texture_depth_hrez: new se(null),
      near: new se(null),
      far: new se(null)
    }
  }),
  yx = /*#__PURE__*/function (_hi15) {
    _inherits(yx, _hi15);
    var _super265 = _createSuper(yx);
    function yx(e, r) {
      var _this265;
      _classCallCheck(this, yx);
      _this265 = _super265.call(this, "AmbientOcclusionPass", void 0, r);
      _this265.fogEnabled = !1;
      _this265.fogNear = 1;
      _this265.fogFar = 1e3;
      _this265.frameIndex = 0;
      _this265._runHalfRes = !0;
      _this265._width = 1;
      _this265._height = 1;
      var i = 1024,
        s = 1024;
      _this265.gBuffer = new at(i, s, {
        type: dr,
        depthTexture: new is(i, s),
        minFilter: Qe,
        magFilter: Qe
      }), _this265.depthBufferHighRes = new at(i, s, {
        depthTexture: new is(i, s)
      }), _this265.aoBuffer = new at(i, s, {
        minFilter: Qe,
        magFilter: Qe
      }), _this265.splineScene = e, _this265.splineCamera = r;
      var o = new Float32Array(vf.length * 2);
      for (var l = 0; l < vf.length; l++) {
        var u = l * 2;
        o[u + 0] = vf[l][0], o[u + 1] = vf[l][1];
      }
      _this265.blueNoiseInDiskTexture = new ci(o, vf.length, 1, Ku, dr), _this265.blueNoiseInDiskTexture.wrapS = Is, _this265.blueNoiseInDiskTexture.wrapT = Is, _this265.blueNoiseInDiskTexture.needsUpdate = !0, _this265.hbaoMaterial = new rt({
        vertexShader: o3,
        fragmentShader: a3,
        uniforms: {
          near: new se(null),
          far: new se(null),
          fov: new se(null),
          proj_info: new se(new He()),
          is_ortho: new se(!1),
          resolution: new se(new N()),
          radius_of_influence: new se(8),
          radius_in_screen_space: new se(1),
          exponent: new se(1),
          ao_color: new se(new _()),
          bias: new se(.5),
          texture_depth: new se(null),
          texture_normals: new se(null),
          texture_blue_noise: new se(null),
          texture_blue_noise_in_disk: new se(_this265.blueNoiseInDiskTexture),
          frame_index: new se(0),
          fog_enabled: new se(!1),
          fog_near: new se(1),
          fog_far: new se(1e3)
        }
      }), _this265.radius = 128, _this265.aoColor = {
        r: 0,
        g: 0,
        b: 0
      }, _this265.bias = .5, _this265.hbaoMaterial.uniforms.texture_depth.value = _this265.gBuffer.depthTexture, _this265.hbaoMaterial.uniforms.texture_normals.value = _this265.gBuffer.texture, _this265.needsSwap = !0, _this265.aaBuffer = new at(i, s, {
        minFilter: Qe,
        magFilter: Qe,
        wrapS: Ut,
        wrapT: Ut,
        depthBuffer: !1,
        type: dr
      });
      var a = new dx({
        preset: Ia.ULTRA,
        edgeDetectionMode: af.COLOR
      });
      _this265.effectPass = new Qc(_this265.camera, a);
      return _this265;
    }
    _createClass(yx, [{
      key: "initialize",
      value: function initialize(e, r, i) {
        _get(_getPrototypeOf(yx.prototype), "initialize", this).call(this, e, r, i), this.effectPass.initialize(e, r, i);
      }
    }, {
      key: "setBlueNoiseTexture",
      value: function setBlueNoiseTexture(e) {
        this.hbaoMaterial.uniforms.texture_blue_noise.value = e;
      }
    }, {
      key: "setSize",
      value: function setSize(e, r) {
        this._width = e, this._height = r, this.depthBufferHighRes.setSize(e, r);
        var i = this._runHalfRes ? .5 : 1,
          s = e * i,
          o = r * i;
        this.gBuffer.setSize(s, o), this.aoBuffer.setSize(s, o), this.hbaoMaterial.uniforms.resolution.value.set(s, o), this.aaBuffer.setSize(s, o), this.effectPass.setSize(s, o);
      }
    }, {
      key: "runHalfRes",
      get: function get() {
        return this._runHalfRes;
      },
      set: function set(e) {
        this._runHalfRes = e, this.setSize(this._width, this._height);
      }
    }, {
      key: "setCamera",
      value: function setCamera(e) {
        this.splineCamera = e;
      }
    }, {
      key: "setScene",
      value: function setScene(e) {
        this.splineScene = e;
      }
    }, {
      key: "render",
      value: function render(e, r, i) {
        this.splineScene.overrideMaterial = hQ;
        var s = this.splineCamera.layers.mask;
        if (this.splineCamera.layers.set(5), e.setRenderTarget(this.gBuffer), e.clear(), e.render(this.splineScene, this.splineCamera), e.setRenderTarget(this.depthBufferHighRes), e.clear(), e.render(this.splineScene, this.splineCamera), this.splineScene.overrideMaterial = null, this.splineCamera.layers.mask = s, this.hbaoMaterial.uniforms.radius_of_influence.value = this.radius, this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r, this.aoColor.g, this.aoColor.b), this.hbaoMaterial.uniforms.bias.value = this.bias, this.hbaoMaterial.uniforms.fog_enabled.value = this.fogEnabled, this.hbaoMaterial.uniforms.fog_near.value = this.fogNear, this.hbaoMaterial.uniforms.fog_far.value = this.fogFar, this.hbaoMaterial.uniforms.frame_index.value = this.frameIndex, this.frameIndex++, this.splineCamera.isPerspectiveCamera) {
          this.hbaoMaterial.uniforms.near.value = this.splineCamera.perspCamera.near, this.hbaoMaterial.uniforms.far.value = this.splineCamera.perspCamera.far;
          var o = this.splineCamera.perspCamera.projectionMatrix.elements,
            a = 2 / o[0],
            l = 2 / o[5],
            u = -(1 - o[8]) / o[0],
            c = -(1 + o[9]) / o[5];
          this.hbaoMaterial.uniforms.proj_info.value.set(a, l, u, c);
          var _h82 = this.splineCamera.perspCamera.fov * (Math.PI / 180),
            p = this.hbaoMaterial.uniforms.resolution.value.y / (Math.tan(_h82 * .5) * 2),
            m = this.hbaoMaterial.uniforms.radius_of_influence.value * .5 * p;
          this.hbaoMaterial.uniforms.radius_in_screen_space.value = m, this.hbaoMaterial.uniforms.is_ortho.value = !1;
        } else {
          this.hbaoMaterial.uniforms.near.value = this.splineCamera.orthoCamera.near, this.hbaoMaterial.uniforms.far.value = this.splineCamera.orthoCamera.far;
          var _o54 = this.splineCamera.orthoCamera.projectionMatrix.elements,
            _a54 = 2 / _o54[0],
            _l85 = 2 / _o54[5],
            _u51 = -(1 + _o54[12]) / _o54[0],
            _c39 = -(1 - _o54[13]) / _o54[5];
          this.hbaoMaterial.uniforms.proj_info.value.set(_a54, _l85, _u51, _c39);
          var _h83 = .5 * (this.hbaoMaterial.uniforms.resolution.value.y / _l85),
            f = this.hbaoMaterial.uniforms.radius_of_influence.value * _h83;
          this.hbaoMaterial.uniforms.radius_in_screen_space.value = f, this.hbaoMaterial.uniforms.is_ortho.value = !0;
        }
        this.runHalfRes ? (this.fullscreenMaterial = this.hbaoMaterial, e.setRenderTarget(this.aoBuffer), e.clear(), e.render(this.scene, this.camera), this.fullscreenMaterial = gx, gx.uniforms.texture_ao_lrez.value = this.aoBuffer.texture, gx.uniforms.texture_depth_lrez.value = this.gBuffer.depthTexture, gx.uniforms.texture_depth_hrez.value = this.depthBufferHighRes.depthTexture, e.setRenderTarget(e.aoRenderTarget), e.clear(), e.render(this.scene, this.camera)) : (this.fullscreenMaterial = this.hbaoMaterial, e.setRenderTarget(this.aaBuffer), e.clear(), e.render(this.scene, this.camera), this.effectPass.renderToScreen = !1, this.effectPass.render(e, this.aaBuffer, e.aoRenderTarget));
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.gBuffer.dispose(), this.depthBufferHighRes.dispose(), this.aoBuffer.dispose();
      }
    }]);
    return yx;
  }(hi);
var fQ = "\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
  pQ = "\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",
  vx = /*#__PURE__*/function (_Bn) {
    _inherits(vx, _Bn);
    var _super266 = _createSuper(vx);
    function vx() {
      var _this266;
      _classCallCheck(this, vx);
      _this266 = _super266.call(this, new rt({
        vertexShader: fQ,
        fragmentShader: pQ,
        uniforms: {
          tInput: new se(null),
          tMap: new se(null),
          uResolution: new se(new N()),
          uSize: new se(new N()),
          uCoords: new se(new N()),
          uScale: new se(1),
          uSceneColor: new se(new Le(16711680)),
          uDPR: new se(1),
          uCurrent: new se(0)
        }
      }), "tInput"), _this266.needsSwap = !0;
      return _this266;
    }
    _createClass(vx, [{
      key: "uniforms",
      get: function get() {
        return this.fullscreenMaterial.uniforms;
      }
    }, {
      key: "texture",
      get: function get() {
        return this.uniforms.tMap.value;
      },
      set: function set(t) {
        this.uniforms.tMap.value = t;
      }
    }]);
    return vx;
  }(Bn);
var mQ = "\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
  gQ = "\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",
  yQ = [],
  xx = /*#__PURE__*/function (_Bn2) {
    _inherits(xx, _Bn2);
    var _super267 = _createSuper(xx);
    function xx() {
      var _this267;
      _classCallCheck(this, xx);
      _this267 = _super267.call(this, new rt({
        vertexShader: mQ,
        fragmentShader: gQ,
        uniforms: {
          toScene: new se(null),
          fromScene: new se(null),
          uResolution: new se(new N()),
          uDPR: new se(1),
          mixRatio: new se(0),
          threshold: new se(.1),
          useTexture: new se(0),
          tMixTexture: {
            value: yQ[0]
          }
        }
      }), "toScene"), _this267.needsSwap = !0;
      return _this267;
    }
    _createClass(xx, [{
      key: "uniforms",
      get: function get() {
        return this.fullscreenMaterial.uniforms;
      }
    }, {
      key: "texture",
      get: function get() {
        return this.uniforms.fromScene.value;
      },
      set: function set(t) {
        this.uniforms.fromScene.value = t;
      }
    }]);
    return xx;
  }(Bn);
var vQ = "\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
  xQ = "\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n\tgl_FragColor.a = 1.0;\n}\n",
  bx = /*#__PURE__*/function (_Bn3) {
    _inherits(bx, _Bn3);
    var _super268 = _createSuper(bx);
    function bx() {
      var _this268;
      _classCallCheck(this, bx);
      _this268 = _super268.call(this, new rt({
        vertexShader: vQ,
        fragmentShader: xQ,
        uniforms: {
          inputBuffer: new se(null),
          blurredInputBuffer: new se(null),
          overlay: new se(null),
          uResolution: new se(new N()),
          uDPR: new se(1),
          blurIntensity: new se(0)
        }
      }));
      _this268._blurEnabled = !1;
      _this268.blurTarget = new at(1, 1, {
        minFilter: Qe,
        magFilter: Qe,
        wrapS: Ut,
        wrapT: Ut
      }), _this268.blurPass = new ux({
        width: window.innerWidth,
        height: window.innerHeight,
        kernelSize: Lm.HUGE,
        resolutionScale: .25
      }), _this268.blurPass.renderToScreen = !1, _this268.uniforms.blurredInputBuffer.value = _this268.blurTarget.texture;
      return _this268;
    }
    _createClass(bx, [{
      key: "uniforms",
      get: function get() {
        return this.fullscreenMaterial.uniforms;
      }
    }, {
      key: "texture",
      get: function get() {
        return this.uniforms.overlay.value;
      },
      set: function set(e) {
        this.uniforms.overlay.value = e;
      }
    }, {
      key: "setResolution",
      value: function setResolution(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
        this.uniforms.uResolution.value.set(e, r).divideScalar(i), this.uniforms.uDPR.value = i, this.blurPass.setSize(e, r), this.blurTarget.setSize(e, r), this.blurPass.setSize(e, r);
      }
    }, {
      key: "uiCanvas",
      get: function get() {
        return this._uiCanvas;
      },
      set: function set(e) {
        this._uiCanvas = e, e.texture && (this.uniforms.overlay.value = e.texture);
        var i = e.frame;
        if (i) {
          var _s61 = i.data.backgroundBlur,
            o = _s61.radius;
          this._blurEnabled = _s61.enabled, this.uniforms.blurIntensity.value = this._blurEnabled ? 1 : 0, this.blurPass.scale = o / 3;
        }
      }
    }, {
      key: "render",
      value: function render(e, r, i, s, o) {
        this._blurEnabled && (this.blurPass.setDepthTexture(this.getDepthTexture()), this.blurPass.render(e, r, this.blurTarget, s, o)), _get(_getPrototypeOf(bx.prototype), "render", this).call(this, e, r, i, s, o);
      }
    }]);
    return bx;
  }(Bn);
function d3(n, t) {
  return t && t.enabled && n.push(t.effect), n;
}
var bQ = function bQ(n) {
    return Object.values(yt).includes(n) ? n : yt.NORMAL;
  },
  Bm = /*#__PURE__*/function (_ir12) {
    _inherits(Bm, _ir12);
    var _super269 = _createSuper(Bm);
    function Bm(e) {
      var _this269;
      _classCallCheck(this, Bm);
      _this269 = _super269.call(this);
      _this269.postprocessingState = Ud.defaultData;
      _this269._scene = new vi();
      _this269._camera = new hr();
      _this269.effects = new Map();
      _this269.blueNoiseTexture = new ci();
      _this269._renderToScreen = !0;
      _this269._isUIOverlayEnabled = !1;
      _this269.clock = new by(), _this269.renderer = e, _this269.debug = !1, _this269.effects.set("bloom", new lf()), _this269.effects.set("chromaticAberration", new uf()), _this269.effects.set("vignette", new pf()), _this269.effects.set("noise", new ff()), _this269.effects.set("colorAverage", new df()), _this269.effects.set("hueSaturation", new hf()), _this269.effects.set("brightnessContrast", new cf()), _this269.effects.set("depthOfField", new mf()), _this269.effects.set("pixelation", new gf()), _this269.effectComposer = new px(_this269.renderer), _this269.effectComposer.autoRenderToScreen = !1, _this269.opaquePass = new Kc(!0, _this269.scene, _this269.camera), _this269.opaquePass.clear = !0, _this269.transmissionPass = new fx(_this269.scene, _this269.camera, _this269.renderer), _this269.aoPass = new yx(_this269.scene, _this269.camera), _this269.taaPass = new hx(), _this269.taaPass.renderToScreen = !1, _this269.helperPass = new mx(_this269.camera), _this269.helperPass.renderToScreen = !1, _this269.stylesOverlayPass = new vx(), _this269.stylesOverlayPass.enabled = !1, _this269.uiOverlayPass = new bx(), _this269.uiOverlayPass.enabled = !1, _this269.sceneTransitionPass = new xx(), _this269.sceneTransitionPass.enabled = !1, _this269._initCopyPass(), _this269._initPasses();
      return _this269;
    }
    _createClass(Bm, [{
      key: "overlayTexture",
      get: function get() {
        return this.stylesOverlayPass.texture;
      },
      set: function set(e) {
        e !== void 0 ? (this.stylesOverlayPass.texture = e, this.stylesOverlayPass.enabled = !0) : this.stylesOverlayPass.enabled = !1;
      }
    }, {
      key: "sceneHelpers",
      get: function get() {
        return this.helperPass.sceneHelpers;
      },
      set: function set(e) {
        this.helperPass.sceneHelpers = e;
      }
    }, {
      key: "sceneHelpersOnTop",
      get: function get() {
        return this.helperPass.sceneHelpersOnTop;
      },
      set: function set(e) {
        this.helperPass.sceneHelpersOnTop = e;
      }
    }, {
      key: "scene",
      get: function get() {
        return this._scene;
      },
      set: function set(e) {
        this._scene = e, this.opaquePass.setScene(e), this.transmissionPass.setScene(e), this.aoPass.setScene(e);
      }
    }, {
      key: "camera",
      get: function get() {
        return this._camera;
      },
      set: function set(e) {
        this._camera = e, this.opaquePass.setCamera(e), this.transmissionPass.setCamera(e), this.aoPass.setCamera(e), this.helperPass.setCamera(e);
      }
    }, {
      key: "updateRenderToScreen",
      value: function updateRenderToScreen() {
        var e = !1;
        for (var r = this.effectComposer.passes.length - 1; r >= 0; r--) {
          var _i130 = this.effectComposer.passes[r];
          if (_i130.enabled === !0 && !e && this._renderToScreen) {
            _i130.renderToScreen = !0, e = !0;
            continue;
          }
          _i130.renderToScreen = !1;
        }
      }
    }, {
      key: "isUIOverlayEnabled",
      get: function get() {
        return this._isUIOverlayEnabled;
      }
    }, {
      key: "disableUIOverlay",
      value: function disableUIOverlay() {
        this._isUIOverlayEnabled = !1;
      }
    }, {
      key: "enableUIOverlay",
      value: function enableUIOverlay() {
        this._isUIOverlayEnabled = !0;
      }
    }, {
      key: "disableHelpers",
      value: function disableHelpers() {
        this.helperPass.enabled = !1, this.updateRenderToScreen();
      }
    }, {
      key: "enableHelpers",
      value: function enableHelpers() {
        this.helperPass.enabled = !0, this.updateRenderToScreen();
      }
    }, {
      key: "updateBlueNoiseTexture",
      value: function updateBlueNoiseTexture(e) {
        this.blueNoiseTexture = new ci(e, 128, 128), this.blueNoiseTexture.wrapS = Is, this.blueNoiseTexture.wrapT = Is, this.blueNoiseTexture.minFilter = Et, this.blueNoiseTexture.magFilter = Et, this.blueNoiseTexture.needsUpdate = !0;
      }
    }, {
      key: "setAmbientOcclusionParams",
      value: function setAmbientOcclusionParams(e, r, i, s, o, a, l, u) {
        this.aoPass.enabled = e, this.aoPass.radius = r, this.aoPass.bias = i, this.aoPass.aoColor = s, this.aoPass.fogEnabled = o, this.aoPass.fogNear = a, this.aoPass.fogFar = l, this.aoPass.runHalfRes !== !u && (this.aoPass.runHalfRes = !u);
      }
    }, {
      key: "setTransmissionPassEnabled",
      value: function setTransmissionPassEnabled(e) {
        this.transmissionPass.enabled = e, this.opaquePass.hasTransmissionPass = e;
      }
    }, {
      key: "_initPasses",
      value: function _initPasses() {
        var _this$uvEffectPass, _this$effectPass;
        if ((_this$uvEffectPass = this.uvEffectPass) !== null && _this$uvEffectPass !== void 0 && _this$uvEffectPass.dispose(), (_this$effectPass = this.effectPass) !== null && _this$effectPass !== void 0 && _this$effectPass.dispose(), this.effectComposer.removeAllPasses(), this.transmissionPass.updatePasses(this.renderer), this.effectComposer.addPass(this.aoPass), this.effectComposer.addPass(this.opaquePass), this.effectComposer.addPass(this.transmissionPass), this.effectComposer.addPass(this.taaPass), this.postprocessingState.enabled) {
          var e = [this.effects.get("pixelation")].reduce(d3, []);
          e.length > 0 && (this.uvEffectPass = _construct(Qc, [this.camera].concat(_toConsumableArray(e))), this.uvEffectPass.renderToScreen = !1, this.effectComposer.addPass(this.uvEffectPass));
          var r = [this.effects.get("chromaticAberration"), this.effects.get("bloom"), this.effects.get("colorAverage"), this.effects.get("hueSaturation"), this.effects.get("brightnessContrast"), this.effects.get("vignette"), this.effects.get("noise")].reduce(d3, []);
          r.length > 0 && (this.effectPass = _construct(Qc, [this.camera].concat(_toConsumableArray(r))), this.effectPass.renderToScreen = !1, this.effectComposer.addPass(this.effectPass));
        }
        this.effectComposer.addPass(this.stylesOverlayPass), this.effectComposer.addPass(this.uiOverlayPass), this.effectComposer.addPass(this.sceneTransitionPass), this.effectComposer.addPass(this.helperPass);
      }
    }, {
      key: "_initCopyPass",
      value: function _initCopyPass() {
        if (this._savePass) return;
        var e = new N();
        this.renderer.getDrawingBufferSize(e), this._rt = new at(e.x, e.y, {
          depthBuffer: !1,
          stencilBuffer: !1,
          wrapS: Is,
          wrapT: Is
        }), this._rt.samples = 0, this._savePass = new Rm(this._rt, !1), this._savePass.renderToScreen = !1;
      }
    }, {
      key: "setCopyPass",
      value: function setCopyPass(e) {
        this._rt = e, this._savePass = new Rm(this._rt, !1), this.renderToScreen = !1;
      }
    }, {
      key: "renderToScreen",
      get: function get() {
        return this._renderToScreen;
      },
      set: function set(e) {
        if (this._renderToScreen === e) return;
        var r = this.effectComposer;
        !r || (e === !0 ? r.removePass(this._savePass) : r.addPass(this._savePass), this._renderToScreen = e, this.updateRenderToScreen());
      }
    }, {
      key: "sceneTransitionFromTexture",
      set: function set(e) {
        e !== this.sceneTransitionPass.texture && (e !== null ? this.sceneTransitionPass.enabled = !0 : (this.sceneTransitionPass.enabled = !1, this.updateRenderToScreen()), this.sceneTransitionPass.texture = e);
      }
    }, {
      key: "texture",
      get: function get() {
        return this._rt && this._rt.texture;
      }
    }, {
      key: "renderTarget",
      get: function get() {
        return this._rt;
      }
    }, {
      key: "updatePostprocessing",
      value: function updatePostprocessing(e) {
        var r = e.enabled,
          i = _objectWithoutProperties(e, _excluded5),
          s = !1;
        r !== this.postprocessingState.enabled && (s = !0);
        for (var _i131 = 0, _Object$entries34 = Object.entries(i); _i131 < _Object$entries34.length; _i131++) {
          var o = _Object$entries34[_i131];
          var a = o[1],
            l = this.effects.get(o[0]);
          if (l) {
            l.enabled !== a.enabled && (s = !0), l.enabled = a.enabled;
            for (var _i132 = 0, _Object$entries35 = Object.entries(a); _i132 < _Object$entries35.length; _i132++) {
              var _Object$entries35$_i = _slicedToArray(_Object$entries35[_i132], 2),
                u = _Object$entries35$_i[0],
                c = _Object$entries35$_i[1];
              u === "blendFunction" ? l.blendFunction = bQ(c) : l[u] = c;
            }
          }
        }
        this.postprocessingState = e, s && this._initPasses();
      }
    }, {
      key: "render",
      value: function render() {
        this.effectComposer.render(this.clock.getDelta());
      }
    }, {
      key: "setScissor",
      value: function setScissor(e, r, i, s) {
        e instanceof He ? (this.effectComposer.inputBuffer.scissor.set(e.x, e.y, e.z, e.w), this.effectComposer.outputBuffer.scissor.set(e.x, e.y, e.z, e.w)) : (this.effectComposer.inputBuffer.scissor.set(e, r, i, s), this.effectComposer.outputBuffer.scissor.set(e, r, i, s));
        var o = this.renderer.getPixelRatio();
        this.effectComposer.inputBuffer.scissor.multiplyScalar(o), this.effectComposer.outputBuffer.scissor.multiplyScalar(o), this.renderer.setScissor(e, r, i, s);
      }
    }, {
      key: "setScissorTest",
      value: function setScissorTest(e) {
        this.effectComposer.inputBuffer.scissorTest = e, this.effectComposer.outputBuffer.scissorTest = e, this.renderer.setScissorTest(e);
      }
    }, {
      key: "setViewport",
      value: function setViewport(e, r, i, s) {
        e instanceof He ? (this.effectComposer.inputBuffer.viewport.copy(e), this.effectComposer.outputBuffer.viewport.copy(e)) : (this.effectComposer.inputBuffer.viewport.set(e, r, i, s), this.effectComposer.outputBuffer.viewport.set(e, r, i, s));
      }
    }, {
      key: "resize",
      value: function resize(e, r, i) {
        if (this.effectComposer.setSize(e, r, i), this._rt) {
          var _s62 = this.renderer.getPixelRatio();
          this._rt.setSize(e * _s62, r * _s62);
        }
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this$uvEffectPass2, _this$effectPass2;
        (_this$uvEffectPass2 = this.uvEffectPass) !== null && _this$uvEffectPass2 !== void 0 && _this$uvEffectPass2.dispose(), (_this$effectPass2 = this.effectPass) !== null && _this$effectPass2 !== void 0 && _this$effectPass2.dispose(), this.effectComposer.dispose();
      }
    }]);
    return Bm;
  }(ir);
var SQ = function SQ(n) {
    return "\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ".concat(n, ";\nconst int gShadowSamples = ").concat(n, ";\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, ", 5, " - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n");
  },
  wQ = ht.lights_fragment_begin,
  AQ = ht.shadowmask_pars_fragment,
  h3 = null,
  _Q = function _Q(n) {
    switch (n) {
      case "low":
        return 8;
      case "medium":
        return 16;
      case "high":
        return 32;
      default:
        return 16;
    }
  },
  f3 = function f3() {
    var n = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "medium";
    if (h3 === n) return !1;
    h3 = n;
    var t = _Q(n);
    ht.shadowmap_pars_fragment = SQ(t);
    var e = wQ.slice();
    e = e.replace("getShadow( spotShadowMap[ i ]", "getShadow( UNROLLED_LOOP_INDEX + ".concat(3, ", spotShadowMap[ i ]")), e = e.replace("getShadow( directionalShadowMap[ i ]", "getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"), ht.lights_fragment_begin = e;
    var r = AQ.slice();
    return r = r.replaceAll("getShadow(", "getShadow( UNROLLED_LOOP_INDEX, "), ht.shadowmask_pars_fragment = r, !0;
  };
var EQ = "\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n\nvoid main()\n{\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n}\n",
  TQ = "\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",
  Sx = new rt({
    vertexShader: EQ,
    fragmentShader: TQ,
    uniforms: {
      depthContrast: {
        value: 1
      }
    }
  });
var p3 = new qt(),
  wx = /*#__PURE__*/function (_dw2) {
    _inherits(wx, _dw2);
    var _super270 = _createSuper(wx);
    function wx(e) {
      var _this270;
      _classCallCheck(this, wx);
      _this270 = _super270.call(this, e);
      _this270._pixelRatio = _this270.getPixelRatio();
      _this270.viewportWidth = 1;
      _this270.viewportHeight = 1;
      _this270.resolution = new N();
      _this270.pipeline = new Bm(_assertThisInitialized(_this270));
      _this270.dummyCamera = new hr();
      _this270.sceneTransitionDuration = 0;
      _this270.sceneTransitionTimeRemaining = -1;
      _this270.isXRCopyPassSet = !1;
      _this270.clear = function () {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
        var s = _this270.getContext(),
          o = 0;
        e && (o |= s.COLOR_BUFFER_BIT), r && (o |= s.DEPTH_BUFFER_BIT), i && (o |= s.STENCIL_BUFFER_BIT), s.clear(o), s.clearBufferfv(s.COLOR, 1, [0, 0, 0, 1]);
      };
      _this270.autoClear = !1;
      var r = _this270.setPixelRatio.bind(_assertThisInitialized(_this270)),
        i = _this270.setSize.bind(_assertThisInitialized(_this270));
      _this270.shadowMap.enabled = !0, _this270.shadowMap.type = Ty, _this270.dummyCamera.matrixAutoUpdate = !1;
      var s = _this270.getContext();
      if (s && "drawingBufferColorSpace" in s) try {
        s.drawingBufferColorSpace = "display-p3";
      } catch (o) {
        console.warn(o);
      }
      _this270.setPixelRatio = function (o) {
        _this270._pixelRatio !== o && (_this270._pixelRatio = o, r(o));
      }, _this270.setSize = function (o, a) {
        var _this270$normalRender, _this270$transmission;
        var l = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
        (_this270.viewportWidth !== o || _this270.viewportHeight !== a) && (_this270.viewportWidth = o, _this270.viewportHeight = a, i(o, a, l), (_this270$normalRender = _this270.normalRenderTarget) !== null && _this270$normalRender !== void 0 && _this270$normalRender.setSize(o * _this270._pixelRatio, a * _this270._pixelRatio), _this270._resizeTransmission(o, a), (_this270$transmission = _this270.transmissionDepthTarget) !== null && _this270$transmission !== void 0 && _this270$transmission.setSize(o * _this270._pixelRatio / 2, a * _this270._pixelRatio / 2), _this270.pipeline.resize(o, a, l));
      }, _this270._superDispose = _this270.dispose, _this270.dispose = _this270._currentDispose;
      return _this270;
    }
    _createClass(wx, [{
      key: "createAORenderTarget",
      value: function createAORenderTarget() {
        this.aoRenderTarget === void 0 && (this.aoRenderTarget = new at(this.viewportWidth * this._pixelRatio, this.viewportHeight * this._pixelRatio, {
          generateMipmaps: !1,
          minFilter: Qe,
          magFilter: Qe,
          wrapS: Ut,
          wrapT: Ut,
          depthBuffer: !1
        }));
      }
    }, {
      key: "_resizeTransmission",
      value: function _resizeTransmission(e, r) {
        var _this$transmissionRen, _this$aoRenderTarget;
        (_this$transmissionRen = this.transmissionRenderTarget) !== null && _this$transmissionRen !== void 0 && _this$transmissionRen.setSize(e * this._pixelRatio / (this.hdTransmission ? 1 : 2), r * this._pixelRatio / (this.hdTransmission ? 1 : 2)), (_this$aoRenderTarget = this.aoRenderTarget) === null || _this$aoRenderTarget === void 0 ? void 0 : _this$aoRenderTarget.setSize(e * this._pixelRatio / 1, r * this._pixelRatio / 1);
      }
    }, {
      key: "hdTransmission",
      get: function get() {
        return We.transmissionLod.value === 1;
      },
      set: function set(e) {
        We.transmissionLod.value = e === !0 ? 1 : 2, this._resizeTransmission(this.viewportWidth, this.viewportHeight);
      }
    }, {
      key: "createTransmissionRenderTarget",
      value: function createTransmissionRenderTarget() {
        this.transmissionRenderTarget === void 0 && (this.transmissionRenderTarget = new at(this.viewportWidth * this._pixelRatio / (this.hdTransmission ? 1 : 2), this.viewportHeight * this._pixelRatio / (this.hdTransmission ? 1 : 2), {
          generateMipmaps: !0,
          minFilter: dc,
          magFilter: Qe,
          wrapS: Ut,
          wrapT: Ut,
          depthBuffer: !1
        }), this.transmissionDepthTarget = new at(this.viewportWidth * this._pixelRatio / 2, this.viewportHeight * this._pixelRatio / 2, {
          minFilter: Et,
          magFilter: Et,
          depthBuffer: !1
        }));
      }
    }, {
      key: "createNormalRenderTarget",
      value: function createNormalRenderTarget() {
        this.normalRenderTarget === void 0 && (this.normalRenderTarget = new at(this.viewportWidth * this._pixelRatio, this.viewportHeight * this._pixelRatio, {
          generateMipmaps: !1,
          minFilter: Et,
          magFilter: Et,
          type: dr,
          depthTexture: new is(this.viewportWidth * this._pixelRatio, this.viewportHeight * this._pixelRatio)
        }));
      }
    }, {
      key: "renderNormal",
      value: function renderNormal(e, r, i) {
        this.normalRenderTarget && (this.setClearColor(0), i.layers.enable(8), i.layers.disable(0), i.layers.disable(3), r.traverseEntity(function (s) {
          s.layers.isEnabled(8) && (s.copyPreviousMatrix = !1);
        }), this.setRenderTarget(this.normalRenderTarget), this.clear(), i instanceof hr ? Sx.uniforms.depthContrast.value = (i.far - i.near) / 1e4 : Sx.uniforms.depthContrast.value = 1, r.overrideMaterial = Sx, this.render(r, i), this.setClearColor(r.bgColor, r.bgColor.a), this.setRenderTarget(null), r.overrideMaterial = e.wireframeState ? Ax : null, i.layers.enable(0), i.layers.enable(3), r.traverseEntity(function (s) {
          s.layers.isEnabled(8) && (s.copyPreviousMatrix = !0);
        }));
      }
    }, {
      key: "renderSplineSceneWithDummyCamera",
      value: function renderSplineSceneWithDummyCamera(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
        this.dummyCamera.updateCameraState(r.dataPatched), this.dummyCamera.matrix.copy(r.matrixWorld);
        var s = r.height,
          o = r.width,
          a = this.viewportWidth / this.viewportHeight;
        o < s ? o = s * a : s = o / a, this.dummyCamera.setViewplaneSize(o, s);
        for (var l = 0; l < i; l++) this.renderSplineScene(e, this.dummyCamera);
      }
    }, {
      key: "renderSplineScene",
      value: function renderSplineScene(e, r) {
        var _l$uiCanvas;
        var _ref48 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
          _ref48$sceneHelpers = _ref48.sceneHelpers,
          i = _ref48$sceneHelpers === void 0 ? void 0 : _ref48$sceneHelpers,
          _ref48$sceneHelpersOn = _ref48.sceneHelpersOnTop,
          s = _ref48$sceneHelpersOn === void 0 ? void 0 : _ref48$sceneHelpersOn,
          _ref48$overrideTransm = _ref48.overrideTransmission,
          o = _ref48$overrideTransm === void 0 ? void 0 : _ref48$overrideTransm,
          _ref48$overrideNormal = _ref48.overrideNormal,
          a = _ref48$overrideNormal === void 0 ? void 0 : _ref48$overrideNormal;
        var l = e instanceof Vl ? e.activePage : e,
          u = l.visible;
        l.visible = !0;
        var c = l.scene;
        this.xr.enabled && (this.isXRCopyPassSet === !1 && this.getRenderTarget() !== null && (this.pipeline.setCopyPass(this.getRenderTarget()), this.isXRCopyPassSet = !0), this.xr.updateCamera(r)), this.setClearColor(l.bgColor, l.bgColor.a), l.penumbraSizeArray.forEach(function (p, m) {
          We.penumbraSize.value[m] = p;
        }), We.pixelRatioNode.value = this.getPixelRatio(), this.resolution.x !== 0 && this.resolution.y !== 0 ? We.resolution.value.set(this.resolution.x, this.resolution.y) : We.resolution.value.set(this.viewportWidth * this._pixelRatio, this.viewportHeight * this._pixelRatio), a !== void 0 ? (We.normalRenderTarget.value = a, We.normalRenderTargetDepth.value = p3) : c.needsNormal() && (this.createNormalRenderTarget(), We.normalRenderTarget.value = this.normalRenderTarget.texture, We.normalRenderTargetDepth.value = this.normalRenderTarget.depthTexture, this.renderNormal(c, l, r));
        var d = l.data.ao,
          h = d.occlusion;
        h && (this.createAORenderTarget(), We.aoRenderTarget.value = this.aoRenderTarget.texture), We.aoEnabled.value = h, this.pipeline.setAmbientOcclusionParams(d.occlusion, d.radius, d.bias, l.aoColor, l.fog !== null, l.backupFog.near, l.backupFog.far, d.aoFullRes), this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture), this.pipeline.isUIOverlayEnabled && (_l$uiCanvas = l.uiCanvas) !== null && _l$uiCanvas !== void 0 && _l$uiCanvas.enabled && l.uiCanvas.texture && l.uiCanvas.texture.image.width > 0 ? ((l.uiCanvas.width !== this.viewportWidth || l.uiCanvas.height !== this.viewportHeight) && l.uiCanvas.applySize({
          width: this.viewportWidth,
          height: this.viewportHeight
        }), l.uiCanvas.render(), this.pipeline.uiOverlayPass.uiCanvas = l.uiCanvas, this.pipeline.uiOverlayPass.enabled = !0, this.pipeline.uiOverlayPass.setResolution(this.domElement.width, this.domElement.height, window.devicePixelRatio), this.pipeline.updateRenderToScreen()) : (this.pipeline.uiOverlayPass.enabled = !1, this.pipeline.updateRenderToScreen());
        var f = !1;
        if (o !== void 0) We.transmissionRenderTarget.value = o, We.transmissionRenderTargetDepth.value = p3, this.pipeline.setTransmissionPassEnabled(!1);else {
          var p = c.needsTransmission();
          p && (this.transmissionRenderTarget === void 0 && (f = !0), this.createTransmissionRenderTarget(), We.transmissionRenderTarget.value = this.transmissionRenderTarget.texture, We.aspectRatio.value = NI(this.viewportWidth, this.viewportHeight), We.transmissionRenderTargetDepth.value = this.transmissionDepthTarget.texture), this.pipeline.setTransmissionPassEnabled(p);
        }
        r.layers.enable(3), r.layers.enable(8), this.pipeline.sceneHelpers = i, this.pipeline.sceneHelpersOnTop = s, this.pipeline.scene = l, this.pipeline.camera = r, f && this.pipeline.transmissionPass.updatePasses(this), this.pipeline.postprocessingState !== l.postprocessing && (this.pipeline.updatePostprocessing(l.postprocessing), !i && !s && this.pipeline.disableHelpers()), this.clearAlphaOverride !== void 0 && this.setClearAlpha(this.clearAlphaOverride), l.overrideMaterial = c.wireframeState ? Ax : null, this.pipeline.render(), We.frameIndex.value = (We.frameIndex.value + 1) % 16, r instanceof hr && r.copyHistory(), l.visible = u;
      }
    }, {
      key: "renderFromSceneForSceneTransitionPass",
      value: function renderFromSceneForSceneTransitionPass(e, r, i) {
        this.pipeline.renderToScreen = !1, this.pipeline.renderTarget, this.renderSplineScene(e, r), this.pipeline.sceneTransitionFromTexture = this.pipeline.renderTarget.texture, this.sceneTransitionDuration = i, this.sceneTransitionTimeRemaining = i, this.pipeline.renderToScreen = !0;
        var s = this.pipeline.sceneTransitionPass.uniforms;
        s.uDPR.value = window.devicePixelRatio, s.uResolution.value.set(this.domElement.width, this.domElement.height).divideScalar(window.devicePixelRatio);
      }
    }, {
      key: "_currentDispose",
      value: function _currentDispose() {
        var _this$aoRenderTarget2, _this$transmissionRen2, _this$transmissionDep, _this$normalRenderTar, _this$normalRenderTar2;
        this._superDispose(), this.pipeline.dispose(), (_this$aoRenderTarget2 = this.aoRenderTarget) !== null && _this$aoRenderTarget2 !== void 0 && _this$aoRenderTarget2.dispose(), (_this$transmissionRen2 = this.transmissionRenderTarget) !== null && _this$transmissionRen2 !== void 0 && _this$transmissionRen2.dispose(), (_this$transmissionDep = this.transmissionDepthTarget) !== null && _this$transmissionDep !== void 0 && _this$transmissionDep.dispose(), (_this$normalRenderTar = this.normalRenderTarget) !== null && _this$normalRenderTar !== void 0 && _this$normalRenderTar.dispose(), (_this$normalRenderTar2 = this.normalRenderTarget) === null || _this$normalRenderTar2 === void 0 || (_this$normalRenderTar2 = _this$normalRenderTar2.depthTexture) === null || _this$normalRenderTar2 === void 0 ? void 0 : _this$normalRenderTar2.dispose();
      }
    }]);
    return wx;
  }(dw);
var xf = /*#__PURE__*/function (_Bo3) {
  _inherits(xf, _Bo3);
  var _super271 = _createSuper(xf);
  function xf(e) {
    var _this271;
    var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 15;
    var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10066329;
    _classCallCheck(this, xf);
    _this271 = _super271.call(this, e, r, i);
    _this271.object = e;
    _this271.added = !1;
    _this271.name = "DirectionalLightHelper: ".concat(e.uuid);
    return _this271;
  }
  _createClass(xf, [{
    key: "raycast",
    value: function raycast(e, r) {
      No(this.object, xf.geometryHelper, e, r);
    }
  }]);
  return xf;
}(Bo(_y));
var bf = /*#__PURE__*/function (_Bo4) {
  _inherits(bf, _Bo4);
  var _super272 = _createSuper(bf);
  function bf(e) {
    var _this272;
    var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 15;
    var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 6710886;
    _classCallCheck(this, bf);
    _this272 = _super272.call(this, e, r, i);
    _this272.object = e;
    _this272.name = "PointLightHelper: ".concat(e.uuid);
    return _this272;
  }
  _createClass(bf, [{
    key: "raycast",
    value: function raycast(e, r) {
      No(this.object, bf.geometryHelper, e, r);
    }
  }]);
  return bf;
}(Bo(Ay));
var _x = /*#__PURE__*/function (_Bo5) {
    _inherits(_x, _Bo5);
    var _super273 = _createSuper(_x);
    function _x(e) {
      var _this273;
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 6710886;
      _classCallCheck(this, _x);
      _this273 = _super273.call(this, e, r);
      _this273.object = e;
      _this273.name = "SpotLightHelper: ".concat(e.uuid);
      return _this273;
    }
    _createClass(_x, [{
      key: "raycast",
      value: function raycast(e, r) {
        No(this.object, _x.geometryHelper, e, r);
      }
    }, {
      key: "update",
      value: function update() {
        if (this.object !== void 0) {
          var e = _x._vector,
            r = this.object.distance ? this.object.distance : 1e3,
            _i133 = r * Math.tan(this.object.angle);
          this.cone.scale.set(_i133, _i133, r), e.setFromMatrixPosition(this.object.target.matrixWorld), this.cone.lookAt(e);
          var _s63 = this.color !== void 0 ? this.color : this.light.color;
          if (this.cone.material instanceof Array) for (var o = 0, a = this.cone.material.length; o < a; o++) this.cone.material[o].color.set(_s63);else this.cone.material.color.set(_s63);
        }
      }
    }]);
    return _x;
  }(Bo(wy)),
  Nm = _x;
Nm._vector = new _();
function MQ(n, t) {
  n.shadow.camera.right = t / 2, n.shadow.camera.left = -t / 2, n.shadow.camera.top = t / 2, n.shadow.camera.bottom = -t / 2, n.shadow.needsUpdate = !0;
}
var Sf = /*#__PURE__*/function (_of) {
  _inherits(Sf, _of);
  var _super274 = _createSuper(Sf);
  function Sf(t, e, r) {
    var _this274;
    _classCallCheck(this, Sf);
    _this274 = _super274.call(this), _this274.super_Entity(t, e), _this274.castShadow = !0, _this274.shadow.mapSize.width = 2048, _this274.shadow.mapSize.height = 2048, _this274.shadow.normalBias = 1, _this274.layers.enable(3);
    var s = _this274.shadow.camera;
    s.top = 1250, s.bottom = -1250, s.right = 1250, s.left = -1250, s.near = -1e4, s.far = 2500;
    var o = new nl(_this274.shadow.camera);
    o.visible = !1, _this274.gizmos.shadowmap = o;
    return _this274;
  }
  _createClass(Sf, [{
    key: "update",
    value: function update() {
      this.shadow.camera.updateProjectionMatrix();
      for (var t in this.gizmos) {
        var e = this.gizmos[t];
        e instanceof nl && e.update();
      }
    }
  }, {
    key: "updateMatrixWorld",
    value: function updateMatrixWorld(t) {
      _get(_getPrototypeOf(Sf.prototype), "updateMatrixWorld", this).call(this, t), this.objectHelper && this.objectHelper.update();
    }
  }, {
    key: "updateState",
    value: function updateState(t, e) {
      this.updateState_Light(t, e);
      var r = t.depth !== void 0 && t.depth !== this.shadow.camera.far || t.size !== void 0 && t.size / 2 !== this.shadow.camera.right;
      t.size !== void 0 && MQ(this, t.size), t.shadowRadius !== void 0 && (this.shadow.radius = t.shadowRadius), t.shadowResolution !== void 0 && (this.shadow.mapSize.set(t.shadowResolution, t.shadowResolution), this.shadow.map && (this.shadow.map.dispose(), this.shadow.map = null)), t.penumbraSize !== void 0 && e.scene.markPenumbraSizeDirty(), r && this.update();
    }
  }]);
  return Sf;
}(of(xy, xf));
var m3 = new _(),
  g3 = new _(),
  y3 = new je(),
  wf = /*#__PURE__*/function (_of2) {
    _inherits(wf, _of2);
    var _super275 = _createSuper(wf);
    function wf(t, e, r) {
      var _this275;
      _classCallCheck(this, wf);
      _this275 = _super275.call(this), _this275.super_Entity(t, e), _this275.castShadow = !0, _this275.shadow.mapSize.width = 1024, _this275.shadow.mapSize.height = 1024, _this275.shadow.normalBias = 1, _this275.layers.enable(3);
      var s = _this275.shadow.camera;
      s.fov = Se.RAD2DEG * 2 * _this275.angle, s.aspect = 1, s.near = 100, s.far = 2500;
      var o = new nl(_this275.shadow.camera);
      o.visible = !1, _this275.gizmos.shadowmap = o, _this275.update();
      return _this275;
    }
    _createClass(wf, [{
      key: "update",
      value: function update() {
        this.shadow.camera.updateProjectionMatrix();
        for (var t in this.gizmos) {
          var e = this.gizmos[t];
          e instanceof nl && e.update();
        }
      }
    }, {
      key: "updateMatrixWorld",
      value: function updateMatrixWorld(t) {
        _get(_getPrototypeOf(wf.prototype), "updateMatrixWorld", this).call(this, t), g3.setFromMatrixPosition(this.matrixWorld), y3.setFromRotationMatrix(this.matrixWorld), m3.copy(this.up).applyQuaternion(y3).negate().multiplyScalar(this.distance), this.target.position.copy(g3).add(m3), this.target.updateMatrixWorld(), this.objectHelper && this.objectHelper.update();
      }
    }, {
      key: "updateState",
      value: function updateState(t, e) {
        this.updateState_Light(t, e), t.distance !== void 0 && (this.distance = t.distance), t.decay !== void 0 && (this.decay = t.decay), t.angle !== void 0 && (this.angle = t.angle), t.penumbra !== void 0 && (this.penumbra = t.penumbra), t.shadowRadius !== void 0 && (this.shadow.radius = t.shadowRadius), t.penumbraSize !== void 0 && e.scene.markPenumbraSizeDirty(), t.shadowResolution !== void 0 && (this.shadow.mapSize.set(t.shadowResolution, t.shadowResolution), this.shadow.map && (this.shadow.map.dispose(), this.shadow.map = null));
      }
    }]);
    return wf;
  }(of(yy, Nm));
var Ct;
(function (w) {
  function n() {
    return [1, 0, 0, 0, 1, 0, 0, 0, 1];
  }
  w.identity = n;
  function t(A) {
    var E = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : w.identity();
    for (var b = 0, T = A.length; b < T; b++) E[b] = A[b];
    return E;
  }
  w.copy = t;
  function e(A, E, b, T, M, C) {
    return w.setAbcdef(w.identity(), A, E, b, T, M, C);
  }
  w.create = e;
  function r(A, E, b, T, M, C, P) {
    return A[0] = E, A[1] = T, A[2] = C, A[3] = b, A[4] = M, A[5] = P, A;
  }
  w.setAbcdef = r;
  function i(A, E) {
    var _o55 = o(A),
      _o56 = _slicedToArray(_o55, 6),
      b = _o56[0],
      T = _o56[1],
      M = _o56[2],
      C = _o56[3],
      P = _o56[4],
      D = _o56[5],
      _o57 = o(E),
      _o58 = _slicedToArray(_o57, 6),
      O = _o58[0],
      I = _o58[1],
      z = _o58[2],
      B = _o58[3],
      V = _o58[4],
      U = _o58[5],
      j = O * b + I * M,
      W = O * T + I * C,
      k = z * b + B * M,
      H = z * T + B * C,
      X = V * b + U * M + P,
      q = V * T + U * C + D;
    return w.create(j, W, k, H, X, q);
  }
  w.append = i;
  function s(A, E) {
    var _o59 = o(A),
      _o60 = _slicedToArray(_o59, 6),
      b = _o60[0],
      T = _o60[1],
      M = _o60[2],
      C = _o60[3],
      P = _o60[4],
      D = _o60[5],
      _o61 = o(E),
      _o62 = _slicedToArray(_o61, 6),
      O = _o62[0],
      I = _o62[1],
      z = _o62[2],
      B = _o62[3],
      V = _o62[4],
      U = _o62[5],
      j = b,
      W = T,
      k = M,
      H = C;
    (O !== 1 || I !== 0 || z !== 0 || B !== 1) && (j = b * O + T * z, W = b * I + T * B, k = M * O + C * z, H = M * I + C * B);
    var X = P * O + D * z + V,
      q = P * I + D * B + U;
    return w.create(j, W, k, H, X, q);
  }
  w.prepend = s;
  function o(A) {
    return [A[0], A[3], A[1], A[4], A[2], A[5]];
  }
  w.getAbcdef = o;
  function a(A) {
    var _w$getAbcdef = w.getAbcdef(A),
      _w$getAbcdef2 = _slicedToArray(_w$getAbcdef, 6),
      E = _w$getAbcdef2[0],
      b = _w$getAbcdef2[1],
      T = _w$getAbcdef2[2],
      M = _w$getAbcdef2[3],
      C = _w$getAbcdef2[4],
      P = _w$getAbcdef2[5],
      D = E * M - b * T,
      O = M / D,
      I = -b / D,
      z = -T / D,
      B = E / D,
      V = (T * P - M * C) / D,
      U = -(E * P - b * C) / D;
    return w.create(O, I, z, B, V, U);
  }
  w.invert = a;
  function l(_ref49, b) {
    var _ref50 = _slicedToArray(_ref49, 2),
      A = _ref50[0],
      E = _ref50[1];
    var _w$getAbcdef3 = w.getAbcdef(b),
      _w$getAbcdef4 = _slicedToArray(_w$getAbcdef3, 6),
      T = _w$getAbcdef4[0],
      M = _w$getAbcdef4[1],
      C = _w$getAbcdef4[2],
      P = _w$getAbcdef4[3],
      D = _w$getAbcdef4[4],
      O = _w$getAbcdef4[5];
    return [T * A + C * E + D, M * A + P * E + O];
  }
  w.apply = l;
  function u(A, E) {
    var _w$getAbcdef5 = w.getAbcdef(E),
      _w$getAbcdef6 = _slicedToArray(_w$getAbcdef5, 6),
      b = _w$getAbcdef6[0],
      T = _w$getAbcdef6[1],
      M = _w$getAbcdef6[2],
      C = _w$getAbcdef6[3],
      P = _w$getAbcdef6[4],
      D = _w$getAbcdef6[5],
      O = 1 / (b * C + M * -T),
      _A26 = _slicedToArray(A, 2),
      I = _A26[0],
      z = _A26[1];
    return [C * O * I + -M * O * z + (D * M - P * C) * O, b * O * z + -T * O * I + (-D * b + P * T) * O];
  }
  w.applyInverse = u;
  function c(A, E) {
    var b = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : E;
    var _w$getAbcdef7 = w.getAbcdef(A),
      _w$getAbcdef8 = _slicedToArray(_w$getAbcdef7, 6),
      T = _w$getAbcdef8[0],
      M = _w$getAbcdef8[1],
      C = _w$getAbcdef8[2],
      P = _w$getAbcdef8[3],
      D = _w$getAbcdef8[4],
      O = _w$getAbcdef8[5];
    return w.setAbcdef(A, T * E, M * b, C * E, P * b, D * E, O * b), A;
  }
  w.scale = c;
  function d(A, E) {
    var b = Math.cos(E),
      T = Math.sin(E),
      _w$getAbcdef9 = w.getAbcdef(A),
      _w$getAbcdef10 = _slicedToArray(_w$getAbcdef9, 6),
      M = _w$getAbcdef10[0],
      C = _w$getAbcdef10[1],
      P = _w$getAbcdef10[2],
      D = _w$getAbcdef10[3],
      O = _w$getAbcdef10[4],
      I = _w$getAbcdef10[5];
    return w.setAbcdef(A, M * b - C * T, M * T + C * b, P * b - D * T, P * T + D * b, O * b - I * T, O * T + I * b), A;
  }
  w.rotate = d;
  function h(A, E, b) {
    var _b21 = _slicedToArray(b, 2),
      T = _b21[0],
      M = _b21[1],
      C = w.translate(A, -T, -M);
    return C = w.rotate(C, E), C = w.translate(C, T, M), C;
  }
  w.rotateAround = h;
  function f(A, E, b) {
    var _w$getAbcdef11 = w.getAbcdef(A),
      _w$getAbcdef12 = _slicedToArray(_w$getAbcdef11, 6),
      T = _w$getAbcdef12[0],
      M = _w$getAbcdef12[1],
      C = _w$getAbcdef12[2],
      P = _w$getAbcdef12[3],
      D = _w$getAbcdef12[4],
      O = _w$getAbcdef12[5];
    return w.setAbcdef(A, T, M, C, P, D + E, O + b), A;
  }
  w.translate = f;
  function p(A, E, b) {
    var _w$getAbcdef13 = w.getAbcdef(A),
      _w$getAbcdef14 = _slicedToArray(_w$getAbcdef13, 4),
      T = _w$getAbcdef14[0],
      M = _w$getAbcdef14[1],
      C = _w$getAbcdef14[2],
      P = _w$getAbcdef14[3];
    return w.setAbcdef(A, T, M, C, P, E, b), A;
  }
  w.setTranslate = p;
  function m(A, E, b) {
    var _w$getAbcdef15 = w.getAbcdef(A),
      _w$getAbcdef16 = _slicedToArray(_w$getAbcdef15, 4),
      T = _w$getAbcdef16[0],
      M = _w$getAbcdef16[1],
      C = _w$getAbcdef16[2],
      P = _w$getAbcdef16[3];
    return w.setAbcdef(A, T, M, C, P, E, b), A;
  }
  w.setPosition = m;
  function g(A) {
    var _w$getAbcdef17 = w.getAbcdef(A),
      _w$getAbcdef18 = _slicedToArray(_w$getAbcdef17, 4),
      E = _w$getAbcdef18[0],
      b = _w$getAbcdef18[1],
      T = _w$getAbcdef18[2],
      M = _w$getAbcdef18[3],
      C = Math.sqrt(E * E + b * b),
      P = Math.sqrt(T * T + M * M);
    return [C, P];
  }
  w.getScale = g;
  function y(A) {
    var _w$getAbcdef19 = w.getAbcdef(A),
      _w$getAbcdef20 = _slicedToArray(_w$getAbcdef19, 6),
      E = _w$getAbcdef20[4],
      b = _w$getAbcdef20[5];
    return [E, b];
  }
  w.getPosition = y;
  function v(A, E) {
    return w.decompose(A, E).rotation;
  }
  w.getRotation = v;
  function x(A, E) {
    var _w$getAbcdef21 = w.getAbcdef(A),
      _w$getAbcdef22 = _slicedToArray(_w$getAbcdef21, 6),
      b = _w$getAbcdef22[0],
      T = _w$getAbcdef22[1],
      M = _w$getAbcdef22[2],
      C = _w$getAbcdef22[3],
      P = _w$getAbcdef22[4],
      D = _w$getAbcdef22[5],
      O = -Math.atan2(-M, C),
      I = Math.atan2(T, b),
      z = Math.abs(O + I),
      B = 0,
      V = [0, 0];
    z < 1e-5 || Math.abs(Math.PI * 2 - z) < 1e-5 ? (B = I, V[0] = V[1] = 0) : (B = 0, V[0] = O, V[1] = I);
    var U = [Math.sqrt(b * b + T * T), Math.sqrt(M * M + C * C)];
    return {
      position: [P + (E[0] * b + E[1] * M) - E[0], D + (E[0] * T + E[1] * C) - E[1]],
      scale: U,
      rotation: B,
      skew: V,
      pivot: E
    };
  }
  w.decompose = x;
  function S(A, E, b, T) {
    var M = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [0, 0];
    var _A27 = _slicedToArray(A, 2),
      C = _A27[0],
      P = _A27[1],
      _E23 = _slicedToArray(E, 2),
      D = _E23[0],
      O = _E23[1],
      _T13 = _slicedToArray(T, 2),
      I = _T13[0],
      z = _T13[1],
      _M12 = _slicedToArray(M, 2),
      B = _M12[0],
      V = _M12[1],
      U = Math.cos(b + V) * D,
      j = Math.sin(b + V) * D,
      W = -Math.sin(b - B) * O,
      k = Math.cos(b - B) * O,
      H = C - (I * U + z * W) + I,
      X = P - (I * j + z * k) + z;
    return w.create(U, j, W, k, H, X);
  }
  w.compose = S;
})(Ct || (Ct = {}));
var CQ = Math.PI / 180,
  XRe = 180 / Math.PI;
function v3(n, t, e, r, i, s) {
  var o = n - e,
    a = t - r;
  return o * o / (i * i) + a * a / (s * s) <= 1;
}
function x3(n) {
  return n * CQ;
}
function w_(n) {
  return {
    all: n = n || new Map(),
    on: function on(t, e) {
      var r = n.get(t);
      r ? r.push(e) : n.set(t, [e]);
    },
    off: function off(t, e) {
      var r = n.get(t);
      r && (e ? r.splice(r.indexOf(e) >>> 0, 1) : n.set(t, []));
    },
    emit: function emit(t, e) {
      var r = n.get(t);
      r && r.slice().map(function (i) {
        i(e);
      }), (r = n.get("*")) && r.slice().map(function (i) {
        i(t, e);
      });
    }
  };
}
var jt = /*#__PURE__*/function () {
  function jt(t, e, r) {
    var _r$dpr;
    _classCallCheck(this, jt);
    this.uuid = t;
    this.data = e;
    this.localMatrix = Ct.identity();
    this.worldMatrix = Ct.identity();
    this.ignoreCameraZoom = !1;
    this.visible = !0;
    this._singleBBox = new Ul();
    this._recursiveBBox = new Ul();
    this.singleBBoxNeedsUpdate = !0;
    this.recursiveBBoxNeedsUpdate = !0;
    this.stateSelection = null;
    this.prevState = null;
    this.currentState = null;
    this.reversibleToState = null;
    this.currentTransitionEvent = null;
    this.previousAction = null;
    this.name = "";
    this.position = [0, 0];
    this.scale = [1, 1];
    this.rotation = 0;
    this.emitter = w_();
    this.dpr = (_r$dpr = r.dpr) !== null && _r$dpr !== void 0 ? _r$dpr : 1, this.dataPatched = e;
  }
  _createClass(jt, [{
    key: "project",
    value: function project(t, e) {
      var r = this.worldMatrix;
      return e && (r = Ct.append(e.worldMatrix, r)), Ct.applyInverse(t, r);
    }
  }, {
    key: "intersects",
    value: function intersects(t, e, r) {
      return this.visible && !this.data.raycastLock && this.intersectsInLocalSpace.apply(this, _toConsumableArray(this.project([t, e], r)));
    }
  }, {
    key: "intersectsInLocalSpace",
    value: function intersectsInLocalSpace(t, e) {
      var _this$singleBBox = this.singleBBox,
        r = _this$singleBBox.min,
        i = _this$singleBBox.max;
      return t >= r[0] && t <= i[0] && e >= r[1] && e <= i[1];
    }
  }, {
    key: "applyTransforms",
    value: function applyTransforms(t) {
      t.setTransform(this.worldMatrix, this.ignoreCameraZoom);
    }
  }, {
    key: "singleBBox",
    get: function get() {
      return this.singleBBoxNeedsUpdate && (this.singleBBoxNeedsUpdate = !1, this._singleBBox.setFromObjectSize(this, !1), this._singleBBox.computeVertices(), this._singleBBox.computeEdges()), this._singleBBox;
    }
  }, {
    key: "recursiveBBox",
    get: function get() {
      return this.recursiveBBoxNeedsUpdate && (this.recursiveBBoxNeedsUpdate = !1, this._recursiveBBox.setFromObjectSize(this, !0), this._recursiveBBox.computeVertices(), this._recursiveBBox.computeEdges()), this._recursiveBBox;
    }
  }, {
    key: "updateLocalMatrix",
    value: function updateLocalMatrix() {
      this.localMatrix = Ct.compose(this.position, this.scale, x3(this.rotation), Aa.getPivot(this.dataPatched));
    }
  }, {
    key: "updateWorldMatrix",
    value: function updateWorldMatrix(t, e, r) {
      var i = this.parent;
      e && i !== null && i !== void 0 && i.updateWorldMatrix(t, !0, !1), t && this.updateLocalMatrix(), this.parent ? this.worldMatrix = Ct.append(this.parent.worldMatrix, this.localMatrix) : this.worldMatrix = Ct.copy(this.localMatrix), this.singleBBoxNeedsUpdate = !0, this.recursiveBBoxNeedsUpdate = !0;
    }
  }, {
    key: "pivot",
    get: function get() {
      return Aa.getPivot(this.data);
    }
  }, {
    key: "getCenter",
    value: function getCenter() {
      return [0, 0];
    }
  }, {
    key: "getHalfSize",
    value: function getHalfSize() {
      return [0, 0];
    }
  }, {
    key: "id",
    get: function get() {
      return this.uuid;
    }
  }, {
    key: "resetBBoxNeedsUpdateSelf",
    value: function resetBBoxNeedsUpdateSelf() {
      this.singleBBoxNeedsUpdate = !0, this.recursiveBBoxNeedsUpdate = !0;
    }
  }, {
    key: "resetBBoxNeedsUpdate",
    value: function resetBBoxNeedsUpdate() {
      this.resetBBoxNeedsUpdateSelf(), this.traverseAncestors(function (t) {
        t.resetBBoxNeedsUpdateSelf();
      });
    }
  }, {
    key: "updateTransformState",
    value: function updateTransformState(t) {
      var e = !1;
      t.position !== void 0 && (e = !0, this.position = t.position), t.rotation !== void 0 && (e = !0, this.rotation = t.rotation), t.scale !== void 0 && (e = !0, this.scale = t.scale), e && (this.updateWorldMatrix(!0, !1, !0), this.resetBBoxNeedsUpdate());
    }
  }, {
    key: "updateByOp",
    value: function updateByOp(t, e, r) {
      t.type === 0 && t.props.visible !== void 0 && (this.visible = t.props.visible), this.data = e, this.data = e;
      var i = t,
        s = wt(t.path, ["states", "*"]);
      if (s !== null) {
        if (t.type === 0) {
          var _s64 = _slicedToArray(s, 1),
            o = _s64[0];
          if ((this === null || this === void 0 ? void 0 : this.stateSelection) === o) {
            var a = _objectSpread({}, t.props);
            if (delete a.name, Object.values(t.props).some(function (l) {
              return l === void 0;
            })) {
              var l = this.data;
              if (l !== void 0) {
                var u = Tr.zoom(l, t.path.slice(2));
                if (u) for (var c in t.props) t.props[c] === void 0 && c in u && (a[c] = u[c]);
              }
            }
            i = _objectSpread(_objectSpread({}, t), {}, {
              props: a,
              path: t.path.slice(2)
            });
          }
        }
      } else if (t.type === 0) {
        var _o63 = this.stateSelection ? this.data.states.data(this.stateSelection) : void 0;
        if (_o63 !== void 0) {
          if (t.props.name !== void 0 && _o63.name) {
            var _o64 = _o63,
              _l86 = _o64.name,
              _u52 = _objectWithoutProperties(_o64, _excluded6);
            _o63 = _u52;
          }
          var _a55 = Tr.removeOverridden(t.path, t.props, _o63);
          i = _objectSpread(_objectSpread({}, t), {}, {
            props: _a55
          });
        }
      }
      this.updateByPatchedOpBase(i, wa.patch(this.data, this.stateSelection ? this.data.states.data(this.stateSelection) : void 0), r);
    }
  }, {
    key: "changeSelectedState",
    value: function changeSelectedState(t, e) {
      var _this276 = this;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      if (!(this.data.states.length === 0 && !r)) {
        var _iterator99 = _createForOfIteratorHelper(this.data.states),
          _step99;
        try {
          for (_iterator99.s(); !(_step99 = _iterator99.n()).done;) {
            var _i135 = _step99.value;
            wa.toOps(this.data, _i135.data).forEach(function (o) {
              var a = Rd.replaceProps(o, _this276.data);
              _this276.dataPatched = _this276.data, _this276.updateByPatchedOp(a, _this276.data, e);
            });
          }
        } catch (err) {
          _iterator99.e(err);
        } finally {
          _iterator99.f();
        }
        if (t !== null) {
          var _i134 = this.data.states.data(t);
          _i134 && (this.dataPatched = wa.patch(this.data, _i134), wa.toOps(this.data, _i134).forEach(function (o) {
            _this276.updateByPatchedOp(o, _this276.dataPatched, e);
          }));
        }
        r && this.updateTransformState(this.dataPatched), this.stateSelection = t;
      }
    }
  }, {
    key: "updateState",
    value: function updateState(t, e) {
      t.name !== void 0 && (this.name = t.name), t.visible !== void 0 && (this.visible = t.visible), this.updateTransformState(t);
    }
  }, {
    key: "updateByPatchedOpBase",
    value: function updateByPatchedOpBase(t, e, r) {
      this.dataPatched = e, this.updateByPatchedOp(t, e, r);
    }
  }, {
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(t, e, r) {
      t.path.length === 0 && t.type === 0 && this.updateState(t.props, r), this.requestRender();
    }
  }, {
    key: "traverseFrameAncestors",
    value: function traverseFrameAncestors(t) {
      this.traverseAncestors(function (e) {
        e.data.type === "frame2d" && t(e);
      });
    }
  }, {
    key: "traverseAncestors",
    value: function traverseAncestors(t) {
      var e = this.parent;
      for (; e;) t(e), e = e.parent;
    }
  }, {
    key: "requestRender",
    value: function requestRender() {
      this.traverseFrameAncestors(function (t) {
        t.requestRender();
      });
    }
  }, {
    key: "clone",
    value: function clone(t) {
      var e = new jt(this.uuid, this.data, t);
      return e.parent = void 0, e;
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(t, e) {
      this.emitter.on(t, e);
    }
  }, {
    key: "removeEventListener",
    value: function removeEventListener(t, e) {
      this.emitter.off(t, e);
    }
  }, {
    key: "dispatchEvent",
    value: function dispatchEvent(t) {
      var _t$target;
      this.emitter.emit(t.type, _objectSpread(_objectSpread({}, t), {}, {
        target: (_t$target = t.target) !== null && _t$target !== void 0 ? _t$target : this
      }));
    }
  }, {
    key: "traverseSortNextHelper",
    value: function traverseSortNextHelper() {
      var t = this.parent;
      if (t) {
        var e = t.children;
        if (e) {
          var r = e.indexOf(this) + 1;
          return e[r] ? e[r] : t.traverseSortNextHelper();
        }
      }
    }
  }, {
    key: "sortNext",
    value: function sortNext() {
      var t = this.children;
      return t && t.length > 0 && t[0] ? t[0] : this.traverseSortNextHelper();
    }
  }, {
    key: "isDescendantOf",
    value: function isDescendantOf(t) {
      t instanceof jt && (t = t.uuid);
      var e = this;
      for (; e.parent;) {
        if (e.parent.uuid === t) return !0;
        e = e.parent;
      }
      return !1;
    }
  }]);
  return jt;
}();
var an = /*#__PURE__*/function (_jt) {
    _inherits(an, _jt);
    var _super276 = _createSuper(an);
    function an(e, r, i) {
      var _this277;
      _classCallCheck(this, an);
      _this277 = _super276.call(this, e, r, i);
      _this277.uuid = e;
      _this277.data = r;
      _this277.context = i;
      _this277.children = [];
      return _this277;
    }
    _createClass(an, [{
      key: "add",
      value: function add(e) {
        e.parent && e.parent instanceof an && e.parent.remove(e), this.children.push(e), e.parent = this;
      }
    }, {
      key: "remove",
      value: function remove(e) {
        var r = this.children.indexOf(e);
        r >= 0 && (this.children.splice(r, 1), e.parent = void 0);
      }
    }, {
      key: "traverse",
      value: function traverse(e) {
        var r = e(this);
        if (r !== !0) {
          var _iterator100 = _createForOfIteratorHelper(this.children),
            _step100;
          try {
            for (_iterator100.s(); !(_step100 = _iterator100.n()).done;) {
              var _i136 = _step100.value;
              _i136 instanceof an ? _i136.traverse(e) : r = e(_i136);
            }
          } catch (err) {
            _iterator100.e(err);
          } finally {
            _iterator100.f();
          }
        }
      }
    }, {
      key: "intersectsChildren",
      value: function intersectsChildren(e, r, i) {
        var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
        var o = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];
        var _iterator101 = _createForOfIteratorHelper(this.children),
          _step101;
        try {
          for (_iterator101.s(); !(_step101 = _iterator101.n()).done;) {
            var a = _step101.value;
            if (a instanceof an && a.intersectsChildren(e, r, i, s, o), a.intersects(e, r, i) && (o.push(a), s)) break;
          }
        } catch (err) {
          _iterator101.e(err);
        } finally {
          _iterator101.f();
        }
        return o;
      }
    }, {
      key: "updateWorldMatrix",
      value: function updateWorldMatrix(e, r, i) {
        if (_get(_getPrototypeOf(an.prototype), "updateWorldMatrix", this).call(this, e, r, i), i && this.children) {
          var _iterator102 = _createForOfIteratorHelper(this.children),
            _step102;
          try {
            for (_iterator102.s(); !(_step102 = _iterator102.n()).done;) {
              var _s65 = _step102.value;
              _s65.updateWorldMatrix(e, !1, !0);
            }
          } catch (err) {
            _iterator102.e(err);
          } finally {
            _iterator102.f();
          }
        }
      }
    }, {
      key: "find",
      value: function find(e) {
        var r;
        return this.traverse(function (i) {
          i.uuid === e && (r = i);
        }), r;
      }
    }, {
      key: "innerDrawChildren",
      value: function innerDrawChildren(e) {
        for (var r = this.children.length - 1; r >= 0; r--) this.children[r].draw(e);
      }
    }, {
      key: "resetBBoxNeedsUpdate",
      value: function resetBBoxNeedsUpdate() {
        _get(_getPrototypeOf(an.prototype), "resetBBoxNeedsUpdate", this).call(this), this.traverse(function (e) {
          e.resetBBoxNeedsUpdateSelf();
        });
      }
    }, {
      key: "clone",
      value: function clone(e) {
        var r = new an(this.uuid, this.data, e);
        r.parent = void 0;
        var _iterator103 = _createForOfIteratorHelper(this.children),
          _step103;
        try {
          for (_iterator103.s(); !(_step103 = _iterator103.n()).done;) {
            var _i137 = _step103.value;
            r.add(_i137.clone(e));
          }
        } catch (err) {
          _iterator103.e(err);
        } finally {
          _iterator103.f();
        }
        return r;
      }
    }]);
    return an;
  }(jt),
  Ra = /*#__PURE__*/function (_an) {
    _inherits(Ra, _an);
    var _super277 = _createSuper(Ra);
    function Ra(e, r, i) {
      var _this278;
      _classCallCheck(this, Ra);
      _this278 = _super277.call(this, e, r, i);
      _this278.uuid = e;
      _this278.data = r;
      _this278.reset(r);
      return _this278;
    }
    _createClass(Ra, [{
      key: "reset",
      value: function reset(e) {
        this.data = e;
      }
    }, {
      key: "draw",
      value: function draw(e) {
        !this.visible || (e.save(), this.applyTransforms(e), this.innerDrawChildren(e), e.restore());
      }
    }, {
      key: "clone",
      value: function clone(e) {
        var r = new Ra(this.uuid, this.data, e);
        r.parent = void 0;
        var _iterator104 = _createForOfIteratorHelper(this.children),
          _step104;
        try {
          for (_iterator104.s(); !(_step104 = _iterator104.n()).done;) {
            var _i138 = _step104.value;
            r.add(_i138.clone(e));
          }
        } catch (err) {
          _iterator104.e(err);
        } finally {
          _iterator104.f();
        }
        return r;
      }
    }]);
    return Ra;
  }(an);
function PQ(n, t) {
  var _n15 = _slicedToArray(n, 2),
    _n15$ = _slicedToArray(_n15[0], 2),
    e = _n15$[0],
    r = _n15$[1],
    _n15$2 = _slicedToArray(_n15[1], 2),
    i = _n15$2[0],
    s = _n15$2[1],
    _t29 = _slicedToArray(t, 2),
    _t29$ = _slicedToArray(_t29[0], 2),
    o = _t29$[0],
    a = _t29$[1],
    _t29$2 = _slicedToArray(_t29[1], 2),
    l = _t29$2[0],
    u = _t29$2[1],
    c = (e - i) * (a - u) - (r - s) * (o - l);
  if (c === 0) return !1;
  var d = ((e - o) * (a - u) - (r - a) * (o - l)) / c,
    h = -((e - i) * (r - a) - (r - s) * (e - o)) / c;
  return d >= 0 && d <= 1 && h >= 0 && h <= 1;
}
var S3 = [[-1, 1], [-1, -1], [1, -1], [1, 1]],
  b3 = function b3(n, t, e) {
    var r = n.getCenter(),
      i = n.getHalfSize(),
      s = Ct.append(t, n.worldMatrix);
    i[0] === 0 && i[1] === 0 ? e.push(Ct.apply(r, s)) : S3.forEach(function (o) {
      var a = [o[0] * i[0] + r[0], o[1] * i[1] + r[1]];
      e.push(Ct.apply(a, s));
    });
  },
  Ul = /*#__PURE__*/function () {
    function Ul() {
      _classCallCheck(this, Ul);
      this.matrix = Ct.identity();
      this.min = [1 / 0, 1 / 0];
      this.max = [-1 / 0, -1 / 0];
      this.vertices = [];
      this.edges = [];
    }
    _createClass(Ul, [{
      key: "setFromObjectSize",
      value: function setFromObjectSize(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        t.updateWorldMatrix(), this.makeEmpty(), Ct.copy(t.worldMatrix, this.matrix);
        var r = Ct.invert(t.worldMatrix);
        this.expandByObjectSize(t, r, e);
      }
    }, {
      key: "expandByObjectSize",
      value: function expandByObjectSize(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        var i = [];
        r === !0 && t instanceof an ? t.traverse(function (s) {
          s.visible && b3(s, e, i);
        }) : b3(t, e, i), this.setFromPoints(i);
      }
    }, {
      key: "getCenter",
      value: function getCenter() {
        var _this$min = _slicedToArray(this.min, 2),
          t = _this$min[0],
          e = _this$min[1],
          _this$getHalfSize = this.getHalfSize(),
          _this$getHalfSize2 = _slicedToArray(_this$getHalfSize, 2),
          r = _this$getHalfSize2[0],
          i = _this$getHalfSize2[1];
        return Ct.apply([t + r, e + i], this.matrix);
      }
    }, {
      key: "getSize",
      value: function getSize() {
        return [this.max[0] - this.min[0], this.max[1] - this.min[1]];
      }
    }, {
      key: "getHalfSize",
      value: function getHalfSize() {
        return [(this.max[0] - this.min[0]) * .5, (this.max[1] - this.min[1]) * .5];
      }
    }, {
      key: "makeEmpty",
      value: function makeEmpty() {
        this.min = [1 / 0, 1 / 0], this.max = [-1 / 0, -1 / 0];
      }
    }, {
      key: "setFromPoints",
      value: function setFromPoints(t) {
        this.makeEmpty();
        var _iterator105 = _createForOfIteratorHelper(t),
          _step105;
        try {
          for (_iterator105.s(); !(_step105 = _iterator105.n()).done;) {
            var e = _step105.value;
            this.expandByPoint(e);
          }
        } catch (err) {
          _iterator105.e(err);
        } finally {
          _iterator105.f();
        }
      }
    }, {
      key: "expandByPoint",
      value: function expandByPoint(t) {
        this.min = [Math.min(this.min[0], t[0]), Math.min(this.min[1], t[1])], this.max = [Math.max(this.max[0], t[0]), Math.max(this.max[1], t[1])];
      }
    }, {
      key: "computeVertices",
      value: function computeVertices() {
        var _this$getHalfSize3 = this.getHalfSize(),
          _this$getHalfSize4 = _slicedToArray(_this$getHalfSize3, 2),
          t = _this$getHalfSize4[0],
          e = _this$getHalfSize4[1],
          r = this.getCenter(),
          _Ct$getAbcdef = Ct.getAbcdef(this.matrix),
          _Ct$getAbcdef2 = _slicedToArray(_Ct$getAbcdef, 4),
          i = _Ct$getAbcdef2[0],
          s = _Ct$getAbcdef2[1],
          o = _Ct$getAbcdef2[2],
          a = _Ct$getAbcdef2[3],
          l = Ct.create(i, s, o, a, r[0], r[1]);
        this.vertices = S3.map(function (_ref51) {
          var _ref52 = _slicedToArray(_ref51, 2),
            u = _ref52[0],
            c = _ref52[1];
          return Ct.apply([u * t, c * e], l);
        });
      }
    }, {
      key: "computeEdges",
      value: function computeEdges() {
        this.edges = [];
        for (var t = 0, e = this.vertices.length; t < e; ++t) this.edges.push([this.vertices[t], this.vertices[(t + 1) % e]]);
      }
    }, {
      key: "project",
      value: function project(t, e) {
        var r = this.matrix;
        return e && (r = Ct.append(e.worldMatrix, r)), Ct.applyInverse(t, r);
      }
    }, {
      key: "intersects",
      value: function intersects(t, e, r) {
        return this.intersectsInLocalSpace.apply(this, _toConsumableArray(this.project([t, e], r)));
      }
    }, {
      key: "intersectsInLocalSpace",
      value: function intersectsInLocalSpace(t, e) {
        var r = this.min,
          i = this.max;
        return t >= r[0] && t <= i[0] && e >= r[1] && e <= i[1];
      }
    }, {
      key: "containsPoint",
      value: function containsPoint(t) {
        var _t30 = _slicedToArray(t, 2),
          e = _t30[0],
          r = _t30[1],
          _this$min2 = _slicedToArray(this.min, 2),
          i = _this$min2[0],
          s = _this$min2[1],
          _this$max = _slicedToArray(this.max, 2),
          o = _this$max[0],
          a = _this$max[1];
        return e >= i && e <= o && r >= s && r <= a;
      }
    }, {
      key: "intersectsBBox2D",
      value: function intersectsBBox2D(t) {
        for (var e = 0, r = this.edges.length; e < r; e++) {
          var _i139 = this.edges[e];
          for (var _s66 = 0, o = t.edges.length; _s66 < o; _s66++) {
            var a = t.edges[_s66];
            if (PQ(_i139, a)) return !0;
          }
        }
        for (var _e63 = 0, _r56 = t.vertices.length; _e63 < _r56; _e63++) {
          var _i140 = t.vertices[_e63];
          if (this.containsPoint(_i140)) return !0;
        }
        return !1;
      }
    }, {
      key: "ensureMinMax",
      value: function ensureMinMax() {
        var t = this.min,
          e = this.max;
        this.min = [Math.min(t[0], e[0]), Math.min(t[1], e[1])], this.max = [Math.max(t[0], e[0]), Math.max(t[1], e[1])];
      }
    }, {
      key: "copy",
      value: function copy(t) {
        this.min = _toConsumableArray(t.min), this.max = _toConsumableArray(t.max), Ct.copy(t.matrix, this.matrix), this.computeVertices(), this.computeEdges();
      }
    }, {
      key: "clone",
      value: function clone() {
        var t = new Ul();
        return t.copy(this), t;
      }
    }]);
    return Ul;
  }();
var A3,
  _3 = new Promise(function (n) {
    A3 = n;
  }),
  w3 = !1;
var Ex;
function E3() {
  if (w3) return;
  if (Ex) return Ex;
  function n() {
    return _n16.apply(this, arguments);
  }
  function _n16() {
    _n16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {
      var _e$default;
      var e;
      return _regeneratorRuntime().wrap(function _callee12$(_context18) {
        while (1) switch (_context18.prev = _context18.next) {
          case 0:
            _context18.next = 2;
            return require("_bundle_loader")(require.resolve("./ui.js"));
          case 2:
            e = _context18.sent;
            A3((_e$default = e.default) !== null && _e$default !== void 0 ? _e$default : e), w3 = !0;
          case 4:
          case "end":
            return _context18.stop();
        }
      }, _callee12);
    }));
    return _n16.apply(this, arguments);
  }
  return Ex = n(), Ex;
}
function __(n) {
  var t = !1;
  return n.scene.objects.traverse(function (e, r) {
    (r.type === "Mesh" && r.geometry.type === "UIGeometry" || r.type === "Page" && r.uiFrame !== void 0) && (t = !0);
  }), t;
}
var ct, A_;
function DQ(_x40) {
  return _DQ.apply(this, arguments);
}
function _DQ() {
  _DQ = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(n) {
    var t;
    return _regeneratorRuntime().wrap(function _callee24$(_context30) {
      while (1) switch (_context30.prev = _context30.next) {
        case 0:
          _context30.next = 2;
          return _3;
        case 2:
          t = _context30.sent;
          _context30.t0 = ct;
          if (_context30.t0) {
            _context30.next = 9;
            break;
          }
          A_ || (A_ = t({
            locateFile: function locateFile() {
              return n;
            }
          }));
          _context30.next = 8;
          return A_;
        case 8:
          ct = _context30.sent;
        case 9:
        case "end":
          return _context30.stop();
      }
    }, _callee24);
  }));
  return _DQ.apply(this, arguments);
}
var T3 = Ct.identity(),
  Fm = /*#__PURE__*/function () {
    function Fm(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      _classCallCheck(this, Fm);
      this.canvas = t;
      this.dpr = e;
      this._width = 0;
      this._height = 0;
      this._strokeMode = "inside";
      this._layerBlur = 0;
      this._backgroundBlur = 0;
      this._dropShadowBlur = 0;
      this._dropShadowOffsetX = 0;
      this._dropShadowOffsetY = 0;
      this._dropShadowColor = pt.transparent;
      this._innerShadowBlur = 0;
      this._innerShadowOffsetX = 0;
      this._innerShadowOffsetY = 0;
      this._innerShadowSpread = 0;
      this._innerShadowColor = pt.transparent;
      this._fonts = new Map();
      try {
        var r = t.getBoundingClientRect();
        t.width = r.width * e, t.height = r.height * e;
      } catch (_unused29) {
        console.log(t.width, e);
      }
      this._currentM3Transform = T3, this._currentTransform = new Float32Array(T3);
    }
    _createClass(Fm, [{
      key: "init",
      value: function () {
        var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {
          var _this$_surface, _this$ctx;
          return _regeneratorRuntime().wrap(function _callee13$(_context19) {
            while (1) switch (_context19.prev = _context19.next) {
              case 0:
                if (this.wasmURL) {
                  _context19.next = 2;
                  break;
                }
                throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");
              case 2:
                _context19.next = 4;
                return DQ(this.wasmURL);
              case 4:
                this._surface = ct.MakeWebGLCanvasSurface(this.canvas);
                this.ctx = (_this$_surface = this._surface) === null || _this$_surface === void 0 ? void 0 : _this$_surface.getCanvas();
                this._paint = new ct.Paint();
                this._paint.setAntiAlias(!0);
                this._paintFill = this._paint.copy();
                this._paintFill.setStyle(ct.PaintStyle.Fill);
                this._paintStroke = this._paint.copy();
                this._paintStroke.setStyle(ct.PaintStyle.Stroke);
                (_this$ctx = this.ctx) === null || _this$ctx === void 0 ? void 0 : _this$ctx.scale(this.dpr, this.dpr);
              case 13:
              case "end":
                return _context19.stop();
            }
          }, _callee13, this);
        }));
        function init() {
          return _init.apply(this, arguments);
        }
        return init;
      }()
    }, {
      key: "currentTransform",
      get: function get() {
        return this._currentM3Transform;
      },
      set: function set(t) {
        this._currentM3Transform = t, this._currentTransform.set(t);
      }
    }, {
      key: "currentTransformBuffer",
      get: function get() {
        return this._currentTransform;
      }
    }, {
      key: "loadFont",
      value: function () {
        var _loadFont = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(t, e) {
          var r;
          return _regeneratorRuntime().wrap(function _callee14$(_context20) {
            while (1) switch (_context20.prev = _context20.next) {
              case 0:
                _context20.next = 2;
                return fetch(t);
              case 2:
                _context20.next = 4;
                return _context20.sent.arrayBuffer();
              case 4:
                r = _context20.sent;
                this.registerFont(r, e);
              case 6:
              case "end":
                return _context20.stop();
            }
          }, _callee14, this);
        }));
        function loadFont(_x41, _x42) {
          return _loadFont.apply(this, arguments);
        }
        return loadFont;
      }()
    }, {
      key: "registerFont",
      value: function registerFont(t, e) {
        if (this._fonts.has(e)) return;
        var r = ct.FontMgr.FromData(t);
        if (r) this._fonts.set(e, r);else throw new Error("Invalid font data for " + e);
      }
    }, {
      key: "width",
      get: function get() {
        return this._width;
      }
    }, {
      key: "height",
      get: function get() {
        return this._height;
      }
    }, {
      key: "strokeColor",
      set: function set(t) {
        this._paintStroke && this._paintStroke.setColor(Tx(t), ct.ColorSpace.DISPLAY_P3);
      }
    }, {
      key: "fillColor",
      set: function set(t) {
        this._paintFill && this._paintFill.setColor(Tx(t), ct.ColorSpace.DISPLAY_P3);
      }
    }, {
      key: "lineWidth",
      set: function set(t) {
        this._paintStroke && this._paintStroke.setStrokeWidth(this._strokeMode === "center" ? t : t * 2);
      }
    }, {
      key: "strokeMode",
      set: function set(t) {
        this._strokeMode = t;
      }
    }, {
      key: "dropShadowBlur",
      set: function set(t) {
        this._dropShadowBlur = t;
      }
    }, {
      key: "dropShadowColor",
      set: function set(t) {
        this._dropShadowColor = t;
      }
    }, {
      key: "dropShadowOffsetX",
      set: function set(t) {
        this._dropShadowOffsetX = t;
      }
    }, {
      key: "dropShadowOffsetY",
      set: function set(t) {
        this._dropShadowOffsetY = t;
      }
    }, {
      key: "innerShadowBlur",
      set: function set(t) {
        this._innerShadowBlur = t;
      }
    }, {
      key: "innerShadowColor",
      set: function set(t) {
        this._innerShadowColor = t;
      }
    }, {
      key: "innerShadowOffsetX",
      set: function set(t) {
        this._innerShadowOffsetX = t;
      }
    }, {
      key: "innerShadowOffsetY",
      set: function set(t) {
        this._innerShadowOffsetY = t;
      }
    }, {
      key: "innerShadowSpread",
      set: function set(t) {
        this._innerShadowSpread = t;
      }
    }, {
      key: "layerBlur",
      set: function set(t) {
        this._layerBlur = t;
      }
    }, {
      key: "backgroundBlur",
      set: function set(t) {
        this._backgroundBlur = t;
      }
    }, {
      key: "clear",
      value: function clear() {
        var _this$ctx2;
        (_this$ctx2 = this.ctx) === null || _this$ctx2 === void 0 || _this$ctx2.clear(ct.TRANSPARENT);
      }
    }, {
      key: "save",
      value: function save() {
        var _this$ctx3;
        (_this$ctx3 = this.ctx) === null || _this$ctx3 === void 0 || _this$ctx3.save();
      }
    }, {
      key: "restore",
      value: function restore() {
        var _this$ctx4;
        (_this$ctx4 = this.ctx) === null || _this$ctx4 === void 0 || _this$ctx4.restore();
      }
    }, {
      key: "beginPath",
      value: function beginPath() {
        var _this$_currentPath;
        (_this$_currentPath = this._currentPath) !== null && _this$_currentPath !== void 0 && _this$_currentPath.delete(), this._currentPath = new ct.Path();
      }
    }, {
      key: "closePath",
      value: function closePath() {
        var t = this._currentPath;
        if (t) {
          if (t.isEmpty()) return;
          var e = t.getBounds();
          (e[3] - e[1] || e[2] - e[0]) && t.close();
        }
      }
    }, {
      key: "fill",
      value: function fill() {
        this._paintInner(this._paintFill, !0);
      }
    }, {
      key: "stroke",
      value: function stroke() {
        this._paintInner(this._paintStroke, !1);
      }
    }, {
      key: "clipRect",
      value: function clipRect(t, e, r, i) {
        var _this$ctx5;
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
        var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 0;
        var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 0;
        var u = ct.XYWHRect(t, e, r, i);
        if (s === 0 && o === 0 && l === 0 && a === 0) (_this$ctx5 = this.ctx) === null || _this$ctx5 === void 0 || _this$ctx5.clipRect(u, ct.ClipOp.Intersect, !0);else {
          var _this$ctx6;
          var c = ct.RRectXY(u, s, s);
          c[4] = c[5] = s, c[6] = c[7] = o, c[8] = c[9] = a, c[10] = c[11] = l, (_this$ctx6 = this.ctx) === null || _this$ctx6 === void 0 ? void 0 : _this$ctx6.clipRRect(c, ct.ClipOp.Intersect, !0);
        }
      }
    }, {
      key: "_applyShadowOffsetMatrix",
      value: function _applyShadowOffsetMatrix() {
        if (this.ctx) {
          var t = Ct.invert(this.currentTransform);
          this.ctx.concat(t);
          var e = Ct.translate(Ct.identity(), this._dropShadowOffsetX, this._dropShadowOffsetY);
          this.ctx.concat(e), this.ctx.concat(this._currentTransform);
        }
      }
    }, {
      key: "_applyEffectsToPaint",
      value: function _applyEffectsToPaint(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
        if (this.ctx && this._currentPath) {
          var _i141,
            _s67 = !1;
          if (r && this._hasDropShadow()) {
            var _this$camera$scale, _this$camera, _a56;
            var o = t.copy();
            o.setColor(Tx(this._dropShadowColor));
            var a;
            this._dropShadowBlur > 0 && (a = ct.MaskFilter.MakeBlur(ct.BlurStyle.Normal, this._dropShadowBlur * this.dpr * ((_this$camera$scale = (_this$camera = this.camera) === null || _this$camera === void 0 ? void 0 : _this$camera.scale) !== null && _this$camera$scale !== void 0 ? _this$camera$scale : 1), !1), o.setMaskFilter(a)), this.ctx.save(), this.ctx.clipPath(this._currentPath, ct.ClipOp.Difference, !0), this._applyShadowOffsetMatrix(), e(o), this.ctx.restore(), o.delete(), (_a56 = a) === null || _a56 === void 0 ? void 0 : _a56.delete();
          }
          if (this._backgroundBlur > 0 && r) {
            this.ctx.save(), this.ctx.clipPath(this._currentPath, ct.ClipOp.Intersect, !0);
            var _o65 = ct.ImageFilter.MakeBlur(this._backgroundBlur, this._backgroundBlur, ct.TileMode.Clamp, null),
              _a57 = t.copy();
            _a57.setImageFilter(_o65), _a57.setAlphaf(1);
            var l = this._currentPath.computeTightBounds();
            this.ctx.saveLayer(_a57, l, null, ct.SaveLayerInitWithPrevious), this.ctx.drawColor(t.getColor()), this.ctx.restore(), this.ctx.restore(), _a57.delete(), _o65.delete(), _s67 = !0;
          }
          if (this._layerBlur > 0) {
            var _this$camera$scale2, _this$camera2;
            var _o66 = t.copy();
            _i141 = ct.MaskFilter.MakeBlur(ct.BlurStyle.Normal, this._layerBlur * this.dpr * ((_this$camera$scale2 = (_this$camera2 = this.camera) === null || _this$camera2 === void 0 ? void 0 : _this$camera2.scale) !== null && _this$camera$scale2 !== void 0 ? _this$camera$scale2 : 1), !1), _o66.setMaskFilter(_i141), e(_o66), _o66.delete(), _i141.delete(), _s67 = !0;
          }
          if (_s67 || e(t), r && this._hasInnerShadow()) {
            var _this$camera$scale3, _this$camera3, _this$ctx7, _a59;
            var _o67 = new ct.Paint();
            _o67.setAntiAlias(!0), _o67.setStyle(ct.PaintStyle.Fill), _o67.setColor(Tx(this._innerShadowColor));
            var _a58;
            this._innerShadowBlur > 0 && (_a58 = ct.MaskFilter.MakeBlur(ct.BlurStyle.Normal, this._innerShadowBlur * this.dpr * ((_this$camera$scale3 = (_this$camera3 = this.camera) === null || _this$camera3 === void 0 ? void 0 : _this$camera3.scale) !== null && _this$camera$scale3 !== void 0 ? _this$camera$scale3 : 1), !1), _o67.setMaskFilter(_a58));
            var _l88 = this._currentPath.computeTightBounds(),
              _l87 = _slicedToArray(_l88, 4),
              u = _l87[0],
              c = _l87[1],
              d = _l87[2],
              _h84 = _l87[3],
              f = d - u,
              p = _h84 - c;
            this.ctx.save(), this.ctx.clipPath(this._currentPath, ct.ClipOp.Intersect, !0), this.ctx.saveLayer(_o67, _l88, null, ct.SaveLayerInitWithPrevious), (_this$ctx7 = this.ctx) !== null && _this$ctx7 !== void 0 && _this$ctx7.translate(this._innerShadowOffsetX, this._innerShadowOffsetY), this.ctx.drawRect(ct.XYWHRect(-1e3 - this._innerShadowOffsetX, -1e3 - this._innerShadowOffsetY, 2e3 + f + Math.abs(this._innerShadowOffsetX * 2), 2e3 + p + Math.abs(this._innerShadowOffsetY * 2)), _o67), _o67.setBlendMode(ct.BlendMode.Clear), this.ctx.drawPath(this._currentPath, _o67), this.ctx.restore(), this.ctx.restore(), _o67.delete(), (_a59 = _a58) === null || _a59 === void 0 ? void 0 : _a59.delete();
          }
        }
      }
    }, {
      key: "_paintInner",
      value: function _paintInner(t) {
        var _this279 = this;
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
        if (this.ctx && this._currentPath && t) {
          var r = this.ctx,
            _i142 = this._currentPath;
          this._applyEffectsToPaint(t, function (s) {
            var o = !1;
            !e && _this279._strokeMode !== "center" && (r.save(), r.clipPath(_i142, _this279._strokeMode === "outside" ? ct.ClipOp.Difference : ct.ClipOp.Intersect, !0), o = !0), r.drawPath(_i142, s), o && r.restore();
          }, e);
        }
      }
    }, {
      key: "_hasDropShadow",
      value: function _hasDropShadow() {
        var _this$_dropShadowColo;
        return ((_this$_dropShadowColo = this._dropShadowColor) === null || _this$_dropShadowColo === void 0 ? void 0 : _this$_dropShadowColo.a) > 0;
      }
    }, {
      key: "_hasInnerShadow",
      value: function _hasInnerShadow() {
        var _this$_innerShadowCol;
        return ((_this$_innerShadowCol = this._innerShadowColor) === null || _this$_innerShadowCol === void 0 ? void 0 : _this$_innerShadowCol.a) > 0;
      }
    }, {
      key: "ellipse",
      value: function ellipse(t, e, r, i, s, o, a, l) {
        var _this$_currentPath2;
        if (!M3([t, e, r, i]) || !this._currentPath) return;
        if (r < 0 || i < 0) throw Error("radii cannot be negative");
        var u = ct.XYWHRect(t - r, e - i, r * 2, i * 2);
        (_this$_currentPath2 = this._currentPath) === null || _this$_currentPath2 === void 0 || _this$_currentPath2.addOval(u);
      }
    }, {
      key: "rect",
      value: function rect(t, e, r, i) {
        var _this$_currentPath3;
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;
        var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
        var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 0;
        var l = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 0;
        var u = ct.XYWHRect(t, e, r, i);
        if (!!M3(u)) if (s === 0 && o === 0 && l === 0 && a === 0) (_this$_currentPath3 = this._currentPath) === null || _this$_currentPath3 === void 0 || _this$_currentPath3.addRect(u);else {
          var _this$_currentPath4;
          var c = ct.RRectXY(u, s, s);
          c[4] = c[5] = s, c[6] = c[7] = o, c[8] = c[9] = a, c[10] = c[11] = l, (_this$_currentPath4 = this._currentPath) === null || _this$_currentPath4 === void 0 ? void 0 : _this$_currentPath4.addRRect(c);
        }
      }
    }, {
      key: "getHorizontalAlign",
      value: function getHorizontalAlign(t) {
        switch (t) {
          case 2:
            return ct.TextAlign.Right;
          case 3:
            return ct.TextAlign.Center;
          case 4:
            return ct.TextAlign.Justify;
          case 1:
          default:
            return ct.TextAlign.Left;
        }
      }
    }, {
      key: "drawTextInner",
      value: function drawTextInner(t, e, r, _ref53, l, u) {
        var _ref54 = _slicedToArray(_ref53, 4),
          i = _ref54[0],
          s = _ref54[1],
          o = _ref54[2],
          a = _ref54[3];
        var c = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : !0;
        var d = 0,
          h = this.ctx;
        if (!h) return d;
        var f = u.copy(),
          p = u.copy();
        return p.setAlphaf(0), this._applyEffectsToPaint(f, function (m) {
          e.pushPaintStyle(r, m, p), e.addText(t);
          var g = e.build();
          g.layout(o);
          var y = s;
          l === 2 ? y += (a - g.getHeight()) / 2 : l === 3 && (y += a - g.getHeight()), h.drawParagraph(g, i, y), d = g.getHeight(), e.reset(), g.delete();
        }, c), f.delete(), p.delete(), d;
      }
    }, {
      key: "drawText",
      value: function drawText(t, e) {
        var r = 0,
          i = this._fonts.get(e.font),
          s = this.ctx,
          o = this._paintFill,
          a = this._paintStroke;
        if (i && s) {
          var l = new ct.TextStyle({
              fontFamilies: [e.font],
              fontSize: e.fontSize,
              heightMultiplier: e.lineHeight,
              letterSpacing: e.letterSpacing
            }),
            u = new ct.ParagraphStyle({
              textStyle: l,
              textAlign: this.getHorizontalAlign(e.horizontalAlign)
            }),
            c = ct.XYWHRect(e.x, e.y, e.width, e.height),
            d = ct.ParagraphBuilder.Make(u, i);
          o && (r = this.drawTextInner(t, d, l, c, e.verticalAlign, o, !0)), a && (r = this.drawTextInner(t, d, l, c, e.verticalAlign, a, !1)), d.delete();
        }
        return {
          height: r
        };
      }
    }, {
      key: "render",
      value: function render() {
        var _this$_surface2;
        (_this$_surface2 = this._surface) === null || _this$_surface2 === void 0 || _this$_surface2.flush();
      }
    }, {
      key: "moveTo",
      value: function moveTo(t, e) {
        var _this$_currentPath5;
        (_this$_currentPath5 = this._currentPath) === null || _this$_currentPath5 === void 0 || _this$_currentPath5.moveTo(t, e);
      }
    }, {
      key: "lineTo",
      value: function lineTo(t, e) {
        var _this$_currentPath6;
        (_this$_currentPath6 = this._currentPath) === null || _this$_currentPath6 === void 0 || _this$_currentPath6.lineTo(t, e);
      }
    }, {
      key: "bezierCurveTo",
      value: function bezierCurveTo(t, e, r, i, s, o) {
        var _this$_currentPath7;
        (_this$_currentPath7 = this._currentPath) === null || _this$_currentPath7 === void 0 || _this$_currentPath7.cubicTo(t, e, r, i, s, o);
      }
    }, {
      key: "quadraticCurveTo",
      value: function quadraticCurveTo(t, e, r, i) {
        var _this$_currentPath8;
        (_this$_currentPath8 = this._currentPath) === null || _this$_currentPath8 === void 0 || _this$_currentPath8.quadTo(t, e, r, i);
      }
    }, {
      key: "setTransform",
      value: function setTransform(t) {
        var _this$ctx8, _this$camera4, _this$ctx9, _this$ctx11;
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        if (!this.ctx) return;
        var r = this.ctx.getTotalMatrix(),
          i = Ct.invert(r);
        if (i && this.ctx.concat(i), (_this$ctx8 = this.ctx) !== null && _this$ctx8 !== void 0 && _this$ctx8.scale(this.dpr, this.dpr), (_this$camera4 = this.camera) !== null && _this$camera4 !== void 0 && _this$camera4.enabled && ((_this$ctx9 = this.ctx) !== null && _this$ctx9 !== void 0 && _this$ctx9.concat(this.camera.worldMatrix), e)) {
          var _this$ctx10;
          var _s68 = Ct.getScale(this.camera.worldMatrix);
          (_this$ctx10 = this.ctx) === null || _this$ctx10 === void 0 || _this$ctx10.scale(1 / _s68[0], 1 / _s68[1]);
        }
        (_this$ctx11 = this.ctx) !== null && _this$ctx11 !== void 0 && _this$ctx11.concat(t), this.currentTransform = t;
      }
    }, {
      key: "transform",
      value: function transform(t) {
        var _this$ctx12;
        (_this$ctx12 = this.ctx) === null || _this$ctx12 === void 0 || _this$ctx12.concat(t);
      }
    }, {
      key: "setSize",
      value: function setSize(t, e) {
        var _this$_surface3;
        t === this._width && e === this._height || (this._width = t, this._height = e, this.canvas.style.width = t + "px", this.canvas.style.height = e + "px", this.canvas.width = t * this.dpr, this.canvas.height = e * this.dpr, this._surface && (this._surface = ct.MakeWebGLCanvasSurface(this.canvas), this.ctx = (_this$_surface3 = this._surface) === null || _this$_surface3 === void 0 ? void 0 : _this$_surface3.getCanvas()));
      }
    }]);
    return Fm;
  }();
function M3(n) {
  for (var t = 0; t < n.length; t++) if (n[t] !== void 0 && !Number.isFinite(n[t])) return !1;
  return !0;
}
function Tx(_ref55) {
  var n = _ref55.r,
    t = _ref55.g,
    e = _ref55.b,
    r = _ref55.a;
  return ct.Color4f(n, t, e, r);
}
var km = /*#__PURE__*/function () {
  function km(t, e, r) {
    _classCallCheck(this, km);
    this.uuid = t;
    this.data = e;
    this.enabled = !1;
    this.color = pt.transparent;
    this.blurRadius = 0;
    this.offset = [0, 0];
    this.spread = 0;
    this.update(e);
  }
  _createClass(km, [{
    key: "update",
    value: function update(t) {
      t.color !== void 0 && (this.color = t.color), t.enabled !== void 0 && (this.enabled = t.enabled), t.blurRadius !== void 0 && (this.blurRadius = t.blurRadius), t.offset !== void 0 && (this.offset = t.offset), t.spread !== void 0 && (this.spread = t.spread);
    }
  }]);
  return km;
}();
var zm = /*#__PURE__*/function () {
  function zm(t, e, r) {
    _classCallCheck(this, zm);
    this.uuid = t;
    this.data = e;
    this.enabled = !1;
    this.radius = 0;
    this.update(e);
  }
  _createClass(zm, [{
    key: "update",
    value: function update(t) {
      t.enabled !== void 0 && (this.enabled = t.enabled), t.radius !== void 0 && (this.radius = t.radius);
    }
  }]);
  return zm;
}();
var Mx = /*#__PURE__*/function () {
  function Mx(t, e, r) {
    _classCallCheck(this, Mx);
    this.uuid = t;
    this.data = e;
    this.enabled = !1;
    this.color = pt.transparent;
    this.update(e);
  }
  _createClass(Mx, [{
    key: "update",
    value: function update(t) {
      t.enabled !== void 0 && (this.enabled = t.enabled), t.color !== void 0 && (this.color = t.color);
    }
  }]);
  return Mx;
}();
var Cx = /*#__PURE__*/function () {
  function Cx(t, e, r) {
    _classCallCheck(this, Cx);
    this.uuid = t;
    this.data = e;
    this.enabled = !1;
    this.color = pt.transparent;
    this.thickness = 0;
    this.mode = "inside";
    this.update(e);
  }
  _createClass(Cx, [{
    key: "update",
    value: function update(t) {
      t.enabled !== void 0 && (this.enabled = t.enabled), t.color !== void 0 && (this.color = t.color), t.thickness !== void 0 && (this.thickness = t.thickness), t.mode !== void 0 && (this.mode = t.mode);
    }
  }]);
  return Cx;
}();
var Ar = /*#__PURE__*/function (_jt2) {
  _inherits(Ar, _jt2);
  var _super278 = _createSuper(Ar);
  function Ar(e, r, i) {
    var _this280;
    _classCallCheck(this, Ar);
    _this280 = _super278.call(this, e, r, i);
    _this280.uuid = e;
    _this280.data = r;
    _this280.fill = new Mx(e + "-fill", r.fill, i), _this280.stroke = new Cx(e + "-stroke", r.stroke, i), _this280.dropShadow = new km(e + "-dropShadow", r.dropShadow, i), _this280.innerShadow = new km(e + "-innerShadow", r.innerShadow, i), _this280.backgroundBlur = new zm(e + "-backgroundBlur", r.backgroundBlur, i), _this280.layerBlur = new zm(e + "-layerBlur", r.layerBlur, i);
    return _this280;
  }
  _createClass(Ar, [{
    key: "applyFillStroke",
    value: function applyFillStroke(e) {
      e.fillColor = this.fill.enabled ? this.fill.color : pt.transparent, e.strokeColor = this.stroke.enabled && this.stroke.thickness > 0 ? this.stroke.color : pt.transparent, e.strokeMode = this.stroke.mode, e.lineWidth = this.stroke.thickness;
    }
  }, {
    key: "applyFilters",
    value: function applyFilters(e) {
      this.layerBlur.enabled ? e.layerBlur = this.layerBlur.radius * 5 : e.layerBlur = 0, this.backgroundBlur.enabled ? e.backgroundBlur = this.backgroundBlur.radius * 5 : e.backgroundBlur = 0, this.dropShadow.enabled ? (e.dropShadowBlur = this.dropShadow.blurRadius * 5, e.dropShadowColor = this.dropShadow.color, e.dropShadowOffsetX = this.dropShadow.offset[0], e.dropShadowOffsetY = this.dropShadow.offset[1]) : e.dropShadowColor = pt.transparent, this.innerShadow.enabled ? (e.innerShadowSpread = this.innerShadow.spread, e.innerShadowBlur = this.innerShadow.blurRadius * 5, e.innerShadowColor = this.innerShadow.color, e.innerShadowOffsetX = this.innerShadow.offset[0], e.innerShadowOffsetY = this.innerShadow.offset[1]) : e.innerShadowColor = pt.transparent;
    }
  }, {
    key: "innerDraw",
    value: function innerDraw(e) {}
  }, {
    key: "draw",
    value: function draw(e) {
      !this.visible || (e.save(), this.applyTransforms(e), this.applyFilters(e), this.applyFillStroke(e), e.beginPath(), this.innerDraw(e), e.closePath(), this.fill.enabled && e.fill(), this.stroke.enabled && e.stroke(), e.restore());
    }
  }, {
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(e, r, i) {
      _get(_getPrototypeOf(Ar.prototype), "updateByPatchedOp", this).call(this, e, r, i), e.type === 0 && (wt(e.path, ["fill"]) ? this.fill.update(e.props) : wt(e.path, ["stroke"]) ? this.stroke.update(e.props) : wt(e.path, ["dropShadow"]) ? this.dropShadow.update(e.props) : wt(e.path, ["innerShadow"]) ? this.innerShadow.update(e.props) : wt(e.path, ["layerBlur"]) ? this.layerBlur.update(e.props) : wt(e.path, ["backgroundBlur"]) ? this.backgroundBlur.update(e.props) : this.resetBBoxNeedsUpdate());
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(Ar.prototype), "updateState", this).call(this, e, r), e.fill !== void 0 && this.fill.update(e.fill), e.stroke !== void 0 && this.stroke.update(e.stroke), e.dropShadow !== void 0 && this.dropShadow.update(e.dropShadow), e.innerShadow !== void 0 && this.innerShadow.update(e.innerShadow), e.layerBlur !== void 0 && this.layerBlur.update(e.layerBlur), e.backgroundBlur !== void 0 && this.backgroundBlur.update(e.backgroundBlur);
    }
  }, {
    key: "clone",
    value: function clone(e) {
      var r = new Ar(this.uuid, this.data, e);
      return r.parent = void 0, r;
    }
  }]);
  return Ar;
}(jt);
var Gl = /*#__PURE__*/function (_Ar) {
  _inherits(Gl, _Ar);
  var _super279 = _createSuper(Gl);
  function Gl(e, r, i) {
    var _this281;
    _classCallCheck(this, Gl);
    _this281 = _super279.call(this, e, r, i);
    _this281.uuid = e;
    _this281.data = r;
    _this281.width = 0;
    _this281.height = 0;
    _this281.updateState(r, i);
    return _this281;
  }
  _createClass(Gl, [{
    key: "innerDraw",
    value: function innerDraw(e) {
      e.ellipse(this.width * .5, this.height * .5, this.width * .5, this.height * .5, 0, 0, Math.PI * 2);
    }
  }, {
    key: "intersectsInLocalSpace",
    value: function intersectsInLocalSpace(e, r) {
      return v3(e, r, this.width * .5, this.height * .5, this.width * .5, this.height * .5);
    }
  }, {
    key: "getCenter",
    value: function getCenter() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "getHalfSize",
    value: function getHalfSize() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "updateSizeState",
    value: function updateSizeState(e) {
      var r = !1;
      e.width !== void 0 && (this.width = typeof e.width == "number" ? e.width : this.width, r = !0), e.height !== void 0 && (this.height = typeof e.height == "number" ? e.height : this.height, r = !0), r && this.updateWorldMatrix(!0, !1, !0);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(Gl.prototype), "updateState", this).call(this, e, r), this.updateSizeState(e);
    }
  }, {
    key: "clone",
    value: function clone(e) {
      var r = new Gl(this.uuid, this.data, e);
      return r.parent = void 0, r;
    }
  }]);
  return Gl;
}(Ar);
var ws = /*#__PURE__*/function (_Ar2) {
  _inherits(ws, _Ar2);
  var _super280 = _createSuper(ws);
  function ws(e, r, i) {
    var _this282;
    _classCallCheck(this, ws);
    _this282 = _super280.call(this, e, r, i);
    _this282.uuid = e;
    _this282.data = r;
    _this282.width = 0;
    _this282.height = 0;
    _this282.cornerRadius = [0, 0, 0, 0];
    _this282.updateState(r, i);
    return _this282;
  }
  _createClass(ws, [{
    key: "innerDraw",
    value: function innerDraw(e) {
      e.rect.apply(e, [0, 0, this.width, this.height].concat(_toConsumableArray(this.cornerRadius)));
    }
  }, {
    key: "getCenter",
    value: function getCenter() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "getHalfSize",
    value: function getHalfSize() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "updateCornerState",
    value: function updateCornerState(e) {
      e.cornerRadius !== void 0 && (this.cornerRadius = e.cornerRadius);
    }
  }, {
    key: "updateSizeState",
    value: function updateSizeState(e) {
      var r = !1;
      e.width !== void 0 && (this.width = typeof e.width == "number" ? e.width : this.width, r = !0), e.height !== void 0 && (this.height = typeof e.height == "number" ? e.height : this.height, r = !0), r && this.updateWorldMatrix(!0, !1, !0);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(ws.prototype), "updateState", this).call(this, e, r), this.updateSizeState(e), this.updateCornerState(e);
    }
  }, {
    key: "clone",
    value: function clone(e) {
      var r = new ws(this.uuid, this.data, e);
      return r.parent = void 0, r;
    }
  }]);
  return ws;
}(Ar);
var jl = /*#__PURE__*/function (_Ar3) {
  _inherits(jl, _Ar3);
  var _super281 = _createSuper(jl);
  function jl(e, r, i) {
    var _this283;
    _classCallCheck(this, jl);
    _this283 = _super281.call(this, e, r, i);
    _this283.uuid = e;
    _this283.data = r;
    _this283._textHeight = 0;
    _this283._textHeightDirty = !0;
    _this283.width = 0;
    _this283.height = 0;
    _this283.updateState(r, i);
    return _this283;
  }
  _createClass(jl, [{
    key: "textHeight",
    get: function get() {
      return this._textHeight;
    }
  }, {
    key: "applyFillStroke",
    value: function applyFillStroke(e) {
      e.fillColor = this.fill.enabled ? this.fill.color : pt.transparent, e.strokeColor = this.stroke.enabled && this.stroke.thickness > 0 ? this.stroke.color : pt.transparent, e.strokeMode = "center", e.lineWidth = this.stroke.thickness;
    }
  }, {
    key: "innerDraw",
    value: function innerDraw(e) {
      var _this$_fontHolder, _this$data$lineHeight, _this$data$letterSpac;
      ((_this$_fontHolder = this._fontHolder) === null || _this$_fontHolder === void 0 ? void 0 : _this$_fontHolder.arrayBuffer) && this._fontHolder.arrayBuffer.byteLength > 1 && this.data.font && e.registerFont(this._fontHolder.arrayBuffer, this.data.font);
      var r = this.data.textTransform,
        i = this.data.text.textValue.toString(),
        s = r === 2 ? i.toUpperCase() : r === 3 ? i.toLowerCase() : i,
        _e$drawText = e.drawText(s, {
          x: 0,
          y: 0,
          width: this.width,
          height: this.height,
          fontSize: this.data.fontSize,
          lineHeight: (_this$data$lineHeight = this.data.lineHeight) !== null && _this$data$lineHeight !== void 0 ? _this$data$lineHeight : 1,
          letterSpacing: (_this$data$letterSpac = this.data.letterSpacing) !== null && _this$data$letterSpac !== void 0 ? _this$data$letterSpac : 0,
          horizontalAlign: this.data.horizontalAlign,
          verticalAlign: this.data.verticalAlign,
          font: this.data.font
        }),
        o = _e$drawText.height;
      this._textHeight = o;
    }
  }, {
    key: "getCenter",
    value: function getCenter() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "getHalfSize",
    value: function getHalfSize() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "updateSizeState",
    value: function updateSizeState(e) {
      var r = !1;
      e.width !== void 0 && (this.width = typeof e.width == "number" ? e.width : this.width, r = !0), e.height !== void 0 && (this.height = typeof e.height == "number" ? e.height : this.height, r = !0), r && this.updateWorldMatrix(!0, !1, !0);
    }
  }, {
    key: "updateFontState",
    value: function updateFontState(e, _ref56) {
      var _this284 = this;
      var r = _ref56.shared;
      e.font !== void 0 && (this._fontHolder = r.getFont(e.font), this._fontHolder && !this._fontHolder.isLoaded && this._fontHolder.loadingPromise.then(function () {
        _this284.requestRender();
      }));
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(jl.prototype), "updateState", this).call(this, e, r), this.updateSizeState(e), this.updateFontState(e, r);
    }
  }, {
    key: "clone",
    value: function clone(e) {
      var r = new jl(this.uuid, this.data, e);
      return r.parent = void 0, r;
    }
  }]);
  return jl;
}(Ar);
var Af = /*#__PURE__*/function (_Ar4) {
    _inherits(Af, _Ar4);
    var _super282 = _createSuper(Af);
    function Af(e, r, i) {
      var _this285;
      _classCallCheck(this, Af);
      _this285 = _super282.call(this, e, r, i);
      _this285.uuid = e;
      _this285.data = r;
      _this285.curves = [];
      _this285.extremasBBox = {
        min: [0, 0],
        max: [0, 0]
      };
      _this285.updateState(r, i);
      return _this285;
    }
    _createClass(Af, [{
      key: "computeExtremas",
      value: function computeExtremas() {
        this.curves.length === 0 && this.computeCurves();
        var e = this.curves.map(function (s) {
            return Px.extremas(s);
          }),
          r = [1 / 0, 1 / 0],
          i = [-1 / 0, -1 / 0];
        for (var _s69 = 0, o = e.length; _s69 < o; _s69++) {
          var a = e[_s69];
          a[0][0] < r[0] && (r[0] = a[0][0]), a[0][1] < r[1] && (r[1] = a[0][1]), a[1][0] > i[0] && (i[0] = a[1][0]), a[1][1] > i[1] && (i[1] = a[1][1]);
        }
        return this.extremasBBox.min = [r[0], r[1]], this.extremasBBox.max = [i[0], i[1]], this.extremasBBox;
      }
    }, {
      key: "computeCurves",
      value: function computeCurves() {
        this.curves = [];
        for (var _i143 = 1, _s70 = this.data.points.length; _i143 < _s70; _i143++) {
          var o = this.data.points[_i143].data,
            a = this.data.points[_i143 - 1].data,
            l = {
              start: a.position,
              cp1: a.controlNext.position,
              cp2: o.controlPrevious.position,
              end: o.position
            };
          this.curves.push(l);
        }
        var e = this.data.points[0].data,
          r = this.data.points[this.data.points.length - 1].data;
        if (this.data.isClosed) {
          var _i144 = {
            start: r.position,
            cp1: r.controlNext.position,
            cp2: e.controlPrevious.position,
            end: e.position
          };
          this.curves.push(_i144);
        }
      }
    }, {
      key: "getCenter",
      value: function getCenter() {
        var _this$extremasBBox$mi = _slicedToArray(this.extremasBBox.min, 2),
          e = _this$extremasBBox$mi[0],
          r = _this$extremasBBox$mi[1],
          _this$getHalfSize5 = this.getHalfSize(),
          _this$getHalfSize6 = _slicedToArray(_this$getHalfSize5, 2),
          i = _this$getHalfSize6[0],
          s = _this$getHalfSize6[1];
        return [e + i, r + s];
      }
    }, {
      key: "getHalfSize",
      value: function getHalfSize() {
        var _this$extremasBBox = this.extremasBBox,
          e = _this$extremasBBox.min,
          r = _this$extremasBBox.max;
        return [(r[0] - e[0]) * .5, (r[1] - e[1]) * .5];
      }
    }, {
      key: "innerDraw",
      value: function innerDraw(e) {
        for (var _s71 = 0, o = this.data.points.length; _s71 < o; _s71++) {
          var a = this.data.points[_s71].data;
          if (_s71 === 0) {
            var _a$position = _slicedToArray(a.position, 2),
              l = _a$position[0],
              u = _a$position[1];
            e.moveTo(l, u);
          } else {
            var _l89 = this.data.points[_s71 - 1].data,
              _l$controlNext$positi = _slicedToArray(_l89.controlNext.position, 2),
              _u53 = _l$controlNext$positi[0],
              c = _l$controlNext$positi[1],
              _a$controlPrevious$po = _slicedToArray(a.controlPrevious.position, 2),
              d = _a$controlPrevious$po[0],
              _h85 = _a$controlPrevious$po[1],
              _a$position2 = _slicedToArray(a.position, 2),
              f = _a$position2[0],
              p = _a$position2[1],
              m = {
                start: _l89.position,
                cp1: _l89.controlNext.position,
                cp2: a.controlPrevious.position,
                end: a.position
              };
            Px.derive(m), e.bezierCurveTo(_u53, c, d, _h85, f, p);
          }
        }
        var r = this.data.points[0].data,
          i = this.data.points[this.data.points.length - 1].data;
        if (this.data.isClosed) {
          var _i$controlNext$positi = _slicedToArray(i.controlNext.position, 2),
            _s72 = _i$controlNext$positi[0],
            _o68 = _i$controlNext$positi[1],
            _r$controlPrevious$po = _slicedToArray(r.controlPrevious.position, 2),
            _a60 = _r$controlPrevious$po[0],
            _l90 = _r$controlPrevious$po[1],
            _r$position = _slicedToArray(r.position, 2),
            _u54 = _r$position[0],
            _c40 = _r$position[1];
          e.bezierCurveTo(_s72, _o68, _a60, _l90, _u54, _c40);
        }
      }
    }, {
      key: "updateState",
      value: function updateState(e, r) {
        _get(_getPrototypeOf(Af.prototype), "updateState", this).call(this, e, r), this.computeExtremas();
      }
    }, {
      key: "clone",
      value: function clone(e) {
        var r = new Af(this.uuid, this.data, e);
        return r.parent = void 0, r;
      }
    }]);
    return Af;
  }(Ar),
  Px;
(function (s) {
  function n(o) {
    var a = o.start,
      l = o.cp1,
      u = o.cp2,
      c = o.end,
      d = [3 * (l[0] - a[0]), 3 * (l[1] - a[1])],
      h = [3 * (u[0] - l[0]), 3 * (u[1] - l[1])],
      f = [3 * (c[0] - u[0]), 3 * (c[1] - u[1])],
      p = {
        start: d,
        cp: h,
        end: f
      };
    return o.derivative = p, p.derivative = E_.derive(p), p;
  }
  s.derive = n;
  function t(o, a, l) {
    var u = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
    var c = o - 2 * a + l;
    if (c !== 0) {
      var d = -Math.sqrt(Math.abs(a * a - o * l)),
        _h86 = -o + a,
        f = -(d + _h86) / c,
        p = -(-d + _h86) / c;
      return [f, p];
    } else if (a !== l && c === 0) return [(2 * a - l) / (2 * (a - l))];
    return [];
  }
  function e(o) {
    var _o$derivative;
    var a = (_o$derivative = o.derivative) !== null && _o$derivative !== void 0 ? _o$derivative : s.derive(o),
      l = a.start,
      u = a.cp,
      c = a.end;
    return [t(l[0], u[0], c[0]), t(l[1], u[1], c[1])];
  }
  s.droot = e;
  function r(o) {
    var _s$droot = s.droot(o),
      _s$droot2 = _slicedToArray(_s$droot, 2),
      a = _s$droot2[0],
      l = _s$droot2[1],
      u = [o.start[0], o.end[0]],
      c = [o.start[1], o.end[1]];
    var _iterator106 = _createForOfIteratorHelper(a),
      _step106;
    try {
      for (_iterator106.s(); !(_step106 = _iterator106.n()).done;) {
        var d = _step106.value;
        u.push(s.compute(o, Math.min(1, Math.max(0, d)))[0]);
      }
    } catch (err) {
      _iterator106.e(err);
    } finally {
      _iterator106.f();
    }
    var _iterator107 = _createForOfIteratorHelper(l),
      _step107;
    try {
      for (_iterator107.s(); !(_step107 = _iterator107.n()).done;) {
        var _d56 = _step107.value;
        c.push(s.compute(o, Math.min(1, Math.max(0, _d56)))[1]);
      }
    } catch (err) {
      _iterator107.e(err);
    } finally {
      _iterator107.f();
    }
    return u.sort(function (d, h) {
      return d - h;
    }), c.sort(function (d, h) {
      return d - h;
    }), [[u[0], c[0]], [u[u.length - 1], c[c.length - 1]]];
  }
  s.extremas = r;
  function i(o, a) {
    if (a === 0) return _toConsumableArray(o.start);
    if (a === 1) return _toConsumableArray(o.end);
    var l = 1 - a,
      u = l * l,
      c = a * a,
      d = u * l,
      h = u * a * 3,
      f = l * c * 3,
      p = a * c;
    return [d * o.start[0] + h * o.cp1[0] + f * o.cp2[0] + p * o.end[0], d * o.start[1] + h * o.cp1[1] + f * o.cp2[1] + p * o.end[1]];
  }
  s.compute = i;
})(Px || (Px = {}));
var E_;
(function (r) {
  function n(i) {
    var s = i.start,
      o = i.cp,
      a = i.end,
      l = [2 * (o[0] - s[0]), 2 * (o[1] - s[1])],
      u = [2 * (a[0] - o[0]), 2 * (a[1] - o[1])],
      c = {
        start: l,
        end: u
      };
    return c.derivative = T_.derive(c), i.derivative = c, c;
  }
  r.derive = n;
  function t(i) {
    var _i$derivative;
    var s = (_i$derivative = i.derivative) !== null && _i$derivative !== void 0 ? _i$derivative : r.derive(i),
      o = s.start,
      a = s.end;
    return [o[0] !== a[0] ? o[0] / (o[0] - a[0]) : 0, o[1] !== a[1] ? o[1] / (o[1] - a[1]) : 0];
  }
  r.droot = t;
  function e(i, s) {
    if (s === 0) return _toConsumableArray(i.start);
    if (s === 1) return _toConsumableArray(i.end);
    var o = 1 - s,
      a = o * o,
      l = s * s,
      u = a,
      c = o * s * 2,
      d = l;
    return [u * i.start[0] + c * i.cp[0] + d * i.end[0], u * i.start[1] + c * i.cp[1] + d * i.end[1]];
  }
  r.compute = e;
})(E_ || (E_ = {}));
var T_;
(function (e) {
  function n(r) {
    var i = r.start,
      s = r.end,
      o = [s[0] - i[0], s[1] - i[1]];
    return r.derivative = o, r.derivative;
  }
  e.derive = n;
  function t(r, i) {
    if (i === 0) return _toConsumableArray(r.start);
    if (i === 1) return _toConsumableArray(r.end);
    var s = r.start,
      o = r.end;
    return [s[0] + (o[0] - s[0]) * i, s[1] + (o[1] - s[1]) * i];
  }
  e.compute = t;
})(T_ || (T_ = {}));
var Zi = /*#__PURE__*/function (_an2) {
  _inherits(Zi, _an2);
  var _super283 = _createSuper(Zi);
  function Zi(e, r, i) {
    var _this286;
    _classCallCheck(this, Zi);
    _this286 = _super283.call(this, e, r, i);
    _this286.uuid = e;
    _this286.width = 0;
    _this286.height = 0;
    _this286.background = new ws(e + "-background", Zd.defaultData, i), _this286.background.parent = _assertThisInitialized(_this286), _this286.updateState(r, i);
    return _this286;
  }
  _createClass(Zi, [{
    key: "fill",
    get: function get() {
      return this.background.fill;
    }
  }, {
    key: "stroke",
    get: function get() {
      return this.background.stroke;
    }
  }, {
    key: "backgroundBlur",
    get: function get() {
      return this.background.backgroundBlur;
    }
  }, {
    key: "layerBlur",
    get: function get() {
      return this.background.layerBlur;
    }
  }, {
    key: "dropShadow",
    get: function get() {
      return this.background.dropShadow;
    }
  }, {
    key: "innerShadow",
    get: function get() {
      return this.background.innerShadow;
    }
  }, {
    key: "cornerRadius",
    get: function get() {
      return this.background.cornerRadius;
    },
    set: function set(e) {
      this.background.cornerRadius = e;
    }
  }, {
    key: "updateLocalMatrix",
    value: function updateLocalMatrix() {
      var _this$background;
      _get(_getPrototypeOf(Zi.prototype), "updateLocalMatrix", this).call(this), (_this$background = this.background) === null || _this$background === void 0 ? void 0 : _this$background.updateLocalMatrix();
    }
  }, {
    key: "updateWorldMatrix",
    value: function updateWorldMatrix(e, r, i) {
      var _this$background2;
      _get(_getPrototypeOf(Zi.prototype), "updateWorldMatrix", this).call(this, e, r, i), (_this$background2 = this.background) === null || _this$background2 === void 0 ? void 0 : _this$background2.updateWorldMatrix(e, r, i);
    }
  }, {
    key: "draw",
    value: function draw(e) {
      if (!this.visible) return;
      e.save();
      var r = this.width,
        i = this.height;
      this.applyTransforms(e), this.background.width = r, this.background.height = i, this.background.draw(e), e.clipRect.apply(e, [0, 0, r, i].concat(_toConsumableArray(this.cornerRadius))), this.innerDrawChildren(e), e.restore();
    }
  }, {
    key: "getCenter",
    value: function getCenter() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "getHalfSize",
    value: function getHalfSize() {
      return [this.width * .5, this.height * .5];
    }
  }, {
    key: "updateCornerState",
    value: function updateCornerState(e) {
      e.cornerRadius !== void 0 && (this.cornerRadius = e.cornerRadius);
    }
  }, {
    key: "updateSizeState",
    value: function updateSizeState(e) {
      var r = !1;
      e.width !== void 0 && (this.width = typeof e.width == "number" ? e.width : this.width, r = !0), e.height !== void 0 && (this.height = typeof e.height == "number" ? e.height : this.height, r = !0), r && this.updateWorldMatrix(!0, !1, !0);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(Zi.prototype), "updateState", this).call(this, e, r), this.updateSizeState(e), this.updateCornerState(e), e.fill !== void 0 && this.fill.update(e.fill), e.stroke !== void 0 && this.stroke.update(e.stroke), e.dropShadow !== void 0 && this.dropShadow.update(e.dropShadow), e.innerShadow !== void 0 && this.innerShadow.update(e.innerShadow), e.layerBlur !== void 0 && this.layerBlur.update(e.layerBlur), e.backgroundBlur !== void 0 && this.backgroundBlur.update(e.backgroundBlur);
    }
  }, {
    key: "requestRender",
    value: function requestRender() {
      _get(_getPrototypeOf(Zi.prototype), "requestRender", this).call(this), this.dispatchEvent({
        type: "render"
      });
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.removeEventListener("render");
    }
  }, {
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(e, r, i) {
      _get(_getPrototypeOf(Zi.prototype), "updateByPatchedOp", this).call(this, e, r, i), e.type === 0 && (wt(e.path, ["fill"]) ? this.fill.update(e.props) : wt(e.path, ["stroke"]) ? this.stroke.update(e.props) : wt(e.path, ["dropShadow"]) ? this.dropShadow.update(e.props) : wt(e.path, ["innerShadow"]) ? this.innerShadow.update(e.props) : wt(e.path, ["layerBlur"]) ? this.layerBlur.update(e.props) : wt(e.path, ["backgroundBlur"]) ? this.backgroundBlur.update(e.props) : this.resetBBoxNeedsUpdate());
    }
  }, {
    key: "clone",
    value: function clone(e) {
      var r = new Zi(this.uuid, this.data, e);
      r.parent = void 0;
      var _iterator108 = _createForOfIteratorHelper(this.children),
        _step108;
      try {
        for (_iterator108.s(); !(_step108 = _iterator108.n()).done;) {
          var _i145 = _step108.value;
          r.add(_i145.clone(e));
        }
      } catch (err) {
        _iterator108.e(err);
      } finally {
        _iterator108.f();
      }
      return r;
    }
  }]);
  return Zi;
}(an);
function C3(n, t, e) {
  switch (t.type) {
    case "ellipse2d":
      return new Gl(n, t, e);
    case "rectangle2d":
      return new ws(n, t, e);
    case "text2d":
      return new jl(n, t, e);
    case "vector2d":
      return new Af(n, t, e);
    case "frame2d":
      return new Zi(n, t, e);
    case "group2d":
    default:
      return new Ra(n, t, e);
  }
}
var M_ = /*#__PURE__*/function () {
    function M_(t, e, r) {
      _classCallCheck(this, M_);
      this.uuid = t;
      this.data = e;
      this.group = new Ra(M_.GROUP_ID, _objectSpread({}, Xp.defaultData), r), this.createChildrenObjects(e.objects, this.group, r);
    }
    _createClass(M_, [{
      key: "createObject",
      value: function createObject(t, e, r, i, s, o) {
        var a = C3(t, e, o);
        a && (i.add(a), i.children.splice(s, 0, i.children.pop()), a.updateWorldMatrix(), r.length > 0 && (a instanceof Ra || a instanceof Zi) && this.createChildrenObjects(r, a, o));
      }
    }, {
      key: "createChildrenObjects",
      value: function createChildrenObjects(t, e, r) {
        var i = 0;
        var _iterator109 = _createForOfIteratorHelper(t),
          _step109;
        try {
          for (_iterator109.s(); !(_step109 = _iterator109.n()).done;) {
            var _s73 = _step109.value;
            this.createObject(_s73.id, _s73.data, _s73.children, e, i, r), i += 1;
          }
        } catch (err) {
          _iterator109.e(err);
        } finally {
          _iterator109.f();
        }
      }
    }, {
      key: "draw",
      value: function draw(t) {
        this.group.draw(t);
      }
    }, {
      key: "updateEntityByOp",
      value: function updateEntityByOp(t, e, r, i) {
        var s = this.find(t);
        if (s) try {
          s.updateByOp(e, r, {
            shared: i
          });
        } catch (o) {
          console.error(o);
        }
      }
    }, {
      key: "updateTreeByOp",
      value: function updateTreeByOp(t, e) {
        if (t.path.length === 0 && t.type === 7) {
          var r = t.parent === null ? this.group : this.find(t.parent);
          r !== void 0 && r instanceof an && (this.createObject(t.id, t.data, t.children, r, t.localIndex, e), r.requestRender());
        } else if (t.path.length === 0 && t.type === 8) {
          var _r57 = this.find(t.id);
          if (_r57 !== void 0 && _r57.parent !== void 0 && _r57.parent instanceof an) {
            var _i146 = _r57.parent;
            _r57.resetBBoxNeedsUpdate(), _i146 !== null && _i146 !== void 0 && _i146.remove(_r57), _i146 === null || _i146 === void 0 ? void 0 : _i146.requestRender();
          }
        } else if (t.path.length === 0 && t.type === 9) {
          var _r58 = this.find(t.id);
          if (_r58 !== void 0) {
            var _i147 = _r58.parent,
              _s74 = t.parent === null ? this : this.find(t.parent);
            if (_s74 === void 0 && !1 && console.error("unexpected", _s74, t), _s74 instanceof an || _s74 === this) {
              _s74.add(_r58);
              var o = t.localIndex;
              _s74.children.splice(o, 0, _s74.children.pop()), _r58.updateWorldMatrix(!0, !1, !0), _i147 !== null && _i147 !== void 0 && _i147.requestRender(), _r58.requestRender();
            }
            _r58.resetBBoxNeedsUpdate();
          }
        }
      }
    }, {
      key: "add",
      value: function add(t) {
        this.group.add(t);
      }
    }, {
      key: "remove",
      value: function remove(t) {
        this.group.remove(t);
      }
    }, {
      key: "traverse",
      value: function traverse(t) {
        var _this287 = this;
        this.group.traverse(function (e) {
          e !== _this287.group && t(e);
        });
      }
    }, {
      key: "intersectsChildren",
      value: function intersectsChildren(t, e, r) {
        var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];
        return this.group.intersectsChildren(t, e, r, i, s);
      }
    }, {
      key: "find",
      value: function find(t) {
        return this.group.find(t);
      }
    }, {
      key: "children",
      get: function get() {
        return this.group.children;
      }
    }, {
      key: "project",
      value: function project(t, e) {
        return this.group.project(t, e);
      }
    }, {
      key: "getWithSortKey",
      value: function getWithSortKey(t) {
        var e = this.find(t);
        if (e === void 0) return;
        var r = [],
          i = e;
        for (; i !== this.group;) {
          var _s75 = i;
          i = i.parent;
          var o = i.children.indexOf(_s75);
          r.splice(0, 0, o);
        }
        return {
          entity: e,
          sortKey: r
        };
      }
    }, {
      key: "getAllSorted",
      value: function getAllSorted(t) {
        var e = [];
        var _iterator110 = _createForOfIteratorHelper(t),
          _step110;
        try {
          for (_iterator110.s(); !(_step110 = _iterator110.n()).done;) {
            var r = _step110.value;
            var _i148 = this.getWithSortKey(r.id);
            _i148 !== void 0 && e.push(_i148);
          }
        } catch (err) {
          _iterator110.e(err);
        } finally {
          _iterator110.f();
        }
        return e.sort(function (r, i) {
          return nv(r.sortKey, i.sortKey);
        }), e.map(function (r) {
          return r.entity;
        });
      }
    }]);
    return M_;
  }(),
  Jc = M_;
Jc.GROUP_ID = "scene2d";
function C_(_ref57) {
  var n = _ref57.constraints,
    t = _ref57.newParentWidth,
    e = _ref57.newParentHeight,
    r = _ref57.initialParentWidth,
    i = _ref57.initialParentHeight,
    s = _ref57.objectInitialWidth,
    o = _ref57.objectInitialHeight,
    a = _ref57.objectInitialPosition;
  var l = n.horizontalConstraint,
    u = n.verticalConstraint,
    c = t - r,
    d = e - i,
    h = s,
    f = o,
    p = a[0],
    m = a[1];
  if (l !== 0) {
    if (l === 1) p += c;else if (l === 3) p += c / 2;else if (l === 2) h = Math.max(1, h + c);else if (l === 4) {
      var g = t / r;
      h *= g, p *= g;
    }
  }
  if (u !== 0) {
    if (u === 1) m += d;else if (u === 3) m += d / 2;else if (u === 2) f = Math.max(1, f + d);else if (u === 4) {
      var _g43 = e / i;
      f *= _g43, m *= _g43;
    }
  }
  return {
    width: h,
    height: f,
    position: [p, m]
  };
}
var OQ = Ct.identity(),
  _f = /*#__PURE__*/function () {
    function _f(t, e, r, i) {
      var _this288 = this;
      _classCallCheck(this, _f);
      this.uuid = t;
      this.width = e;
      this.height = r;
      this.context = i;
      this.enabled = !0;
      this.isScreenSpace = !1;
      this.isFrameDirty = !1;
      this.onRenderRequestedDownstream = function () {
        _this288.isFrameDirty = !0, _this288.context.shared.requestRender();
      };
      this.onFrameOverrideObjectEvent = function (t) {
        var _t$target2;
        if (((_t$target2 = t.target) === null || _t$target2 === void 0 ? void 0 : _t$target2.uuid) !== void 0) {
          var _this288$frameRoot;
          var _e64 = (_this288$frameRoot = _this288.frameRoot) === null || _this288$frameRoot === void 0 ? void 0 : _this288$frameRoot.find(t.target.uuid);
          _e64 && _e64.dispatchEvent(_objectSpread(_objectSpread({}, t), {}, {
            target: _e64
          }));
        }
      };
      this.scene2d = new Jc(Se.generateUUID(), Jv.defaultData, {
        dpr: window.devicePixelRatio,
        shared: i.shared
      }), this.canvas = document.createElement("canvas"), this.renderer = new Fm(this.canvas), i.shared.addCanvas(this.uuid, this.canvas), this.textureHolder = i.shared.canvas(this.uuid), this.promise = this.init();
    }
    _createClass(_f, [{
      key: "init",
      value: function () {
        var _init2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {
          return _regeneratorRuntime().wrap(function _callee15$(_context21) {
            while (1) switch (_context21.prev = _context21.next) {
              case 0:
                this.renderer instanceof Fm && (this.renderer.wasmURL = z0.skiaWasmUrl);
                _context21.next = 3;
                return this.renderer.init();
              case 3:
              case "end":
                return _context21.stop();
            }
          }, _callee15, this);
        }));
        function init() {
          return _init2.apply(this, arguments);
        }
        return init;
      }()
    }, {
      key: "render",
      value: function render() {
        var _this$frameOverride, _this$textureHolder;
        this.isFrameDirty && (this.renderer.clear(), (_this$frameOverride = this.frameOverride) !== null && _this$frameOverride !== void 0 && _this$frameOverride.draw(this.renderer), this.renderer.render(), (_this$textureHolder = this.textureHolder) !== null && _this$textureHolder !== void 0 && _this$textureHolder.setNeedsUpdate(!0), this.isFrameDirty = !1);
      }
    }, {
      key: "updateEntity2DByOp",
      value: function updateEntity2DByOp(t, e, r, i) {
        this.scene2d.updateEntityByOp(t, e, r, i), this.applySize();
      }
    }, {
      key: "updateTreeByOp",
      value: function updateTreeByOp(t, e) {
        this.scene2d.updateTreeByOp(t, e), this.applySize();
      }
    }, {
      key: "applyOverrides",
      value: function applyOverrides(t) {
        if (this.frameOverride && this.frameRoot) {
          var _t$width, _t$height;
          this.frameOverride.position = [0, 0], this.frameOverride.rotation = 0;
          var e = (_t$width = t === null || t === void 0 ? void 0 : t.width) !== null && _t$width !== void 0 ? _t$width : this.width,
            r = (_t$height = t === null || t === void 0 ? void 0 : t.height) !== null && _t$height !== void 0 ? _t$height : this.height;
          this.frameOverride.width = e, this.frameOverride.height = r, this.frameOverride.localMatrix = OQ, this.isScreenSpace && (this.frameOverride.fill.color = pt.from0to1([0, 0, 0, 0])), this.frameOverride.data = _objectSpread(_objectSpread({}, this.frameOverride.data), {}, {
            width: e,
            height: r
          }), P3({
            objectOverride: this.frameOverride,
            objectRoot: this.frameRoot,
            newParentWidth: this.frameOverride.width,
            newParentHeight: this.frameOverride.height,
            initialParentWidth: this.frameRoot.width,
            initialParentHeight: this.frameRoot.height
          }), this.frameOverride.updateWorldMatrix(!0, !1, !0);
        }
      }
    }, {
      key: "applySize",
      value: function applySize(t) {
        var _t$width2, _t$height2, _this$textureHolder2, _this$frameOverride2;
        var e = (_t$width2 = t === null || t === void 0 ? void 0 : t.width) !== null && _t$width2 !== void 0 ? _t$width2 : this.width,
          r = (_t$height2 = t === null || t === void 0 ? void 0 : t.height) !== null && _t$height2 !== void 0 ? _t$height2 : this.height;
        this.width = e, this.height = r, this.renderer.dpr = this.isScreenSpace ? window.devicePixelRatio : Math.floor(2048 / Math.max(e, r)), this.renderer.setSize(e, r), (_this$textureHolder2 = this.textureHolder) !== null && _this$textureHolder2 !== void 0 && _this$textureHolder2.dispose(), this.applyOverrides(t), (_this$frameOverride2 = this.frameOverride) === null || _this$frameOverride2 === void 0 ? void 0 : _this$frameOverride2.requestRender();
      }
    }, {
      key: "applyFrame",
      value: function applyFrame(t) {
        var _this$textureHolder3,
          _this$frame,
          _this289 = this,
          _this$frame2;
        var e = this.context.scene.find2D(t);
        if (!(!e || !(e instanceof Zi))) return this.disposeFrameOverride(), this.frameRoot = e, this.frameOverride = e.clone({
          dpr: this.renderer.dpr,
          shared: this.context.shared
        }), this.scene2d.add(this.frameOverride), this.applySize(), (_this$textureHolder3 = this.textureHolder) !== null && _this$textureHolder3 !== void 0 && _this$textureHolder3.dispose(), (_this$frame = this.frame) !== null && _this$frame !== void 0 && _this$frame.addEventListener("render", this.onRenderRequestedDownstream), this.frameOverride.traverse(function (r) {
          r.addEventListener("beginState", _this289.onFrameOverrideObjectEvent);
        }), this.frameOverride.traverse(function (r) {
          r.addEventListener("completeState", _this289.onFrameOverrideObjectEvent);
        }), (_this$frame2 = this.frame) !== null && _this$frame2 !== void 0 && _this$frame2.requestRender(), e;
      }
    }, {
      key: "frame",
      get: function get() {
        return this.frameOverride;
      }
    }, {
      key: "frameId",
      get: function get() {
        var _this$frame3;
        return (_this$frame3 = this.frame) === null || _this$frame3 === void 0 ? void 0 : _this$frame3.uuid;
      }
    }, {
      key: "find",
      value: function find(t) {
        return this.scene2d.find(t);
      }
    }, {
      key: "texture",
      get: function get() {
        var _this$textureHolder4;
        return (_this$textureHolder4 = this.textureHolder) === null || _this$textureHolder4 === void 0 ? void 0 : _this$textureHolder4.getTexture(1001);
      }
    }, {
      key: "disposeFrameOverride",
      value: function disposeFrameOverride() {
        var _this$frameOverride3,
          _this$frameOverride4,
          _this290 = this,
          _this$frameOverride5;
        (_this$frameOverride3 = this.frameOverride) !== null && _this$frameOverride3 !== void 0 && _this$frameOverride3.removeEventListener("render", this.onRenderRequestedDownstream), (_this$frameOverride4 = this.frameOverride) !== null && _this$frameOverride4 !== void 0 && _this$frameOverride4.traverse(function (t) {
          t.removeEventListener("beginStateChange", _this290.onFrameOverrideObjectEvent);
        }), (_this$frameOverride5 = this.frameOverride) !== null && _this$frameOverride5 !== void 0 && _this$frameOverride5.traverse(function (t) {
          t.removeEventListener("completeState", _this290.onFrameOverrideObjectEvent);
        }), this.frameOverride && this.scene2d.remove(this.frameOverride);
      }
    }]);
    return _f;
  }();
function P3(_ref58) {
  var n = _ref58.objectOverride,
    t = _ref58.objectRoot,
    e = _ref58.newParentWidth,
    r = _ref58.newParentHeight,
    i = _ref58.initialParentWidth,
    s = _ref58.initialParentHeight;
  if (n instanceof Zi && t instanceof Zi) for (var o = 0, a = n.children.length; o < a; o++) {
    var l = n.children[o],
      u = t.children[o];
    l && u && l.uuid === u.uuid && IQ({
      objectOverride: l,
      objectRoot: u,
      newParentWidth: e,
      newParentHeight: r,
      initialParentWidth: i,
      initialParentHeight: s
    });
  }
}
function IQ(_ref59) {
  var n = _ref59.objectOverride,
    t = _ref59.objectRoot,
    e = _ref59.newParentWidth,
    r = _ref59.newParentHeight,
    i = _ref59.initialParentWidth,
    s = _ref59.initialParentHeight;
  var _C_ = C_({
      constraints: n.data,
      newParentWidth: e,
      newParentHeight: r,
      initialParentWidth: i,
      initialParentHeight: s,
      objectInitialWidth: P_(t) ? t.width : 0,
      objectInitialHeight: P_(t) ? t.height : 0,
      objectInitialPosition: t.position
    }),
    o = _C_.width,
    a = _C_.height,
    l = _C_.position;
  if (n.position = l, n.data = _objectSpread(_objectSpread({}, n.data), {}, {
    position: l
  }), n.states) for (var u in n.states) RQ({
    stateId: u,
    objectOverride: n,
    objectRoot: t,
    newParentWidth: e,
    newParentHeight: r,
    initialParentWidth: i,
    initialParentHeight: s
  });
  P_(n) && (n.width = o, n.height = a, n.data = _objectSpread(_objectSpread({}, n.data), {}, {
    width: o,
    height: a
  }), P3({
    objectOverride: n,
    objectRoot: t,
    newParentWidth: n.width,
    newParentHeight: n.height,
    initialParentWidth: t.width,
    initialParentHeight: t.height
  }));
}
function RQ(_ref60) {
  var _t$states, _e$states;
  var n = _ref60.stateId,
    t = _ref60.objectOverride,
    e = _ref60.objectRoot,
    r = _ref60.newParentWidth,
    i = _ref60.newParentHeight,
    s = _ref60.initialParentWidth,
    o = _ref60.initialParentHeight;
  var a = (_t$states = t.states) === null || _t$states === void 0 ? void 0 : _t$states[n],
    l = (_e$states = e.states) === null || _e$states === void 0 ? void 0 : _e$states[n];
  if (a && l) {
    var _C_2 = C_({
        constraints: t.data,
        newParentWidth: r,
        newParentHeight: i,
        initialParentWidth: s,
        initialParentHeight: o,
        objectInitialWidth: Aa.isResizeable(l) ? l.width : 0,
        objectInitialHeight: Aa.isResizeable(l) ? l.height : 0,
        objectInitialPosition: l.position
      }),
      u = _C_2.width,
      c = _C_2.height,
      d = _C_2.position;
    Object.assign(t.states[n], {
      position: d
    }), Aa.isResizeable(a) && Object.assign(t.states[n], {
      width: u,
      height: c
    });
  }
}
function P_(n) {
  return n instanceof ws || n instanceof Zi || n instanceof Gl || n instanceof jl;
}
var sr = /*#__PURE__*/function (_ph3) {
  _inherits(sr, _ph3);
  var _super284 = _createSuper(sr);
  function sr(e, r, i) {
    var _this291;
    _classCallCheck(this, sr);
    _this291 = _super284.call(this);
    _this291.data = r;
    _this291.bgColor = new cr(1, 1, 1, 1);
    _this291.fog = null;
    _this291.backupFog = new Iu(16777215, .1, 2e3);
    _this291.fogUseBGColor = !1;
    _this291.isActive = !1;
    _this291.aoColor = new Le();
    _this291.penumbraSizeArrayCache = null;
    _this291.super_Entity(e, r), _this291.personalCamera = new hr(us, _objectSpread(_objectSpread(_objectSpread({}, Dc.defaultData), r.camera), {}, {
      name: "Personal Camera"
    })), _this291.personalCamera.objectHelper.visible = !1, _this291.add(_this291.personalCamera), _this291.activeCamera = _this291.personalCamera, _this291.ambientLight = new gy(13882323, 8553090, .75), _this291.ambientLight.name = "Default Ambient Light", _this291.ambientLight.layers.enable(3), _this291.ambientLight.removeFromParent(), _this291.add(_this291.ambientLight), r.uiScene ? _this291.uiScene = new Jc((Array.isArray(e) ? e[0] : e) + "-ui", r.uiScene, {
      dpr: window.devicePixelRatio,
      shared: i.shared
    }) : r.uiFrame && _this291.createUICanvas(r.uiFrame, i);
    return _this291;
  }
  _createClass(sr, [{
    key: "scene",
    get: function get() {
      return this.parent;
    }
  }, {
    key: "postprocessing",
    get: function get() {
      return this.data.postprocessing;
    }
  }, {
    key: "frameId",
    get: function get() {
      return this.data.uiFrame;
    }
  }, {
    key: "frame",
    get: function get() {
      var _this$uiCanvas;
      return (_this$uiCanvas = this.uiCanvas) === null || _this$uiCanvas === void 0 ? void 0 : _this$uiCanvas.frame;
    }
  }, {
    key: "createUICanvas",
    value: function createUICanvas(e, r) {
      var _this292 = this;
      this.uiCanvas = new _f(this.uuid + "-uiscreen", window.innerWidth, window.innerHeight, r), this.uiCanvas.isScreenSpace = !0, this.uiCanvas.promise.then(function () {
        var _this292$uiCanvas, _this292$uiCanvas2;
        (_this292$uiCanvas = _this292.uiCanvas) !== null && _this292$uiCanvas !== void 0 && _this292$uiCanvas.applyFrame(e), (_this292$uiCanvas2 = _this292.uiCanvas) === null || _this292$uiCanvas2 === void 0 ? void 0 : _this292$uiCanvas2.applySize();
      });
    }
  }, {
    key: "updateVisible",
    value: function updateVisible() {}
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(e) {
      this.bgColor = e, this.fogUseBGColor === !0 && (this.backupFog.color = e);
    }
  }, {
    key: "entityChildrenCount",
    value: function entityChildrenCount() {
      return this.uiScene ? this.uiScene.children.length : _get(_getPrototypeOf(sr.prototype), "entityChildrenCount", this).call(this);
    }
  }, {
    key: "updateAmbientLight",
    value: function updateAmbientLight(e, r) {
      e.color !== void 0 && (this.ambientLight.color = Ki(e.color, r)), e.intensity !== void 0 && (this.ambientLight.intensity = e.intensity), e.enabled !== void 0 && (e.enabled ? this.add(this.ambientLight) : this.remove(this.ambientLight));
    }
  }, {
    key: "onDeactive",
    value: function onDeactive() {
      this.isActive = !1;
    }
  }, {
    key: "onActive",
    value: function onActive(e) {
      this.isActive = !0, e.fog = this.fog, this.traverseEntity(function (r) {
        r instanceof Ln && r.recomputeBoolean();
      }), this.updateShadow(this.data.shadow);
    }
  }, {
    key: "forceMaterialsUpdate",
    value: function forceMaterialsUpdate() {
      this.traverseEntity(function (e) {
        if (e instanceof gs) if (Array.isArray(e.material)) {
          var _iterator111 = _createForOfIteratorHelper(e.material),
            _step111;
          try {
            for (_iterator111.s(); !(_step111 = _iterator111.n()).done;) {
              var r = _step111.value;
              r.needsUpdate = !0;
            }
          } catch (err) {
            _iterator111.e(err);
          } finally {
            _iterator111.f();
          }
        } else e.material.needsUpdate = !0, e.material.dispose();
      });
    }
  }, {
    key: "updateShadow",
    value: function updateShadow(e) {
      e.softShadowQuality !== void 0 && this.isActive && f3(e.softShadowQuality) && this.forceMaterialsUpdate();
    }
  }, {
    key: "updateFog",
    value: function updateFog(e, r) {
      if (e.enabled ? this.fog = this.backupFog : this.fog = null, this.isActive) {
        var _i149 = this.scene;
        _i149.fog = this.fog;
      }
      this.fogUseBGColor = e.useBackgroundColor, e.useBackgroundColor ? this.backupFog.color.set(this.bgColor) : this.backupFog.color = Ki(e.color, r), this.backupFog.near = e.near, this.backupFog.far = e.far;
    }
  }, {
    key: "updateAo",
    value: function updateAo(e, r) {
      e.aoColor !== void 0 && (this.aoColor = Ki(e.aoColor, r));
    }
  }, {
    key: "updateByOp",
    value: function updateByOp(e, r, i, s) {
      var o = this.data.uiFrame;
      _get(_getPrototypeOf(sr.prototype), "updateByOp", this).call(this, e, r, i, s);
      var a = r;
      wt(e.path, ["fog"]) ? this.updateFog(a.fog, i.shared) : wt(e.path, ["ao"]) ? this.updateAo(a.ao, i.shared) : wt(e.path, ["ambient"]) ? this.updateAmbientLight(a.ambient, i.shared) : wt(e.path, ["shadow"]) ? this.updateShadow(a.shadow) : e.type === 0 && e.path.length === 0 && (e.props.uiFrame !== void 0 || o !== a.uiFrame) && this.updateUIFrame(e.props.uiFrame, i);
    }
  }, {
    key: "updateUIFrame",
    value: function updateUIFrame(e, r) {
      e ? (this.uiCanvas || this.createUICanvas(e, r), this.uiCanvas.enabled = !0, this.uiCanvas.applyFrame(e)) : this.uiCanvas && (this.uiCanvas.enabled = !1);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      this.updateState_Entity(e, r), e.backgroundColor !== void 0 && this.setBackgroundColor(Ki(e.backgroundColor, r.shared)), e.fog !== void 0 && this.updateFog(e.fog, r.shared), e.ambient !== void 0 && this.updateAmbientLight(e.ambient, r.shared), e.ao !== void 0 && this.updateAo(e.ao, r.shared), e.shadow !== void 0 && this.updateShadow(e.shadow);
    }
  }, {
    key: "createFrame",
    value: function createFrame(e, r) {}
  }, {
    key: "raycast",
    value: function raycast(e, r) {
      _get(_getPrototypeOf(sr.prototype), "raycast", this).call(this, e, r);
    }
  }, {
    key: "switchActiveCamera",
    value: function switchActiveCamera(e) {
      e && e.isDescendantOf(this) && (this.activeCamera !== this.personalCamera && (this.activeCamera.objectHelper.visible = !0), this.activeCamera = e, e.objectHelper.visible = !1);
    }
  }, {
    key: "playCamera",
    get: function get() {
      var _this$scene$find, _this$scene;
      return (_this$scene$find = (_this$scene = this.scene) === null || _this$scene === void 0 ? void 0 : _this$scene.find(this.data.publish.playCamera)) !== null && _this$scene$find !== void 0 ? _this$scene$find : this.personalCamera;
    }
  }, {
    key: "switchToPlayCamera",
    value: function switchToPlayCamera() {
      this.switchActiveCamera(this.playCamera);
    }
  }, {
    key: "penumbraSizeArray",
    get: function get() {
      return this.penumbraSizeArrayCache === null && this.updatePenumbraSizeArray(), this.penumbraSizeArrayCache;
    }
  }, {
    key: "updatePenumbraSizeArray",
    value: function updatePenumbraSizeArray() {
      var _this293 = this;
      this.penumbraSizeArrayCache = new Array(5).fill(.5);
      var e = 0,
        r = 0;
      this.traverseEntity(function (i) {
        if (!i.visible) return !0;
        i instanceof Sf && i.visible && e < 3 && (_this293.penumbraSizeArrayCache[e] = i.data.penumbraSize, e += 1), i instanceof wf && i.visible && e < 5 - 3 && (_this293.penumbraSizeArrayCache[3 + r] = i.data.penumbraSize, r += 1);
      });
    }
  }, {
    key: "raycastWithClones",
    value: function raycastWithClones(e) {
      var _this294 = this;
      var r = [],
        i = function i(s) {
          var _iterator112 = _createForOfIteratorHelper(s.children),
            _step112;
          try {
            for (_iterator112.s(); !(_step112 = _iterator112.n()).done;) {
              var o = _step112.value;
              var a = o.cloner;
              ut.is(o) && (o.visible || (a === null || a === void 0 ? void 0 : a.object.data.visible)) && ((sn(o) || Om(o) && _this294.scene.enableHelpers && o.objectHelper.visible) && (e.intersectObject(o, !1, r), Vm(o, e, r, !0)), i(o));
            }
          } catch (err) {
            _iterator112.e(err);
          } finally {
            _iterator112.f();
          }
        };
      return i(this), r;
    }
  }, {
    key: "updateEntity2DByOp",
    value: function updateEntity2DByOp(e, r, i, s) {
      var _this$uiCanvas2;
      (_this$uiCanvas2 = this.uiCanvas) === null || _this$uiCanvas2 === void 0 || _this$uiCanvas2.updateEntity2DByOp(e, r, i, s);
    }
  }]);
  return sr;
}(ph(vi));
var Dx = /*#__PURE__*/function (_of3) {
  _inherits(Dx, _of3);
  var _super285 = _createSuper(Dx);
  function Dx(t, e, r) {
    var _this295;
    _classCallCheck(this, Dx);
    _this295 = _super285.call(this), _this295.super_Entity(t, e), _this295.castShadow = !0, _this295.shadow.mapSize.width = 1024, _this295.shadow.mapSize.height = 1024, _this295.shadow.normalBias = 1, _this295.layers.enable(3);
    var s = _this295.shadow.camera;
    s.fov = 90, s.aspect = 1, s.near = 100, s.far = 2500;
    var o = new _(-s.far + _this295.position.x, -s.far + _this295.position.y, -s.far + _this295.position.z),
      a = new _(s.far + _this295.position.x, s.far + _this295.position.y, s.far + _this295.position.z),
      l = new Bt(o, a),
      u = new sl(l, new Le(16755200));
    u.visible = !1, _this295.gizmos.shadowmap = u, _this295.update();
    return _this295;
  }
  _createClass(Dx, [{
    key: "update",
    value: function update() {
      if (this.shadow && (this.shadow.camera.updateProjectionMatrix(), this.gizmos)) for (var t in this.gizmos) {
        var e = this.gizmos[t];
        if (e instanceof sl) {
          var r = this.shadow.camera,
            _i150 = new _(-r.far + this.position.x, -r.far + this.position.y, -r.far + this.position.z),
            _s76 = new _(r.far + this.position.x, r.far + this.position.y, r.far + this.position.z);
          e.box.set(_i150, _s76), e.updateMatrixWorld(!0);
        }
      }
    }
  }, {
    key: "updateMatrixWorld",
    value: function updateMatrixWorld(t) {
      _get(_getPrototypeOf(Dx.prototype), "updateMatrixWorld", this).call(this, t), this.objectHelper && this.objectHelper.update();
    }
  }, {
    key: "updateState",
    value: function updateState(t, e) {
      this.updateState_Light(t, e), t.distance !== void 0 && (this.distance = t.distance), t.decay !== void 0 && (this.decay = t.decay), t.shadowRadius !== void 0 && (this.shadow.radius = t.shadowRadius), t.shadowResolution !== void 0 && (this.shadow.mapSize.set(t.shadowResolution, t.shadowResolution), this.shadow.map && (this.shadow.map.dispose(), this.shadow.map = null));
    }
  }]);
  return Dx;
}(of(vy, bf));
var Ox = /*#__PURE__*/function (_er3) {
  _inherits(Ox, _er3);
  var _super286 = _createSuper(Ox);
  function Ox() {
    _classCallCheck(this, Ox);
    return _super286.apply(this, arguments);
  }
  _createClass(Ox, [{
    key: "forceComputeSize",
    get: function get() {
      return !0;
    }
  }, {
    key: "shape",
    get: function get() {
      return this.geometry.userData.shape;
    }
  }, {
    key: "updateEntityBoxSize",
    value: function updateEntityBoxSize(t, e) {
      var r = this.geometry.getAttribute("position");
      r !== void 0 ? pm(r, this.geometry.drawRange.start, this.geometry.drawRange.count < 1 / 0 ? this.geometry.drawRange.count : r.count, t, e) : _get(_getPrototypeOf(Ox.prototype), "updateEntityBoxSize", this).call(this, t, e);
    }
  }]);
  return Ox;
}(er);
var Hl = /*#__PURE__*/function (_er4) {
  _inherits(Hl, _er4);
  var _super287 = _createSuper(Hl);
  function Hl(e, r, i) {
    var _this296;
    _classCallCheck(this, Hl);
    _this296 = _super287.call(this, e, r, i);
    _this296._shapeId = null;
    _this296._context = i;
    return _this296;
  }
  _createClass(Hl, [{
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(Hl.prototype), "updateState", this).call(this, e, r), this.updateShape();
    }
  }, {
    key: "updateShape",
    value: function updateShape() {
      var _this297 = this;
      var e = _objectSpread({}, this.data.geometry.extrusion.shape);
      for (var _s77 in e) typeof e[_s77] == "string" && (e[_s77] = this._context.shared.getVariable(e[_s77], [this.uuid, "geometry", "extrusion", "shape", _s77]));
      var r;
      if (e.type === "Custom") {
        var _s78 = e.shapeId;
        if (_s78 !== this._shapeId && this.detachShape(), _s78) {
          var _o$geometry$userData;
          this._shapeId = _s78;
          var o = this._context.scene.find(_s78);
          o !== null && o !== void 0 && o.data && (o.attachedPaths.add(this), r = (_o$geometry$userData = o.geometry.userData) === null || _o$geometry$userData === void 0 ? void 0 : _o$geometry$userData.shape), r || this._context.scene.addPendingCommand(function () {
            return _this297.updateShape();
          });
        }
      } else {
        var _s79;
        switch (e.type) {
          case "Rectangle":
            _s79 = Eh;
            break;
          case "Ellipse":
            _s79 = wh;
            break;
          case "Polygon":
            _s79 = T0;
            break;
          case "Star":
            _s79 = M0;
            break;
          default:
            throw new Error("Unknown shape type: ".concat(e.type));
        }
        r = _s79.create({
          parameters: e
        }).userData.shape;
      }
      var i = this.geometry;
      r && i.inputs && (i.inputs.shapeData = r, i.build(), this.attachedSurfaceCloners.forEach(function (s) {
        return s.update();
      }));
    }
  }, {
    key: "detachShape",
    value: function detachShape() {
      var _this$_context$scene$;
      this._shapeId !== null && ((_this$_context$scene$ = this._context.scene.find(this._shapeId)) === null || _this$_context$scene$ === void 0 ? void 0 : _this$_context$scene$.attachedPaths.delete(this));
    }
  }, {
    key: "createGeometryDelayed",
    value: function createGeometryDelayed(e) {
      this.geometryCreateDeleyed = e.shared, this.updateShape(), this.refreshAttachedPaths(e);
    }
  }, {
    key: "updateTransformState",
    value: function updateTransformState(e, r) {
      return _get(_getPrototypeOf(Hl.prototype), "updateTransformState", this).call(this, e, r);
    }
  }, {
    key: "updateGeometryInteractions",
    value: function updateGeometryInteractions(e, r) {
      _get(_getPrototypeOf(Hl.prototype), "updateGeometryInteractions", this).call(this, e, r), this.updateShape();
    }
  }, {
    key: "updateEntityBoxSize",
    value: function updateEntityBoxSize(e, r) {
      var i = this.geometry.getAttribute("position");
      i !== void 0 ? pm(i, this.geometry.drawRange.start, this.geometry.drawRange.count < 1 / 0 ? this.geometry.drawRange.count : i.count, e, r) : _get(_getPrototypeOf(Hl.prototype), "updateEntityBoxSize", this).call(this, e, r);
    }
  }]);
  return Hl;
}(er);
var Js = /*#__PURE__*/function (_xs5) {
  _inherits(Js, _xs5);
  var _super288 = _createSuper(Js);
  function Js(e, r, i) {
    var _this298;
    _classCallCheck(this, Js);
    _this298 = _super288.call(this);
    r.type === "Instance" && typeof e == "string" && (r = _this298.transformAssignData(r, i)), _this298.super_Entity(e, r), _this298.objectHelper.update();
    return _this298;
  }
  _createClass(Js, [{
    key: "isComponentRoot",
    get: function get() {
      return this.data.type === "Component" && typeof this.identity == "string";
    }
  }, {
    key: "isInstanceRoot",
    get: function get() {
      return this.data.type === "Instance" && typeof this.identity == "string";
    }
  }, {
    key: "transformAssignData",
    value: function transformAssignData(e, r) {
      var i = Wd.getComponentData({
        scene: r.scene.data,
        shared: r.shared.data
      }, e.component);
      if (i) {
        var _s80, o;
        var _iterator113 = _createForOfIteratorHelper(wo.rootOverrideProps),
          _step113;
        try {
          for (_iterator113.s(); !(_step113 = _iterator113.n()).done;) {
            var a = _step113.value;
            e[a] === void 0 ? (_s80 === void 0 && (_s80 = _objectSpread({}, e)), _s80[a] = i.data[a]) : (o === void 0 && (o = {}), o[a] = e[a], _s80 === void 0 && (_s80 = _objectSpread({}, e)), _s80[a] = po.apply(i.data[a], e[a]));
          }
        } catch (err) {
          _iterator113.e(err);
        } finally {
          _iterator113.f();
        }
        return this.overrideData = o, _s80;
      } else return _objectSpread(_objectSpread(_objectSpread({}, wi.defaultData), e), Qn(wi.defaultData, wo.rootOverrideProps));
    }
  }, {
    key: "updateByOp",
    value: function updateByOp(e, r, i, s) {
      var _o69;
      var o;
      if (this.isInstanceRoot && !s) {
        if (r = this.transformAssignData(r, i), e.type === 0 && e.path.length === 0 && this.component) {
          var _iterator114 = _createForOfIteratorHelper(wo.rootOverrideProps),
            _step114;
          try {
            for (_iterator114.s(); !(_step114 = _iterator114.n()).done;) {
              var a = _step114.value;
              a in e.props && e.props[a] === void 0 && (o === void 0 && (o = _objectSpread(_objectSpread({}, e), {}, {
                props: _objectSpread({}, e.props)
              })), o.props[a] = this.component.data[a]);
            }
          } catch (err) {
            _iterator114.e(err);
          } finally {
            _iterator114.f();
          }
        } else if (e.type === 0 && e.path.length > 0 && wo.rootOverrideProps.includes(e.path[0])) {
          var _a61 = e.path[0];
          o === void 0 && (o = _objectSpread(_objectSpread({}, e), {}, {
            path: [],
            props: _defineProperty({}, _a61, r[_a61])
          }));
        }
      }
      _get(_getPrototypeOf(Js.prototype), "updateByOp", this).call(this, (_o69 = o) !== null && _o69 !== void 0 ? _o69 : e, r, i, s);
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      this.updateState_Entity(e, r);
    }
  }, {
    key: "expandInstanceChildren",
    value: function expandInstanceChildren(e) {
      var r = this.data;
      if (this.component === void 0) {
        var _e$scene$find;
        var _i151 = (_e$scene$find = e.scene.find(r.component)) !== null && _e$scene$find !== void 0 ? _e$scene$find : null,
          _s81 = !1;
        if (_i151 !== this.oldComponent) {
          if (this.oldComponent) {
            var o = 0;
            var _iterator115 = _createForOfIteratorHelper(this.children),
              _step115;
            try {
              for (_iterator115.s(); !(_step115 = _iterator115.n()).done;) {
                var a = _step115.value;
                if (ut.is(a)) e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(a), Ix(a), o += 1;else break;
              }
            } catch (err) {
              _iterator115.e(err);
            } finally {
              _iterator115.f();
            }
            this.children.splice(0, o);
          }
          _s81 = !0;
        }
        if (_i151) {
          var _o70 = {};
          O3(e, [this.uuid], r.overrides, this, _i151, _i151, 0, _s81, _o70);
          var _iterator116 = _createForOfIteratorHelper(this.children),
            _step116;
          try {
            for (_iterator116.s(); !(_step116 = _iterator116.n()).done;) {
              var _a62 = _step116.value;
              if (ut.is(_a62)) {
                var l = _a62.data;
                l.type === "Empty" && l.animations && _a62.traverseEntity(function (u) {
                  if (u instanceof er && u.isSkinnedMesh) {
                    var c = u.dataPatched;
                    if (c.bones && c.boneInverses) {
                      var d = c.bones.map(function (p) {
                          return e.scene.find(_o70[p]);
                        }),
                        _h87 = c.boneInverses.map(function (p) {
                          return new te().fromArray(p);
                        }),
                        f = new Za(d, _h87);
                      u.bind(f, u.bindMatrix);
                    }
                  } else u.matrixAutoUpdate = !0;
                });
              }
            }
          } catch (err) {
            _iterator116.e(err);
          } finally {
            _iterator116.f();
          }
        }
        this.oldComponent = this.component;
      }
    }
  }]);
  return Js;
}(xs(ts, bs));
function Ix(n) {
  if (n.component) {
    var t = n.component.instances.indexOf(n);
    t >= 0 && n.component.instances.splice(t, 1);
    var _iterator117 = _createForOfIteratorHelper(n.children),
      _step117;
    try {
      for (_iterator117.s(); !(_step117 = _iterator117.n()).done;) {
        var e = _step117.value;
        ut.is(e) && Ix(e);
      }
    } catch (err) {
      _iterator117.e(err);
    } finally {
      _iterator117.f();
    }
  }
}
function D3(n, t, e, r) {
  return n.component === t && Rp(n.identity, r) ? n.overrideData === e ? 2 : 1 : 0;
}
function O3(n, t, e, r, i, s, o, a, l) {
  if (o > 50) return !1;
  if (r.component !== i) {
    if (r.component) {
      var c = r.component.instances.indexOf(r);
      c >= 0 && r.component.instances.splice(c, 1);
    }
    i.instances.push(r), r.component = i;
  }
  i instanceof Js && i.isInstanceRoot && i.expandInstanceChildren(n);
  var u = 0;
  var _iterator118 = _createForOfIteratorHelper(i.children),
    _step118;
  try {
    for (_iterator118.s(); !(_step118 = _iterator118.n()).done;) {
      var _c42 = _step118.value;
      if (ut.is(_c42)) {
        var _d57 = [].concat(_toConsumableArray(t), _toConsumableArray(typeof _c42.identity == "string" ? [_c42.identity] : _c42.identity)),
          _h88 = jd.resolve(e, _d57, 1);
        if (_h88 != null && !(_h88 instanceof lr)) {
          if (!1) debugger;
          Object.setPrototypeOf(_h88, lr.prototype), console.error("wrong prototype");
        }
        var f = null,
          p = void 0;
        if (!a) {
          var _n$scene$findInstance;
          var m = r.children[u];
          if (f = ut.is(m) ? m : null, f !== null) {
            var g = D3(f, _c42, _h88, _d57);
            p = g >= 1 ? f.stateSelection : void 0, g !== 2 && (f = null);
          }
          if (f === null && (f = (_n$scene$findInstance = n.scene.findInstance(_d57)) !== null && _n$scene$findInstance !== void 0 ? _n$scene$findInstance : null, f !== null)) {
            var _g44 = D3(f, _c42, _h88, _d57);
            if (p = _g44 >= 1 ? f.stateSelection : void 0, _g44 !== 2) f = null;else {
              var y = f.parent.children.indexOf(f);
              f.parent.children.splice(y, 1), r.children.splice(u, 0, f), f.parent === r ? (y <= u && console.error("not possible"), void 0) : (f.parent = r, f.matrixWorldNeedsUpdate = !0, f.resetBBoxNeedsUpdate(), f.updateVisible(), n.pendingDeletes.delete(f), void 0);
            }
          }
        }
        if (f === null) {
          var _m51 = _h88 ? po.apply(_c42.data, _h88) : _c42.data;
          ks.is(_m51.type) && (_m51 = _objectSpread(_objectSpread({}, _m51), {}, {
            type: "Empty"
          })), f = Gs.createEntity(_d57, _m51, n), f.overrideData = _h88, r.add(f), r.children.splice(r.children.length - 1, 1), r.children.splice(u, 0, f), f.updateState(f.data, n), p && f.changeSelectedState(p, n), n.scene.registerInstanceAndSetUuid(f);
        }
        if (f.isBone) {
          var _m52 = f.identity[f.identity.length - 1];
          l[_m52] = f.uuid;
        }
        u += 1, O3(n, t, e, f, _c42, s, o + 1, a, l);
      }
    }
  } catch (err) {
    _iterator118.e(err);
  } finally {
    _iterator118.f();
  }
  if (!a) {
    var _c41 = u;
    for (;;) {
      var d = r.children[u];
      if (ut.is(d)) n.pendingDeletes.add(d);else break;
      u += 1;
    }
    r.children.splice(_c41, u - _c41);
  }
  return !0;
}
var Rx = /*#__PURE__*/function (_xs6) {
  _inherits(Rx, _xs6);
  var _super289 = _createSuper(Rx);
  function Rx(t, e) {
    var _this299;
    _classCallCheck(this, Rx);
    _this299 = _super289.call(this), _this299.super_Entity(t, e), _this299.objectHelper.update(), _this299.matrixAutoUpdate = !0;
    return _this299;
  }
  _createClass(Rx, [{
    key: "updateState",
    value: function updateState(t, e) {
      this.updateState_Entity(t, e);
    }
  }]);
  return Rx;
}(xs(fp, bs));
var fr = /*#__PURE__*/function (_er5) {
  _inherits(fr, _er5);
  var _super290 = _createSuper(fr);
  function fr(e, r, i) {
    var _this300;
    _classCallCheck(this, fr);
    _this300 = _super290.call(this, e, r, i);
    _this300.onBeforeRender = function () {
      _this300.uiCanvas.render();
    };
    _this300.uiCanvas = new _f(e + "-canvas", r.geometry.width, r.geometry.height, i), _this300.uiCanvas.promise.then(function () {
      _this300.applyFrame(_this300.dataPatched.geometry.frame, i.shared);
    });
    return _this300;
  }
  _createClass(fr, [{
    key: "updateByPatchedOpGeometry",
    value: function updateByPatchedOpGeometry(e, r, i) {
      _get(_getPrototypeOf(fr.prototype), "updateByPatchedOpGeometry", this).call(this, e, r, i), e.type === 0 && (e.props.frame !== void 0 && this.applyFrame(e.props.frame, i.shared), (e.props.width !== void 0 || e.props.height !== void 0) && this.applySize(e.props, i.shared));
    }
  }, {
    key: "applySize",
    value: function applySize(e, r) {
      var _e$width, _e$height22;
      var i = (_e$width = e === null || e === void 0 ? void 0 : e.width) !== null && _e$width !== void 0 ? _e$width : this.dataPatched.geometry.width,
        s = (_e$height22 = e === null || e === void 0 ? void 0 : e.height) !== null && _e$height22 !== void 0 ? _e$height22 : this.dataPatched.geometry.height;
      this.uiCanvas.applySize({
        width: i,
        height: s
      }), this.applyGeometryParametersFromFrame(r);
    }
  }, {
    key: "applyFrame",
    value: function applyFrame(e, r) {
      this.uiCanvas.applyFrame(e), this.applyGeometryParametersFromFrame(r), this.applyMaterialParametersFromFrame({
        shared: r
      });
    }
  }, {
    key: "applyGeometryParametersFromFrame",
    value: function applyGeometryParametersFromFrame(e) {
      var _this$localGeometry4;
      var r = this.frame;
      r && (Object.assign(this.data, {
        geometry: Object.assign(this.data.geometry, {
          cornerRadius: r.cornerRadius,
          cornerType: 0
        })
      }), Object.assign(this.dataPatched, {
        geometry: Object.assign(this.dataPatched.geometry, {
          cornerRadius: r.cornerRadius,
          cornerType: 0
        })
      }), (_this$localGeometry4 = this.localGeometry) !== null && _this$localGeometry4 !== void 0 && _this$localGeometry4.dispose(), this.localGeometry = Ta(this.dataPatched.geometry, e, this.data.flatShading, this));
    }
  }, {
    key: "applyMaterialParametersFromFrame",
    value: function applyMaterialParametersFromFrame(e) {
      var r = this.frame;
      if (r) {
        var _i152 = r.data.backgroundBlur;
        Object.assign(this.data.material.layers[0].data.texture, {
          image: this.uiCanvas.uuid
        }), Object.assign(this.data.material.layers[1].data, {
          roughness: _i152.radius,
          alpha: _i152.enabled ? 1 : 0
        }), Object.assign(this.dataPatched.material.layers[0].data.texture, {
          image: this.uiCanvas.uuid
        }), Object.assign(this.dataPatched.material.layers[1].data, {
          roughness: _i152.radius,
          alpha: _i152.enabled ? 1 : 0
        }), this.material.reset(this.dataPatched.material, e, !0);
      }
    }
  }, {
    key: "updateEntity2DByOp",
    value: function updateEntity2DByOp(e, r, i, s) {
      this.uiCanvas.updateEntity2DByOp(e, r, i, s), e === this.frameId && r.type === 0 && (r.props.cornerRadius !== void 0 ? this.applyGeometryParametersFromFrame(s) : wt(r.path, ["backgroundBlur"]) && this.applyMaterialParametersFromFrame({
        shared: s
      }));
    }
  }, {
    key: "frame",
    get: function get() {
      return this.uiCanvas.frame;
    }
  }, {
    key: "frameId",
    get: function get() {
      var _this$frame4;
      return (_this$frame4 = this.frame) === null || _this$frame4 === void 0 ? void 0 : _this$frame4.uuid;
    }
  }, {
    key: "removeInteractionGeometry",
    value: function removeInteractionGeometry(e) {
      _get(_getPrototypeOf(fr.prototype), "removeInteractionGeometry", this).call(this, e), this.applySize({}, e);
    }
  }, {
    key: "updateGeometryInteractions",
    value: function updateGeometryInteractions(e, r) {
      _get(_getPrototypeOf(fr.prototype), "updateGeometryInteractions", this).call(this, e, r), this.applySize({
        width: e.width,
        height: e.height
      }, r);
    }
  }]);
  return fr;
}(er);
var Lx = /*#__PURE__*/_createClass(function Lx(t, e, r) {
  _classCallCheck(this, Lx);
  this.variables = [], this.currentTextureIndex = 0;
  var i = dr,
    s = new vi(),
    o = new Hn();
  o.position.z = 1;
  var a = {
      passThruTexture: {
        value: null
      }
    },
    l = d(f(), a),
    u = new rr(new hn(2, 2), l);
  s.add(u), this.setDataType = function (p) {
    return i = p, this;
  }, this.addVariable = function (p, m, g) {
    var y = this.createShaderMaterial(m),
      v = {
        name: p,
        initialValueTexture: g,
        material: y,
        dependencies: null,
        renderTargets: [],
        wrapS: null,
        wrapT: null,
        minFilter: Et,
        magFilter: Et
      };
    return this.variables.push(v), v;
  }, this.setVariableDependencies = function (p, m) {
    p.dependencies = m;
  }, this.init = function () {
    if (r.capabilities.isWebGL2 === !1 && r.extensions.has("OES_texture_float") === !1) return "No OES_texture_float support for float textures.";
    if (r.capabilities.maxVertexTextures === 0) return "No support for vertex shader textures.";
    for (var p = 0; p < this.variables.length; p++) {
      var m = this.variables[p];
      m.renderTargets[0] = this.createRenderTarget(t, e, m.wrapS, m.wrapT, m.minFilter, m.magFilter), m.renderTargets[1] = this.createRenderTarget(t, e, m.wrapS, m.wrapT, m.minFilter, m.magFilter), this.renderTexture(m.initialValueTexture, m.renderTargets[0]), this.renderTexture(m.initialValueTexture, m.renderTargets[1]);
      var g = m.material,
        y = g.uniforms;
      if (m.dependencies !== null) for (var v = 0; v < m.dependencies.length; v++) {
        var x = m.dependencies[v];
        if (x.name !== m.name) {
          var S = !1;
          for (var w = 0; w < this.variables.length; w++) if (x.name === this.variables[w].name) {
            S = !0;
            break;
          }
          if (!S) return "Variable dependency not found. Variable=" + m.name + ", dependency=" + x.name;
        }
        y[x.name] = {
          value: null
        }, g.fragmentShader = "\nuniform sampler2D " + x.name + ";\n" + g.fragmentShader;
      }
    }
    return this.currentTextureIndex = 0, null;
  }, this.compute = function () {
    var p = this.currentTextureIndex,
      m = this.currentTextureIndex === 0 ? 1 : 0;
    for (var g = 0, y = this.variables.length; g < y; g++) {
      var v = this.variables[g];
      if (v.dependencies !== null) {
        var x = v.material.uniforms;
        for (var S = 0, w = v.dependencies.length; S < w; S++) {
          var A = v.dependencies[S];
          x[A.name].value = A.renderTargets[p].texture;
        }
      }
      this.doRenderTarget(v.material, v.renderTargets[m]);
    }
    this.currentTextureIndex = m;
  }, this.getCurrentRenderTarget = function (p) {
    return p.renderTargets[this.currentTextureIndex];
  }, this.getAlternateRenderTarget = function (p) {
    return p.renderTargets[this.currentTextureIndex === 0 ? 1 : 0];
  }, this.dispose = function () {
    u.geometry.dispose(), u.material.dispose();
    var p = this.variables;
    for (var m = 0; m < p.length; m++) {
      var g = p[m];
      g.initialValueTexture && g.initialValueTexture.dispose();
      var y = g.renderTargets;
      for (var v = 0; v < y.length; v++) y[v].dispose();
    }
  };
  function c(p) {
    p.defines.resolution = "vec2( " + t.toFixed(1) + ", " + e.toFixed(1) + " )";
  }
  this.addResolutionDefine = c;
  function d(p, m) {
    m = m || {};
    var g = new rt({
      uniforms: m,
      vertexShader: h(),
      fragmentShader: p
    });
    return c(g), g;
  }
  this.createShaderMaterial = d, this.createRenderTarget = function (p, m, g, y, v, x) {
    return p = p || t, m = m || e, g = g || Ut, y = y || Ut, v = v || Et, x = x || Et, new at(p, m, {
      wrapS: g,
      wrapT: y,
      minFilter: v,
      magFilter: x,
      format: Fr,
      type: i,
      depthBuffer: !1
    });
  }, this.createTexture = function () {
    var p = new Float32Array(t * e * 4),
      m = new ci(p, t, e, Fr, dr);
    return m.needsUpdate = !0, m;
  }, this.renderTexture = function (p, m) {
    a.passThruTexture.value = p, this.doRenderTarget(l, m), a.passThruTexture.value = null;
  }, this.doRenderTarget = function (p, m) {
    var g = r.getRenderTarget(),
      y = r.xr.enabled,
      v = r.shadowMap.autoUpdate,
      x = r.outputEncoding,
      S = r.toneMapping;
    r.xr.enabled = !1, r.shadowMap.autoUpdate = !1, r.outputEncoding = dn, r.toneMapping = Os, u.material = p, r.setRenderTarget(m), r.render(s, o), u.material = l, r.xr.enabled = y, r.shadowMap.autoUpdate = v, r.outputEncoding = x, r.toneMapping = S, r.setRenderTarget(g);
  };
  function h() {
    return "void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n";
  }
  function f() {
    return "uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n";
  }
});
var Ji = new vr(),
  Bx = new _(),
  Nx = /*#__PURE__*/function () {
    function Nx(t) {
      _classCallCheck(this, Nx);
      var e = t.geometry;
      if (!e.isBufferGeometry || e.attributes.position.itemSize !== 3) throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");
      e.index && (console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."), e = e.toNonIndexed()), this.geometry = e, this.randomFunction = Math.random, this.positionAttribute = this.geometry.getAttribute("position"), this.colorAttribute = this.geometry.getAttribute("color"), this.weightAttribute = null, this.distribution = null;
    }
    _createClass(Nx, [{
      key: "setWeightAttribute",
      value: function setWeightAttribute(t) {
        return this.weightAttribute = t ? this.geometry.getAttribute(t) : null, this;
      }
    }, {
      key: "build",
      value: function build() {
        var t = this.positionAttribute,
          e = this.weightAttribute,
          r = new Float32Array(t.count / 3);
        for (var _s82 = 0; _s82 < t.count; _s82 += 3) {
          var o = 1;
          e && (o = e.getX(_s82) + e.getX(_s82 + 1) + e.getX(_s82 + 2)), Ji.a.fromBufferAttribute(t, _s82), Ji.b.fromBufferAttribute(t, _s82 + 1), Ji.c.fromBufferAttribute(t, _s82 + 2), o *= Ji.getArea(), r[_s82 / 3] = o;
        }
        this.distribution = new Float32Array(t.count / 3);
        var i = 0;
        for (var _s83 = 0; _s83 < r.length; _s83++) i += r[_s83], this.distribution[_s83] = i;
        return this;
      }
    }, {
      key: "setRandomGenerator",
      value: function setRandomGenerator(t) {
        return this.randomFunction = t, this;
      }
    }, {
      key: "sample",
      value: function sample(t, e, r) {
        var i = this.distribution[this.distribution.length - 1],
          s = this.binarySearch(this.randomFunction() * i);
        return this.sampleFace(s, t, e, r);
      }
    }, {
      key: "binarySearch",
      value: function binarySearch(t) {
        var e = this.distribution,
          r = 0,
          i = e.length - 1,
          s = -1;
        for (; r <= i;) {
          var o = Math.ceil((r + i) / 2);
          if (o === 0 || e[o - 1] <= t && e[o] > t) {
            s = o;
            break;
          } else t < e[o] ? i = o - 1 : r = o + 1;
        }
        return s;
      }
    }, {
      key: "sampleFace",
      value: function sampleFace(t, e, r, i) {
        var s = this.randomFunction(),
          o = this.randomFunction();
        return s + o > 1 && (s = 1 - s, o = 1 - o), Ji.a.fromBufferAttribute(this.positionAttribute, t * 3), Ji.b.fromBufferAttribute(this.positionAttribute, t * 3 + 1), Ji.c.fromBufferAttribute(this.positionAttribute, t * 3 + 2), e.set(0, 0, 0).addScaledVector(Ji.a, s).addScaledVector(Ji.b, o).addScaledVector(Ji.c, 1 - (s + o)), r !== void 0 && Ji.getNormal(r), i !== void 0 && this.colorAttribute !== void 0 && (Ji.a.fromBufferAttribute(this.colorAttribute, t * 3), Ji.b.fromBufferAttribute(this.colorAttribute, t * 3 + 1), Ji.c.fromBufferAttribute(this.colorAttribute, t * 3 + 2), Bx.set(0, 0, 0).addScaledVector(Ji.a, s).addScaledVector(Ji.b, o).addScaledVector(Ji.c, 1 - (s + o)), i.r = Bx.x, i.g = Bx.y, i.b = Bx.z), this;
      }
    }]);
    return Nx;
  }();
function I3(n) {
  var t = new Float32Array(n * n * 2);
  for (var e = 0; e < n; e++) for (var r = 0; r < n; r++) {
    var _i153 = e * n + r;
    t[_i153 * 2 + 0] = e / (n - 1), t[_i153 * 2 + 1] = r / (n - 1);
  }
  return t;
}
function R3(n) {
  var t = Math.ceil(Math.sqrt(n));
  return Math.max(t, 1);
}
function L3(n, t) {
  var e = [],
    r = [],
    i = new _(),
    s = new _(),
    o = new Nx(n).build();
  for (var u = 0; u < t; u++) o.sample(i, s), e.push(i.x, i.y, i.z), r.push(s.x, s.y, s.z);
  var a = new Float32Array(e),
    l = new Float32Array(r);
  return {
    positions: a,
    normals: l
  };
}
function D_(n, t) {
  var e = n,
    r = new Float32Array(4 * t * t);
  for (var _s84 = 0; _s84 < t * t; _s84++) r[4 * _s84] = e[3 * _s84], r[4 * _s84 + 1] = e[3 * _s84 + 1], r[4 * _s84 + 2] = e[3 * _s84 + 2], r[4 * _s84 + 3] = 0;
  var i = new ci(r, t, t, Fr, dr);
  return i.needsUpdate = !0, i;
}
function B3(_ref61) {
  var n = _ref61.size;
  var t = new Float32Array(4 * n * n);
  for (var r = 0; r < n * n; r++) t[4 * r] = r, t[4 * r + 1] = 0, t[4 * r + 2] = 0, t[4 * r + 3] = 0;
  var e = new ci(t, n, n, Fr, dr);
  return e.needsUpdate = !0, e;
}
function N3(n) {
  var t = new Float32Array(4 * n * n);
  for (var r = 0; r < n * n; r++) t[4 * r] = 0, t[4 * r + 1] = 0, t[4 * r + 2] = 0, t[4 * r + 3] = 0;
  var e = new ci(t, n, n, Fr, dr);
  return e.needsUpdate = !0, e;
}
var F3 = "\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n";
var k3 = "\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n";
var z3 = "\n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n";
var V3 = "\n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif\n\n    \n  #endif      \n";
var U3 = "\n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n";
var G3 = "\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n" + k3 + "\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          float offset = 0.0;\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), offset);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          float offset = 0.0;\n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      ".concat(z3, "\n      // ATTRACTION\n      ").concat(V3, "  \n      // VORTEX\n      ").concat(U3, "\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n");
var O_ = "\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n";
var j3 = "\n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n";
var H3 = "\nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n";
var W3 = "\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  ".concat(j3, "\n  ").concat(O_, "\n"),
  q3 = function q3(_ref62) {
    var _ref62$easeSize = _ref62.easeSize,
      n = _ref62$easeSize === void 0 ? "linearFadeOut" : _ref62$easeSize;
    return "\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ".concat(n, "(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n");
  },
  Y3 = "\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  " + O_ + "  \n  ".concat(H3, "\n\n"),
  X3 = function X3(_ref63) {
    var _ref63$easeOpacity = _ref63.easeOpacity,
      n = _ref63$easeOpacity === void 0 ? "linearFadeOut" : _ref63$easeOpacity;
    return "  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ".concat(n, "(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n");
  };
var Fx = /*#__PURE__*/function (_rt12) {
  _inherits(Fx, _rt12);
  var _super291 = _createSuper(Fx);
  function Fx(e, r) {
    var _this301;
    _classCallCheck(this, Fx);
    _this301 = _super291.call(this);
    _this301.needsJitter = !0;
    _this301.type = "ParticleMaterial";
    _this301.easeOpacity = "linearFadeIn";
    _this301.easeSize = "linearFadeIn";
    _this301.useSizeEnd = !1;
    _this301.isColoringRandom = !1;
    _this301.init(e, r), _this301.context = r;
    return _this301;
  }
  _createClass(Fx, [{
    key: "reset",
    value: function reset() {}
  }, {
    key: "init",
    value: function init(e, r) {
      this.transparent = !0, this.depthTest = !0, this.depthWrite = !1, this.easeOpacity = e.ease, this.easeSize = e.easeSize, this.layers = [], this.lightLayer = new Sn(0, "", _objectSpread(_objectSpread({}, Ir.defaultData("light", "phong")), {}, {
        visible: !1
      }), new Ma(), {}, r.shared), this.build();
    }
  }, {
    key: "updateState",
    value: function updateState(e) {
      e.coloring !== void 0 && (this.isColoringRandom = e.coloring === "random"), e.color !== void 0 && (e.color instanceof Array ? this.uniforms.uColor.value = e.color : this.uniforms.uColor.value = this.context.shared.color(e.color)), e.color2 !== void 0 && (e.color2 instanceof Array ? this.uniforms.uColor2.value = e.color2 : this.uniforms.uColor2.value = this.context.shared.color(e.color2)), e.size !== void 0 && (this.uniforms.uSize.value = e.size[0], this.uniforms.uSizeEnd.value = e.size[1], e.size[0] !== e.size[1] ? this.useSizeEnd = !0 : this.useSizeEnd = !1), e.ease !== void 0 && (this.easeOpacity = e.ease, this.build()), e.easeSize !== void 0 && (this.easeSize = e.easeSize, this.build()), this.needsUpdate = !0;
    }
  }, {
    key: "onBeforeCompile",
    value: function onBeforeCompile(e) {
      this.build(), e.defines = this.defines, e.uniforms = this.uniforms, e.vertexShader = this.vertexShader, e.fragmentShader = this.fragmentShader;
    }
  }, {
    key: "build",
    value: function build() {
      var e = new Bh();
      return e.needsJitter = this.needsJitter, e.addFragmentParsCode(OI), e.buildShader("vertex", this.fragment), e.buildShader("fragment", this.fragment), e.addFragmentFinalCode(II), this.isColoringRandom && e.define("USE_RANDOM_COLORING"), this.useSizeEnd && e.define("USE_SIZE_END"), e.addVertexParsCode(W3), e.addFragmentParsCode(Y3), e.addVertexFinalCode(q3({
        easeSize: this.easeSize
      })), e.addFragmentFinalCode(X3({
        easeOpacity: this.easeOpacity
      })), this.vertexShader = e.getCode("vertex"), this.fragmentShader = e.getCode("fragment"), this.defines = e.defines, this.uniforms = _objectSpread(_objectSpread({}, e.uniforms), this.uniforms), this.extensions = e.extensions, this;
    }
  }, {
    key: "nodeMaterial",
    get: function get() {
      return this;
    }
  }, {
    key: "fragment",
    get: function get() {
      return this.lightLayer.node;
    }
  }, {
    key: "getDefines",
    value: function getDefines() {
      return this.defines;
    }
  }, {
    key: "nodeMaterialDispose",
    value: function nodeMaterialDispose() {
      this.layers.forEach(function (e) {
        return e.dispose();
      }), _get(_getPrototypeOf(Fx.prototype), "dispose", this).call(this);
    }
  }]);
  return Fx;
}(rt);
var Ef = /*#__PURE__*/function () {
  function Ef(t, e, r, i) {
    var _this$targetMesh;
    _classCallCheck(this, Ef);
    this.type = "SphereEmitterShape";
    this.targetMesh = void 0;
    this.size = t, this.type = r, this.textureSize = R3(e);
    var s = 1;
    this.targetMesh = (i === null || i === void 0 ? void 0 : i.type) === "Mesh" && i ? i : this.getMesh(r, s);
    var _this$createPositions = this.createPositions(this.textureSize, (_this$targetMesh = this.targetMesh) !== null && _this$targetMesh !== void 0 ? _this$targetMesh : this.getMesh(r, s)),
      o = _this$createPositions.positions,
      a = _this$createPositions.dataTexture,
      l = _this$createPositions.dataTextureNormals;
    this.positionsTexture = a, this.positionsAttribute = o, this.directionsTexture = l;
  }
  _createClass(Ef, [{
    key: "createPositions",
    value: function createPositions(t, e) {
      var _L5 = L3(e, t * t),
        r = _L5.positions,
        i = _L5.normals,
        s = D_(r, t),
        o = D_(i, t);
      return {
        dataTexture: s,
        positions: r,
        dataTextureNormals: o
      };
    }
  }, {
    key: "getMesh",
    value: function getMesh(t, e) {
      var r = null;
      switch (t) {
        case "SphereEmitterShape":
          {
            r = new Bs(e * .5, 32, 32);
            break;
          }
        case "TorusEmitterShape":
          {
            r = new zu(e * .5, .3, 15, 40);
            break;
          }
        case "ConeEmitterShape":
          {
            r = new $a(e, e, 15);
            break;
          }
        case "BoxEmitterShape":
          {
            r = new li(e, e, e);
            break;
          }
        case "PlaneEmitterShape":
          {
            r = new hn(e, e), r.rotateX(-Math.PI / 2);
            break;
          }
        case "MeshEmitterShape":
          {
            r = new Bs(e, 32, 32);
            break;
          }
        default:
          {
            r = new Bs(e, 32, 32);
            break;
          }
      }
      return new rr(r, new Ls({
        color: 16711680
      }));
    }
  }, {
    key: "applyToShader",
    value: function applyToShader(t, e) {
      this.size = new _().fromArray(e.size), t.uEmitterSize.value = this.size;
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.positionsTexture.dispose(), this.directionsTexture.dispose(), this.positionsAttribute = new Float32Array();
    }
  }]);
  return Ef;
}();
function $c(n) {
  var t = _objectSpread({}, n),
    e = Fd.defaultData;
  t.forceFieldObjectId && (t.colliderEntityId = t.forceFieldObjectId);
  var r = _objectSpread(_objectSpread({}, e.shape), t.shape),
    i = _objectSpread(_objectSpread({}, e.renderMaterial), t.renderMaterial);
  return _objectSpread(_objectSpread(_objectSpread({}, e), t), {}, {
    shape: r,
    renderMaterial: i
  });
}
var Q3 = "\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n";
var I_ = 10,
  kx = /*#__PURE__*/function (_mt11) {
    _inherits(kx, _mt11);
    var _super292 = _createSuper(kx);
    function kx(e, r) {
      var _i$randomScale, _i$randomRotation, _i$renderMaterial$spr, _i$renderMaterial$spr2;
      var _this302;
      _classCallCheck(this, kx);
      _this302 = _super292.call(this);
      _this302.type = "ParticleEmitter";
      _this302.debugMode = !1;
      _this302.worldSpace = !0;
      _this302.rootObject = null;
      _this302.gpuCompute = null;
      _this302.positionSimRT = null;
      _this302.velocitySimRT = null;
      _this302.emissionRateSimRT = null;
      _this302.emitterShape = void 0;
      _this302.isEmitting = !1;
      _this302.hasBeenReset = !1;
      _this302.emittedParticlesAmount = 0;
      _this302.lastEmitTime = 0;
      _this302.globalTime = 0;
      _this302.targetFPS = 60;
      _this302.previousRatio = 1;
      _this302.lerpFactor = .4;
      _this302.particlesAmount = 0;
      _this302.noiseStrength = 0;
      _this302.noiseScale = 0;
      _this302.isBillboardBased = !0;
      _this302.simFeaturesDefinition = {
        USE_COLLIDER: !1,
        USE_ATTRACTOR: !1,
        USE_VORTEX: !1,
        USE_SPHERE_COLLIDER: !1,
        USE_BOX_COLLIDER: !1,
        USE_FORCE_LOCAL_SPACE: !1,
        USE_NORMALS: !1,
        USE_CURL_NOISE: !0,
        USE_SIMPLEX_NOISE: !1,
        USE_FBM_NOISE: !1
      };
      _this302.textureLoader = new my();
      _this302.currentWorldPosition = new _();
      _this302.systemQuaternion = new je();
      _this302.worldGravity = new _(0, 0, 0);
      _this302.directionAxis = new _(0, 0, 0);
      _this302.colliderV3 = new _(0, 0, 0);
      _this302.colliderQuaternion = new je(0, 0, 0, 1);
      _this302.matrixAutoUpdate = !0, _this302.renderer = e, _this302.system = r, _this302.shared = r.context.shared;
      var i = r.data;
      _this302.material = new Fx(i.renderMaterial, r.context), _this302.material.uniforms = {
        uSize: {
          value: 0
        },
        uSizeEnd: {
          value: 0
        },
        uColor: {
          value: i.renderMaterial.color
        },
        uColor2: {
          value: i.renderMaterial.color2
        },
        uPosition: {
          value: new _(0, 0, 0)
        },
        uEmissionData: {
          value: new _(0, 0, 0)
        },
        uTexture: {
          value: _this302.defaultTexture
        },
        uWorldOffset: {
          value: new _(0, 0, 0)
        },
        uWorldQuaternion: {
          value: new He(0, 0, 0, 1)
        },
        uRandScaleFactor: {
          value: (_i$randomScale = i.randomScale) !== null && _i$randomScale !== void 0 ? _i$randomScale : 0
        },
        uRandRotationFactor: {
          value: (_i$randomRotation = i.randomRotation) !== null && _i$randomRotation !== void 0 ? _i$randomRotation : 0
        },
        uRotation: {
          value: (_i$renderMaterial$spr = i.renderMaterial.spriteRotation[0]) !== null && _i$renderMaterial$spr !== void 0 ? _i$renderMaterial$spr : 0
        },
        uRotationEnd: {
          value: (_i$renderMaterial$spr2 = i.renderMaterial.spriteRotation[1]) !== null && _i$renderMaterial$spr2 !== void 0 ? _i$renderMaterial$spr2 : 0
        }
      }, _this302.setTexture(_this302.material.uniforms, i.renderMaterial.texture), _this302.init(i);
      return _this302;
    }
    _createClass(kx, [{
      key: "setTexture",
      value: function setTexture(e, r) {
        var i = r.data;
        if (typeof r == "string") {
          var _s85 = this.shared.image(r),
            o = new qt(_s85.img);
          o.needsUpdate = !0, e.uTexture.value = o;
          return;
        }
        if (typeof i != "string") {
          var _s86 = new Image();
          _s86.onload = function () {
            var l = new qt(_s86);
            l.needsUpdate = !0, e.uTexture.value = l;
          };
          var _o71 = new Blob([i], {
              type: "image/*"
            }),
            a = URL.createObjectURL(_o71);
          _s86.src = a;
        }
      }
    }, {
      key: "updateGeometryAttributes",
      value: function updateGeometryAttributes(e, r) {
        var _this$emitterShape;
        var i = I3(r);
        !((_this$emitterShape = this.emitterShape) !== null && _this$emitterShape !== void 0 && _this$emitterShape.positionsAttribute) || e.geometry.setAttribute("ref", new uo(i, 2));
      }
    }, {
      key: "applyWorldSpace",
      value: function applyWorldSpace() {
        if (!this.system.started || !this.worldSpace || !this.positionSimRT || !this.velocitySimRT) return;
        var e = this.system;
        e.getWorldQuaternion(this.systemQuaternion), this.systemQuaternion.invert(), e.getWorldPosition(this.currentWorldPosition), this.material.uniforms.uWorldOffset.value = this.currentWorldPosition, this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()), this.positionSimRT.material.uniforms.uWorldOffset.value = this.currentWorldPosition, this.systemQuaternion.invert(), this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()), this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize());
      }
    }, {
      key: "update",
      value: function update(e, r) {
        var _this$gpuCompute$getC;
        if (!this.gpuCompute || !this.positionSimRT || !this.velocitySimRT || !this.emissionRateSimRT || this.hasBeenReset) return;
        if (this.checkIfAllParticlesAreDead() && !this.hasBeenReset) {
          this.reset();
          return;
        }
        this.applyWorldSpace(), this.globalTime = e, this.positionSimRT.material.uniforms.uTime.value = e, this.emissionRateSimRT.material.uniforms.uTime.value = e;
        var i = 1e3 / r,
          s = this.targetFPS / i,
          o = this.previousRatio + (s - this.previousRatio) * this.lerpFactor;
        this.positionSimRT.material.uniforms.uFPSRatio.value = o, this.previousRatio = o;
        var a = this.isEmitting ? this.GoEmitSomeParticles(e, this.system.data.birthRatePerSec) : 0;
        this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value = this.emittedParticlesAmount, this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value = a, this.material.uniforms.uPosition.value = (_this$gpuCompute$getC = this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)) === null || _this$gpuCompute$getC === void 0 ? void 0 : _this$gpuCompute$getC.texture, this.system.colliderEntities.length > 0 && this.renderColliders(), this.gpuCompute.compute();
      }
    }, {
      key: "renderColliders",
      value: function renderColliders() {
        if (!this.velocitySimRT) return;
        var e = this.system.colliderEntities[0];
        if (!e) return;
        e.getWorldPosition(this.colliderV3), this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);
        var r = e.data.size;
        this.colliderV3.fromArray(r), this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER ? this.colliderV3.multiplyScalar(.5) : this.colliderV3), e.getWorldQuaternion(this.colliderQuaternion), this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()), this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert());
      }
    }, {
      key: "updateState",
      value: function updateState(e) {
        !this.velocitySimRT || !this.positionSimRT || (e.renderMaterial && this.updateMaterialState(e.renderMaterial), this.updateParticleState(e));
      }
    }, {
      key: "updateVariableState",
      value: function updateVariableState(e, r) {
        var _this303 = this;
        if (!this.velocitySimRT || !this.positionSimRT) return;
        r[2] === "size" && this.material.updateState({
          size: [e, this.material.uniforms.uSizeEnd.value]
        }), r[2] === "sizeEnd" && this.material.updateState({
          size: [this.material.uniforms.uSize.value, e]
        });
        var i = function i(s, o) {
          var a = _toConsumableArray(_this303.system.data.shape.size);
          a[s] = o, _this303.updateParticleState({
            shape: _objectSpread(_objectSpread({}, _this303.system.data.shape), {}, {
              size: a
            })
          });
        };
        r[2] === "shape_size_0" && i(0, e), r[2] === "shape_size_1" && i(1, e), r[2] === "shape_size_2" && i(2, e), r[2] === "speed" && (this.velocitySimRT.material.uniforms.uSpeed.value = e / I_), r[2] === "gravity" && this.worldGravity.set(0, e / 100, 0), r[2] === "noiseStrength" && (this.noiseStrength = e, this.velocitySimRT.material.uniforms.uNoiseStrength.value = this.noiseStrength), r[2] === "noiseScale" && (this.noiseScale = e, this.velocitySimRT.material.uniforms.uNoiseScale.value = this.noiseScale), r[2] === "direction_x" && (this.directionAxis = this.getDirectionAxis([Number(e), this.system.data.direction[1], this.system.data.direction[2]])), r[2] === "direction_y" && (this.directionAxis = this.getDirectionAxis([this.system.data.direction[0], Number(e), this.system.data.direction[2]])), r[2] === "direction_z" && (this.directionAxis = this.getDirectionAxis([this.system.data.direction[0], this.system.data.direction[1], Number(e)]));
      }
    }, {
      key: "updateMaterialState",
      value: function updateMaterialState(e) {
        this.material.updateState(_objectSpread(_objectSpread({}, e), {}, {
          size: e.size ? [Number(this.shared.getVariable(e.size[0], [this.uuid, "particles", "size"])), Number(this.shared.getVariable(e.size[1], [this.uuid, "particles", "sizeEnd"]))] : [0, 0]
        })), e.texture && (this.setTexture(this.material.uniforms, e.texture), this.material.needsUpdate = !0);
      }
    }, {
      key: "updateParticleState",
      value: function updateParticleState(e) {
        if (!(!this.positionSimRT || !this.velocitySimRT)) {
          var _e$renderMaterial, _e$renderMaterial2;
          if (this.shouldReInitGPUCompute(e) && this.init($c(this.system.data)), e.life !== void 0 && (this.positionSimRT.material.uniforms.uMaxLifeTime.value = e.life), e.speed !== void 0 && (this.velocitySimRT.material.uniforms.uSpeed.value = Number(this.shared.getVariable(e.speed, [this.uuid, "particles", "speed"])) / I_), e.collisionBounce !== void 0 && (this.velocitySimRT.material.uniforms.uBounce.value = e.collisionBounce), e.noiseStrength !== void 0 && (this.noiseStrength = Number(this.shared.getVariable(e.noiseStrength, [this.uuid, "particles", "noiseStrength"])), this.velocitySimRT.material.uniforms.uNoiseStrength.value = this.noiseStrength), e.noiseScale !== void 0 && (this.noiseScale = Number(this.shared.getVariable(e.noiseScale, [this.uuid, "particles", "noiseScale"])), this.velocitySimRT.material.uniforms.uNoiseScale.value = this.noiseScale), e.noiseSeed !== void 0 && (this.velocitySimRT.material.uniforms.uNoiseSeed.value = e.noiseSeed), e.randomMass !== void 0 && (this.velocitySimRT.material.uniforms.uRandomMassFactor.value = e.randomMass), ((_e$renderMaterial = e.renderMaterial) === null || _e$renderMaterial === void 0 ? void 0 : _e$renderMaterial.size) !== void 0) {
            var r = this.shared.getVariable(e.renderMaterial.size[0], [this.uuid, "particles", "size"]);
            this.velocitySimRT.material.uniforms.particleSize.value = Number(r);
          }
          if (((_e$renderMaterial2 = e.renderMaterial) === null || _e$renderMaterial2 === void 0 ? void 0 : _e$renderMaterial2.spriteRotation) !== void 0 && (this.material.uniforms.uRotation.value = e.renderMaterial.spriteRotation[0], this.material.uniforms.uRotationEnd.value = e.renderMaterial.spriteRotation[1]), e.shape !== void 0) {
            var _e$shape$size, _this$emitterShape2;
            var _r59 = (_e$shape$size = e.shape.size) !== null && _e$shape$size !== void 0 ? _e$shape$size : this.system.data.shape.size,
              _i154 = [Number(this.shared.getVariable(_r59[0], [this.uuid, "particles", "shape_size_0"])), Number(this.shared.getVariable(_r59[1], [this.uuid, "particles", "shape_size_1"])), Number(this.shared.getVariable(_r59[2], [this.uuid, "particles", "shape_size_2"]))],
              _s87 = _objectSpread(_objectSpread({}, $c(this.system.data).shape), {}, {
                size: _i154
              });
            (_this$emitterShape2 = this.emitterShape) === null || _this$emitterShape2 === void 0 || _this$emitterShape2.applyToShader(this.positionSimRT.material.uniforms, _s87);
          }
          if (e.gravity !== void 0 && (this.worldGravity.set(0, Number(this.shared.getVariable(this.system.data.gravity, [this.uuid, "particles", "gravity"])) / 100, 0), this.velocitySimRT.material.uniforms.uGravity = {
            value: this.worldGravity
          }), e.direction !== void 0) {
            var _r60 = this.getDirectionFromVariable(e.direction);
            this.directionAxis = this.getDirectionAxis(_r60), this.velocitySimRT.material.uniforms.uDirectionsAxis.value = this.directionAxis;
          }
          e.randomRotation !== void 0 && (this.material.uniforms.uRandRotationFactor.value = e.randomRotation), e.randomScale !== void 0 && (this.material.uniforms.uRandScaleFactor.value = e.randomScale);
        }
      }
    }, {
      key: "updateForceFieldParameters",
      value: function updateForceFieldParameters(e) {
        !this.velocitySimRT || (e.forceIntensity !== void 0 && (this.velocitySimRT.material.uniforms.uForceIntensity.value = e.forceIntensity), e.forceDambing !== void 0 && (this.velocitySimRT.material.uniforms.uForceDamping.value = e.forceDambing));
      }
    }, {
      key: "getDirectionAxis",
      value: function getDirectionAxis(e) {
        var r = [Number(e[0]) * Se.DEG2RAD, Number(e[1]) * Se.DEG2RAD, Number(e[2]) * Se.DEG2RAD],
          i = new Kt(r[0], r[1], r[2], "XYZ");
        return this.directionAxis.set(0, 1, 0).applyEuler(i).normalize(), this.velocitySimRT && (this.velocitySimRT.material.uniforms.uDirectionsAxis.value = this.directionAxis), this.directionAxis;
      }
    }, {
      key: "shouldReInitGPUCompute",
      value: function shouldReInitGPUCompute(e) {
        var r = e.birthRatePerSec,
          i = e.rootObjectType,
          s = e.colliderEntityId,
          o = e.shape,
          a = e.emitTimeDuration,
          l = e.emitTimeCycle,
          u = e.life,
          c = e.directionMode,
          d = e.noiseType;
        return r !== void 0 || i !== void 0 || s || s === null || l !== void 0 || o !== void 0 || u !== void 0 || a !== void 0 || c !== void 0 || d !== void 0;
      }
    }, {
      key: "init",
      value: function init(e) {
        var _this304 = this;
        this.dispose(), this.particlesAmount = this.getMaxParticlesAmount({
          birthRatePerSecond: e.birthRatePerSec,
          particleMaxLifeTime: e.life,
          loopDuration: e.emitTimeCycle === "infinity" ? 0 : e.emitTimeDuration
        }), this.particlesAmount > 1e5 && (console.warn("The maximum number of particles is limited to ".concat(1e5, ".")), this.particlesAmount = 1e5), this.emitterShape = this.createShape(e.shape, this.particlesAmount);
        var r = setInterval(function () {
          if (!!_this304.emitterShape) if (isNaN(_this304.emitterShape.positionsTexture.source.data.data[0])) {
            _this304.init(e);
            return;
          } else clearInterval(r);
        }, 100);
        if (!this.emitterShape) return;
        var i = new Lx(this.emitterShape.textureSize, this.emitterShape.textureSize, this.renderer),
          s = this.updateSimulationDefinition(e),
          o = i.addVariable("uCurrentPosition", s + F3, this.emitterShape.positionsTexture),
          a = i.addVariable("uCurrentVelocity", s + G3, this.emitterShape.directionsTexture),
          l = i.addVariable("uCurrentEmissionRate", Q3, N3(this.emitterShape.textureSize));
        i.setVariableDependencies(o, [o, a, l]), i.setVariableDependencies(a, [o, a, l]), i.setVariableDependencies(l, [o, a, l]);
        var u = B3({
            size: this.emitterShape.textureSize
          }),
          c = {
            uOriginalPosition: {
              value: this.emitterShape.positionsTexture
            },
            uWorldOffset: {
              value: new _(0, 0, 0)
            },
            uWorldQuaternion: {
              value: new He(0, 0, 0, 1)
            },
            uTime: {
              value: 0
            },
            uFPSRatio: {
              value: 1
            },
            uMaxLifeTime: {
              value: e.life
            },
            uEmitterSize: {
              value: new _(Number(this.shared.getVariable(e.shape.size[0], [this.uuid, "particles", "shape_size_0"])), Number(this.shared.getVariable(e.shape.size[1], [this.uuid, "particles", "shape_size_1"])), Number(this.shared.getVariable(e.shape.size[2], [this.uuid, "particles", "shape_size_2"])))
            },
            particleSize: {
              value: 0
            }
          };
        o.material.uniforms = c;
        var d = this.getDirectionFromVariable(e.direction);
        this.directionAxis = this.getDirectionAxis(d), this.worldGravity.set(0, Number(this.shared.getVariable(this.system.data.gravity, [this.uuid, "particles", "gravity"])) / 100, 0), this.noiseStrength = Number(this.shared.getVariable(e.noiseStrength, [this.uuid, "particles", "noiseStrength"])), this.noiseScale = Number(this.shared.getVariable(e.noiseScale, [this.uuid, "particles", "noiseScale"]));
        var h = e.colliderEntityId && this.system.getColliderData(e.colliderEntityId),
          f = {
            uOriginalPosition: {
              value: this.emitterShape.positionsTexture
            },
            uDirections: {
              value: this.emitterShape.directionsTexture
            },
            uDirectionsAxis: {
              value: this.directionAxis
            },
            uWorldQuaternion: {
              value: new He(0, 0, 0, 1)
            },
            uColliderPos: {
              value: new _(0, 0, 0)
            },
            uColliderSize: {
              value: new _(0, 0, 0)
            },
            uForceIntensity: {
              value: h ? h.forceIntensity : 0
            },
            uForceDamping: {
              value: h ? h.forceDambing : 0
            },
            uColliderQuaternion: {
              value: new He(0, 0, 0, 1)
            },
            uColliderQuaternionInvert: {
              value: new He(0, 0, 0, 1)
            },
            particleSize: {
              value: 0
            },
            uGravity: {
              value: this.worldGravity
            },
            uNoiseStrength: {
              value: this.noiseStrength
            },
            uNoiseScale: {
              value: this.noiseScale
            },
            uNoiseSeed: {
              value: e.noiseSeed
            },
            uRandomMassFactor: {
              value: e.randomMass
            },
            uBounce: {
              value: e.collisionBounce
            },
            uSpeed: {
              value: Number(this.shared.getVariable(e.speed, [this.uuid, "particles", "speed"])) / I_
            }
          };
        a.material.uniforms = f;
        var p = {
          uIndex: {
            value: u
          },
          uTime: {
            value: 0
          },
          uLastIndexEmitted: {
            value: 0
          },
          uParticlesToEmit: {
            value: 0
          }
        };
        l.material.uniforms = p;
        var m = [Number(this.shared.getVariable(e.shape.size[0], [this.uuid, "particles", "shape_size_0"])), Number(this.shared.getVariable(e.shape.size[1], [this.uuid, "particles", "shape_size_1"])), Number(this.shared.getVariable(e.shape.size[2], [this.uuid, "particles", "shape_size_2"]))],
          g = _objectSpread(_objectSpread({}, $c(this.system.data).shape), {}, {
            size: m
          });
        this.emitterShape.applyToShader(o.material.uniforms, g), i.init(), this.gpuCompute = i, this.positionSimRT = o, this.velocitySimRT = a, this.emissionRateSimRT = l, this.rootObject = this.createPrimaryEmitter(this.emitterShape.textureSize), this.add(this.rootObject), this.material.needsUpdate = !0;
      }
    }, {
      key: "getDirectionFromVariable",
      value: function getDirectionFromVariable(e) {
        var r = Number(this.shared.getVariable(e[0], [this.uuid, "particles", "direction_x"])),
          i = Number(this.shared.getVariable(e[1], [this.uuid, "particles", "direction_y"])),
          s = Number(this.shared.getVariable(e[2], [this.uuid, "particles", "direction_z"]));
        return [r, i, s];
      }
    }, {
      key: "updateSimulationDefinition",
      value: function updateSimulationDefinition(e) {
        if (this.simFeaturesDefinition.USE_COLLIDER = !1, this.simFeaturesDefinition.USE_ATTRACTOR = !1, this.simFeaturesDefinition.USE_VORTEX = !1, this.simFeaturesDefinition.USE_SPHERE_COLLIDER = !1, this.simFeaturesDefinition.USE_BOX_COLLIDER = !1, this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE = !1, this.simFeaturesDefinition.USE_NORMALS = !1, this.simFeaturesDefinition.USE_CURL_NOISE = !1, this.simFeaturesDefinition.USE_SIMPLEX_NOISE = !1, this.simFeaturesDefinition.USE_FBM_NOISE = !1, e.colliderEntityId && this.system.colliderEntities.length > 0) {
          var _i155 = this.system.getColliderData(e.colliderEntityId);
          switch (_i155 === null || _i155 === void 0 ? void 0 : _i155.forceType) {
            case "attractor":
              this.simFeaturesDefinition.USE_ATTRACTOR = !0;
              break;
            case "collider":
              this.simFeaturesDefinition.USE_COLLIDER = !0;
              break;
            case "vortex":
              this.simFeaturesDefinition.USE_VORTEX = !0;
              break;
          }
          var _s88 = _i155 === null || _i155 === void 0 ? void 0 : _i155.colliderType;
          _s88 === "sphere" && (this.simFeaturesDefinition.USE_SPHERE_COLLIDER = !0), _s88 === "box" && (this.simFeaturesDefinition.USE_BOX_COLLIDER = !0), (_i155 === null || _i155 === void 0 ? void 0 : _i155.forceRange) === "helper" && (this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE = !0);
        }
        e.directionMode === "normals" && (this.simFeaturesDefinition.USE_NORMALS = !0), e.noiseType === "curl" && (this.simFeaturesDefinition.USE_CURL_NOISE = !0), e.noiseType === "simplex" && (this.simFeaturesDefinition.USE_SIMPLEX_NOISE = !0), e.noiseType === "fbm" && (this.simFeaturesDefinition.USE_FBM_NOISE = !0);
        var r = "";
        for (var _i156 = 0, _Object$entries36 = Object.entries(this.simFeaturesDefinition); _i156 < _Object$entries36.length; _i156++) {
          var _Object$entries36$_i = _slicedToArray(_Object$entries36[_i156], 2),
            _i157 = _Object$entries36$_i[0],
            _s89 = _Object$entries36$_i[1];
          _s89 && (r += "#define ".concat(_i157, "\n"));
        }
        return r;
      }
    }, {
      key: "createShape",
      value: function createShape(e, r) {
        this.emitterShape && this.emitterShape.dispose();
        var i = new _(Number(this.shared.getVariable(e.size[0], [this.uuid, "particles", "shape_size_0"])), Number(this.shared.getVariable(e.size[1], [this.uuid, "particles", "shape_size_1"])), Number(this.shared.getVariable(e.size[2], [this.uuid, "particles", "shape_size_2"])));
        if (e.type === "MeshEmitterShape") {
          var _s90 = null;
          return this.system.context.scene.traverseEntity(function (o) {
            o.uuid === e.fromMeshId && (_s90 = o);
          }), _s90 ? new Ef(i, r, e.type, _s90) : new Ef(i, r, "SphereEmitterShape");
        } else return new Ef(i, r, e.type);
      }
    }, {
      key: "createPrimaryEmitter",
      value: function createPrimaryEmitter(e) {
        var _this305 = this;
        var r,
          i = e * e;
        return r = new cy(new hn(1, 1, 1), this.material, i), this.updateGeometryAttributes(r, e), this.material.needsUpdate = !0, r.onBeforeRender = function () {
          _this305.applyWorldSpace();
        }, r;
      }
    }, {
      key: "getMaxParticlesAmount",
      value: function getMaxParticlesAmount(_ref64) {
        var e = _ref64.birthRatePerSecond,
          r = _ref64.particleMaxLifeTime,
          _ref64$loopDuration = _ref64.loopDuration,
          i = _ref64$loopDuration === void 0 ? 0 : _ref64$loopDuration;
        return Math.ceil(e * (r + i));
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this$rootObject, _this$emitterShape3;
        !this.gpuCompute || ((_this$rootObject = this.rootObject) !== null && _this$rootObject !== void 0 && (_this$rootObject = _this$rootObject.parent) !== null && _this$rootObject !== void 0 && _this$rootObject.remove(this.rootObject), this.gpuCompute.dispose(), this.material.nodeMaterialDispose(), (_this$emitterShape3 = this.emitterShape) === null || _this$emitterShape3 === void 0 ? void 0 : _this$emitterShape3.dispose());
      }
    }, {
      key: "GoEmitSomeParticles",
      value: function GoEmitSomeParticles(e, r) {
        var i = e - this.lastEmitTime,
          s = 1 / r;
        if (i >= s) {
          var o = Math.max(1, Math.floor(i / s));
          return this.lastEmitTime = e, this.emittedParticlesAmount + o > this.particlesAmount && (this.emittedParticlesAmount = 0), this.emittedParticlesAmount += o, o;
        }
        return 0;
      }
    }, {
      key: "checkIfAllParticlesAreDead",
      value: function checkIfAllParticlesAreDead() {
        return this.lastEmitTime + this.system.data.life + 1 < this.globalTime;
      }
    }, {
      key: "reset",
      value: function reset() {
        this.hasBeenReset = !0, this.lastEmitTime = 0, this.emittedParticlesAmount = 0, this.gpuCompute && this.init($c(this.system.data));
      }
    }, {
      key: "startEmitting",
      value: function startEmitting() {
        this.isEmitting = !0, this.hasBeenReset = !1, this.lastEmitTime = this.globalTime;
      }
    }, {
      key: "stopEmitting",
      value: function stopEmitting() {
        this.isEmitting = !1;
      }
    }]);
    return kx;
  }(mt);
var eu = /*#__PURE__*/function (_nr2) {
  _inherits(eu, _nr2);
  var _super293 = _createSuper(eu);
  function eu(e, r, i) {
    var _this306;
    _classCallCheck(this, eu);
    _this306 = _super293.call(this, e, r);
    _this306.type = "ParticleSystem";
    _this306.geometry = new we();
    _this306.actualTime = 0;
    _this306.currentLoopTime = 0;
    _this306.started = !1;
    _this306.stopped = !1;
    _this306.isFrozen = !1;
    _this306.isIdle = !0;
    _this306.emitter = null;
    _this306.colliderEntities = [];
    _this306.renderer = null;
    _this306.isPreWarm = !1;
    _this306._hasOnAfterRenderBeenCalled = !1;
    _this306.onAfterRender = function (e) {
      _this306._hasOnAfterRenderBeenCalled || (_this306._hasOnAfterRenderBeenCalled = !0, _this306.init(e));
    };
    _this306.context = i, _this306.data = _objectSpread(_objectSpread({}, r), $c(r)), _this306.geometry.setAttribute("position", new be([], 3)), _this306.frustumCulled = !1;
    return _this306;
  }
  _createClass(eu, [{
    key: "init",
    value: function init(e) {
      this.renderer = e, this.emitter = new kx(e, this), this.add(this.emitter), this.updateParticleState(this.data);
    }
  }, {
    key: "update",
    value: function update(e) {
      if (!this.isReady || !this.started || this.isFrozen || this.isIdle) return;
      this.actualTime += e, this.stopped || (this.currentLoopTime += e);
      var r = this.data.emitTimeCycle === "one_time";
      if ((this.data.emitTimeCycle === "loop" || r) && this.currentLoopTime > this.data.emitTimeDuration * 1e3 && (this.stopped || (this.stop(), r || this.start(this.data.emitTimeLoopDelayStart === "start" ? 0 : this.data.emitTimeDelay * 1e3))), this.emitter && this.started) {
        var _s91 = this.actualTime / 1e3;
        this.emitter.update(_s91, e);
      }
      this.scale.set(1, 1, 1), this.updateMatrix();
    }
  }, {
    key: "isReady",
    value: function isReady() {
      return !!this.emitter;
    }
  }, {
    key: "hasCollider",
    value: function hasCollider(e) {
      return this.colliderEntities.some(function (r) {
        return r.identity === e;
      });
    }
  }, {
    key: "getColliderData",
    value: function getColliderData(e) {
      var r = this.colliderEntities.find(function (i) {
        return i.identity === e;
      });
      return r ? r.data : null;
    }
  }, {
    key: "updateByPatchedOp",
    value: function updateByPatchedOp(e, r, i) {
      _get(_getPrototypeOf(eu.prototype), "updateByPatchedOp", this).call(this, e, r, i), wt(e.path, ["renderMaterial"]) && this.updateParticleState({
        renderMaterial: _objectSpread(_objectSpread({}, this.data.renderMaterial), Mr.drop(e, 1).props)
      }), wt(e.path, ["shape"]) && this.updateParticleState({
        shape: _objectSpread(_objectSpread({}, this.data.shape), Mr.drop(e, 1).props)
      });
    }
  }, {
    key: "updateState",
    value: function updateState(e, r) {
      _get(_getPrototypeOf(eu.prototype), "updateState", this).call(this, e, r), this.updateParticleState(e);
    }
  }, {
    key: "updateParticleState",
    value: function updateParticleState(e) {
      if (!!this.emitter) {
        if (e.colliderEntityId !== void 0 && e.colliderEntityId !== null) {
          var r = this.context.scene.find(e.colliderEntityId);
          this.colliderEntities = r ? [r] : [];
        }
        e.colliderEntityId === null && (this.colliderEntities = []), this.emitter.updateState(e), e.emitTimeCycle && this.started && this.start();
      }
    }
  }, {
    key: "updateFromColliderEntity",
    value: function updateFromColliderEntity(e) {
      !this.emitter || (this.emitter.updateForceFieldParameters(e), this.stop(), this.start());
    }
  }, {
    key: "start",
    value: function start() {
      var _this307 = this,
        _this$emitter;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      if (this.currentLoopTime = 0, e) {
        setTimeout(function () {
          _this307.start(0);
        }, e);
        return;
      }
      this.started = !0, this.stopped = !1, this.isFrozen = !1, (_this$emitter = this.emitter) === null || _this$emitter === void 0 ? void 0 : _this$emitter.startEmitting();
    }
  }, {
    key: "froze",
    value: function froze() {
      this.isFrozen = !0;
    }
  }, {
    key: "unFroze",
    value: function unFroze() {
      this.isFrozen = !1;
    }
  }, {
    key: "stop",
    value: function stop() {
      var _this$emitter2;
      this.stopped = !0, this.currentLoopTime = 0, (_this$emitter2 = this.emitter) === null || _this$emitter2 === void 0 ? void 0 : _this$emitter2.stopEmitting();
    }
  }, {
    key: "reset",
    value: function reset() {
      var _this$emitter3;
      this.started = !1, this.stopped = !1, (_this$emitter3 = this.emitter) === null || _this$emitter3 === void 0 ? void 0 : _this$emitter3.reset();
    }
  }, {
    key: "wakeUp",
    value: function wakeUp() {
      this.isIdle = !1;
    }
  }, {
    key: "sleep",
    value: function sleep() {
      this.isIdle = !0, this.reset();
    }
  }]);
  return eu;
}(nr);
function LQ(n, t, e) {
  var r;
  return t.geometry.type === "TextGeometry" ? new tf(n, t, e) : (t.geometry.type === "SubdivGeometry" ? r = new Qs(n, t, e) : t.geometry.type === "PathGeometry" ? r = new Hl(n, t, e) : t.geometry.type === "VectorGeometry" ? r = new Ox(n, t, e) : t.geometry.type === "BooleanGeometry" ? r = new Ln(n, t, e) : t.geometry.type === "UIGeometry" ? r = new fr(n, t, e) : r = new er(n, t, e), r);
}
function zx(n, t, e) {
  return console.assert(t.type !== void 0), t.type === "Mesh" ? LQ(n, t, e) : t.type === "Empty" ? new Ss(n, t) : t.type === "Particle" ? new eu(n, t, e) : t.type === "ParticleCollider" ? new Xc(n, t, e) : t.type === "Splat" ? new Ss(n, t) : t.type === "Bone" ? new Rx(n, t) : t.type === "Page" ? new sr(n, t, e) : t.type === "PointLight" ? new Dx(n, t, e) : t.type === "SpotLight" ? new wf(n, t, e) : t.type === "DirectionalLight" ? new Sf(n, t, e) : t.type === "Component" || t.type === "Instance" ? new Js(n, t, e) : ks.is(t.type) ? new hr(n, t) : (console.error(t), new Ss(n, t));
}
Gs.createEntity = zx;
function BQ(n, t, e) {
  var r = zx(n.identity, t, e),
    i = n.children,
    s = n.attachedPaths,
    o = n.parent,
    a = n.component,
    l = n.instances,
    u = n.overrideData,
    c = n.uuid,
    d = n.stateSelection;
  n.dispose();
  for (var _i158 = 0, _Object$keys11 = Object.keys(n); _i158 < _Object$keys11.length; _i158++) {
    var _h89 = _Object$keys11[_i158];
    delete n[_h89];
  }
  Object.setPrototypeOf(n, Object.getPrototypeOf(r));
  for (var _i159 = 0, _Object$keys12 = Object.keys(r); _i159 < _Object$keys12.length; _i159++) {
    var _h90 = _Object$keys12[_i159];
    n[_h90] = r[_h90];
  }
  n.children = [].concat(_toConsumableArray(n.children), _toConsumableArray(i)), n.attachedPaths = s, n.parent = o, n.component = a, n.instances = l, n.uuid = c, n.overrideData = u, n.updateState(n.data, e), d && n.changeSelectedState(d, e), n.resetBBoxNeedsUpdate();
}
Gs.changeEntityProptotype = BQ;
Gs.Cloner = Gi;
function Z3(n, t, e, r) {
  n.updateByOp(t, e, r, !1);
}
function J3(n, t) {
  var e = !1,
    r = t.getLayersOfType("transmission"),
    i = t.getLayersOfType("outline");
  return i.length > 0 && (n.layers.set(8), r.length > 0 && n.layers.enable(3), e = !0, $h(n), Jh(n)), r.length === 0 && i.length === 0 && n.layers.set(0), n instanceof gs && n.needsAO && n.layers.enable(5), e;
}
function $3(n, t) {
  if (!t.layers) return !1;
  var e = !1,
    r = t.getLayersOfType("transmission").filter(function (s) {
      return s.data.visible;
    }),
    i = t.getLayersOfType("outline").filter(function (s) {
      return s.data.visible;
    });
  return r.length > 0 && (n.layers.set(3), i.length > 0 && n.layers.enable(8), e = !0), r.length === 0 && i.length === 0 && n.layers.set(0), n.needsAO && n.layers.enable(5), e;
}
function eL(n) {
  var t = !1;
  return n.traverseEntity(function (e) {
    if (e instanceof gs) if (Array.isArray(e.material)) for (var r = 0; r < e.material.length; r++) J3(e, e.material[r]) && (t = !0);else J3(e, e.material) && (t = !0);
  }), t;
}
function tL(n) {
  var t = !1;
  return n.traverseEntity(function (e) {
    if (e instanceof gs) if (Array.isArray(e.material)) for (var r = 0; r < e.material.length; r++) $3(e, e.material[r]) && (t = !0);else $3(e, e.material) && (t = !0);
  }), t;
}
var NQ = new Yu(),
  FQ = new te(),
  kQ = new Rs();
function Vm(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
  var i = n.cloner;
  if (i) {
    var _iterator119 = _createForOfIteratorHelper(i.children),
      _step119;
    try {
      for (_iterator119.s(); !(_step119 = _iterator119.n()).done;) {
        var _s92 = _step119.value;
        var o = FQ.copy(_s92.matrixWorld).invert(),
          a = kQ.copy(t.ray).applyMatrix4(o),
          l = n.matrixWorld;
        a.applyMatrix4(l);
        var u = NQ;
        u.set(a.origin, a.direction), u.near = t.near, u.far = t.far;
        var c = u.intersectObject(n, !1);
        c.length > 0 && e.push(_objectSpread(_objectSpread({}, c[0]), {}, {
          object: r ? _s92 : n
        }));
      }
    } catch (err) {
      _iterator119.e(err);
    } finally {
      _iterator119.f();
    }
  }
}
var Vx = /*#__PURE__*/function () {
  function Vx() {
    _classCallCheck(this, Vx);
    this._constraints = new Map();
  }
  _createClass(Vx, [{
    key: "setConstraint",
    value: function setConstraint(t, e) {
      e === null ? this._constraints.delete(t) : this._constraints.set(t, e);
    }
  }, {
    key: "removeDependencies",
    value: function removeDependencies(t) {
      this._constraints.delete(t);
    }
  }, {
    key: "applyConstraints",
    value: function applyConstraints(t) {
      var _this308 = this;
      var e = new Set();
      this._constraints.forEach(function (r, i) {
        var s = [i, r],
          o = r;
        for (; _this308._constraints.has(o);) o = _this308._constraints.get(o), e.has(o) || s.push(o);
        for (var a = s.length - 2; a >= 0; a--) if (!e.has(s[a])) {
          var l = t.find(s[a]);
          l ? l.applyPathSnapping(t) : console.warn("missing entity ".concat(s[a])), e.add(s[a]);
        }
      });
    }
  }, {
    key: "findDependency",
    value: function findDependency(t, e) {
      var r = t;
      for (; this._constraints.has(r);) if (r = this._constraints.get(r), r === e) return !0;
      return !1;
    }
  }]);
  return Vx;
}();
var $s = Pi(Tf()),
  zo = Pi(Mf());
var Ur = Pi(Tf()),
  Ze = Pi(Mf()),
  Wl = /*#__PURE__*/function () {
    function Wl(t, e, r) {
      _classCallCheck(this, Wl);
      this._dataNormalized = t, this._minD = e, this._maxD = r;
    }
    _createClass(Wl, [{
      key: "data",
      get: function get() {
        return this._dataNormalized;
      }
    }, {
      key: "minD",
      get: function get() {
        return this._minD;
      }
    }, {
      key: "maxD",
      get: function get() {
        return this._maxD;
      }
    }, {
      key: "denormalize",
      value: function denormalize() {
        var t = (0, Ur.default)(new Float32Array(this._dataNormalized.size), this._dataNormalized.shape);
        return Ze.muls(t, this._dataNormalized, this._maxD - this._minD), Ze.adds(t, t, this._minD), t;
      }
    }], [{
      key: "createFromUnnormalized",
      value: function createFromUnnormalized(t) {
        var e = Ze.sup(t),
          r = Ze.inf(t),
          i = (0, Ur.default)(new Float32Array(t.size), t.shape),
          s = e - r;
        return s < 1e-4 ? Ze.assigns(i, 0) : (Ze.subs(i, t, r), Ze.divs(i, i, s)), new Wl(i, r, e);
      }
    }]);
    return Wl;
  }(),
  pr = /*#__PURE__*/function () {
    function pr(t, e) {
      _classCallCheck(this, pr);
      this._quantized = t, this._method = e;
    }
    _createClass(pr, [{
      key: "quantized",
      get: function get() {
        return this._quantized;
      }
    }, {
      key: "dequantize",
      value: function dequantize(t, e) {
        var r = this._method,
          i,
          s = this._quantized;
        if (r === "norm8x") {
          var o = pr.maxIntBits(8);
          i = (0, Ur.default)(new Float32Array(s.size), s.shape), Ze.muls(i, s, 1 / o);
        } else if (r === "norm565") {
          var _o72 = (0, Ur.default)(new Uint8Array(s.shape[0]), [s.shape[0]]),
            a = (0, Ur.default)(new Uint8Array(s.shape[0]), [s.shape[0]]),
            l = (0, Ur.default)(new Uint8Array(s.shape[0]), [s.shape[0]]);
          Ze.rrshifts(_o72, s, 11), Ze.rrshifts(a, s, 5), Ze.bandseq(a, pr.maxIntBits(6)), Ze.bands(l, s, pr.maxIntBits(5)), i = (0, Ur.default)(new Float32Array(s.shape[0] * 3), [s.shape[0], 3]), Ze.muls(i.pick(null, 0), _o72, 1 / pr.maxIntBits(5)), Ze.muls(i.pick(null, 1), a, 1 / pr.maxIntBits(6)), Ze.muls(i.pick(null, 2), l, 1 / pr.maxIntBits(5));
        } else {
          var _o73 = (0, Ur.default)(new Uint16Array(s.shape[0]), [s.shape[0]]),
            _a63 = (0, Ur.default)(new Uint16Array(s.shape[0]), [s.shape[0]]),
            _l91 = (0, Ur.default)(new Uint16Array(s.shape[0]), [s.shape[0]]);
          Ze.rrshifts(_o73, s, 21), Ze.rrshifts(_a63, s, 11), Ze.bandseq(_a63, pr.maxIntBits(10)), Ze.bands(_l91, s, pr.maxIntBits(11)), i = (0, Ur.default)(new Float32Array(s.shape[0] * 3), [s.shape[0], 3]), Ze.muls(i.pick(null, 0), _o73, 1 / pr.maxIntBits(11)), Ze.muls(i.pick(null, 1), _a63, 1 / pr.maxIntBits(10)), Ze.muls(i.pick(null, 2), _l91, 1 / pr.maxIntBits(11));
        }
        return new Wl(i, t, e);
      }
    }], [{
      key: "maxIntBits",
      value: function maxIntBits(t) {
        return Math.pow(2, t) - 1;
      }
    }, {
      key: "fromNormalized",
      value: function fromNormalized(t, e) {
        var r = t.data,
          i;
        if (e === "norm8x") {
          var _s93 = pr.maxIntBits(8),
            o = (0, Ur.default)(new Float32Array(r.size), r.shape);
          Ze.muls(o, r, _s93), Ze.roundeq(o), i = (0, Ur.default)(new Uint8Array(o.data), r.shape);
        } else if (e === "norm565") {
          var _s94 = (0, Ur.default)(new Float32Array(r.size), r.shape);
          Ze.assign(_s94, r), Ze.mulseq(_s94.pick(null, 0), pr.maxIntBits(5)), Ze.mulseq(_s94.pick(null, 1), pr.maxIntBits(6)), Ze.mulseq(_s94.pick(null, 2), pr.maxIntBits(5)), Ze.roundeq(_s94);
          var _o74 = (0, Ur.default)(new Uint16Array(_s94.data), r.shape),
            a = (0, Ur.default)(new Uint16Array(r.shape[0]), [r.shape[0]]),
            l = (0, Ur.default)(new Uint16Array(r.shape[0]), [r.shape[0]]);
          Ze.lshifts(a, _o74.pick(null, 0), 11), Ze.lshifts(l, _o74.pick(null, 1), 5), Ze.boreq(a, l), Ze.boreq(a, _o74.pick(null, 2)), i = a;
        } else {
          var _s95 = (0, Ur.default)(new Float32Array(r.size), r.shape);
          Ze.assign(_s95, r), Ze.mulseq(_s95.pick(null, 0), pr.maxIntBits(11)), Ze.mulseq(_s95.pick(null, 1), pr.maxIntBits(10)), Ze.mulseq(_s95.pick(null, 2), pr.maxIntBits(11)), Ze.roundeq(_s95);
          var _o75 = (0, Ur.default)(new Uint32Array(_s95.data), r.shape),
            _a64 = (0, Ur.default)(new Uint32Array(r.shape[0]), [r.shape[0]]),
            _l92 = (0, Ur.default)(new Uint32Array(r.shape[0]), [r.shape[0]]);
          Ze.lshifts(_a64, _o75.pick(null, 0), 21), Ze.lshifts(_l92, _o75.pick(null, 1), 11), Ze.boreq(_a64, _l92), Ze.boreq(_a64, _o75.pick(null, 2)), i = _a64;
        }
        return new pr(i, e);
      }
    }]);
    return pr;
  }();
var mr = /*#__PURE__*/function () {
  function mr(t, e, r, i, s) {
    var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;
    _classCallCheck(this, mr);
    this._quantized = t, this._minMaxMatrix = e, this._chunkSize = r, this._quantizationMethod = i, this._variableChunkSize = s, this._isDynamicChunks = o;
  }
  _createClass(mr, [{
    key: "length",
    get: function get() {
      return this._quantized.shape[0];
    }
  }, {
    key: "nchunks",
    get: function get() {
      return this._minMaxMatrix.shape[0];
    }
  }, {
    key: "quantized",
    get: function get() {
      return this._quantized;
    }
  }, {
    key: "method",
    get: function get() {
      return this._quantizationMethod;
    }
  }, {
    key: "minmaxMatrix",
    get: function get() {
      return this._minMaxMatrix;
    }
  }, {
    key: "_createPrunedMinMax",
    value: function _createPrunedMinMax(t) {
      var e = t.length,
        r = this.minmaxMatrix.shape[0] - e,
        i = (0, $s.default)(new Float32Array(r * 2), [r, 2]),
        s = 0,
        o = r,
        a = 0,
        l = this.minmaxMatrix.shape[0];
      for (var u = 0; u < t.length; u++) l = t[u], o = l - a + s, o > s && zo.assign(i.hi(o, 2).lo(s, 0), this.minmaxMatrix.hi(l, 2).lo(a, 0)), s = o, a = l + 1;
      return s < r && zo.assign(i.lo(s, 0), this.minmaxMatrix.lo(a, 0)), i;
    }
  }, {
    key: "_createPrunedQuantized",
    value: function _createPrunedQuantized(t) {
      var e = t.length,
        r = this.quantized.shape[0] - e,
        i = this._quantizationMethod,
        s,
        o;
      if (i === "norm8x") {
        o = this._quantized.shape[1];
        var d = o ? r * o : r;
        s = (0, $s.default)(new Uint8Array(d), o ? [r, o] : [r, 1]);
      } else i === "norm565" ? s = (0, $s.default)(new Uint16Array(r), [r]) : s = (0, $s.default)(new Uint32Array(r), [r]);
      var a = 0,
        l = r,
        u = 0,
        c = s.shape[0];
      for (var _d58 = 0; _d58 < t.length; _d58++) c = t[_d58], l = c - u + a, l > a && (o ? zo.assign(s.hi(l, o).lo(a, 0), this._quantized.hi(c, o).lo(u, 0)) : zo.assign(s.hi(l).lo(a), this._quantized.hi(c).lo(u))), a = l, u = c + 1;
      return a < r && (o ? zo.assign(s.lo(a, 0), this._quantized.lo(u, 0)) : zo.assign(s.lo(a), this._quantized.lo(u))), s;
    }
  }, {
    key: "pruneFeature",
    value: function pruneFeature(t, e, r) {
      var i = this._createPrunedQuantized(t),
        s = this._createPrunedMinMax(e);
      return new mr(i, s, this._chunkSize, this._quantizationMethod, r, !0);
    }
  }, {
    key: "denormDequant",
    value: function denormDequant() {
      var t = this._minMaxMatrix.shape[0],
        e = this._quantized,
        r = e.shape[0],
        i = this._quantizationMethod,
        s = this._chunkSize,
        o;
      if (this._isDynamicChunks) {
        if (!this._variableChunkSize) throw new Error("variable chunk must exists if chunkSize isDynamic");
        o = this._variableChunkSize;
      }
      var a;
      i === "norm8x" ? a = (0, $s.default)(new Float32Array(e.size), e.shape) : a = (0, $s.default)(new Float32Array(r * 3), [r, 3]);
      var l = 0,
        u = s;
      for (var c = 0; c < t; c++) {
        var _ref65 = [this._minMaxMatrix.get(c, 0), this._minMaxMatrix.get(c, 1)],
          d = _ref65[0],
          _h91 = _ref65[1];
        this._isDynamicChunks && (u = o[c]);
        var f = c + 1 < t ? l + u : r,
          p = void 0;
        e.shape.length > 1 ? p = new pr(e.hi(f, e.shape[1]).lo(l, 0), i) : p = new pr(e.hi(f).lo(l), i), zo.assign(a.hi(f, a.shape[1]).lo(l, 0), p.dequantize(d, _h91).denormalize()), l = f;
      }
      return a;
    }
  }], [{
    key: "getRequiredNChunks",
    value: function getRequiredNChunks(t, e) {
      return Math.floor(t / e);
    }
  }, {
    key: "fromArray",
    value: function fromArray(t, e, r) {
      var i = t.shape[0],
        s = Math.floor(i / r),
        o = (0, $s.default)(new Float32Array(s * 2), [s, 2], [2, 1]),
        a;
      e === "norm8x" ? a = (0, $s.default)(new Uint8Array(t.size), t.shape) : e === "norm565" ? a = (0, $s.default)(new Uint16Array(t.shape[0]), [t.shape[0]]) : a = (0, $s.default)(new Uint32Array(t.shape[0]), [t.shape[0]]);
      for (var l = 0; l < s; l++) {
        var u = l * r,
          c = l + 1 < s ? (l + 1) * r : i,
          d = void 0;
        t.shape.length > 1 ? d = Wl.createFromUnnormalized(t.hi(c, t.shape[1]).lo(u, 0)) : d = Wl.createFromUnnormalized(t.hi(c).lo(u)), o.set(l, 0, d.minD), o.set(l, 1, d.maxD), a.shape.length > 1 ? zo.assign(a.hi(c, a.shape[1]).lo(u, 0), pr.fromNormalized(d, e).quantized) : zo.assign(a.hi(c).lo(u), pr.fromNormalized(d, e).quantized);
      }
      return new mr(a, o, r, e);
    }
  }, {
    key: "fetchArrayBuffer",
    value: function () {
      var _fetchArrayBuffer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(t) {
        return _regeneratorRuntime().wrap(function _callee16$(_context22) {
          while (1) switch (_context22.prev = _context22.next) {
            case 0:
              _context22.next = 2;
              return fetch(t, {
                mode: "cors"
              });
            case 2:
              _context22.next = 4;
              return _context22.sent.arrayBuffer();
            case 4:
              return _context22.abrupt("return", _context22.sent);
            case 5:
            case "end":
              return _context22.stop();
          }
        }, _callee16);
      }));
      function fetchArrayBuffer(_x43) {
        return _fetchArrayBuffer.apply(this, arguments);
      }
      return fetchArrayBuffer;
    }()
  }]);
  return mr;
}();
var La = Pi(Tf()),
  _t = Pi(Mf());
var AL = "http://127.0.0.1:8000";
var tu = Pi(Tf()),
  or = Pi(Mf());
var _L = [1, 10, 100, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9];
function EL(n) {
  return n < 1e5 ? n < 100 ? n < 10 ? 0 : 1 : n < 1e4 ? n < 1e3 ? 2 : 3 : 4 : n < 1e7 ? n < 1e6 ? 5 : 6 : n < 1e9 ? n < 1e8 ? 7 : 8 : 9;
}
function TL(n, t) {
  if (n === t) return 0;
  if (~~n === n && ~~t === t) {
    if (n === 0 || t === 0) return n < t ? -1 : 1;
    if (n < 0 || t < 0) {
      if (t >= 0) return -1;
      if (n >= 0) return 1;
      n = -n, t = -t;
    }
    var _i160 = EL(n),
      _s96 = EL(t),
      o = 0;
    return _i160 < _s96 ? (n *= _L[_s96 - _i160 - 1], t /= 10, o = -1) : _i160 > _s96 && (t *= _L[_i160 - _s96 - 1], n /= 10, o = 1), n === t ? o : n < t ? -1 : 1;
  }
  var e = String(n),
    r = String(t);
  return e === r ? 0 : e < r ? -1 : 1;
}
function cK(n) {
  var t = 0;
  for (; n >= 32;) t |= n & 1, n >>= 1;
  return n + t;
}
function ML(n, t, e, r) {
  var i = t + 1;
  if (i === e) return 1;
  if (r(n[i++], n[t]) < 0) {
    for (; i < e && r(n[i], n[i - 1]) < 0;) i++;
    uK(n, t, i);
  } else for (; i < e && r(n[i], n[i - 1]) >= 0;) i++;
  return i - t;
}
function uK(n, t, e) {
  for (e--; t < e;) {
    var r = n[t];
    n[t++] = n[e], n[e--] = r;
  }
}
function CL(n, t, e, r, i) {
  for (r === t && r++; r < e; r++) {
    var _s97 = n[r],
      o = t,
      a = r;
    for (; o < a;) {
      var u = o + a >>> 1;
      i(_s97, n[u]) < 0 ? a = u : o = u + 1;
    }
    var l = r - o;
    switch (l) {
      case 3:
        n[o + 3] = n[o + 2];
      case 2:
        n[o + 2] = n[o + 1];
      case 1:
        n[o + 1] = n[o];
        break;
      default:
        for (; l > 0;) n[o + l] = n[o + l - 1], l--;
    }
    n[o] = _s97;
  }
}
function B_(n, t, e, r, i, s) {
  var o = 0,
    a = 0,
    l = 1;
  if (s(n, t[e + i]) > 0) {
    for (a = r - i; l < a && s(n, t[e + i + l]) > 0;) o = l, l = (l << 1) + 1, l <= 0 && (l = a);
    l > a && (l = a), o += i, l += i;
  } else {
    for (a = i + 1; l < a && s(n, t[e + i - l]) <= 0;) o = l, l = (l << 1) + 1, l <= 0 && (l = a);
    l > a && (l = a);
    var u = o;
    o = i - l, l = i - u;
  }
  for (o++; o < l;) {
    var _u55 = o + (l - o >>> 1);
    s(n, t[e + _u55]) > 0 ? o = _u55 + 1 : l = _u55;
  }
  return l;
}
function N_(n, t, e, r, i, s) {
  var o = 0,
    a = 0,
    l = 1;
  if (s(n, t[e + i]) < 0) {
    for (a = i + 1; l < a && s(n, t[e + i - l]) < 0;) o = l, l = (l << 1) + 1, l <= 0 && (l = a);
    l > a && (l = a);
    var u = o;
    o = i - l, l = i - u;
  } else {
    for (a = r - i; l < a && s(n, t[e + i + l]) >= 0;) o = l, l = (l << 1) + 1, l <= 0 && (l = a);
    l > a && (l = a), o += i, l += i;
  }
  for (o++; o < l;) {
    var _u56 = o + (l - o >>> 1);
    s(n, t[e + _u56]) < 0 ? l = _u56 : o = _u56 + 1;
  }
  return l;
}
var F_ = /*#__PURE__*/function () {
  function F_(t, e) {
    _classCallCheck(this, F_);
    Di(this, "array", null);
    Di(this, "compare", null);
    Di(this, "minGallop", 7);
    Di(this, "length", 0);
    Di(this, "tmpStorageLength", 256);
    Di(this, "stackLength", 0);
    Di(this, "runStart", null);
    Di(this, "runLength", null);
    Di(this, "stackSize", 0);
    this.array = t, this.compare = e, this.length = t.length, this.length < 2 * 256 && (this.tmpStorageLength = this.length >>> 1), this.tmp = new Array(this.tmpStorageLength), this.stackLength = this.length < 120 ? 5 : this.length < 1542 ? 10 : this.length < 119151 ? 19 : 40, this.runStart = new Array(this.stackLength), this.runLength = new Array(this.stackLength);
  }
  _createClass(F_, [{
    key: "pushRun",
    value: function pushRun(t, e) {
      this.runStart[this.stackSize] = t, this.runLength[this.stackSize] = e, this.stackSize += 1;
    }
  }, {
    key: "mergeRuns",
    value: function mergeRuns() {
      for (; this.stackSize > 1;) {
        var t = this.stackSize - 2;
        if (t >= 1 && this.runLength[t - 1] <= this.runLength[t] + this.runLength[t + 1] || t >= 2 && this.runLength[t - 2] <= this.runLength[t] + this.runLength[t - 1]) this.runLength[t - 1] < this.runLength[t + 1] && t--;else if (this.runLength[t] > this.runLength[t + 1]) break;
        this.mergeAt(t);
      }
    }
  }, {
    key: "forceMergeRuns",
    value: function forceMergeRuns() {
      for (; this.stackSize > 1;) {
        var t = this.stackSize - 2;
        t > 0 && this.runLength[t - 1] < this.runLength[t + 1] && t--, this.mergeAt(t);
      }
    }
  }, {
    key: "mergeAt",
    value: function mergeAt(t) {
      var e = this.compare,
        r = this.array,
        i = this.runStart[t],
        s = this.runLength[t],
        o = this.runStart[t + 1],
        a = this.runLength[t + 1];
      this.runLength[t] = s + a, t === this.stackSize - 3 && (this.runStart[t + 1] = this.runStart[t + 2], this.runLength[t + 1] = this.runLength[t + 2]), this.stackSize--;
      var l = N_(r[o], r, i, s, 0, e);
      i += l, s -= l, s !== 0 && (a = B_(r[i + s - 1], r, o, a, a - 1, e), a !== 0 && (s <= a ? this.mergeLow(i, s, o, a) : this.mergeHigh(i, s, o, a)));
    }
  }, {
    key: "mergeLow",
    value: function mergeLow(t, e, r, i) {
      var s = this.compare,
        o = this.array,
        a = this.tmp,
        l = 0;
      for (l = 0; l < e; l++) a[l] = o[t + l];
      var u = 0,
        c = r,
        d = t;
      if (o[d++] = o[c++], --i === 0) {
        for (l = 0; l < e; l++) o[d + l] = a[u + l];
        return;
      }
      if (e === 1) {
        for (l = 0; l < i; l++) o[d + l] = o[c + l];
        o[d + i] = a[u];
        return;
      }
      var h = this.minGallop;
      for (;;) {
        var f = 0,
          p = 0,
          m = !1;
        do if (s(o[c], a[u]) < 0) {
          if (o[d++] = o[c++], p++, f = 0, --i === 0) {
            m = !0;
            break;
          }
        } else if (o[d++] = a[u++], f++, p = 0, --e === 1) {
          m = !0;
          break;
        } while ((f | p) < h);
        if (m) break;
        do {
          if (f = N_(o[c], a, u, e, 0, s), f !== 0) {
            for (l = 0; l < f; l++) o[d + l] = a[u + l];
            if (d += f, u += f, e -= f, e <= 1) {
              m = !0;
              break;
            }
          }
          if (o[d++] = o[c++], --i === 0) {
            m = !0;
            break;
          }
          if (p = B_(a[u], o, c, i, 0, s), p !== 0) {
            for (l = 0; l < p; l++) o[d + l] = o[c + l];
            if (d += p, c += p, i -= p, i === 0) {
              m = !0;
              break;
            }
          }
          if (o[d++] = a[u++], --e === 1) {
            m = !0;
            break;
          }
          h--;
        } while (f >= 7 || p >= 7);
        if (m) break;
        h < 0 && (h = 0), h += 2;
      }
      if (this.minGallop = h, h < 1 && (this.minGallop = 1), e === 1) {
        for (l = 0; l < i; l++) o[d + l] = o[c + l];
        o[d + i] = a[u];
      } else {
        if (e === 0) throw new Error("mergeLow preconditions were not respected");
        for (l = 0; l < e; l++) o[d + l] = a[u + l];
      }
    }
  }, {
    key: "mergeHigh",
    value: function mergeHigh(t, e, r, i) {
      var s = this.compare,
        o = this.array,
        a = this.tmp,
        l = 0;
      for (l = 0; l < i; l++) a[l] = o[r + l];
      var u = t + e - 1,
        c = i - 1,
        d = r + i - 1,
        h = 0,
        f = 0;
      if (o[d--] = o[u--], --e === 0) {
        for (h = d - (i - 1), l = 0; l < i; l++) o[h + l] = a[l];
        return;
      }
      if (i === 1) {
        for (d -= e, u -= e, f = d + 1, h = u + 1, l = e - 1; l >= 0; l--) o[f + l] = o[h + l];
        o[d] = a[c];
        return;
      }
      var p = this.minGallop;
      for (;;) {
        var m = 0,
          g = 0,
          y = !1;
        do if (s(a[c], o[u]) < 0) {
          if (o[d--] = o[u--], m++, g = 0, --e === 0) {
            y = !0;
            break;
          }
        } else if (o[d--] = a[c--], g++, m = 0, --i === 1) {
          y = !0;
          break;
        } while ((m | g) < p);
        if (y) break;
        do {
          if (m = e - N_(a[c], o, t, e, e - 1, s), m !== 0) {
            for (d -= m, u -= m, e -= m, f = d + 1, h = u + 1, l = m - 1; l >= 0; l--) o[f + l] = o[h + l];
            if (e === 0) {
              y = !0;
              break;
            }
          }
          if (o[d--] = a[c--], --i === 1) {
            y = !0;
            break;
          }
          if (g = i - B_(o[u], a, 0, i, i - 1, s), g !== 0) {
            for (d -= g, c -= g, i -= g, f = d + 1, h = c + 1, l = 0; l < g; l++) o[f + l] = a[h + l];
            if (i <= 1) {
              y = !0;
              break;
            }
          }
          if (o[d--] = o[u--], --e === 0) {
            y = !0;
            break;
          }
          p--;
        } while (m >= 7 || g >= 7);
        if (y) break;
        p < 0 && (p = 0), p += 2;
      }
      if (this.minGallop = p, p < 1 && (this.minGallop = 1), i === 1) {
        for (d -= e, u -= e, f = d + 1, h = u + 1, l = e - 1; l >= 0; l--) o[f + l] = o[h + l];
        o[d] = a[c];
      } else {
        if (i === 0) throw new Error("mergeHigh preconditions were not respected");
        for (h = d - (i - 1), l = 0; l < i; l++) o[h + l] = a[l];
      }
    }
  }]);
  return F_;
}();
function PL(n, t, e, r) {
  if (!Array.isArray(n)) throw new TypeError("Can only sort arrays");
  t ? typeof t != "function" && (r = e, e = t, t = TL) : t = TL, e || (e = 0), r || (r = n.length);
  var i = r - e;
  if (i < 2) return;
  var s = 0;
  if (i < 32) {
    s = ML(n, e, r, t), CL(n, e, r, e + s, t);
    return;
  }
  var o = new F_(n, t),
    a = cK(i);
  do {
    if (s = ML(n, e, r, t), s < a) {
      var l = i;
      l > a && (l = a), CL(n, e, e + l, e + s, t), s = l;
    }
    o.pushRun(e, s), o.mergeRuns(), i -= s, e += s;
  } while (i !== 0);
  o.forceMergeRuns();
}
function k_(n) {
  var t = (0, tu.default)(new Int32Array(n.shape[0]), [n.shape[0]]),
    e = (0, tu.default)(new Int32Array(n.shape[0]), [n.shape[0]]);
  return or.bands(t, n, 1023), or.lshifts(e, t, 16), or.bxoreq(t, e), or.bandseq(t, 4278190335), or.lshifts(e, t, 8), or.bxoreq(t, e), or.bandseq(t, 50393103), or.lshifts(e, t, 4), or.bxoreq(t, e), or.bandseq(t, 51130563), or.lshifts(e, t, 2), or.bxoreq(t, e), or.bandseq(t, 153391689), t;
}
function dK(n) {
  var t = k_(n.pick(null, 0)),
    e = k_(n.pick(null, 1));
  or.lshiftseq(e, 1);
  var r = k_(n.pick(null, 2));
  return or.lshiftseq(r, 2), or.boreq(t, e), or.boreq(t, r), t;
}
function ql(n, t) {
  if (n.shape[0] !== t.shape[0]) throw new Error("wrong length");
  var e = (0, tu.default)(new Float32Array(n.size), n.shape, n.stride, n.offset);
  for (var r = 0; r < t.shape[0]; r++) {
    var _i161 = t.get(r);
    if (n.shape.length > 1) for (var _s98 = 0; _s98 < n.shape[1]; _s98++) e.set(r, _s98, n.get(_i161, _s98));else e.set(r, n.get(_i161));
  }
  return e;
}
function z_(n) {
  var t = or.sup(n),
    e = or.inf(n),
    r = 1e3 / Math.min(1e3, t - e),
    i = (0, tu.default)(new Float32Array(n.data), n.shape);
  or.mulseq(i, r);
  var s = (0, tu.default)(new Int32Array(i.data), n.shape),
    o = dK(s),
    l = Array.from(o.data).map(function (d, h) {
      return [d, h];
    });
  PL(l, function (d, h) {
    return d[0] - h[0];
  });
  var u = l.map(function (_ref66) {
    var _ref67 = _slicedToArray(_ref66, 2),
      d = _ref67[0],
      h = _ref67[1];
    return h;
  });
  return (0, tu.default)(Uint32Array.from(u));
}
var As = /*#__PURE__*/function () {
  function As(t, e, r, i, s, o, a, l, u, c) {
    _classCallCheck(this, As);
    this.propertyDescs = t, this.format = e, this.nsplats = r, this.xyz = i, this.colors = s, this.harmonics = o, this.opacity = a, this.scaling = l, this.rotation = u, this.maxSHDegree = c;
  }
  _createClass(As, [{
    key: "getPlyBinary",
    value: function getPlyBinary() {
      var t = As._generateHeaderString(this.propertyDescs, this.format, this.nsplats),
        e = new TextEncoder().encode(t),
        r = Object.keys(this.propertyDescs).length,
        i = (0, La.default)(new Float32Array(this.nsplats * r), [this.nsplats, r]);
      if (_t.assign(i.pick(null, this.propertyDescs.x.index), this.xyz.pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs.y.index), this.xyz.pick(null, 1)), _t.assign(i.pick(null, this.propertyDescs.z.index), this.xyz.pick(null, 2)), _t.assign(i.pick(null, this.propertyDescs.f_dc_0.index), this.colors.pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs.f_dc_1.index), this.colors.pick(null, 1)), _t.assign(i.pick(null, this.propertyDescs.f_dc_2.index), this.colors.pick(null, 2)), _t.assign(i.pick(null, this.propertyDescs.opacity.index), this.opacity.pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs.scale_0.index), this.scaling.pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs.scale_1.index), this.scaling.pick(null, 1)), _t.assign(i.pick(null, this.propertyDescs.scale_2.index), this.scaling.pick(null, 2)), _t.assign(i.pick(null, this.propertyDescs.rot_0.index), this.rotation.pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs.rot_1.index), this.rotation.pick(null, 1)), _t.assign(i.pick(null, this.propertyDescs.rot_2.index), this.rotation.pick(null, 2)), _t.assign(i.pick(null, this.propertyDescs.rot_3.index), this.rotation.pick(null, 3)), this.harmonics && this.harmonics.length > 0) for (var a = 0; a < this.harmonics.length; a++) {
        var l = a * 3;
        _t.assign(i.pick(null, this.propertyDescs["f_rest_".concat(l)].index), this.harmonics[a].pick(null, 0)), _t.assign(i.pick(null, this.propertyDescs["f_rest_".concat(l + 1)].index), this.harmonics[a].pick(null, 1)), _t.assign(i.pick(null, this.propertyDescs["f_rest_".concat(l + 2)].index), this.harmonics[a].pick(null, 2));
      }
      var s = new Uint8Array(i.data.buffer),
        o = new Uint8Array(s.length + e.length);
      return o.set(e), o.set(s, e.length), o.buffer;
    }
  }, {
    key: "save",
    value: function save(t, e) {
      var r = this.getPlyBinary(),
        i = new Blob([r], {
          type: "application/octet-stream"
        }),
        s = new File([i], t),
        o = new FormData();
      o.append("file", s), o.append("filename", t), o.append("basedir", e), fetch("".concat(AL, "/push_file"), {
        method: "POST",
        body: o
      });
    }
  }, {
    key: "mortonPositionSplatsSort",
    value: function mortonPositionSplatsSort() {
      var t = z_(this.xyz),
        e = ql(this.xyz, t),
        r = ql(this.colors, t),
        i = ql(this.opacity, t),
        s = ql(this.scaling, t),
        o = ql(this.rotation, t),
        a = [];
      for (var l = 0; l < this.harmonics.length; l++) a.push(ql(this.harmonics[l], t));
      return new As(this.propertyDescs, this.format, this.nsplats, e, r, a, i, s, o, this.maxSHDegree);
    }
  }], [{
    key: "loadFile",
    value: function () {
      var _loadFile = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(t) {
        return _regeneratorRuntime().wrap(function _callee17$(_context23) {
          while (1) switch (_context23.prev = _context23.next) {
            case 0:
              _context23.next = 2;
              return fetch(t);
            case 2:
              _context23.next = 4;
              return _context23.sent.arrayBuffer();
            case 4:
              return _context23.abrupt("return", _context23.sent);
            case 5:
            case "end":
              return _context23.stop();
          }
        }, _callee17);
      }));
      function loadFile(_x44) {
        return _loadFile.apply(this, arguments);
      }
      return loadFile;
    }()
  }, {
    key: "_generateHeaderString",
    value: function _generateHeaderString(t, e, r) {
      var i = "ply\nformat ".concat(e.format, " ").concat(e.version, "\nelement vertex ").concat(r),
        s = Object.keys(t).length,
        o = Array(s);
      for (var a in t) {
        var l = t[a];
        o[l.index] = {
          name: a,
          dtype: l.dtype
        };
      }
      for (var _a65 = 0; _a65 < o.length; _a65++) i = "".concat(i, "\nproperty ").concat(o[_a65].dtype, " ").concat(o[_a65].name);
      return "".concat(i, "\nend_header\n");
    }
  }, {
    key: "fromArrayBuffer",
    value: function fromArrayBuffer(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;
      var _As$decodeHeader = As.decodeHeader(t),
        r = _As$decodeHeader.splatCount,
        i = _As$decodeHeader.vertexData,
        s = _As$decodeHeader.propertiesDesc,
        o = _As$decodeHeader.format,
        a = i.buffer.slice(i.byteOffset),
        l = Object.keys(s).length,
        u = (0, La.default)(new Float32Array(a), [r, l]),
        c = 0,
        d = {},
        h = {
          double: 8,
          int: 4,
          uint: 4,
          float: 4,
          short: 2,
          ushort: 2,
          uchar: 1
        };
      for (var w in s) if (s.hasOwnProperty(w)) {
        var A = s[w].dtype;
        d[w] = c, c += h[A];
      }
      var f = (0, La.default)(new Float32Array(r * 3), [r, 3]);
      _t.assign(f.pick(null, 0), u.pick(null, d.x / 4)), _t.assign(f.pick(null, 1), u.pick(null, d.y / 4)), _t.assign(f.pick(null, 2), u.pick(null, d.z / 4));
      var p = (0, La.default)(new Float32Array(r * 3), [r, 3]);
      _t.assign(p.pick(null, 0), u.pick(null, d.scale_0 / 4)), _t.assign(p.pick(null, 1), u.pick(null, d.scale_1 / 4)), _t.assign(p.pick(null, 2), u.pick(null, d.scale_2 / 4));
      var m = (0, La.default)(new Float32Array(r * 3), [r, 3]);
      _t.assign(m.pick(null, 0), u.pick(null, d.f_dc_0 / 4)), _t.assign(m.pick(null, 1), u.pick(null, d.f_dc_1 / 4)), _t.assign(m.pick(null, 2), u.pick(null, d.f_dc_2 / 4));
      var g = (0, La.default)(new Float32Array(r * 4), [r, 4]);
      _t.assign(g.pick(null, 0), u.pick(null, d.rot_1 / 4)), _t.assign(g.pick(null, 1), u.pick(null, d.rot_2 / 4)), _t.assign(g.pick(null, 2), u.pick(null, d.rot_3 / 4)), _t.assign(g.pick(null, 3), u.pick(null, d.rot_0 / 4));
      for (var _w36 = 0; _w36 < r; _w36++) {
        var _A28 = g.pick(_w36, null),
          E = Math.sqrt(Math.pow(_A28.get(0), 2) + Math.pow(_A28.get(1), 2) + Math.pow(_A28.get(2), 2) + Math.pow(_A28.get(3), 2));
        _t.divseq(_A28, E);
      }
      var y = (0, La.default)(new Float32Array(r * 1), [r, 1]);
      _t.assign(y.pick(null, 0), u.pick(null, d.opacity / 4));
      var x = Math.pow(Math.min(Math.max(e, 0), 3) + 1, 2) - 1,
        S = [];
      for (var _w37 = 0; _w37 < x; _w37++) {
        var _A29 = (0, La.default)(new Float32Array(r * 3), [r, 3]),
          _E24 = _w37 * 3;
        _t.assign(_A29.pick(null, 0), u.pick(null, d["f_rest_".concat(_E24)] / 4)), _t.assign(_A29.pick(null, 1), u.pick(null, d["f_rest_".concat(_E24 + 1)] / 4)), _t.assign(_A29.pick(null, 2), u.pick(null, d["f_rest_".concat(_E24 + 2)] / 4)), S.push(_A29);
      }
      return new As(s, o, r, f, m, S, y, p, g, e);
    }
  }, {
    key: "fromPLYFile",
    value: function () {
      var _fromPLYFile = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(t) {
        var e,
          r,
          _args15 = arguments;
        return _regeneratorRuntime().wrap(function _callee18$(_context24) {
          while (1) switch (_context24.prev = _context24.next) {
            case 0:
              e = _args15.length > 1 && _args15[1] !== undefined ? _args15[1] : 3;
              _context24.next = 3;
              return As.loadFile(t);
            case 3:
              r = _context24.sent;
              return _context24.abrupt("return", As.fromArrayBuffer(r, e));
            case 5:
            case "end":
              return _context24.stop();
          }
        }, _callee18);
      }));
      function fromPLYFile(_x45) {
        return _fromPLYFile.apply(this, arguments);
      }
      return fromPLYFile;
    }()
  }, {
    key: "decodeHeader",
    value: function decodeHeader(t) {
      var e = new TextDecoder(),
        r = 0,
        i = "",
        s = 100;
      for (;;) {
        if (r + s >= t.byteLength) throw new Error("End of file reached while searching for end of header");
        var p = new Uint8Array(t, r, s);
        i += e.decode(p), r += s;
        var m = r - s * 2,
          g = new Uint8Array(t, Math.max(0, m), m > 0 ? s * 2 : s);
        if (e.decode(g).includes("end_header")) break;
      }
      var o = i.split("\n"),
        a = 0,
        l = {},
        u = {},
        c = 0,
        d;
      for (var _p53 = 0; _p53 < o.length; _p53++) {
        var _m53 = o[_p53].trim();
        if (_m53.startsWith("element vertex")) {
          var _g45 = _m53.match(/\d+/);
          _g45 && (a = parseInt(_g45[0]));
        } else if (_m53.startsWith("property")) {
          var _g46 = _m53.match(/(\w+)\s+(\w+)\s+(\w+)/);
          if (_g46) {
            var y = _g46[2],
              v = _g46[3];
            l[v] = c, u[v] = {
              dtype: y,
              index: c
            }, c++;
          }
        } else if (_m53.startsWith("format")) {
          var _g47 = _m53.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);
          _g47 && (d = {
            format: _g47[2],
            version: _g47[3]
          });
        } else if (_m53 === "end_header") break;
      }
      var h = i.indexOf("end_header") + 10 + 1,
        f = new DataView(t, h);
      return {
        splatCount: a,
        vertexData: f,
        headerOffset: r,
        propertiesDesc: u,
        format: d
      };
    }
  }]);
  return As;
}();
var ru = /*#__PURE__*/function () {
  function ru(t, e, r, i, s, o, a, l) {
    _classCallCheck(this, ru);
    this.config = t, this.xyz = e, this.scaling = r, this.color = i, this.opacity = s, this.harmonics = a, this.quaternion = o, this.variableChunkSize = l;
  }
  _createClass(ru, [{
    key: "isDynamicChunks",
    get: function get() {
      return this.variableChunkSize && this.variableChunkSize.length > 0;
    }
  }, {
    key: "nchunks",
    get: function get() {
      return this.xyz.nchunks;
    }
  }, {
    key: "nsplats",
    get: function get() {
      return this.xyz.length;
    }
  }, {
    key: "chunkSize",
    get: function get() {
      return this.config.chunkSize;
    }
  }, {
    key: "_countIndexesInChunks",
    value: function _countIndexesInChunks(t) {
      var e = [],
        r = this.nchunks,
        i = this.chunkSize,
        s = this.nsplats,
        o = mr.getRequiredNChunks(s, i);
      if (r === o) for (var a = 0; a < t.length; a++) {
        var l = t[a],
          u = Math.floor(l / this.chunkSize);
        u in e ? e[u].push(l) : e[u] = [l];
      } else {
        var _a66 = this.variableChunkSize,
          _l93 = {},
          _u57 = 0;
        for (var c = 0; c < r; c++) _l93[c] = _u57, _u57 += _a66[c];
        for (var _c43 = 0; _c43 < t.length; _c43++) {
          var d = t[_c43],
            _h92 = Math.min(Math.floor(d / i), r - 1);
          for (; d >= _l93[_h92] + _a66[_h92];) _h92++;
          _h92 in e ? e[_h92].push(d) : e[_h92] = [d];
        }
      }
      return e;
    }
  }, {
    key: "pruneSplats",
    value: function pruneSplats(t) {
      var _this309 = this;
      var e = this._countIndexesInChunks(t),
        r,
        i = [];
      return e.length > 0 && (r = this.variableChunkSize ? _toConsumableArray(this.variableChunkSize) : Array(this.nchunks).fill(this.chunkSize), e.forEach(function (s, o) {
        r[o] -= s.length, r[o] <= 0 && i.push(o);
      }), r = r.filter(function (s) {
        return s > 0;
      })), new ru(this.config, this.xyz.pruneFeature(t, i, r), this.scaling.pruneFeature(t, i, r), this.color.pruneFeature(t, i, r), this.opacity.pruneFeature(t, i, r), this.quaternion.pruneFeature(t, i, r), this.harmonics ? this.harmonics.map(function (s) {
        return s.pruneFeature(t, i, _this309.variableChunkSize);
      }) : void 0, r);
    }
  }, {
    key: "toGaussians",
    value: function toGaussians() {
      var _this$harmonics;
      var t = {
          format: "binary_little_endian",
          version: "1.0"
        },
        e = {},
        r = 0;
      if (e.x = {
        dtype: "float",
        index: r
      }, r++, e.y = {
        dtype: "float",
        index: r
      }, r++, e.z = {
        dtype: "float",
        index: r
      }, r++, e.f_dc_0 = {
        dtype: "float",
        index: r
      }, r++, e.f_dc_1 = {
        dtype: "float",
        index: r
      }, r++, e.f_dc_2 = {
        dtype: "float",
        index: r
      }, r++, this.harmonics && this.harmonics.length > 0) for (var o = 0; o < this.harmonics.length; o++) e["f_rest_".concat(o)] = {
        dtype: "float",
        index: r
      }, r++, e["f_rest_".concat(o + 1)] = {
        dtype: "float",
        index: r
      }, r++, e["f_rest_".concat(o + 2)] = {
        dtype: "float",
        index: r
      }, r++;
      e.opacity = {
        dtype: "float",
        index: r
      }, r++, e.scale_0 = {
        dtype: "float",
        index: r
      }, r++, e.scale_1 = {
        dtype: "float",
        index: r
      }, r++, e.scale_2 = {
        dtype: "float",
        index: r
      }, r++, e.rot_0 = {
        dtype: "float",
        index: r
      }, r++, e.rot_1 = {
        dtype: "float",
        index: r
      }, r++, e.rot_2 = {
        dtype: "float",
        index: r
      }, r++, e.rot_3 = {
        dtype: "float",
        index: r
      }, r++;
      var i = (_this$harmonics = this.harmonics) === null || _this$harmonics === void 0 ? void 0 : _this$harmonics.map(function (o) {
        return o.denormDequant();
      });
      return new As(e, t, this.xyz.length, this.xyz.denormDequant(), this.color.denormDequant(), i || [], this.opacity.denormDequant(), this.scaling.denormDequant(), this.quaternion.denormDequant(), 3);
    }
  }], [{
    key: "compressFromGaussianData",
    value: function compressFromGaussianData(t, e) {
      var r = mr.fromArray(t.xyz, e.xyz, e.chunkSize),
        i = mr.fromArray(t.scaling, e.scaling, e.chunkSize),
        s = mr.fromArray(t.colors, e.color, e.chunkSize),
        o = mr.fromArray(t.opacity, e.opacity, e.chunkSize),
        a = mr.fromArray(t.rotation, e.quaternion, e.chunkSize),
        l = t.harmonics,
        u = [];
      if (e.harmonics) for (var c = 0; c < l.length; c++) {
        var d = mr.fromArray(l[c], e.harmonics, e.chunkSize);
        u.push(d);
      }
      return new ru(e, r, i, s, o, a, u);
    }
  }, {
    key: "loadConfig",
    value: function () {
      var _loadConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(t) {
        return _regeneratorRuntime().wrap(function _callee19$(_context25) {
          while (1) switch (_context25.prev = _context25.next) {
            case 0:
              _context25.next = 2;
              return fetch(t, {
                method: "GET",
                mode: "cors",
                headers: {
                  Accept: "application/json"
                }
              });
            case 2:
              _context25.next = 4;
              return _context25.sent.json();
            case 4:
              return _context25.abrupt("return", _context25.sent);
            case 5:
            case "end":
              return _context25.stop();
          }
        }, _callee19);
      }));
      function loadConfig(_x46) {
        return _loadConfig.apply(this, arguments);
      }
      return loadConfig;
    }()
  }]);
  return ru;
}();
var iu = Pi(Tf()),
  fi = Pi(Mf());
var DL = {
    xyz: 3,
    color: 3,
    opacity: 1,
    scaling: 3,
    quaternion: 4,
    harmonics: 3
  },
  Yl = /*#__PURE__*/function () {
    function Yl(t) {
      _classCallCheck(this, Yl);
      this._buffer = t;
    }
    _createClass(Yl, [{
      key: "buffer",
      get: function get() {
        return this._buffer;
      }
    }, {
      key: "decoded",
      get: function get() {
        return this._decoded || (this._decoded = this.decodeBuffer()), this._decoded;
      }
    }, {
      key: "colorsA",
      get: function get() {
        var t = .28209479177387814,
          e = this.decoded.color.denormDequant(),
          r = this.decoded.opacity.denormDequant(),
          i = (0, iu.default)(new Float32Array(e.shape[0] * 4), [e.shape[0], 4]);
        return fi.mulseq(e, t), fi.addseq(e, .5), fi.mulseq(e, 255), fi.maxseq(e, 0), fi.minseq(e, 255), fi.negeq(r), fi.expeq(r), fi.addseq(r, 1), fi.recipeq(r), fi.mulseq(r, 255), fi.assign(i.hi(e.shape[0], 3).lo(0, 0), e), fi.assign(i.hi(e.shape[0], 4).lo(0, 3), r), (0, iu.default)(new Uint8Array(i.data), [e.shape[0], 4]).data;
      }
    }, {
      key: "nsplats",
      get: function get() {
        return this.decoded.nsplats;
      }
    }, {
      key: "getSplatCount",
      value: function getSplatCount() {
        return this.decoded.nsplats;
      }
    }, {
      key: "precomputedCovarianceBufferData",
      get: function get() {
        return this._precomputedCovarianceBufferData;
      }
    }, {
      key: "decodeBuffer",
      value: function decodeBuffer() {
        var _this$decodeHeader = this.decodeHeader(),
          t = _this$decodeHeader.splatCount,
          e = _this$decodeHeader.chunkCount,
          r = _this$decodeHeader.chunkSize,
          i = _this$decodeHeader.typeChunks,
          s = _this$decodeHeader.vertexData,
          o = _this$decodeHeader.propertiesDesc,
          a = {
            xyz: o.xyz.compressionMethod,
            color: o.color.compressionMethod,
            opacity: o.opacity.compressionMethod,
            scaling: o.scaling.compressionMethod,
            quaternion: o.quaternion.compressionMethod,
            chunkSize: r
          };
        o.harmonics_0 && (a.harmonics = o.harmonics_0.compressionMethod);
        var l = s.byteOffset,
          u = Array(Object.keys(o).length);
        for (var y in o) u[o[y].index] = {
          name: y,
          method: o[y].compressionMethod
        };
        var c = e * 2 * 4,
          d = l,
          h = i === "dynamic" ? e * 2 : 0,
          f,
          p = !1;
        if (h > 0) {
          var _y48 = new Uint16Array(s.buffer.slice(d, d + h));
          d += h, f = Array.from(_y48), p = !0;
        }
        var m = {};
        for (var _i162 = 0, _u58 = u; _i162 < _u58.length; _i162++) {
          var _y49 = _u58[_i162];
          var v = 0,
            x = !0;
          if (_y49.method === "norm8x") v = t * 1 * DL[_y49.name];else if (_y49.method === "norm11") v = t * 4;else if (_y49.method === "norm565") v = t * 2;else throw x = !1, new Error("Not Implemented format: ".concat(_y49.method));
          var S = void 0;
          if (x) {
            var E = s.buffer.slice(d, d + c);
            S = (0, iu.default)(new Float32Array(E), [e, 2]), d += c;
          } else throw new Error("loading chunk byt hasnot minmax!");
          var w = s.buffer.slice(d, d + v);
          d += v;
          var A = void 0;
          if (_y49.method === "norm8x") A = (0, iu.default)(new Uint8Array(w), [t, DL[_y49.name]]);else if (_y49.method === "norm11") A = (0, iu.default)(new Uint32Array(w));else if (_y49.method === "norm565") A = (0, iu.default)(new Uint16Array(w));else throw new Error("Not Implemented format: ".concat(_y49.method));
          m[_y49.name] = new mr(A, S, r, _y49.method, f, p);
        }
        var g = [];
        for (var _y50 = 0; _y50 < 15; _y50++) {
          var _v33 = m["harmonics_".concat(_y50)];
          _v33 && (g.push(_v33), delete m["harmonics_".concat(_y50)]);
        }
        return g.length > 0 && (m.harmonics = g), new ru(a, m.xyz, m.scaling, m.color, m.opacity, m.quaternion, m.harmonics, f);
      }
    }, {
      key: "buildPreComputedBuffers",
      value: function buildPreComputedBuffers() {
        var r = this.decoded,
          i = r.nsplats,
          s = new ArrayBuffer(24 * i),
          o = new Float32Array(s),
          a = r.scaling.denormDequant(),
          l = r.quaternion.denormDequant(),
          u = new je(),
          c = new Qt(),
          d = new Qt(),
          h = new Qt(),
          f = new te();
        for (var p = 0; p < i; p++) {
          f.makeScale(Math.exp(a.get(p, 0)), Math.exp(a.get(p, 1)), Math.exp(a.get(p, 2))), d.setFromMatrix4(f), u.set(l.get(p, 0), l.get(p, 1), l.get(p, 2), l.get(p, 3)), f.makeRotationFromQuaternion(u), c.setFromMatrix4(f), h.copy(c).multiply(d);
          var m = h.elements;
          o[6 * p] = m[0] * m[0] + m[3] * m[3] + m[6] * m[6], o[6 * p + 1] = m[0] * m[1] + m[3] * m[4] + m[6] * m[7], o[6 * p + 2] = m[0] * m[2] + m[3] * m[5] + m[6] * m[8], o[6 * p + 3] = m[1] * m[1] + m[4] * m[4] + m[7] * m[7], o[6 * p + 4] = m[1] * m[2] + m[4] * m[5] + m[7] * m[8], o[6 * p + 5] = m[2] * m[2] + m[5] * m[5] + m[8] * m[8];
        }
        this._precomputedCovarianceBufferData = s;
      }
    }, {
      key: "decodeHeader",
      value: function decodeHeader() {
        var t = this._buffer,
          e = new TextDecoder(),
          r = 0,
          i = "",
          s = 100;
        for (;;) {
          if (r + s >= t.byteLength) throw new Error("End of file reached while searching for end of header");
          var m = new Uint8Array(t, r, s);
          i += e.decode(m), r += s;
          var g = r - s * 2,
            y = new Uint8Array(t, Math.max(0, g), g >= 0 ? s * 2 : s);
          if (e.decode(y).includes("end_header")) break;
        }
        var o = i.split("\n"),
          a = 0,
          l = 0,
          u = 0,
          c = 0,
          d = "",
          h = {};
        for (var _m54 = 0; _m54 < o.length; _m54++) {
          var _g48 = o[_m54].trim();
          if (_g48.startsWith("element vertex")) {
            var _y51 = _g48.match(/\d+/);
            _y51 && (a = parseInt(_y51[0]));
          } else if (_g48.startsWith("property")) {
            var _y52 = _g48.match(/(\w+)\s+(\w+)\s+(\w+)/);
            if (_y52) {
              var v = _y52[2],
                x = _y52[3];
              h[v] = {
                compressionMethod: x,
                index: c
              }, c++;
            }
          } else if (_g48.startsWith("element chunks")) {
            var _y53 = _g48.match(/\d+/);
            _y53 && (l = parseInt(_y53[0]));
          } else if (_g48.startsWith("element chunkSize")) {
            var _y54 = _g48.match(/\d+/);
            _y54 && (u = parseInt(_y54[0]));
          } else if (_g48.startsWith("element typeChunks")) {
            var _y55 = _g48.match(/(\w+)\s+(\w+)\s+(\w+)/);
            _y55 && (d = _y55[3]);
          } else if (_g48 === "end_header") break;
        }
        var f = i.indexOf("end_header") + 10 + 1,
          p = new DataView(t, f);
        return {
          splatCount: a,
          chunkCount: l,
          chunkSize: u,
          typeChunks: d,
          vertexData: p,
          propertiesDesc: h
        };
      }
    }, {
      key: "pruneSplats",
      value: function pruneSplats(t) {
        var r = this.decodeBuffer().pruneSplats(t);
        return Yl.fromCompressedGaussianSplats(r);
      }
    }], [{
      key: "fromCompressedGaussianSplats",
      value: function fromCompressedGaussianSplats(t) {
        var e = t.xyz.length,
          r = t.xyz.nchunks,
          i = "gspline\nelement vertex ".concat(e, "\nelement chunks ").concat(r, "\nelement chunkSize ").concat(t.chunkSize, "\nelement typeChunks ").concat(t.isDynamicChunks ? "dynamic" : "static", "\nproperty xyz ").concat(t.xyz.method, "\nproperty color ").concat(t.color.method, "\nproperty opacity ").concat(t.opacity.method, "\nproperty scaling ").concat(t.scaling.method, "\nproperty quaternion ").concat(t.quaternion.method);
        if (t.harmonics && t.harmonics.length > 0) for (var T = 0; T < t.harmonics.length; T++) i = "".concat(i, "\nproperty harmonics_").concat(T, " ").concat(t.harmonics[T].method);
        i = "".concat(i, "\nend_header\n");
        var o = new TextEncoder().encode(i),
          a = r * 2 * 4,
          l = t.xyz.quantized.data.buffer.byteLength,
          u = t.xyz instanceof mr ? a : 0,
          c = t.color.quantized.data.buffer.byteLength,
          d = t.color instanceof mr ? a : 0,
          h = t.opacity.quantized.data.buffer.byteLength,
          f = t.opacity instanceof mr ? a : 0,
          p = t.scaling.quantized.data.buffer.byteLength,
          m = t.scaling instanceof mr ? a : 0,
          g = t.quaternion.quantized.data.buffer.byteLength,
          y = t.quaternion instanceof mr ? a : 0,
          v = t.variableChunkSize ? Uint16Array.from(t.variableChunkSize) : void 0,
          x = v ? v.byteLength : 0,
          S = o.byteLength + x + l + u + c + d + h + f + p + m + g + y,
          w = 0,
          A = 0;
        if (t.harmonics && t.harmonics.length > 0) for (var _T14 = 0; _T14 < t.harmonics.length; _T14++) w += t.harmonics[_T14].quantized.data.buffer.byteLength, A += t.harmonics[_T14] instanceof mr ? a : 0;
        w = 0, A = 0, S += w + A;
        var E = new Uint8Array(S),
          b = 0;
        if (E.set(o, b), b += o.byteLength, x > 0 && (E.set(new Uint8Array(v.buffer), b), b += x), t.xyz instanceof mr && (E.set(new Uint8Array(t.xyz.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(t.xyz.quantized.data.buffer), b), b += l, t.color instanceof mr && (E.set(new Uint8Array(t.color.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(t.color.quantized.data.buffer), b), b += c, t.opacity instanceof mr && (E.set(new Uint8Array(t.opacity.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(t.opacity.quantized.data.buffer), b), b += h, t.scaling instanceof mr && (E.set(new Uint8Array(t.scaling.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(t.scaling.quantized.data.buffer), b), b += p, t.quaternion instanceof mr && (E.set(new Uint8Array(t.quaternion.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(t.quaternion.quantized.data.buffer), b), b += g, w > 0 && t.harmonics && t.harmonics.length > 0) for (var _T15 = 0; _T15 < t.harmonics.length; _T15++) {
          var M = t.harmonics[_T15];
          M instanceof mr && (E.set(new Uint8Array(M.minmaxMatrix.data.buffer), b), b += a), E.set(new Uint8Array(M.quantized.data.buffer), b), b += M.quantized.data.byteLength;
        }
        return new Yl(E.buffer);
      }
    }]);
    return Yl;
  }();
var OL = "AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL";
var Vo = /*#__PURE__*/_createClass(function Vo() {
  _classCallCheck(this, Vo);
});
Di(Vo, "DepthMapRange", 1 << 16), Di(Vo, "MemoryPageSize", 65536), Di(Vo, "BytesPerFloat", 4), Di(Vo, "BytesPerInt", 4);
function hK(n) {
  var t, e, r, i, s, o, a, l, u, c, d, h, f, p, m, g;
  function y(C) {
    var P = new Float64Array(c, o, 16);
    for (var O = 0; O < 16; O++) P[O] = C[O];
    var D;
    if (r > 1) {
      t.exports.sortIndexes(i, s, u, o, a, l, h.DepthMapRange, r);
      var _O23 = new Uint32Array(r);
      D = _O23.buffer, _O23.set(new Uint32Array(c, l, r));
    } else if (r === 1) {
      var _O24 = new Uint32Array(r);
      _O24[0] = new Uint32Array(c, i, e)[0], D = _O24.buffer;
    } else D = new ArrayBuffer(0);
    n.postMessage({
      sortDone: !0,
      indexesBuffer: D
    }, [D]);
  }
  function v(C, P, D) {
    var O = new Float32Array(c, s, e * 3);
    r = 0;
    var I = new Uint32Array(c, i, e);
    for (var z = 0; z < D.length - 1; z++) {
      var B = P[z],
        _V16 = C[z].elements,
        _U17 = B.filter(function (W) {
          return W.enabled && W.mode === "Include";
        }).map(function (W) {
          return W.type === "Box" ? A(W) : T(W);
        }),
        j = B.filter(function (W) {
          return W.enabled && W.mode === "Exclude";
        }).map(function (W) {
          return W.type === "Box" ? A(W) : T(W);
        });
      for (var W = D[z]; W < D[z + 1]; W++) {
        var k = f[W * 3],
          H = f[W * 3 + 1],
          X = f[W * 3 + 2];
        if ((_U17.length === 0 || S(k, H, X, _U17)) && (j.length === 0 || !S(k, H, X, j))) {
          var q = 1 / (_V16[3] * k + _V16[7] * H + _V16[11] * X + _V16[15]);
          O[r * 3] = (_V16[0] * k + _V16[4] * H + _V16[8] * X + _V16[12]) * q, O[r * 3 + 1] = (_V16[1] * k + _V16[5] * H + _V16[9] * X + _V16[13]) * q, O[r * 3 + 2] = (_V16[2] * k + _V16[6] * H + _V16[10] * X + _V16[14]) * q, I[r] = W, r++;
        }
      }
    }
  }
  function x(C, P) {
    var D = [],
      O = P.filter(function (B) {
        return B.enabled && B.mode === "Include";
      }).map(function (B) {
        return B.type === "Box" ? A(B) : T(B);
      }),
      I = P.filter(function (B) {
        return B.enabled && B.mode === "Exclude";
      }).map(function (B) {
        return B.type === "Box" ? A(B) : T(B);
      }),
      z = C.length;
    for (var B = 0; B < z; B += 3) {
      var _V17 = C[B],
        _U18 = C[B + 1],
        j = C[B + 2];
      (O.length === 0 || S(_V17, _U18, j, O)) && (I.length === 0 || !S(_V17, _U18, j, I)) || D.push(B / 3);
    }
    return console.log(D), D;
  }
  function S(C, P, D, O, I) {
    return O[I === "Intersect" ? "every" : "some"](function (z) {
      var B = w(C, P, D, z.invRotationMatrix, z.cropCenter);
      return Array.isArray(z) ? b(B.x, B.y, B.z, z) : M(B.x, B.y, B.z, z);
    });
  }
  function w(C, P, D, O, I) {
    var z = C - I[0],
      B = P - I[1],
      V = D - I[2],
      U = 1 / (O[3] * z + O[7] * B + O[11] * V + O[15]);
    return {
      x: (O[0] * z + O[4] * B + O[8] * V + O[12]) * U + I[0],
      y: (O[1] * z + O[5] * B + O[9] * V + O[13]) * U + I[1],
      z: (O[2] * z + O[6] * B + O[10] * V + O[14]) * U + I[2]
    };
  }
  function A(C) {
    var P = C.cropSize[0] / 2,
      D = C.cropSize[1] / 2,
      O = C.cropSize[2] / 2,
      I = [C.cropCenter[0] - P, C.cropCenter[1] - D, C.cropCenter[2] - O, C.cropCenter[0] + P, C.cropCenter[1] + D, C.cropCenter[2] + O],
      z = E(C.cropRotation);
    return Object.assign(I, {
      invRotationMatrix: z,
      cropCenter: C.cropCenter
    });
  }
  function E(C) {
    var P = [],
      D = C[0] * Math.PI / 180,
      O = C[1] * Math.PI / 180,
      I = C[2] * Math.PI / 180,
      z = Math.cos(D),
      B = Math.sin(D),
      V = Math.cos(O),
      U = Math.sin(O),
      j = Math.cos(I),
      W = Math.sin(I),
      k = z * j,
      H = z * W,
      X = B * j,
      q = B * W;
    return P[0] = V * j, P[1] = -V * W, P[2] = U, P[4] = H + X * U, P[5] = k - q * U, P[6] = -B * V, P[8] = q - k * U, P[9] = X + H * U, P[10] = z * V, P[12] = 0, P[13] = 0, P[14] = 0, P[3] = 0, P[7] = 0, P[11] = 0, P[15] = 1, P;
  }
  function b(C, P, D, O) {
    return C >= O[0] && C <= O[3] && P >= O[1] && P <= O[4] && D >= O[2] && D <= O[5];
  }
  function T(C) {
    var P = 2 / C.cropSize[0],
      D = 2 / C.cropSize[1],
      O = 2 / C.cropSize[2],
      I = E(C.cropRotation);
    return {
      invRadiusX: P,
      invRadiusY: D,
      invRadiusZ: O,
      cropCenter: C.cropCenter,
      invRotationMatrix: I
    };
  }
  function M(C, P, D, O) {
    var I = (C - O.cropCenter[0]) * O.invRadiusX,
      z = (P - O.cropCenter[1]) * O.invRadiusY,
      B = (D - O.cropCenter[2]) * O.invRadiusZ;
    return I * I + z * z + B * B <= 1;
  }
  n.onmessage = function (C) {
    if (C.data.getCroppedIndexes) {
      var P = new Uint32Array(x(new Float32Array(C.data.positions), C.data.crops)).buffer;
      n.postMessage({
        outOfBoundsIndexes: P
      }, [P]);
    } else if (C.data.positions) d = C.data.positions, f = new Float32Array(d), m = C.data.meshMatrixWorlds, g = C.data.cropsArray, p = C.data.meshIndexIntervals, v(m, g, p), n.postMessage({
      sortSetupComplete: !0
    });else if (C.data.sort || C.data.newMatrixWorlds || C.data.newCropsArray) (C.data.newMatrixWorlds || C.data.newCropsArray) && (g = C.data.newCropsArray || g, m = C.data.newMatrixWorlds || m, v(m, g, p)), y(C.data.sort.view, C.data.sort.cameraPosition);else if (C.data.init) {
      h = C.data.init.Constants, e = C.data.init.splatCount;
      var _P22 = h.BytesPerInt,
        D = h.BytesPerFloat * 3,
        O = new Uint8Array(C.data.init.sorterWasmBytes),
        I = _P22 + D,
        z = e * I,
        B = e * h.BytesPerInt * 2 + h.DepthMapRange * h.BytesPerInt * 2,
        _V18 = h.MemoryPageSize * 32,
        _U19 = z + B + _V18,
        j = Math.floor(_U19 / h.MemoryPageSize) + 1,
        W = {
          module: {},
          env: {
            memory: new WebAssembly.Memory({
              initial: j * 2,
              maximum: j * 3,
              shared: !0
            })
          }
        };
      WebAssembly.compile(O).then(function (k) {
        return WebAssembly.instantiate(k, W);
      }).then(function (k) {
        t = k, i = 0, s = e * _P22, o = s + e * D, u = o + 16 * h.BytesPerFloat * 2, a = u + e * h.BytesPerInt, l = a + h.DepthMapRange * h.BytesPerInt, c = W.env.memory.buffer, n.postMessage({
          sortSetupPhase1Complete: !0
        });
      });
    }
  };
}
function IL(n) {
  var t = new Worker(URL.createObjectURL(new Blob(["(", hK.toString(), ")(self)"], {
      type: "application/javascript"
    }))),
    e = atob(OL),
    r = new Uint8Array(e.length);
  for (var _i163 = 0; _i163 < e.length; _i163++) r[_i163] = e.charCodeAt(_i163);
  return t.postMessage({
    init: {
      sorterWasmBytes: r.buffer,
      splatCount: n,
      Constants: {
        BytesPerFloat: Vo.BytesPerFloat,
        BytesPerInt: Vo.BytesPerInt,
        DepthMapRange: Vo.DepthMapRange,
        MemoryPageSize: Vo.MemoryPageSize
      }
    }
  }), t;
}
var jx = function () {
    var n = new Float32Array(1),
      t = new Int32Array(n.buffer);
    return function (e) {
      return n[0] = e, t[0];
    };
  }(),
  RL = function RL(n, t, e, r) {
    return n + (t << 8) + (e << 16) + (r << 24);
  };
var Hx = new N(),
  Xl = /*#__PURE__*/function (_rr3) {
    _inherits(Xl, _rr3);
    var _super294 = _createSuper(Xl);
    function Xl(e, r, i, s) {
      var _this310;
      var o = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
      var a = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;
      var l = arguments.length > 6 ? arguments[6] : undefined;
      var u = arguments.length > 7 ? arguments[7] : undefined;
      _classCallCheck(this, Xl);
      _this310 = _super294.call(this, i, s);
      _this310.splatCount = r, _this310.meshIndexIntervals = l, _this310.meshMatrixWorlds = u, _this310.splatBuffers = e, _this310.geometry = i, _this310.material = s, _this310.splatDataTextures = null, _this310.halfPrecisionCovariancesOnGPU = o, _this310.devicePixelRatio = a, _this310.resetLocalSplatDataAndTexturesFromSplatBuffer();
      return _this310;
    }
    _createClass(Xl, [{
      key: "resetLocalSplatDataAndTexturesFromSplatBuffer",
      value: function resetLocalSplatDataAndTexturesFromSplatBuffer() {
        this.updateLocalSplatDataFromSplatBuffer(), this.allocateAndStoreLocalSplatDataInTextures();
      }
    }, {
      key: "updateLocalSplatDataFromSplatBuffer",
      value: function updateLocalSplatDataFromSplatBuffer() {
        this.splatBuffers.forEach(function (s) {
          return s.buildPreComputedBuffers();
        }), this.covariances = new Float32Array(this.splatCount * 6), this.colors = new Uint8Array(this.splatCount * 4), this.centers = new Float32Array(this.splatCount * 3);
        var e = 0,
          r = 0,
          i = 0;
        var _iterator120 = _createForOfIteratorHelper(this.splatBuffers),
          _step120;
        try {
          for (_iterator120.s(); !(_step120 = _iterator120.n()).done;) {
            var _s99 = _step120.value;
            var o = _s99.nsplats;
            this.colors.subarray(e, e + o * 4).set(_s99.colorsA), e += o * 4, this.centers.subarray(r, r + o * 3).set(_s99.decoded.xyz.denormDequant().data), r += o * 3, this.covariances.subarray(i, i + o * 6).set(new Float32Array(_s99.precomputedCovarianceBufferData)), i += o * 6;
          }
        } catch (err) {
          _iterator120.e(err);
        } finally {
          _iterator120.f();
        }
      }
    }, {
      key: "allocateAndStoreLocalSplatDataInTextures",
      value: function allocateAndStoreLocalSplatDataInTextures() {
        var i = this.splatCount,
          s = new N(4096, 1024);
        for (; s.x * s.y * 2 < i * 6;) s.y *= 2;
        var o = new N(4096, 1024);
        for (; o.x * o.y * 4 < i * 4;) o.y *= 2;
        var a, l;
        if (this.halfPrecisionCovariancesOnGPU) {
          l = new Uint16Array(s.x * s.y * 2);
          for (var p = 0; p < this.covariances.length; p++) l[p] = GM.toHalfFloat(this.covariances[p]);
          a = new ci(l, s.x, s.y, Ku, sa);
        } else l = new Float32Array(s.x * s.y * 2), l.set(this.covariances), a = new ci(l, s.x, s.y, Ku, dr);
        a.needsUpdate = !0, this.material.uniforms.covariancesTexture.value = a, this.material.uniforms.covariancesTextureSize.value.copy(s);
        var u = new Uint32Array(o.x * o.y * 4);
        for (var _p54 = 0; _p54 < i; _p54++) {
          var m = _p54 * 4,
            g = _p54 * 3,
            y = _p54 * 4;
          u[y] = RL(this.colors[m], this.colors[m + 1], this.colors[m + 2], this.colors[m + 3]), u[y + 1] = jx(this.centers[g]), u[y + 2] = jx(this.centers[g + 1]), u[y + 3] = jx(this.centers[g + 2]);
        }
        var c = new ci(u, o.x, o.y, nw, Ds);
        c.internalFormat = "RGBA32UI", c.needsUpdate = !0, this.material.uniforms.centersColorsTexture.value = c, this.material.uniforms.centersColorsTextureSize.value.copy(o);
        var d = 256 * 4,
          h = new Float32Array(256 * 16);
        for (var _p55 = 0; _p55 < this.meshMatrixWorlds.length; _p55++) h.set(this.meshMatrixWorlds[_p55].elements, _p55 * 16);
        var f = new ci(h, d, 1, Fr, dr);
        f.needsUpdate = !0, this.material.uniforms.meshMatrixWorldsTexture.value = f, this.material.uniformsNeedUpdate = !0, this.splatDataTextures = {
          covariances: {
            data: l,
            texture: a,
            size: s
          },
          centerColors: {
            data: u,
            texture: c,
            size: o
          },
          meshMatrixWorlds: {
            data: h,
            texture: f
          }
        };
      }
    }, {
      key: "updateIndexes",
      value: function updateIndexes(e) {
        var r = this.geometry;
        r.attributes.splatIndex.set(e), r.attributes.splatIndex.needsUpdate = !0, r.instanceCount = e.length;
      }
    }, {
      key: "updateUniforms",
      value: function updateUniforms(e, r, i, s) {
        this.splatCount > 0 && (Hx.set(e.x * this.devicePixelRatio, e.y * this.devicePixelRatio), this.material.uniforms.viewport.value.copy(Hx), this.material.uniforms.basisViewport.value.set(2 / Hx.x, 2 / Hx.y), this.material.uniforms.focal.value.set(r, i), this.material.uniforms.orthoZoom.value = s, this.material.uniformsNeedUpdate = !0);
      }
    }, {
      key: "getSplatDataTextures",
      value: function getSplatDataTextures() {
        return this.splatDataTextures;
      }
    }, {
      key: "getSplatCount",
      value: function getSplatCount() {
        return this.splatCount;
      }
    }, {
      key: "getCenters",
      value: function getCenters() {
        return this.centers;
      }
    }, {
      key: "getColors",
      value: function getColors() {
        return this.colors;
      }
    }, {
      key: "getCovariances",
      value: function getCovariances() {
        return this.covariances;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.geometry.dispose(), this.material.dispose(), this.splatDataTextures && (this.splatDataTextures.covariances.texture.dispose(), this.splatDataTextures.centerColors.texture.dispose(), this.splatDataTextures.meshMatrixWorlds.texture.dispose());
      }
    }], [{
      key: "buildMesh",
      value: function buildMesh(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;
        var o = arguments.length > 4 ? arguments[4] : undefined;
        var a = arguments.length > 5 ? arguments[5] : undefined;
        var l = Xl.buildGeomtery(r),
          u = Xl.buildMaterial(o);
        return new Xl(e, r, l, u, i, s, o, a);
      }
    }, {
      key: "buildMaterial",
      value: function buildMaterial(e) {
        var r = "\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",
          i = "\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",
          s = {
            covariancesTexture: {
              type: "t",
              value: null
            },
            centersColorsTexture: {
              type: "t",
              value: null
            },
            meshIndexIntervals: {
              value: e
            },
            meshMatrixWorldsTexture: {
              type: "t",
              value: null
            },
            focal: {
              type: "v2",
              value: new N()
            },
            viewport: {
              type: "v2",
              value: new N()
            },
            basisViewport: {
              type: "v2",
              value: new N()
            },
            debugColor: {
              type: "v3",
              value: new Le()
            },
            covariancesTextureSize: {
              type: "v2",
              value: new N(1024, 1024)
            },
            centersColorsTextureSize: {
              type: "v2",
              value: new N(1024, 1024)
            },
            orthoZoom: {
              type: "f",
              value: -1
            }
          };
        return new rt({
          uniforms: s,
          vertexShader: r,
          fragmentShader: i,
          transparent: !0,
          alphaTest: 1,
          blending: qa,
          depthTest: !0,
          depthWrite: !1,
          side: qi
        });
      }
    }, {
      key: "buildGeomtery",
      value: function buildGeomtery(e) {
        var r = new we();
        r.setIndex([0, 1, 2, 0, 2, 3]);
        var i = new Float32Array(4 * 3),
          s = new Ge(i, 3);
        r.setAttribute("position", s), s.setXYZ(0, -1, -1, 0), s.setXYZ(1, -1, 1, 0), s.setXYZ(2, 1, 1, 0), s.setXYZ(3, 1, -1, 0), s.needsUpdate = !0;
        var o = new Sp().copy(r),
          a = new Uint32Array(e),
          l = new uo(a, 1, !1);
        return l.setUsage(MM), o.setAttribute("splatIndex", l), o.instanceCount = e, o;
      }
    }]);
    return Xl;
  }(rr);
var Um = /*#__PURE__*/function () {
  function Um() {
    var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    _classCallCheck(this, Um);
    Di(this, "updateSplatMeshUniforms", function () {
      var t = new N();
      return function () {
        if (this.splatMesh === null) return;
        this.splatMesh.getSplatCount() > 0 && (this.renderer.getSize(t), this.cameraFocalLengthX = this.camera.projectionMatrix.elements[0] * this.devicePixelRatio * t.x * .45, this.cameraFocalLengthY = this.camera.projectionMatrix.elements[5] * this.devicePixelRatio * t.y * .45, this.splatMesh.updateUniforms(t, this.cameraFocalLengthX, this.cameraFocalLengthY, this.camera.isPerspectiveCamera ? -1 : this.camera.zoom * this.devicePixelRatio));
      };
    }());
    Di(this, "updateView", function () {
      var t = new te(),
        e = [],
        r = new _(0, 0, -1),
        i = new _(0, 0, -1),
        s = new _(),
        o = new _();
      return function () {
        var a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        var l = this.updateMatrixWorldsInWorkerIfNeeded(),
          u = this.cropsChanged();
        if (!a) {
          i.set(0, 0, -1).applyQuaternion(this.camera.quaternion);
          var d = !1,
            _h93 = !1;
          if (i.dot(r) <= .95 && (d = !0), o.copy(this.camera.position).sub(s).length() >= 1 && (_h93 = !0), !d && !_h93 && !l && !u) return;
        }
        s.copy(this.camera.position), r.copy(i), t.copy(this.camera.matrixWorld).invert(), t.premultiply(this.camera.perspCamera.projectionMatrix), e[0] = this.camera.position.x, e[1] = this.camera.position.y, e[2] = this.camera.position.z;
        var c = _objectSpread(_objectSpread({
          sort: {
            view: t.elements,
            cameraPosition: e,
            splatRenderCount: this.splatRenderCount,
            splatSortCount: this.splatRenderCount
          }
        }, l ? {
          newMatrixWorlds: this.meshMatrixWorlds
        } : {}), u ? {
          newCropsArray: this.cropsArray
        } : {});
        this.sortRunning ? this.queuedMessage = c : (this.queuedMessage = null, this.sortRunning = !0, this.sortWorker.postMessage(c));
      };
    }());
    this.scene = t.scene, this.currentPage = null, this.renderer = t.renderer, this.devicePixelRatio = window.devicePixelRatio, this.sortWorker = null, this.splatRenderCount = 0, this.splatSortCount = 0, this.splatMesh = null, this.sortRunning = !1, this.splatRenderingInitialized = !1, this.meshMatrixWorlds = null, this.meshMatrixWorldsOld = null, this.cropsArray = null, this.splatEntries = null, this.queuedMessage = null;
  }
  _createClass(Um, [{
    key: "camera",
    get: function get() {
      return this.scene.activeCamera;
    }
  }, {
    key: "reloadSplats",
    value: function reloadSplats() {
      this.splatRenderingInitialized = !1;
      var t = this.loadSplat();
      this.renderer.pipeline.opaquePass.splatViewer = t ? this : null;
    }
  }, {
    key: "loadSplat",
    value: function loadSplat() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      this.activePage = this.scene.activePage, t.position && (t.position = new _().fromArray(t.position)), t.orientation && (t.orientation = new je().fromArray(t.orientation)), t.halfPrecisionCovariances = !!t.halfPrecisionCovariances;
      var e = [];
      if (this.splatEntries = e, this.activePage.traverseEntity(function (o) {
        if (o.data.type === "Splat") {
          var a = o.visible;
          o.traverseAncestors(function (l) {
            a && (a = l.visible);
          }), a && e.push(o);
        }
      }), this.splatMesh && this.splatMesh.dispose(), e.length === 0) return this.splatMesh = null, !1;
      this.meshMatrixWorlds = e.map(function (o) {
        return o.matrixWorld;
      }), this.meshMatrixWorldsOld = e.map(function (o) {
        return o.matrixWorld.clone();
      }), this.cropsArray = e.map(function (o) {
        return o.data.crops.map(function (a) {
          return a.data;
        });
      });
      var r = e.map(function (o) {
          return new Yl(new Uint8Array(o.data.buffer).buffer);
        }),
        i = 0,
        s = [0];
      var _iterator121 = _createForOfIteratorHelper(r),
        _step121;
      try {
        for (_iterator121.s(); !(_step121 = _iterator121.n()).done;) {
          var o = _step121.value;
          i += o.getSplatCount(), s.push(i);
        }
      } catch (err) {
        _iterator121.e(err);
      } finally {
        _iterator121.f();
      }
      return this.setupSplatMesh(r, i, t.position, t.orientation, t.halfPrecisionCovariances, this.devicePixelRatio, s, this.meshMatrixWorlds), this.setupSortWorker(i), !0;
    }
  }, {
    key: "updateMatrixWorldsInWorkerIfNeeded",
    value: function updateMatrixWorldsInWorkerIfNeeded() {
      var _this311 = this;
      var t = this.splatDataTextures.meshMatrixWorlds.data;
      for (var e = 0; e < this.meshMatrixWorlds.length; e++) t.set(this.meshMatrixWorlds[e].elements, e * 16);
      return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate = !0, this.meshMatrixWorlds.every(function (e, r) {
        return e.equals(_this311.meshMatrixWorldsOld[r]);
      }) ? !1 : (this.meshMatrixWorldsOld = this.meshMatrixWorlds.map(function (e) {
        return e.clone();
      }), !0);
    }
  }, {
    key: "cropsChanged",
    value: function cropsChanged() {
      var _this312 = this;
      var t = !1;
      return this.splatEntries.forEach(function (e, r) {
        var _this312$cropsArray$r2;
        e.data.crops.forEach(function (i, s) {
          _this312.cropsArray[r][s] === void 0 ? (t = !0, _this312.cropsArray[r][s] = i.data) : Object.entries(i.data).forEach(function (_ref68) {
            var _this312$cropsArray$r;
            var _ref69 = _slicedToArray(_ref68, 2),
              o = _ref69[0],
              a = _ref69[1];
            Array.isArray(a) && a.some(function (l, u) {
              return l !== _this312.cropsArray[r][s][o][u];
            }) ? (t = !0, _this312.cropsArray[r][s][o] = a) : a !== ((_this312$cropsArray$r = _this312.cropsArray[r][s]) === null || _this312$cropsArray$r === void 0 ? void 0 : _this312$cropsArray$r[o]) && (t = !0, _this312.cropsArray[r][s][o] = a);
          });
        }), e.data.crops.length !== ((_this312$cropsArray$r2 = _this312.cropsArray[r]) === null || _this312$cropsArray$r2 === void 0 ? void 0 : _this312$cropsArray$r2.length) && (_this312.cropsArray[r].length = e.data.crops.length, t = !0);
      }), t;
    }
  }, {
    key: "setupSplatMesh",
    value: function setupSplatMesh(t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new _();
      var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new je();
      var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
      var o = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;
      var a = arguments.length > 6 ? arguments[6] : undefined;
      var l = arguments.length > 7 ? arguments[7] : undefined;
      this.splatMesh = Xl.buildMesh(t, e, s, o, a, l), this.splatMesh.position.copy(r), this.splatMesh.quaternion.copy(i), this.splatMesh.frustumCulled = !1, this.splatMesh.renderOrder = 10, this.updateSplatMeshUniforms(), this.splatRenderCount = e;
    }
  }, {
    key: "setupSortWorker",
    value: function setupSortWorker(t) {
      var _this313 = this;
      this.sortWorker = IL(t), this.sortWorker.onmessage = function (e) {
        var _this313$splatMesh;
        e.data.sortDone ? (_this313.sortRunning = !1, (_this313$splatMesh = _this313.splatMesh) !== null && _this313$splatMesh !== void 0 && _this313$splatMesh.updateIndexes(new Uint32Array(e.data.indexesBuffer)), _this313.lastSortTime = e.data.sortTime, _this313.queuedMessage && (_this313.sortWorker.postMessage(_this313.queuedMessage), _this313.queuedMessage = null)) : e.data.sortCanceled ? _this313.sortRunning = !1 : e.data.sortSetupPhase1Complete ? _this313.sortWorker.postMessage({
          positions: _this313.splatMesh.getCenters().buffer,
          meshMatrixWorlds: _this313.splatMesh.meshMatrixWorlds,
          meshIndexIntervals: _this313.splatMesh.meshIndexIntervals,
          cropsArray: _this313.cropsArray
        }) : e.data.sortSetupComplete && (_this313.splatDataTextures = _this313.splatMesh.getSplatDataTextures(), _this313.updateView(!0, !0), _this313.splatRenderingInitialized = !0);
      };
    }
  }, {
    key: "update",
    value: function update() {
      this.splatRenderingInitialized !== !1 && (this.updateSplatMeshUniforms(), this.updateView());
    }
  }, {
    key: "getSplatMesh",
    value: function getSplatMesh() {
      return this.splatMesh;
    }
  }]);
  return Um;
}();
var Ax = new Ls();
Ax.wireframe = !0;
var LL = new _(),
  Vl = /*#__PURE__*/function (_vi) {
    _inherits(Vl, _vi);
    var _super295 = _createSuper(Vl);
    function Vl(e, r) {
      var _this314;
      _classCallCheck(this, Vl);
      _this314 = _super295.call(this);
      _this314.data = e;
      _this314.sharedAssets = r;
      _this314.enableHelpers = !1;
      _this314.wireframeState = !1;
      _this314.needsTransmissionDirty = !0;
      _this314.needsNormalDirty = !0;
      _this314._needsTransmission = !1;
      _this314._needsNormal = !1;
      _this314.geometryCacheChanged = !1;
      _this314.splatViewer = null;
      _this314.entityByUuid = {};
      _this314.entityIdentityToEntity = {};
      _this314.toExpandCloner = new Set();
      _this314.toUpdateCloner = new Set();
      _this314.pendingCommands = [];
      _this314.pathConstraints = new Vx();
      _this314.invisibleObjects = new Ss("jflkdsafjasdifjaslk", _objectSpread(_objectSpread({}, Wv.defaultData), {}, {
        visible: !1,
        name: "buildin invisible"
      }));
      _this314.needsRecomputeInstances = !1;
      _this314.init(e, r), _this314.matrixAutoUpdate = !1, _this314.errorPage = new sr("fdasfa", _objectSpread(_objectSpread({}, ma.defaultData), {}, {
        name: ""
      }), {
        shared: r,
        scene: _assertThisInitialized(_this314)
      });
      return _this314;
    }
    _createClass(Vl, [{
      key: "markGeometryCacheDirty",
      value: function markGeometryCacheDirty() {
        this.geometryCacheChanged = !0;
      }
    }, {
      key: "markNeedsUpdateRendererDirty",
      value: function markNeedsUpdateRendererDirty() {
        this.needsTransmissionDirty = !0, this.needsNormalDirty = !0;
      }
    }, {
      key: "needsTransmission",
      value: function needsTransmission() {
        return this.needsTransmissionDirty && (this._needsTransmission = tL(this), this.needsTransmissionDirty = !1), this._needsTransmission;
      }
    }, {
      key: "needsNormal",
      value: function needsNormal() {
        return this.needsNormalDirty && (this._needsNormal = eL(this), this.needsNormalDirty = !1), this._needsNormal;
      }
    }, {
      key: "registerInstanceAndSetUuid",
      value: function registerInstanceAndSetUuid(e) {
        var r = e.identity.join("-"),
          i = this.entityIdentityToEntity[r];
        i && (e.uuid = i.uuid), this.entityIdentityToEntity[r] = e, this.entityByUuid[e.uuid] = e;
      }
    }, {
      key: "markPenumbraSizeDirty",
      value: function markPenumbraSizeDirty() {
        var _iterator122 = _createForOfIteratorHelper(this.children),
          _step122;
        try {
          for (_iterator122.s(); !(_step122 = _iterator122.n()).done;) {
            var e = _step122.value;
            e instanceof sr && (e.penumbraSizeArrayCache = null);
          }
        } catch (err) {
          _iterator122.e(err);
        } finally {
          _iterator122.f();
        }
      }
    }, {
      key: "findInstance",
      value: function findInstance(e) {
        return this.entityIdentityToEntity[e.join("-")];
      }
    }, {
      key: "bgColor",
      get: function get() {
        return this.activePage.bgColor;
      }
    }, {
      key: "postprocessing",
      get: function get() {
        return this.activePage.data.postprocessing;
      }
    }, {
      key: "getWithSortKey",
      value: function getWithSortKey(e) {
        var r = this.find(e);
        if (r === void 0) return;
        var i = [],
          s = r;
        for (; s !== this;) {
          var o = s;
          s = s.parent;
          var a = s.children.indexOf(o);
          i.splice(0, 0, a);
        }
        return {
          entity: r,
          sortKey: i
        };
      }
    }, {
      key: "getAllSorted",
      value: function getAllSorted(e) {
        var r = [];
        var _iterator123 = _createForOfIteratorHelper(e),
          _step123;
        try {
          for (_iterator123.s(); !(_step123 = _iterator123.n()).done;) {
            var _i164 = _step123.value;
            var _s100 = this.getWithSortKey(_i164.id);
            _s100 !== void 0 && r.push(_s100);
          }
        } catch (err) {
          _iterator123.e(err);
        } finally {
          _iterator123.f();
        }
        return r.sort(function (i, s) {
          return nv(i.sortKey, s.sortKey);
        }), r.map(function (i) {
          return i.entity;
        });
      }
    }, {
      key: "nonExistOrDescendantOf",
      value: function nonExistOrDescendantOf(e, r) {
        var i = this.find(e);
        if (i === void 0) return !0;
        for (; i;) {
          if (i.uuid === r) return !0;
          i = i.parent;
        }
        return !1;
      }
    }, {
      key: "find",
      value: function find(e) {
        if (this.activePage && this.activePage.personalCamera.parent) {
          if (e === "f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera") return this.activePage.personalCamera;
          if (e === us) return this.activePage.personalCamera;
        }
        if (e === "" || e === void 0) return;
        var r = this.entityByUuid[e];
        return r === void 0 ? this.getObjectByProperty("uuid", e) : r;
      }
    }, {
      key: "find2D",
      value: function find2D(e) {
        var _iterator124 = _createForOfIteratorHelper(this.children),
          _step124;
        try {
          for (_iterator124.s(); !(_step124 = _iterator124.n()).done;) {
            var r = _step124.value;
            if (r instanceof sr && r.uiScene) {
              var _i165 = r.uiScene.find(e);
              if (_i165) return _i165;
            }
          }
        } catch (err) {
          _iterator124.e(err);
        } finally {
          _iterator124.f();
        }
      }
    }, {
      key: "findScene2DfromObject2D",
      value: function findScene2DfromObject2D(e) {
        var _iterator125 = _createForOfIteratorHelper(this.children),
          _step125;
        try {
          for (_iterator125.s(); !(_step125 = _iterator125.n()).done;) {
            var r = _step125.value;
            if (r instanceof sr && r.uiScene && r.uiScene.find(e)) return r.uiScene;
          }
        } catch (err) {
          _iterator125.e(err);
        } finally {
          _iterator125.f();
        }
      }
    }, {
      key: "find2DInUIObjects",
      value: function find2DInUIObjects(e) {
        var r;
        return this.traverseEntity(function (i) {
          r === void 0 && i instanceof fr && (r = i.uiCanvas.find(e));
        }), r;
      }
    }, {
      key: "traverse2D",
      value: function traverse2D(e) {
        var _iterator126 = _createForOfIteratorHelper(this.children),
          _step126;
        try {
          for (_iterator126.s(); !(_step126 = _iterator126.n()).done;) {
            var r = _step126.value;
            r instanceof sr && r.uiScene && r.uiScene.traverse(e);
          }
        } catch (err) {
          _iterator126.e(err);
        } finally {
          _iterator126.f();
        }
      }
    }, {
      key: "debugEnsureEntity",
      value: function debugEnsureEntity(e) {
        var r = this.find(e);
        if (r) {
          if (Array.isArray(r.identity) && this.findInstance(r.identity) === void 0) {
            console.error("not found instance");
            debugger;
          }
        } else {
          console.error("not found");
          debugger;
        }
      }
    }, {
      key: "addPendingExpandCloner",
      value: function addPendingExpandCloner(e) {
        this.toExpandCloner.add(e);
      }
    }, {
      key: "addPendingUpdateCloner",
      value: function addPendingUpdateCloner(e) {
        this.toUpdateCloner.add(e);
      }
    }, {
      key: "markToExpandCloner",
      value: function markToExpandCloner(e) {
        var _this315 = this;
        this.toExpandCloner.add(e), e.traverseEntityAncestors(function (r) {
          _this315.toExpandCloner.add(r);
        });
      }
    }, {
      key: "doPendingExpandCloner",
      value: function doPendingExpandCloner() {
        var _this316 = this;
        this.toExpandCloner.forEach(function (e) {
          e.expandCloner(_this316);
        }), this.toExpandCloner.clear();
      }
    }, {
      key: "doPendingUpdateCloner",
      value: function doPendingUpdateCloner() {
        this.toUpdateCloner.forEach(function (e) {
          var _e$cloner;
          (_e$cloner = e.cloner) === null || _e$cloner === void 0 || _e$cloner.update();
        }), this.toUpdateCloner.clear();
      }
    }, {
      key: "doPendingUpdates",
      value: function doPendingUpdates() {
        this.doPendingExpandCloner(), this.doPendingUpdateCloner(), this.applyPendingCommands();
      }
    }, {
      key: "addPendingCommand",
      value: function addPendingCommand(e) {
        this.pendingCommands.push(e);
      }
    }, {
      key: "applyPendingCommands",
      value: function applyPendingCommands() {
        this.pendingCommands.forEach(function (e) {
          return e();
        }), this.pendingCommands.length = 0;
      }
    }, {
      key: "updateByLibOp",
      value: function updateByLibOp(e, r) {
        e.path.length === 1 && e.path[0] === "components" && e.type === 1 && this.createChildrenObjects([_objectSpread(_objectSpread({}, e.data.asset), {}, {
          id: e.id
        })], this.invisibleObjects, r);
      }
    }, {
      key: "updateTreeByOp",
      value: function updateTreeByOp(e, r) {
        if (e.path.length === 0 && e.type === 7) {
          var _i166 = e.parent === null ? this : this.find(e.parent);
          if (_i166 === void 0) throw new Error("unexpected");
          var _s101 = this.createObject(e.id, e.data, e.children, _i166, e.localIndex, r);
          _s101.updateVisible(this), _s101.resetBBoxNeedsUpdate(), sn(_s101) && An(_s101.parent) && (_s101.invalidateUpstreamBooleanData(), _s101.parent.invalidateDownstreamBooleanData().recomputeBoolean()), this.markNeedsRecomputeInstancesForAncessors(_i166), this.markNeedsRecomputeInstancesForChildren(_s101), this.markToExpandCloner(_s101), this.markPenumbraSizeDirty(), _s101.updatePathSnapping();
        } else if (e.path.length === 0 && e.type === 8) {
          var _i167 = this.find(e.id);
          if (_i167 === void 0) throw new Error("unexpected");
          this.markToExpandCloner(_i167), _i167.resetBBoxNeedsUpdate(), this.unregisterObject(_i167);
          var _s102 = _i167.parent;
          this.markNeedsRecomputeInstancesForAncessors(_s102), this.markNeedsRecomputeInstancesForChildren(_i167), this.markPenumbraSizeDirty(), _i167.parent.remove(_i167), An(_i167.parent) && (_i167.parent.invalidateUpstreamBooleanData(), _i167.parent.invalidateDownstreamBooleanData().recomputeBoolean()), sn(_i167) && (_i167.freeBooleanPointer(), _s102 instanceof Ln && _s102.invalidateDownstreamBooleanData().recomputeBoolean()), _i167 instanceof Hl && _i167.detachShape(), this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(_i167), this.pathConstraints.removeDependencies(_i167.uuid), _i167.updatePathSnapping();
        } else if (e.path.length === 0 && e.type === 9) {
          var _i168$cloner;
          var _i168 = this.find(e.id);
          if (_i168 === void 0) throw new Error("unexpected");
          this.markNeedsRecomputeInstancesForChildren(_i168);
          var _s103 = _i168.parent;
          this.markNeedsRecomputeInstancesForAncessors(_s103), (_i168$cloner = _i168.cloner) !== null && _i168$cloner !== void 0 && _i168$cloner.resetOnMove(), this.markToExpandCloner(_i168);
          var o = e.parent === null ? this : this.find(e.parent);
          if (o === void 0) throw new Error("unexpected");
          o.add(_i168), this.markNeedsRecomputeInstancesForAncessors(o), this.markToExpandCloner(_i168), _i168.invalidateClonerTransform(_i168), _i168.updateVisible(this), _i168.resetBBoxNeedsUpdate(), this.markPenumbraSizeDirty();
          var a = e.localIndex;
          o.children.splice(a, 0, o.children.pop()), sn(_i168) && (_i168.invalidateUpstreamBooleanData(), An(_i168.parent) ? _i168.parent.invalidateDownstreamBooleanData().recomputeBoolean() : _s103 instanceof Ln && _s103.invalidateDownstreamBooleanData().recomputeBoolean()), _i168.updatePathSnapping();
        }
        this.markNeedsUpdateRendererDirty(), this.markGeometryCacheDirty();
      }
    }, {
      key: "playPage",
      get: function get() {
        var _this$find;
        return (_this$find = this.find(this.data.publish.playPage)) !== null && _this$find !== void 0 ? _this$find : this.errorPage;
      }
    }, {
      key: "updatePage",
      value: function updatePage(e) {
        var _this$splatViewer;
        this.activePage && this.activePage.onDeactive(), this.activePage = this.errorPage;
        var _iterator127 = _createForOfIteratorHelper(this.children),
          _step127;
        try {
          for (_iterator127.s(); !(_step127 = _iterator127.n()).done;) {
            var r = _step127.value;
            r instanceof sr && (r.visible = r.uuid === e, r.visible && (this.activePage = r, this.activePage.onActive(this)));
          }
        } catch (err) {
          _iterator127.e(err);
        } finally {
          _iterator127.f();
        }
        this.activePage !== ((_this$splatViewer = this.splatViewer) === null || _this$splatViewer === void 0 ? void 0 : _this$splatViewer.activePage) && this.reloadSplats();
      }
    }, {
      key: "updateEntityByOp",
      value: function updateEntityByOp(e, r, i, s) {
        if (r.type === 0) {
          if (("overrides" in r.props || "component" in r.props) && this.markNeedsRecomputeInstances(), "visible" in r.props && this.markPenumbraSizeDirty(), r.path.includes("overrides") && "states" in r.props) {
            var a = r.props.rest;
            r = _objectSpread(_objectSpread({}, r), {}, {
              props: a
            }), this.markNeedsRecomputeInstances();
          }
          r.path[0] === "pathSnapping" && r.props.pathId !== void 0 && this.pathConstraints.setConstraint(e, r.props.pathId);
        }
        var o = this.find(e);
        if (o) try {
          Z3(o, r, i, {
            scene: this,
            shared: s
          }), o instanceof er && o.updateGeometryGroupsIfNeeded();
        } catch (a) {
          console.error(a);
        }
      }
    }, {
      key: "updateEntity2DByOp",
      value: function updateEntity2DByOp(e, r, i, s, o) {
        var a = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : [];
        e.updateEntityByOp(r, i, s, o), this.traverseEntity(function (l) {
          var _l$frameId;
          (l instanceof fr || l instanceof sr) && (a.includes((_l$frameId = l.frameId) !== null && _l$frameId !== void 0 ? _l$frameId : "") || l.frameId === r) && l.updateEntity2DByOp(r, i, s, o);
        });
      }
    }, {
      key: "activeCamera",
      get: function get() {
        return this.activePage.activeCamera;
      }
    }, {
      key: "switchActiveCamera",
      value: function switchActiveCamera(e) {
        this.activePage.switchActiveCamera(e);
      }
    }, {
      key: "isInvisibleObjects",
      value: function isInvisibleObjects(e) {
        return e === this.invisibleObjects || e.hasAnccestor(this.invisibleObjects);
      }
    }, {
      key: "init",
      value: function init(e, r) {
        var i = Object.entries(r.data.lib.components).map(function (s, o) {
          return {
            data: s[1].asset.data,
            children: s[1].asset.children,
            id: s[0],
            fi: o
          };
        });
        this.invisibleObjects.updateState(this.invisibleObjects.data, {
          scene: this,
          shared: r
        }), this.add(this.invisibleObjects), this.createChildrenObjects(i, this.invisibleObjects, r), this.createChildrenObjects(e.objects, this, r), this.updatePage(e.publish.playPage), this.activePage.switchToPlayCamera(), this.expandInstances(r, !0), this.traverseEntity(function (s) {
          s instanceof hr && s.updateUp();
        }), this.doPendingExpandCloner(), this.applyPendingCommands();
      }
    }, {
      key: "markNeedsRecomputeInstances",
      value: function markNeedsRecomputeInstances() {
        this.needsRecomputeInstances = !0;
      }
    }, {
      key: "markNeedsRecomputeInstancesForChildren",
      value: function markNeedsRecomputeInstancesForChildren(e) {
        var _this317 = this;
        e.traverseEntity(function (r) {
          (r.data.type === "Component" || r.data.type === "Instance") && _this317.markNeedsRecomputeInstances();
        });
      }
    }, {
      key: "markNeedsRecomputeInstancesForAncessors",
      value: function markNeedsRecomputeInstancesForAncessors(e) {
        var _this318 = this;
        ut.is(e) && (e.data.type === "Component" && this.markNeedsRecomputeInstances(), e.traverseAncestors(function (r) {
          ut.is(r) && r.data.type === "Component" && _this318.markNeedsRecomputeInstances();
        }));
      }
    }, {
      key: "relativeizeInner",
      value: function relativeizeInner(e, r, i, s, o, a, l) {
        var _this319 = this;
        if (e) {
          var u = s.find(e);
          u && u !== s && o.forInstancesRec(function (c) {
            c.data = fl(c.data, function (d) {
              var h = d.events.data(l.id),
                f = c.goUp(a);
              if (f) {
                var p = [].concat(_toConsumableArray(iv(f.identity)), [e]).join("-"),
                  m = _this319.entityIdentityToEntity[p];
                if (m) {
                  var g = m.uuid,
                    y = Tr.zoom(h, r);
                  y[i] = g;
                } else {
                  if (!1) debugger;
                  console.warn("cannot find instance");
                }
              }
            }).data;
          });
        }
      }
    }, {
      key: "rewriteActions",
      value: function rewriteActions(e, r, i, s, o, a) {
        var _this320 = this;
        e.forEach(function (l) {
          l.data.type === "Transition" ? _this320.relativeizeInner(l.data.object, [].concat(_toConsumableArray(r), [l.id]), "object", i, s, o, a) : l.data.type === "Animation" && _this320.relativeizeInner(l.data.object, [].concat(_toConsumableArray(r), [l.id]), "object", i, s, o, a);
        });
      }
    }, {
      key: "rewriteEventsBeforeGoToPlayMode",
      value: function rewriteEventsBeforeGoToPlayMode() {
        var _this321 = this;
        this.traverseEntity(function (e) {
          if (e instanceof Js && typeof e.identity == "string" && e.data.type === "Component") return e.traverseEntity(function (r, i) {
            r.data.events.forEach(function (s) {
              if (s.data.type === "GameControl") {
                var o = !1;
                if (r.forInstancesRec(function (a) {
                  a.data = fl(a.data, function (l) {
                    a.isInstanceRoot || (l.events.delete(s.id), o = !0);
                  }).data;
                }), o === !1) {
                  var _iterator128 = _createForOfIteratorHelper(Xd.list),
                    _step128;
                  try {
                    for (_iterator128.s(); !(_step128 = _iterator128.n()).done;) {
                      var a = _step128.value;
                      _this321.rewriteActions(s.data.gameActions[a], ["gameActions", a], e, r, i, s);
                    }
                  } catch (err) {
                    _iterator128.e(err);
                  } finally {
                    _iterator128.f();
                  }
                }
              } else s.data.type === "Conditional" ? (s.data.condition.type === "Distance" ? (_this321.relativeizeInner(s.data.condition.fromObject, ["condition"], "fromObject", e, r, i, s), _this321.relativeizeInner(s.data.condition.toObject, ["condition"], "toObject", e, r, i, s)) : s.data.condition.type === "State" ? _this321.relativeizeInner(s.data.condition.object, ["condition"], "object", e, r, i, s) : s.data.condition.type === "Comparison" && (s.data.condition.lOperand.type === "Property" && _this321.relativeizeInner(s.data.condition.lOperand.value[0], ["condition", "lOperand", "value"], 0, e, r, i, s), s.data.condition.rOperand.type === "Property" && _this321.relativeizeInner(s.data.condition.rOperand.value[0], ["condition", "rOperand", "value"], 0, e, r, i, s)), _this321.rewriteActions(s.data.inActions, ["inActions"], e, r, i, s), _this321.rewriteActions(s.data.outActions, ["outActions"], e, r, i, s)) : "actions" in s.data && _this321.rewriteActions(s.data.actions, ["actions"], e, r, i, s);
            });
          }), !0;
        });
      }
    }, {
      key: "expandInstances",
      value: function expandInstances(e, r, i) {
        var _this322 = this;
        var s = new Set();
        this.traverseEntity(function (o) {
          if (o instanceof Js && o.isInstanceRoot) return o.expandInstanceChildren({
            scene: _this322,
            shared: e,
            pendingDeletes: s
          }), r || o.resetBBoxNeedsUpdate(), i && o.traverseEntity(function (a) {
            i.addClip(a);
          }), !0;
        });
        var _iterator129 = _createForOfIteratorHelper(s),
          _step129;
        try {
          for (_iterator129.s(); !(_step129 = _iterator129.n()).done;) {
            var o = _step129.value;
            this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(o), Ix(o);
          }
        } catch (err) {
          _iterator129.e(err);
        } finally {
          _iterator129.f();
        }
      }
    }, {
      key: "recomputeInstances",
      value: function recomputeInstances(e, r) {
        this.needsRecomputeInstances && (this.needsRecomputeInstances = !1, this.traverseEntity(function (i) {
          i instanceof Js && i.isInstanceRoot && (i.component = void 0);
        }), this.expandInstances(e, !1, r));
      }
    }, {
      key: "disposeAndUnregisterEntityRecursivelyIfNotReregistered",
      value: function disposeAndUnregisterEntityRecursivelyIfNotReregistered(e) {
        var _this323 = this;
        e.traverseEntity(function (r) {
          var i = typeof r.identity == "string" ? r.identity : r.identity.join("-");
          _this323.entityIdentityToEntity[i] === r && (delete _this323.entityByUuid[r.uuid], delete _this323.entityIdentityToEntity[i]), r.dispose();
        });
      }
    }, {
      key: "clearScene",
      value: function clearScene() {
        var _iterator130 = _createForOfIteratorHelper(this.children),
          _step130;
        try {
          for (_iterator130.s(); !(_step130 = _iterator130.n()).done;) {
            var e = _step130.value;
            ut.is(e) && e.disposeRecursively();
          }
        } catch (err) {
          _iterator130.e(err);
        } finally {
          _iterator130.f();
        }
        this.children.length = 0;
      }
    }, {
      key: "resetAfterClear",
      value: function resetAfterClear(e, r) {
        this.init(e, r);
      }
    }, {
      key: "raycast",
      value: function raycast(e) {
        return this.raycast1(e, !1);
      }
    }, {
      key: "raycast1",
      value: function raycast1(e, r) {
        var _this324 = this;
        var i = [],
          s = function s(o) {
            var _iterator131 = _createForOfIteratorHelper(o.children),
              _step131;
            try {
              for (_iterator131.s(); !(_step131 = _iterator131.n()).done;) {
                var a = _step131.value;
                var l = a.cloner;
                if (ut.is(a) && !a.raycastLock && (a.visible || l !== null && l !== void 0 && l.object.data.visible)) if (r === !0 && a.isInstanceRoot) {
                  var u = [];
                  if (e.intersectObject(a, !0, u), u.length) {
                    var c = u[0];
                    c.object = a, c.point.applyMatrix4(c.object.matrixWorld);
                    var d = a.matrixWorld.clone().invert();
                    c.point.applyMatrix4(d), i.push(c);
                  }
                } else (sn(a) || Om(a) && _this324.enableHelpers && a.objectHelper.visible) && (e.intersectObject(a, !1, i), Vm(a, e, i)), s(a);
              }
            } catch (err) {
              _iterator131.e(err);
            } finally {
              _iterator131.f();
            }
          };
        return s(this.activePage), i;
      }
    }, {
      key: "raycastWithClones",
      value: function raycastWithClones(e) {
        var _this325 = this;
        var r = [],
          i = function i(s) {
            var _iterator132 = _createForOfIteratorHelper(s.children),
              _step132;
            try {
              for (_iterator132.s(); !(_step132 = _iterator132.n()).done;) {
                var o = _step132.value;
                var a = o.cloner;
                ut.is(o) && (o.visible || (a === null || a === void 0 ? void 0 : a.object.data.visible)) && ((sn(o) || Om(o) && _this325.enableHelpers && o.objectHelper.visible) && (e.intersectObject(o, !1, r), Vm(o, e, r, !0)), i(o));
              }
            } catch (err) {
              _iterator132.e(err);
            } finally {
              _iterator132.f();
            }
          };
        return i(this), r;
      }
    }, {
      key: "forEachEntity",
      value: function forEachEntity(e) {
        var _iterator133 = _createForOfIteratorHelper(this.children),
          _step133;
        try {
          for (_iterator133.s(); !(_step133 = _iterator133.n()).done;) {
            var r = _step133.value;
            ut.is(r) && e(r);
          }
        } catch (err) {
          _iterator133.e(err);
        } finally {
          _iterator133.f();
        }
      }
    }, {
      key: "traverseConcreteEntity",
      value: function traverseConcreteEntity(e) {
        var _iterator134 = _createForOfIteratorHelper(this.children),
          _step134;
        try {
          for (_iterator134.s(); !(_step134 = _iterator134.n()).done;) {
            var r = _step134.value;
            ut.is(r) && r.isConcreteEntity && r.traverseEntity(e);
          }
        } catch (err) {
          _iterator134.e(err);
        } finally {
          _iterator134.f();
        }
      }
    }, {
      key: "traverseEntity",
      value: function traverseEntity(e) {
        var _iterator135 = _createForOfIteratorHelper(this.children),
          _step135;
        try {
          for (_iterator135.s(); !(_step135 = _iterator135.n()).done;) {
            var r = _step135.value;
            ut.is(r) && r.traverseEntity(e);
          }
        } catch (err) {
          _iterator135.e(err);
        } finally {
          _iterator135.f();
        }
      }
    }, {
      key: "updateFont",
      value: function updateFont(e, r) {
        this.traverseEntity(function (i) {
          if (i instanceof er && i.data.type === "Mesh" && i.data.geometry.type === "TextGeometry" && i.data.geometry.font === e) {
            var _s104 = i.geometry,
              o = i.data.geometry;
            _s104.updateFont(e, r).then(function () {
              _s104.update(o);
              var a = i.invalidateDownstreamBooleanData();
              An(a) && a.recomputeBoolean();
            });
          }
        });
      }
    }, {
      key: "traverseObject",
      value: function traverseObject(e) {
        var _iterator136 = _createForOfIteratorHelper(this.children),
          _step136;
        try {
          for (_iterator136.s(); !(_step136 = _iterator136.n()).done;) {
            var r = _step136.value;
            dh.is(r) && r.traverseObject(e);
          }
        } catch (err) {
          _iterator136.e(err);
        } finally {
          _iterator136.f();
        }
      }
    }, {
      key: "traverseVisibleEntity",
      value: function traverseVisibleEntity(e) {
        var _iterator137 = _createForOfIteratorHelper(this.children),
          _step137;
        try {
          for (_iterator137.s(); !(_step137 = _iterator137.n()).done;) {
            var r = _step137.value;
            ut.is(r) && r.visible && r.traverseVisibleEntity(e);
          }
        } catch (err) {
          _iterator137.e(err);
        } finally {
          _iterator137.f();
        }
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.clearScene();
      }
    }, {
      key: "createChildrenObjects",
      value: function createChildrenObjects(e, r, i) {
        var s = 0;
        var _iterator138 = _createForOfIteratorHelper(e),
          _step138;
        try {
          for (_iterator138.s(); !(_step138 = _iterator138.n()).done;) {
            var o = _step138.value;
            this.createObject(o.id, o.data, o.children, r, s, i), s += 1;
          }
        } catch (err) {
          _iterator138.e(err);
        } finally {
          _iterator138.f();
        }
      }
    }, {
      key: "registerObjectCreatedInLegacy",
      value: function registerObjectCreatedInLegacy(e) {
        this.entityByUuid[e.uuid] = e;
      }
    }, {
      key: "unregisterObject",
      value: function unregisterObject(e) {
        delete this.entityByUuid[e.uuid];
        var _iterator139 = _createForOfIteratorHelper(e.children),
          _step139;
        try {
          for (_iterator139.s(); !(_step139 = _iterator139.n()).done;) {
            var r = _step139.value;
            this.unregisterObject(r);
          }
        } catch (err) {
          _iterator139.e(err);
        } finally {
          _iterator139.f();
        }
      }
    }, {
      key: "createObject",
      value: function createObject(e, r, i, s, o, a) {
        var _r$pathSnapping,
          _this326 = this;
        var l = {
            scene: this,
            shared: a
          },
          u = zx(e, r, l);
        return u && (this.entityByUuid[e] = u, s.add(u), s.children.splice(o, 0, s.children.pop()), i.length > 0 && (u.isInstanceRoot ? console.error("instance should not have children!") : this.createChildrenObjects(i, u, a)), u.updateState(r, l), u instanceof er && u.updateGeometryGroupsIfNeeded(), u.updateVisible(this), u.cloner && this.toExpandCloner.add(u), (_r$pathSnapping = r.pathSnapping) !== null && _r$pathSnapping !== void 0 && _r$pathSnapping.pathId && this.pathConstraints.setConstraint(e, r.pathSnapping.pathId)), r.type === "Empty" && r.animations && u.traverseEntity(function (c) {
          var d = c.dataPatched;
          if (c instanceof er && d.bones && d.boneInverses) {
            var _h94 = d.bones.map(function (m) {
                return _this326.find(m);
              }),
              f = d.boneInverses.map(function (m) {
                return new te().fromArray(m);
              }),
              p = new Za(_h94, f);
            c.bind(p, c.bindMatrix);
          } else c.matrixAutoUpdate = !0;
        }), u;
      }
    }, {
      key: "getCenter",
      value: function getCenter(e) {
        var r = [];
        for (var _s105 = 0, o = e.length; _s105 < o; ++_s105) {
          var _e$_s = e[_s105],
            a = _e$_s.id,
            l = _e$_s.recursive,
            u = this.find(a),
            c = l ? u.recursiveBBox : u.singleBBox;
          r.push.apply(r, _toConsumableArray(c.vertices));
        }
        var i = new Bt();
        return i.setFromPoints(r), i.getCenter(LL), LL;
      }
    }, {
      key: "copyMatrixWorld",
      value: function copyMatrixWorld(e, r) {
        if (e === null) {
          r.identity();
          return;
        }
        var i = this.find(e);
        i ? r.copy(i.matrixWorld) : r.identity();
      }
    }, {
      key: "copyParentMatrixWorld",
      value: function copyParentMatrixWorld(e, r) {
        var _this$find2;
        if (e === null) {
          r.identity();
          return;
        }
        var i = (_this$find2 = this.find(e)) === null || _this$find2 === void 0 ? void 0 : _this$find2.parent;
        i ? r.copy(i.matrixWorld) : r.identity();
      }
    }, {
      key: "traverseMaterial",
      value: function traverseMaterial(e) {
        this.traverseEntity(function (r) {
          if (r instanceof nr) if (Array.isArray(r.material)) for (var _i169 = 0; _i169 < r.material.length; _i169++) r.material[_i169] instanceof Rn && e(r.material[_i169]);else r.material instanceof Rn && e(r.material);
        });
      }
    }, {
      key: "updateViewPlaneSize",
      value: function updateViewPlaneSize(e, r) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        this.traverseConcreteEntity(function (s) {
          s instanceof hr && s.setViewplaneSize(e, r, i);
        });
      }
    }, {
      key: "initializeSplatViewer",
      value: function initializeSplatViewer(e) {
        this.splatViewer = new Um({
          scene: this,
          renderer: e
        }), this.reloadSplats();
      }
    }, {
      key: "reloadSplats",
      value: function reloadSplats() {
        var _this$splatViewer2;
        (_this$splatViewer2 = this.splatViewer) === null || _this$splatViewer2 === void 0 || _this$splatViewer2.reloadSplats();
      }
    }]);
    return Vl;
  }(vi);
var Gm = function Gm(n, t) {
    var e = t.x - n.x,
      r = t.y - n.y;
    return Math.sqrt(e * e + r * r);
  },
  BL = function BL(n, t) {
    var e = t.x - n.x,
      r = t.y - n.y;
    return fK(Math.atan2(r, e));
  },
  NL = function NL(n, t, e) {
    var r = {
      x: 0,
      y: 0
    };
    return e = Wx(e), r.x = n.x - t * Math.cos(e), r.y = n.y - t * Math.sin(e), r;
  },
  Wx = function Wx(n) {
    return n * (Math.PI / 180);
  },
  fK = function fK(n) {
    return n * (180 / Math.PI);
  },
  FL = function FL(n) {
    return isNaN(n.buttons) ? n.pressure !== 0 : n.buttons !== 0;
  },
  V_ = new Map(),
  U_ = function U_(n) {
    V_.has(n) && clearTimeout(V_.get(n)), V_.set(n, setTimeout(n, 100));
  },
  Cf = function Cf(n, t, e) {
    var r = t.split(/[ ,]+/g),
      i;
    for (var _s106 = 0; _s106 < r.length; _s106 += 1) i = r[_s106], n.addEventListener ? n.addEventListener(i, e, !1) : n.attachEvent && n.attachEvent(i, e);
  },
  G_ = function G_(n, t, e) {
    var r = t.split(/[ ,]+/g),
      i;
    for (var _s107 = 0; _s107 < r.length; _s107 += 1) i = r[_s107], n.removeEventListener ? n.removeEventListener(i, e) : n.detachEvent && n.detachEvent(i, e);
  };
var qx = function qx(n) {
    return n.preventDefault(), n.type.match(/^touch/) ? n.changedTouches : n;
  },
  j_ = function j_() {
    if ((typeof window === "undefined" ? "undefined" : _typeof(window)) > "u") return;
    var n = window.pageXOffset !== void 0 ? window.pageXOffset : (document.documentElement || document.body.parentNode || document.body).scrollLeft,
      t = window.pageYOffset !== void 0 ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop;
    return {
      x: n,
      y: t
    };
  },
  Yx = function Yx(n, t) {
    t.top || t.right || t.bottom || t.left ? (n.style.top = t.top, n.style.right = t.right, n.style.bottom = t.bottom, n.style.left = t.left) : (n.style.left = t.x + "px", n.style.top = t.y + "px");
  },
  Xx = function Xx(n, t, e) {
    var r = zL(n);
    for (var _i170 in r) if (r.hasOwnProperty(_i170)) if (typeof t == "string") r[_i170] = t + " " + e;else {
      var _s108 = "";
      for (var o = 0, a = t.length; o < a; o += 1) _s108 += t[o] + " " + e + ", ";
      r[_i170] = _s108.slice(0, -2);
    }
    return r;
  },
  kL = function kL(n, t) {
    var e = zL(n);
    for (var r in e) e.hasOwnProperty(r) && (e[r] = t);
    return e;
  },
  zL = function zL(n) {
    var t = {};
    return t[n] = "", ["webkit", "Moz", "o"].forEach(function (r) {
      t[r + n.charAt(0).toUpperCase() + n.slice(1)] = "";
    }), t;
  },
  Qx = function Qx(n, t) {
    for (var e in t) t.hasOwnProperty(e) && (n[e] = t[e]);
    return n;
  },
  VL = function VL(n, t) {
    var e = {};
    for (var r in n) n.hasOwnProperty(r) && t.hasOwnProperty(r) ? e[r] = t[r] : n.hasOwnProperty(r) && (e[r] = n[r]);
    return e;
  },
  jm = function jm(n, t) {
    if (n.length) for (var e = 0, r = n.length; e < r; e += 1) t(n[e]);else t(n);
  },
  UL = function UL(n, t, e) {
    return {
      x: Math.min(Math.max(n.x, t.x - e), t.x + e),
      y: Math.min(Math.max(n.y, t.y - e), t.y + e)
    };
  };
(typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && (GL = "ontouchstart" in window, jL = !!window.PointerEvent, HL = !!window.MSPointerEvent);
var GL,
  jL,
  HL,
  Hm = {
    touch: {
      start: "touchstart",
      move: "touchmove",
      end: "touchend, touchcancel"
    },
    mouse: {
      start: "mousedown",
      move: "mousemove",
      end: "mouseup"
    },
    pointer: {
      start: "pointerdown",
      move: "pointermove",
      end: "pointerup, pointercancel"
    },
    MSPointer: {
      start: "MSPointerDown",
      move: "MSPointerMove",
      end: "MSPointerUp"
    }
  },
  Pf,
  Wm = {};
jL ? Pf = Hm.pointer : HL ? Pf = Hm.MSPointer : GL ? (Pf = Hm.touch, Wm = Hm.mouse) : Pf = Hm.mouse;
function nu() {}
nu.prototype.on = function (n, t) {
  var e = this,
    r = n.split(/[ ,]+/g),
    i;
  e._handlers_ = e._handlers_ || {};
  for (var s = 0; s < r.length; s += 1) i = r[s], e._handlers_[i] = e._handlers_[i] || [], e._handlers_[i].push(t);
  return e;
};
nu.prototype.off = function (n, t) {
  var e = this;
  return e._handlers_ = e._handlers_ || {}, n === void 0 ? e._handlers_ = {} : t === void 0 ? e._handlers_[n] = null : e._handlers_[n] && e._handlers_[n].indexOf(t) >= 0 && e._handlers_[n].splice(e._handlers_[n].indexOf(t), 1), e;
};
nu.prototype.trigger = function (n, t) {
  var e = this,
    r = n.split(/[ ,]+/g),
    i;
  e._handlers_ = e._handlers_ || {};
  for (var s = 0; s < r.length; s += 1) i = r[s], e._handlers_[i] && e._handlers_[i].length && e._handlers_[i].forEach(function (o) {
    o.call(e, {
      type: i,
      target: e
    }, t);
  });
};
nu.prototype.config = function (n) {
  var t = this;
  t.options = t.defaults || {}, n && (t.options = VL(t.options, n));
};
nu.prototype.bindEvt = function (n, t) {
  var e = this;
  return e._domHandlers_ = e._domHandlers_ || {}, e._domHandlers_[t] = function () {
    typeof e["on" + t] == "function" ? e["on" + t].apply(e, arguments) : console.warn('[WARNING] : Missing "on' + t + '" handler.');
  }, Cf(n, Pf[t], e._domHandlers_[t]), Wm[t] && Cf(n, Wm[t], e._domHandlers_[t]), e;
};
nu.prototype.unbindEvt = function (n, t) {
  var e = this;
  return e._domHandlers_ = e._domHandlers_ || {}, G_(n, Pf[t], e._domHandlers_[t]), Wm[t] && G_(n, Wm[t], e._domHandlers_[t]), delete e._domHandlers_[t], this;
};
var Df = nu;
function Ei(n, t) {
  return this.identifier = t.identifier, this.position = t.position, this.frontPosition = t.frontPosition, this.collection = n, this.defaults = {
    size: 100,
    threshold: .1,
    color: "white",
    fadeTime: 250,
    dataOnly: !1,
    restJoystick: !0,
    restOpacity: 1,
    mode: "dynamic",
    zone: document.body,
    lockX: !1,
    lockY: !1,
    shape: "circle"
  }, this.config(t), this.options.mode === "dynamic" && (this.options.restOpacity = 0), this.id = Ei.id, Ei.id += 1, this.buildEl().stylize(), this.instance = {
    el: this.ui.el,
    on: this.on.bind(this),
    off: this.off.bind(this),
    show: this.show.bind(this),
    hide: this.hide.bind(this),
    add: this.addToDom.bind(this),
    remove: this.removeFromDom.bind(this),
    destroy: this.destroy.bind(this),
    setPosition: this.setPosition.bind(this),
    resetDirection: this.resetDirection.bind(this),
    computeDirection: this.computeDirection.bind(this),
    trigger: this.trigger.bind(this),
    position: this.position,
    frontPosition: this.frontPosition,
    ui: this.ui,
    identifier: this.identifier,
    id: this.id,
    options: this.options
  }, this.instance;
}
Ei.prototype = new Df();
Ei.constructor = Ei;
Ei.id = 0;
Ei.prototype.buildEl = function (n) {
  return this.ui = {}, this.options.dataOnly ? this : (this.ui.el = document.createElement("div"), this.ui.back = document.createElement("div"), this.ui.front = document.createElement("div"), this.ui.el.className = "nipple collection_" + this.collection.id, this.ui.back.className = "back", this.ui.front.className = "front", this.ui.el.setAttribute("id", "nipple_" + this.collection.id + "_" + this.id), this.ui.el.appendChild(this.ui.back), this.ui.el.appendChild(this.ui.front), this);
};
Ei.prototype.stylize = function () {
  if (this.options.dataOnly) return this;
  var n = this.options.fadeTime + "ms",
    t = kL("borderRadius", "50%"),
    e = Xx("transition", "opacity", n),
    r = {};
  return r.el = {
    position: "absolute",
    opacity: this.options.restOpacity,
    display: "block",
    zIndex: 999
  }, r.back = {
    position: "absolute",
    display: "block",
    width: this.options.size + "px",
    height: this.options.size + "px",
    marginLeft: -this.options.size / 2 + "px",
    marginTop: -this.options.size / 2 + "px",
    background: "rgba(255, 255, 255, .4)",
    border: "solid 2px rgba(0, 0, 0, .1)"
  }, r.front = {
    width: this.options.size / 2 + "px",
    height: this.options.size / 2 + "px",
    position: "absolute",
    display: "block",
    marginLeft: -this.options.size / 4 + "px",
    marginTop: -this.options.size / 4 + "px",
    background: "rgba(255, 255, 255, .8)",
    border: "solid 2px rgba(0, 0, 0, .1)"
  }, Qx(r.el, e), this.options.shape === "circle" && Qx(r.back, t), Qx(r.front, t), this.applyStyles(r), this;
};
Ei.prototype.applyStyles = function (n) {
  for (var t in this.ui) if (this.ui.hasOwnProperty(t)) for (var e in n[t]) this.ui[t].style[e] = n[t][e];
  return this;
};
Ei.prototype.addToDom = function () {
  return this.options.dataOnly || document.body.contains(this.ui.el) ? this : (this.options.zone.appendChild(this.ui.el), this);
};
Ei.prototype.removeFromDom = function () {
  return this.options.dataOnly || !document.body.contains(this.ui.el) ? this : (this.options.zone.removeChild(this.ui.el), this);
};
Ei.prototype.destroy = function () {
  clearTimeout(this.removeTimeout), clearTimeout(this.showTimeout), clearTimeout(this.restTimeout), this.trigger("destroyed", this.instance), this.removeFromDom(), this.off();
};
Ei.prototype.show = function (n) {
  var t = this;
  return t.options.dataOnly || (clearTimeout(t.removeTimeout), clearTimeout(t.showTimeout), clearTimeout(t.restTimeout), t.addToDom(), t.restCallback(), setTimeout(function () {
    t.ui.el.style.opacity = 1;
  }, 0), t.showTimeout = setTimeout(function () {
    t.trigger("shown", t.instance), typeof n == "function" && n.call(this);
  }, t.options.fadeTime)), t;
};
Ei.prototype.hide = function (n) {
  var t = this;
  if (t.options.dataOnly) return t;
  if (t.ui.el.style.opacity = t.options.restOpacity, clearTimeout(t.removeTimeout), clearTimeout(t.showTimeout), clearTimeout(t.restTimeout), t.removeTimeout = setTimeout(function () {
    var e = t.options.mode === "dynamic" ? "none" : "block";
    t.ui.el.style.display = e, typeof n == "function" && n.call(t), t.trigger("hidden", t.instance);
  }, t.options.fadeTime), t.options.restJoystick) {
    var e = t.options.restJoystick,
      r = {};
    r.x = e === !0 || e.x !== !1 ? 0 : t.instance.frontPosition.x, r.y = e === !0 || e.y !== !1 ? 0 : t.instance.frontPosition.y, t.setPosition(n, r);
  }
  return t;
};
Ei.prototype.setPosition = function (n, t) {
  var e = this;
  e.frontPosition = {
    x: t.x,
    y: t.y
  };
  var r = e.options.fadeTime + "ms",
    i = {};
  i.front = Xx("transition", ["top", "left"], r);
  var s = {
    front: {}
  };
  s.front = {
    left: e.frontPosition.x + "px",
    top: e.frontPosition.y + "px"
  }, e.applyStyles(i), e.applyStyles(s), e.restTimeout = setTimeout(function () {
    typeof n == "function" && n.call(e), e.restCallback();
  }, e.options.fadeTime);
};
Ei.prototype.restCallback = function () {
  var n = this,
    t = {};
  t.front = Xx("transition", "none", ""), n.applyStyles(t), n.trigger("rested", n.instance);
};
Ei.prototype.resetDirection = function () {
  this.direction = {
    x: !1,
    y: !1,
    angle: !1
  };
};
Ei.prototype.computeDirection = function (n) {
  var t = n.angle.radian,
    e = Math.PI / 4,
    r = Math.PI / 2,
    i,
    s,
    o;
  if (t > e && t < e * 3 && !n.lockX ? i = "up" : t > -e && t <= e && !n.lockY ? i = "left" : t > -e * 3 && t <= -e && !n.lockX ? i = "down" : n.lockY || (i = "right"), n.lockY || (t > -r && t < r ? s = "left" : s = "right"), n.lockX || (t > 0 ? o = "up" : o = "down"), n.force > this.options.threshold) {
    var a = {},
      l;
    for (l in this.direction) this.direction.hasOwnProperty(l) && (a[l] = this.direction[l]);
    var u = {};
    this.direction = {
      x: s,
      y: o,
      angle: i
    }, n.direction = this.direction;
    for (l in a) a[l] === this.direction[l] && (u[l] = !0);
    if (u.x && u.y && u.angle) return n;
    (!u.x || !u.y) && this.trigger("plain", n), u.x || this.trigger("plain:" + s, n), u.y || this.trigger("plain:" + o, n), u.angle || this.trigger("dir dir:" + i, n);
  } else this.resetDirection();
  return n;
};
var WL = Ei;
function Jr(n, t) {
  var e = this;
  e.nipples = [], e.idles = [], e.actives = [], e.ids = [], e.pressureIntervals = {}, e.manager = n, e.id = Jr.id, Jr.id += 1, e.defaults = {
    zone: document.body,
    multitouch: !1,
    maxNumberOfNipples: 10,
    mode: "dynamic",
    position: {
      top: 0,
      left: 0
    },
    catchDistance: 200,
    size: 100,
    threshold: .1,
    color: "white",
    fadeTime: 250,
    dataOnly: !1,
    restJoystick: !0,
    restOpacity: 1,
    lockX: !1,
    lockY: !1,
    shape: "circle",
    dynamicPage: !1,
    follow: !1
  }, e.config(t), (e.options.mode === "static" || e.options.mode === "semi") && (e.options.multitouch = !1), e.options.multitouch || (e.options.maxNumberOfNipples = 1);
  var r = getComputedStyle(e.options.zone.parentElement);
  return r && r.display === "flex" && (e.parentIsFlex = !0), e.updateBox(), e.prepareNipples(), e.bindings(), e.begin(), e.nipples;
}
Jr.prototype = new Df();
Jr.constructor = Jr;
Jr.id = 0;
Jr.prototype.prepareNipples = function () {
  var n = this,
    t = n.nipples;
  t.on = n.on.bind(n), t.off = n.off.bind(n), t.options = n.options, t.destroy = n.destroy.bind(n), t.ids = n.ids, t.id = n.id, t.processOnMove = n.processOnMove.bind(n), t.processOnEnd = n.processOnEnd.bind(n), t.get = function (e) {
    if (e === void 0) return t[0];
    for (var r = 0, i = t.length; r < i; r += 1) if (t[r].identifier === e) return t[r];
    return !1;
  };
};
Jr.prototype.bindings = function () {
  var n = this;
  n.bindEvt(n.options.zone, "start"), n.options.zone.style.touchAction = "none", n.options.zone.style.msTouchAction = "none";
};
Jr.prototype.begin = function () {
  var n = this,
    t = n.options;
  if (t.mode === "static") {
    var e = n.createNipple(t.position, n.manager.getIdentifier());
    e.add(), n.idles.push(e);
  }
};
Jr.prototype.createNipple = function (n, t) {
  var e = this,
    r = e.manager.scroll,
    i = {},
    s = e.options,
    o = {
      x: e.parentIsFlex ? r.x : r.x + e.box.left,
      y: e.parentIsFlex ? r.y : r.y + e.box.top
    };
  if (n.x && n.y) i = {
    x: n.x - o.x,
    y: n.y - o.y
  };else if (n.top || n.right || n.bottom || n.left) {
    var a = document.createElement("DIV");
    a.style.display = "hidden", a.style.top = n.top, a.style.right = n.right, a.style.bottom = n.bottom, a.style.left = n.left, a.style.position = "absolute", s.zone.appendChild(a);
    var l = a.getBoundingClientRect();
    s.zone.removeChild(a), i = n, n = {
      x: l.left + r.x,
      y: l.top + r.y
    };
  }
  var u = new WL(e, {
    color: s.color,
    size: s.size,
    threshold: s.threshold,
    fadeTime: s.fadeTime,
    dataOnly: s.dataOnly,
    restJoystick: s.restJoystick,
    restOpacity: s.restOpacity,
    mode: s.mode,
    identifier: t,
    position: n,
    zone: s.zone,
    frontPosition: {
      x: 0,
      y: 0
    },
    shape: s.shape
  });
  return s.dataOnly || (Yx(u.ui.el, i), Yx(u.ui.front, u.frontPosition)), e.nipples.push(u), e.trigger("added " + u.identifier + ":added", u), e.manager.trigger("added " + u.identifier + ":added", u), e.bindNipple(u), u;
};
Jr.prototype.updateBox = function () {
  var n = this;
  n.box = n.options.zone.getBoundingClientRect();
};
Jr.prototype.bindNipple = function (n) {
  var t = this,
    e,
    r = function r(i, s) {
      e = i.type + " " + s.id + ":" + i.type, t.trigger(e, s);
    };
  n.on("destroyed", t.onDestroyed.bind(t)), n.on("shown hidden rested dir plain", r), n.on("dir:up dir:right dir:down dir:left", r), n.on("plain:up plain:right plain:down plain:left", r);
};
Jr.prototype.pressureFn = function (n, t, e) {
  var r = this,
    i = 0;
  clearInterval(r.pressureIntervals[e]), r.pressureIntervals[e] = setInterval(function () {
    var s = n.force || n.pressure || n.webkitForce || 0;
    s !== i && (t.trigger("pressure", s), r.trigger("pressure " + t.identifier + ":pressure", s), i = s);
  }.bind(r), 100);
};
Jr.prototype.onstart = function (n) {
  var t = this,
    e = t.options,
    r = n;
  n = qx(n), t.updateBox();
  var i = function i(s) {
    t.actives.length < e.maxNumberOfNipples ? t.processOnStart(s) : r.type.match(/^touch/) && (Object.keys(t.manager.ids).forEach(function (o) {
      if (Object.values(r.touches).findIndex(function (l) {
        return l.identifier === o;
      }) < 0) {
        var a = [n[0]];
        a.identifier = o, t.processOnEnd(a);
      }
    }), t.actives.length < e.maxNumberOfNipples && t.processOnStart(s));
  };
  return jm(n, i), t.manager.bindDocument(), !1;
};
Jr.prototype.processOnStart = function (n) {
  var t = this,
    e = t.options,
    r,
    i = t.manager.getIdentifier(n),
    s = n.force || n.pressure || n.webkitForce || 0,
    o = {
      x: n.pageX,
      y: n.pageY
    },
    a = t.getOrCreate(i, o);
  a.identifier !== i && t.manager.removeIdentifier(a.identifier), a.identifier = i;
  var l = function l(c) {
    c.trigger("start", c), t.trigger("start " + c.id + ":start", c), c.show(), s > 0 && t.pressureFn(n, c, c.identifier), t.processOnMove(n);
  };
  if ((r = t.idles.indexOf(a)) >= 0 && t.idles.splice(r, 1), t.actives.push(a), t.ids.push(a.identifier), e.mode !== "semi") l(a);else {
    var u = Gm(o, a.position);
    if (u <= e.catchDistance) l(a);else {
      a.destroy(), t.processOnStart(n);
      return;
    }
  }
  return a;
};
Jr.prototype.getOrCreate = function (n, t) {
  var e = this,
    r = e.options,
    i;
  return /(semi|static)/.test(r.mode) ? (i = e.idles[0], i ? (e.idles.splice(0, 1), i) : r.mode === "semi" ? e.createNipple(t, n) : (console.warn("Coudln't find the needed nipple."), !1)) : (i = e.createNipple(t, n), i);
};
Jr.prototype.processOnMove = function (n) {
  var t = this,
    e = t.options,
    r = t.manager.getIdentifier(n),
    i = t.nipples.get(r),
    s = t.manager.scroll;
  if (!FL(n)) {
    this.processOnEnd(n);
    return;
  }
  if (!i) {
    console.error("Found zombie joystick with ID " + r), t.manager.removeIdentifier(r);
    return;
  }
  if (e.dynamicPage) {
    var o = i.el.getBoundingClientRect();
    i.position = {
      x: s.x + o.left,
      y: s.y + o.top
    };
  }
  i.identifier = r;
  var a = i.options.size / 2,
    l = {
      x: n.pageX,
      y: n.pageY
    };
  e.lockX && (l.y = i.position.y), e.lockY && (l.x = i.position.x);
  var u = Gm(l, i.position),
    c = BL(l, i.position),
    d = Wx(c),
    h = u / a,
    f = {
      distance: u,
      position: l
    },
    p,
    m;
  if (i.options.shape === "circle" ? (p = Math.min(u, a), m = NL(i.position, p, c)) : (m = UL(l, i.position, a), p = Gm(m, i.position)), e.follow) {
    if (u > a) {
      var x = l.x - m.x,
        S = l.y - m.y;
      i.position.x += x, i.position.y += S, i.el.style.top = i.position.y - (t.box.top + s.y) + "px", i.el.style.left = i.position.x - (t.box.left + s.x) + "px", u = Gm(l, i.position);
    }
  } else l = m, u = p;
  var g = l.x - i.position.x,
    y = l.y - i.position.y;
  i.frontPosition = {
    x: g,
    y: y
  }, e.dataOnly || Yx(i.ui.front, i.frontPosition);
  var v = {
    identifier: i.identifier,
    position: l,
    force: h,
    pressure: n.force || n.pressure || n.webkitForce || 0,
    distance: u,
    angle: {
      radian: d,
      degree: c
    },
    vector: {
      x: g / a,
      y: -y / a
    },
    raw: f,
    instance: i,
    lockX: e.lockX,
    lockY: e.lockY
  };
  v = i.computeDirection(v), v.angle = {
    radian: Wx(180 - c),
    degree: 180 - c
  }, i.trigger("move", v), t.trigger("move " + i.id + ":move", v);
};
Jr.prototype.processOnEnd = function (n) {
  var t = this,
    e = t.options,
    r = t.manager.getIdentifier(n),
    i = t.nipples.get(r),
    s = t.manager.removeIdentifier(i.identifier);
  !i || (e.dataOnly || i.hide(function () {
    e.mode === "dynamic" && (i.trigger("removed", i), t.trigger("removed " + i.id + ":removed", i), t.manager.trigger("removed " + i.id + ":removed", i), i.destroy());
  }), clearInterval(t.pressureIntervals[i.identifier]), i.resetDirection(), i.trigger("end", i), t.trigger("end " + i.id + ":end", i), t.ids.indexOf(i.identifier) >= 0 && t.ids.splice(t.ids.indexOf(i.identifier), 1), t.actives.indexOf(i) >= 0 && t.actives.splice(t.actives.indexOf(i), 1), /(semi|static)/.test(e.mode) ? t.idles.push(i) : t.nipples.indexOf(i) >= 0 && t.nipples.splice(t.nipples.indexOf(i), 1), t.manager.unbindDocument(), /(semi|static)/.test(e.mode) && (t.manager.ids[s.id] = s.identifier));
};
Jr.prototype.onDestroyed = function (n, t) {
  var e = this;
  e.nipples.indexOf(t) >= 0 && e.nipples.splice(e.nipples.indexOf(t), 1), e.actives.indexOf(t) >= 0 && e.actives.splice(e.actives.indexOf(t), 1), e.idles.indexOf(t) >= 0 && e.idles.splice(e.idles.indexOf(t), 1), e.ids.indexOf(t.identifier) >= 0 && e.ids.splice(e.ids.indexOf(t.identifier), 1), e.manager.removeIdentifier(t.identifier), e.manager.unbindDocument();
};
Jr.prototype.destroy = function () {
  var n = this;
  n.unbindEvt(n.options.zone, "start"), n.nipples.forEach(function (e) {
    e.destroy();
  });
  for (var t in n.pressureIntervals) n.pressureIntervals.hasOwnProperty(t) && clearInterval(n.pressureIntervals[t]);
  n.trigger("destroyed", n.nipples), n.manager.unbindDocument(), n.off();
};
var qL = Jr;
function ji(n) {
  var t = this;
  t.ids = {}, t.index = 0, t.collections = [], t.scroll = j_(), t.config(n), t.prepareCollections();
  var e = function e() {
    var i;
    t.collections.forEach(function (s) {
      s.forEach(function (o) {
        i = o.el.getBoundingClientRect(), o.position = {
          x: t.scroll.x + i.left,
          y: t.scroll.y + i.top
        };
      });
    });
  };
  if ((typeof window === "undefined" ? "undefined" : _typeof(window)) > "u") return t.collections;
  Cf(window, "resize", function () {
    U_(e);
  });
  var r = function r() {
    t.scroll = j_();
  };
  return Cf(window, "scroll", function () {
    U_(r);
  }), t.collections;
}
ji.prototype = new Df();
ji.constructor = ji;
ji.prototype.prepareCollections = function () {
  var n = this;
  n.collections.create = n.create.bind(n), n.collections.on = n.on.bind(n), n.collections.off = n.off.bind(n), n.collections.destroy = n.destroy.bind(n), n.collections.get = function (t) {
    var e;
    return n.collections.every(function (r) {
      return e = r.get(t), !e;
    }), e;
  };
};
ji.prototype.create = function (n) {
  return this.createCollection(n);
};
ji.prototype.createCollection = function (n) {
  var t = this,
    e = new qL(t, n);
  return t.bindCollection(e), t.collections.push(e), e;
};
ji.prototype.bindCollection = function (n) {
  var t = this,
    e,
    r = function r(i, s) {
      e = i.type + " " + s.id + ":" + i.type, t.trigger(e, s);
    };
  n.on("destroyed", t.onDestroyed.bind(t)), n.on("shown hidden rested dir plain", r), n.on("dir:up dir:right dir:down dir:left", r), n.on("plain:up plain:right plain:down plain:left", r);
};
ji.prototype.bindDocument = function () {
  var n = this;
  n.binded || (n.bindEvt(document, "move").bindEvt(document, "end"), n.binded = !0);
};
ji.prototype.unbindDocument = function (n) {
  var t = this;
  (!Object.keys(t.ids).length || n === !0) && (t.unbindEvt(document, "move").unbindEvt(document, "end"), t.binded = !1);
};
ji.prototype.getIdentifier = function (n) {
  var t;
  return n ? (t = n.identifier === void 0 ? n.pointerId : n.identifier, t === void 0 && (t = this.latest || 0)) : t = this.index, this.ids[t] === void 0 && (this.ids[t] = this.index, this.index += 1), this.latest = t, this.ids[t];
};
ji.prototype.removeIdentifier = function (n) {
  var t = {};
  for (var e in this.ids) if (this.ids[e] === n) {
    t.id = e, t.identifier = this.ids[e], delete this.ids[e];
    break;
  }
  return t;
};
ji.prototype.onmove = function (n) {
  var t = this;
  return t.onAny("move", n), !1;
};
ji.prototype.onend = function (n) {
  var t = this;
  return t.onAny("end", n), !1;
};
ji.prototype.oncancel = function (n) {
  var t = this;
  return t.onAny("end", n), !1;
};
ji.prototype.onAny = function (n, t) {
  var e = this,
    r,
    i = "processOn" + n.charAt(0).toUpperCase() + n.slice(1);
  t = qx(t);
  var s = function s(a, l, u) {
      u.ids.indexOf(l) >= 0 && (u[i](a), a._found_ = !0);
    },
    o = function o(a) {
      r = e.getIdentifier(a), jm(e.collections, s.bind(null, a, r)), a._found_ || e.removeIdentifier(r);
    };
  return jm(t, o), !1;
};
ji.prototype.destroy = function () {
  var n = this;
  n.unbindDocument(!0), n.ids = {}, n.index = 0, n.collections.forEach(function (t) {
    t.destroy();
  }), n.off();
};
ji.prototype.onDestroyed = function (n, t) {
  var e = this;
  if (e.collections.indexOf(t) < 0) return !1;
  e.collections.splice(e.collections.indexOf(t), 1);
};
var YL = ji;
var XL = new YL(),
  QL = {
    create: function create(n) {
      return XL.create(n);
    },
    factory: XL
  };
var KL = new Map(),
  qm = new Map(),
  Uo = /*#__PURE__*/function () {
    function Uo(t, e, r, i) {
      _classCallCheck(this, Uo);
      this.data = e;
      var s = e.audio,
        o = e.volume,
        a = e.delay,
        l = e.loop;
      if (!s) throw new Error("Missing property");
      var u = typeof s == "string" ? i.getAudio(s).src : s.data;
      this.audioPlayer = new Da({
        src: u,
        volume: o,
        delay: a,
        loop: l
      }), qm.has(r.uuid) ? qm.get(r.uuid).push(this) : qm.set(r.uuid, [this]), KL.set(t, this);
    }
    _createClass(Uo, [{
      key: "playByToggle",
      value: function playByToggle() {
        this.data.toggle === "stop" ? this.audioPlayer.status === "playing" ? this.audioPlayer.stop() : (this.audioPlayer.stop(), this.audioPlayer.play()) : this.data.toggle === "pause" ? this.audioPlayer.status === "playing" ? this.audioPlayer.pause() : this.audioPlayer.play() : (this.audioPlayer.stop(), this.audioPlayer.play());
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.audioPlayer.stop();
      }
    }]);
    return Uo;
  }(),
  Of = /*#__PURE__*/function () {
    function Of(t) {
      _classCallCheck(this, Of);
      this.data = t;
    }
    _createClass(Of, [{
      key: "dispatch",
      value: function dispatch() {
        this.data.playAudio ? this.pauseAudio(this.data.playAudio) : this.data.object ? this.pauseAllAudiosFromObject(this.data.object) : this.pauseAllAudios();
      }
    }, {
      key: "pauseAudio",
      value: function pauseAudio(t) {
        var _this327 = this;
        var e = KL.get(t);
        !e || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          e.audioPlayer[_this327.data.interaction](), _this327.disposeDelay();
        }, this.data.delay)) : e.audioPlayer[this.data.interaction]());
      }
    }, {
      key: "pauseAllAudiosFromObject",
      value: function pauseAllAudiosFromObject(t) {
        var _this328 = this;
        var e = qm.get(t);
        !(e !== null && e !== void 0 && e.length) || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          e.forEach(function (r) {
            return r.audioPlayer[_this328.data.interaction]();
          }), _this328.disposeDelay();
        }, this.data.delay)) : e.forEach(function (r) {
          return r.audioPlayer[_this328.data.interaction]();
        }));
      }
    }, {
      key: "pauseAllAudios",
      value: function pauseAllAudios() {
        var _this329 = this;
        var t = _toConsumableArray(qm.values());
        !t.length || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          t.forEach(function (e) {
            e.forEach(function (r) {
              r.audioPlayer[_this329.data.interaction]();
            });
          }), _this329.disposeDelay();
        }, this.data.delay)) : t.forEach(function (e) {
          e.forEach(function (r) {
            r.audioPlayer[_this329.data.interaction]();
          });
        }));
      }
    }, {
      key: "disposeDelay",
      value: function disposeDelay() {
        clearTimeout(this.timeoutId), delete this.timeoutId;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        clearTimeout(this.timeoutId), delete this.timeoutId;
      }
    }]);
    return Of;
  }(),
  Ym = /*#__PURE__*/function () {
    function Ym(t, e, r, i, s) {
      _classCallCheck(this, Ym);
      this.data = e;
      this.shared = i;
      this.condition = s;
      if (e.interaction === "play") this.interaction = new Uo(t, e, r, i);else if (e.interaction === "pause" || e.interaction === "stop") this.interaction = new Of(e);else throw new Error("Missing property");
    }
    _createClass(Ym, [{
      key: "dispatchBasic",
      value: function dispatchBasic() {
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.interaction instanceof Uo ? this.interaction.playByToggle() : this.interaction.dispatch();
      }
    }, {
      key: "dispatchConditional",
      value: function dispatchConditional() {
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.interaction instanceof Uo ? this.interaction.audioPlayer.play() : this.interaction.dispatch();
      }
    }, {
      key: "dispatchGameControl",
      value: function dispatchGameControl(t) {
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.interaction instanceof Uo && (t === "start" ? this.interaction.audioPlayer.play() : this.interaction.audioPlayer.stop());
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.interaction.dispose();
      }
    }]);
    return Ym;
  }();
var Xm = /*#__PURE__*/function () {
  function Xm(t, e, r, i) {
    _classCallCheck(this, Xm);
    this.data = t;
    this.page = e;
    this.shared = r;
    this.condition = i;
    this.delay = 0;
    this.emission = t.emission, t.delay !== void 0 && (this.delay = t.delay), this.particleSystem = this.page.scene.find(this.data.emitterObjectId);
  }
  _createClass(Xm, [{
    key: "toggleEmitting",
    value: function toggleEmitting() {
      this.particleSystem.started && !this.particleSystem.stopped ? this.stop() : this.start(this.delay);
    }
  }, {
    key: "toggleFroze",
    value: function toggleFroze() {
      this.particleSystem.started && !this.particleSystem.isFrozen ? this.freeze() : this.unFreeze();
    }
  }, {
    key: "start",
    value: function start() {
      var _this330 = this;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
      if (t) {
        this.delayTimerId = window.setTimeout(function () {
          _this330.start(0), _this330.clearDelay();
        }, this.delay);
        return;
      }
      this.particleSystem.start();
    }
  }, {
    key: "stop",
    value: function stop() {
      this.particleSystem.stop(), this.clearDelay();
    }
  }, {
    key: "freeze",
    value: function freeze() {
      this.particleSystem.froze(), this.clearDelay();
    }
  }, {
    key: "unFreeze",
    value: function unFreeze() {
      this.particleSystem.unFroze(), this.clearDelay();
    }
  }, {
    key: "reset",
    value: function reset() {
      this.particleSystem.reset(), this.clearDelay();
    }
  }, {
    key: "reverseFromCurrent",
    value: function reverseFromCurrent() {
      switch (this.emission) {
        case "emitToggle":
          this.toggleEmitting();
          break;
        case "pauseToggle":
          this.toggleFroze();
          break;
      }
    }
  }, {
    key: "dispatchBasic",
    value: function dispatchBasic() {
      if (Tt(this.shared, this.condition) === !1 || !this.particleSystem) return !1;
      switch (this.emission) {
        case "start":
          this.start(this.delay);
          break;
        case "emitToggle":
          this.toggleEmitting();
          break;
        case "pause":
          this.freeze();
          break;
        case "pauseToggle":
          this.toggleFroze();
          break;
        case "stop":
          this.stop();
          break;
        case "reset":
          this.reset();
          break;
        default:
          break;
      }
    }
  }, {
    key: "dispatchConditional",
    value: function dispatchConditional() {
      if (Tt(this.shared, this.condition) === !1 || !this.particleSystem) return !1;
      switch (this.emission) {
        case "start":
          this.particleSystem.start();
          break;
        case "stop":
          this.particleSystem.stop();
          break;
        case "reset":
          this.particleSystem.reset();
          break;
        default:
          break;
      }
    }
  }, {
    key: "dispatchGameControl",
    value: function dispatchGameControl(t) {
      if (Tt(this.shared, this.condition) === !1 || !this.particleSystem) return !1;
      t === "start" ? this.particleSystem.start() : this.particleSystem.stop();
    }
  }, {
    key: "dispose",
    value: function dispose() {
      !this.particleSystem || (this.particleSystem.reset(), this.clearDelay());
    }
  }, {
    key: "clearDelay",
    value: function clearDelay() {
      this.delayTimerId && (clearTimeout(this.delayTimerId), delete this.delayTimerId);
    }
  }]);
  return Xm;
}();
var pK = "text/plain",
  mK = "us-ascii",
  ZL = function ZL(n, t) {
    return t.some(function (e) {
      return e instanceof RegExp ? e.test(n) : e === n;
    });
  },
  gK = function gK(n, _ref70) {
    var t = _ref70.stripHash;
    var e = /*#__PURE__*/_wrapRegExp(/^data:([^,]*?),([^#]*?)(?:#(.*))?$/, {
      type: 1,
      data: 2,
      hash: 3
    }).exec(n);
    if (!e) throw new Error("Invalid URL: ".concat(n));
    var _e$groups = e.groups,
      r = _e$groups.type,
      i = _e$groups.data,
      s = _e$groups.hash,
      o = r.split(";");
    s = t ? "" : s;
    var a = !1;
    o[o.length - 1] === "base64" && (o.pop(), a = !0);
    var l = (o.shift() || "").toLowerCase(),
      c = _toConsumableArray(o.map(function (d) {
        var _d$split$map = d.split("=").map(function (p) {
            return p.trim();
          }),
          _d$split$map2 = _slicedToArray(_d$split$map, 2),
          h = _d$split$map2[0],
          _d$split$map2$ = _d$split$map2[1],
          f = _d$split$map2$ === void 0 ? "" : _d$split$map2$;
        return h === "charset" && (f = f.toLowerCase(), f === mK) ? "" : "".concat(h).concat(f ? "=".concat(f) : "");
      }).filter(Boolean));
    return a && c.push("base64"), (c.length > 0 || l && l !== pK) && c.unshift(l), "data:".concat(c.join(";"), ",").concat(a ? i.trim() : i).concat(s ? "#".concat(s) : "");
  };
function H_(n, t) {
  if (t = _objectSpread({
    defaultProtocol: "http:",
    normalizeProtocol: !0,
    forceHttp: !1,
    forceHttps: !1,
    stripAuthentication: !0,
    stripHash: !1,
    stripTextFragment: !0,
    stripWWW: !0,
    removeQueryParameters: [/^utm_\w+/i],
    removeTrailingSlash: !0,
    removeSingleSlash: !0,
    removeDirectoryIndex: !1,
    sortQueryParameters: !0
  }, t), n = n.trim(), /^data:/i.test(n)) return gK(n, t);
  if (/^view-source:/i.test(n)) throw new Error("`view-source:` is not supported as it is a non-standard protocol");
  var e = n.startsWith("//");
  !e && /^\.*\//.test(n) || (n = n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//, t.defaultProtocol));
  var i = new URL(n);
  if (t.forceHttp && t.forceHttps) throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");
  if (t.forceHttp && i.protocol === "https:" && (i.protocol = "http:"), t.forceHttps && i.protocol === "http:" && (i.protocol = "https:"), t.stripAuthentication && (i.username = "", i.password = ""), t.stripHash ? i.hash = "" : t.stripTextFragment && (i.hash = i.hash.replace(/#?:~:text.*?$/i, "")), i.pathname) {
    var o = /\b[a-z][a-z\d+\-.]{1,50}:\/\//g,
      a = 0,
      l = "";
    for (;;) {
      var c = o.exec(i.pathname);
      if (!c) break;
      var d = c[0],
        _h95 = c.index,
        f = i.pathname.slice(a, _h95);
      l += f.replace(/\/{2,}/g, "/"), l += d, a = _h95 + d.length;
    }
    var u = i.pathname.slice(a, i.pathname.length);
    l += u.replace(/\/{2,}/g, "/"), i.pathname = l;
  }
  if (i.pathname) try {
    i.pathname = decodeURI(i.pathname);
  } catch (_unused30) {}
  if (t.removeDirectoryIndex === !0 && (t.removeDirectoryIndex = [/^index\.[a-z]+$/]), Array.isArray(t.removeDirectoryIndex) && t.removeDirectoryIndex.length > 0) {
    var _o76 = i.pathname.split("/"),
      _a67 = _o76[_o76.length - 1];
    ZL(_a67, t.removeDirectoryIndex) && (_o76 = _o76.slice(0, -1), i.pathname = _o76.slice(1).join("/") + "/");
  }
  if (i.hostname && (i.hostname = i.hostname.replace(/\.$/, ""), t.stripWWW && /^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(i.hostname) && (i.hostname = i.hostname.replace(/^www\./, ""))), Array.isArray(t.removeQueryParameters)) for (var _i171 = 0, _arr = _toConsumableArray(i.searchParams.keys()); _i171 < _arr.length; _i171++) {
    var _o77 = _arr[_i171];
    ZL(_o77, t.removeQueryParameters) && i.searchParams.delete(_o77);
  }
  if (t.removeQueryParameters === !0 && (i.search = ""), t.sortQueryParameters) {
    i.searchParams.sort();
    try {
      i.search = decodeURIComponent(i.search);
    } catch (_unused31) {}
  }
  t.removeTrailingSlash && (i.pathname = i.pathname.replace(/\/$/, ""));
  var s = n;
  return n = i.toString(), !t.removeSingleSlash && i.pathname === "/" && !s.endsWith("/") && i.hash === "" && (n = n.replace(/\/$/, "")), (t.removeTrailingSlash || i.pathname === "/") && i.hash === "" && t.removeSingleSlash && (n = n.replace(/\/$/, "")), e && !t.normalizeProtocol && (n = n.replace(/^http:\/\//, "//")), t.stripProtocol && (n = n.replace(/^(?:https?:)?\/\//, "")), n;
}
var Zx = /*#__PURE__*/function () {
  function Zx(_ref71, r, i, s) {
    var t = _ref71.url,
      e = _ref71.context;
    _classCallCheck(this, Zx);
    this.controlsManager = r;
    this.shared = i;
    this.condition = s;
    if (!t) throw new Error("Missing property");
    this.url = t.startsWith("mailto:") ? t : H_(t, {
      removeTrailingSlash: !1,
      removeSingleSlash: !1
    }), this.context = e !== null && e !== void 0 ? e : "tab";
  }
  _createClass(Zx, [{
    key: "dispatch",
    value: function dispatch() {
      var _this$controlsManager;
      if (Tt(this.shared, this.condition) === !1) return !1;
      Md ? window.location.assign(this.url) : (this.context === "tab" ? window.open(this.url, "_blank") : this.context === "window" ? window.open(this.url, "_blank", "width=".concat(window.innerWidth, ", height=").concat(window.innerHeight)) : window.open(this.url, "_parent"), (_this$controlsManager = this.controlsManager.orbitControls) !== null && _this$controlsManager !== void 0 && _this$controlsManager.onPointerUp(Ye[0]), w2());
    }
  }]);
  return Zx;
}();
var Qm = /*#__PURE__*/function () {
  function Qm(t, e, r, i, s) {
    var _this331 = this;
    _classCallCheck(this, Qm);
    this.data = t;
    this.page = e;
    this.controlsManager = r;
    this.shared = i;
    this.condition = s;
    this.timeoutIdQueue = [];
    this.dispatchInner = function () {
      _this331.objects.forEach(_this331.destroyCallback);
    };
    this.destroyCallback = function (t) {
      var _e$dataPatched$physic;
      _this331.timeoutIdQueue.shift();
      var e = _this331.page.scene.find(t);
      if (e === void 0) return;
      var r = _this331.controlsManager.sharedGameControlGlobals.rapierWorld,
        i = r ? (_e$dataPatched$physic = e.dataPatched.physics) === null || _e$dataPatched$physic === void 0 ? void 0 : _e$dataPatched$physic.fusedBody : !0;
      if (e.cloner) {
        var _iterator140 = _createForOfIteratorHelper(e.cloner.children),
          _step140;
        try {
          for (_iterator140.s(); !(_step140 = _iterator140.n()).done;) {
            var _e$dataPatched$physic2;
            var _s109 = _step140.value;
            i ? (_s109.playModeVisible = !1, _s109.rigidBody && ((_e$dataPatched$physic2 = e.dataPatched.physics) === null || _e$dataPatched$physic2 === void 0 ? void 0 : _e$dataPatched$physic2.rigidBody) === "positioned" && (_this331.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(_s109.rigidBody.collider(0).handle), r.removeRigidBody(_s109.rigidBody), _s109.rigidBody = void 0), _s109.bvhGeometry && (_s109.bvhGeometry = void 0)) : _this331.clone === void 0 || _this331.clone === _s109 ? (_s109.playModeVisible = !1, _s109.rigidBody && (_this331.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(_s109.rigidBody.collider(0).handle), r.removeRigidBody(_s109.rigidBody), _s109.rigidBody = void 0)) : _s109.playModeVisible === void 0 && (_s109.playModeVisible = !0);
          }
        } catch (err) {
          _iterator140.e(err);
        } finally {
          _iterator140.f();
        }
        (i || _this331.clone === void 0 || _this331.clone === !1) && (e.visible = !1, e.rigidBody && (_this331.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle), r.removeRigidBody(e.rigidBody), e.rigidBody = void 0), e.bvhGeometry && (e.bvhGeometry = void 0));
      } else e.rigidBody && (_this331.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle), r.removeRigidBody(e.rigidBody), e.rigidBody = void 0), e.bvhGeometry && (e.bvhGeometry = void 0), e.visible = !1;
      r === void 0 ? _this331.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim = _this331.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(function (s) {
        return s.bvhGeometry !== void 0;
      }) : _this331.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim = _this331.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(function (s) {
        return s.rigidBody !== void 0;
      }), e.destroyedInAction = !0, _this331.controlsManager.requestRender();
    };
    this.objects = _toConsumableArray(t.objects);
  }
  _createClass(Qm, [{
    key: "dispatch",
    value: function dispatch(t) {
      if (Tt(this.shared, this.condition) === !1) return !1;
      this.clone = t, this.data.delay ? this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner, this.data.delay * 1e3)) : this.dispatchInner();
    }
  }, {
    key: "dispatchFromStart",
    value: function dispatchFromStart() {
      if (Tt(this.shared, this.condition) === !1) return !1;
      this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner, this.data.delay * 1e3));
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.timeoutIdQueue.forEach(function (t) {
        return window.clearTimeout(t);
      });
    }
  }]);
  return Qm;
}();
var Km = /*#__PURE__*/function () {
  function Km(t, e, r, i, s) {
    _classCallCheck(this, Km);
    this.data = t;
    this.page = e;
    this.shared = r;
    this.eventManager = i;
    this.condition = s;
    this.shared = r;
  }
  _createClass(Km, [{
    key: "dispatch",
    value: function dispatch() {
      var _this332 = this,
        _this$data$delay;
      if (Tt(this.shared, this.condition) === !1) return !1;
      clearTimeout(this.timeoutId), delete this.timeoutId, this.timeoutId = window.setTimeout(function () {
        var _this332$eventManager;
        _this332.shared.reset(_this332.shared.data, !0), If(_this332.page, _this332.shared, !0), _this332.eventManager.reset(), (_this332$eventManager = _this332.eventManager.controlsManager.gameControl) !== null && _this332$eventManager !== void 0 && _this332$eventManager.reset(!0), _this332.page.switchToPlayCamera(), _this332.eventManager.controlsManager.requestRender(), delete _this332.timeoutId;
      }, ((_this$data$delay = this.data.delay) !== null && _this$data$delay !== void 0 ? _this$data$delay : 0) * 1e3);
    }
  }, {
    key: "dispose",
    value: function dispose() {
      clearTimeout(this.timeoutId), delete this.timeoutId;
    }
  }]);
  return Km;
}();
var iB = {
    update: null,
    begin: null,
    loopBegin: null,
    changeBegin: null,
    change: null,
    changeComplete: null,
    timelineChangeComplete: null,
    loopComplete: null,
    complete: null,
    loop: 1,
    direction: "normal",
    autoplay: !0,
    timelineOffset: 0,
    rewind: !0
  },
  X_ = {
    duration: 1e3,
    delay: 0,
    endDelay: 0,
    startOnceDelay: 0,
    pingPongDelayCorrection: 0,
    pingPongEndDelayCorrection: 0,
    easing: "easeOutElastic(1, .5)",
    round: 0
  },
  yK = ["translateX", "translateY", "translateZ", "rotate", "rotateX", "rotateY", "rotateZ", "scale", "scaleX", "scaleY", "scaleZ", "skew", "skewX", "skewY", "perspective", "matrix", "matrix3d"],
  $x = {
    CSS: {},
    springs: {}
  };
function eo(n, t, e) {
  return Math.min(Math.max(n, t), e);
}
function Zm(n, t) {
  return n.indexOf(t) > -1;
}
function W_(n, t) {
  return n.apply(null, t);
}
var st = {
  arr: function arr(n) {
    return Array.isArray(n);
  },
  obj: function obj(n) {
    return Zm(Object.prototype.toString.call(n), "Object");
  },
  pth: function pth(n) {
    return st.obj(n) && n.hasOwnProperty("totalLength");
  },
  svg: function svg(n) {
    return n instanceof SVGElement;
  },
  inp: function inp(n) {
    return n instanceof HTMLInputElement;
  },
  dom: function dom(n) {
    return !("isNode" in n) && (n.nodeType || st.svg(n));
  },
  str: function str(n) {
    return typeof n == "string";
  },
  fnc: function fnc(n) {
    return typeof n == "function";
  },
  und: function und(n) {
    return _typeof(n) > "u";
  },
  hex: function hex(n) {
    return /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n);
  },
  rgb: function rgb(n) {
    return /^rgb/.test(n);
  },
  hsl: function hsl(n) {
    return /^hsl/.test(n);
  },
  col: function col(n) {
    return st.hex(n) || st.rgb(n) || st.hsl(n);
  },
  key: function key(n) {
    return !iB.hasOwnProperty(n) && !X_.hasOwnProperty(n) && n !== "targets" && n !== "keyframes";
  }
};
function nB(n) {
  var t = /\(([^)]+)\)/.exec(n);
  return t ? t[1].split(",").map(function (e) {
    return parseFloat(e);
  }) : [];
}
function sB(n, t) {
  var e = nB(n),
    r = eo(st.und(e[0]) ? 1 : e[0], .1, 100),
    i = eo(st.und(e[1]) ? 100 : e[1], .1, 100),
    s = eo(st.und(e[2]) ? 10 : e[2], .1, 100),
    o = eo(st.und(e[3]) ? 0 : e[3], .1, 100),
    a = Math.sqrt(i / r),
    l = s / (2 * Math.sqrt(i * r)),
    u = l < 1 ? a * Math.sqrt(1 - l * l) : 0,
    c = 1,
    d = l < 1 ? (l * a + -o) / u : -o + a;
  function h(p) {
    var m = t ? t * p / 1e3 : p;
    return l < 1 ? m = Math.exp(-m * l * a) * (c * Math.cos(u * m) + d * Math.sin(u * m)) : m = (c + d * m) * Math.exp(-m * a), p === 0 || p === 1 ? p : 1 - m;
  }
  function f() {
    var p = $x.springs[n];
    if (p) return p;
    for (var m = 1 / 6, g = 0, y = 0;;) if (g += m, h(g) === 1) {
      if (y++, y >= 16) break;
    } else y = 0;
    var v = g * m * 1e3;
    return $x.springs[n] = v, v;
  }
  return t ? h : f;
}
function vK(n) {
  return n === void 0 && (n = 10), function (t) {
    return Math.ceil(eo(t, 1e-6, 1) * n) * (1 / n);
  };
}
var xK = function () {
    var n = 11,
      t = 1 / (n - 1);
    function e(c, d) {
      return 1 - 3 * d + 3 * c;
    }
    function r(c, d) {
      return 3 * d - 6 * c;
    }
    function i(c) {
      return 3 * c;
    }
    function s(c, d, h) {
      return ((e(d, h) * c + r(d, h)) * c + i(d)) * c;
    }
    function o(c, d, h) {
      return 3 * e(d, h) * c * c + 2 * r(d, h) * c + i(d);
    }
    function a(c, d, h, f, p) {
      var m,
        g,
        y = 0;
      do g = d + (h - d) / 2, m = s(g, f, p) - c, m > 0 ? h = g : d = g; while (Math.abs(m) > 1e-7 && ++y < 10);
      return g;
    }
    function l(c, d, h, f) {
      for (var p = 0; p < 4; ++p) {
        var m = o(d, h, f);
        if (m === 0) return d;
        var g = s(d, h, f) - c;
        d -= g / m;
      }
      return d;
    }
    function u(c, d, h, f) {
      if (!(0 <= c && c <= 1 && 0 <= h && h <= 1)) return;
      var p = new Float32Array(n);
      if (c !== d || h !== f) for (var m = 0; m < n; ++m) p[m] = s(m * t, c, h);
      function g(y) {
        for (var v = 0, x = 1, S = n - 1; x !== S && p[x] <= y; ++x) v += t;
        --x;
        var w = (y - p[x]) / (p[x + 1] - p[x]),
          A = v + w * t,
          E = o(A, c, h);
        return E >= .001 ? l(y, A, c, h) : E === 0 ? A : a(y, v, v + t, c, h);
      }
      return function (y) {
        return c === d && h === f || y === 0 || y === 1 ? y : s(g(y), d, f);
      };
    }
    return u;
  }(),
  oB = function () {
    var n = {
        linear: function linear() {
          return function (r) {
            return r;
          };
        }
      },
      t = {
        Sine: function Sine() {
          return function (r) {
            return 1 - Math.cos(r * Math.PI / 2);
          };
        },
        Circ: function Circ() {
          return function (r) {
            return 1 - Math.sqrt(1 - r * r);
          };
        },
        Back: function Back() {
          return function (r) {
            return r * r * (3 * r - 2);
          };
        },
        Bounce: function Bounce() {
          return function (r) {
            for (var i, s = 4; r < ((i = Math.pow(2, --s)) - 1) / 11;);
            return 1 / Math.pow(4, 3 - s) - 7.5625 * Math.pow((i * 3 - 2) / 22 - r, 2);
          };
        },
        Elastic: function Elastic(r, i) {
          r === void 0 && (r = 1), i === void 0 && (i = .5);
          var s = eo(r, 1, 10),
            o = eo(i, .1, 2);
          return function (a) {
            return a === 0 || a === 1 ? a : -s * Math.pow(2, 10 * (a - 1)) * Math.sin((a - 1 - o / (Math.PI * 2) * Math.asin(1 / s)) * (Math.PI * 2) / o);
          };
        }
      },
      e = ["Quad", "Cubic", "Quart", "Quint", "Expo"];
    return e.forEach(function (r, i) {
      t[r] = function () {
        return function (s) {
          return Math.pow(s, i + 2);
        };
      };
    }), Object.keys(t).forEach(function (r) {
      var i = t[r];
      n["easeIn" + r] = i, n["easeOut" + r] = function (s, o) {
        return function (a) {
          return 1 - i(s, o)(1 - a);
        };
      }, n["easeInOut" + r] = function (s, o) {
        return function (a) {
          return a < .5 ? i(s, o)(a * 2) / 2 : 1 - i(s, o)(a * -2 + 2) / 2;
        };
      };
    }), n;
  }();
function Q_(n, t) {
  if (st.fnc(n)) return n;
  var e = n.split("(")[0],
    r = oB[e],
    i = nB(n);
  switch (e) {
    case "spring":
      return sB(n, t);
    case "cubicBezier":
      return W_(xK, i);
    case "steps":
      return W_(vK, i);
    default:
      return W_(r, i);
  }
}
function aB(n) {
  try {
    var t = document.querySelectorAll(n);
    return t;
  } catch (_unused32) {
    return;
  }
}
function eb(n, t) {
  for (var e = n.length, r = arguments.length >= 2 ? arguments[1] : void 0, i = [], s = 0; s < e; s++) if (s in n) {
    var o = n[s];
    t.call(r, o, s, n) && i.push(o);
  }
  return i;
}
function tb(n) {
  return n.reduce(function (t, e) {
    return t.concat(st.arr(e) ? tb(e) : e);
  }, []);
}
function JL(n) {
  return st.arr(n) ? n : (st.str(n) && (n = aB(n) || n), n instanceof NodeList || n instanceof HTMLCollection ? [].slice.call(n) : [n]);
}
function K_(n, t) {
  return n.some(function (e) {
    return e === t;
  });
}
function Z_(n) {
  var t = {};
  for (var e in n) t[e] = n[e];
  return t;
}
function q_(n, t) {
  var e = Z_(n);
  for (var r in n) e[r] = t.hasOwnProperty(r) ? t[r] : n[r];
  return e;
}
function rb(n, t) {
  var e = Z_(n);
  for (var r in t) e[r] = st.und(n[r]) ? t[r] : n[r];
  return e;
}
function bK(n) {
  var t = /rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(n);
  return t ? "rgba(" + t[1] + ",1)" : n;
}
function SK(n) {
  var t = /^#?([a-f\d])([a-f\d])([a-f\d])$/i,
    e = n.replace(t, function (a, l, u, c) {
      return l + l + u + u + c + c;
    }),
    r = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),
    i = parseInt(r[1], 16),
    s = parseInt(r[2], 16),
    o = parseInt(r[3], 16);
  return "rgba(" + i + "," + s + "," + o + ",1)";
}
function wK(n) {
  var t = /hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n) || /hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(n),
    e = parseInt(t[1], 10) / 360,
    r = parseInt(t[2], 10) / 100,
    i = parseInt(t[3], 10) / 100,
    s = t[4] || 1;
  function o(h, f, p) {
    return p < 0 && (p += 1), p > 1 && (p -= 1), p < 1 / 6 ? h + (f - h) * 6 * p : p < 1 / 2 ? f : p < 2 / 3 ? h + (f - h) * (2 / 3 - p) * 6 : h;
  }
  var a, l, u;
  if (r == 0) a = l = u = i;else {
    var c = i < .5 ? i * (1 + r) : i + r - i * r,
      d = 2 * i - c;
    a = o(d, c, e + 1 / 3), l = o(d, c, e), u = o(d, c, e - 1 / 3);
  }
  return "rgba(" + a * 255 + "," + l * 255 + "," + u * 255 + "," + s + ")";
}
function AK(n) {
  if (st.rgb(n)) return bK(n);
  if (st.hex(n)) return SK(n);
  if (st.hsl(n)) return wK(n);
}
function Ba(n) {
  var t = /[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(n);
  if (t) return t[1];
}
function _K(n) {
  if (Zm(n, "translate") || n === "perspective") return "px";
  if (Zm(n, "rotate") || Zm(n, "skew")) return "deg";
}
function Y_(n, t) {
  return st.fnc(n) ? n(t.target, t.id, t.total) : n;
}
function Go(n, t) {
  return n.getAttribute(t);
}
function J_(n, t, e) {
  var r = Ba(t);
  if (K_([e, "deg", "rad", "turn"], r)) return t;
  var i = $x.CSS[t + e];
  if (!st.und(i)) return i;
  var s = 100,
    o = document.createElement(n.tagName),
    a = n.parentNode && n.parentNode !== document ? n.parentNode : document.body;
  a.appendChild(o), o.style.position = "absolute", o.style.width = s + e;
  var l = s / o.offsetWidth;
  a.removeChild(o);
  var u = l * parseFloat(t);
  return $x.CSS[t + e] = u, u;
}
function lB(n, t, e) {
  if (t in n.style) {
    var r = t.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase(),
      i = n.style[t] || getComputedStyle(n).getPropertyValue(r) || "0";
    return e ? J_(n, i, e) : i;
  }
}
function $_(n, t) {
  if (st.dom(n) && !st.inp(n) && (Go(n, t) || st.svg(n) && n[t])) return "attribute";
  if (st.dom(n) && K_(yK, t)) return "transform";
  if (st.dom(n) && t !== "transform" && lB(n, t)) return "css";
  if (n[t] != null) return "object";
}
function cB(n) {
  if (!!st.dom(n)) {
    for (var t = n.style.transform || "", e = /(\w+)\(([^)]*)\)/g, r = new Map(), i; i = e.exec(t);) r.set(i[1], i[2]);
    return r;
  }
}
function EK(n, t, e, r) {
  var i = Zm(t, "scale") ? 1 : 0 + _K(t),
    s = cB(n).get(t) || i;
  return e && (e.transforms.list.set(t, s), e.transforms.last = t), r ? J_(n, s, r) : s;
}
function eE(n, t, e, r) {
  switch ($_(n, t)) {
    case "transform":
      return EK(n, t, r, e);
    case "css":
      return lB(n, t, e);
    case "attribute":
      return Go(n, t);
    default:
      return n[t] || 0;
  }
}
function tE(n, t) {
  var e = /^(\*=|\+=|-=)/.exec(n);
  if (!e) return n;
  var r = Ba(n) || 0,
    i = parseFloat(t),
    s = parseFloat(n.replace(e[0], ""));
  switch (e[0][0]) {
    case "+":
      return i + s + r;
    case "-":
      return i - s + r;
    case "*":
      return i * s + r;
  }
}
function uB(n, t) {
  if (st.col(n)) return AK(n);
  if (/\s/g.test(n)) return n;
  var e = Ba(n),
    r = e ? n.substr(0, n.length - e.length) : n;
  return t ? r + t : r;
}
function rE(n, t) {
  return Math.sqrt(Math.pow(t.x - n.x, 2) + Math.pow(t.y - n.y, 2));
}
function TK(n) {
  return Math.PI * 2 * Go(n, "r");
}
function MK(n) {
  return Go(n, "width") * 2 + Go(n, "height") * 2;
}
function CK(n) {
  return rE({
    x: Go(n, "x1"),
    y: Go(n, "y1")
  }, {
    x: Go(n, "x2"),
    y: Go(n, "y2")
  });
}
function dB(n) {
  for (var t = n.points, e = 0, r, i = 0; i < t.numberOfItems; i++) {
    var s = t.getItem(i);
    i > 0 && (e += rE(r, s)), r = s;
  }
  return e;
}
function PK(n) {
  var t = n.points;
  return dB(n) + rE(t.getItem(t.numberOfItems - 1), t.getItem(0));
}
function hB(n) {
  if (n.getTotalLength) return n.getTotalLength();
  switch (n.tagName.toLowerCase()) {
    case "circle":
      return TK(n);
    case "rect":
      return MK(n);
    case "line":
      return CK(n);
    case "polyline":
      return dB(n);
    case "polygon":
      return PK(n);
  }
}
function DK(n) {
  var t = hB(n);
  return n.setAttribute("stroke-dasharray", t), t;
}
function OK(n) {
  for (var t = n.parentNode; st.svg(t) && st.svg(t.parentNode);) t = t.parentNode;
  return t;
}
function fB(n, t) {
  var e = t || {},
    r = e.el || OK(n),
    i = r.getBoundingClientRect(),
    s = Go(r, "viewBox"),
    o = i.width,
    a = i.height,
    l = e.viewBox || (s ? s.split(" ") : [0, 0, o, a]);
  return {
    el: r,
    viewBox: l,
    x: l[0] / 1,
    y: l[1] / 1,
    w: o / l[2],
    h: a / l[3]
  };
}
function IK(n, t) {
  var e = st.str(n) ? aB(n)[0] : n,
    r = t || 100;
  return function (i) {
    return {
      property: i,
      el: e,
      svg: fB(e),
      totalLength: hB(e) * (r / 100)
    };
  };
}
function RK(n, t) {
  function e(a) {
    a === void 0 && (a = 0);
    var l = t + a >= 1 ? t + a : 0;
    return n.el.getPointAtLength(l);
  }
  var r = fB(n.el, n.svg),
    i = e(),
    s = e(-1),
    o = e(1);
  switch (n.property) {
    case "x":
      return (i.x - r.x) * r.w;
    case "y":
      return (i.y - r.y) * r.h;
    case "angle":
      return Math.atan2(o.y - s.y, o.x - s.x) * 180 / Math.PI;
  }
}
function $L(n, t) {
  var e = /[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,
    r = uB(st.pth(n) ? n.totalLength : n, t) + "";
  return {
    original: r,
    numbers: r.match(e) ? r.match(e).map(Number) : [0],
    strings: st.str(n) || t ? r.split(e) : []
  };
}
function pB(n) {
  var t = n ? tb(st.arr(n) ? n.map(JL) : JL(n)) : [];
  return eb(t, function (e, r, i) {
    return i.indexOf(e) === r;
  });
}
function mB(n) {
  var t = pB(n);
  return t.map(function (e, r) {
    return {
      target: e,
      id: r,
      total: t.length,
      transforms: {
        list: cB(e)
      }
    };
  });
}
function LK(n, t) {
  var e = Z_(t);
  if (/^spring/.test(e.easing) && (e.duration = sB(e.easing)), st.arr(n)) {
    var r = n.length,
      i = r === 2 && !st.obj(n[0]);
    i ? n = {
      value: n
    } : st.fnc(t.duration) || (e.duration = t.duration / r);
  }
  var s = st.arr(n) ? n : [n];
  return s.map(function (o, a) {
    var l = st.obj(o) && !st.pth(o) ? o : {
      value: o
    };
    return st.und(l.delay) && (l.delay = a ? 0 : t.delay), st.und(l.endDelay) && (l.endDelay = a === s.length - 1 ? t.endDelay : 0), l;
  }).map(function (o) {
    return rb(o, e);
  });
}
function BK(n) {
  for (var t = eb(tb(n.map(function (s) {
      return Object.keys(s);
    })), function (s) {
      return st.key(s);
    }).reduce(function (s, o) {
      return s.indexOf(o) < 0 && s.push(o), s;
    }, []), e = {}, r = function r(s) {
      var o = t[s];
      e[o] = n.map(function (a) {
        var l = {};
        for (var u in a) st.key(u) ? u == o && (l.value = a[u]) : l[u] = a[u];
        return l;
      });
    }, i = 0; i < t.length; i++) r(i);
  return e;
}
function NK(n, t) {
  var e = [],
    r = t.keyframes;
  r && (t = rb(BK(r), t));
  for (var i in t) st.key(i) && e.push({
    name: i,
    tweens: LK(t[i], n)
  });
  return e;
}
function FK(n, t) {
  var e = {};
  for (var r in n) {
    var i = Y_(n[r], t);
    st.arr(i) && (i = i.map(function (s) {
      return Y_(s, t);
    }), i.length === 1 && (i = i[0])), e[r] = i;
  }
  return e.duration = parseFloat(e.duration), e.delay = parseFloat(e.delay), e;
}
function kK(n, t) {
  var e;
  return n.tweens.map(function (r) {
    var i = FK(r, t),
      s = i.value,
      o = st.arr(s) ? s[1] : s,
      a = Ba(o),
      l = eE(t.target, n.name, a, t),
      u = e ? e.to.original : l,
      c = st.arr(s) ? s[0] : u,
      d = Ba(c) || Ba(l),
      h = a || d;
    return st.und(o) && (o = u), i.from = $L(c, h), i.to = $L(tE(o, c), h), i.start = e ? e.end : 0, i.end = i.start + i.delay + i.duration + i.endDelay, i.easing = Q_(i.easing, i.duration), i.isPath = st.pth(s), i.isColor = st.col(i.from.original), i.isColor && (i.round = 1), e = i, i;
  });
}
var gB = {
  css: function css(n, t, e) {
    return n.style[t] = e;
  },
  attribute: function attribute(n, t, e) {
    return n.setAttribute(t, e);
  },
  object: function object(n, t, e) {
    return n[t] = e;
  },
  transform: function transform(n, t, e, r, i) {
    if (r.list.set(t, e), t === r.last || i) {
      var s = "";
      r.list.forEach(function (o, a) {
        s += a + "(" + o + ") ";
      }), n.style.transform = s;
    }
  }
};
function yB(n, t) {
  var e = mB(n);
  e.forEach(function (r) {
    for (var i in t) {
      var s = Y_(t[i], r),
        o = r.target,
        a = Ba(s),
        l = eE(o, i, a, r),
        u = a || Ba(l),
        c = tE(uB(s, u), l),
        d = $_(o, i);
      gB[d](o, i, c, r.transforms, !0);
    }
  });
}
function zK(n, t) {
  var e = $_(n.target, t.name);
  if (e) {
    var r = kK(t, n),
      i = r[r.length - 1];
    return {
      type: e,
      property: t.name,
      animatable: n,
      tweens: r,
      duration: i.end,
      delay: r[0].delay,
      endDelay: i.endDelay
    };
  }
}
function VK(n, t) {
  return eb(tb(n.map(function (e) {
    return t.map(function (r) {
      return zK(e, r);
    });
  })), function (e) {
    return !st.und(e);
  });
}
function vB(n, t) {
  var e = n.length,
    r = function r(s) {
      return s.timelineOffset ? s.timelineOffset : 0;
    },
    i = {};
  return i.duration = e ? Math.max.apply(Math, n.map(function (s) {
    var _s$startOnceDelay, _s$pingPongDelayCorre, _s$pingPongEndDelayCo, _s$loop;
    var o = (_s$startOnceDelay = s.startOnceDelay) !== null && _s$startOnceDelay !== void 0 ? _s$startOnceDelay : 0,
      a = (_s$pingPongDelayCorre = s.pingPongDelayCorrection) !== null && _s$pingPongDelayCorre !== void 0 ? _s$pingPongDelayCorre : 0,
      l = (_s$pingPongEndDelayCo = s.pingPongEndDelayCorrection) !== null && _s$pingPongEndDelayCo !== void 0 ? _s$pingPongEndDelayCo : 0;
    return r(s) + o + a + l + s.duration * ((_s$loop = s.loop) !== null && _s$loop !== void 0 ? _s$loop : 1);
  })) : t.duration, i.delay = e ? Math.min.apply(Math, n.map(function (s) {
    var _s$startOnceDelay2, _s$pingPongDelayCorre2;
    var o = (_s$startOnceDelay2 = s.startOnceDelay) !== null && _s$startOnceDelay2 !== void 0 ? _s$startOnceDelay2 : 0,
      a = (_s$pingPongDelayCorre2 = s.pingPongDelayCorrection) !== null && _s$pingPongDelayCorre2 !== void 0 ? _s$pingPongDelayCorre2 : 0;
    return r(s) + o + a + s.delay;
  })) : t.delay, i.endDelay = e ? i.duration - Math.max.apply(Math, n.map(function (s) {
    var _s$startOnceDelay3, _s$pingPongDelayCorre3, _s$pingPongEndDelayCo2, _s$loop2;
    var o = (_s$startOnceDelay3 = s.startOnceDelay) !== null && _s$startOnceDelay3 !== void 0 ? _s$startOnceDelay3 : 0,
      a = (_s$pingPongDelayCorre3 = s.pingPongDelayCorrection) !== null && _s$pingPongDelayCorre3 !== void 0 ? _s$pingPongDelayCorre3 : 0,
      l = (_s$pingPongEndDelayCo2 = s.pingPongEndDelayCorrection) !== null && _s$pingPongEndDelayCo2 !== void 0 ? _s$pingPongEndDelayCo2 : 0;
    return r(s) + o + a + s.duration * ((_s$loop2 = s.loop) !== null && _s$loop2 !== void 0 ? _s$loop2 : 1) - s.endDelay - l;
  })) : t.endDelay, i;
}
var eB = 0;
function UK(n) {
  var t = q_(iB, n),
    e = q_(X_, n),
    r = NK(e, n),
    i = mB(n.targets),
    s = VK(i, r),
    o = vB(s, e),
    a = eB;
  return eB++, rb(t, {
    id: a,
    children: [],
    animatables: i,
    animations: s,
    duration: o.duration,
    delay: o.delay,
    endDelay: o.endDelay,
    startOnceDelay: e.startOnceDelay,
    pingPongDelayCorrection: e.pingPongDelayCorrection,
    pingPongEndDelayCorrection: e.pingPongEndDelayCorrection
  });
}
var _s = [],
  tB = [],
  Jx,
  GK = function () {
    function n() {
      Jx = requestAnimationFrame(t);
    }
    function t(e) {
      var r = _s.length;
      if (r) {
        for (var i = 0; i < r;) {
          var s = _s[i];
          s.paused ? (_s.splice(i, 1), r -= 1) : (s.tick(e), i++);
        }
        n();
      } else Jx = cancelAnimationFrame(Jx);
    }
    return n;
  }();
function jK(n) {
  document.hidden ? (_s.forEach(function (t) {
    return t.pause(n.timeStamp);
  }), tB = _s.slice(0), $r.running = _s = []) : tB.forEach(function (t) {
    return t.play(n.timeStamp);
  });
}
(typeof document === "undefined" ? "undefined" : _typeof(document)) < "u" && document.addEventListener("visibilitychange", jK);
function $r(n) {
  n === void 0 && (n = {});
  var t = 0,
    e = 0,
    r = 0,
    i,
    s,
    o = 0,
    a = null;
  function l(E) {
    var b = window.Promise && new Promise(function (T) {
      return a = T;
    });
    return E.finished = b, b;
  }
  var u = UK(n),
    c = l(u);
  function d() {
    var E = u.direction;
    E !== "alternate" && (u.direction = E !== "normal" ? "normal" : "reverse"), u.reversed = !u.reversed, s.forEach(function (b) {
      (b.loop === 1 || b.loop % 2 === 0) && (b.reversed = u.reversed);
    });
  }
  function h() {
    u.direction = "normal", u.reversed = !1, s.forEach(function (E) {
      return E.reversed = !1;
    });
  }
  function f(E) {
    return u.reversed ? u.duration - E : E;
  }
  function p() {
    t = 0, e = f(u.currentTime) * (1 / $r.speed);
  }
  function m(E, b) {
    var T = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
    b && (u.reversed ? b.seek(b.duration * b.loop - (E - b.timelineOffset - b.pingPongDelayCorrection), T) : b.seek(E - b.timelineOffset - b.startOnceDelay - b.pingPongDelayCorrection, T));
  }
  function g(E) {
    var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
    if (u.reversed) for (var M = o; M--;) m(E, s[M], b);else for (var T = 0; T < o; T++) m(E, s[T], b);
  }
  function y(E) {
    var b = 0,
      T = u.animations,
      M = T.length;
    for (u.direction !== "alternate" && ((_u$parent = u.parent) === null || _u$parent === void 0 ? void 0 : _u$parent.direction) === "alternate" ? ((_u$parent2 = u.parent) === null || _u$parent2 === void 0 ? void 0 : _u$parent2.rewind) === !1 && u.reversePlayback === !0 && u.rewind === !1 && ((_u$parent3 = u.parent) !== null && _u$parent3 !== void 0 && _u$parent3.reversed && u.direction === "alternate" ? E = u.duration - u.delay + u.endDelay - E : E = u.duration + u.delay - u.endDelay - E) : w(!1, (_u$parent4 = u.parent) === null || _u$parent4 === void 0 ? void 0 : _u$parent4.rewind, u.rewind, (_u$parent5 = u.parent) === null || _u$parent5 === void 0 ? void 0 : _u$parent5.reversePlayback, u.reversePlayback) && ((_u$parent6 = u.parent) !== null && _u$parent6 !== void 0 && _u$parent6.reversed && u.direction === "alternate" ? E = u.duration - u.delay + u.endDelay - E : E = u.duration + u.delay - u.endDelay - E); b < M;) {
      var _u$parent, _u$parent2, _u$parent3, _u$parent4, _u$parent5, _u$parent6, _u$parent7;
      var C = T[b],
        P = C.animatable,
        D = C.tweens,
        O = D.length - 1,
        I = D[O];
      O && (I = eb(D, function (Y) {
        return E < Y.end;
      })[0] || I);
      var K = void 0;
      (_u$parent7 = u.parent) !== null && _u$parent7 !== void 0 && _u$parent7.reversed && u.direction === "alternate" ? K = eo(E - I.start - I.endDelay, 0, I.duration) / I.duration : K = eo(E - I.start - I.delay, 0, I.duration) / I.duration;
      for (var z = isNaN(K) ? 1 : I.easing(K), B = I.to.strings, V = I.round, U = [], j = I.to.numbers.length, W = void 0, k = 0; k < j; k++) {
        var _u$parent8, _u$parent9, _u$parent10;
        var H = void 0;
        var Y = void 0,
          ye = void 0;
        u.direction !== "alternate" ? ((_u$parent8 = u.parent) === null || _u$parent8 === void 0 ? void 0 : _u$parent8.rewind) === !1 && u.reversePlayback === !0 && u.rewind === !1 ? (Y = I.to.numbers[k], ye = I.from.numbers[k] || 0) : (ye = I.to.numbers[k], Y = I.from.numbers[k] || 0) : w(!0, (_u$parent9 = u.parent) === null || _u$parent9 === void 0 ? void 0 : _u$parent9.rewind, u.rewind, (_u$parent10 = u.parent) === null || _u$parent10 === void 0 ? void 0 : _u$parent10.reversePlayback, u.reversePlayback) ? (Y = I.to.numbers[k], ye = I.from.numbers[k] || 0) : (ye = I.to.numbers[k], Y = I.from.numbers[k] || 0), I.isPath ? H = RK(I.value, z * ye) : H = Y + z * (ye - Y), V && (I.isColor && k > 2 || (H = Math.round(H * V) / V)), U.push(H);
      }
      var X = B.length;
      if (!X) W = U[0];else {
        W = B[0];
        for (var q = 0; q < X; q++) {
          var G = B[q],
            J = B[q + 1],
            Z = U[q];
          isNaN(Z) || (J ? W += Z + J : W += Z + " ");
        }
      }
      gB[C.type](P.target, C.property, W, P.transforms), C.currentValue = W, b++;
    }
  }
  function v(E) {
    u[E] && !u.passThrough && u[E](u);
  }
  function x() {
    u.remaining && u.remaining !== !0 && u.remaining--;
  }
  var S = {
    0: !1,
    1: !0,
    2: !1,
    3: !0,
    4: !1,
    5: !1,
    6: !1,
    7: !1,
    8: !1,
    9: !0,
    10: !0,
    11: !1,
    12: !1,
    13: !1,
    14: !0,
    15: !0,
    16: !1,
    17: !0,
    18: !0,
    19: !1,
    20: !1,
    21: !1,
    22: !0,
    23: !0,
    24: !1,
    25: !0,
    26: !1,
    27: !0,
    28: !1,
    29: !1,
    30: !1,
    31: !1
  };
  function w(E, b, T, M, C) {
    return S[E << 4 | b << 3 | T << 2 | M << 1 | C];
  }
  function A(E) {
    var _u$parent11;
    var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
    var T = u.duration;
    var M = u.delay,
      C = T - u.endDelay;
    ((_u$parent11 = u.parent) === null || _u$parent11 === void 0 ? void 0 : _u$parent11.reversed) && u.direction === "alternate" && (M = u.endDelay, C = T - u.delay);
    var P = f(E);
    if (u.progress = eo(P / T * 100, 0, 100), b || (u.reversePlayback = P < u.currentTime), o && g(P, b), !u.began && u.currentTime >= 0 && (u.began = !0, v("begin")), !u.loopBegan && u.currentTime > 0 && (u.loopBegan = !0, v("loopBegin")), (u.reversed || P >= 0) && P <= M && u.currentTime !== 0 && (y(0), v("change")), (P >= C && u.currentTime !== T + u.pingPongDelayCorrection || !T) && (y(T), v("change")), P > M && P < C ? (u.changeBegan || (u.changeBegan = !0, u.changeCompleted = !1, v("changeBegin")), y(P), v("change")) : u.changeBegan ? (u.changeCompleted = !0, u.changeBegan = !1, v("change"), o && v("timelineChangeComplete")) : u.began && P > C && v("changeComplete"), u.currentTime = eo(P, 0, T + u.pingPongDelayCorrection), u.began && v("update"), E >= T) if (x(), !u.remaining) u.paused = !0, u.completed || (u.completed = !0, v("loopComplete"), v("complete"), !u.passThrough && "Promise" in window && (a(), c = l(u)));else {
      o ? t += u.duration / $r.speed : t += u.duration;
      var _iterator141 = _createForOfIteratorHelper(s),
        _step141;
      try {
        for (_iterator141.s(); !(_step141 = _iterator141.n()).done;) {
          var D = _step141.value;
          D.setStartTime(0), D.remaining = D.loop;
        }
      } catch (err) {
        _iterator141.e(err);
      } finally {
        _iterator141.f();
      }
      v("loopComplete"), u.loopBegan = !1, u.direction === "alternate" ? d() : o && h();
    }
  }
  return u.reset = function () {
    var E = u.direction;
    u.passThrough = !1, u.currentTime = 0, u.progress = 0, u.paused = !0, u.began = !1, u.loopBegan = !1, u.changeBegan = !1, u.completed = !1, u.changeCompleted = !1, u.reversePlayback = !1, u.reversed = E === "reverse", u.remaining = u.loop, s = u.children, o = s.length;
    for (var b = o; b--;) u.children[b].reset();
    y(u.reversed ? u.duration : 0);
  }, u.setStartTime = function (E) {
    t = E;
  }, u.set = function (E, b) {
    return yB(E, b), u;
  }, u.tick = function (E) {
    r = E, t || (t = r), A((r + (e - t)) * $r.speed);
  }, u.seek = function (E) {
    var b = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
    A(E - t, b);
  }, u.pause = function (E) {
    u.paused = !0, o && (i = E !== null && E !== void 0 ? E : performance.now());
  }, u.play = function (E) {
    !u.paused || (u.completed && u.reset(), u.paused = !1, _s.push(u), o && i !== void 0 && (t += (E !== null && E !== void 0 ? E : performance.now()) - i), Jx || GK());
  }, u.reverse = function () {
    d(), u.completed = !u.reversed, p();
  }, u.restart = function () {
    u.reset(), u.play();
  }, u.reset(), u.autoplay && u.play(), u;
}
function rB(n, t) {
  for (var e = t.length; e--;) K_(n, t[e].animatable.target) && t.splice(e, 1);
}
function HK(n) {
  for (var t = pB(n), e = _s.length; e--;) {
    var r = _s[e],
      i = r.animations,
      s = r.children;
    rB(t, i);
    for (var o = s.length; o--;) {
      var a = s[o],
        l = a.animations;
      rB(t, l), !l.length && !a.children.length && s.splice(o, 1);
    }
    !i.length && !s.length && r.pause();
  }
}
function WK(n, t) {
  t === void 0 && (t = {});
  var e = t.direction || "normal",
    r = t.easing ? Q_(t.easing) : null,
    i = t.grid,
    s = t.axis,
    o = t.from || 0,
    a = o === "first",
    l = o === "center",
    u = o === "last",
    c = st.arr(n),
    d = parseFloat(c ? n[0] : n),
    h = c ? parseFloat(n[1]) : 0,
    f = Ba(c ? n[1] : n) || 0,
    p = t.start || 0 + (c ? d : 0),
    m = [],
    g = 0;
  return function (y, v, x) {
    if (a && (o = 0), l && (o = (x - 1) / 2), u && (o = x - 1), !m.length) {
      for (var S = 0; S < x; S++) {
        if (!i) m.push(Math.abs(o - S));else {
          var w = l ? (i[0] - 1) / 2 : o % i[0],
            A = l ? (i[1] - 1) / 2 : Math.floor(o / i[0]),
            E = S % i[0],
            b = Math.floor(S / i[0]),
            T = w - E,
            M = A - b,
            C = Math.sqrt(T * T + M * M);
          s === "x" && (C = -T), s === "y" && (C = -M), m.push(C);
        }
        g = Math.max.apply(Math, m);
      }
      r && (m = m.map(function (D) {
        return r(D / g) * g;
      })), e === "reverse" && (m = m.map(function (D) {
        return s ? D < 0 ? D * -1 : -D : Math.abs(g - D);
      }));
    }
    var P = c ? (h - d) / g : d;
    return p + P * (Math.round(m[v] * 100) / 100) + f;
  };
}
function qK(n) {
  n === void 0 && (n = {});
  var t = $r(n);
  return t.duration = 0, t.add = function (e, r) {
    var i = _s.indexOf(t),
      s = t.children;
    i > -1 && _s.splice(i, 1);
    function o(h) {
      h.passThrough = !0;
    }
    for (var a = 0; a < s.length; a++) o(s[a]);
    var l = rb(e, q_(X_, n));
    l.targets = l.targets || n.targets;
    var u = t.duration;
    l.autoplay = !1, l.timelineOffset = st.und(r) ? u : tE(r, u), o(t);
    var c = $r(l);
    o(c), s.push(c), c.parent = t;
    var d = vB(s, n);
    return t.delay = d.delay, t.endDelay = d.endDelay, t.duration = d.duration, c.loop === !0 && (t.duration = 1 / 0), t.seek(0), t.reset(), t.autoplay && t.play(), t;
  }, t;
}
$r.version = "3.2.0";
$r.speed = 1;
$r.running = _s;
$r.remove = HK;
$r.get = eE;
$r.set = yB;
$r.convertPx = J_;
$r.path = IK;
$r.setDashoffset = DK;
$r.stagger = WK;
$r.timeline = qK;
$r.easing = Q_;
$r.penner = oB;
$r.random = function (n, t) {
  return Math.floor(Math.random() * (t - n + 1)) + n;
};
var ib = $r;
var xB = new _(),
  bB = new _(),
  SB = new je();
function AB(n, t, e, r) {
  if (r === 0) return e.copy(n);
  if (r === 1) return e.copy(t);
  var i = n.w * t.w + n.x * t.x + n.y * t.y + n.z * t.z;
  if (i >= 1) return e.copy(n);
  var s = 1 - i * i;
  if (s <= Number.EPSILON) {
    var c = 1 - r;
    return e.w = c * n.w + r * t.w, e.x = c * n.x + r * t.x, e.y = c * n.y + r * t.y, e.z = c * n.z + r * t.z, e.normalize(), e;
  }
  var o = Math.sqrt(s),
    a = Math.atan2(o, i),
    l = Math.sin((1 - r) * a) / o,
    u = Math.sin(r * a) / o;
  return e.w = n.w * l + t.w * u, e.x = n.x * l + t.x * u, e.y = n.y * l + t.y * u, e.z = n.z * l + t.z * u, e;
}
function Gr(n, t, e, r, i, s) {
  var _i$getVariable, _i$getVariable2;
  var o = e[n] ? e[n] : void 0,
    a = r[n];
  if (a == null) return;
  var l = o != null ? typeof o == "string" ? Number((_i$getVariable = i.getVariable(o)) !== null && _i$getVariable !== void 0 ? _i$getVariable : 0) : o : t[n],
    u = typeof a == "string" ? Number((_i$getVariable2 = i.getVariable(a)) !== null && _i$getVariable2 !== void 0 ? _i$getVariable2 : 0) : a;
  if (l !== u) return {
    update: function update(c) {
      var d = Se.lerp(l, u, c);
      s ? t[n] = Math.trunc(d) : t[n] = d;
    },
    start: function start() {
      t[n] = l;
    },
    end: function end() {
      t[n] = u;
    }
  };
}
function $m(n, t, e, r, i, s) {
  var o = e[n] ? e[n] : void 0,
    a = r[n];
  if (!a) return;
  var l = t[n],
    u = _toConsumableArray(o !== null && o !== void 0 ? o : l).map(function (d) {
      var _i$getVariable3;
      return typeof d == "string" ? Number((_i$getVariable3 = i.getVariable(d)) !== null && _i$getVariable3 !== void 0 ? _i$getVariable3 : 0) : d;
    }),
    c = _toConsumableArray(a).map(function (d) {
      var _i$getVariable4;
      return typeof d == "string" ? Number((_i$getVariable4 = i.getVariable(d)) !== null && _i$getVariable4 !== void 0 ? _i$getVariable4 : 0) : d;
    });
  if (!(u.length !== c.length || Rp(u, c))) return {
    update: function update(d) {
      u.forEach(function (h, f) {
        var p = Se.lerp(h, c[f], d);
        t[n][f] = s ? Math.trunc(p) : p;
      });
    },
    start: function start() {
      Object.assign(t[n], u);
    },
    end: function end() {
      Object.assign(t[n], c);
    }
  };
}
function Jm(n, t, e) {
  return t.forEach(function (r, i) {
    var _e$getVariable;
    n.setComponent(i, typeof r == "string" ? Number((_e$getVariable = e.getVariable(r)) !== null && _e$getVariable !== void 0 ? _e$getVariable : 0) : r);
  }), n;
}
function iE(n, t, e, r, i) {
  var s = e[n] ? e[n] : void 0,
    o = r[n];
  if (!o) return;
  var a = t[n],
    l = s ? Jm(new _(), s, i) : a.clone(),
    u = Jm(new _(), o, i);
  if (!l.equals(u)) return {
    update: function update(c) {
      a.lerpVectors(l, u, c);
    },
    start: function start() {
      a.copy(l);
    },
    end: function end() {
      a.copy(u);
    }
  };
}
function wB(n, t, e) {
  return t.forEach(function (r, i) {
    var _e$getVariable2;
    n.setComponent(i, typeof r == "string" ? Number((_e$getVariable2 = e.getVariable(r)) !== null && _e$getVariable2 !== void 0 ? _e$getVariable2 : 0) : r);
  }), n;
}
function eg(n, t, e, r, i) {
  var s = e[n] ? e[n] : void 0,
    o = r[n];
  if (!o) return;
  var a = t[n],
    l = !(a instanceof N),
    u = a instanceof N ? a : new N().fromArray(a),
    c = s ? wB(new N(), s, i) : u.clone(),
    d = wB(new N(), o, i);
  if (!c.equals(d)) return {
    update: function update(h) {
      u.lerpVectors(c, d, h), l && (t[n] = u.toArray());
    },
    start: function start() {
      u.copy(c), l && (t[n] = u.toArray());
    },
    end: function end() {
      u.copy(d), l && (t[n] = u.toArray());
    }
  };
}
function _B(n, t, e, r) {
  var i = e[n] ? e[n] : void 0,
    s = r[n];
  if (!s) return;
  var o = t[n],
    a = i ? new te().fromArray(i) : o.clone(),
    l = new _(),
    u = new je(),
    c = new _();
  a.decompose(l, u, c);
  var d = new te().fromArray(s),
    h = new _(),
    f = new je(),
    p = new _();
  if (d.decompose(h, f, p), !a.equals(d)) return {
    update: function update(m) {
      SB.slerpQuaternions(u, f, m), xB.lerpVectors(l, h, m), bB.lerpVectors(c, p, m), o.compose(xB, SB, bB);
    },
    start: function start() {
      o.compose(l, u, c);
    },
    end: function end() {
      o.compose(h, f, p);
    }
  };
}
function EB(n, t, e, r, i) {
  var s = e[n] ? e[n] : void 0,
    o = r[n];
  if (!o) return;
  var a = t[n],
    l = s ? typeof s == "string" ? i.getColor(s).clone() : new Le().setRGB(s.r, s.g, s.b) : a.clone(),
    u = typeof o == "string" ? i.getColor(o).clone() : new Le().setRGB(o.r, o.g, o.b);
  if (l.equals(u)) return;
  var c = a.clone();
  return t[n] = c, {
    update: function update(d) {
      c.lerpColors(l, u, d);
    },
    start: function start() {
      c.copy(l);
    },
    end: function end() {
      c.copy(u);
    }
  };
}
function tg(n, t, e, r, i) {
  var s = e[n] ? e[n] : void 0,
    o = r[n];
  if (!o) return;
  var a = t[n],
    l = new cr(a.r, a.g, a.b, a.a),
    u = s ? typeof s == "string" ? i.getColor(s).clone() : new cr(s.r, s.g, s.b, s.a) : l.clone(),
    c = typeof o == "string" ? i.getColor(o).clone() : new cr(o.r, o.g, o.b, o.a);
  if (!u.equals(c)) return {
    update: function update(d) {
      l.lerpColors(u, c, d);
      var h = Se.lerp(u.a, c.a, d);
      l.a = h, t[n] = {
        r: l.r,
        g: l.g,
        b: l.b,
        a: l.a
      };
    },
    start: function start() {
      l.copy(u);
    },
    end: function end() {
      l.copy(c);
    }
  };
}
function jo(n, t, e, r, i) {
  if (typeof t[n] == "number") return Gr(n, t, e !== null && e !== void 0 ? e : {}, r, i);
  if (Array.isArray(t[n])) return $m(n, t, e !== null && e !== void 0 ? e : {}, r, i);
}
function TB(n, t, e, r) {
  var _t$orthographic, _t$perspective, _e$orthographic, _e$perspective;
  var i = [],
    s = n.cameraType === "OrthographicCamera" ? (_t$orthographic = t.orthographic) === null || _t$orthographic === void 0 ? void 0 : _t$orthographic.zoom : (_t$perspective = t.perspective) === null || _t$perspective === void 0 ? void 0 : _t$perspective.zoom,
    o = n.cameraType === "OrthographicCamera" ? (_e$orthographic = e.orthographic) === null || _e$orthographic === void 0 ? void 0 : _e$orthographic.zoom : (_e$perspective = e.perspective) === null || _e$perspective === void 0 ? void 0 : _e$perspective.zoom;
  if (o !== void 0) {
    var a = s !== null && s !== void 0 ? s : n.zoom,
      l = o;
    a !== l && i.push({
      update: function update(u) {
        n.zoom = Se.lerp(a, l, u), n.updateProjectionMatrix();
      },
      start: function start() {
        n.zoom = a, n.updateProjectionMatrix();
      },
      end: function end() {
        n.zoom = l, n.updateProjectionMatrix();
      }
    });
  }
  if (e.targetOffset !== void 0) {
    var _a68 = Gr("targetOffset", n, t, e, r);
    _a68 && i.push(_a68);
  }
  return i;
}
function YK(n, t, e, r) {
  var _t$scaleBaked;
  if (e.scaleBaked === void 0) return;
  var i = ((_t$scaleBaked = t.scaleBaked) !== null && _t$scaleBaked !== void 0 ? _t$scaleBaked : n.data.geometry.scaleBaked).map(function (a) {
      var _r$getVariable;
      return typeof a == "string" ? Number((_r$getVariable = r.getVariable(a)) !== null && _r$getVariable !== void 0 ? _r$getVariable : 0) : a;
    }),
    s = e.scaleBaked.map(function (a) {
      var _r$getVariable2;
      return typeof a == "string" ? Number((_r$getVariable2 = r.getVariable(a)) !== null && _r$getVariable2 !== void 0 ? _r$getVariable2 : 0) : a;
    });
  if (bo.isEqual(i, s)) return;
  var o = [];
  return o.push({
    update: function update(a) {
      n.updateGeometryInteractions({
        scaleBaked: [Se.lerp(i[0], s[0], a), Se.lerp(i[1], s[1], a), Se.lerp(i[2], s[2], a)]
      }, r), n.invalidateDownstreamBooleanData();
    },
    start: function start() {
      n.updateGeometryInteractions({
        scaleBaked: i
      }, r), n.invalidateDownstreamBooleanData();
    },
    end: function end() {
      n.updateGeometryInteractions({
        scaleBaked: s
      }, r), n.invalidateDownstreamBooleanData();
    }
  }), o;
}
function XK(n, t, e, r) {
  var _t$extrusion;
  if (!e.extrusion) return;
  var i = n.extrusion,
    s = (_t$extrusion = t.extrusion) !== null && _t$extrusion !== void 0 ? _t$extrusion : {},
    o = e.extrusion,
    a = [];
  return c1.forEach(function (l) {
    var u = jo(l, i, s, o, r);
    u && a.push(u);
  }), a;
}
function MB(n, t, e, r) {
  var i = [];
  if (!("geometry" in e)) return i;
  var s = n.geometry.userData.parameters,
    o = "geometry" in t ? t.geometry : {},
    a = e.geometry;
  if (n instanceof Qs) {
    var l = YK(n, o, a, r);
    l && i.push.apply(i, _toConsumableArray(l));
  } else {
    var _l94 = {};
    if (Object.assign(_l94, Qn(s, u1)), u1.forEach(function (u) {
      var c = jo(u, _l94, o, a, r);
      c && i.push(c);
    }), n instanceof Hl) {
      Object.assign(_l94, {
        extrusion: _objectSpread({}, s.extrusion)
      });
      var u = XK(_l94, o, a, r);
      u && i.push.apply(i, _toConsumableArray(u));
    }
    i.length && i.push({
      update: function update(u) {
        n.updateGeometryInteractions(_l94, r), n.updateGeometryGroupsIfNeeded();
      },
      start: function start(u) {
        n.updateGeometryInteractions(_l94, r), n.updateGeometryGroupsIfNeeded();
      },
      end: function end(u) {
        n.updateGeometryInteractions(_l94, r), n.updateGeometryGroupsIfNeeded();
      }
    });
  }
  return i;
}
function CB(n, t, e, r) {
  var i = [];
  if (e.intensity !== void 0) {
    var _s110 = Gr("intensity", n, t, e, r);
    _s110 && i.push(_s110);
  }
  if (e.color !== void 0) {
    var _s111 = EB("color", n, t, e, r);
    _s111 && i.push(_s111);
  }
  return i;
}
function DB(n, t, e, r) {
  var i = [];
  if (Array.isArray(n.material)) {
    if (!("materials" in e && e.materials)) return i;
    var _s112 = "materials" in t && t.materials ? t.materials : [],
      o = e.materials;
    n.material.forEach(function (a, l) {
      var _s112$l;
      if (!o[l]) return;
      var u = (_s112$l = _s112[l]) !== null && _s112$l !== void 0 ? _s112$l : {},
        c = o[l];
      typeof u == "string" || typeof c == "string" || i.push.apply(i, _toConsumableArray(PB(a, u, c, r)));
    });
  } else {
    if (!("material" in e && e.material)) return i;
    var _s113 = "material" in t && t.material ? t.material : {},
      _o78 = e.material;
    if (typeof _s113 == "string" || typeof _o78 == "string") return i;
    i.push.apply(i, _toConsumableArray(PB(n.material, _s113, _o78, r)));
  }
  return i;
}
function PB(n, t, e, r) {
  var i = [],
    s = jc(e, r) || !!t.layers && jc(t, r);
  i.push(iZ(n, s));
  var _iterator142 = _createForOfIteratorHelper(n.layers),
    _step142;
  try {
    for (_iterator142.s(); !(_step142 = _iterator142.n()).done;) {
      var _t$layers, _o$visible, _l$visible;
      var o = _step142.value;
      var a = (_t$layers = t.layers) === null || _t$layers === void 0 ? void 0 : _t$layers.data(o.uuid),
        l = e.layers.data(o.uuid);
      if (!l || o.type !== "light" && (!((_o$visible = o.visible) !== null && _o$visible !== void 0 ? _o$visible : !0) || !((_l$visible = l.visible) !== null && _l$visible !== void 0 ? _l$visible : !0))) continue;
      var u = o.getNames().filter(function (c) {
        return !kv.some(function (d) {
          return c.includes(d);
        });
      });
      var _iterator143 = _createForOfIteratorHelper(u),
        _step143;
      try {
        for (_iterator143.s(); !(_step143 = _iterator143.n()).done;) {
          var c = _step143.value;
          try {
            var d = o.getValue(c),
              _h96 = void 0;
            if (c === "colors") _h96 = tZ(o, a, l, c);else if (Array.isArray(d)) c === "steps" && (_h96 = eZ(o, a, l, c));else if (typeof d == "number") _h96 = QK(o, a, l, c, r);else {
              if (typeof d == "boolean") continue;
              d instanceof N ? _h96 = KK(o, a, l, c) : d instanceof _ ? _h96 = ZK(o, a, l, c, r) : d instanceof cr ? _h96 = $K(o, a, l, c, r) : d instanceof Le ? _h96 = JK(o, a, l, c, r) : "isTexture" in d && (_h96 = rZ(o, a, l, c));
            }
            _h96 && (Array.isArray(_h96) ? i.push.apply(i, _toConsumableArray(_h96)) : i.push(_h96));
          } catch (d) {
            console.error("lerpMaterial: unexpected material layer for ".concat(c), d);
          }
        }
      } catch (err) {
        _iterator143.e(err);
      } finally {
        _iterator143.f();
      }
    }
  } catch (err) {
    _iterator142.e(err);
  } finally {
    _iterator142.f();
  }
  return i;
}
function QK(n, t, e, r, i) {
  var _i$getVariable5, _i$getVariable6;
  if (!n.hasValue(r) || !(r in e)) return;
  var s = t ? t[r] : n.getValue(r),
    o = e[r],
    a = typeof s == "string" ? Number((_i$getVariable5 = i.getVariable(s)) !== null && _i$getVariable5 !== void 0 ? _i$getVariable5 : 0) : s,
    l = typeof o == "string" ? Number((_i$getVariable6 = i.getVariable(o)) !== null && _i$getVariable6 !== void 0 ? _i$getVariable6 : 0) : o;
  if (a !== l) return {
    update: function update(u) {
      n.setValue(r, Se.lerp(a, l, u));
    },
    start: function start() {
      n.setValue(r, a);
    },
    end: function end() {
      n.setValue(r, l);
    }
  };
}
function KK(n, t, e, r) {
  if (!n.hasValue(r) || !(r in e)) return;
  var i = n.getValue(r),
    s = t ? new N().fromArray(t[r]) : i.clone(),
    o = new N().fromArray(e[r]);
  if (!s.equals(o)) return {
    update: function update(a) {
      i.lerpVectors(s, o, a);
    },
    start: function start() {
      i.copy(s);
    },
    end: function end() {
      i.copy(o);
    }
  };
}
function ZK(n, t, e, r, i) {
  if (!n.hasValue(r) || !(r in e)) return;
  var s = n.getValue(r),
    o = t ? t[r] : void 0,
    a = e[r],
    l = o ? Jm(new _(), o, i) : s.clone(),
    u = Jm(new _(), a, i);
  if (!l.equals(u)) return {
    update: function update(c) {
      s.lerpVectors(l, u, c);
    },
    start: function start() {
      s.copy(l);
    },
    end: function end() {
      s.copy(u);
    }
  };
}
function JK(n, t, e, r, i) {
  if (!n.hasValue(r) || !(r in e)) return;
  var s = t ? t[r] : void 0,
    o = e[r],
    a = n.getValue(r),
    l = s ? typeof s == "string" ? i.getColor(s).clone() : new Le().setRGB(s.r, s.g, s.b) : a.clone(),
    u = typeof o == "string" ? i.getColor(o).clone() : new Le().setRGB(o.r, o.g, o.b);
  if (l.equals(u)) return;
  var c = a.clone();
  return {
    update: function update(d) {
      n.getValue(r) !== c && n.setValue(r, c), c.lerpColors(l, u, d);
    },
    start: function start() {
      c.copy(l);
    },
    end: function end() {
      c.copy(u);
    }
  };
}
function $K(n, t, e, r, i) {
  if (!n.hasValue(r) || !(r in e)) return;
  var s = t ? t[r] : void 0,
    o = e[r],
    a = n.getValue(r),
    l = s ? typeof s == "string" ? i.getColor(s).clone() : new Le().setRGB(s.r, s.g, s.b) : a.clone(),
    u = typeof o == "string" ? i.getColor(o).clone() : new cr(o.r, o.g, o.b, o.a);
  if (l.equals(u)) return;
  var c = a.clone();
  return {
    update: function update(d) {
      n.getValue(r) !== c && n.setValue(r, c), c.lerpColors(l, u, d);
    },
    start: function start() {
      c.copy(l);
    },
    end: function end() {
      c.copy(u);
    }
  };
}
function eZ(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "steps";
  if (!n.hasValue(r) || !(r in e)) return;
  var i = [],
    s = n.getValue(r),
    o = t ? t[r] : s,
    a = e[r];
  var _loop16 = function _loop16(l) {
    var u = o[l],
      c = a[l];
    u !== c && i.push({
      update: function update(d) {
        s[l] = Se.lerp(u, c, d);
      },
      start: function start() {
        s[l] = u;
      },
      end: function end() {
        s[l] = c;
      }
    });
  };
  for (var l = 0; l < s.length; ++l) {
    _loop16(l);
  }
  return i.length ? i : void 0;
}
function tZ(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "colors";
  if (!n.hasValue(r) || !(r in e)) return;
  var i = [],
    s = n.getValue(r),
    o = t ? t[r] : s.map(function (l) {
      return l.toArray();
    }),
    a = e[r];
  var _loop17 = function _loop17(l) {
    var u = _toConsumableArray(o[l]),
      c = _toConsumableArray(a[l]);
    Hp.isEqual(u, c) || i.push({
      update: function update(d) {
        s[l].fromArray(Hp.lerp(u, c, d));
      },
      start: function start() {
        s[l].fromArray(u);
      },
      end: function end() {
        s[l].fromArray(c);
      }
    });
  };
  for (var l = 0; l < s.length; ++l) {
    _loop17(l);
  }
  return i.length ? i : void 0;
}
function rZ(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : "texture";
  if (!n.hasValue(r) || !(r in e)) return;
  var i = n.getNode("mat");
  if (!i) return;
  var s = t ? t[r] : i,
    o = e[r],
    a = _toConsumableArray(s.repeat),
    l = _toConsumableArray(s.offset),
    u = _toConsumableArray(o.repeat),
    c = _toConsumableArray(o.offset);
  if (!xo.isEqual(a, u) || !xo.isEqual(l, c)) return {
    update: function update(d) {
      i.repeat = xo.lerp(a, u, d), i.offset = xo.lerp(l, c, d), i.updateMatrix();
    },
    start: function start() {
      i.repeat = _toConsumableArray(a), i.offset = _toConsumableArray(l), i.updateMatrix();
    },
    end: function end() {
      i.repeat = _toConsumableArray(u), i.offset = _toConsumableArray(c), i.updateMatrix();
    }
  };
}
function iZ(n, t) {
  return {
    update: function update() {
      n.transparent = t;
    }
  };
}
var nE = new _(),
  OB = new Kt();
function IB(n, t, e, r, i) {
  var _ref72, _ref73, _t$pathSnapping$slide, _t$pathSnapping, _n$updatedPathSnappin, _n$dataPatched$pathSn, _ref74, _ref75, _t$pathSnapping$offse, _t$pathSnapping2, _n$updatedPathSnappin2, _n$dataPatched$pathSn2, _ref76, _t$pathSnapping3, _e$pathSnapping, _ref77, _t$pathSnapping4, _e$pathSnapping2;
  var s = [],
    o,
    a,
    l,
    u,
    c,
    d,
    h;
  if (n instanceof jt ? (o = eg("position", n, t, e, i), o && s.push(o), l = Gr("rotation", n, t, e, i), l && s.push(l)) : (h = {
    slide: (_ref72 = (_ref73 = (_t$pathSnapping$slide = (_t$pathSnapping = t.pathSnapping) === null || _t$pathSnapping === void 0 ? void 0 : _t$pathSnapping.slide) !== null && _t$pathSnapping$slide !== void 0 ? _t$pathSnapping$slide : (_n$updatedPathSnappin = n.updatedPathSnapping) === null || _n$updatedPathSnappin === void 0 ? void 0 : _n$updatedPathSnappin.slide) !== null && _ref73 !== void 0 ? _ref73 : (_n$dataPatched$pathSn = n.dataPatched.pathSnapping) === null || _n$dataPatched$pathSn === void 0 ? void 0 : _n$dataPatched$pathSn.slide) !== null && _ref72 !== void 0 ? _ref72 : 0,
    offset: (_ref74 = (_ref75 = (_t$pathSnapping$offse = (_t$pathSnapping2 = t.pathSnapping) === null || _t$pathSnapping2 === void 0 ? void 0 : _t$pathSnapping2.offset) !== null && _t$pathSnapping$offse !== void 0 ? _t$pathSnapping$offse : (_n$updatedPathSnappin2 = n.updatedPathSnapping) === null || _n$updatedPathSnappin2 === void 0 ? void 0 : _n$updatedPathSnappin2.offset) !== null && _ref75 !== void 0 ? _ref75 : (_n$dataPatched$pathSn2 = n.dataPatched.pathSnapping) === null || _n$dataPatched$pathSn2 === void 0 ? void 0 : _n$dataPatched$pathSn2.offset) !== null && _ref74 !== void 0 ? _ref74 : 0
  }, c = Gr("slide", h, (_ref76 = (_t$pathSnapping3 = t.pathSnapping) !== null && _t$pathSnapping3 !== void 0 ? _t$pathSnapping3 : n.updatedPathSnapping) !== null && _ref76 !== void 0 ? _ref76 : n.dataPatched.pathSnapping, (_e$pathSnapping = e.pathSnapping) !== null && _e$pathSnapping !== void 0 ? _e$pathSnapping : n.dataPatched.pathSnapping, i), c && s.push(c), d = Gr("offset", h, (_ref77 = (_t$pathSnapping4 = t.pathSnapping) !== null && _t$pathSnapping4 !== void 0 ? _t$pathSnapping4 : n.updatedPathSnapping) !== null && _ref77 !== void 0 ? _ref77 : n.dataPatched.pathSnapping, (_e$pathSnapping2 = e.pathSnapping) !== null && _e$pathSnapping2 !== void 0 ? _e$pathSnapping2 : n.dataPatched.pathSnapping, i), d && s.push(d), !c && !d && (o = iE("position", n, t, e, i), o && s.push(o), a = iE("scale", n, t, e, i), a && s.push(a), l = nZ(n, t, e, r, i), l && s.push(l), u = _B("hiddenMatrix", n, t, e), u && s.push(u))), o || a || l || u || c || d) {
    var f = n instanceof jt ? function () {
      n.updateWorldMatrix(!0);
    } : function () {
      var _n$parent;
      n.updateMatrix(), n.hasNonUniformScale && (n.updateMatrixWorld(), n.updateMatrixWorldSVD()), (_n$parent = n.parent) !== null && _n$parent !== void 0 && _n$parent.matrixWorldFusedFalse && (n.matrixWorld.multiplyMatrices(n.parent.matrixWorldFusedFalse, n.matrix), n.matrixWorldNeedsUpdate = !1), sn(n) && An(n.parent) && n.invalidateDownstreamBooleanData(!0), n.updatePathSnapping(Object.assign({}, t.pathSnapping, h));
    };
    s.push({
      update: f,
      start: f,
      end: f
    });
  }
  return s;
}
function nZ(n, t, e, r, i) {
  var _e$rotation;
  var s = t !== null && t !== void 0 && t.rotation ? t.rotation.map(function (c) {
      var _i$getVariable7;
      return (typeof c == "string" ? Number((_i$getVariable7 = i.getVariable(c)) !== null && _i$getVariable7 !== void 0 ? _i$getVariable7 : 0) : c) * Se.DEG2RAD;
    }) : void 0,
    o = (_e$rotation = e.rotation) === null || _e$rotation === void 0 ? void 0 : _e$rotation.map(function (c) {
      var _i$getVariable8;
      return (typeof c == "string" ? Number((_i$getVariable8 = i.getVariable(c)) !== null && _i$getVariable8 !== void 0 ? _i$getVariable8 : 0) : c) * Se.DEG2RAD;
    });
  if (!o) return;
  var a = s ? new _().fromArray(s) : new _().setFromEuler(n.rotation),
    l = new _().fromArray(o);
  if (a.equals(l)) return;
  var u = nE.subVectors(l, a);
  if (r && u.toArray().every(function (c) {
    return Math.abs(c) < 2 * Math.PI;
  })) {
    var c = new je().setFromEuler(OB.setFromVector3(a)),
      d = new je().setFromEuler(OB.setFromVector3(l));
    return {
      update: function update(h) {
        AB(c, d, n.quaternion, h);
      },
      start: function start() {
        n.rotation.setFromVector3(a);
      },
      end: function end() {
        n.rotation.setFromVector3(l);
      }
    };
  } else return {
    update: function update(c) {
      nE.lerpVectors(a, l, c), n.rotation.setFromVector3(nE);
    },
    start: function start() {
      n.rotation.setFromVector3(a);
    },
    end: function end() {
      n.rotation.setFromVector3(l);
    }
  };
}
function RB(n, t, e, r) {
  var i = [];
  if (!("cloner" in e) || !n.cloner) return i;
  var s = n.cloner,
    o = "cloner" in t ? t.cloner : {},
    a = e.cloner;
  e1.forEach(function (f) {
    var p;
    f === "count" ? p = Gr("count", s.parameters, o, a, r, !0) : p = jo(f, s.parameters, o !== null && o !== void 0 ? o : {}, a, r), p && i.push(p);
  });
  var l = sZ(s, o, a, r);
  (l === null || l === void 0 ? void 0 : l.length) && i.push.apply(i, _toConsumableArray(l));
  var u = oZ(s, o, a, r);
  (u === null || u === void 0 ? void 0 : u.length) && i.push.apply(i, _toConsumableArray(u));
  var c = aZ(s, o, a, r);
  (c === null || c === void 0 ? void 0 : c.length) && i.push.apply(i, _toConsumableArray(c));
  var d = lZ(s, o, a, r);
  (d === null || d === void 0 ? void 0 : d.length) && i.push.apply(i, _toConsumableArray(d));
  var h = cZ(s, o, a, r);
  return h !== null && h !== void 0 && h.length && i.push.apply(i, _toConsumableArray(h)), i.length && i.push({
    update: function update() {
      s.update();
    }
  }), i;
}
function sZ(n, t, e, r) {
  if (n.parameters.type !== "radial") return;
  var i = t.radial,
    s = e.radial;
  if (!s) return;
  var o = n.parameters.radial,
    a = [];
  return t1.forEach(function (l) {
    var u = jo(l, o, i !== null && i !== void 0 ? i : {}, s, r);
    u && a.push(u);
  }), a;
}
function oZ(n, t, e, r) {
  if (n.parameters.type !== "linear") return;
  var i = t.linear,
    s = e.linear;
  if (!s) return;
  var o = [],
    a = n.parameters.linear;
  return r1.forEach(function (l) {
    var u = jo(l, a, i !== null && i !== void 0 ? i : {}, s, r);
    u && o.push(u);
  }), o;
}
function aZ(n, t, e, r) {
  if (n.parameters.type !== "grid") return;
  var i = t.grid,
    s = e.grid;
  if (!s) return;
  var o = [],
    a = n.parameters.grid;
  return i1.forEach(function (l) {
    var u;
    l === "count" ? u = $m(l, a, i !== null && i !== void 0 ? i : {}, s, r, !0) : u = jo(l, a, i !== null && i !== void 0 ? i : {}, s, r), u && o.push(u);
  }), o;
}
function lZ(n, t, e, r) {
  if (n.parameters.type !== "toObject") return;
  var i = t.toObject,
    s = e.toObject;
  if (!s) return;
  var o = [],
    a = n.parameters.toObject;
  return n1.forEach(function (l) {
    var u;
    l === "count" ? u = Gr(l, a, i !== null && i !== void 0 ? i : {}, s, r, !0) : u = jo(l, a, i !== null && i !== void 0 ? i : {}, s, r), u && o.push(u);
  }), o;
}
function cZ(n, t, e, r) {
  if (!n.parameters.randomness) return;
  var i = t.randomnessObject,
    s = e.randomnessObject;
  if (!s) return;
  var o = [],
    a = n.parameters.randomnessObject;
  return s1.forEach(function (l) {
    var u = jo(l, a, i !== null && i !== void 0 ? i : {}, s, r);
    u && o.push(u);
  }), o;
}
function uZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.fill.enabled = t);
    }
  };
}
function dZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.stroke.enabled = t);
    }
  };
}
function hZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.dropShadow.enabled = t);
    }
  };
}
function fZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.innerShadow.enabled = t);
    }
  };
}
function pZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.backgroundBlur.enabled = t);
    }
  };
}
function mZ(n, t) {
  return {
    update: function update() {
      n instanceof Ar && (n.layerBlur.enabled = t);
    }
  };
}
function LB(n, t, e, r, i) {
  var s = [],
    o,
    a,
    l,
    u,
    c,
    d,
    h,
    f,
    p,
    m,
    g,
    y,
    v,
    x,
    S;
  if ("width" in n && (o = Gr("width", n, t, e, i), o && s.push(o)), "height" in n && (a = Gr("height", n, t, e, i), a && s.push(a)), n instanceof Ar || n instanceof Zi) {
    var w = _objectSpread({}, t.fill),
      A = _objectSpread({}, e.fill);
    w.enabled !== void 0 && w.enabled !== A.enabled && (s.push(uZ(n, !0)), w.enabled || Object.assign(w, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, w.color), {}, {
        a: 0
      })
    }), A.enabled || Object.assign(A, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, A.color), {}, {
        a: 0
      })
    })), l = tg("color", n.fill, w, A, i), l && s.push(l);
  }
  if (n instanceof Ar) {
    var _w38 = _objectSpread({}, t.stroke),
      _A30 = _objectSpread({}, e.stroke);
    (_w38.enabled || _A30.enabled) && (s.push(dZ(n, !0)), _w38.enabled || Object.assign(_w38, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _w38.color), {}, {
        a: 0
      })
    }), _A30.enabled || Object.assign(_A30, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _A30.color), {}, {
        a: 0
      })
    })), u = tg("color", n.stroke, _w38, _A30, i), u && s.push(u), c = Gr("thickness", n.stroke, _w38, _A30, i), c && s.push(c);
  }
  if (n instanceof Ar) {
    var _w39 = _objectSpread({}, t.dropShadow),
      _A31 = _objectSpread({}, e.dropShadow);
    (_w39.enabled || _A31.enabled) && (s.push(hZ(n, !0)), _w39.enabled || Object.assign(_w39, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _w39.color), {}, {
        a: 0
      })
    }), _A31.enabled || Object.assign(_A31, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _A31.color), {}, {
        a: 0
      })
    })), d = tg("color", n.dropShadow, _w39, _A31, i), d && s.push(d), h = Gr("blurRadius", n.dropShadow, _w39, _A31, i), h && s.push(h), p = Gr("spread", n.dropShadow, _w39, _A31, i), p && s.push(p), f = eg("offset", n.dropShadow, _w39, _A31, i), f && s.push(f);
  }
  if (n instanceof Ar) {
    var _w40 = _objectSpread({}, t.innerShadow),
      _A32 = _objectSpread({}, e.innerShadow);
    (_w40.enabled || _A32.enabled) && (s.push(fZ(n, !0)), _w40.enabled || Object.assign(_w40, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _w40.color), {}, {
        a: 0
      })
    }), _A32.enabled || Object.assign(_A32, {
      enabled: !0,
      color: _objectSpread(_objectSpread({}, _A32.color), {}, {
        a: 0
      })
    })), m = tg("color", n.innerShadow, _w40, _A32, i), m && s.push(m), g = Gr("blurRadius", n.innerShadow, _w40, _A32, i), g && s.push(g), v = Gr("spread", n.innerShadow, _w40, _A32, i), v && s.push(v), y = eg("offset", n.innerShadow, _w40, _A32, i), y && s.push(y);
  }
  if (n instanceof Ar || n instanceof Zi) {
    var _w41 = _objectSpread({}, t.backgroundBlur),
      _A33 = _objectSpread({}, e.backgroundBlur);
    (_w41.enabled || _A33.enabled) && (s.push(pZ(n, !0)), _w41.enabled || Object.assign(_w41, {
      enabled: !0,
      radius: 0
    }), _A33.enabled || Object.assign(_A33, {
      enabled: !0,
      radius: 0
    })), x = Gr("radius", n.backgroundBlur, _w41, _A33, i), x && s.push(x);
  }
  if (n instanceof Ar) {
    var _w42 = _objectSpread({}, t.layerBlur),
      _A34 = _objectSpread({}, e.layerBlur);
    (_w42.enabled || _A34.enabled) && (s.push(mZ(n, !0)), _w42.enabled || Object.assign(_w42, {
      enabled: !0,
      radius: 0
    }), _A34.enabled || Object.assign(_A34, {
      enabled: !0,
      radius: 0
    })), S = Gr("radius", n.layerBlur, _w42, _A34, i), S && s.push(S);
  }
  if (n instanceof Zi || n instanceof ws) {
    var _w43 = $m("cornerRadius", n, t, e, i);
    _w43 && s.push(_w43);
  }
  return s;
}
function sE(n, t, e, r, i) {
  var s = [];
  return n.data.visible && s.push.apply(s, _toConsumableArray(IB(n, t, e, i, r))), n instanceof jt ? s.push.apply(s, _toConsumableArray(LB(n, t, e, i, r))) : (n.data.visible && s.push.apply(s, _toConsumableArray(RB(n, t, e, r))), sn(n) ? (n instanceof er && n.data.visible && s.push.apply(s, _toConsumableArray(MB(n, t, e, r))), n.data.visible && s.push.apply(s, _toConsumableArray(DB(n, t, e, r)))) : IR(n) ? n.data.visible && s.push.apply(s, _toConsumableArray(CB(n, t, e, r))) : OR(n) && s.push.apply(s, _toConsumableArray(TB(n, t, e, r)))), s.length ? {
    update: function update(o) {
      s.forEach(function (a) {
        return a.update(o);
      });
    },
    start: function start(o) {
      s.forEach(function (a) {
        var _a$start;
        return (_a$start = a.start) === null || _a$start === void 0 ? void 0 : _a$start.call(a, o);
      });
    },
    end: function end(o) {
      s.forEach(function (a) {
        var _a$end;
        return (_a$end = a.end) === null || _a$end === void 0 ? void 0 : _a$end.call(a, o);
      });
    }
  } : void 0;
}
var BB = new _();
function If(n, t) {
  var _n$uiCanvas;
  var e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
  var r = [],
    i = function i(s) {
      var o = s.data;
      delete s.states, s.currentState = null, s.reversibleToState = null, s.currentTransitionEvent = null;
      var _iterator144 = _createForOfIteratorHelper(o.states),
        _step144;
      try {
        for (_iterator144.s(); !(_step144 = _iterator144.n()).done;) {
          var a = _step144.value;
          var l = _objectSpread({}, a.data);
          s.states || (s.states = {}), s.states[a.id] = wa.patch(o, l);
        }
      } catch (err) {
        _iterator144.e(err);
      } finally {
        _iterator144.f();
      }
      FB(n.scene, s, null, t, o.events.find(function (a) {
        return a.data.type === "Follow" || a.data.type === "LookAt";
      }) !== void 0), NB(n);
    };
  n.scene.traverse2D(i), n.traverseChildren(function (s) {
    var _s$rigidBody, _s$rigidBody2, _s$rigidBody3, _s$rigidBody4, _a$physics, _s$uiCanvas;
    if (e && ((_s$rigidBody = s.rigidBody) !== null && _s$rigidBody !== void 0 && _s$rigidBody.setTranslation(s.position0, !0), (_s$rigidBody2 = s.rigidBody) !== null && _s$rigidBody2 !== void 0 && _s$rigidBody2.setRotation(s.rotation0, !0), (_s$rigidBody3 = s.rigidBody) !== null && _s$rigidBody3 !== void 0 && _s$rigidBody3.setLinvel(BB, !0), (_s$rigidBody4 = s.rigidBody) !== null && _s$rigidBody4 !== void 0 && _s$rigidBody4.setAngvel(BB, !0)), !ut.is(s)) return;
    var o = s.uuid,
      a = s.data;
    if (delete s.states, s.uuid === us) return;
    var l = !1;
    r.some(function (u) {
      var _n$scene$find;
      return (_n$scene$find = n.scene.find(o)) === null || _n$scene$find === void 0 ? void 0 : _n$scene$find.isDescendantOf(u);
    }) ? l = !0 : ((_a$physics = a.physics) === null || _a$physics === void 0 ? void 0 : _a$physics.fusedBody) === !0 && a.physics.rigidBody === "dynamic" && r.push(o), s.data = a, s.currentState = null, s.reversibleToState = null, s.currentTransitionEvent = null;
    var _iterator145 = _createForOfIteratorHelper(a.states),
      _step145;
    try {
      for (_iterator145.s(); !(_step145 = _iterator145.n()).done;) {
        var u = _step145.value;
        var c = _objectSpread({}, u.data);
        n.data.globalPhysics.usePhysics === !0 && a.physics && (a.physics.rigidBody === "dynamic" || l) && (u.data.position !== void 0 && delete c.position, u.data.rotation !== void 0 && delete c.rotation, u.data.hiddenMatrix !== void 0 && delete c.hiddenMatrix), s.states || (s.states = {}), s.states[u.id] = ga.patch(a, c);
      }
    } catch (err) {
      _iterator145.e(err);
    } finally {
      _iterator145.f();
    }
    FB(n.scene, s, null, t, a.events.find(function (u) {
      return u.data.type === "Follow" || u.data.type === "LookAt";
    }) !== void 0), NB(n), s instanceof fr && s.frame && (s.frame.traverse(function (u) {
      return i(u);
    }), (_s$uiCanvas = s.uiCanvas) === null || _s$uiCanvas === void 0 ? void 0 : _s$uiCanvas.applySize());
  }), n.frame && (n.frame.traverse(function (s) {
    return i(s);
  }), (_n$uiCanvas = n.uiCanvas) === null || _n$uiCanvas === void 0 ? void 0 : _n$uiCanvas.applySize());
}
function NB(n) {
  n.traverseEntity(function (t) {
    var _iterator146 = _createForOfIteratorHelper(t.data.events),
      _step146;
    try {
      for (_iterator146.s(); !(_step146 = _iterator146.n()).done;) {
        var e = _step146.value;
        var r = [];
        switch (e.data.type) {
          case "Follow":
          case "MouseHover":
          case "Scroll":
          case "MouseDown":
          case "MouseUp":
          case "MousePress":
          case "KeyUp":
          case "KeyDown":
          case "KeyPress":
          case "Collision":
            r.push.apply(r, _toConsumableArray(e.data.actions));
            break;
          case "GameControl":
            for (var _i172 = 0, _Object$values4 = Object.values(e.data.gameActions); _i172 < _Object$values4.length; _i172++) {
              var _i173 = _Object$values4[_i172];
              r.push.apply(r, _toConsumableArray(_i173));
            }
            break;
          case "DragDrop":
            r.push.apply(r, _toConsumableArray(e.data.dragDropActions.drag).concat(_toConsumableArray(e.data.dragDropActions.drop)));
            break;
          case "Conditional":
            r.push.apply(r, _toConsumableArray(e.data.inActions).concat(_toConsumableArray(e.data.outActions)));
            break;
        }
        for (var _i174 = 0, _r61 = r; _i174 < _r61.length; _i174++) {
          var _i175 = _r61[_i174];
          if (_i175.data.type === "Create" && _i175.data.hideBase === "Yes") {
            var _s114 = n.scene.find(_i175.data.object);
            _s114 && (_s114.visible = !1);
          }
        }
      }
    } catch (err) {
      _iterator146.e(err);
    } finally {
      _iterator146.f();
    }
  });
}
function FB(n, t, e, r) {
  var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
  if (t instanceof er && t.removeInteractionGeometry(r), t instanceof jt ? t.changeSelectedState(e, {
    shared: r
  }, i) : t.changeSelectedState(e, {
    scene: n,
    shared: r
  }, i), t instanceof er && t.updateGeometryGroupsIfNeeded(), t instanceof hr && t.updateCameraState(t.dataPatched, {
    scene: n,
    shared: r
  }), !(t instanceof jt)) {
    if (t.cloner) {
      var _iterator147 = _createForOfIteratorHelper(t.cloner.children),
        _step147;
      try {
        for (_iterator147.s(); !(_step147 = _iterator147.n()).done;) {
          var _s115 = _step147.value;
          _s115.playModeVisible = void 0;
        }
      } catch (err) {
        _iterator147.e(err);
      } finally {
        _iterator147.f();
      }
    }
    t.updateVisible(n);
  }
}
function aE(n) {
  var t;
  if (n.easing === 5) {
    var e = n.control1,
      r = n.control2;
    t = "cubicBezier(\n\t\t\t".concat(e[0], ", ").concat(e[1], ", ").concat(r[0], ", ").concat(r[1], "\n\t\t)");
  } else if (n.easing === 6) {
    var _e65 = n.mass,
      _r62 = n.stiffness,
      _i176 = n.damping,
      _s116 = n.velocity;
    t = "spring( ".concat(_e65, ", ").concat(_r62, ", ").concat(_i176, ", ").concat(_s116, " )");
  } else {
    var _e66;
    switch (n.easing) {
      case 0:
        _e66 = pa.linear;
        break;
      case 1:
        _e66 = pa.ease;
        break;
      case 2:
        _e66 = pa.easeIn;
        break;
      case 3:
        _e66 = pa.easeOut;
        break;
      case 4:
        _e66 = pa.easeInOut;
        break;
      default:
        _e66 = pa.linear;
    }
    var _e67 = _e66,
      _e68 = _slicedToArray(_e67, 4),
      _r63 = _e68[0],
      _i177 = _e68[1],
      _s117 = _e68[2],
      o = _e68[3];
    t = "cubicBezier( ".concat(_r63, ", ").concat(_i177, ", ").concat(_s117, ", ").concat(o, " )");
  }
  return {
    duration: n.duration,
    easing: t
  };
}
function oE(n) {
  var t = {
    delay: 0,
    loop: n.repeat === -1 ? !0 : n.repeat + 1
  };
  if (n.repeat === 0) t.direction = "normal", t.rewind = !1;else switch (n.direction) {
    case "pingpong":
      t.direction = "alternate", t.rewind = !1;
      break;
    case "pingpong-rewind":
      t.direction = "alternate", t.rewind = !0;
      break;
    default:
      t.direction = "normal", t.rewind = !1;
      break;
  }
  switch (t.delay = 0, t.endDelay = 0, t.startOnceDelay = 0, t.pingPongDelayCorrection = 0, t.pingPongEndDelayCorrection = 0, n.delayDirection) {
    case "start-once":
      t.startOnceDelay = n.delay;
      break;
    case "start":
      t.delay = n.delay;
      break;
    case "end":
      t.endDelay = n.delay;
      break;
    case "start-end":
    case void 0:
      t.delay = n.delay, t.endDelay = n.delay;
      break;
  }
  return t.direction === "alternate" && (t.delay /= 2, t.endDelay /= 2, n.delayDirection === "start" ? (t.pingPongDelayCorrection = t.delay, typeof t.loop == "number" && t.loop % 2 === 0 && (t.pingPongEndDelayCorrection = t.delay)) : n.delayDirection === "end" ? typeof t.loop == "number" && t.loop % 2 !== 0 && (t.pingPongEndDelayCorrection = t.endDelay) : n.delayDirection === "start-end" && (t.pingPongDelayCorrection = t.delay, t.pingPongEndDelayCorrection = t.endDelay)), t;
}
var gZ = {
    type: "beginState"
  },
  yZ = {
    type: "completeState",
    isfromEntity: !1
  },
  sb = /*#__PURE__*/function () {
    function sb(t, e, r, i, s, o) {
      var _this333 = this;
      _classCallCheck(this, sb);
      this.object = t;
      this.data = i;
      this.sharedAssets = s;
      this.allowSlerp = o;
      this.targets = {
        t: 0
      };
      this.firstLoop = !0;
      this._changeBegan = !1;
      this._changeCompleted = !0;
      this.onChange = function () {
        _this333.callback && (_this333.callback.update(_this333.targets.t), _this333.object.requestRender()), _this333.targets.t === 0 || _this333.targets.t === 1 ? _this333._changeCompleted || (_this333._changeCompleted = !0, _this333._changeBegan = !1, _this333.onChangeComplete()) : (_this333._changeCompleted && (_this333._changeCompleted = !1), _this333._changeBegan || (_this333._changeBegan = !0, _this333.onChangeBegin()));
      };
      this.onChangeBegin = function () {
        _this333.object.reversibleToState = _this333.to.id;
        var t = _this333.targets.t > .5 ? _this333.from.id : _this333.to.id;
        _this333.object.prevState !== _this333.object.currentState && (_this333.object.prevState = _this333.object.currentState), _this333.object.currentState = t, _this333.object.dispatchEvent({
          type: "beginState",
          state: t
        }), _this333.object instanceof jt || _this333.object.traverseEntity(function (e) {
          e !== _this333.object && e instanceof hr && e.dispatchEvent(gZ);
        });
      };
      this.onChangeComplete = function () {
        _this333.firstLoop && (_this333.onFirstLoop(), _this333.firstLoop = !1), _this333.object.reversibleToState = _this333.to.id;
        var t = _this333.targets.t < .5 ? _this333.from.id : _this333.to.id;
        _this333.object.prevState !== _this333.object.currentState && (_this333.object.prevState = _this333.object.currentState), _this333.object.currentState = t, _this333.object.dispatchEvent({
          type: "completeState",
          state: t
        }), _this333.object instanceof jt || _this333.object.traverseEntity(function (e) {
          e !== _this333.object && e instanceof hr && e.dispatchEvent(yZ);
        });
      };
      this.onFirstLoop = function () {
        _this333.useCurrentState && (_this333.callback = sE(_this333.object, _this333.from.data, _this333.to.data, _this333.sharedAssets, _this333.allowSlerp));
      };
      if (e === void 0) {
        var a = nb(this.object, this.object.currentState === r ? this.object.prevState : this.object.currentState);
        if (!a) throw new Error("Missing property");
        this.from = a;
      } else {
        var _a69 = nb(this.object, e);
        if (!_a69) throw new Error("Missing property");
        this.from = _a69;
      }
      if (r === void 0) throw new Error("Missing property");
      {
        var _a70 = nb(this.object, r);
        if (!_a70) throw new Error("Missing property");
        this.to = _a70;
      }
      this.useCurrentState = e === void 0 || r === void 0, this.params = _objectSpread(_objectSpread(_objectSpread({
        targets: this.targets,
        t: 1,
        autoplay: !1
      }, oE(i)), aE(i)), {}, {
        change: this.onChange
      }), this.callback = sE(this.object, e === void 0 ? {} : this.from.data, r === void 0 ? {} : this.to.data, this.sharedAssets, this.allowSlerp);
    }
    _createClass(sb, [{
      key: "changeBegan",
      get: function get() {
        return this._changeBegan;
      }
    }, {
      key: "changeCompleted",
      get: function get() {
        return this._changeCompleted;
      }
    }]);
    return sb;
  }(),
  rg = /*#__PURE__*/function (_ir13) {
    _inherits(rg, _ir13);
    var _super296 = _createSuper(rg);
    function rg(e, r, i, s) {
      var _ref78, _this334$page$scene$f, _this334$page$uiCanva;
      var _this334;
      _classCallCheck(this, rg);
      _this334 = _super296.call(this);
      _this334.data = e;
      _this334.page = r;
      _this334.shared = i;
      _this334.condition = s;
      _this334.toggleIsForward = !1;
      _this334.timelineNeedsRebuild = !1;
      _this334.useToggle = !1;
      _this334.onTimelineChangeComplete = function () {
        var _this334$timeline;
        _this334.data.tweens[0].data.direction !== "normal" && (_this334.toggleIsForward = !_this334.toggleIsForward), _this334.timelineNeedsRebuild !== !1 && ((_this334$timeline = _this334.timeline) !== null && _this334$timeline !== void 0 && _this334$timeline.pause(), _this334.buildTimeline({
          isForward: _this334.toggleIsForward,
          needsRebuild: !1,
          isRebuild: !0
        }), _this334.timeline.play());
      };
      if (!e.object) throw new Error("Missing property");
      var o = (_ref78 = (_this334$page$scene$f = _this334.page.scene.find(e.object)) !== null && _this334$page$scene$f !== void 0 ? _this334$page$scene$f : (_this334$page$uiCanva = _this334.page.uiCanvas) === null || _this334$page$uiCanva === void 0 ? void 0 : _this334$page$uiCanva.find(e.object)) !== null && _ref78 !== void 0 ? _ref78 : _this334.page.scene.find2DInUIObjects(e.object);
      if (!o) throw new Error("Missing property");
      if (!o.states) throw new Error("Missing property");
      if (_this334.object = o, e.tweens.length < 2) throw new Error("Missing property");
      _this334.tweens = Array(_this334.data.tweens.length - 1), _this334.startOnceDelay = e.tweens[0].data.delayDirection === "start-once" ? e.tweens[0].data.delay : 0, _this334.init();
      return _this334;
    }
    _createClass(rg, [{
      key: "playing",
      get: function get() {
        return this.timeline && this.timeline.paused === !1;
      }
    }, {
      key: "init",
      value: function init() {
        this.initialCurrentState = nb(this.object, this.object.currentState).id, this.toggleIsForward = !1;
      }
    }, {
      key: "currentState",
      get: function get() {
        return this.useToggle ? this.initialCurrentState : this.object.currentState;
      }
    }, {
      key: "buildTimeline",
      value: function buildTimeline() {
        var _this$object$previous3;
        var _ref79 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
          _ref79$isForward = _ref79.isForward,
          e = _ref79$isForward === void 0 ? !0 : _ref79$isForward,
          _ref79$needsRebuild = _ref79.needsRebuild,
          r = _ref79$needsRebuild === void 0 ? !1 : _ref79$needsRebuild,
          _ref79$isRebuild = _ref79.isRebuild,
          i = _ref79$isRebuild === void 0 ? !1 : _ref79$isRebuild;
        try {
          var _this$timeline;
          var _s118 = oE(this.data.tweens[0].data);
          i && typeof _s118.loop == "number" && _s118.loop--, (_this$timeline = this.timeline) !== null && _this$timeline !== void 0 && _this$timeline.pause(), this.timeline = ib.timeline(_objectSpread(_objectSpread({
            autoplay: !1
          }, _s118), _s118.loop === !0 || _s118.loop > 1 ? {
            timelineChangeComplete: this.onTimelineChangeComplete
          } : {}));
          var o = this.tweens.findIndex(function (a) {
            return a === null || a === void 0 ? void 0 : a.changeBegan;
          });
          if (r === !0 && (this.timelineNeedsRebuild = !0), e) {
            var a = o === -1 ? 0 : o;
            for (var l = a; l < this.data.tweens.length - 1; l++) {
              var _this$object$previous, _this$data$allowSlerp;
              var u = this.data.tweens[l],
                c = this.data.tweens[l + 1],
                d = void 0;
              l === a && (this.object.wasMovedByUser === !0 || ((_this$object$previous = this.object.previousAction) === null || _this$object$previous === void 0 ? void 0 : _this$object$previous.playing) === !0) ? (d = void 0, this.object instanceof hr && (this.object.wasMovedByUser = !1)) : d = u.data.state === void 0 ? this.currentState : u.data.state;
              var _h97 = new sb(this.object, d, c.data.state === void 0 ? this.currentState : c.data.state, c.data, this.shared, (_this$data$allowSlerp = this.data.allowSlerp) !== null && _this$data$allowSlerp !== void 0 ? _this$data$allowSlerp : !1);
              o !== -1 && l === a && Object.assign(_h97.params, {
                startOnceDelay: 0
              }), this.tweens[l] = _h97, this.timeline.add(_h97.params, this.timeline.duration + (l === a ? _s118.delay : 0));
            }
            this.timeline.duration += _s118.endDelay;
          } else {
            var _a71 = o === -1 ? this.data.tweens.length - 1 : o + 1;
            for (var _l95 = _a71; _l95 > 0; _l95--) {
              var _this$object$previous2, _this$data$allowSlerp2;
              var _u59 = this.data.tweens[_l95],
                _c44 = this.data.tweens[_l95 - 1],
                _d59 = void 0;
              _l95 === _a71 && (this.object.wasMovedByUser === !0 || ((_this$object$previous2 = this.object.previousAction) === null || _this$object$previous2 === void 0 ? void 0 : _this$object$previous2.playing) === !0) ? (_d59 = void 0, this.object instanceof hr && (this.object.wasMovedByUser = !1)) : _d59 = _u59.data.state === void 0 ? this.currentState : _u59.data.state;
              var _h98 = new sb(this.object, _d59, _c44.data.state === void 0 ? this.currentState : _c44.data.state, _u59.data, this.shared, (_this$data$allowSlerp2 = this.data.allowSlerp) !== null && _this$data$allowSlerp2 !== void 0 ? _this$data$allowSlerp2 : !1);
              o !== -1 && _l95 === _a71 && Object.assign(_h98.params, {
                startOnceDelay: 0
              }), this.tweens[_l95 - 1] = _h98, this.timeline.add(_h98.params, this.timeline.duration + (_l95 === _a71 ? _s118.endDelay : 0));
            }
            this.timeline.duration += _s118.delay;
          }
        } catch (s) {
          s instanceof Error && console.error(s.message);
        }
        ((_this$object$previous3 = this.object.previousAction) === null || _this$object$previous3 === void 0 ? void 0 : _this$object$previous3.playing) === !0 && this.object.previousAction.pause(), this.object.previousAction = this;
      }
    }, {
      key: "play",
      value: function play() {
        var _this335 = this;
        if (Tt(this.shared, this.condition) === !1 || this.playing) return !1;
        clearTimeout(this.timeoutId);
        var e = oE(this.data.tweens[0].data).pingPongDelayCorrection;
        this.timeoutId = window.setTimeout(function () {
          try {
            _this335.buildTimeline(), _this335.timeline.play();
          } catch (r) {
            r instanceof Error && console.error(r.message);
          }
        }, this.startOnceDelay + e);
      }
    }, {
      key: "pause",
      value: function pause() {
        var _this$timeline2;
        (_this$timeline2 = this.timeline) !== null && _this$timeline2 !== void 0 && _this$timeline2.pause(), clearTimeout(this.timeoutId), this.tweens = Array(this.data.tweens.length - 1), delete this.timeoutId;
      }
    }, {
      key: "stop",
      value: function stop() {
        this.pause();
        var e = this.data.tweens[0].data.state === void 0 ? this.initialCurrentState : this.data.tweens[0].data.state;
        this.object instanceof jt ? this.object.changeSelectedState(e, {
          shared: this.shared
        }) : this.object.changeSelectedState(e, {
          scene: this.page.scene,
          shared: this.shared
        }), this.object.currentState = e;
      }
    }, {
      key: "seek",
      value: function seek(e) {
        var _this$timeline3;
        this.timeline === void 0 && this.buildTimeline(), (_this$timeline3 = this.timeline) === null || _this$timeline3 === void 0 ? void 0 : _this$timeline3.seek(e * this.timeline.duration, !0);
      }
    }, {
      key: "toggle",
      value: function toggle(e) {
        var _this$timeline4,
          _this336 = this;
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.useToggle = !0, clearTimeout(this.timeoutId), this.toggleIsForward = e !== null && e !== void 0 ? e : !this.toggleIsForward, this.playing ? ((_this$timeline4 = this.timeline) !== null && _this$timeline4 !== void 0 && _this$timeline4.pause(), this.buildTimeline({
          isForward: this.toggleIsForward,
          needsRebuild: !0
        }), this.timeline.play()) : this.timeoutId = window.setTimeout(function () {
          var _this336$timeline;
          (_this336$timeline = _this336.timeline) !== null && _this336$timeline !== void 0 && _this336$timeline.pause(), _this336.buildTimeline({
            isForward: _this336.toggleIsForward
          }), _this336.timeline.play();
        }, this.startOnceDelay);
      }
    }, {
      key: "playFromCurrent",
      value: function playFromCurrent() {
        this.toggle(!0);
      }
    }, {
      key: "reverseFromCurrent",
      value: function reverseFromCurrent() {
        this.toggle(!1);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.pause();
      }
    }]);
    return rg;
  }(ir);
function nb(n, t) {
  var _n$states2;
  var e, r;
  if (typeof t == "string" ? (e = t, r = (_n$states2 = n.states) === null || _n$states2 === void 0 ? void 0 : _n$states2[e]) : t === null && (e = null, r = n.data), !(e === void 0 || r === void 0)) return {
    id: e,
    data: r
  };
}
var vZ = {
    type: "beginState"
  },
  kB = {
    type: "completeState",
    isfromEntity: !1
  },
  zB = {
    type: "requestRender"
  },
  ig = /*#__PURE__*/function (_ir14) {
    _inherits(ig, _ir14);
    var _super297 = _createSuper(ig);
    function ig(e, r, i, s) {
      var _this337;
      _classCallCheck(this, ig);
      _this337 = _super297.call(this);
      _this337.data = e;
      _this337.page = r;
      _this337.shared = i;
      _this337.condition = s;
      _this337.toggleIsForward = !1;
      _this337.useToggle = !1;
      _this337.posStart = new _();
      _this337.posEnd = new _();
      _this337.qStart = new je();
      _this337.qEnd = new je();
      _this337.zoomStart = 1;
      _this337.zoomEnd = 1;
      return _this337;
    }
    _createClass(ig, [{
      key: "init",
      value: function init() {}
    }, {
      key: "playing",
      get: function get() {
        return this.animation && this.animation.began && !this.animation.completed;
      }
    }, {
      key: "buildAnimation",
      value: function buildAnimation() {
        var _this338 = this;
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        if (!this.data.animate) return;
        var r = this.page.scene.find(this.data.targetCamera);
        if (!r || !r.visible) throw new ReferenceError("Target camera not founded or not visible");
        var i = {
          t: 0
        };
        this.posStart.copy(this.page.activeCamera.position), this.qStart.copy(this.page.activeCamera.quaternion), this.zoomStart = this.page.activeCamera.zoom, this.animation = ib(_objectSpread(_objectSpread({
          targets: i,
          t: 1
        }, aE(this.data)), {}, {
          update: function update() {
            i.t === 0 && (_this338.useToggle && !_this338.toggleIsForward ? (_this338.posEnd.copy(_this338.fromCamera.position), _this338.qEnd.copy(_this338.fromCamera.quaternion), _this338.zoomEnd = _this338.fromCamera.zoom, _this338.switchCamera(_this338.fromCamera.uuid)) : (_this338.posEnd.copy(r.position), _this338.qEnd.copy(r.quaternion), _this338.zoomEnd = r.zoom, _this338.fromCamera = _this338.page.activeCamera, _this338.switchCamera(r.uuid)), _this338.page.activeCamera.dispatchEvent(vZ));
            var s = _this338.page.activeCamera;
            s.position.lerpVectors(_this338.posStart, _this338.posEnd, i.t), s.quaternion.slerpQuaternions(_this338.qStart, _this338.qEnd, i.t), s.zoom = _this338.zoomStart + (_this338.zoomEnd - _this338.zoomStart) * i.t, s.wasMovedBySwitchCameraAction = !0, s.updateMatrix(), s.updateMatrixWorld(), s.updateProjectionMatrix(), s.dispatchEvent(zB), i.t === 1 && s.dispatchEvent(kB);
          }
        }));
      }
    }, {
      key: "switchCamera",
      value: function switchCamera(e) {
        var r = this.page.activeCamera,
          i = this.page.scene.find(e);
        if (!i || !i.visible) throw new ReferenceError("Target camera not founded or not visible");
        this.page.switchActiveCamera(i), r.dispatchEvent({
          type: "cameraChange",
          camera: i
        });
      }
    }, {
      key: "play",
      value: function play() {
        var _this339 = this;
        if (Tt(this.shared, this.condition) === !1) return !1;
        if (!this.playing && this.page.activeCamera.uuid !== this.data.targetCamera) try {
          clearTimeout(this.timeoutId), this.timeoutId = window.setTimeout(function () {
            var _this339$animation;
            delete _this339.timeoutId, _this339.data.animate ? (_this339.buildAnimation(), (_this339$animation = _this339.animation) === null || _this339$animation === void 0 ? void 0 : _this339$animation.play()) : _this339.switchCamera(_this339.data.targetCamera);
          }, this.data.delay * 1e3);
        } catch (_unused33) {}
      }
    }, {
      key: "pause",
      value: function pause() {
        var _this$animation;
        (_this$animation = this.animation) !== null && _this$animation !== void 0 && _this$animation.pause(), clearTimeout(this.timeoutId), delete this.timeoutId;
      }
    }, {
      key: "toggle",
      value: function toggle(e) {
        var _this340 = this;
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.useToggle = !0, clearTimeout(this.timeoutId), this.toggleIsForward = e !== null && e !== void 0 ? e : !this.toggleIsForward;
        try {
          var _this$animation2, _this$animation3;
          this.playing ? ((_this$animation2 = this.animation) !== null && _this$animation2 !== void 0 && _this$animation2.pause(), this.buildAnimation(!0), (_this$animation3 = this.animation) === null || _this$animation3 === void 0 ? void 0 : _this$animation3.play()) : this.timeoutId = window.setTimeout(function () {
            var _this340$animation, _this340$animation2;
            delete _this340.timeoutId, _this340.data.animate ? ((_this340$animation = _this340.animation) !== null && _this340$animation !== void 0 && _this340$animation.pause(), _this340.buildAnimation(), (_this340$animation2 = _this340.animation) === null || _this340$animation2 === void 0 ? void 0 : _this340$animation2.play()) : (_this340.toggleIsForward ? (_this340.fromCamera = _this340.page.activeCamera, _this340.switchCamera(_this340.data.targetCamera)) : _this340.switchCamera(_this340.fromCamera.uuid), _this340.page.activeCamera.dispatchEvent(kB), _this340.page.activeCamera.dispatchEvent(zB));
          }, this.data.delay * 1e3);
        } catch (_unused34) {}
      }
    }, {
      key: "playFromCurrent",
      value: function playFromCurrent() {
        this.toggle(!0);
      }
    }, {
      key: "reverseFromCurrent",
      value: function reverseFromCurrent() {
        this.toggle(!1);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.pause(), this.toggleIsForward = !1;
      }
    }]);
    return ig;
  }(ir);
var ng = /*#__PURE__*/function (_ir15) {
  _inherits(ng, _ir15);
  var _super298 = _createSuper(ng);
  function ng(e, r, i, s, o) {
    var _u$getClip$duration, _u$getClip, _u$getClip$tracks$0$t, _u$getClip2;
    var _this341;
    _classCallCheck(this, ng);
    _this341 = _super298.call(this);
    _this341.page = r;
    _this341.animationControls = i;
    _this341.shared = s;
    _this341.condition = o;
    _this341.startOnceDelay = 0;
    _this341.toggleIsForward = !1;
    var a = e.object,
      l = r.scene.find(e.object);
    l && Array.isArray(l.identity) && (a = l.identity[0]), _this341.data = _objectSpread(_objectSpread({}, e), {}, {
      object: a
    });
    var u = _this341.animationControls.clipIdToAction[e.clipId + "/" + a];
    _this341.duration = (_u$getClip$duration = u === null || u === void 0 || (_u$getClip = u.getClip()) === null || _u$getClip === void 0 ? void 0 : _u$getClip.duration) !== null && _u$getClip$duration !== void 0 ? _u$getClip$duration : 1;
    var c = (_u$getClip$tracks$0$t = u === null || u === void 0 || (_u$getClip2 = u.getClip()) === null || _u$getClip2 === void 0 || (_u$getClip2 = _u$getClip2.tracks[0]) === null || _u$getClip2 === void 0 ? void 0 : _u$getClip2.times.length) !== null && _u$getClip$tracks$0$t !== void 0 ? _u$getClip$tracks$0$t : 1 / 0;
    _this341.leftFrameTime = _this341.data.crop[0] / c * _this341.duration, _this341.rightFrameTime = _this341.data.crop[1] / c * _this341.duration, _this341.startOnceDelay = e.delay;
    return _this341;
  }
  _createClass(ng, [{
    key: "playing",
    get: function get() {
      var _this$threeAnimAction, _this$threeAnimAction2;
      return (_this$threeAnimAction = (_this$threeAnimAction2 = this.threeAnimAction) === null || _this$threeAnimAction2 === void 0 ? void 0 : _this$threeAnimAction2.isRunning()) !== null && _this$threeAnimAction !== void 0 ? _this$threeAnimAction : !1;
    }
  }, {
    key: "play",
    value: function play() {
      var _this342 = this;
      var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      if (Tt(this.shared, this.condition) === !1) return !1;
      window.clearTimeout(this.timeoutId), this.timeoutId = window.setTimeout(function () {
        var _this342$threeAnimAct;
        if (_this342.threeAnimAction = _this342.animationControls.play(_this342.data), !_this342.threeAnimAction) return;
        _this342.threeAnimAction.reset(), _this342.threeAnimAction.time = _this342.leftFrameTime, _this342.threeAnimAction._clip.start = _this342.leftFrameTime, _this342.threeAnimAction._clip.duration = _this342.rightFrameTime;
        var r = _this342.data.object;
        Object.entries(_this342.animationControls.clipIdToAction).forEach(function (_ref80) {
          var _ref81 = _slicedToArray(_ref80, 2),
            i = _ref81[0],
            s = _ref81[1];
          var o = i.split("/")[1];
          _this342.threeAnimAction !== s && o === r && s.isRunning() && (e ? s.fadeOut(.2) : s.stop());
        }), e && ((_this342$threeAnimAct = _this342.threeAnimAction) === null || _this342$threeAnimAct === void 0 ? void 0 : _this342$threeAnimAct.fadeIn(.2));
      }, this.startOnceDelay);
    }
  }, {
    key: "pause",
    value: function pause() {
      this.threeAnimAction && (this.threeAnimAction.paused = !0), window.clearTimeout(this.timeoutId), delete this.timeoutId;
    }
  }, {
    key: "stop",
    value: function stop() {
      var _this$threeAnimAction3;
      (_this$threeAnimAction3 = this.threeAnimAction) === null || _this$threeAnimAction3 === void 0 || _this$threeAnimAction3.fadeOut(.2);
    }
  }, {
    key: "seek",
    value: function seek(e) {
      this.threeAnimAction = this.animationControls.play(this.data), this.threeAnimAction && (this.threeAnimAction.paused = !0, this.threeAnimAction.time = Se.clamp(this.threeAnimAction.time + 1 / 60 * e, this.leftFrameTime, this.rightFrameTime - 16e-5), this.animationControls.needsUpdate = !0, this.animationControls.requestRender());
    }
  }, {
    key: "toggle",
    value: function toggle(e) {
      var _this343 = this;
      var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
      if (Tt(this.shared, this.condition) === !1) return !1;
      this.toggleIsForward = e !== null && e !== void 0 ? e : !this.toggleIsForward, this.threeAnimAction && (this.threeAnimAction._loopCount = 0), this.playing ? this.threeAnimAction && (this.threeAnimAction.timeScale = this.toggleIsForward ? 1 : -1, this.toggleIsForward ? (this.threeAnimAction._clip.start = this.leftFrameTime, this.threeAnimAction._clip.duration = this.rightFrameTime) : (this.threeAnimAction._clip.start = this.rightFrameTime, this.threeAnimAction._clip.duration = this.leftFrameTime)) : this.timeoutId = window.setTimeout(function () {
        if (_this343.threeAnimAction = _this343.animationControls.play(_this343.data), _this343.threeAnimAction) {
          var _this343$threeAnimAct;
          _this343.toggleIsForward ? (_this343.threeAnimAction.time = _this343.leftFrameTime, _this343.threeAnimAction._clip.start = _this343.leftFrameTime, _this343.threeAnimAction._clip.duration = _this343.rightFrameTime) : (_this343.threeAnimAction.time = _this343.rightFrameTime, _this343.threeAnimAction._clip.start = _this343.rightFrameTime, _this343.threeAnimAction._clip.duration = _this343.leftFrameTime), _this343.threeAnimAction.paused = !1, _this343.threeAnimAction.timeScale = _this343.toggleIsForward ? 1 : -1;
          var _i178 = _this343.data.clipId.split("/")[1];
          Object.entries(_this343.animationControls.clipIdToAction).forEach(function (_ref82) {
            var _ref83 = _slicedToArray(_ref82, 2),
              s = _ref83[0],
              o = _ref83[1];
            var a = s.split("/")[1];
            _this343.threeAnimAction !== o && a === _i178 && o.isRunning() && (r ? o.fadeOut(.2) : o.stop());
          }), r && ((_this343$threeAnimAct = _this343.threeAnimAction) === null || _this343$threeAnimAct === void 0 ? void 0 : _this343$threeAnimAct.fadeIn(.2));
        }
      }, this.startOnceDelay);
    }
  }, {
    key: "playFromCurrent",
    value: function playFromCurrent() {
      this.toggle(!0);
    }
  }, {
    key: "reverseFromCurrent",
    value: function reverseFromCurrent() {
      this.toggle(!1);
    }
  }, {
    key: "dispose",
    value: function dispose() {
      var _this$animationContro;
      var e = (_this$animationContro = this.animationControls.clipIdToAction[this.data.clipId + "/" + this.data.object]) === null || _this$animationContro === void 0 ? void 0 : _this$animationContro.getClip();
      e && (e.duration = this.duration), this.pause();
    }
  }]);
  return ng;
}(ir);
var sg = /*#__PURE__*/function () {
  function sg(t, e, r, i, s) {
    _classCallCheck(this, sg);
    this.data = t;
    this.page = e;
    this.eventManager = r;
    this.shared = i;
    this.condition = s;
    this.timeOutId = -1;
    this.scene = e.scene;
  }
  _createClass(sg, [{
    key: "dispatch",
    value: function dispatch() {
      var _this344 = this;
      if (Tt(this.shared, this.condition) === !1) return !1;
      this.data.target !== this.page.uuid && (window.clearTimeout(this.timeOutId), this.timeOutId = window.setTimeout(function () {
        _this344.play();
      }, this.data.delay * 1e3));
    }
  }, {
    key: "dispose",
    value: function dispose() {
      window.clearTimeout(this.timeOutId);
    }
  }, {
    key: "play",
    value: function play() {
      var _this345 = this;
      if (this.scene.children.every(function (r) {
        return r.uuid !== _this345.data.target;
      })) return;
      this.data.transition === "fade" && this.data.duration > 0 && this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene, this.scene.activeCamera, this.data.duration * 1e3), this.eventManager.deactivate(), this.eventManager.controlsManager.deactivate();
      var t = this.scene.activeCamera;
      this.scene.updatePage(this.data.target), this.scene.activePage.switchToPlayCamera(), this.scene.activeCamera.copyViewPlaneSize(t), If(this.scene.activePage, this.shared), this.eventManager.activate(), this.eventManager.controlsManager.activate(this.eventManager);
    }
  }]);
  return sg;
}();
var og = /*#__PURE__*/function () {
  function og(t, e, r, i) {
    _classCallCheck(this, og);
    this.data = t;
    this.page = e;
    this.shared = r;
    this.condition = i;
    this.evaluatedCondition = !1;
  }
  _createClass(og, [{
    key: "checkConditions",
    value: function checkConditions() {
      this.evaluatedCondition = Tt(this.shared, this.condition);
    }
  }, {
    key: "dispatch",
    value: function dispatch() {
      if (this.evaluatedCondition === !1) return !1;
      var t = this.shared.getVariable(this.data.variableId),
        e = C0(this.data.expression, this.shared, Fi.typeOfVariable(t));
      e !== void 0 && this.shared.updateVariable(this.data.variableId, typeof e == "string" ? {
        textValue: e
      } : e);
    }
  }, {
    key: "dispose",
    value: function dispose() {}
  }]);
  return og;
}();
var ag = /*#__PURE__*/function () {
  function ag(t, e, r, i) {
    _classCallCheck(this, ag);
    this.data = t;
    this.page = e;
    this.shared = r;
    this.condition = i;
    this.timeoutId = null;
  }
  _createClass(ag, [{
    key: "dispatchInner",
    value: function dispatchInner() {
      if (Tt(this.shared, this.condition) === !1) return !1;
      var t = this.shared.getDynamicVariablePlayState(this.data.variableId);
      if (this.data.mode === "PlayPause") this.shared.getDynamicVariableToggleIsForward(this.data.variableId) === void 0 && this.shared.setDynamicVariableToggleIsForward(this.data.variableId, !0), this.shared.setDynamicVariablePlayState(this.data.variableId, t === "Playing" ? "Paused" : "Playing");else if (this.data.mode === "Play" && t !== "Playing") this.shared.getDynamicVariableToggleIsForward(this.data.variableId) === void 0 && this.shared.setDynamicVariableToggleIsForward(this.data.variableId, !0), this.shared.setDynamicVariablePlayState(this.data.variableId, "Playing");else if (this.data.mode === "Stop" && t !== "Stopped") this.shared.setDynamicVariablePlayState(this.data.variableId, "Stopped");else if (this.data.mode === "Pause" && t !== "Paused") this.shared.setDynamicVariablePlayState(this.data.variableId, "Paused");else if (this.data.mode === "Restart") this.shared.setDynamicVariablePlayState(this.data.variableId, "Restarted");else if (this.data.mode === "Toggle") {
        var e = this.shared.getDynamicVariableToggleIsForward(this.data.variableId);
        t === "Playing" ? this.shared.setDynamicVariableToggleIsForward(this.data.variableId, e === void 0 ? !1 : !e) : (this.shared.setDynamicVariableToggleIsForward(this.data.variableId, !e), this.shared.setDynamicVariablePlayState(this.data.variableId, "Playing"));
      }
    }
  }, {
    key: "dispatch",
    value: function dispatch() {
      var _this346 = this;
      var t = this.data.delay,
        e = this.shared.getDynamicVariablePlayState(this.data.variableId);
      this.data.mode === "PlayPause" && e === "Playing" && (t = this.data.pauseDelay), t !== 0 ? (this.timeoutId && window.clearTimeout(this.timeoutId), this.timeoutId = window.setTimeout(function () {
        _this346.timeoutId = null, _this346.dispatchInner();
      }, t)) : this.dispatchInner();
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.timeoutId && window.clearTimeout(this.timeoutId);
    }
  }]);
  return ag;
}();
function Tt(n, t) {
  if (t === void 0) return !0;
  if (t.expression.length === 0) return !1;
  var e = C0(t.expression, n, "boolean");
  return t.negate ? !e : !!e;
}
function gr(n, t, e, r, i, s) {
  var o = {
      Audio: [],
      Video: [],
      Particles: [],
      Link: [],
      Destroy: [],
      Create: [],
      Reset: [],
      Transition: [],
      SwitchCamera: [],
      Animation: [],
      SceneTransition: [],
      SetVariable: [],
      DynamicVariablePlay: []
    },
    a = function a(l) {
      return function (_ref84) {
        var u = _ref84.id,
          c = _ref84.data;
        try {
          c.type === "Audio" && !(s instanceof jt) ? gn[n.type].includes("Audio") && o.Audio.push(new Ym(u, c, s, r, l)) : c.type === "Video" && !(s instanceof jt) ? gn[n.type].includes("Video") && o.Video.push(new lg(u, c, s, r, l)) : c.type === "Particles" ? gn[n.type].includes("Particles") && o.Particles.push(new Xm(c, e, r, l)) : c.type === "Link" ? gn[n.type].includes("Link") && o.Link.push(new Zx(c, i.controlsManager, r, l)) : c.type === "Create" ? gn[n.type].includes("Create") && o.Create.push(new cg(c, e, i.controlsManager, r, l)) : c.type === "Destroy" ? gn[n.type].includes("Destroy") && o.Destroy.push(new Qm(c, e, i.controlsManager, r, l)) : c.type === "Reset" ? gn[n.type].includes("Reset") && o.Reset.push(new Km(c, e, r, i, l)) : c.type === "Transition" ? gn[n.type].includes("Transition") && o.Transition.push(new rg(c, e, r, l)) : c.type === "SwitchCamera" ? gn[n.type].includes("SwitchCamera") && o.SwitchCamera.push(new ig(c, e, r, l)) : c.type === "SceneTransition" ? gn[n.type].includes("SceneTransition") && o.SceneTransition.push(new sg(c, e, i, r, l)) : c.type === "Animation" ? gn[n.type].includes("Animation") && o.Animation.push(new ng(c, e, i.animationControls, r, l)) : c.type === "SetVariable" ? gn[n.type].includes("SetVariable") && o.SetVariable.push(new og(c, e, r, l)) : c.type === "DynamicVariablePlay" ? gn[n.type].includes("DynamicVariablePlay") && o.DynamicVariablePlay.push(new ag(c, e, r, l)) : c.type === "Conditional" && gn[n.type].includes("Conditional") && (c.ifActions.forEach(a({
            expression: c.condition,
            negate: !1
          })), c.elseActions.forEach(a({
            expression: c.condition,
            negate: !0
          })));
        } catch (d) {
          !1 && console.log(d);
        }
      };
    };
  return t.forEach(a()), o;
}
function tr(n) {
  Object.values(n).forEach(function (t) {
    t.forEach(function (e) {
      (e instanceof Ym || e instanceof lg || e instanceof Xm || e instanceof ng || e instanceof rg || e instanceof cg || e instanceof Qm || e instanceof ig || e instanceof sg || e instanceof Km || e instanceof og || e instanceof ag) && e.dispose();
    });
  });
}
function VB(n, t) {
  var e;
  if ("material" in n) {
    var r = n.material;
    Array.isArray(r) ? e = n.material[0].layers.find(function (i) {
      return i.uuid === t;
    }) : e = n.material.layers.find(function (i) {
      return i.uuid === t;
    });
  }
  if (!!e) return e.color.texture.image.img instanceof HTMLVideoElement ? e.color.texture.image.img : void 0;
}
var UB = new Map(),
  ug = new Map(),
  Na = /*#__PURE__*/function () {
    function Na(t, e, r) {
      _classCallCheck(this, Na);
      this.data = e;
      this.delay = 0;
      this.status = "stopped";
      var i = e.layerId,
        s = e.loop,
        o = e.volume,
        a = e.delay;
      if (this.object = r, i === void 0) throw new Error("Missing property");
      var l = VB(r, i);
      l && (this.videoElement = l, this.videoElement.loop = s === 1 / 0, Md && (this.videoElement.autoplay = !0), o !== void 0 && (this.videoElement.volume = o)), a !== void 0 && (this.delay = a), ug.has(r.uuid) ? ug.get(r.uuid).push(this) : ug.set(r.uuid, [this]), UB.set(t, this), this.pause();
    }
    _createClass(Na, [{
      key: "mute",
      value: function mute() {
        !this.videoElement || (this.videoElement.muted = !0);
      }
    }, {
      key: "unMute",
      value: function unMute() {
        !this.videoElement || (this.videoElement.muted = !1);
      }
    }, {
      key: "play",
      value: function play(t) {
        var _this347 = this;
        if (!this.videoElement) return;
        var e = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        t ? (this.mute(), this.delay += 150) : e ? (this.mute(), window.setTimeout(function () {
          _this347.unMute();
        }, 100)) : this.unMute(), this.delayTimerId = window.setTimeout(function () {
          if (!_this347.videoElement) return;
          var r = _this347.videoElement.play();
          r !== void 0 && r.then(function (i) {}).catch(function (i) {
            _this347.play();
          }), _this347.clearDelay();
        }, this.delay), this.status = "playing";
      }
    }, {
      key: "clearDelay",
      value: function clearDelay() {
        this.delayTimerId && (clearTimeout(this.delayTimerId), delete this.delayTimerId);
      }
    }, {
      key: "pause",
      value: function pause() {
        !this.videoElement || (this.videoElement.pause(), this.status = "paused");
      }
    }, {
      key: "stop",
      value: function stop() {
        !this.videoElement || (this.videoElement.pause(), this.videoElement.currentTime = 0, this.status = "stopped", this.clearDelay());
      }
    }, {
      key: "playByToggle",
      value: function playByToggle() {
        this.data.toggle === "stop" ? this.status === "playing" ? this.stop() : (this.stop(), this.play()) : this.data.toggle === "pause" ? this.status === "playing" ? this.pause() : this.play() : (this.stop(), this.play());
      }
    }, {
      key: "dispose",
      value: function dispose() {
        !this.videoElement || (this.stop(), this.videoElement.muted = !0);
      }
    }]);
    return Na;
  }(),
  Rf = /*#__PURE__*/function () {
    function Rf(t) {
      _classCallCheck(this, Rf);
      this.data = t;
    }
    _createClass(Rf, [{
      key: "dispatch",
      value: function dispatch() {
        this.data.playVideo ? this.pauseVideo(this.data.playVideo) : this.data.object ? this.pauseAllVideosFromObject(this.data.object) : this.pauseAllVideos();
      }
    }, {
      key: "pauseVideo",
      value: function pauseVideo(t) {
        var _this348 = this;
        var e = UB.get(t);
        !e || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          e[_this348.data.interaction](), _this348.disposeDelay();
        }, this.data.delay)) : e[this.data.interaction]());
      }
    }, {
      key: "pauseAllVideosFromObject",
      value: function pauseAllVideosFromObject(t) {
        var _this349 = this;
        var e = ug.get(t);
        !(e !== null && e !== void 0 && e.length) || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          e.forEach(function (r) {
            return r[_this349.data.interaction]();
          }), _this349.disposeDelay();
        }, this.data.delay)) : e.forEach(function (r) {
          return r[_this349.data.interaction]();
        }));
      }
    }, {
      key: "pauseAllVideos",
      value: function pauseAllVideos() {
        var _this350 = this;
        var t = _toConsumableArray(ug.values());
        !t.length || (this.data.delay > 0 ? (this.disposeDelay(), this.timeoutId = window.setTimeout(function () {
          t.forEach(function (e) {
            e.forEach(function (r) {
              r[_this350.data.interaction]();
            });
          }), _this350.disposeDelay();
        }, this.data.delay)) : t.forEach(function (e) {
          e.forEach(function (r) {
            r[_this350.data.interaction]();
          });
        }));
      }
    }, {
      key: "disposeDelay",
      value: function disposeDelay() {
        clearTimeout(this.timeoutId), delete this.timeoutId;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        clearTimeout(this.timeoutId), delete this.timeoutId;
      }
    }]);
    return Rf;
  }(),
  lg = /*#__PURE__*/function () {
    function lg(t, e, r, i, s) {
      _classCallCheck(this, lg);
      this.data = e;
      this.shared = i;
      this.condition = s;
      if (e.interaction === "play") this.interaction = new Na(t, e, r);else if (e.interaction === "pause" || e.interaction === "stop") this.interaction = new Rf(e);else throw new Error("Missing property");
    }
    _createClass(lg, [{
      key: "dispatchBasic",
      value: function dispatchBasic() {
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.interaction instanceof Na ? this.interaction.playByToggle() : this.interaction.dispatch();
      }
    }, {
      key: "dispatchConditional",
      value: function dispatchConditional() {
        if (Tt(this.shared, this.condition) === !1) return !1;
        this.interaction instanceof Na ? this.interaction.play() : this.interaction.dispatch();
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.interaction.dispose();
      }
    }]);
    return lg;
  }();
var GB = function () {
  var n, t, e, r;
  function i(a) {
    var _t31;
    !n && !jB() && ((_t31 = t) === null || _t31 === void 0 ? void 0 : _t31.sharedGameControlGlobals.createdObjects.length) > 0 && (n = requestAnimationFrame(s)), a && (t = a, r = a.requestRender);
  }
  function s(a) {
    var l = e ? a - e : 0,
      u = t.sharedGameControlGlobals.createdObjects,
      c = t.sharedGameControlGlobals.nCreatedPerAction,
      d = u.length,
      h = 0;
    for (; h < d;) {
      var f = u[h];
      f.userData.createdTime === void 0 && (f.userData.createdTime = a), f.userData.lifetime === void 0 && f.userData.quantity === void 0 || f.userData.lifetime && a - f.userData.createdTime < f.userData.lifetime || f.userData.quantity && c[f.userData.actionId] <= f.userData.quantity ? (f.userData.velocity && (f.position.addScaledVector(f.userData.velocity, l / 1e3), f.updateMatrix(), r()), h++) : (c[f.userData.actionId] > f.userData.quantity && c[f.userData.actionId]--, u.splice(h, 1), f.removeFromParent(), t.sharedGameControlGlobals.rapierWorld && f.rigidBody ? (t.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle), t.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)) : (f.bvhGeometry = void 0, t.sharedGameControlGlobals.entitiesWithTransformAnim = t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(function (p) {
        return p.bvhGeometry !== void 0;
      })), d--, r());
    }
    n = h > 0 ? requestAnimationFrame(s) : void 0, e = h > 0 ? a : void 0;
  }
  function o() {
    jB() ? n && (cancelAnimationFrame(n), n = void 0, e = void 0) : i();
  }
  return (typeof document === "undefined" ? "undefined" : _typeof(document)) < "u" && document.addEventListener("visibilitychange", o), i;
}();
function jB() {
  return !!document && document.hidden;
}
var HB = new je(),
  xZ = new _(),
  bZ = new _(),
  cg = /*#__PURE__*/function () {
    function cg(t, e, r, i, s) {
      var _this351 = this;
      _classCallCheck(this, cg);
      this.data = t;
      this.page = e;
      this.controlsManager = r;
      this.shared = i;
      this.condition = s;
      this.intervalId = null;
      this.timeoutIdQueue = [];
      this.uniqueId = Se.generateUUID();
      this.dispatch = function () {
        if (Tt(_this351.shared, _this351.condition) === !1) return !1;
        _this351.data.delay ? _this351.timeoutIdQueue.push(window.setTimeout(_this351.dispatchInner, _this351.data.delay * 1e3)) : _this351.dispatchInner();
      };
      this.dispatchFromStart = function () {
        if (Tt(_this351.shared, _this351.condition) === !1) return !1;
        _this351.timeoutIdQueue.push(window.setTimeout(_this351.dispatchInner, _this351.data.delay * 1e3));
      };
      this.dispatchThrottled = Ow(this.dispatch, 1e3 / this.data.creationSpeed);
      this.dispatchStart = function () {
        _this351.intervalId === null && (_this351.intervalId = window.setInterval(_this351.dispatch, 1e3 / _this351.data.creationSpeed));
      };
      this.dispatchStop = function () {
        _this351.intervalId !== null && (window.clearInterval(_this351.intervalId), _this351.intervalId = null);
      };
      this.dispatchInner = function () {
        _this351.timeoutIdQueue.shift();
        var t = new Pr(_this351.object);
        if (t.playModeVisible = !0, t.expand(), _this351.data.coordinateSystem !== "world") {
          var _r64 = _this351.data.coordinateSystem,
            _i179 = _this351.page.scene.find(_r64);
          _i179 && (_i179.updateMatrixWorldSVD(), t.hiddenMatrix.copy(_i179.matrixWorldRigid));
        }
        t.position.fromArray(_this351.data.position), t.rotation.fromArray(_this351.data.rotation), t.updateMatrix(), _this351.page.add(t);
        var e = _this351.controlsManager.sharedGameControlGlobals;
        e.createdObjects.push(t), e.nCreatedPerAction[_this351.uniqueId] === void 0 ? e.nCreatedPerAction[_this351.uniqueId] = 1 : e.nCreatedPerAction[_this351.uniqueId]++, t.updateWorldMatrix(!0, !0), t.traverseObject(_this351.traverseObjectCB), GB(), _this351.controlsManager.requestRender();
      };
      this.traverseObjectCB = function (t) {
        var _t$rigidBody, _t$rigidBody2, _e$dataPatched$physic3;
        t.hasNonUniformScale && t.updateMatrixWorldSVD();
        var e;
        if (_this351.controlsManager.sharedGameControlGlobals.rapierWorld) {
          var _e$dataPatched$cloner;
          if (t instanceof Gi) {
            if (t.objectForSample) {
              if (t.objectForSample.dataPatched.physics.fusedBody) return;
              e = t.object;
            } else return t.object.dataPatched.physics.fusedBody === !0 && t.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
          } else if (t instanceof Pr) e = t.object;else if (e = t, (_e$dataPatched$cloner = e.dataPatched.cloner) !== null && _e$dataPatched$cloner !== void 0 && _e$dataPatched$cloner.hideBase) return !0;
        } else {
          if (t instanceof Gi) return;
          t instanceof Pr ? e = t.object : e = t;
        }
        _this351.data.destroy === "Time" ? t.userData.lifetime = _this351.data.lifetime * 1e3 : _this351.data.destroy === "Quantity" && (t.userData.quantity = _this351.data.destroyAfterQuantity, t.userData.actionId = _this351.uniqueId);
        var r = new _().fromArray(_this351.data.velocity),
          i = e.dataPatched;
        if (!(i.physics.enabled === "visibility" ? !i.visible : !i.physics.enabled) && (_this351.controlsManager.sharedGameControlGlobals.rapierWorld ? (_this351.controlsManager.addRigidBody(t, e, {
          fromCreate: !0,
          dynamic: _this351.data.dynamic
        }), _this351.data.destroy === "Collision" && ((_t$rigidBody = t.rigidBody) !== null && _t$rigidBody !== void 0 && _t$rigidBody.collider(0).setActiveEvents(1), t.userData.hasCollisionDestroy = !0), t.matrixWorld.decompose(xZ, HB, bZ), r.applyQuaternion(HB), _this351.data.velocity.some(function (s) {
          return s !== 0;
        }) && _this351.data.dynamic && ((_t$rigidBody2 = t.rigidBody) === null || _t$rigidBody2 === void 0 ? void 0 : _t$rigidBody2.setLinvel(r.divideScalar(_this351.controlsManager.pixelsPerMeter), !0))) : ("geometry" in t.object && _this351.controlsManager.addBoundsTree(t), _this351.data.velocity.some(function (s) {
          return s !== 0;
        }) && _this351.data.dynamic && (t.userData.velocity = r)), ((_e$dataPatched$physic3 = e.dataPatched.physics) === null || _e$dataPatched$physic3 === void 0 ? void 0 : _e$dataPatched$physic3.fusedBody) === !0)) return !0;
      };
      var o = this.page.scene.find(this.data.object);
      if (!o) throw new Error("Missing Property");
      if (this.object = o, this.data.coordinateSystem !== "world" && !this.page.scene.find(this.data.coordinateSystem)) throw new Error("Missing Property");
      GB(r);
    }
    _createClass(cg, [{
      key: "dispose",
      value: function dispose() {
        var _this$page;
        this.intervalId !== null && (window.clearInterval(this.intervalId), this.intervalId = null), this.timeoutIdQueue.forEach(function (t) {
          return window.clearTimeout(t);
        }), this.dispatchThrottled.cancel(), (_this$page = this.page).remove.apply(_this$page, _toConsumableArray(this.controlsManager.sharedGameControlGlobals.createdObjects)), this.controlsManager.sharedGameControlGlobals.createdObjects = [];
      }
    }]);
    return cg;
  }();
var dE = 200,
  lE = .02,
  cE = .3,
  SZ = 65,
  Lje = new _(),
  WB = new _(),
  qB = new _(),
  wZ = new _(),
  _n = new _(),
  kn = new _(),
  Ql = new _(),
  uE = new te(),
  YB = new te(),
  AZ = new te(),
  Bje = new te(),
  to = new je(),
  Fa = new je(),
  Ho = new Kt(0, 0, 0, "YXZ"),
  _Z = new _(1, 0, 0),
  ro = new _(0, 1, 0),
  EZ = new _(0, 0, 1),
  XB = new _(1, 1, 1),
  Nje = new Er(),
  TZ = 1,
  MZ = .025,
  CZ = 16e-6,
  QB = 12,
  PZ = 20,
  Hi = new xi(),
  Es = new Bt(),
  DZ = {
    type: "requestRender"
  },
  OZ = {
    type: "updateMatrix"
  },
  KB = Math.PI / 6,
  ob = /*#__PURE__*/function (_ir16) {
    _inherits(ob, _ir16);
    var _super299 = _createSuper(ob);
    function ob(e, r, i, s, o, a, l, u, c) {
      var _i$rotByTouch, _i$rotBy, _i$rotationMode, _i$moveMode, _i$speedTranslate, _i$speedRotate, _i$speedRotate2, _i$delayPos$, _i$delayPos$2, _i$delayRot$, _i$delayRot$2, _i$delayPosCamera, _i$delayRotCamera, _this352$gloabalPhysi, _this352$gloabalPhysi2, _i$alignToGround, _i$orientWith, _i$forwardDirection, _i$runMultiplier;
      var _this352;
      _classCallCheck(this, ob);
      _this352 = _super299.call(this);
      _this352.object = e;
      _this352.domElement = r;
      _this352.data = i;
      _this352.gloabalPhysics = s;
      _this352.controlsManager = o;
      _this352.cameraFollow = a;
      _this352.camera = l;
      _this352.page = u;
      _this352.sharedAssets = c;
      _this352.enableDamping = !0;
      _this352.hiddenMatrix0 = new te();
      _this352.target0 = new _();
      _this352.zoom0 = 1;
      _this352.rotForce = 1;
      _this352.moveForce = 1;
      _this352.pixelsPerMeter = dE;
      _this352.euler0 = new Kt(0, 0, 0, "YXZ");
      _this352.position0Cam = new _();
      _this352.quat0Cam = new je();
      _this352.scale0Cam = new _();
      _this352.hiddenMatrix0Cam = new te();
      _this352.threshEndTranslate = .01;
      _this352.threshEndRotate = 1e-8;
      _this352.threshEndRotVel = .005;
      _this352.collider = {
        type: "capsule",
        radius: 40,
        segment: new xi(new _(0, -40, 0), new _(0, 40, 0)),
        matrix: new te(),
        position: new _(),
        rotation: new je()
      };
      _this352.euler = new Kt(0, 0, 0, "YXZ");
      _this352.eulerDelta = new _();
      _this352.lastPosition = new _();
      _this352.lastCameraQuaternion = new je();
      _this352.lastCameraPosition = new _();
      _this352.PI_2 = Math.PI / 2;
      _this352.prevMouse = new N();
      _this352.velocityTarget = new _();
      _this352.velocity = new _();
      _this352.directionXZ = new _();
      _this352.rotVelocityStick = new _();
      _this352.rotVelocityTarget = new _();
      _this352.rotVelocity = new _();
      _this352.rotDirection = new _();
      _this352.nonColliderRotOffset = new te();
      _this352.nonColliderPosOffset = new te();
      _this352.firstPointerId = -1;
      _this352.rot = new _();
      _this352.path = [];
      _this352.movementState = {
        moveNegZ: 0,
        movePosZ: 0,
        moveNegX: 0,
        movePosX: 0,
        moveNegY: 0,
        movePosY: 0,
        rotPosX: 0,
        rotNegX: 0,
        rotPosY: 0,
        rotNegY: 0,
        jump: 0,
        run: 0
      };
      _this352.vrEulerYOffset = 0;
      _this352.onObject = !1;
      _this352.actionState = {};
      _this352.keyAssignments = [["moveNegZ", "W"], ["moveNegX", "A"], ["movePosZ", "S"], ["movePosX", "D"], ["rotPosX", "ArrowUp"], ["rotPosY", "ArrowLeft"], ["rotNegX", "ArrowDown"], ["rotNegY", "ArrowRight"], ["jump", " "]];
      _this352.collisionEnabled = !0;
      _this352.offsetMatrix = new te();
      _this352.objectToTarget = new _();
      _this352.objectToTarget0 = new _();
      _this352.objectToCamXZ = new _();
      _this352.objectToCamXZ0 = new _();
      _this352.targetToCamera = new _();
      _this352.targetToCamera0 = new _();
      _this352.cameraPolarAxis0 = new _();
      _this352.targetPos = new _();
      _this352.targetQuat = new je();
      _this352.lerpFactorPos = new _().setScalar(.3);
      _this352.lerpFactorPosStart = .3;
      _this352.lerpFactorPosEnd = .3;
      _this352.lerpFactorRotStart = .3;
      _this352.lerpFactorRotEnd = .3;
      _this352.lerpFactorPosCamera = .3;
      _this352.lerpFactorRotCamera = .3;
      _this352.objXZQuat = new je();
      _this352.objXZQuatInv = new je();
      _this352.objXZRotMat = new te();
      _this352.isFirstPerson = !1;
      _this352.didHit = !1;
      _this352.groundVelocity = new _();
      _this352.pushedVelocity = new _();
      _this352.groundYRotation = 0;
      _this352.objectRealQuat = new je();
      _this352.colliderWorldQuat = new je();
      _this352.groundNormal = new _();
      _this352.groundTilt = new je();
      _this352.groundTiltInv = new je();
      _this352.lastHitObj = null;
      _this352.isFirstFrame = !0;
      _this352.rotationAccumWhenOrientWithCamera = 0;
      _this352.navMeshPathDest = null;
      _this352.position = new _();
      _this352.quaternion = new je();
      _this352.scale = new _();
      _this352.initialAction = !0;
      _this352.onPointerDown = function (e) {
        e.target !== _this352.domElement || _this352.firstPointerId !== -1 || (_this352.firstPointerId = e.pointerId, _this352.domElement.ownerDocument.addEventListener("pointermove", _this352.onPointerMove), _this352.domElement.ownerDocument.addEventListener("pointerup", _this352.onPointerUp), _this352.rotBy !== "keys" && !Si && (!Iw || Rw >= 15.5) && _this352.domElement.requestPointerLock(), _this352.prevMouse.set(e.clientX, e.clientY));
      };
      _this352.onPointerUp = function (e) {
        _this352.firstPointerId = -1, _this352.domElement.ownerDocument.removeEventListener("pointermove", _this352.onPointerMove), _this352.domElement.ownerDocument.removeEventListener("pointerup", _this352.onPointerUp), e.pointerType === "mouse" && _this352.domElement.ownerDocument.exitPointerLock();
      };
      _this352.onPointerMove = function (e) {
        if (e.pointerId !== _this352.firstPointerId) return;
        var r = e.clientX - _this352.prevMouse.x,
          i = e.clientY - _this352.prevMouse.y;
        _this352.prevMouse.set(e.clientX, e.clientY), e.pointerType === "mouse" && _this352.rotBy !== "keys" && (Iw && Rw < 15.5 && !Si ? (_this352.eulerDelta.y = -r * _this352.mouseOrbitSensitivity, _this352.eulerDelta.x = -i * _this352.mouseOrbitSensitivity) : (_this352.eulerDelta.y = -e.movementX * _this352.mouseOrbitSensitivity, _this352.eulerDelta.x = -e.movementY * _this352.mouseOrbitSensitivity)), e.pointerType !== "mouse" && _this352.rotByTouch === "drag" && (_this352.eulerDelta.y = -r * _this352.mouseOrbitSensitivity * 5, _this352.eulerDelta.x = -i * _this352.mouseOrbitSensitivity * 5), _this352.controlsManager.requestRender();
      };
      _this352.onPointerlockChange = function (e) {
        _this352.domElement.ownerDocument.pointerLockElement === _this352.domElement ? ob.isLocked = !0 : ob.isLocked = !1;
      };
      _this352.onPointerlockError = function () {
        console.error("SPE.GameControls: Unable to use Pointer Lock API");
      };
      _this352.handleVisibilityChange = function () {
        var _document;
        if ((_document = document) !== null && _document !== void 0 && _document.hidden) for (var _e69 in _this352.movementState) _this352.movementState[_e69] = 0;
      };
      _this352.onKeyDown = function (e) {
        !(e.target instanceof HTMLInputElement) && (e.code === "ArrowLeft" || e.code === "ArrowUp" || e.code === "ArrowRight" || e.code === "ArrowDown" || e.code === "Space") && e.preventDefault();
        var _iterator148 = _createForOfIteratorHelper(_this352.keyAssignments),
          _step148;
        try {
          for (_iterator148.s(); !(_step148 = _iterator148.n()).done;) {
            var _r65 = _step148.value;
            if (e.key.toUpperCase() === _r65[1] || e.key === _r65[1]) {
              _this352.movementState[_r65[0]] = 1;
              break;
            }
          }
        } catch (err) {
          _iterator148.e(err);
        } finally {
          _iterator148.f();
        }
        _this352.controlsManager.requestRender();
      };
      _this352.onKeyUp = function (e) {
        var _iterator149 = _createForOfIteratorHelper(_this352.keyAssignments),
          _step149;
        try {
          for (_iterator149.s(); !(_step149 = _iterator149.n()).done;) {
            var _r66 = _step149.value;
            if (e.key.toUpperCase() === _r66[1] || e.key === _r66[1] || e.code.slice(3, e.code.length).toUpperCase() === _r66[1]) {
              _this352.movementState[_r66[0]] = 0;
              break;
            }
          }
        } catch (err) {
          _iterator149.e(err);
        } finally {
          _iterator149.f();
        }
      };
      _this352.copyVRGamePadValues = function (e, r) {
        for (var _i180 = 2; _i180 < 4; _i180++) {
          var _s119 = e.axes[_i180];
          r === 0 ? _i180 === 2 ? _this352.movementState.movePosX = _s119 : _this352.movementState.movePosZ = _s119 : (e.buttons[3].pressed ? _this352.movementState.jump = 1 : _this352.movementState.jump = 0, _i180 === 2 ? (Math.abs(_this352.movementState.rotPosY) < .3 && Math.abs(_s119) >= .3 && (_this352.vrEulerYOffset += _s119 < 0 ? 1 : -1), _this352.movementState.rotPosY = _s119) : _this352.moveMode === "fly" && (_this352.movementState.moveNegY = _s119));
        }
      };
      _this352.sharedGameControlGlobals = o.sharedGameControlGlobals, e === l && (_this352.isFirstPerson = !0), _this352.hiddenMatrix0.copy(_this352.object.hiddenMatrix), _this352.object.parent ? _this352.object.hiddenMatrix.copy(_this352.object.parent.matrixWorld).invert() : _this352.object.hiddenMatrix.identity(), _this352.object.matrix.copy(_this352.object.matrixWorld), _this352.object.matrix.decompose(_this352.position, _this352.quaternion, _this352.scale), _this352.euler0.setFromQuaternion(_this352.quaternion, "YXZ");
      var d = _this352.euler0.clone(),
        h = d.y;
      if (_this352.objectRealQuat.copy(_this352.quaternion), d.y = 0, _this352.quaternion.setFromEuler(d), _this352.objXZQuat.copy(_this352.quaternion), _this352.objXZQuatInv.copy(_this352.objXZQuat).invert(), _this352.objXZRotMat.makeRotationFromQuaternion(_this352.quaternion), d.set(0, h, 0), _this352.quaternion.setFromEuler(d), _this352.rot.setFromEuler(d), _this352.object.matrixAutoUpdate = !1, (_this352.isFirstPerson || _this352.cameraFollow === !0) && (_this352.target0.copy(_this352.camera.getTarget()), _this352.zoom0 = _this352.camera.zoom), _this352.cameraFollow === !0) {
        var _this352$camera;
        _this352.position0Cam.copy(_this352.camera.position), _this352.quat0Cam.copy(_this352.camera.quaternion), _this352.scale0Cam.copy(_this352.camera.scale), _this352.hiddenMatrix0Cam.copy(_this352.camera.hiddenMatrix), _this352.camera.parent ? (_this352.camera.hiddenMatrix.copy((_this352$camera = _this352.camera) === null || _this352$camera === void 0 ? void 0 : _this352$camera.parent.matrixWorld), _this352.camera.matrix.copy(_this352.camera.matrixWorld)) : _this352.camera.hiddenMatrix.identity(), _this352.camera.matrix.copy(_this352.camera.matrixWorld), _this352.camera.matrix.decompose(_this352.camera.position, _this352.camera.quaternion, _this352.camera.scale), _this352.camera.matrixAutoUpdate = !1, _this352.offsetMatrix.copy(_this352.object.matrix).invert().multiply(_this352.camera.matrix);
        var g = new _(0, 0, -1).applyQuaternion(_this352.camera.quaternion),
          y = new _().subVectors(_this352.position, _this352.camera.position);
        _this352.objectToCamXZ.copy(y), _this352.objectToCamXZ.y = 0, _this352.objectToCamXZ0.copy(_this352.objectToCamXZ);
        var v, x;
        Math.abs(g.y) < 1e-6 ? (y.y = 0, g.y = 0, x = y.projectOnVector(g)) : y.y / g.y > 0 ? x = g.multiplyScalar(y.y / g.y) : x = g.multiplyScalar(y.length()), _this352.targetToCamera0.copy(x).negate(), v = _this352.camera.position.clone().add(x), _this352.objectToTarget0.subVectors(v, _this352.position);
        var S = new Kt().setFromQuaternion(_this352.camera.quaternion, "YXZ");
        _this352.cameraPolarOffset = -S.x, S.x = 0, S.z = 0, S.y -= Math.PI / 2, _this352.cameraPolarAxis0.set(0, 0, -1).applyEuler(S);
      }
      if (_this352.object instanceof hr && (_this352.object.matrixAutoUpdate = !1), _this352.euler.setFromQuaternion(_this352.quaternion, "YXZ"), _this352.rotByTouch = (_i$rotByTouch = i.rotByTouch) !== null && _i$rotByTouch !== void 0 ? _i$rotByTouch : "joystick", _this352.rotBy = (_i$rotBy = i.rotBy) !== null && _i$rotBy !== void 0 ? _i$rotBy : "keys", _this352.rotationMode = (_i$rotationMode = i.rotationMode) !== null && _i$rotationMode !== void 0 ? _i$rotationMode : "normal", _this352.moveMode = (_i$moveMode = i.moveMode) !== null && _i$moveMode !== void 0 ? _i$moveMode : "walk", _this352.collisionEnabled = i.collisionEnabled, _this352.speedTranslate = ((_i$speedTranslate = i.speedTranslate) !== null && _i$speedTranslate !== void 0 ? _i$speedTranslate : 250) * TZ, _this352.speedOrbit = ((_i$speedRotate = i.speedRotate) !== null && _i$speedRotate !== void 0 ? _i$speedRotate : 100) * MZ, _this352.mouseOrbitSensitivity = ((_i$speedRotate2 = i.speedRotate) !== null && _i$speedRotate2 !== void 0 ? _i$speedRotate2 : 100) * CZ, _this352.keyAssignments = i.keyAssignments.map(function (g) {
        var y = [g[0], g[1]];
        return y[1] === "\u25B2" ? y[1] = "ArrowUp" : y[1] === "\u25C0" ? y[1] = "ArrowLeft" : y[1] === "\u25BC" ? y[1] = "ArrowDown" : y[1] === "\u25B6" ? y[1] = "ArrowRight" : y[1] === "\u21E7" ? y[1] = "Shift" : y[1] === "\u21B5" ? y[1] = "Enter" : y[1] === "Space" ? y[1] = " " : y[1] === "\u2318" ? y[1] = "Meta" : y[1] === "Ctrl" ? y[1] = "Control" : y[1] === "Esc" && (y[1] = "Escape"), y;
      }), i.rotBy === "mouse") {
        var _g49;
        _g49 = _this352.keyAssignments.findIndex(function (y) {
          return y[0] === "rotNegX";
        }), _g49 !== -1 && (_this352.keyAssignments[_g49][1] = ""), _g49 = _this352.keyAssignments.findIndex(function (y) {
          return y[0] === "rotPosX";
        }), _g49 !== -1 && (_this352.keyAssignments[_g49][1] = ""), _g49 = _this352.keyAssignments.findIndex(function (y) {
          return y[0] === "rotPosY";
        }), _g49 !== -1 && (_this352.keyAssignments[_g49][1] = ""), _g49 = _this352.keyAssignments.findIndex(function (y) {
          return y[0] === "rotNegY";
        }), _g49 !== -1 && (_this352.keyAssignments[_g49][1] = "");
      }
      _this352.lerpFactorPosStart = 1 - Math.pow(.02, 1 / (((_i$delayPos$ = i.delayPos[0]) !== null && _i$delayPos$ !== void 0 ? _i$delayPos$ : .3) * 60)), _this352.lerpFactorPosEnd = 1 - Math.pow(.02, 1 / (((_i$delayPos$2 = i.delayPos[1]) !== null && _i$delayPos$2 !== void 0 ? _i$delayPos$2 : .3) * 60)), _this352.lerpFactorPos.setScalar(_this352.lerpFactorPosStart), _this352.lerpFactorRotStart = 1 - Math.pow(.02, 1 / (((_i$delayRot$ = i.delayRot[0]) !== null && _i$delayRot$ !== void 0 ? _i$delayRot$ : .3) * 60)), _this352.lerpFactorRotEnd = 1 - Math.pow(.02, 1 / (((_i$delayRot$2 = i.delayRot[1]) !== null && _i$delayRot$2 !== void 0 ? _i$delayRot$2 : .3) * 60)), _this352.lerpFactorPosCamera = 1 - Math.pow(.02, 1 / (((_i$delayPosCamera = i.delayPosCamera) !== null && _i$delayPosCamera !== void 0 ? _i$delayPosCamera : .3) * 60)), _this352.lerpFactorRotCamera = 1 - Math.pow(.02, 1 / (((_i$delayRotCamera = i.delayRotCamera) !== null && _i$delayRotCamera !== void 0 ? _i$delayRotCamera : .3) * 60)), _this352.gravity = ((_this352$gloabalPhysi = _this352.gloabalPhysics.gravity) !== null && _this352$gloabalPhysi !== void 0 ? _this352$gloabalPhysi : wl.defaultData.gravity) * QB, _this352.usePhysics = (_this352$gloabalPhysi2 = _this352.gloabalPhysics.usePhysics) !== null && _this352$gloabalPhysi2 !== void 0 ? _this352$gloabalPhysi2 : wl.defaultData.usePhysics, _this352.jumpPower = i.jumpPower * PZ, _this352.resetYPosition = _this352.position.y + Math.abs(i.resetYPosition) * (_this352.gravity > 0 ? 1 : -1), _this352.alignToGround = (_i$alignToGround = i.alignToGround) !== null && _i$alignToGround !== void 0 ? _i$alignToGround : !1, _this352.orientMode = i.autoOrientMove ? i.orientMode : "none", _this352.orientWith = (_i$orientWith = i.orientWith) !== null && _i$orientWith !== void 0 ? _i$orientWith : Qd.defaultDataThirdPerson.orientWith, _this352.slopeThresh = SZ * Math.PI / 180, i.collider.type === "capsule" ? (_this352.collider.radius = i.collider.radius, _this352.collider.segment.start.y = i.collider.height / 2 - i.collider.radius, _this352.collider.segment.end.y = -_this352.collider.segment.start.y, _this352.offset = i.collider.height * lE / _this352.pixelsPerMeter, _this352.stepThresh = i.collider.height * cE / _this352.pixelsPerMeter, _this352.colliderHeight = i.collider.height) : i.collider.type === "sphere" ? (_this352.collider.radius = i.collider.radius, _this352.collider.segment.start.y = 0, _this352.collider.segment.end.y = 0, _this352.offset = 2 * i.collider.radius * lE / _this352.pixelsPerMeter, _this352.stepThresh = 2 * i.collider.radius * cE / _this352.pixelsPerMeter, _this352.colliderHeight = i.collider.radius * 2) : (_this352.offset = i.collider.height * lE / _this352.pixelsPerMeter, _this352.stepThresh = i.collider.height * cE / _this352.pixelsPerMeter, _this352.colliderHeight = i.collider.height), _this352.collider.type = i.collider.type;
      var f = new _().fromArray(i.collider.position),
        p = new je().setFromEuler(new Kt().fromArray([].concat(_toConsumableArray(i.collider.rotation), ["XYZ"])));
      _this352.collider.position.copy(f).multiply(_this352.scale), _this352.collider.rotation.copy(p), _this352.collider.matrix.compose(f, p, XB), i.cameraXAxis !== void 0 && (_this352.cameraXAxis = i.cameraXAxis, _this352.cameraYAxis = i.cameraYAxis, _this352.minPolarAngle = i.cameraRotXLimits[0], _this352.maxPolarAngle = i.cameraRotXLimits[1], _this352.minAzimuthAngleRel = i.cameraRotYLimits[0], _this352.maxAzimuthAngleRel = i.cameraRotYLimits[1]), _this352.forwardDir = (_i$forwardDirection = i.forwardDirection) !== null && _i$forwardDirection !== void 0 ? _i$forwardDirection : "-z", _this352.runMultiplier = (_i$runMultiplier = i.runMultiplier) !== null && _i$runMultiplier !== void 0 ? _i$runMultiplier : 2;
      var m = i.navmesh.destinationHelperRadius * 2;
      if (m > 0) {
        var _g50 = new Re();
        _g50.push({
          fi: 0,
          data: _objectSpread(_objectSpread({}, Ir.defaultData("light", "phong")), {}, {
            alpha: 0
          }),
          id: "layer1"
        }), _g50.push({
          fi: 0,
          data: _objectSpread(_objectSpread({}, Ir.defaultData("color")), {}, {
            color: i.navmesh.destinationHelperColor,
            alpha: i.navmesh.destinationHelperColor.a
          }),
          id: "layer2"
        });
        var _y56 = new Pa({
          layers: _g50
        }, {
          scene: _this352.page.scene,
          shared: _this352.sharedAssets
        });
        _this352.navMeshPathDest = new rr(m0.create({
          parameters: {
            width: m,
            height: m / 10,
            hollow: .7
          }
        }), _y56), _this352.navMeshPathDest.material.userData.opacity0 = i.navmesh.destinationHelperColor.a;
      }
      _this352.activate();
      return _this352;
    }
    _createClass(ob, [{
      key: "reset",
      value: function reset() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        if (this.object.hiddenMatrix.copy(this.hiddenMatrix0), e) {
          this.object.updateMatrix(), this.object.updateMatrixWorld(), this.object.matrix.copy(this.object.matrixWorld), this.object.matrix.decompose(this.position, this.quaternion, this.scale), this.object.parent ? this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert() : this.object.hiddenMatrix.identity();
          var r = new Kt().setFromQuaternion(this.quaternion, "YXZ"),
            _i181 = r.y;
          this.objectRealQuat.copy(this.quaternion), r.y = 0, this.quaternion.setFromEuler(r), this.objXZQuat.copy(this.quaternion), this.objXZQuatInv.copy(this.objXZQuat).invert(), this.objXZRotMat.makeRotationFromQuaternion(this.quaternion), r.set(0, _i181, 0), this.quaternion.setFromEuler(r), this.rot.setFromEuler(r), this.euler.setFromQuaternion(this.quaternion, "YXZ"), this.velocityTarget.set(0, 0, 0), this.velocity.set(0, 0, 0);
        } else this.object instanceof hr ? this.object.matrixAutoUpdate = !0 : this.object.updateMatrix();
        this.cameraFollow === !0 && (this.camera.quaternion.copy(this.quat0Cam), this.camera.position.copy(this.position0Cam), this.camera.scale.copy(this.scale0Cam), this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam), this.camera.matrixAutoUpdate = !0), this.controlsManager.requestRender();
      }
    }, {
      key: "activate",
      value: function activate() {
        this.instantiateActions(), this.domElement.ownerDocument.addEventListener("pointerdown", this.onPointerDown), this.domElement.ownerDocument.addEventListener("keydown", this.onKeyDown), this.domElement.ownerDocument.addEventListener("keyup", this.onKeyUp), this.domElement.ownerDocument.addEventListener("pointerlockchange", this.onPointerlockChange), this.domElement.ownerDocument.addEventListener("pointerlockerror", this.onPointerlockError), this.domElement.ownerDocument.addEventListener("visibilitychange", this.handleVisibilityChange);
      }
    }, {
      key: "deactivate",
      value: function deactivate() {
        this.disposeActions(), this.domElement.ownerDocument.removeEventListener("pointerdown", this.onPointerDown), this.domElement.ownerDocument.removeEventListener("keydown", this.onKeyDown), this.domElement.ownerDocument.removeEventListener("keyup", this.onKeyUp), this.domElement.ownerDocument.removeEventListener("pointerlockchange", this.onPointerlockChange), this.domElement.ownerDocument.removeEventListener("pointerlockerror", this.onPointerlockError), this.domElement.ownerDocument.removeEventListener("visibilitychange", this.handleVisibilityChange);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this$navMeshPathDest;
        this.deactivate(), ((_this$navMeshPathDest = this.navMeshPathDest) === null || _this$navMeshPathDest === void 0 ? void 0 : _this$navMeshPathDest.parent) && this.page.remove(this.navMeshPathDest);
      }
    }, {
      key: "instantiateActions",
      value: function instantiateActions() {
        var _this353 = this;
        var e = this.data,
          r = this.sharedAssets;
        e.gameActions !== void 0 && (this.actions = {}, Xd.list.forEach(function (i) {
          _this353.actions[i] = gr(_objectSpread(_objectSpread({}, e), {}, {
            disabled: !1,
            type: "GameControl"
          }), e.gameActions[i], _this353.page, r, _this353.controlsManager.eventManager, _this353.object);
        })), this.dispatchStopEvent("move"), this.dispatchStopEvent("run"), this.dispatchStopEvent("jump"), this.dispatchStartEvent("idle"), this.initialAction && (this.initialAction = !1);
      }
    }, {
      key: "disposeActions",
      value: function disposeActions() {
        this.initialAction = !1, this.dispatchStopEvent("idle"), this.dispatchStopEvent("move"), this.dispatchStopEvent("run"), this.dispatchStopEvent("jump"), tr(this.actions.idle), tr(this.actions.move), tr(this.actions.run), tr(this.actions.jump);
      }
    }, {
      key: "dispatchStartEvent",
      value: function dispatchStartEvent(e) {
        var _this354 = this;
        this.actions[e] !== void 0 && (this.actionState[e] || (this.actionState[e] = !0, this.actions[e].Transition.forEach(function (r) {
          r.play();
        }), this.actions[e].Animation.forEach(function (r) {
          r.play(_this354.initialAction === !1);
        }), this.actions[e].Create.forEach(function (r) {
          r.dispatchStart();
        }), this.actions[e].Audio.forEach(function (r) {
          r.dispatchGameControl("start");
        }), this.actions[e].Particles.forEach(function (r) {
          r.dispatchGameControl("start");
        })));
      }
    }, {
      key: "dispatchStopEvent",
      value: function dispatchStopEvent(e) {
        var _this355 = this;
        this.actions[e] !== void 0 && (!this.actionState[e] || (this.actionState[e] = !1, this.actions[e].Transition.forEach(function (r) {
          r.stop(), r.object.currentState !== null && r.object.changeSelectedState(null, {
            scene: _this355.page.scene,
            shared: _this355.sharedAssets
          });
        }), this.actions[e].Create.forEach(function (r) {
          r.dispatchStop();
        }), this.actions[e].Audio.forEach(function (r) {
          r.dispatchGameControl("stop");
        }), this.actions[e].Particles.forEach(function (r) {
          r.dispatchGameControl("stop");
        })));
      }
    }, {
      key: "colliderWorldPosition",
      get: function get() {
        return _n.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position);
      }
    }, {
      key: "update",
      value: function update(e, r, i) {
        var _this$navMeshPathDest2;
        if (this.gravity < 0 ? this.position.y < this.resetYPosition : this.position.y > this.resetYPosition) return this.reset(!0), !0;
        this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);
        var s = (this.isFirstFrame ? 16.6 : e) / 1e3;
        this.isFirstFrame && (this.isFirstFrame = !1);
        var o = s * 60,
          a = !1;
        if (this.usePhysics && this.collisionEnabled) {
          var _this$object$rigidBod;
          var u = kn.set(0, (this.velocity.y === 0 ? this.pixelsPerMeter * Math.max(Math.abs(this.gravity) / (10 * QB), 1) * (this.gravity > 0 ? 1 : -1) : this.velocity.y) * s, 0).divideScalar(this.pixelsPerMeter),
            c = this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter), this.colliderWorldQuat, u, (_this$object$rigidBod = this.object.rigidBody) === null || _this$object$rigidBod === void 0 ? void 0 : _this$object$rigidBod.collider(0).shape, 1, !1, 16, void 0, void 0, this.object.rigidBody);
          if (c) {
            var _c$collider$parent;
            this.onObject = !0, this.groundNormal.set(c.normal2.x, c.normal2.y, c.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(), this.alignToGround && this.groundTiltAdjustment(this.groundNormal), Math.acos(this.groundNormal.y) < this.slopeThresh && (a = !0), ((_c$collider$parent = c.collider.parent()) === null || _c$collider$parent === void 0 ? void 0 : _c$collider$parent.bodyType()) === 0 && Math.acos(this.groundNormal.y) * (180 / Math.PI) > 45 && (this.onObject = !1);
            var d = c.collider.parent();
            this.groundYRotation = 0, this.groundVelocity.set(0, 0, 0);
            var _iterator150 = _createForOfIteratorHelper(this.sharedGameControlGlobals.entitiesWithTransformAnim),
              _step150;
            try {
              for (_iterator150.s(); !(_step150 = _iterator150.n()).done;) {
                var _h99 = _step150.value;
                if (_h99.rigidBody === d && _h99.userData.isFollowingObj !== this.object.uuid) {
                  (_h99.hasNonUniformScale ? _h99.matrixWorldRigid : _h99.matrixWorld).decompose(_n, Fa, kn), this.groundVelocity.subVectors(_n, _h99.prevT), this.object.getWorldPosition(kn).add(this.collider.position).sub(_n), this.groundYRotation = Ho.setFromQuaternion(Fa).y - _h99.prevR.y, Ql.copy(kn).applyAxisAngle(ro, this.groundYRotation), this.groundVelocity.add(Ql.sub(kn)).divideScalar(s);
                  break;
                }
              }
            } catch (err) {
              _iterator150.e(err);
            } finally {
              _iterator150.f();
            }
          } else this.onObject = !1;
        }
        if (this.moveMode === "walk" && this.collisionEnabled && (this.movementState.jump === 1 && this.onObject && (this.velocityTarget.y = this.jumpPower, this.movementState.jump = 0, this.dispatchStopEvent("idle"), this.dispatchStopEvent("move"), this.dispatchStopEvent("run"), this.dispatchStopEvent("jump"), this.dispatchStartEvent("jump"), this.onObject = !1), this.onObject ? this.velocityTarget.y /= 2 : this.velocityTarget.y += this.gravity * o), this.moveMode === "fly" && (this.velocityTarget.y = (this.movementState.movePosY - this.movementState.moveNegY) * this.speedTranslate), this.directionXZ.z = this.movementState.movePosZ - this.movementState.moveNegZ, this.directionXZ.x = this.movementState.movePosX - this.movementState.moveNegX, this.forwardDir === "+z" && this.directionXZ.multiplyScalar(-1), this.directionXZ.manhattanLength() > 0 && (this.path = []), this.navMeshPathDest) {
          var _u60 = this.navMeshPathDest.material;
          if (this.moveMode === "walk" && this.path.length > 1) {
            this.navMeshPathDest.position.copy(this.path[this.path.length - 1]), this.navMeshPathDest.parent || this.page.add(this.navMeshPathDest);
            var _c45 = _n.subVectors(this.path[1], this.position),
              _d60 = kn.subVectors(this.path[1], this.path[0]);
            _c45.dot(_d60) < 0 ? this.path.shift() : (this.directionXZ.x = _d60.x, this.directionXZ.z = _d60.z), _u60.opacity = _u60.userData.opacity0;
          } else _u60.opacity -= .05 * _u60.userData.opacity0, this.navMeshPathDest.material.opacity <= 0 && this.navMeshPathDest.parent && this.page.remove(this.navMeshPathDest);
        }
        this.directionXZ.normalize(), this.movementState.run ? this.moveForce = this.runMultiplier : this.moveForce = 1, this.velocityTarget.z = this.directionXZ.z * this.speedTranslate * this.moveForce, this.velocityTarget.x = this.directionXZ.x * this.speedTranslate * this.moveForce, (this.moveMode === "walk" ? this.velocityTarget.x + this.velocityTarget.z === 0 : this.velocityTarget.manhattanLength() === 0) ? this.lerpFactorPos.setScalar(this.lerpFactorPosEnd) : this.lerpFactorPos.setScalar(this.lerpFactorPosStart), this.moveMode === "walk" && (this.lerpFactorPos.y = 1), this.didHit === !1 && this.pushedVelocity.manhattanLength() === 0 || this.usePhysics === !1 ? (this.velocity.x += (this.velocityTarget.x - this.velocity.x) * (1 - Math.pow(1 - this.lerpFactorPos.x, o)), this.velocity.y += (this.velocityTarget.y - this.velocity.y) * (1 - Math.pow(1 - this.lerpFactorPos.y, o)), this.velocity.z += (this.velocityTarget.z - this.velocity.z) * (1 - Math.pow(1 - this.lerpFactorPos.z, o))) : this.velocity.copy(this.velocityTarget), (this.moveMode === "walk" ? Math.pow(this.velocity.x, 2) + Math.pow(this.velocity.z, 2) < this.speedTranslate : this.velocity.lengthSq() < this.speedTranslate) ? (this.dispatchStopEvent("move"), this.dispatchStopEvent("run"), this.onObject && (this.dispatchStopEvent("jump"), this.dispatchStartEvent("idle"))) : (this.dispatchStopEvent("idle"), this.onObject && (this.dispatchStopEvent("jump"), this.movementState.run ? (this.dispatchStopEvent("move"), this.dispatchStartEvent("run")) : (this.dispatchStopEvent("run"), this.dispatchStartEvent("move"))));
        var l = wZ.copy(this.velocity);
        if (this.orientMode !== "none" && this.isFirstPerson === !1) {
          var _u61 = kn.copy(l);
          _u61.y = 0, l.set(0, l.y, _u61.length() * (this.forwardDir === "+z" ? 1 : -1));
        }
        if (this.directionXZ.manhattanLength() > 0 && this.orientMode !== "none") if (this.orientWith === "camera" && this.path.length <= 1) {
          var _u62 = _n;
          this.camera.getWorldDirection(_u62);
          var _c46 = Ql.copy(ro).multiplyScalar(_u62.dot(ro));
          _u62.sub(_c46);
          var _d61 = kn.copy(this.directionXZ);
          _d61.x *= -1, this.rot.y = _u62.angleTo(_d61) * (_u62.cross(_d61).y > 0 ? -1 : 1) + this.rotationAccumWhenOrientWithCamera;
        } else this.rot.y = (this.path.length > 1 ? 0 : this.euler.y) + Math.atan2(-this.directionXZ.z, this.directionXZ.x) + Math.PI / 2 * (this.forwardDir === "+z" ? 1 : -1);
        if (Ho.setFromVector3(this.rot), this.moveMode === "walk" && (Ho.x = 0), l.applyEuler(Ho), a && (Fa.setFromUnitVectors(ro, this.groundNormal), l.applyQuaternion(Fa)), i) {
          var _u63 = Ho.set(0, this.vrEulerYOffset * KB, 0);
          i.applyEuler(_u63), l.x += i.x, l.z += i.z, this.nonColliderPosOffset.elements[13] += i.y * s;
        }
        if (this.usePhysics === !0) {
          var _u64 = kn;
          this.pushedVelocity.set(0, 0, 0);
          var _iterator151 = _createForOfIteratorHelper(this.sharedGameControlGlobals.entitiesWithTransformAnim),
            _step151;
          try {
            for (_iterator151.s(); !(_step151 = _iterator151.n()).done;) {
              var _c48 = _step151.value;
              var _d62 = Ql.setFromMatrixPosition(_c48.matrixWorld).sub(_c48.prevT).divideScalar(s).divideScalar(this.pixelsPerMeter),
                _h100 = _c48.rigidBody.collider(0).castCollider(_d62, this.object.rigidBody.collider(0), _n.copy(l).divideScalar(this.pixelsPerMeter), s, !1);
              _d62.multiplyScalar(this.pixelsPerMeter);
              var f = ut.is(_c48) ? _c48 : _c48.object;
              if (_h100 !== null && this.lastHitObj !== f) {
                var p = void 0;
                _c48 instanceof Pr && (p = _c48);
                var m = this.sharedGameControlGlobals.entityToCollisionEvents[f.uuid];
                if (m) {
                  var _iterator152 = _createForOfIteratorHelper(m),
                    _step152;
                  try {
                    for (_iterator152.s(); !(_step152 = _iterator152.n()).done;) {
                      var g = _step152.value;
                      g.data.target === "character" && (g.dispatch(p), f.dispatchEvent(ab));
                    }
                  } catch (err) {
                    _iterator152.e(err);
                  } finally {
                    _iterator152.f();
                  }
                }
                this.lastHitObj = f;
              }
              if (_h100 !== null) {
                this.pushedVelocity.copy(_d62), _u64.copy(_h100.normal1).applyQuaternion(_c48.quaternion);
                break;
              }
            }
          } catch (err) {
            _iterator151.e(err);
          } finally {
            _iterator151.f();
          }
          if (this.pushedVelocity.manhattanLength() !== 0) {
            var _c47 = _u64.dot(l);
            _c47 < 0 && l.addScaledVector(_u64, -_c47), l.add(this.pushedVelocity);
          } else l.add(this.groundVelocity);
        }
        if (this.rotDirection.y = Number(this.movementState.rotPosY) - Number(this.movementState.rotNegY), this.rotDirection.x = Number(this.movementState.rotPosX) - Number(this.movementState.rotNegX), this.rotDirection.normalize(), this.rotationMode === "normal" && (this.movementState.rotPosX || this.movementState.rotNegX) || this.rotationMode === "steer" && (this.movementState.rotPosX || this.movementState.rotNegX) && (this.movementState.movePosZ || this.movementState.moveNegZ || this.moveMode === "walk") ? this.rotVelocityStick.x = -this.rotDirection.x * this.speedOrbit * this.rotForce : this.rotVelocityStick.x = 0, this.rotationMode === "normal" && (this.movementState.rotPosY || this.movementState.rotNegY) || this.rotationMode === "steer" && (this.movementState.rotPosY || this.movementState.rotNegY) && (this.movementState.movePosZ || this.movementState.moveNegZ) ? this.rotVelocityStick.y = -this.rotDirection.y * this.speedOrbit * this.rotForce : this.rotVelocityStick.y = 0, this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(s), this.rotVelocityStick), this.rotVelocityTarget.manhattanLength() === 0 ? this.rotVelocity.lerp(this.rotVelocityTarget, 1 - Math.pow(1 - this.lerpFactorRotEnd, o)) : this.rotVelocity.lerp(this.rotVelocityTarget, 1 - Math.pow(1 - this.lerpFactorRotStart, o)), this.euler.x += this.rotVelocity.x * s, this.euler.y += this.rotVelocity.y * s + this.groundYRotation, this.rotVelocityTarget.y === 0 && this.directionXZ.manhattanLength() === 0 ? this.rotationAccumWhenOrientWithCamera = 0 : (this.cameraFollow === !1 || this.cameraYAxis === "Locked") && (this.rotationAccumWhenOrientWithCamera += this.rotVelocity.y * s), this.isFirstPerson === !1 && this.orientMode !== "none" && this.directionXZ.manhattanLength() > 0) {
          if (this.orientMode === "radial") {
            this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(ro, this.euler.y - this.euler0.y);
            var _u65 = kn.copy(this.objectToCamXZ).normalize(),
              _c49 = Ql.copy(l).multiplyScalar(s);
            _c49.y = 0;
            var _d63 = _c49.sub(_n.copy(_u65).multiplyScalar(_c49.dot(_u65))).cross(_u65).y;
            this.euler.y -= Math.atan2(_d63, this.objectToCamXZ.length());
          }
        } else this.rot.y += this.rotVelocity.y * s + this.groundYRotation, this.rotVelocityTarget.y !== 0 && (this.cameraFollow === !1 || this.cameraYAxis === "Locked") && (this.euler.y = this.rot.y);
        if (this.cameraFollow === !0 && (this.moveMode === "walk" ? this.cameraXAxis === "Limit" ? this.euler.x = Se.clamp(this.euler.x, -this.maxPolarAngle + this.cameraPolarOffset + 1e-6, -this.minPolarAngle + this.cameraPolarOffset - 1e-6) : this.euler.x = Se.clamp(this.euler.x, -this.PI_2 + this.cameraPolarOffset, this.PI_2 + this.cameraPolarOffset) : this.cameraXAxis === "Limit" && (this.euler.x = Se.clamp(this.euler.x, -this.PI_2, this.PI_2))), this.moveMode === "fly" ? this.rot.x = this.euler.x : this.isFirstPerson && (r ? (Ho.copy(r), Ho.y = 0) : (Ho.copy(this.euler), Ho.y = 0), this.nonColliderRotOffset.makeRotationFromEuler(Ho)), r && (this.moveMode === "walk" ? (this.rot.y = r.y, this.rot.x = 0, this.rot.z = 0) : this.rot.setFromEuler(r), this.rot.y += this.vrEulerYOffset * KB), to.setFromAxisAngle(_Z, this.rot.x), Fa.setFromAxisAngle(ro, this.rot.y), Fa.multiply(to), to.setFromAxisAngle(EZ, this.rot.z), Fa.multiply(to), this.quaternion.copy(Fa), this.objectRealQuat.multiplyQuaternions(this.quaternion, this.objXZQuat), this.objectRealQuat.multiply(this.objXZQuat), this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation), this.collisionEnabled) {
          if (this.usePhysics) {
            var _this$object$rigidBod4, _this$object$rigidBod5;
            var _u66 = kn.copy(l).multiplyScalar(s / this.pixelsPerMeter),
              _c50 = null;
            this.didHit = !1;
            var _d64 = new _();
            for (var _h101 = 0; _h101 < 5; _h101++) {
              var _this$object$rigidBod2;
              var _f82 = _u66.length(),
                _p56 = Ql.copy(_u66).normalize();
              if (_c50 = this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(_d64), this.colliderWorldQuat, _p56, (_this$object$rigidBod2 = this.object.rigidBody) === null || _this$object$rigidBod2 === void 0 ? void 0 : _this$object$rigidBod2.collider(0).shape, _f82, !1, 24, void 0, void 0, this.object.rigidBody), _c50 !== null) {
                this.didHit = !0;
                var _m55 = this.sharedGameControlGlobals.colliderToEntity.get(_c50.collider.handle);
                if (_m55 !== this.lastHitObj && _h101 === 0) {
                  this.lastHitObj = _m55;
                  var x = this.sharedGameControlGlobals.entityToCollisionEvents[_m55 === null || _m55 === void 0 ? void 0 : _m55.uuid];
                  if (x) {
                    var _iterator153 = _createForOfIteratorHelper(x),
                      _step153;
                    try {
                      for (_iterator153.s(); !(_step153 = _iterator153.n()).done;) {
                        var S = _step153.value;
                        if (S.data.target === "character") {
                          var _this$sharedGameContr;
                          var w = ((_this$sharedGameContr = this.sharedGameControlGlobals.rapierWorld) === null || _this$sharedGameContr === void 0 ? void 0 : _this$sharedGameContr.getCollider(_c50.collider.handle))._parent,
                            A = void 0;
                          if (_m55.cloner) {
                            var _iterator154 = _createForOfIteratorHelper(_m55.cloner.children),
                              _step154;
                            try {
                              for (_iterator154.s(); !(_step154 = _iterator154.n()).done;) {
                                var E = _step154.value;
                                if (E.rigidBody === w) {
                                  A = E;
                                  break;
                                }
                              }
                            } catch (err) {
                              _iterator154.e(err);
                            } finally {
                              _iterator154.f();
                            }
                          }
                          S.dispatch(A), _m55.dispatchEvent(ab);
                        }
                      }
                    } catch (err) {
                      _iterator153.e(err);
                    } finally {
                      _iterator153.f();
                    }
                  }
                }
                var _g51 = WB.set(_c50.normal2.x, _c50.normal2.y, _c50.normal2.z).applyQuaternion(this.colliderWorldQuat),
                  y = qB.copy(_p56).multiplyScalar(_c50.toi).dot(_g51),
                  v = _c50.toi;
                if (v === 0 && (this.position.y += this.offset * this.pixelsPerMeter), y > this.offset && (v = _c50.toi * (y - this.offset) / y, _d64.addScaledVector(_p56, v)), _u66.copy(_p56).multiplyScalar(_f82 - v), Math.acos(-_g51.y) > this.slopeThresh) {
                  var _this$object$rigidBod3;
                  var _x47 = this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(_d64),
                    _S33 = Ql.copy(_c50.witness2).applyQuaternion(this.colliderWorldQuat);
                  _S33.y = 0;
                  var _w44 = _x47.add(_S33);
                  _w44.y += this.stepThresh;
                  var _A35 = this.sharedGameControlGlobals.rapierWorld.castShape(_w44, this.colliderWorldQuat, _u66, (_this$object$rigidBod3 = this.object.rigidBody) === null || _this$object$rigidBod3 === void 0 ? void 0 : _this$object$rigidBod3.collider(0).shape, 1, !1, 24, void 0, void 0, this.object.rigidBody);
                  _A35 !== null && _A35.toi === 0 && (_g51.y = 0, _g51.normalize());
                }
                _u66.addScaledVector(_g51, -_u66.dot(_g51));
              } else {
                _h101 === 0 && this.directionXZ.manhattanLength() !== 0 && (this.lastHitObj = null), _d64.add(_u66);
                break;
              }
            }
            this.position.addScaledVector(_d64, this.pixelsPerMeter), (_this$object$rigidBod4 = this.object.rigidBody) !== null && _this$object$rigidBod4 !== void 0 && _this$object$rigidBod4.setTranslation(_n.copy(this.position).divideScalar(this.pixelsPerMeter), !0), (_this$object$rigidBod5 = this.object.rigidBody) === null || _this$object$rigidBod5 === void 0 ? void 0 : _this$object$rigidBod5.setRotation(to.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat), !0);
          } else {
            var _u67 = this.onObject ? 1 : 5,
              _c51 = l.multiplyScalar(s / _u67);
            for (var _d65 = 0; _d65 < _u67; _d65++) this.position.add(_c51), this.collisionAdjustment(s / _u67);
          }
        } else this.position.addScaledVector(l, s);
        if (this.moveMode === "walk" && this.onObject && (this.velocityTarget.y = 0, this.velocity.y = 0), this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat), this.object.matrix.compose(this.position, this.quaternion, this.scale), this.object.matrixWorldNeedsUpdate = !0, this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset), this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv), this.cameraFollow === !0) {
          this.updateFollowArms();
          var _u68 = this.objectToTarget.add(this.position),
            _c52 = this.targetToCamera.add(_u68);
          uE.lookAt(_c52, _u68, ro).setPosition(_c52), uE.decompose(this.targetPos, this.targetQuat, _n), this.camera.quaternion.slerp(this.targetQuat, 1 - Math.pow(1 - this.lerpFactorRotCamera, o)), this.camera.position.lerp(this.targetPos, 1 - Math.pow(1 - this.lerpFactorPosCamera, o)), this.camera.updateMatrix(), this.camera.updateMatrixWorld(), this.cameraYAxis === "Limit" && this.orientMode === "cartesian" && (this.euler.y = Se.clamp(this.euler.y, this.minAzimuthAngleRel, this.maxAzimuthAngleRel)), this.euler.x = Se.clamp(this.euler.x, -this.PI_2 + (this.cameraPolarOffset < 0 ? this.cameraPolarOffset : 0), this.PI_2 + (this.cameraPolarOffset > 0 ? this.cameraPolarOffset : 0));
        }
        return this.eulerDelta.set(0, 0, 0), this.object.dispatchEvent(OZ), this.path.length < 2 && this.lastPosition.distanceToSquared(this.position) < this.threshEndTranslate && Math.abs(this.rotVelocity.x) < this.threshEndRotVel && Math.abs(this.rotVelocity.y) < this.threshEndRotVel && (this.camera === void 0 || this.isFirstPerson || this.lastCameraPosition.distanceToSquared(this.camera.position) < this.threshEndTranslate && 8 * (1 - this.lastCameraQuaternion.dot(this.camera.quaternion)) < this.threshEndRotate) && (this.moveMode === "fly" || this.onObject === !0 || this.collisionEnabled === !1) && (this.navMeshPathDest === null || this.navMeshPathDest.material.opacity < -.04 * ((_this$navMeshPathDest2 = this.navMeshPathDest) === null || _this$navMeshPathDest2 === void 0 || (_this$navMeshPathDest2 = _this$navMeshPathDest2.material) === null || _this$navMeshPathDest2 === void 0 ? void 0 : _this$navMeshPathDest2.userData.opacity0)) ? !1 : (this.camera && (this.lastCameraPosition.copy(this.camera.position), this.lastCameraQuaternion.copy(this.camera.quaternion)), this.lastPosition.copy(this.position), this.object.dispatchEvent(DZ), !0);
      }
    }, {
      key: "updateFollowArms",
      value: function updateFollowArms() {
        this.objectToTarget.copy(this.objectToTarget0), this.targetToCamera.copy(this.targetToCamera0);
        var e = to.setFromAxisAngle(ro, this.cameraYAxis === "Limit" && this.orientMode !== "radial" ? Se.clamp(this.euler.y - this.euler0.y, this.minAzimuthAngleRel, this.maxAzimuthAngleRel) : this.euler.y - this.euler0.y);
        (this.cameraYAxis !== "Locked" || this.orientMode === "radial") && this.objectToTarget.applyQuaternion(e);
        var r;
        this.cameraXAxis === "Limit" ? r = Se.clamp(this.euler.x, -this.maxPolarAngle + this.cameraPolarOffset + 1e-6, -this.minPolarAngle + this.cameraPolarOffset - 1e-6) : r = Se.clamp(this.euler.x, -this.PI_2 + this.cameraPolarOffset + 1e-6, this.PI_2 + this.cameraPolarOffset - 1e-6);
        var i = _n.copy(this.cameraPolarAxis0);
        (this.cameraYAxis !== "Locked" || this.orientMode === "radial") && i.applyQuaternion(e);
        var s = Fa.setFromAxisAngle(i, r);
        this.cameraYAxis !== "Locked" && this.targetToCamera.applyQuaternion(e), this.cameraXAxis !== "Locked" && this.targetToCamera.applyQuaternion(s);
      }
    }, {
      key: "groundTiltAdjustment",
      value: function groundTiltAdjustment(e) {
        ro.angleTo(e) * 180 / Math.PI < 15 || ro.angleTo(e) * 180 / Math.PI > 85 ? to.identity() : to.setFromUnitVectors(ro, e), this.groundTilt.slerp(to, .06), this.groundTiltInv.copy(this.groundTilt).invert();
      }
    }, {
      key: "collisionAdjustment",
      value: function collisionAdjustment(e) {
        var _this356 = this,
          _this$sharedGameContr2;
        var r = qB.set(0, 0, 0);
        this.object.matrix.compose(this.position, this.quaternion, this.scale);
        var i = uE.multiplyMatrices(this.object.matrix, this.objXZRotMat).multiply(this.collider.matrix).decompose(_n, to, kn).compose(_n, to, XB);
        this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(function (o) {
          if (o === _this356.object || o.isDescendantOf(_this356.object)) return;
          Es.makeEmpty(), o.updateMatrixWorldSVD();
          var a = o.matrixWorldRigid,
            l = YB.copy(a).invert(),
            u = AZ.copy(YB).multiply(i);
          Hi.copy(_this356.collider.segment), Hi.start.applyMatrix4(u), Hi.end.applyMatrix4(u);
          var c = WB.copy(_this356.position).applyMatrix4(l);
          Es.expandByPoint(Hi.start), Es.expandByPoint(Hi.end), Es.min.addScalar(-_this356.collider.radius), Es.max.addScalar(_this356.collider.radius), o.bvhGeometry.boundsTree.shapecast({
            traverseBoundsOrder: function traverseBoundsOrder(d) {
              return d.distanceToPoint(Hi.end);
            },
            intersectsBounds: function intersectsBounds(d) {
              return d.intersectsBox(Es);
            },
            intersectsTriangle: function intersectsTriangle(d) {
              var h = _n,
                f = kn,
                p = d.closestPointToSegment(Hi, h, f);
              if (p < _this356.collider.radius) {
                var m = _this356.collider.radius - p,
                  g = f.sub(h).normalize(),
                  y = Ql.copy(c);
                y.addScaledVector(g, m);
                var v = y.applyMatrix4(a).sub(_this356.position);
                r.add(v), Hi.start.addScaledVector(g, m), Hi.end.addScaledVector(g, m);
              }
            }
          });
        }), Es.makeEmpty(), Hi.copy(this.collider.segment), Hi.start.applyMatrix4(i), Hi.end.applyMatrix4(i), Es.expandByPoint(Hi.start), Es.expandByPoint(Hi.end), Es.min.addScalar(-this.collider.radius), Es.max.addScalar(this.collider.radius), (_this$sharedGameContr2 = this.sharedGameControlGlobals.staticMeshBVH) !== null && _this$sharedGameContr2 !== void 0 && _this$sharedGameContr2.shapecast({
          traverseBoundsOrder: function traverseBoundsOrder(o) {
            return o.distanceToPoint(Hi.end);
          },
          intersectsBounds: function intersectsBounds(o) {
            return o.intersectsBox(Es);
          },
          intersectsTriangle: function intersectsTriangle(o) {
            var a = _n,
              l = kn,
              u = o.closestPointToSegment(Hi, a, l);
            if (u < _this356.collider.radius) {
              var c = _this356.collider.radius - u,
                d = l.sub(a).normalize();
              _this356.alignToGround && _this356.groundTiltAdjustment(d), r.addScaledVector(d, c), Hi.start.addScaledVector(d, c), Hi.end.addScaledVector(d, c);
            }
          }
        }), this.onObject = Math.abs(r.y) > Math.abs(e * this.velocity.y * .25), this.onObject && this.dispatchStopEvent("jump");
        var s = Math.max(0, r.length() - 1e-5);
        r.normalize().multiplyScalar(s), this.position.add(r);
      }
    }]);
    return ob;
  }(ir),
  dg = ob;
dg.isLocked = !1;
var ZB = Pi(F1());
function io(n, t) {
  var e = new we();
  if (!n.getAttribute("position")) return e.setAttribute("position", new be([], 3)), e.setIndex([]), e;
  var _Fc3 = Fc(n.getAttribute("position"), n.getIndex()),
    r = _Fc3.positions,
    i = _Fc3.triIndices;
  return e.setAttribute("position", new be(r, 3)), e.setIndex(i), t && e.applyMatrix4(t), e;
}
var IZ = new te(),
  RZ = new te(),
  Wo = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
function hE(n) {
  var t = n.elements;
  Wo[0][0] = t[0], Wo[0][1] = t[4], Wo[0][2] = t[8], Wo[1][0] = t[1], Wo[1][1] = t[5], Wo[1][2] = t[9], Wo[2][0] = t[2], Wo[2][1] = t[6], Wo[2][2] = t[10];
  var _ref85 = (0, ZB.SVD)(Wo),
    e = _ref85.u,
    r = _ref85.v,
    i = IZ.set(e[0][0], e[0][1], e[0][2], 0, e[1][0], e[1][1], e[1][2], 0, e[2][0], e[2][1], e[2][2], 0, 0, 0, 0, 1),
    s = RZ.set(r[0][0], r[0][1], r[0][2], 0, r[1][0], r[1][1], r[1][2], 0, r[2][0], r[2][1], r[2][2], 0, 0, 0, 0, 1);
  return i.multiply(s.transpose());
}
var lb = /*#__PURE__*/function (_Yu) {
  _inherits(lb, _Yu);
  var _super300 = _createSuper(lb);
  function lb() {
    var _this357;
    _classCallCheck(this, lb);
    _this357 = _super300.call(this), _this357.layers.enable(3), _this357.layers.enable(8);
    return _this357;
  }
  _createClass(lb, [{
    key: "setFromCamera",
    value: function setFromCamera(t, e) {
      e.isOrthographicCamera ? (this.ray.origin.set(t.x, t.y, -1).unproject(e), this.ray.direction.set(0, 0, -1).transformDirection(e.matrixWorld), this.camera = e) : e.isPerspectiveCamera ? (this.ray.origin.set(t.x, t.y, -1).unproject(e), this.ray.direction.set(t.x, t.y, .5).unproject(e).sub(this.ray.origin).normalize(), this.camera = e) : console.error("Raycaster: Unsupported camera type.");
    }
  }, {
    key: "intersectVisibleObjects",
    value: function intersectVisibleObjects(t) {
      var _this358 = this;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
      return t.forEach(function (i) {
        i.visible && _this358.intersectObject(i, e, r);
      }), r;
    }
  }, {
    key: "createRaycastLineHelper",
    value: function createRaycastLineHelper() {
      var t = new ns({
          color: 65280,
          linewidth: 10
        }),
        e = new _(this.ray.origin.x, this.ray.origin.y, this.ray.origin.z),
        r = new _(this.ray.direction.x, this.ray.direction.y, this.ray.direction.z),
        i = this.camera.far - this.camera.near,
        s = new _().addVectors(e, r.multiplyScalar(i)),
        o = new we();
      return o.setFromPoints([e, s]), new pc(o, t);
    }
  }]);
  return lb;
}(Yu);
var JB = function JB(n) {
  return n instanceof Ss || n instanceof Js;
};
function LZ(n, t) {
  return n.distance - t.distance;
}
function $B(n, t, e) {
  if (!(!Mo(t) || !t.visible)) {
    sn(t) && t.raycast(n, e);
    var _iterator155 = _createForOfIteratorHelper(t.children),
      _step155;
    try {
      for (_iterator155.s(); !(_step155 = _iterator155.n()).done;) {
        var r = _step155.value;
        $B(n, r, e);
      }
    } catch (err) {
      _iterator155.e(err);
    } finally {
      _iterator155.f();
    }
  }
}
function Lf(n, t, e) {
  var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
  if (!r && !e.some(function (s) {
    return Bf(n, s) !== void 0;
  })) return [];
  var i = [];
  return t.children.forEach(function (s) {
    return $B(n, s, i);
  }), i.sort(LZ), i;
}
function hg(n) {
  var t = [];
  if (n.length) {
    var e = n[0].object;
    Mo(e) && t.push(e);
    var r = e.parent;
    for (; r;) JB(r) && t.push(r), r = r.parent;
  }
  return t;
}
function no(n, t, e, r) {
  var i = n.frame;
  if (i) {
    var _s120 = t[0] * i.width,
      o = (1 - t[1]) * i.height;
    var _iterator156 = _createForOfIteratorHelper(e),
      _step156;
    try {
      for (_iterator156.s(); !(_step156 = _iterator156.n()).done;) {
        var a = _step156.value;
        var l = a === i.uuid ? i : i.find(a);
        if (l !== null && l !== void 0 && l.intersects(_s120, o)) return r(l), !0;
      }
    } catch (err) {
      _iterator156.e(err);
    } finally {
      _iterator156.f();
    }
  }
  return !1;
}
function Bf(n, t) {
  if (sn(t)) {
    if (t.visible) {
      var e = [];
      return t.raycast(n, e), e.length ? e[0] : void 0;
    }
  } else if (JB(t)) return eN(n, t);
}
function eN(n, t) {
  if (!(!Mo(t) || !t.visible)) {
    if (sn(t)) {
      var e = [];
      if (t.raycast(n, e), e.length) return e[0];
    }
    var _iterator157 = _createForOfIteratorHelper(t.children),
      _step157;
    try {
      for (_iterator157.s(); !(_step157 = _iterator157.n()).done;) {
        var _e70 = _step157.value;
        var r = eN(n, _e70);
        if (r) return r;
      }
    } catch (err) {
      _iterator157.e(err);
    } finally {
      _iterator157.f();
    }
  }
}
function BZ(n, t, e) {
  return {
    x: (n - (e.left + window.scrollX)) / e.width * 2 - 1,
    y: -((t - (e.top + window.scrollY)) / e.height) * 2 + 1
  };
}
function NZ(n, t, e) {
  return {
    x: (n - (e.left + window.scrollX)) / e.width,
    y: 1 - (t - (e.top + window.scrollY)) / e.height
  };
}
var cb = /*#__PURE__*/function () {
  function cb(t, e, r, i, s, o, a, l) {
    _classCallCheck(this, cb);
    this.renderer = t;
    this.publish = e;
    this.scene = r;
    this.getCamera = i;
    this.sharedAssets = s;
    this.requestRender = o;
    this.isExport = a;
    this.frame = l;
    this.raycaster = new lb();
    this._useWindowEvents = !1;
    this.pointerWorld = {
      x: 0,
      y: 0
    };
    this.pointerScreen = {
      x: 0,
      y: 0
    };
    this._useWindowEvents = e.mouseEventTarget === "window", this.domElement = t.domElement, this.eventElement = this._useWindowEvents ? window : t.domElement, this._domRect = this.domElement.getBoundingClientRect();
  }
  _createClass(cb, [{
    key: "stopRaycast",
    get: function get() {
      return this.publish.stopRaycast;
    }
  }, {
    key: "page",
    get: function get() {
      return this.scene.activePage;
    }
  }, {
    key: "useWindowEvents",
    get: function get() {
      return this._useWindowEvents;
    },
    set: function set(t) {
      this._useWindowEvents = t, this.eventElement = t ? window : this.renderer.domElement;
    }
  }, {
    key: "domRect",
    get: function get() {
      return this._domRect;
    },
    set: function set(t) {
      this._domRect = t;
    }
  }, {
    key: "updateRaycaster",
    value: function updateRaycaster(t) {
      var _t$touches;
      var _ref86 = ((_t$touches = t.touches) === null || _t$touches === void 0 ? void 0 : _t$touches.length) > 0 ? t.touches[0] : t,
        e = _ref86.pageX,
        r = _ref86.pageY;
      this.pointerWorld = BZ(e, r, this._domRect), this.pointerScreen = NZ(e, r, this._domRect), this.raycaster.setFromCamera(this.pointerWorld, this.getCamera());
    }
  }]);
  return cb;
}();
var Dr = /*#__PURE__*/function () {
  function Dr(t) {
    _classCallCheck(this, Dr);
    this.eventContext = t;
    this.domEventsNeeded = new Set();
    this.hasVideoAction = !1;
  }
  _createClass(Dr, [{
    key: "connect",
    value: function connect() {}
  }, {
    key: "disconnect",
    value: function disconnect() {}
  }]);
  return Dr;
}();
var fE = [["start", "Start"], ["keyDown", "KeyDown"], ["keyUp", "KeyUp"], ["mouseDown", "MouseDown"], ["mouseUp", "MouseUp"], ["mouseHover", "MouseHover"], ["collision", "Collision"], ["lookAt", "LookAt"], ["follow", "Follow"], ["scroll", "Scroll"]],
  tN = function tN(n) {
    var _fE$find;
    return (_fE$find = fE.find(function (_ref87) {
      var _ref88 = _slicedToArray(_ref87, 2),
        t = _ref88[0],
        e = _ref88[1];
      return e === n;
    })) === null || _fE$find === void 0 ? void 0 : _fE$find[0];
  },
  qo = function qo(n) {
    var _fE$find2;
    return (_fE$find2 = fE.find(function (_ref89) {
      var _ref90 = _slicedToArray(_ref89, 1),
        t = _ref90[0];
      return t === n;
    })) === null || _fE$find2 === void 0 ? void 0 : _fE$find2[1];
  },
  FZ = function FZ(n, t) {
    var e = tN(n);
    if (e) {
      var r = new CustomEvent(e, {
        bubbles: !0
      });
      return Object.defineProperty(r, "target", {
        writable: !1,
        value: t
      }), r;
    }
  },
  ub = /*#__PURE__*/function (_Dr) {
    _inherits(ub, _Dr);
    var _super301 = _createSuper(ub);
    function ub(e) {
      var _this359;
      _classCallCheck(this, ub);
      _this359 = _super301.call(this, e);
      _this359.objectsPerEvents = new Map();
      _this359.splineEvents = {};
      _this359.onBeginEvent = function (e) {
        var _this359$splineEvents;
        if (!e.eventName || !e.target || e.eventName === "Scroll") return;
        var r = (_this359$splineEvents = _this359.splineEvents[tN(e.eventName)]) === null || _this359$splineEvents === void 0 ? void 0 : _this359$splineEvents[e.target.uuid];
        if (!r) return;
        e.eventName === "Scroll" && e.deltaY !== void 0 && Object.assign(r, {
          deltaY: e.deltaY
        });
        var i = _this359.eventContext.domElement;
        i.dispatchEvent(r);
      };
      var r = _this359.eventContext.page;
      r.traverseEntity(function (i) {
        var _i$data;
        if (!!((_i$data = i.data) !== null && _i$data !== void 0 && _i$data.events.length)) {
          var _iterator158 = _createForOfIteratorHelper(fE),
            _step158;
          try {
            var _loop18 = function _loop18() {
              var _step158$value = _slicedToArray(_step158.value, 2),
                s = _step158$value[0],
                o = _step158$value[1];
              if (i.data.events.some(function (a) {
                return a.data.type === o && !a.data.disabled;
              })) {
                var _this359$objectsPerEv;
                _this359.objectsPerEvents.has(s) ? (_this359$objectsPerEv = _this359.objectsPerEvents.get(s)) === null || _this359$objectsPerEv === void 0 ? void 0 : _this359$objectsPerEv.push(i) : _this359.objectsPerEvents.set(s, [i]);
                var a = {
                    id: i.uuid,
                    name: i.name
                  },
                  l = FZ(o, a),
                  u = _this359.splineEvents[s];
                u ? u[i.uuid] = l : _this359.splineEvents[s] = _defineProperty({}, i.uuid, l);
              }
            };
            for (_iterator158.s(); !(_step158 = _iterator158.n()).done;) {
              _loop18();
            }
          } catch (err) {
            _iterator158.e(err);
          } finally {
            _iterator158.f();
          }
        }
      });
      return _this359;
    }
    _createClass(ub, [{
      key: "connect",
      value: function connect() {
        var _this360 = this;
        this.objectsPerEvents.forEach(function (e) {
          e.forEach(function (r) {
            r.addEventListener("beginEvent", _this360.onBeginEvent);
          });
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this361 = this;
        this.objectsPerEvents.forEach(function (e) {
          e.forEach(function (r) {
            r.removeEventListener("beginEvent", _this361.onBeginEvent);
          });
        });
      }
    }]);
    return ub;
  }(Dr);
var pE = /*#__PURE__*/function () {
    function pE(t, e, r, i, s, o) {
      _classCallCheck(this, pE);
      this.id = t;
      this.data = e;
      this.object = r;
      this.entered = !1;
      this.alreadyPlayedNonTogglingActions = new Set();
      if (this.useToggle = e.runMode === "Toggle", (e.type === "KeyDown" || e.type === "KeyUp" || e.type === "KeyPress") && !e.key) throw new Error("Missing property");
      this.actions = gr(e, e.actions, i, s, o, r);
    }
    _createClass(pE, [{
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "dispatchHeld",
      value: function dispatchHeld(t) {
        this.actions.Create.forEach(function (e) {
          t && e.dispatchThrottled.cancel(), e.dispatchThrottled();
        });
      }
    }, {
      key: "dispatch",
      value: function dispatch() {
        var _this362 = this;
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this362 ? (e.object.currentTransitionEvent = _this362, e.init()) : _this362.data.runMode === "Once" && _this362.alreadyPlayedNonTogglingActions.add(e);
        }), this.useToggle ? (this.actions.Transition.forEach(function (e) {
          e.toggle();
        }), this.actions.Animation.forEach(function (e) {
          e.toggle();
        }), this.actions.SwitchCamera.forEach(function (e) {
          e.toggle();
        })) : this.data.type === "MousePress" || this.data.type === "KeyPress" ? this.entered || (this.entered = !0, this.actions.Transition.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Create.forEach(function (e) {
          return e.dispatchStart();
        })) : (this.actions.Transition.some(function (i) {
          return i.playing;
        }) || this.actions.Transition.forEach(function (i) {
          _this362.alreadyPlayedNonTogglingActions.has(i) === !1 && i.play();
        }), this.actions.SwitchCamera.some(function (i) {
          return i.playing;
        }) || this.actions.SwitchCamera.forEach(function (i) {
          i.play();
        }), this.actions.Animation.forEach(function (i) {
          i.play();
        })), this.actions.Link.forEach(function (e) {
          e.dispatch();
        }), this.actions.SceneTransition.forEach(function (e) {
          e.dispatch();
        }), t === !1 && this.actions.Create.forEach(function (e) {
          e.dispatch();
        }), this.actions.Destroy.forEach(function (e) {
          e.dispatch();
        }), this.actions.Reset.forEach(function (e) {
          e.dispatch();
        }), this.actions.Audio.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.Video.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.Particles.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }, {
      key: "dispatchRelease",
      value: function dispatchRelease() {
        this.entered && (this.entered = !1, this.actions.Transition.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.Particles.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.Create.forEach(function (t) {
          return t.dispatchStop();
        }));
      }
    }, {
      key: "dispatchUserEvent",
      value: function dispatchUserEvent(t) {
        var _this363 = this;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this363 && (e.object.currentTransitionEvent = _this363, e.init());
        }), t ? (this.actions.Transition.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.reverseFromCurrent();
        })) : (this.actions.Transition.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.playFromCurrent();
        })), this.actions.Link.forEach(function (e) {
          e.dispatch();
        }), this.actions.SceneTransition.forEach(function (e) {
          e.dispatch();
        }), this.actions.Create.forEach(function (e) {
          e.dispatch();
        }), this.actions.Destroy.forEach(function (e) {
          e.dispatch();
        }), this.actions.Reset.forEach(function (e) {
          e.dispatch();
        }), this.actions.Audio.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.Video.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.Particles.forEach(function (e) {
          e.dispatchBasic();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }]);
    return pE;
  }(),
  db = /*#__PURE__*/function (_Dr2) {
    _inherits(db, _Dr2);
    var _super302 = _createSuper(db);
    function db(e, r, i) {
      var _this364;
      _classCallCheck(this, db);
      _this364 = _super302.call(this, e);
      _this364.useForRaycastProperty = i;
      _this364.objectsPerTypes = {
        MouseDown: [],
        MouseUp: [],
        MousePress: [],
        KeyDown: [],
        KeyUp: [],
        KeyPress: []
      };
      _this364.canvasMouseEvents = [];
      _this364.eventsPerObjects = {
        MouseDown: {},
        MouseUp: {},
        MousePress: {},
        KeyDown: {},
        KeyUp: {},
        KeyPress: {}
      };
      _this364.heldKeys = {};
      _this364.heldKeysPress = {};
      _this364._prevObjects = [];
      _this364.sceneInterects = null;
      _this364.onCanvasRaycast = function (e) {
        if (_this364.useForRaycastProperty === !0 && _this364.sceneInterects === null) {
          _this364.eventContext.updateRaycaster(e);
          var _this364$eventContext = _this364.eventContext,
            _r67 = _this364$eventContext.raycaster,
            _i182 = _this364$eventContext.page,
            _s121 = Lf(_r67, _i182, [], !0);
          _this364.sceneInterects = _s121, _s121.length && (_this364.eventContext.sharedAssets.raycastProperty = {
            x: _s121[0].point.x,
            y: _s121[0].point.y,
            z: _s121[0].point.z,
            objX: _s121[0].object.matrixWorld.elements[12],
            objY: _s121[0].object.matrixWorld.elements[13],
            objZ: _s121[0].object.matrixWorld.elements[14]
          });
        }
      };
      _this364.onCanvasMouseDown = function (e) {
        (e.target === _this364.eventContext.domElement || e.target.tagName === "SPLINE-VIEWER") && _this364.canvasMouseEvents.forEach(function (r) {
          (r.data.type === "MouseDown" || r.data.type === "MousePress") && (_this364.onCanvasRaycast(e), r.dispatch());
        });
      };
      _this364.onCanvasMouseUp = function (e) {
        (e.target === _this364.eventContext.domElement || e.target.tagName === "SPLINE-VIEWER") && _this364.canvasMouseEvents.forEach(function (r) {
          r.data.type === "MouseUp" ? (_this364.onCanvasRaycast(e), r.dispatch()) : r.data.type === "MousePress" && r.dispatchRelease();
        });
      };
      _this364.onMouseDown = function (e) {
        Ye.length > 1 || (_this364.eventContext.updateRaycaster(e), _this364.handleMouseEvent("MouseDown"));
      };
      _this364.onMouseUp = function (e) {
        Ye.length > 1 || (_this364.eventContext.updateRaycaster(e), _this364.handleMouseEvent("MouseUp"));
      };
      _this364.onMousePressDown = function (e) {
        Ye.length > 1 || (_this364.eventContext.updateRaycaster(e), _this364.handleMousePressEvent());
      };
      _this364.onMousePressRelease = function (e) {
        Ye.length > 1 || (_this364.eventContext.updateRaycaster(e), _this364.handleMousePressEvent(!0));
      };
      _this364.onKeyDown = function (e) {
        _this364.heldKeys[e.key] || (_this364.handleKeyEvent(e, "KeyDown"), _this364.handleKeyEventHeld(e, "KeyDown", !0)), _this364.heldKeys[e.key] = !0;
      };
      _this364.onKeyUp = function (e) {
        _this364.handleKeyEvent(e, "KeyUp"), _this364.handleKeyEventHeld(e, "KeyUp", !0);
      };
      _this364.onKeyPressDown = function (e) {
        _this364.heldKeysPress[e.key] ? _this364.handleKeyEventHeld(e, "KeyPress") : (_this364.handleKeyEvent(e, "KeyPress"), _this364.handleKeyEventHeld(e, "KeyPress", !0)), _this364.heldKeysPress[e.key] = !0;
      };
      _this364.onKeyPressUp = function (e) {
        _this364.handleKeyEvent(e, "KeyPress", !0);
      };
      _this364.releaseHeldKey = function (e) {
        delete _this364.heldKeys[e.key];
      };
      _this364.releaseHeldKeyPress = function (e) {
        delete _this364.heldKeysPress[e.key];
      };
      _this364._onUserEvent = function (_ref91) {
        var _this364$eventsPerObj, _this364$eventsPerObj2;
        var e = _ref91.eventName,
          r = _ref91.target,
          i = _ref91.reverse;
        if (!e || !r) return;
        var s = qo(e);
        s && (s === "MouseDown" || s === "MouseUp" || s === "MousePress" ? (r.dispatchEvent({
          type: "beginEvent",
          eventName: s
        }), (_this364$eventsPerObj = _this364.eventsPerObjects[s]) === null || _this364$eventsPerObj === void 0 || (_this364$eventsPerObj = _this364$eventsPerObj[r.uuid]) === null || _this364$eventsPerObj === void 0 ? void 0 : _this364$eventsPerObj.forEach(function (o) {
          o.dispatchUserEvent(i);
        })) : (s === "KeyDown" || s === "KeyUp" || s === "KeyPress") && (r.dispatchEvent({
          type: "beginEvent",
          eventName: s
        }), (_this364$eventsPerObj2 = _this364.eventsPerObjects[s]) === null || _this364$eventsPerObj2 === void 0 || (_this364$eventsPerObj2 = _this364$eventsPerObj2[r.uuid]) === null || _this364$eventsPerObj2 === void 0 ? void 0 : _this364$eventsPerObj2.forEach(function (o) {
          o.dispatchUserEvent();
        })));
      };
      var _this364$eventContext2 = _this364.eventContext,
        s = _this364$eventContext2.page,
        o = _this364$eventContext2.sharedAssets,
        a = function a(l, u) {
          var _l$data;
          if (!((_l$data = l.data) !== null && _l$data !== void 0 && _l$data.events.length)) return;
          var c = ["MouseDown", "MouseUp", "MousePress", "KeyDown", "KeyUp", "KeyPress"];
          var _loop19 = function _loop19() {
            var _h$l$uuid;
            var d = _c53[_i183];
            var h = _this364.eventsPerObjects[d];
            l.data.events.filter(function (_ref92) {
              var f = _ref92.data;
              return f.type === d && f.disabled !== !0;
            }).forEach(function (_ref93) {
              var f = _ref93.id,
                p = _ref93.data;
              try {
                var m = new pE(f, p, l, s, o, r);
                m.actions.Video.length && (_this364.hasVideoAction = !0), (p.type === "MouseDown" || p.type === "MouseUp" || p.type === "MousePress") && (p.mode === "Canvas" || p.mode === "Window") ? _this364.canvasMouseEvents.push(m) : h[l.uuid] ? h[l.uuid].push(m) : h[l.uuid] = [m];
              } catch (m) {
                !1 && console.log(m);
              }
            }), ((_h$l$uuid = h[l.uuid]) === null || _h$l$uuid === void 0 ? void 0 : _h$l$uuid.length) && _this364.objectsPerTypes[d].push(l instanceof jt && (d === "MouseDown" || d === "MouseUp" || d === "MousePress") ? u : l);
          };
          for (var _i183 = 0, _c53 = c; _i183 < _c53.length; _i183++) {
            _loop19();
          }
        };
      s.traverseEntity(function (l) {
        var _l$frame;
        (l instanceof fr || l instanceof sr) && (_l$frame = l.frame) !== null && _l$frame !== void 0 && _l$frame.traverse(function (u) {
          a(u, l);
        }), a(l);
      });
      return _this364;
    }
    _createClass(db, [{
      key: "connect",
      value: function connect() {
        var _this$objectsPerTypes,
          _this$objectsPerTypes2,
          _this$objectsPerTypes3,
          _this$objectsPerTypes4,
          _this$objectsPerTypes5,
          _this$objectsPerTypes6,
          _this365 = this;
        var e = this.eventContext.domElement;
        this.heldKeys = {}, this.heldKeysPress = {}, this.domEventsNeeded.clear(), e.addEventListener("pointerdown", this.onCanvasMouseDown), e.addEventListener("pointerup", this.onCanvasMouseUp), ((_this$objectsPerTypes = this.objectsPerTypes.MouseDown) !== null && _this$objectsPerTypes !== void 0 && _this$objectsPerTypes.length || this.useForRaycastProperty) && (this.domEventsNeeded.add("pointerdown"), e.addEventListener("pointerdown", this.onMouseDown)), (_this$objectsPerTypes2 = this.objectsPerTypes.MouseUp) !== null && _this$objectsPerTypes2 !== void 0 && _this$objectsPerTypes2.length && (this.domEventsNeeded.add("pointerup"), e.addEventListener("pointerup", this.onMouseUp)), (_this$objectsPerTypes3 = this.objectsPerTypes.MousePress) !== null && _this$objectsPerTypes3 !== void 0 && _this$objectsPerTypes3.length && (this.domEventsNeeded.add("pointerdown"), e.addEventListener("pointerdown", this.onMousePressDown), this.domEventsNeeded.add("pointerup"), e.addEventListener("pointerup", this.onMousePressRelease)), (_this$objectsPerTypes4 = this.objectsPerTypes.KeyDown) !== null && _this$objectsPerTypes4 !== void 0 && _this$objectsPerTypes4.length && (this.domEventsNeeded.add("keydown"), document.addEventListener("keydown", this.onKeyDown), document.addEventListener("keyup", this.releaseHeldKey)), (_this$objectsPerTypes5 = this.objectsPerTypes.KeyUp) !== null && _this$objectsPerTypes5 !== void 0 && _this$objectsPerTypes5.length && (this.domEventsNeeded.add("keyup"), document.addEventListener("keyup", this.onKeyUp)), (_this$objectsPerTypes6 = this.objectsPerTypes.KeyPress) !== null && _this$objectsPerTypes6 !== void 0 && _this$objectsPerTypes6.length && (this.domEventsNeeded.add("keydown"), document.addEventListener("keydown", this.onKeyPressDown), document.addEventListener("keyup", this.releaseHeldKeyPress), this.domEventsNeeded.add("keyup"), document.addEventListener("keyup", this.onKeyPressUp)), Object.entries(this.objectsPerTypes).forEach(function (_ref94) {
          var _ref95 = _slicedToArray(_ref94, 2),
            r = _ref95[0],
            i = _ref95[1];
          i.forEach(function (s) {
            s.addEventListener("userEvent", _this365._onUserEvent);
          });
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this366 = this;
        var e = this.eventContext.domElement;
        this.domEventsNeeded.clear(), this.heldKeys = {}, this.heldKeysPress = {}, e.removeEventListener("pointerdown", this.onCanvasMouseDown), e.removeEventListener("pointerup", this.onCanvasMouseUp), e.removeEventListener("pointerdown", this.onMouseDown), e.removeEventListener("pointerdown", this.onMousePressDown), e.removeEventListener("pointerup", this.onMouseUp), e.removeEventListener("pointerup", this.onMousePressRelease), document.removeEventListener("keydown", this.onKeyDown), document.removeEventListener("keyup", this.onKeyUp), document.removeEventListener("keydown", this.onKeyPressDown), document.removeEventListener("keyup", this.onKeyPressUp), document.removeEventListener("keyup", this.releaseHeldKey), Object.values(this.eventsPerObjects).forEach(function (r) {
          Object.values(r).forEach(function (i) {
            i.forEach(function (s) {
              s.disconnect();
            });
          });
        }), this.canvasMouseEvents.forEach(function (r) {
          r.disconnect();
        }), Object.entries(this.objectsPerTypes).forEach(function (_ref96) {
          var _ref97 = _slicedToArray(_ref96, 2),
            r = _ref97[0],
            i = _ref97[1];
          i.forEach(function (s) {
            s.removeEventListener("userEvent", _this366._onUserEvent);
          });
        });
      }
    }, {
      key: "handleMouseEvent",
      value: function handleMouseEvent(e) {
        var _this367 = this;
        var _this$eventContext = this.eventContext,
          r = _this$eventContext.stopRaycast,
          i = _this$eventContext.raycaster,
          s = _this$eventContext.page,
          o = _this$eventContext.pointerScreen,
          a = this.objectsPerTypes[e],
          l = a.filter(function (u) {
            return !(u instanceof jt);
          });
        if (!(!a.length && !this.useForRaycastProperty) && !(s.uiCanvas && no(s, [o.x, o.y], Object.keys(this.eventsPerObjects[e]), function (c) {
          _this367.handleObjectMouseEventDispatch(c, e);
        }))) {
          if (r || this.useForRaycastProperty) {
            var u;
            if (this.sceneInterects === null ? u = Lf(i, s, l, this.useForRaycastProperty) : (u = this.sceneInterects, this.sceneInterects = null), this.useForRaycastProperty && u.length && (this.eventContext.sharedAssets.raycastProperty = {
              x: u[0].point.x,
              y: u[0].point.y,
              z: u[0].point.z,
              objX: u[0].object.matrixWorld.elements[12],
              objY: u[0].object.matrixWorld.elements[13],
              objZ: u[0].object.matrixWorld.elements[14]
            }), r) {
              var _u$0$uv$x, _u$, _u$0$uv$y, _u$2;
              var c = [(_u$0$uv$x = (_u$ = u[0]) === null || _u$ === void 0 || (_u$ = _u$.uv) === null || _u$ === void 0 ? void 0 : _u$.x) !== null && _u$0$uv$x !== void 0 ? _u$0$uv$x : 0, (_u$0$uv$y = (_u$2 = u[0]) === null || _u$2 === void 0 || (_u$2 = _u$2.uv) === null || _u$2 === void 0 ? void 0 : _u$2.y) !== null && _u$0$uv$y !== void 0 ? _u$0$uv$y : 0];
              hg(u).forEach(function (d) {
                d instanceof fr && no(d, c, Object.keys(_this367.eventsPerObjects[e]), function (h) {
                  _this367.handleObjectMouseEventDispatch(h, e);
                }), _this367.eventsPerObjects[e][d.uuid] && _this367.handleObjectMouseEventDispatch(d, e);
              });
            }
          }
          r || l.forEach(function (u) {
            var _c$uv$x, _c$uv, _c$uv$y, _c$uv2;
            var c = Bf(i, u);
            c && (_this367.handleObjectMouseEventDispatch(u, e), u instanceof fr && no(u, [(_c$uv$x = c === null || c === void 0 || (_c$uv = c.uv) === null || _c$uv === void 0 ? void 0 : _c$uv.x) !== null && _c$uv$x !== void 0 ? _c$uv$x : 0, (_c$uv$y = c === null || c === void 0 || (_c$uv2 = c.uv) === null || _c$uv2 === void 0 ? void 0 : _c$uv2.y) !== null && _c$uv$y !== void 0 ? _c$uv$y : 0], Object.keys(_this367.eventsPerObjects[e]), function (d) {
              _this367.handleObjectMouseEventDispatch(d, e);
            }));
          });
        }
      }
    }, {
      key: "handleMousePressEvent",
      value: function handleMousePressEvent() {
        var _this368 = this;
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        var r = "MousePress",
          i = this.objectsPerTypes[r],
          s = i.filter(function (a) {
            return !(a instanceof jt);
          }),
          o = [];
        if (!!i.length) {
          if (!e) {
            var _this$eventContext2 = this.eventContext,
              a = _this$eventContext2.stopRaycast,
              l = _this$eventContext2.raycaster,
              u = _this$eventContext2.page,
              c = _this$eventContext2.pointerScreen,
              d = !1;
            if (u.uiCanvas && (d = no(u, [c.x, c.y], Object.keys(this.eventsPerObjects[r]), function (h) {
              o.push(h);
            })), a && !d) {
              var _h102 = Lf(l, u, s);
              o = hg(_h102), _h102.forEach(function (f) {
                var _f$uv$x, _f$uv, _f$uv$y, _f$uv2;
                f.object instanceof fr && no(f.object, [(_f$uv$x = f === null || f === void 0 || (_f$uv = f.uv) === null || _f$uv === void 0 ? void 0 : _f$uv.x) !== null && _f$uv$x !== void 0 ? _f$uv$x : 0, (_f$uv$y = f === null || f === void 0 || (_f$uv2 = f.uv) === null || _f$uv2 === void 0 ? void 0 : _f$uv2.y) !== null && _f$uv$y !== void 0 ? _f$uv$y : 0], Object.keys(_this368.eventsPerObjects[r]), function (p) {
                  o.push(p);
                });
              });
            } else s.forEach(function (h) {
              var _f$uv$x2, _f$uv3, _f$uv$y2, _f$uv4;
              var f = Bf(l, h);
              f && (o.push(h), h instanceof fr && no(h, [(_f$uv$x2 = f === null || f === void 0 || (_f$uv3 = f.uv) === null || _f$uv3 === void 0 ? void 0 : _f$uv3.x) !== null && _f$uv$x2 !== void 0 ? _f$uv$x2 : 0, (_f$uv$y2 = f === null || f === void 0 || (_f$uv4 = f.uv) === null || _f$uv4 === void 0 ? void 0 : _f$uv4.y) !== null && _f$uv$y2 !== void 0 ? _f$uv$y2 : 0], Object.keys(_this368.eventsPerObjects[r]), function (p) {
                o.push(p);
              }));
            });
          }
          this._prevObjects.length && this._prevObjects.forEach(function (a) {
            o.includes(a) || _this368.handleObjectMouseEventDispatchRelease(a, r);
          }), o.length && o.forEach(function (a) {
            _this368.handleObjectMouseEventDispatch(a, r);
          }), this._prevObjects = o;
        }
      }
    }, {
      key: "handleObjectMouseEventDispatch",
      value: function handleObjectMouseEventDispatch(e, r) {
        var _this$eventsPerObject;
        e.dispatchEvent({
          type: "beginEvent",
          eventName: r
        }), (_this$eventsPerObject = this.eventsPerObjects[r]) === null || _this$eventsPerObject === void 0 || (_this$eventsPerObject = _this$eventsPerObject[e.uuid]) === null || _this$eventsPerObject === void 0 ? void 0 : _this$eventsPerObject.forEach(function (i) {
          i.dispatch();
        });
      }
    }, {
      key: "handleObjectMouseEventDispatchRelease",
      value: function handleObjectMouseEventDispatchRelease(e, r) {
        var _this$eventsPerObject2;
        e.dispatchEvent({
          type: "beginEvent",
          eventName: r
        }), (_this$eventsPerObject2 = this.eventsPerObjects[r]) === null || _this$eventsPerObject2 === void 0 || (_this$eventsPerObject2 = _this$eventsPerObject2[e.uuid]) === null || _this$eventsPerObject2 === void 0 ? void 0 : _this$eventsPerObject2.forEach(function (i) {
          i.dispatchRelease();
        });
      }
    }, {
      key: "handleKeyEvent",
      value: function handleKeyEvent(e, r) {
        var _this369 = this;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        this.objectsPerTypes[r].forEach(function (s) {
          var o = _this369.eventsPerObjects[r][s.uuid];
          o.some(function (_ref98) {
            var a = _ref98.data;
            return "key" in a && a.key === e.key;
          }) && s.dispatchEvent({
            type: "beginEvent",
            eventName: r
          }), o.forEach(function (a) {
            "key" in a.data && a.data.key === e.key && (i ? a.dispatchRelease() : a.dispatch(!0));
          });
        });
      }
    }, {
      key: "handleKeyEventHeld",
      value: function handleKeyEventHeld(e, r) {
        var _this370 = this;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
        this.objectsPerTypes[r].forEach(function (s) {
          _this370.eventsPerObjects[r][s.uuid].forEach(function (a) {
            "key" in a.data && a.data.key === e.key && a.dispatchHeld(i);
          });
        });
      }
    }]);
    return db;
  }(Dr);
var kZ = new _(),
  zZ = new _();
var hb = /*#__PURE__*/function () {
  function hb(t, e, r, i, s) {
    _classCallCheck(this, hb);
    this.actionsIn = gr(t, t.inActions, r, i, s, e), this.actionsOut = gr(t, t.outActions, r, i, s, e);
  }
  _createClass(hb, [{
    key: "disconnect",
    value: function disconnect() {
      tr(this.actionsIn), tr(this.actionsOut);
    }
  }]);
  return hb;
}();
var mE = /*#__PURE__*/function (_hb) {
    _inherits(mE, _hb);
    var _super303 = _createSuper(mE);
    function mE(e, r, i, s, o, a) {
      var _this371;
      _classCallCheck(this, mE);
      _this371 = _super303.call(this, r, i, s, o, a);
      _this371.id = e;
      _this371.data = r;
      _this371.object = i;
      _this371.stage = "out";
      _this371.objects = [];
      _this371.onUpdateMatrixWorld = function () {
        var _iterator159 = _createForOfIteratorHelper(_this371.objects),
          _step159;
        try {
          for (_iterator159.s(); !(_step159 = _iterator159.n()).done;) {
            var _s123 = _step159.value;
            if (!_s123.visible) return;
          }
        } catch (err) {
          _iterator159.e(err);
        } finally {
          _iterator159.f();
        }
        var e = kZ.setFromMatrixPosition(_this371.objects[0].matrixWorld),
          r = zZ.setFromMatrixPosition(_this371.objects[1].matrixWorld),
          i = e.distanceTo(r) <= _this371.distance ? "in" : "out";
        if (_this371.stage !== i) {
          _this371.stage = i;
          var _s122 = i === "in" ? _this371.actionsIn : _this371.actionsOut;
          _s122.Audio.forEach(function (o) {
            return o.dispatchConditional();
          }), _s122.Particles.forEach(function (o) {
            return o.dispatchConditional();
          }), _s122.Video.forEach(function (o) {
            return o.dispatchConditional();
          }), _s122.Link.forEach(function (o) {
            return o.dispatch();
          }), _s122.Create.forEach(function (o) {
            return o.dispatch();
          }), _s122.Destroy.forEach(function (o) {
            return o.dispatch();
          }), _s122.Reset.forEach(function (o) {
            return o.dispatch();
          }), _s122.Transition.forEach(function (o) {
            o.object.currentTransitionEvent !== _assertThisInitialized(_this371) && (o.object.currentTransitionEvent = _assertThisInitialized(_this371)), o.init();
          }), _s122.Transition.forEach(function (o) {
            return o.play();
          }), _s122.Animation.forEach(function (o) {
            return o.play();
          }), _s122.SwitchCamera.forEach(function (o) {
            return o.play();
          }), _s122.SceneTransition.forEach(function (o) {
            return o.dispatch();
          }), _s122.SetVariable.forEach(function (o) {
            return o.checkConditions();
          }), _s122.SetVariable.forEach(function (o) {
            return o.dispatch();
          }), _s122.DynamicVariablePlay.forEach(function (o) {
            return o.dispatch();
          });
        }
      };
      var _r$condition = r.condition,
        l = _r$condition.distance,
        u = _r$condition.fromObject,
        c = _r$condition.toObject;
      _this371.distance = l;
      for (var _i184 = 0, _arr2 = [u, c]; _i184 < _arr2.length; _i184++) {
        var d = _arr2[_i184];
        if (!d) throw new Error("Missing property");
        var _h103 = s.find(d);
        if (!_h103) throw new Error("Missing property");
        _this371.objects.push(_h103);
      }
      return _this371;
    }
    _createClass(mE, [{
      key: "connect",
      value: function connect() {
        var _this372 = this;
        window.setTimeout(function () {
          _this372.objects.forEach(function (e) {
            e.addEventListener("updateMatrixWorld", _this372.onUpdateMatrixWorld);
          }), _this372.onUpdateMatrixWorld();
        }, 0);
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this373 = this;
        _get(_getPrototypeOf(mE.prototype), "disconnect", this).call(this), this.stage = "out", this.objects.forEach(function (e) {
          e.removeEventListener("updateMatrixWorld", _this373.onUpdateMatrixWorld);
        });
      }
    }]);
    return mE;
  }(hb),
  gE = /*#__PURE__*/function (_hb2) {
    _inherits(gE, _hb2);
    var _super304 = _createSuper(gE);
    function gE(e, r, i, s, o, a) {
      var _s$find, _this374$toObject$sta;
      var _this374;
      _classCallCheck(this, gE);
      _this374 = _super304.call(this, r, i, s, o, a);
      _this374.id = e;
      _this374.data = r;
      _this374.object = i;
      _this374.onBegin = function (_ref99) {
        var e = _ref99.target,
          r = _ref99.state;
        _this374.toState !== r && (_this374.actionsOut.Audio.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsOut.Particles.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsOut.Video.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsOut.Link.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.Create.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.Destroy.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.Reset.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.Transition.forEach(function (i) {
          return i.pause();
        }), _this374.object.currentTransitionEvent = _assertThisInitialized(_this374), _this374.actionsOut.Transition.forEach(function (i) {
          return i.play();
        }), _this374.actionsOut.Animation.forEach(function (i) {
          return i.play();
        }), _this374.actionsIn.SwitchCamera.forEach(function (i) {
          return i.pause();
        }), _this374.actionsOut.SwitchCamera.forEach(function (i) {
          return i.play();
        }), _this374.actionsOut.SceneTransition.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.SetVariable.forEach(function (i) {
          return i.checkConditions();
        }), _this374.actionsOut.SetVariable.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.DynamicVariablePlay.forEach(function (i) {
          return i.dispatch();
        }));
      };
      _this374.onComplete = function (_ref100) {
        var e = _ref100.target,
          r = _ref100.state;
        _this374.toState === r && (_this374.actionsIn.Audio.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsIn.Particles.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsIn.Video.forEach(function (i) {
          return i.dispatchConditional();
        }), _this374.actionsIn.Link.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.Create.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.Destroy.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.Reset.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsOut.Transition.forEach(function (i) {
          return i.pause();
        }), _this374.actionsOut.Transition.forEach(function (i) {
          return i.pause();
        }), _this374.object.currentTransitionEvent = _assertThisInitialized(_this374), _this374.actionsIn.Transition.forEach(function (i) {
          return i.play();
        }), _this374.actionsIn.Animation.forEach(function (i) {
          return i.play();
        }), _this374.actionsOut.SwitchCamera.forEach(function (i) {
          return i.pause();
        }), _this374.actionsIn.SwitchCamera.forEach(function (i) {
          return i.play();
        }), _this374.actionsIn.SceneTransition.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.SetVariable.forEach(function (i) {
          return i.checkConditions();
        }), _this374.actionsIn.SetVariable.forEach(function (i) {
          return i.dispatch();
        }), _this374.actionsIn.DynamicVariablePlay.forEach(function (i) {
          return i.dispatch();
        }));
      };
      var l = r.condition;
      if (!l.object) throw new Error("Missing property");
      var u = (_s$find = s.find(l.object)) !== null && _s$find !== void 0 ? _s$find : s.scene.find2D(l.object);
      if (!u) throw new Error("Missing property");
      if (_this374.toObject = u, l.state && !((_this374$toObject$sta = _this374.toObject.states) !== null && _this374$toObject$sta !== void 0 && _this374$toObject$sta[l.state])) throw new Error("Missing property");
      _this374.toState = l.state;
      return _this374;
    }
    _createClass(gE, [{
      key: "connect",
      value: function connect() {
        var _this375 = this;
        as(this.actionsOut).forEach(function (e) {
          var _this375$actionsOut$e;
          ((_this375$actionsOut$e = _this375.actionsOut[e]) === null || _this375$actionsOut$e === void 0 ? void 0 : _this375$actionsOut$e.length) && _this375.toObject.addEventListener("beginState", _this375.onBegin);
        }), as(this.actionsIn).forEach(function (e) {
          var _this375$actionsIn$e;
          ((_this375$actionsIn$e = _this375.actionsIn[e]) === null || _this375$actionsIn$e === void 0 ? void 0 : _this375$actionsIn$e.length) && _this375.toObject.addEventListener("completeState", _this375.onComplete);
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this376 = this;
        _get(_getPrototypeOf(gE.prototype), "disconnect", this).call(this), as(this.actionsOut).forEach(function (e) {
          var _this376$actionsIn$e;
          ((_this376$actionsIn$e = _this376.actionsIn[e]) === null || _this376$actionsIn$e === void 0 ? void 0 : _this376$actionsIn$e.length) && _this376.toObject.removeEventListener("beginState", _this376.onBegin);
        }), as(this.actionsIn).forEach(function (e) {
          var _this376$actionsIn$e2;
          ((_this376$actionsIn$e2 = _this376.actionsIn[e]) === null || _this376$actionsIn$e2 === void 0 ? void 0 : _this376$actionsIn$e2.length) && _this376.toObject.removeEventListener("completeState", _this376.onComplete);
        });
      }
    }]);
    return gE;
  }(hb),
  fb = /*#__PURE__*/function (_Dr3) {
    _inherits(fb, _Dr3);
    var _super305 = _createSuper(fb);
    function fb(e, r) {
      var _this377;
      _classCallCheck(this, fb);
      _this377 = _super305.call(this, e);
      _this377.eventsPerConditions = {
        Comparison: [],
        Distance: [],
        State: []
      };
      _this377.hasVideoAction = !1;
      var _this377$eventContext = _this377.eventContext,
        i = _this377$eventContext.page,
        s = _this377$eventContext.sharedAssets;
      i.traverseEntity(function (o) {
        var _o$data;
        if (!!((_o$data = o.data) !== null && _o$data !== void 0 && _o$data.events.length)) {
          var _iterator160 = _createForOfIteratorHelper(o.data.events),
            _step160;
          try {
            for (_iterator160.s(); !(_step160 = _iterator160.n()).done;) {
              var _step160$value = _step160.value,
                a = _step160$value.id,
                l = _step160$value.data;
              if (!l.disabled && l.type === "Conditional") try {
                var u = void 0;
                l.condition.type === "Comparison" || (l.condition.type === "Distance" ? u = new mE(a, l, o, i, s, r) : l.condition.type === "State" && (u = new gE(a, l, o, i, s, r))), u && (_this377.eventsPerConditions[l.condition.type].push(u), (u.actionsIn.Video.length || u.actionsOut.Video.length) && (_this377.hasVideoAction = !0));
              } catch (u) {
                !1 && console.log(u);
              }
            }
          } catch (err) {
            _iterator160.e(err);
          } finally {
            _iterator160.f();
          }
        }
      });
      return _this377;
    }
    _createClass(fb, [{
      key: "connect",
      value: function connect() {
        _get(_getPrototypeOf(fb.prototype), "connect", this).call(this), Object.values(this.eventsPerConditions).forEach(function (e) {
          return e.forEach(function (r) {
            return r.connect();
          });
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        _get(_getPrototypeOf(fb.prototype), "disconnect", this).call(this), Object.values(this.eventsPerConditions).forEach(function (e) {
          return e.forEach(function (r) {
            return r.disconnect();
          });
        });
      }
    }]);
    return fb;
  }(Dr);
var fg = new _(),
  Kl = new _(),
  ou = new _(),
  rN = new qr(),
  VZ = .01,
  Xt = new _(),
  Ti = new _(),
  iN = new _(),
  au = new je(),
  yE = new Kt(),
  UZ = new te(),
  vE = new Qt(),
  Nf = new _(),
  Yo = new _(),
  Ff = .2;
function xE(n, t) {
  !t || (t[0] < t[1] && (n.x = Math.min(Math.max(n.x, t[0]), t[1])), t[2] < t[3] && (n.y = Math.min(Math.max(n.y, t[2]), t[3])), t[4] < t[5] && (n.z = Math.min(Math.max(n.z, t[4]), t[5])));
}
var GZ = function () {
    var n = new te();
    return function (t, e, r) {
      var i = t.obj;
      n.copy(i.hiddenMatrix), i.parent !== null && n.premultiply(i.parent.matrixWorld), n.invert(), i.position.copy(e), t.reference === "global" && xE(i.position, t.limits), i.position.applyMatrix4(n), t.reference === "parent" ? xE(i.position, t.limits) : t.reference === "local" && (au.copy(t.quat0).invert(), i.position.sub(t.position0), i.position.applyQuaternion(au), xE(i.position, t.limits), au.invert(), i.position.applyQuaternion(au), i.position.add(t.position0)), n.multiply(r !== null && r !== void 0 ? r : i.matrixWorld).decompose(Xt, i.quaternion, Ti), i.updateMatrix(), i.hasNonUniformScale && (i.updateMatrixWorld(), i.updateMatrixWorldSVD()), i instanceof nr && An(i.parent) && i.invalidateDownstreamBooleanData(!0);
    };
  }(),
  bE = /*#__PURE__*/function () {
    function bE(t, e, r, i, s, o) {
      var _this378 = this;
      _classCallCheck(this, bE);
      this.object = t;
      this.data = e;
      this.dropDestIds = [];
      this.activeIdx = null;
      this.wasDragEventTriggered = !1;
      this.resetDampingFactor = this.data.resetSpeed === 0 ? 1 : 8 / this.data.resetSpeed + 1, this.snapDampingFactor = this.data.snapSpeed === 0 ? 1 : 8 / this.data.snapSpeed + 1, this.actionsDrag = gr(e, e.dragDropActions.drag, r, i, s, this.object), this.actionsDrop = gr(e, e.dragDropActions.drop, r, i, s, this.object);
      var a = [];
      this.data.objects.forEach(function (l) {
        var u = r.find(l);
        !u || u.data.visible !== !1 && (a.push(u), o[u.uuid] && o[u.uuid].forEach(function (c) {
          var d = r.find(c);
          !d || d.data.visible !== !1 && a.push(d);
        }));
      }), this.data.dropDestinations.forEach(function (l) {
        var u = r.find(l);
        !u || u.data.visible !== !1 && (_this378.dropDestIds.push(u.uuid), o[u.uuid] && o[u.uuid].forEach(function (c) {
          var d = r.find(c);
          !d || d.data.visible !== !1 && _this378.dropDestIds.push(d.uuid);
        }));
      }), this.dragItems = a.map(function (l) {
        return _this378.data.planeMode === "locked" && (l.userData.lockedPlane = !0), l.userData.worldPosition0 = new _().setFromMatrixPosition(l.matrixWorld), {
          obj: l,
          fromPosition: new _().setFromMatrixPosition(l.matrixWorld),
          pointStart: new _(),
          pointEnd: new _(),
          paused: !0,
          currentDampingFactor: _this378.data.dampingFactor,
          reset: !1,
          position0: new _().copy(l.position),
          quat0: new je().copy(l.quaternion),
          snapped: !1,
          orientationMatrix: new te(),
          limits: _this378.data.limits,
          reference: _this378.data.referenceFrame
        };
      });
    }
    _createClass(bE, [{
      key: "activeDragItem",
      get: function get() {
        return this.activeIdx !== null ? this.dragItems[this.activeIdx] : null;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        tr(this.actionsDrag), tr(this.actionsDrop), this.dragItems.forEach(function (t) {
          t.fromPosition.copy(t.obj.userData.worldPosition0), t.pointStart.copy(t.fromPosition), t.pointEnd.copy(t.pointStart), t.obj.recursiveBBoxNeedsUpdate = !0, t.obj.userData.lockedPlane = void 0, t.obj.position.copy(t.position0), t.obj.quaternion.copy(t.quat0), t.obj.updateMatrix();
        });
      }
    }]);
    return bE;
  }(),
  pb = /*#__PURE__*/function (_Dr4) {
    _inherits(pb, _Dr4);
    var _super306 = _createSuper(pb);
    function pb(e, r) {
      var _this379;
      _classCallCheck(this, pb);
      _this379 = _super306.call(this, e);
      _this379.eventManager = r;
      _this379.events = [];
      _this379.lastDropDestination = null;
      _this379.dragTimeout = null;
      _this379.onPointerDown = function (e) {
        if (Ye.length > 1) return;
        _this379.eventContext.updateRaycaster(e);
        var _this379$eventContext = _this379.eventContext,
          r = _this379$eventContext.raycaster,
          i = _this379$eventContext.page,
          s = i.raycastWithClones(r);
        if (_this379.lastDropDestination = null, s.length === 0) {
          _this379.activeEvent = null;
          return;
        }
        var _iterator161 = _createForOfIteratorHelper(_this379.events),
          _step161;
        try {
          for (_iterator161.s(); !(_step161 = _iterator161.n()).done;) {
            var o = _step161.value;
            var a = 0;
            var _iterator162 = _createForOfIteratorHelper(o.dragItems),
              _step162;
            try {
              for (_iterator162.s(); !(_step162 = _iterator162.n()).done;) {
                var _step162$value = _step162.value,
                  l = _step162$value.obj,
                  u = _step162$value.pointEnd,
                  c = _step162$value.pointStart;
                if (l === s[0].object || l === s[0].object.object || ut.is(l) && l.isAncestorOf(s[0].object.uuid)) {
                  var _l$data$physics;
                  if (o.activeIdx = a, o.activeDragItem.reset = !1, o.activeDragItem.currentDampingFactor = o.data.dampingFactor, o.activeDragItem.snapped = !1, o.data.cursor === "hand" && _this379.setCursor("grabbing"), _this379.eventManager.controlsManager.usePhysics) {
                    o.activeDragItem.obj.rigidBody && o.activeDragItem.obj.rigidBody.setBodyType(2, !0);
                    var d = o.activeDragItem.obj;
                    l.hasNonUniformScale && l.updateMatrixWorldSVD(), (d.hasNonUniformScale ? d.matrixWorldRigid : d.matrixWorld).decompose(Xt, au, Ti), yE.setFromQuaternion(au), d.prevR === void 0 ? (d.prevR = yE.clone(), d.prevT = Xt.clone()) : (d.prevR.copy(yE), d.prevT.copy(Xt)), _this379.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj);
                  }
                  _this379.calcPlaneIntersectPos(l, c, o.data.plane, o.data.referenceFrame), u.copy(c), (_this379.eventManager.controlsManager.usePhysics && ((_l$data$physics = l.data.physics) === null || _l$data$physics === void 0 ? void 0 : _l$data$physics.rigidBody) === "dynamic" || o.data.drop === !1 || o.data.resetOnSnapFail === !1) && o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld), _this379.activeEvent = o, _this379.eventManager.controlsManager.orbitControls && (_this379.eventManager.controlsManager.orbitControls.enabled = !1);
                  return;
                }
                a++;
              }
            } catch (err) {
              _iterator162.e(err);
            } finally {
              _iterator162.f();
            }
          }
        } catch (err) {
          _iterator161.e(err);
        } finally {
          _iterator161.f();
        }
        _this379.activeEvent = null;
      };
      _this379.onPointerMove = function (e) {
        if (Ye.length > 1) return;
        _this379.eventContext.updateRaycaster(e);
        var _this379$eventContext2 = _this379.eventContext,
          r = _this379$eventContext2.raycaster,
          i = _this379$eventContext2.page,
          s = i.raycastWithClones(r);
        if (Ye.length === 0) {
          var o = !1;
          var _iterator163 = _createForOfIteratorHelper(_this379.events),
            _step163;
          try {
            for (_iterator163.s(); !(_step163 = _iterator163.n()).done;) {
              var a = _step163.value;
              var _iterator164 = _createForOfIteratorHelper(a.dragItems),
                _step164;
              try {
                for (_iterator164.s(); !(_step164 = _iterator164.n()).done;) {
                  var _s$, _s$2, _s$3;
                  var l = _step164.value.obj;
                  if (l === ((_s$ = s[0]) === null || _s$ === void 0 ? void 0 : _s$.object) || l === ((_s$2 = s[0]) === null || _s$2 === void 0 || (_s$2 = _s$2.object) === null || _s$2 === void 0 ? void 0 : _s$2.object) || ut.is(l) && l.isAncestorOf((_s$3 = s[0]) === null || _s$3 === void 0 ? void 0 : _s$3.object.uuid)) {
                    switch (o = !0, a.data.cursor) {
                      case "hand":
                        _this379.setCursor("grab");
                        break;
                      case "move":
                        _this379.setCursor("move");
                        break;
                      default:
                        break;
                    }
                    break;
                  }
                }
              } catch (err) {
                _iterator164.e(err);
              } finally {
                _iterator164.f();
              }
              if (o) break;
            }
          } catch (err) {
            _iterator163.e(err);
          } finally {
            _iterator163.f();
          }
          o || _this379.setCursor("default");
          return;
        }
        if (_this379.activeEvent && _this379.activeEvent.activeDragItem) {
          var _o79 = _this379.activeEvent.activeDragItem;
          _o79.snapped = !1;
          var _a72;
          if (_this379.activeEvent.data.drop && (_a72 = s.filter(function (l) {
            return _o79.obj !== l.object && !_o79.obj.isAncestorOf(l.object.uuid) && !(l.object instanceof Ss) && (_this379.activeEvent.data.dropOn === "all" || _this379.activeEvent.dropDestIds.some(function (u) {
              return u === l.object.uuid || i.scene.find(u).isAncestorOf(l.object.uuid);
            }));
          })[0]), _a72) {
            var _l96 = iN.copy(_a72.face.normal).applyMatrix3(vE.getNormalMatrix(_a72.object.matrixWorld));
            if (_this379.activeEvent.data.snapTo === "center") _o79.fromPosition.setFromMatrixPosition(_a72.object.matrixWorld);else if (_this379.activeEvent.data.snapTo === "surface") {
              if (_o79.fromPosition.copy(_a72.point), _this379.activeEvent.data.snapSurfaceMode === "bbox") {
                Xt.copy(_l96).applyMatrix3(vE.setFromMatrix4(_o79.obj.matrixWorld).transpose());
                var u = _o79.obj;
                Xt.x > Ff ? Ti.x = -u.recursiveBBox.min.x : Xt.x < -Ff && (Ti.x = -u.recursiveBBox.max.x), Xt.y > Ff ? Ti.y = -u.recursiveBBox.min.y : Xt.y < -Ff && (Ti.y = -u.recursiveBBox.max.y), Xt.z > Ff ? Ti.z = -u.recursiveBBox.min.z : Xt.z < -Ff && (Ti.z = -u.recursiveBBox.max.z), Ti.applyMatrix3(vE.invert());
              } else Ti.copy(_l96).multiplyScalar(_this379.activeEvent.data.snapSurfaceOffset);
              _o79.fromPosition.add(Ti);
            }
            _this379.activeEvent.data.autoOrient && (Xt.set(0, 1, 0).cross(_l96), Xt.length() < 1e-4 && Xt.set(-1, 0, 0).cross(_l96), Ti.crossVectors(iN, Xt), _o79.orientationMatrix.makeBasis(Xt, Ti, _l96)), _o79.pointStart.copy(_o79.fromPosition), _o79.pointEnd.copy(_o79.pointStart), _o79.currentDampingFactor = _this379.activeEvent.snapDampingFactor, _o79.snapped = !0, _this379.lastDropDestination !== _a72.object && (_this379.lastDropDestination = _a72.object, _this379.activeEvent.actionsDrop.Transition.forEach(function (u) {
              u.play();
            }), _this379.activeEvent.actionsDrop.Animation.forEach(function (u) {
              u.play();
            }), _this379.activeEvent.actionsDrop.Audio.forEach(function (u) {
              u.dispatchGameControl("start");
            }), _this379.activeEvent.actionsDrop.Particles.forEach(function (u) {
              u.dispatchGameControl("start");
            }), _this379.activeEvent.actionsDrop.Create.forEach(function (u) {
              u.dispatchThrottled();
            }));
          } else _o79.orientationMatrix.makeRotationFromQuaternion(_o79.quat0), _this379.lastDropDestination = null, _o79.currentDampingFactor = _this379.activeEvent.data.dampingFactor, _this379.calcPlaneIntersectPos(_o79.obj, _o79.pointEnd, _this379.activeEvent.data.plane, _this379.activeEvent.data.referenceFrame), _this379.activeEvent.actionsDrop.Transition.forEach(function (l) {
            l.stop(), l.object.currentState !== null && l.object.changeSelectedState(null, {
              scene: _this379.eventContext.page.scene,
              shared: _this379.eventContext.sharedAssets
            });
          }), _this379.activeEvent.actionsDrop.Animation.forEach(function (l) {
            l.stop();
          }), _this379.activeEvent.actionsDrop.Audio.forEach(function (l) {
            l.dispatchGameControl("stop");
          }), _this379.activeEvent.actionsDrop.Particles.forEach(function (l) {
            l.dispatchGameControl("stop");
          });
          _this379.activeEvent.actionsDrag.Create.forEach(function (l) {
            l.dispatchThrottled();
          }), _this379.activeEvent.actionsDrag.SetVariable.forEach(function (l) {
            return l.checkConditions();
          }), _this379.activeEvent.actionsDrag.SetVariable.forEach(function (l) {
            return l.dispatch();
          }), _this379.activeEvent.actionsDrag.DynamicVariablePlay.forEach(function (l) {
            return l.dispatch();
          }), _this379.activeEvent.wasDragEventTriggered === !1 && (_this379.activeEvent.wasDragEventTriggered = !0, _this379.activeEvent.actionsDrag.Transition.forEach(function (l) {
            l.play();
          }), _this379.activeEvent.actionsDrag.Animation.forEach(function (l) {
            l.play();
          }), _this379.activeEvent.actionsDrag.Audio.forEach(function (l) {
            l.dispatchGameControl("start");
          }), _this379.activeEvent.actionsDrag.Particles.forEach(function (l) {
            l.dispatchGameControl("start");
          })), _this379.dragTimeout && window.clearTimeout(_this379.dragTimeout), _this379.dragTimeout = window.setTimeout(function () {
            !_this379.activeEvent || (_this379.activeEvent.wasDragEventTriggered = !1, _this379.activeEvent.actionsDrag.Audio.forEach(function (l) {
              l.dispatchGameControl("stop");
            }), _this379.activeEvent.actionsDrag.Particles.forEach(function (l) {
              l.dispatchGameControl("stop");
            }), _this379.activeEvent.actionsDrag.Transition.forEach(function (l) {
              l.stop(), l.object.currentState !== null && l.object.changeSelectedState(null, {
                scene: _this379.eventContext.page.scene,
                shared: _this379.eventContext.sharedAssets
              });
            }), _this379.activeEvent.actionsDrag.Animation.forEach(function (l) {
              l.stop();
            }));
          }, 500), _this379.updateDragItem(_o79), _o79.obj.dispatchEvent({
            type: "requestRender"
          });
        }
      };
      _this379.onPointerUp = function (e) {
        if (_this379.activeEvent && _this379.activeEvent.activeDragItem) {
          var _this379$activeEvent$;
          _this379.activeEvent.data.cursor === "hand" && _this379.setCursor("grab");
          var _r68 = ((_this379$activeEvent$ = _this379.activeEvent.activeDragItem.obj.data.physics) === null || _this379$activeEvent$ === void 0 ? void 0 : _this379$activeEvent$.rigidBody) === "dynamic";
          _this379.activeEvent.activeDragItem.snapped === !1 && _this379.activeEvent.data.drop && _this379.activeEvent.data.resetOnSnapFail && (_this379.eventManager.controlsManager.usePhysics === !1 || !_r68) && (_this379.activeEvent.activeDragItem.reset = _this379.activeEvent.data.resetOnSnapFail, _this379.activeEvent.activeDragItem.paused = !1, _this379.activeEvent.activeDragItem.currentDampingFactor = _this379.activeEvent.resetDampingFactor), _this379.eventManager.controlsManager.usePhysics && _r68 && (_this379.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(), _this379.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0, !0), _this379.activeEvent.activeDragItem.paused = !0), _this379.activeEvent.wasDragEventTriggered === !0 && (_this379.activeEvent.wasDragEventTriggered = !1, _this379.activeEvent.actionsDrag.Transition.forEach(function (i) {
            i.stop(), i.object.currentState !== null && i.object.changeSelectedState(null, {
              scene: _this379.eventContext.page.scene,
              shared: _this379.eventContext.sharedAssets
            });
          }), _this379.activeEvent.actionsDrag.Animation.forEach(function (i) {
            i.stop();
          }), _this379.activeEvent.actionsDrag.Audio.forEach(function (i) {
            i.dispatchGameControl("stop");
          }), _this379.activeEvent.actionsDrag.Particles.forEach(function (i) {
            i.dispatchGameControl("stop");
          }), _this379.activeEvent.actionsDrop.SetVariable.forEach(function (i) {
            return i.checkConditions();
          }), _this379.activeEvent.actionsDrop.SetVariable.forEach(function (i) {
            return i.dispatch();
          }), _this379.activeEvent.actionsDrop.DynamicVariablePlay.forEach(function (i) {
            return i.dispatch();
          })), _this379.eventManager.controlsManager.orbitControls && (_this379.eventManager.controlsManager.orbitControls.enabled = !0);
        }
      };
      var i = {};
      e.page.traverseEntity(function (s) {
        s.component && (i[s.component.uuid] ? i[s.component.uuid].push(s.uuid) : i[s.component.uuid] = [s.uuid]);
      }), e.page.traverseEntity(function (s) {
        var _s$data;
        (_s$data = s.data) === null || _s$data === void 0 || _s$data.events.filter(function (o) {
          return o.data.type === "DragDrop" && !o.data.disabled;
        }).forEach(function (o) {
          _this379.events.push(new bE(s, o.data, e.page, e.sharedAssets, r, i));
        });
      });
      return _this379;
    }
    _createClass(pb, [{
      key: "connect",
      value: function connect() {
        if (!this.events.length) return;
        this.domEventsNeeded.clear(), this.domEventsNeeded.add("pointerdown");
        var e = this.eventContext.domElement;
        e.addEventListener("pointerdown", this.onPointerDown), e.addEventListener("pointermove", this.onPointerMove), e.addEventListener("pointerup", this.onPointerUp), this.domEventsNeeded.add("pointermove");
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        if (!this.events.length) return;
        this.domEventsNeeded.clear();
        var e = this.eventContext.domElement;
        e.removeEventListener("pointerdown", this.onPointerDown), e.removeEventListener("pointermove", this.onPointerMove), e.removeEventListener("pointerup", this.onPointerUp), this.events.forEach(function (r) {
          return r.dispose();
        });
      }
    }, {
      key: "setCursor",
      value: function setCursor(e) {
        this.eventContext.domElement.style.cursor = e;
      }
    }, {
      key: "onAnimationFrameDamping",
      value: function onAnimationFrameDamping() {
        var _iterator165 = _createForOfIteratorHelper(this.events),
          _step165;
        try {
          for (_iterator165.s(); !(_step165 = _iterator165.n()).done;) {
            var e = _step165.value;
            var _iterator166 = _createForOfIteratorHelper(e.dragItems),
              _step166;
            try {
              for (_iterator166.s(); !(_step166 = _iterator166.n()).done;) {
                var r = _step166.value;
                r.paused || this.updateDragItem(r, !0);
              }
            } catch (err) {
              _iterator166.e(err);
            } finally {
              _iterator166.f();
            }
          }
        } catch (err) {
          _iterator165.e(err);
        } finally {
          _iterator165.f();
        }
      }
    }, {
      key: "calcPlaneIntersectPos",
      value: function calcPlaneIntersectPos(e, r, i, s) {
        var _this$eventContext3 = this.eventContext,
          o = _this$eventContext3.getCamera,
          a = _this$eventContext3.raycaster;
        o().getWorldDirection(Kl), Kl.negate();
        var l = au.identity();
        switch (s === "parent" ? UZ.multiplyMatrices(e.parent.matrixWorld, e.hiddenMatrix).decompose(Xt, l, Ti) : s === "local" && e.matrixWorld.decompose(Xt, l, Ti), i) {
          case "x":
            Xt.set(1, 0, 0).applyQuaternion(l), Nf.copy(Kl).cross(Xt), Yo.copy(Xt).cross(Nf);
            break;
          case "y":
            Xt.set(0, 1, 0).applyQuaternion(l), Nf.copy(Kl).cross(Xt), Yo.copy(Xt).cross(Nf);
            break;
          case "z":
            Xt.set(0, 0, 1).applyQuaternion(l), Nf.copy(Kl).cross(Xt), Yo.copy(Xt).cross(Nf);
            break;
          case "xy":
            Yo.set(0, 0, 1).applyQuaternion(l);
            break;
          case "yz":
            Yo.set(1, 0, 0).applyQuaternion(l);
            break;
          case "xz":
            Yo.set(0, 1, 0).applyQuaternion(l);
            break;
          case "adaptive":
            Kl.angleTo(Ti.set(0, 1, 0)) > Math.PI / 6 ? (Xt.crossVectors(Ti.set(0, 1, 0), Kl), Yo.crossVectors(Xt, Ti)) : Yo.set(0, 1, 0);
            break;
          default:
            Yo.copy(Kl);
            break;
        }
        ou.setFromMatrixPosition(e.matrixWorld);
        var u = e.userData.lockedPlane ? e.userData.worldPosition0 : ou;
        if (rN.setFromNormalAndCoplanarPoint(Yo, u), !!a.ray.intersectPlane(rN, r) && (i === "x" || i === "y" || i === "z")) {
          var c = Ti.subVectors(r, u).dot(Xt);
          r.copy(u).addScaledVector(Xt, c);
        }
      }
    }, {
      key: "updateDragItem",
      value: function updateDragItem(e) {
        var _this$activeEvent, _this$activeEvent2;
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        ou.setFromMatrixPosition(e.obj.matrixWorld), e.reset === "current" ? fg.subVectors(e.fromPosition, ou).divideScalar(e.currentDampingFactor) : e.reset === "original" ? (fg.subVectors(e.obj.userData.worldPosition0, ou).divideScalar(e.currentDampingFactor), e.fromPosition.copy(e.obj.userData.worldPosition0), e.pointStart.copy(e.fromPosition), e.pointEnd.copy(e.pointStart)) : fg.subVectors(e.pointEnd, e.pointStart).add(e.fromPosition).sub(ou).divideScalar(e.currentDampingFactor), e.paused = e.currentDampingFactor > 1 ? fg.length() < VZ : !0, (this.activeEvent && this.activeEvent.data.dampingFactor === 1 || r) && GZ(e, fg.add(ou), (_this$activeEvent = this.activeEvent) !== null && _this$activeEvent !== void 0 && _this$activeEvent.data.drop && (_this$activeEvent2 = this.activeEvent) !== null && _this$activeEvent2 !== void 0 && _this$activeEvent2.data.autoOrient ? e.orientationMatrix : null), e.obj.dispatchEvent({
          type: "beginEvent",
          eventName: "DragDrop"
        }), this.eventManager.requestRender();
      }
    }]);
    return pb;
  }(Dr);
var kf = new _(),
  SE = new _(),
  ka = new _(),
  za = new _(),
  nN = new qr(),
  jZ = .01,
  HZ = {
    type: "requestRender"
  },
  WZ = function () {
    var n = new _(),
      t = new _();
    return function (e, r, i) {
      return i > 0 ? (n.subVectors(e, r), n.length() <= i ? e : t.copy(r).add(n.normalize().multiplyScalar(i))) : r;
    };
  }(),
  sN = function () {
    var n = new te();
    return function (t, e) {
      t.position.copy(e), t.parent !== null && (n.copy(t.parent.matrixWorld).invert(), t.position.applyMatrix4(n)), n.copy(t.hiddenMatrix).invert(), t.position.applyMatrix4(n), t.updateMatrix(), t.hasNonUniformScale && (t.updateMatrixWorld(), t.updateMatrixWorldSVD()), t instanceof nr && An(t.parent) && t.invalidateDownstreamBooleanData(!0);
    };
  }(),
  wE = /*#__PURE__*/_createClass(function wE(t, e, r, i, s) {
    _classCallCheck(this, wE);
    this.data = t;
    this.object = e;
    this.paused = !1;
    this.currentDampingFactor = 1;
    this.snapComplete = !1;
    this.isReset = !1;
    this.worldPosition0 = new _();
    this.timeoutId = null;
    this.delayFinished = !0;
    this.wasOutside = !1;
    this.data = _objectSpread(_objectSpread(_objectSpread({}, Pv.defaultData), t), t.resetOnPointerLeave === void 0 && {
      resetOnPointerLeave: !1
    }), t.target === void 0 || t.target === "cursor" || (this.target = r.find(t.target)), this.data.dampingFactor && (this.currentDampingFactor = this.data.dampingFactor), this.resetDampingFactor = 80 / this.data.resetSpeed + 1, this.object.getWorldPosition(this.worldPosition0), this.actions = gr(t, t.actions, r, i, s, e);
  }),
  mb = /*#__PURE__*/function (_Dr5) {
    _inherits(mb, _Dr5);
    var _super307 = _createSuper(mb);
    function mb(e, r) {
      var _this380;
      _classCallCheck(this, mb);
      _this380 = _super307.call(this, e);
      _this380.events = [];
      _this380.pairOfEventListeners = [];
      _this380.onMouseMove = function (e) {
        if (!(Ye.length > 1)) {
          _this380.eventContext.updateRaycaster(e);
          var _iterator167 = _createForOfIteratorHelper(_this380.events),
            _step167;
          try {
            for (_iterator167.s(); !(_step167 = _iterator167.n()).done;) {
              var _r69 = _step167.value;
              _r69.target === void 0 && _this380.updateSingleEvent(_r69);
            }
          } catch (err) {
            _iterator167.e(err);
          } finally {
            _iterator167.f();
          }
        }
      };
      _this380.onMouseEnter = function (e) {
        var _iterator168 = _createForOfIteratorHelper(_this380.events),
          _step168;
        try {
          for (_iterator168.s(); !(_step168 = _iterator168.n()).done;) {
            var _r70 = _step168.value;
            _r70.target === void 0 && (_r70.isReset = !1, _r70.currentDampingFactor = _r70.data.dampingFactor);
          }
        } catch (err) {
          _iterator168.e(err);
        } finally {
          _iterator168.f();
        }
      };
      _this380.onMouseLeave = function (e) {
        var _iterator169 = _createForOfIteratorHelper(_this380.events),
          _step169;
        try {
          for (_iterator169.s(); !(_step169 = _iterator169.n()).done;) {
            var _r71 = _step169.value;
            _r71.target === void 0 && (_r71.data.resetOnPointerLeave && (_r71.isReset = !0, _r71.currentDampingFactor = _r71.resetDampingFactor), _this380.updateSingleEvent(_r71));
          }
        } catch (err) {
          _iterator169.e(err);
        } finally {
          _iterator169.f();
        }
      };
      _this380.onTargetChange = function (e) {
        return function () {
          _this380.updateSingleEvent(e);
        };
      };
      var i = _this380.eventContext.page;
      i.traverseEntity(function (s) {
        var _s$data2, _s$dataPatched$physic;
        var o = (_s$data2 = s.data) === null || _s$data2 === void 0 ? void 0 : _s$data2.events.find(function (a) {
          return a.data.type === "Follow" && !a.data.disabled;
        });
        o && (!i.data.globalPhysics.usePhysics || ((_s$dataPatched$physic = s.dataPatched.physics) === null || _s$dataPatched$physic === void 0 ? void 0 : _s$dataPatched$physic.rigidBody) !== "dynamic") && _this380.events.push(new wE(o.data, s, i, e.sharedAssets, r));
      });
      return _this380;
    }
    _createClass(mb, [{
      key: "connect",
      value: function connect() {
        if (!this.events.length) return;
        var _this$eventContext4 = this.eventContext,
          e = _this$eventContext4.domElement,
          r = _this$eventContext4.eventElement;
        this.domEventsNeeded.clear(), Si && (this.domEventsNeeded.add("pointerdown"), e.addEventListener("pointerdown", this.onMouseMove)), this.domEventsNeeded.add("pointermove"), r.addEventListener("pointermove", this.onMouseMove), this.eventContext.useWindowEvents || (e.addEventListener("pointerenter", this.onMouseEnter), e.addEventListener("pointerleave", this.onMouseLeave));
        var _iterator170 = _createForOfIteratorHelper(this.events),
          _step170;
        try {
          for (_iterator170.s(); !(_step170 = _iterator170.n()).done;) {
            var _i185 = _step170.value;
            if (_i185.target !== void 0) {
              var _s124 = _i185.target,
                o = this.onTargetChange(_i185);
              this.pairOfEventListeners.push([_s124, o]), _s124.addEventListener("requestRender", o);
            }
          }
        } catch (err) {
          _iterator170.e(err);
        } finally {
          _iterator170.f();
        }
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        if (!this.events.length) return;
        var _this$eventContext5 = this.eventContext,
          e = _this$eventContext5.domElement,
          r = _this$eventContext5.eventElement;
        this.domEventsNeeded.clear(), Si && e.removeEventListener("pointerdown", this.onMouseMove), r.removeEventListener("pointermove", this.onMouseMove), e.removeEventListener("pointerenter", this.onMouseEnter), e.removeEventListener("pointerleave", this.onMouseLeave);
        var _iterator171 = _createForOfIteratorHelper(this.pairOfEventListeners),
          _step171;
        try {
          for (_iterator171.s(); !(_step171 = _iterator171.n()).done;) {
            var _step171$value = _slicedToArray(_step171.value, 2),
              _i186 = _step171$value[0],
              _s125 = _step171$value[1];
            _i186.removeEventListener("requestRender", _s125);
          }
        } catch (err) {
          _iterator171.e(err);
        } finally {
          _iterator171.f();
        }
        var _iterator172 = _createForOfIteratorHelper(this.events),
          _step172;
        try {
          for (_iterator172.s(); !(_step172 = _iterator172.n()).done;) {
            var _i187 = _step172.value;
            _i187.paused = !0, _i187.isReset = !1, tr(_i187.actions);
          }
        } catch (err) {
          _iterator172.e(err);
        } finally {
          _iterator172.f();
        }
      }
    }, {
      key: "onAnimationFrameDamping",
      value: function onAnimationFrameDamping() {
        var _iterator173 = _createForOfIteratorHelper(this.events),
          _step173;
        try {
          for (_iterator173.s(); !(_step173 = _iterator173.n()).done;) {
            var e = _step173.value;
            e.paused || this.updateSingleEvent(e, !0);
          }
        } catch (err) {
          _iterator173.e(err);
        } finally {
          _iterator173.f();
        }
      }
    }, {
      key: "updateSingleEvent",
      value: function updateSingleEvent(e) {
        var _this381 = this,
          _e$object;
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
        this.events.forEach(function (l) {
          l.actions.Create.forEach(function (u) {
            u.dispatchThrottled();
          });
        });
        var _e$data2 = e.data,
          i = _e$data2.plane,
          s = _e$data2.limitDistance,
          o = _e$data2.limitDistanceEnabled;
        if (e.object.getWorldPosition(ka), e.isReset) za.copy(e.worldPosition0);else if (e.target) e.target.getWorldPosition(za);else {
          var _this$eventContext6 = this.eventContext,
            l = _this$eventContext6.getCamera,
            u = _this$eventContext6.raycaster;
          if (i === "custom" ? (l().getWorldDirection(SE), SE.negate(), kf.copy(SE)) : i === "xy" ? kf.set(0, 0, 1) : i === "xz" ? kf.set(0, 1, 0) : i === "yz" && kf.set(1, 0, 0), nN.setFromNormalAndCoplanarPoint(kf, ka), !u.ray.intersectPlane(nN, za)) return;
        }
        if (!e.isReset) {
          if (za.distanceTo(e.worldPosition0) > s && o && e.target) {
            if (e.snapComplete = !1, e.data.snapDelay && (e.delayFinished = !1, (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && e.timeoutId !== null && (window.clearTimeout(e.timeoutId), e.timeoutId = null)), e.wasOutside = !0, e.data.resetAfterDistanceLimit) za.copy(e.worldPosition0), e.currentDampingFactor = e.resetDampingFactor;else return;
          } else if (e.wasOutside && (e.data.snapDelay && (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && (e.timeoutId = window.setTimeout(function () {
            e.delayFinished = !0, e.paused = !1, _this381.updateSingleEvent(e);
          }, e.data.snapDelay * 1e3)), e.currentDampingFactor = e.data.dampingFactor, e.wasOutside = !1), e.delayFinished === !1) return;
        }
        e.data.enabledTranslation[0] === !1 && (za.x = ka.x), e.data.enabledTranslation[1] === !1 && (za.y = ka.y), e.data.enabledTranslation[2] === !1 && (za.z = ka.z);
        var a = WZ(ka, za, e.wasOutside ? 0 : e.data.maxDelta);
        if (e.currentDampingFactor > 1) {
          var _l97 = kf.subVectors(a, ka).divideScalar(e.currentDampingFactor);
          ka.add(_l97), r && sN(e.object, ka), e.paused = _l97.length() < jZ;
        } else sN(e.object, a), e.paused = !0;
        (_e$object = e.object) !== null && _e$object !== void 0 && _e$object.dispatchEvent({
          type: "beginEvent",
          eventName: "Follow"
        }), e.object.dispatchEvent(HZ);
      }
    }]);
    return mb;
  }(Dr);
var pg = new _(),
  gb = new _(),
  mg = new te(),
  zf = new je(),
  Zl = new je(),
  gg = new _(),
  yg = new _(),
  lu = new _(),
  Va = new _(),
  AE = new qr(),
  qZ = 1e-6,
  YZ = {
    type: "requestRender"
  },
  XZ = {
    type: "changeRotation"
  },
  oN = function () {
    var n = new te();
    return function (e, r) {
      e.parent !== null ? n.multiplyMatrices(e.parent.matrixWorld, e.hiddenMatrix) : n.copy(e.hiddenMatrix), r.premultiply(hE(n).invert()), e.rotation.setFromRotationMatrix(r), e.updateMatrix(), e instanceof nr && An(e.parent) && e.invalidateDownstreamBooleanData(!0);
    };
  }(),
  _E = /*#__PURE__*/_createClass(function _E(t, e, r) {
    _classCallCheck(this, _E);
    this.object = e;
    this.paused = !1;
    this.currentDampingFactor = 1;
    this.isReset = !1;
    this.worldQuaternion0 = new je();
    this.timeoutId = null;
    this.delayFinished = !0;
    this.wasOutside = !1;
    this.data = _objectSpread(_objectSpread(_objectSpread({}, Dv.defaultData), t), t.resetOnPointerLeave === void 0 && {
      resetOnPointerLeave: !1
    }), t.target === void 0 || t.target === "cursor" || (this.target = r.find(t.target)), this.data.dampingFactor && (this.currentDampingFactor = this.data.dampingFactor), this.object.getWorldQuaternion(this.worldQuaternion0), this.resetDampingFactor = 80 / this.data.resetSpeed + 1;
  }),
  yb = /*#__PURE__*/function (_Dr6) {
    _inherits(yb, _Dr6);
    var _super308 = _createSuper(yb);
    function yb(e) {
      var _this382;
      _classCallCheck(this, yb);
      _this382 = _super308.call(this, e);
      _this382.events = [];
      _this382.pairOfEventListeners = [];
      _this382.pairOfUserEventListeners = [];
      _this382.onMouseMove = function (e) {
        if (!(Ye.length > 1)) {
          _this382._lastMouseEvent = e, _this382.eventContext.updateRaycaster(e);
          var _iterator174 = _createForOfIteratorHelper(_this382.events),
            _step174;
          try {
            for (_iterator174.s(); !(_step174 = _iterator174.n()).done;) {
              var _r72 = _step174.value;
              _r72.target === void 0 && _this382.updateSingleEvent(_r72);
            }
          } catch (err) {
            _iterator174.e(err);
          } finally {
            _iterator174.f();
          }
        }
      };
      _this382.onMouseEnter = function (e) {
        var _iterator175 = _createForOfIteratorHelper(_this382.events),
          _step175;
        try {
          for (_iterator175.s(); !(_step175 = _iterator175.n()).done;) {
            var _r73 = _step175.value;
            _r73.target === void 0 && (_r73.isReset = !1, _r73.currentDampingFactor = _r73.data.dampingFactor);
          }
        } catch (err) {
          _iterator175.e(err);
        } finally {
          _iterator175.f();
        }
      };
      _this382.onMouseLeave = function (e) {
        var _iterator176 = _createForOfIteratorHelper(_this382.events),
          _step176;
        try {
          for (_iterator176.s(); !(_step176 = _iterator176.n()).done;) {
            var _r74 = _step176.value;
            _r74.target === void 0 && (_r74.data.resetOnPointerLeave && (_r74.isReset = !0, _r74.currentDampingFactor = _r74.resetDampingFactor), _this382.updateSingleEvent(_r74));
          }
        } catch (err) {
          _iterator176.e(err);
        } finally {
          _iterator176.f();
        }
      };
      _this382.onScroll = function (e) {
        if (_this382._lastMouseEvent) {
          var _r75 = new PointerEvent("pointermove", {
            clientX: _this382._lastMouseEvent.clientX,
            clientY: _this382._lastMouseEvent.clientY,
            bubbles: !0,
            cancelable: !0,
            view: window
          });
          _this382.eventContext.eventElement.dispatchEvent(_r75);
        }
      };
      _this382.onTargetChange = function (e) {
        return function () {
          _this382.updateSingleEvent(e);
        };
      };
      _this382.createUserEventListener = function (e) {
        return function (_ref101) {
          var r = _ref101.eventName,
            i = _ref101.target;
          if (!r || !i) return;
          var s = qo(r);
          s && s === "LookAt" && _this382.updateSingleEvent(e);
        };
      };
      var r = _this382.eventContext.page;
      r.traverseEntity(function (i) {
        var _i$data2, _i$dataPatched$physic;
        var s = (_i$data2 = i.data) === null || _i$data2 === void 0 ? void 0 : _i$data2.events.find(function (o) {
          return o.data.type === "LookAt" && !o.data.disabled;
        });
        s && (!r.data.globalPhysics.usePhysics || ((_i$dataPatched$physic = i.dataPatched.physics) === null || _i$dataPatched$physic === void 0 ? void 0 : _i$dataPatched$physic.rigidBody) !== "dynamic") && _this382.events.push(new _E(s.data, i, r));
      });
      return _this382;
    }
    _createClass(yb, [{
      key: "connect",
      value: function connect() {
        if (!this.events.length) return;
        var _this$eventContext7 = this.eventContext,
          e = _this$eventContext7.domElement,
          r = _this$eventContext7.eventElement;
        this.domEventsNeeded.clear(), Si && (this.domEventsNeeded.add("pointerdown"), e.addEventListener("pointerdown", this.onMouseMove)), this.domEventsNeeded.add("pointermove"), r.addEventListener("pointermove", this.onMouseMove), this.eventContext.useWindowEvents ? r.addEventListener("scroll", this.onScroll) : (e.addEventListener("pointerenter", this.onMouseEnter), e.addEventListener("pointerleave", this.onMouseLeave));
        var _iterator177 = _createForOfIteratorHelper(this.events),
          _step177;
        try {
          for (_iterator177.s(); !(_step177 = _iterator177.n()).done;) {
            var _i188 = _step177.value;
            if (_i188.target !== void 0) {
              var a = this.onTargetChange(_i188),
                l = _i188.target;
              this.pairOfEventListeners.push([l, a]), l.addEventListener("requestRender", a);
            }
            var _s126 = this.createUserEventListener(_i188),
              o = _i188.object;
            this.pairOfUserEventListeners.push([o, _s126]), o.addEventListener("userEvent", _s126);
          }
        } catch (err) {
          _iterator177.e(err);
        } finally {
          _iterator177.f();
        }
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        if (!this.events.length) return;
        var _this$eventContext8 = this.eventContext,
          e = _this$eventContext8.domElement,
          r = _this$eventContext8.eventElement;
        this.domEventsNeeded.clear(), Si && e.removeEventListener("pointerdown", this.onMouseMove), r.removeEventListener("pointermove", this.onMouseMove), e.removeEventListener("pointerenter", this.onMouseEnter), e.removeEventListener("pointerleave", this.onMouseLeave), r.removeEventListener("scroll", this.onScroll);
        var _iterator178 = _createForOfIteratorHelper(this.pairOfEventListeners),
          _step178;
        try {
          for (_iterator178.s(); !(_step178 = _iterator178.n()).done;) {
            var _step178$value = _slicedToArray(_step178.value, 2),
              _i189 = _step178$value[0],
              _s127 = _step178$value[1];
            _i189.removeEventListener("requestRender", _s127);
          }
        } catch (err) {
          _iterator178.e(err);
        } finally {
          _iterator178.f();
        }
        var _iterator179 = _createForOfIteratorHelper(this.pairOfUserEventListeners),
          _step179;
        try {
          for (_iterator179.s(); !(_step179 = _iterator179.n()).done;) {
            var _step179$value = _slicedToArray(_step179.value, 2),
              _i190 = _step179$value[0],
              _s128 = _step179$value[1];
            _i190.removeEventListener("userEvent", _s128);
          }
        } catch (err) {
          _iterator179.e(err);
        } finally {
          _iterator179.f();
        }
        var _iterator180 = _createForOfIteratorHelper(this.events),
          _step180;
        try {
          for (_iterator180.s(); !(_step180 = _iterator180.n()).done;) {
            var _i191 = _step180.value;
            _i191.paused = !0, _i191.isReset = !1;
          }
        } catch (err) {
          _iterator180.e(err);
        } finally {
          _iterator180.f();
        }
      }
    }, {
      key: "onAnimationFrameDamping",
      value: function onAnimationFrameDamping() {
        var _iterator181 = _createForOfIteratorHelper(this.events),
          _step181;
        try {
          for (_iterator181.s(); !(_step181 = _iterator181.n()).done;) {
            var e = _step181.value;
            e.paused || this.updateSingleEvent(e);
          }
        } catch (err) {
          _iterator181.e(err);
        } finally {
          _iterator181.f();
        }
      }
    }, {
      key: "updateSingleEvent",
      value: function updateSingleEvent(e) {
        var _this383 = this,
          _e$object2;
        var _e$data3 = e.data,
          r = _e$data3.tilt,
          i = _e$data3.axis,
          s = _e$data3.distance,
          o = _e$data3.plane,
          a = _e$data3.limitDistance,
          l = _e$data3.enabledRotation,
          u = _e$data3.limitDistanceEnabled,
          _this$eventContext9 = this.eventContext,
          c = _this$eventContext9.getCamera,
          d = _this$eventContext9.raycaster,
          h = e.object,
          f = e.target;
        if (h.getWorldPosition(gg), !e.isReset) if (e.target) e.target.getWorldPosition(yg);else {
          if (o === "custom" ? (c().getWorldDirection(gb), gb.negate(), AE.setFromNormalAndCoplanarPoint(gb, gg)) : (o === "xy" ? pg.set(0, 0, 1) : o === "xz" ? pg.set(0, 1, 0) : o === "yz" && pg.set(1, 0, 0), AE.setFromNormalAndCoplanarPoint(pg, gg)), !d.ray.intersectPlane(AE, yg)) return;
          s > 0 && (o === "custom" || o === void 0) && yg.addScaledVector(gb, s);
        }
        if (e.isReset || (f ? r === "target" ? lu.copy(f.up).applyMatrix4(mg.extractRotation(f.matrixWorld)).normalize() : l.some(function (p) {
          return p === !1;
        }) ? (i === "x" ? (Va.set(0, 0, 1), l[2] === !1 && Va.set(0, 1, 0)) : i === "y" ? (Va.set(1, 0, 0), l[0] === !1 && Va.set(0, 0, 1)) : (Va.set(0, 1, 0), l[1] === !1 && Va.set(1, 0, 0)), lu.copy(Va).applyQuaternion(e.worldQuaternion0).normalize()) : lu.set(0, 1, 0) : o === "custom" ? lu.set(0, 1, 0) : lu.copy(pg)), e.isReset) Zl.copy(e.worldQuaternion0);else if (gg.distanceTo(yg) > a && u && f) {
          if (e.data.snapDelay && (e.delayFinished = !1, (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && e.timeoutId !== null && (window.clearTimeout(e.timeoutId), e.timeoutId = null)), e.wasOutside = !0, e.data.resetAfterDistanceLimit) Zl.copy(e.worldQuaternion0), e.currentDampingFactor = e.resetDampingFactor;else return;
        } else {
          if (e.wasOutside && (e.data.snapDelay && (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" && (e.timeoutId = window.setTimeout(function () {
            e.delayFinished = !0, e.paused = !1, _this383.updateSingleEvent(e);
          }, e.data.snapDelay * 1e3)), e.currentDampingFactor = e.data.dampingFactor, e.wasOutside = !1), e.delayFinished === !1) return;
          QZ(mg, yg, gg, lu, i, Va), Zl.setFromRotationMatrix(mg), zf.setFromUnitVectors(Va.applyQuaternion(Zl), lu), l.some(function (p) {
            return p === !1;
          }) && r !== "target" && Zl.premultiply(zf).normalize();
        }
        e.currentDampingFactor > 1 ? (h.updateWorldMatrix(!0, !1), zf.setFromRotationMatrix(hE(h.matrixWorld)), zf.slerp(Zl, 1 / e.currentDampingFactor), oN(h, mg.makeRotationFromQuaternion(zf)), e.paused = 8 * (1 - zf.dot(Zl)) < qZ) : (oN(h, mg.makeRotationFromQuaternion(Zl)), e.paused = !0), (_e$object2 = e.object) !== null && _e$object2 !== void 0 && _e$object2.dispatchEvent({
          type: "beginEvent",
          eventName: "LookAt"
        }), h.dispatchEvent(YZ), h.dispatchEvent(XZ);
      }
    }]);
    return yb;
  }(Dr),
  Ts = new _(),
  Mi = new _(),
  ei = new _();
function QZ(n, t, e, r, i, s) {
  var _ref102, _ref103, _ref104, _ref105, _ref106;
  var o = n.elements;
  ei.subVectors(t, e), ei.lengthSq() === 0 && (ei.z = 1), ei.normalize(), Mi.crossVectors(r, ei), Mi.lengthSq() === 0 && (Math.abs(r.z) === 1 ? ei.x += 1e-4 : ei.z += 1e-4, ei.normalize(), Mi.crossVectors(r, ei)), Mi.normalize(), Ts.crossVectors(ei, Mi), i === "x" ? s.z === 1 ? (_ref102 = [ei, Mi, Ts], Mi = _ref102[0], Ts = _ref102[1], ei = _ref102[2], _ref102) : (Mi.negate(), (_ref103 = [ei, Mi], Mi = _ref103[0], ei = _ref103[1])) : i === "y" ? s.x === 1 ? (_ref104 = [Ts, ei, Mi], Mi = _ref104[0], Ts = _ref104[1], ei = _ref104[2], _ref104) : (Mi.negate(), (_ref105 = [ei, Ts], Ts = _ref105[0], ei = _ref105[1])) : s.x === 1 && (Mi.negate(), (_ref106 = [Ts, Mi], Mi = _ref106[0], Ts = _ref106[1])), o[0] = Mi.x, o[4] = Ts.x, o[8] = ei.x, o[1] = Mi.y, o[5] = Ts.y, o[9] = ei.y, o[2] = Mi.z, o[6] = Ts.z, o[10] = ei.z;
}
var EE = /*#__PURE__*/function () {
    function EE(t, e, r, i, s, o) {
      _classCallCheck(this, EE);
      this.id = t;
      this.data = e;
      this.object = r;
      this.entered = !1;
      this.actions = gr(e, e.actions, i, s, o, r);
    }
    _createClass(EE, [{
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "dispatchEnter",
      value: function dispatchEnter() {
        var _this384 = this;
        this.actions.Transition.forEach(function (t) {
          t.object.currentTransitionEvent !== _this384 && (t.object.currentTransitionEvent = _this384, t.init());
        }), this.entered || (this.entered = !0, this.actions.Transition.forEach(function (t) {
          return t.playFromCurrent();
        }), this.actions.Animation.forEach(function (t) {
          return t.play();
        }), this.actions.Create.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Particles.forEach(function (t) {
          return t.dispatchBasic();
        }), this.actions.Destroy.forEach(function (t) {
          return t.dispatch();
        }), this.actions.SwitchCamera.forEach(function (t) {
          return t.playFromCurrent();
        }), this.actions.SceneTransition.forEach(function (t) {
          return t.dispatch();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.checkConditions();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (t) {
          return t.dispatch();
        }));
      }
    }, {
      key: "dispatchLeave",
      value: function dispatchLeave() {
        var _this385 = this;
        this.actions.Transition.forEach(function (t) {
          t.object.currentTransitionEvent !== _this385 && (t.object.currentTransitionEvent = _this385, t.init());
        }), this.entered && (this.entered = !1, this.actions.Transition.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.Particles.forEach(function (t) {
          return t.reverseFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (t) {
          return t.reverseFromCurrent();
        }));
      }
    }, {
      key: "dispatchUserEvent",
      value: function dispatchUserEvent(t) {
        var _this386 = this;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this386 && (e.object.currentTransitionEvent = _this386, e.init());
        }), t ? (this.actions.Transition.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Particles.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.reverseFromCurrent();
        })) : (this.actions.Transition.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Create.forEach(function (e) {
          return e.dispatch();
        }), this.actions.Particles.forEach(function (e) {
          return e.dispatchBasic();
        }), this.actions.Destroy.forEach(function (e) {
          return e.dispatch();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.playFromCurrent();
        })), this.actions.SceneTransition.forEach(function (e) {
          return e.dispatch();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }]);
    return EE;
  }(),
  vb = /*#__PURE__*/function (_Dr7) {
    _inherits(vb, _Dr7);
    var _super309 = _createSuper(vb);
    function vb(e, r) {
      var _this387;
      _classCallCheck(this, vb);
      _this387 = _super309.call(this, e);
      _this387.eventsPerObjects = {};
      _this387.objects = [];
      _this387.objects2D = [];
      _this387._prevObjects = [];
      _this387.onMouseDown = function (e) {
        Ye.length > 1 || (_this387.eventContext.updateRaycaster(e), _this387.handleMouseHoverEvent());
      };
      _this387.onMouseUp = function (e) {
        Ye.length > 1 || _this387.handleMouseHoverEvent(!0);
      };
      _this387.onMouseMove = function (e) {
        Ye.length > 1 || (_this387.eventContext.updateRaycaster(e), _this387.handleMouseHoverEvent());
      };
      _this387.onUserEvent = function (_ref107) {
        var _this387$eventsPerObj;
        var e = _ref107.eventName,
          r = _ref107.target,
          i = _ref107.reverse;
        if (!e || !r) return;
        var s = qo(e);
        s && s === "MouseHover" && (r.dispatchEvent({
          type: "beginEvent",
          eventName: "MouseHover"
        }), (_this387$eventsPerObj = _this387.eventsPerObjects[r.uuid]) === null || _this387$eventsPerObj === void 0 ? void 0 : _this387$eventsPerObj.forEach(function (o) {
          return o.dispatchUserEvent(i);
        }));
      };
      var _this387$eventContext = _this387.eventContext,
        i = _this387$eventContext.page,
        s = _this387$eventContext.sharedAssets,
        o = function o(a, l) {
          var _a$data;
          if (!(!a.visible || !((_a$data = a.data) !== null && _a$data !== void 0 && _a$data.events.length))) {
            var _this387$eventsPerObj2;
            var _iterator182 = _createForOfIteratorHelper(a.data.events),
              _step182;
            try {
              for (_iterator182.s(); !(_step182 = _iterator182.n()).done;) {
                var _step182$value = _step182.value,
                  u = _step182$value.id,
                  c = _step182$value.data;
                if (!c.disabled && c.type === "MouseHover") try {
                  var d = new EE(u, c, a, i, s, r);
                  _this387.eventsPerObjects[a.uuid] ? _this387.eventsPerObjects[a.uuid].push(d) : _this387.eventsPerObjects[a.uuid] = [d];
                } catch (d) {
                  !1 && console.log(d);
                }
              }
            } catch (err) {
              _iterator182.e(err);
            } finally {
              _iterator182.f();
            }
            ((_this387$eventsPerObj2 = _this387.eventsPerObjects[a.uuid]) === null || _this387$eventsPerObj2 === void 0 ? void 0 : _this387$eventsPerObj2.length) && _this387.objects.push(a instanceof jt ? l : a);
          }
        };
      i.traverseEntity(function (a) {
        var _a$frame;
        (a instanceof fr || a instanceof sr) && (_a$frame = a.frame) !== null && _a$frame !== void 0 && _a$frame.traverse(function (l) {
          o(l, a);
        }), o(a);
      });
      return _this387;
    }
    _createClass(vb, [{
      key: "connect",
      value: function connect() {
        var _this388 = this;
        if (!this.objects.length) return;
        var e = this.eventContext.domElement;
        this.domEventsNeeded.clear(), Si && (this.domEventsNeeded.add("pointerdown"), e.addEventListener("pointerdown", this.onMouseDown), this.domEventsNeeded.add("pointerup"), e.addEventListener("pointerup", this.onMouseUp)), this.domEventsNeeded.add("pointermove"), e.addEventListener("pointermove", this.onMouseMove), this.objects.forEach(function (r) {
          r.addEventListener("userEvent", _this388.onUserEvent);
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this389 = this;
        if (!this.objects.length) return;
        var e = this.eventContext.domElement;
        this.domEventsNeeded.clear(), Si && (e.removeEventListener("pointerdown", this.onMouseDown), e.removeEventListener("pointerup", this.onMouseUp)), e.removeEventListener("pointermove", this.onMouseMove), Object.values(this.eventsPerObjects).forEach(function (r) {
          r.forEach(function (i) {
            i.disconnect();
          });
        }), this.objects.forEach(function (r) {
          r.removeEventListener("userEvent", _this389.onUserEvent);
        });
      }
    }, {
      key: "handleMouseHoverEvent",
      value: function handleMouseHoverEvent() {
        var _this390 = this;
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
        var r = [];
        if (!e) {
          var _this$eventContext10 = this.eventContext,
            _i192 = _this$eventContext10.stopRaycast,
            _s129 = _this$eventContext10.raycaster,
            o = _this$eventContext10.page,
            a = _this$eventContext10.pointerScreen,
            l = !1;
          if (o.uiCanvas && (l = no(o, [a.x, a.y], Object.keys(this.eventsPerObjects), function (u) {
            r.push(u);
          })), _i192 && !l) {
            var u = Lf(_s129, o, this.objects);
            r = hg(u), u.forEach(function (c) {
              var _c$uv$x2, _c$uv3, _c$uv$y2, _c$uv4;
              c.object instanceof fr && no(c.object, [(_c$uv$x2 = c === null || c === void 0 || (_c$uv3 = c.uv) === null || _c$uv3 === void 0 ? void 0 : _c$uv3.x) !== null && _c$uv$x2 !== void 0 ? _c$uv$x2 : 0, (_c$uv$y2 = c === null || c === void 0 || (_c$uv4 = c.uv) === null || _c$uv4 === void 0 ? void 0 : _c$uv4.y) !== null && _c$uv$y2 !== void 0 ? _c$uv$y2 : 0], Object.keys(_this390.eventsPerObjects), function (d) {
                r.push(d);
              });
            });
          } else this.objects.forEach(function (u) {
            var _c$uv$x3, _c$uv5, _c$uv$y3, _c$uv6;
            var c = Bf(_s129, u);
            c && (r.push(u), u instanceof fr && no(u, [(_c$uv$x3 = c === null || c === void 0 || (_c$uv5 = c.uv) === null || _c$uv5 === void 0 ? void 0 : _c$uv5.x) !== null && _c$uv$x3 !== void 0 ? _c$uv$x3 : 0, (_c$uv$y3 = c === null || c === void 0 || (_c$uv6 = c.uv) === null || _c$uv6 === void 0 ? void 0 : _c$uv6.y) !== null && _c$uv$y3 !== void 0 ? _c$uv$y3 : 0], Object.keys(_this390.eventsPerObjects), function (d) {
              r.push(d);
            }));
          });
        }
        this._prevObjects.length && this._prevObjects.forEach(function (i) {
          var _this390$eventsPerObj;
          r.includes(i) || (i.dispatchEvent({
            type: "beginEvent",
            eventName: "MouseHover"
          }), (_this390$eventsPerObj = _this390.eventsPerObjects[i.uuid]) === null || _this390$eventsPerObj === void 0 ? void 0 : _this390$eventsPerObj.forEach(function (s) {
            return s.dispatchLeave();
          }));
        }), r.length && r.forEach(function (i) {
          var _this390$eventsPerObj2;
          i.dispatchEvent({
            type: "beginEvent",
            eventName: "MouseHover"
          }), (_this390$eventsPerObj2 = _this390.eventsPerObjects[i.uuid]) === null || _this390$eventsPerObj2 === void 0 ? void 0 : _this390$eventsPerObj2.forEach(function (s) {
            return s.dispatchEnter();
          });
        }), this._prevObjects = r;
      }
    }]);
    return vb;
  }(Dr);
var TE = /*#__PURE__*/function () {
    function TE(t, e, r, i, s, o) {
      _classCallCheck(this, TE);
      this.id = t;
      this.data = e;
      this.object = r;
      this.scrollCounter = 0;
      this.actions = gr(e, e.actions, i, s, o, r);
    }
    _createClass(TE, [{
      key: "connect",
      value: function connect() {
        this.scrollCounter = 0;
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "dispatch",
      value: function dispatch(t) {
        var _this391 = this;
        this.actions.Transition.forEach(function (i) {
          i.object.currentTransitionEvent !== _this391 && (i.object.currentTransitionEvent = _this391, i.init());
        });
        var e = t > 0 ? 1 : -1;
        this.scrollCounter += e, this.scrollCounter = Math.min(Math.max(this.scrollCounter, 0), this.data.steps);
        var r = this.scrollCounter / this.data.steps;
        this.actions.Transition.forEach(function (i) {
          return i.seek(r);
        }), this.actions.Animation.forEach(function (i) {
          return i.seek(e);
        }), this.actions.Create.forEach(function (i) {
          return i.dispatchThrottled();
        }), this.actions.SetVariable.forEach(function (i) {
          return i.checkConditions();
        }), this.actions.SetVariable.forEach(function (i) {
          return i.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (i) {
          return i.dispatch();
        });
      }
    }, {
      key: "dispatchUserEvent",
      value: function dispatchUserEvent(t) {
        var _this392 = this;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this392 && (e.object.currentTransitionEvent = _this392, e.init());
        }), t ? (this.actions.Transition.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.reverseFromCurrent();
        })) : (this.actions.Transition.forEach(function (e) {
          e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          e.playFromCurrent();
        })), this.actions.Create.forEach(function (e) {
          return e.dispatchThrottled();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }]);
    return TE;
  }(),
  ME = /*#__PURE__*/function () {
    function ME(t, e, r, i, s, o, a) {
      _classCallCheck(this, ME);
      this.id = t;
      this.data = e;
      this.object = r;
      this.domElement = o;
      this.eventManager = a;
      this.scrollStart = 0;
      this.scrollEnd = 0;
      this.actions = gr(e, e.actions, i, s, a, r);
    }
    _createClass(ME, [{
      key: "computeScrollBounds",
      value: function computeScrollBounds() {
        var _this$data$startOffse, _this$data$endAfter;
        var t = this.domElement.getBoundingClientRect(),
          e = document.body,
          r = document.documentElement,
          i = window.pageYOffset || r.scrollTop || e.scrollTop,
          s = r.clientTop || e.clientTop || 0,
          o = Math.round(t.top + i - s);
        if (this.data.startFrom === "enter") {
          var a = window.innerHeight,
            l = t.height,
            u = this.data.enterAnchor,
            c = u === "top" ? a : u === "bottom" ? a - l : a - l * .5;
          this.scrollStart = o - c;
        } else this.scrollStart = 0;
        this.scrollStart += (_this$data$startOffse = this.data.startOffset) !== null && _this$data$startOffse !== void 0 ? _this$data$startOffse : 0, this.scrollEnd = this.scrollStart + ((_this$data$endAfter = this.data.endAfter) !== null && _this$data$endAfter !== void 0 ? _this$data$endAfter : 400), this.box = t, this.computeScroll({
          x: window.scrollX,
          y: window.scrollY
        });
      }
    }, {
      key: "connect",
      value: function connect() {
        this.computeScrollBounds();
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "handleResize",
      value: function handleResize() {
        this.computeScrollBounds();
      }
    }, {
      key: "isInvalidBox",
      get: function get() {
        return this.box === void 0 || this.box.width === 0 && this.box.height === 0 && this.box.top === 0 && this.box.bottom === 0;
      }
    }, {
      key: "computeScroll",
      value: function computeScroll(_ref108) {
        var _this393 = this;
        var t = _ref108.x,
          e = _ref108.y;
        this.actions.Transition.forEach(function (s) {
          s.object.currentTransitionEvent !== _this393 && (s.object.currentTransitionEvent = _this393, s.init());
        });
        var r = this.scrollEnd - this.scrollStart,
          i = Math.min(1, Math.max(0, (e - this.scrollStart) / r));
        this.actions.Transition.forEach(function (s) {
          return s.seek(i);
        }), this.actions.Animation.forEach(function (s) {
          return s.seek(i);
        }), this.actions.Create.forEach(function (s) {
          return s.dispatchThrottled();
        }), this.actions.SetVariable.forEach(function (s) {
          return s.checkConditions();
        }), this.actions.SetVariable.forEach(function (s) {
          return s.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (s) {
          return s.dispatch();
        });
      }
    }, {
      key: "dispatch",
      value: function dispatch(t) {
        this.isInvalidBox && this.computeScrollBounds(), this.computeScroll(t);
      }
    }, {
      key: "dispatchUserEvent",
      value: function dispatchUserEvent(t) {
        var _this394 = this;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this394 && (e.object.currentTransitionEvent = _this394, e.init());
        }), t ? (this.actions.Transition.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.reverseFromCurrent();
        })) : (this.actions.Transition.forEach(function (e) {
          e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          e.playFromCurrent();
        })), this.actions.Create.forEach(function (e) {
          return e.dispatchThrottled();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }]);
    return ME;
  }(),
  xb = /*#__PURE__*/function (_Dr8) {
    _inherits(xb, _Dr8);
    var _super310 = _createSuper(xb);
    function xb(e, r) {
      var _this395;
      _classCallCheck(this, xb);
      _this395 = _super310.call(this, e);
      _this395.wheelEventsPerObject = new Map();
      _this395.scrollEventsPerObject = new Map();
      _this395.isInview = !0;
      _this395.handleResize = function () {
        _toConsumableArray(_this395.scrollEventsPerObject.entries()).forEach(function (_ref109) {
          var _ref110 = _slicedToArray(_ref109, 2),
            e = _ref110[0],
            r = _ref110[1];
          r.forEach(function (i) {
            return i.handleResize();
          });
        });
      };
      _this395.onScroll = function (e) {
        if (!_this395.isInview) return;
        var r = {
          y: window.scrollY,
          x: window.scrollX
        };
        _toConsumableArray(_this395.scrollEventsPerObject.entries()).forEach(function (_ref111) {
          var _ref112 = _slicedToArray(_ref111, 2),
            i = _ref112[0],
            s = _ref112[1];
          i.dispatchEvent({
            type: "beginEvent",
            eventName: "Scroll",
            scroll: r
          }), s.forEach(function (o) {
            return o.dispatch(r);
          });
        });
      };
      _this395.onWheel = function (e) {
        !_this395.isInview || e.ctrlKey || _toConsumableArray(_this395.wheelEventsPerObject.entries()).forEach(function (_ref113) {
          var _ref114 = _slicedToArray(_ref113, 2),
            r = _ref114[0],
            i = _ref114[1];
          r.dispatchEvent({
            type: "beginEvent",
            eventName: "Scroll",
            deltaY: e.deltaY
          }), i.forEach(function (s) {
            return s.dispatch(e.deltaY);
          });
        });
      };
      _this395.onUserEvent = function (_ref115) {
        var _this395$wheelEventsP;
        var e = _ref115.eventName,
          r = _ref115.target,
          i = _ref115.reverse;
        if (!e || !r) return;
        var s = qo(e);
        s && s === "Scroll" && (r.dispatchEvent({
          type: "beginEvent",
          eventName: "Scroll"
        }), (_this395$wheelEventsP = _this395.wheelEventsPerObject.get(r)) === null || _this395$wheelEventsP === void 0 ? void 0 : _this395$wheelEventsP.forEach(function (o) {
          o.dispatchUserEvent(i);
        }));
      };
      var _this395$eventContext = _this395.eventContext,
        i = _this395$eventContext.page,
        s = _this395$eventContext.sharedAssets,
        o = _this395$eventContext.domElement,
        a = _this395$eventContext.isExport,
        l = function l(u) {
          var _u$data;
          if (!!((_u$data = u.data) !== null && _u$data !== void 0 && _u$data.events.length)) {
            var _iterator183 = _createForOfIteratorHelper(u.data.events),
              _step183;
            try {
              for (_iterator183.s(); !(_step183 = _iterator183.n()).done;) {
                var _step183$value = _step183.value,
                  c = _step183$value.id,
                  d = _step183$value.data;
                if (!d.disabled && d.type === "Scroll") if (d.trigger === "load" || !a) {
                  var _this395$wheelEventsP2;
                  var _h104 = new TE(c, d, u, i, s, r);
                  _this395.wheelEventsPerObject.has(u) ? (_this395$wheelEventsP2 = _this395.wheelEventsPerObject.get(u)) === null || _this395$wheelEventsP2 === void 0 ? void 0 : _this395$wheelEventsP2.push(_h104) : _this395.wheelEventsPerObject.set(u, [_h104]);
                } else {
                  var _this395$scrollEvents;
                  var _h105 = new ME(c, d, u, i, s, o, r);
                  _this395.scrollEventsPerObject.has(u) ? (_this395$scrollEvents = _this395.scrollEventsPerObject.get(u)) === null || _this395$scrollEvents === void 0 ? void 0 : _this395$scrollEvents.push(_h105) : _this395.scrollEventsPerObject.set(u, [_h105]);
                }
              }
            } catch (err) {
              _iterator183.e(err);
            } finally {
              _iterator183.f();
            }
          }
        };
      i.traverseEntity(function (u) {
        var _u$frame;
        (u instanceof fr || u instanceof sr) && (_u$frame = u.frame) !== null && _u$frame !== void 0 && _u$frame.traverse(function (c) {
          l(c);
        }), l(u);
      }), _this395.intersectionObserver = new IntersectionObserver(function (u) {
        var c = u[0];
        c && (_this395.isInview = c.isIntersecting);
      }, {
        root: null
      });
      return _this395;
    }
    _createClass(xb, [{
      key: "connect",
      value: function connect() {
        var _this396 = this;
        this.intersectionObserver.observe(this.eventContext.domElement), _toConsumableArray(this.wheelEventsPerObject.entries()).forEach(function (_ref116) {
          var _ref117 = _slicedToArray(_ref116, 2),
            e = _ref117[0],
            r = _ref117[1];
          r.forEach(function (i) {
            return i.connect();
          }), e.addEventListener("userEvent", _this396.onUserEvent);
        }), _toConsumableArray(this.scrollEventsPerObject.entries()).forEach(function (_ref118) {
          var _ref119 = _slicedToArray(_ref118, 2),
            e = _ref119[0],
            r = _ref119[1];
          r.forEach(function (i) {
            return i.connect();
          }), e.addEventListener("userEvent", _this396.onUserEvent);
        }), _toConsumableArray(this.wheelEventsPerObject.values()).some(function (e) {
          return e.length;
        }) && (this.domEventsNeeded.add("wheel"), window.addEventListener("wheel", this.onWheel)), _toConsumableArray(this.scrollEventsPerObject.values()).some(function (e) {
          return e.length;
        }) && (this.domEventsNeeded.add("scroll"), window.addEventListener("scroll", this.onScroll), window.addEventListener("resize", this.handleResize));
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this397 = this;
        window.removeEventListener("wheel", this.onWheel), window.removeEventListener("scroll", this.onScroll), window.removeEventListener("resize", this.handleResize), this.intersectionObserver.unobserve(this.eventContext.domElement), this.domEventsNeeded.clear(), _toConsumableArray(this.wheelEventsPerObject.entries()).forEach(function (_ref120) {
          var _ref121 = _slicedToArray(_ref120, 2),
            e = _ref121[0],
            r = _ref121[1];
          r.forEach(function (i) {
            return i.disconnect();
          }), e.removeEventListener("userEvent", _this397.onUserEvent);
        }), _toConsumableArray(this.scrollEventsPerObject.entries()).forEach(function (_ref122) {
          var _ref123 = _slicedToArray(_ref122, 2),
            e = _ref123[0],
            r = _ref123[1];
          r.forEach(function (i) {
            return i.disconnect();
          }), e.removeEventListener("userEvent", _this397.onUserEvent);
        });
      }
    }]);
    return xb;
  }(Dr);
var CE = /*#__PURE__*/function () {
    function CE(t, e, r, i, s, o) {
      _classCallCheck(this, CE);
      this.id = t;
      this.data = e;
      this.object = r;
      this.actions = gr(e, e.actions, i, s, o, r);
    }
    _createClass(CE, [{
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "dispatch",
      value: function dispatch() {
        this.actions.Transition.forEach(function (t) {
          t.play();
        }), this.actions.Animation.forEach(function (t) {
          t.play();
        }), this.actions.SwitchCamera.forEach(function (t) {
          t.play();
        }), this.actions.SceneTransition.forEach(function (t) {
          t.dispatch();
        }), this.actions.Reset.forEach(function (t) {
          return t.dispatch();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.checkConditions();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Create.forEach(function (t) {
          t.dispatchFromStart();
        }), this.actions.Destroy.forEach(function (t) {
          t.dispatchFromStart();
        });
      }
    }, {
      key: "dispatchAfter",
      value: function dispatchAfter(t) {
        this.actions.Audio.forEach(function (e) {
          var _e$interaction$data$t;
          ((_e$interaction$data$t = e.interaction.data.triggerAfter) !== null && _e$interaction$data$t !== void 0 ? _e$interaction$data$t : "any") === t && (e.interaction instanceof Uo ? e.interaction.audioPlayer.play() : e.interaction instanceof Of && e.interaction.dispatch());
        }), this.actions.Video.forEach(function (e) {
          var _e$interaction$data$t2;
          var r = (_e$interaction$data$t2 = e.interaction.data.triggerAfter) !== null && _e$interaction$data$t2 !== void 0 ? _e$interaction$data$t2 : "autoplay";
          r === t && (e.interaction instanceof Na ? e.interaction.play(r === "autoplay") : e.interaction instanceof Rf && e.interaction.dispatch());
        }), this.actions.Particles.forEach(function (e) {
          var _e$data$triggerAfter;
          ((_e$data$triggerAfter = e.data.triggerAfter) !== null && _e$data$triggerAfter !== void 0 ? _e$data$triggerAfter : "any") === t && e.dispatchBasic();
        });
      }
    }, {
      key: "dispatchUserEvent",
      value: function dispatchUserEvent(t) {
        var _this398 = this;
        this.actions.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this398 && (e.object.currentTransitionEvent = _this398, e.init());
        }), t ? (this.actions.Transition.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.reverseFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.reverseFromCurrent();
        })) : (this.actions.Transition.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.Animation.forEach(function (e) {
          return e.playFromCurrent();
        }), this.actions.SwitchCamera.forEach(function (e) {
          return e.playFromCurrent();
        })), this.actions.SceneTransition.forEach(function (e) {
          return e.dispatch();
        }), this.actions.Reset.forEach(function (e) {
          return e.dispatch();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), this.actions.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        }), this.actions.Create.forEach(function (e) {
          e.dispatch();
        }), this.actions.Destroy.forEach(function (e) {
          e.dispatch();
        }), this.actions.Audio.forEach(function (e) {
          e.interaction instanceof Uo ? e.interaction.audioPlayer.play() : e.interaction instanceof Of && e.interaction.dispatch();
        }), this.actions.Video.forEach(function (e) {
          e.interaction instanceof Na ? e.interaction.play() : e.interaction instanceof Rf && e.interaction.dispatch();
        }), this.actions.Particles.forEach(function (e) {
          e.dispatchBasic();
        });
      }
    }]);
    return CE;
  }(),
  bb = /*#__PURE__*/function (_Dr9) {
    _inherits(bb, _Dr9);
    var _super311 = _createSuper(bb);
    function bb(e, r) {
      var _this399;
      _classCallCheck(this, bb);
      _this399 = _super311.call(this, e);
      _this399.eventManager = r;
      _this399.eventsPerObject = new Map();
      _this399.eventsAfterPerObject = new Map();
      _this399.onMouseDown = function () {
        _toConsumableArray(_this399.eventsAfterPerObject.entries()).forEach(function (_ref124) {
          var _ref125 = _slicedToArray(_ref124, 2),
            e = _ref125[0],
            r = _ref125[1];
          e.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), r.forEach(function (i) {
            i.dispatchAfter("mouseDown");
          });
        });
      };
      _this399.onKeyDown = function () {
        _toConsumableArray(_this399.eventsAfterPerObject.entries()).forEach(function (_ref126) {
          var _ref127 = _slicedToArray(_ref126, 2),
            e = _ref127[0],
            r = _ref127[1];
          e.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), r.forEach(function (i) {
            i.dispatchAfter("keyDown");
          });
        });
      };
      _this399.onAny = function () {
        var _this399$eventContext = _this399.eventContext,
          e = _this399$eventContext.domElement,
          r = _this399$eventContext.isExport;
        (r ? document : e).removeEventListener("pointerdown", _this399.onAny), document.removeEventListener("keydown", _this399.onAny), _toConsumableArray(_this399.eventsAfterPerObject.entries()).forEach(function (_ref128) {
          var _ref129 = _slicedToArray(_ref128, 2),
            s = _ref129[0],
            o = _ref129[1];
          s.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), o.forEach(function (a) {
            a.dispatchAfter("any");
          });
        });
      };
      _this399.onSceneTransitionAudioVideoPlay = function () {
        _toConsumableArray(_this399.eventsAfterPerObject.entries()).forEach(function (_ref130) {
          var _ref131 = _slicedToArray(_ref130, 2),
            e = _ref131[0],
            r = _ref131[1];
          e.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), r.forEach(function (i) {
            i.actions.Audio.forEach(function (s) {
              s.interaction instanceof Uo && s.interaction.audioPlayer.play();
            }), i.actions.Video.forEach(function (s) {
              var _s$interaction$data$t;
              var o = (_s$interaction$data$t = s.interaction.data.triggerAfter) !== null && _s$interaction$data$t !== void 0 ? _s$interaction$data$t : "autoplay";
              s.interaction instanceof Na && s.interaction.play(o === "autoplay");
            }), i.actions.Particles.forEach(function (s) {
              s.dispatchBasic();
            });
          });
        });
      };
      _this399.onPlay = function () {
        _toConsumableArray(_this399.eventsAfterPerObject.entries()).forEach(function (_ref132) {
          var _ref133 = _slicedToArray(_ref132, 2),
            e = _ref133[0],
            r = _ref133[1];
          e.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), r.forEach(function (i) {
            i.dispatchAfter("autoplay");
          });
        });
      };
      _this399.onUserEvent = function (_ref134) {
        var _this399$eventsPerObj, _this399$eventsAfterP;
        var e = _ref134.eventName,
          r = _ref134.target,
          i = _ref134.reverse;
        if (!e || !r) return;
        var s = qo(e);
        s && s === "Start" && (r instanceof jt || r.dispatchEvent({
          type: "beginEvent",
          eventName: "Start"
        }), (_this399$eventsPerObj = _this399.eventsPerObject.get(r)) !== null && _this399$eventsPerObj !== void 0 && _this399$eventsPerObj.forEach(function (o) {
          o.dispatchUserEvent(i);
        }), (_this399$eventsAfterP = _this399.eventsAfterPerObject.get(r)) === null || _this399$eventsAfterP === void 0 ? void 0 : _this399$eventsAfterP.forEach(function (o) {
          o.dispatchUserEvent(i);
        }));
      };
      return _this399;
    }
    _createClass(bb, [{
      key: "connect",
      value: function connect() {
        var _this400 = this;
        var _this$eventContext11 = this.eventContext,
          e = _this$eventContext11.sharedAssets,
          r = _this$eventContext11.page,
          i = function i(s) {
            var _s$data3;
            if (!!((_s$data3 = s.data) !== null && _s$data3 !== void 0 && _s$data3.events.length)) {
              var _iterator184 = _createForOfIteratorHelper(s.data.events),
                _step184;
              try {
                for (_iterator184.s(); !(_step184 = _iterator184.n()).done;) {
                  var _this400$eventsPerObj, _this400$eventsAfterP, _this400$eventsAfterP2, _this400$eventsAfterP3;
                  var _step184$value = _step184.value,
                    o = _step184$value.id,
                    a = _step184$value.data;
                  if (a.disabled || a.type !== "Start") continue;
                  var l = new CE(o, a, s, r, e, _this400.eventManager);
                  (l.actions.Transition.length || l.actions.Animation.length || l.actions.SwitchCamera.length || l.actions.Create.length || l.actions.Destroy.length || l.actions.SceneTransition.length || l.actions.Reset.length || l.actions.SetVariable.length || l.actions.DynamicVariablePlay.length) && (_this400.eventsPerObject.has(s) ? (_this400$eventsPerObj = _this400.eventsPerObject.get(s)) === null || _this400$eventsPerObj === void 0 ? void 0 : _this400$eventsPerObj.push(l) : _this400.eventsPerObject.set(s, [l])), l.actions.Audio.length && (_this400.eventsAfterPerObject.has(s) ? (_this400$eventsAfterP = _this400.eventsAfterPerObject.get(s)) === null || _this400$eventsAfterP === void 0 ? void 0 : _this400$eventsAfterP.push(l) : _this400.eventsAfterPerObject.set(s, [l])), l.actions.Video.length && (_this400.hasVideoAction = !0, _this400.eventsAfterPerObject.has(s) ? (_this400$eventsAfterP2 = _this400.eventsAfterPerObject.get(s)) === null || _this400$eventsAfterP2 === void 0 ? void 0 : _this400$eventsAfterP2.push(l) : _this400.eventsAfterPerObject.set(s, [l])), l.actions.Particles.length && (_this400.eventsAfterPerObject.has(s) ? (_this400$eventsAfterP3 = _this400.eventsAfterPerObject.get(s)) === null || _this400$eventsAfterP3 === void 0 ? void 0 : _this400$eventsAfterP3.push(l) : _this400.eventsAfterPerObject.set(s, [l]));
                }
              } catch (err) {
                _iterator184.e(err);
              } finally {
                _iterator184.f();
              }
            }
          };
        if (r.traverseEntity(function (s) {
          var _s$frame;
          (s instanceof fr || s instanceof sr) && (_s$frame = s.frame) !== null && _s$frame !== void 0 && _s$frame.traverse(function (o) {
            i(o);
          }), i(s);
        }), _toConsumableArray(this.eventsAfterPerObject.values()).some(function (s) {
          return s.length;
        })) {
          if (this.eventManager.activateCount === 0) {
            var _this$eventContext12 = this.eventContext,
              _s130 = _this$eventContext12.domElement,
              o = _this$eventContext12.isExport,
              a = o ? document : _s130;
            a.addEventListener("pointerdown", this.onMouseDown, {
              once: !0
            }), a.addEventListener("mousedown", this.onMouseDown, {
              once: !0
            }), document.addEventListener("keydown", this.onKeyDown, {
              once: !0
            }), a.addEventListener("pointerdown", this.onAny), a.addEventListener("mousedown", this.onAny), document.addEventListener("keydown", this.onAny), _toConsumableArray(this.eventsAfterPerObject.entries()).forEach(function (_ref135) {
              var _ref136 = _slicedToArray(_ref135, 2),
                l = _ref136[0],
                u = _ref136[1];
              l.addEventListener("userEvent", _this400.onUserEvent);
            });
          } else this.onSceneTransitionAudioVideoPlay();
          this.onPlay();
        }
        _toConsumableArray(this.eventsPerObject.entries()).forEach(function (_ref137) {
          var _ref138 = _slicedToArray(_ref137, 2),
            s = _ref138[0],
            o = _ref138[1];
          s.dispatchEvent({
            type: "beginEvent",
            eventName: "Start"
          }), o.forEach(function (a) {
            return a.dispatch();
          }), s.addEventListener("userEvent", _this400.onUserEvent);
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        var _this401 = this;
        if (_toConsumableArray(this.eventsAfterPerObject.values()).some(function (e) {
          return e.length;
        })) {
          var _this$eventContext13 = this.eventContext,
            e = _this$eventContext13.domElement,
            r = _this$eventContext13.isExport,
            _i193 = r ? document : e;
          _i193.removeEventListener("pointerdown", this.onMouseDown), _i193.removeEventListener("mousedown", this.onMouseDown), document.removeEventListener("keydown", this.onKeyDown), _i193.removeEventListener("pointerdown", this.onAny), _i193.removeEventListener("mousedown", this.onAny), document.removeEventListener("keydown", this.onAny), _toConsumableArray(this.eventsAfterPerObject.entries()).forEach(function (_ref139) {
            var _ref140 = _slicedToArray(_ref139, 2),
              s = _ref140[0],
              o = _ref140[1];
            s.removeEventListener("userEvent", _this401.onUserEvent), o.forEach(function (a) {
              return a.disconnect();
            });
          });
        }
        _toConsumableArray(this.eventsPerObject.entries()).forEach(function (_ref141) {
          var _ref142 = _slicedToArray(_ref141, 2),
            e = _ref142[0],
            r = _ref142[1];
          e.removeEventListener("userEvent", _this401.onUserEvent), r.forEach(function (i) {
            return i.disconnect();
          });
        }), this.eventsPerObject.clear(), this.eventsAfterPerObject.clear();
      }
    }]);
    return bb;
  }(Dr);
var Sb = /*#__PURE__*/function () {
  function Sb(t, e, r, i, s, o) {
    _classCallCheck(this, Sb);
    this.id = t;
    this.data = e;
    this.object = r;
    this.disabled = !1;
    this.alreadyPlayedNonTogglingActions = new Set();
    this.actions = gr(e, e.actions, i, s, o, r), this.target = e.target, this.useToggle = e.runMode === "Toggle";
  }
  _createClass(Sb, [{
    key: "disconnect",
    value: function disconnect() {
      tr(this.actions);
    }
  }, {
    key: "dispatch",
    value: function dispatch(t) {
      var _this402 = this;
      this.disabled || (this.actions.Transition.forEach(function (e) {
        e.object.currentTransitionEvent !== _this402 ? (e.object.currentTransitionEvent = _this402, e.init()) : _this402.data.runMode === "Once" && _this402.alreadyPlayedNonTogglingActions.add(e);
      }), this.object.dispatchEvent({
        type: "beginEvent",
        eventName: "Collision"
      }), this.useToggle ? (this.actions.Transition.forEach(function (e) {
        e.toggle();
      }), this.actions.Animation.forEach(function (e) {
        e.toggle();
      })) : (this.actions.Transition.forEach(function (e) {
        _this402.alreadyPlayedNonTogglingActions.has(e) === !1 && e.play();
      }), this.actions.Animation.forEach(function (e) {
        e.play();
      })), this.actions.Reset.forEach(function (e) {
        e.dispatch();
      }), this.actions.Link.forEach(function (e) {
        e.dispatch();
      }), this.actions.Reset.forEach(function (e) {
        e.dispatch();
      }), this.actions.Create.forEach(function (e) {
        e.dispatch();
      }), this.actions.Destroy.forEach(function (e) {
        e.dispatch(t !== null && t !== void 0 ? t : !1);
      }), this.actions.SetVariable.forEach(function (e) {
        return e.checkConditions();
      }), this.actions.SetVariable.forEach(function (e) {
        return e.dispatch();
      }), this.actions.DynamicVariablePlay.forEach(function (e) {
        return e.dispatch();
      }), this.actions.Audio.forEach(function (e) {
        e.dispatchBasic();
      }), this.actions.Particles.forEach(function (e) {
        e.dispatchBasic();
      }), this.actions.Video.forEach(function (e) {
        e.dispatchBasic();
      }));
    }
  }]);
  return Sb;
}();
var wb = /*#__PURE__*/function (_Dr10) {
    _inherits(wb, _Dr10);
    var _super312 = _createSuper(wb);
    function wb(e, r, i, s, o) {
      var _this403;
      _classCallCheck(this, wb);
      _this403 = _super312.call(this, e);
      _this403.sharedVariables = r;
      _this403.eventManager = i;
      _this403.needsMouse = s;
      _this403.needsRaycast = o;
      _this403.dynamicVars = [];
      _this403.variablesToWatch = [];
      _this403.prevMouseProperty = null;
      _this403.prevRaycastProperty = null;
      _this403.pauseTime = 0;
      _this403.events = [];
      _this403.onFrame = function (e) {
        _this403.rafId = window.requestAnimationFrame(_this403.onFrame);
        var r = new Date(),
          i = [],
          s = [];
        for (var l = 0; l < _this403.propertiesToWatch.length; l++) {
          var _this403$propertiesTo = _this403.propertiesToWatch[l],
            u = _this403$propertiesTo.objectId,
            c = _this403$propertiesTo.property,
            d = _this403$propertiesTo.prevValue,
            _h106 = _this403.eventContext.scene.find(u),
            f = Iv.propertyPaths[c];
          if (f[0] === "width" || f[0] === "height" || f[0] === "depth") _h106 = _h106.geometry.userData.parameters[f[0]];else for (var p = 0; p < f.length; p++) _h106 = _h106[f[p]];
          d === null ? _this403.propertiesToWatch[l].prevValue = _h106 instanceof _ ? _h106.clone() : _h106 : (_h106 instanceof _ ? !_h106.equals(d) : d !== _h106) && (s.push({
            objId: u,
            property: c
          }), _h106 instanceof _ ? _this403.propertiesToWatch[l].prevValue.copy(_h106) : _this403.propertiesToWatch[l].prevValue = _h106);
        }
        for (var _l98 = 0; _l98 < _this403.variablesToWatch.length; _l98++) {
          var _this403$variablesToW = _this403.variablesToWatch[_l98],
            _u69 = _this403$variablesToW.id,
            _c54 = _this403$variablesToW.prevValue,
            _d66 = _this403.shared.getVariable(_u69);
          _d66 !== _c54 && (i.push(_u69), _this403.variablesToWatch[_l98].prevValue = _d66);
        }
        for (var _l99 = 0; _l99 < _this403.dynamicVars.length; _l99++) {
          var _this403$dynamicVars$ = _this403.dynamicVars[_l99],
            _u70 = _this403$dynamicVars$.id,
            _c55 = _this403$dynamicVars$.expectedTime,
            _d67 = _this403$dynamicVars$.last,
            _h107 = _this403$dynamicVars$.data,
            _f83 = _this403$dynamicVars$.timerSeconds,
            _p57 = _this403$dynamicVars$.startValue,
            m = 1e3;
          if ((_h107.dynamicVariableType === "timer" || _h107.dynamicVariableType === "stopwatch") && _h107.format === "number3decimal" ? m = 1 : _h107.dynamicVariableType === "counter" ? m = _h107.updateInterval : _h107.dynamicVariableType === "random" && (m = _h107.isStatic ? 1 / 0 : _h107.updateInterval), _c55 === -1) {
            _this403.dynamicVars[_l99].last = e, _this403.dynamicVars[_l99].expectedTime = e + m;
            continue;
          }
          if (!((_this403.shared.getDynamicVariablePlayState(_u70) === "Stopped" || _this403.shared.getDynamicVariablePlayState(_u70) === "Restarted") && (_this403.dynamicVars[_l99].last = e, _this403.dynamicVars[_l99].expectedTime = e + m, _h107.dynamicVariableType === "counter" && _this403.shared.getVariable(_u70) !== _p57 && (_this403.shared.updateVariable(_u70, _p57), _this403.eventManager.requestRender()), (_h107.dynamicVariableType === "timer" || _h107.dynamicVariableType === "stopwatch") && _this403.dynamicVars[_l99].timerSeconds !== _p57 && (_this403.dynamicVars[_l99].timerSeconds = _p57, _this403.shared.updateVariable(_u70, yn.getFormattedTimerTime(_p57, _h107)), _this403.eventManager.requestRender()), _this403.shared.getDynamicVariablePlayState(_u70) === "Restarted" && _this403.shared.setDynamicVariablePlayState(_u70, "Playing"), _this403.shared.getDynamicVariablePlayState(_u70) === "Stopped"))) {
            if (_this403.shared.getDynamicVariablePlayState(_u70) === "Paused") {
              _this403.dynamicVars[_l99].deltaToExpectedTime === void 0 && (_this403.dynamicVars[_l99].deltaToExpectedTime = Math.max(_this403.dynamicVars[_l99].expectedTime - e, 0)), _this403.dynamicVars[_l99].last = e - (m - _this403.dynamicVars[_l99].deltaToExpectedTime), _this403.dynamicVars[_l99].expectedTime = e + _this403.dynamicVars[_l99].deltaToExpectedTime;
              continue;
            } else _this403.dynamicVars[_l99].deltaToExpectedTime = void 0;
            if (e >= _c55) if (_this403.dynamicVars[_l99].last = e, _this403.dynamicVars[_l99].expectedTime += m, _h107.dynamicVariableType === "random") {
              var g = _h107.min + Math.random() * (_h107.max - _h107.min),
                y = _h107.decimals;
              g = Math.round(g * Math.pow(10, y)) / Math.pow(10, y), _this403.shared.updateVariable(_u70, g), i.push(_u70), _this403.eventManager.requestRender();
            } else if (_h107.dynamicVariableType === "counter") {
              var _this403$shared$getDy;
              if (_h107.increment === 0) continue;
              var _g52 = _this403.shared.getVariable(_u70),
                _y57 = (_this403$shared$getDy = _this403.shared.getDynamicVariableToggleIsForward(_u70)) !== null && _this403$shared$getDy !== void 0 ? _this403$shared$getDy : !0,
                v = _this403.shared.getVariable(_u70) + _h107.increment * (_y57 ? 1 : -1);
              _h107.hasEnd && (v = _h107.increment > 0 ? Se.clamp(v, _p57, _h107.endValue) : Se.clamp(v, _h107.endValue, _p57), v === _p57 && _this403.shared.setDynamicVariableToggleIsForward(_u70, void 0), _h107.repeat ? v === _h107.endValue && (v = _p57) : (v === _p57 || v === _h107.endValue) && _this403.shared.setDynamicVariablePlayState(_u70, "Paused")), v !== _g52 && (i.push(_u70), _this403.shared.updateVariable(_u70, v), _this403.eventManager.requestRender());
            } else if (_h107.dynamicVariableType === "time") _this403.shared.updateVariable(_u70, qA(r, _h107)), i.push(_u70), _this403.eventManager.requestRender();else {
              var _this403$shared$getDy2;
              var _g53 = Fi.isTextValue(_h107.endValue) ? aN(_h107.endValue.textValue) : _h107.endValue,
                _y58 = (_this403$shared$getDy2 = _this403.shared.getDynamicVariableToggleIsForward(_u70)) !== null && _this403$shared$getDy2 !== void 0 ? _this403$shared$getDy2 : !0,
                _v34 = _f83 + (e - _d67) / 1e3 * (_h107.dynamicVariableType === "timer" ? -1 : 1) * (_y58 ? 1 : -1);
              _v34 = Math.max(_v34, 0), _h107.hasEnd && (_v34 = _h107.dynamicVariableType === "stopwatch" ? Se.clamp(_v34, _p57, _g53) : Se.clamp(_v34, _g53, _p57), _v34 === _p57 && _this403.shared.setDynamicVariableToggleIsForward(_u70, void 0), _h107.repeat ? Math.abs(_v34 - _g53) < (_h107.format === "number3decimal" ? 1e-4 : .1) && (_v34 = _p57) : (Math.abs(_v34 - _p57) < (_h107.format === "number3decimal" ? 1e-4 : .1) || Math.abs(_v34 - _g53) < (_h107.format === "number3decimal" ? 1e-4 : .1)) && _this403.shared.setDynamicVariablePlayState(_u70, "Paused")), _v34 !== _f83 && (i.push(_u70), _this403.dynamicVars[_l99].timerSeconds = _v34, _this403.shared.updateVariable(_u70, yn.getFormattedTimerTime(_v34, _h107)), _this403.eventManager.requestRender());
            }
          }
        }
        _this403.needsMouse && _this403.shared.mouseProperty !== _this403.prevMouseProperty && (_this403.prevMouseProperty = _this403.shared.mouseProperty, _this403.events.forEach(function (l) {
          l.data.variableId === "mouseProperty" && (l.dispatch(), _this403.eventManager.requestRender());
        }));
        var o = !1;
        _this403.shared.mouseProperty !== _this403.prevMouseProperty && (_this403.prevMouseProperty = _this403.shared.mouseProperty, o = !0);
        var a = !1;
        _this403.shared.raycastProperty !== _this403.prevRaycastProperty && (_this403.prevRaycastProperty = _this403.shared.raycastProperty, a = !0), _this403.events.forEach(function (l) {
          (i.includes(l.data.variableId) || s.find(function (u) {
            return u.objId === l.data.objectId && u.property === l.data.property;
          }) || l.data.variableId === "mouseProperty" && o || l.data.variableId === "raycastProperty" && a) && (l.dispatch(), _this403.eventManager.requestRender());
        });
      };
      _this403.onBlur = function () {
        _this403.pause();
      };
      _this403.onFocus = function () {
        _this403.resume();
      };
      e.page.traverseEntity(function (a) {
        var _a$data2;
        (_a$data2 = a.data) === null || _a$data2 === void 0 || _a$data2.events.filter(function (l) {
          return l.data.type === "VariableChange" && !l.data.disabled;
        }).forEach(function (l) {
          _this403.events.push(new PE(a.uuid, l.data, a, e.page, e.sharedAssets, i));
        });
      }), _this403.propertiesToWatch = _this403.events.filter(function (a) {
        return a.data.variableId === "objectProperty" && a.data.objectId !== null;
      }).map(function (a) {
        return {
          objectId: a.data.objectId,
          property: a.data.property,
          prevValue: null
        };
      }), _this403.shared = e.sharedAssets, _this403.sharedVariables.forEach(function (_ref143) {
        var a = _ref143.id,
          l = _ref143.data;
        if (!("dynamicVariableType" in l)) {
          _this403.events.find(function (c) {
            return c.data.variableId === a;
          }) && _this403.variablesToWatch.push({
            id: a,
            prevValue: _this403.shared.getVariable(a)
          });
          return;
        }
        var u;
        if (l.dynamicVariableType === "timer" || l.dynamicVariableType === "stopwatch") {
          var c;
          if (Fi.isTextValue(l.value) && Array.isArray(l.value.textValue)) {
            var d = l.value.textValue;
            d.length === 3 ? c = d[2] + d[1] * 60 + d[0] * 3600 : c = d[1] + d[0] * 60;
          } else c = l.value;
          u = c, _this403.dynamicVars.push({
            id: a,
            last: -1,
            expectedTime: -1,
            data: l,
            timerSeconds: c,
            startValue: u
          });
        } else l.dynamicVariableType === "time" && _this403.shared.updateVariable(a, qA(new Date(), l)), l.dynamicVariableType === "counter" && (u = Fi.isTextValue(l.value) ? aN(l.value.textValue) : l.value), _this403.dynamicVars.push({
          id: a,
          last: -1,
          expectedTime: -1,
          data: l,
          startValue: u
        });
      });
      return _this403;
    }
    _createClass(wb, [{
      key: "pause",
      value: function pause() {
        this.pauseTime = Date.now();
      }
    }, {
      key: "resume",
      value: function resume() {
        var e = Date.now() - this.pauseTime;
        for (var r = 0; r < this.dynamicVars.length; r++) this.dynamicVars[r].last += e, this.dynamicVars[r].expectedTime += e;
      }
    }, {
      key: "connect",
      value: function connect() {
        this.rafId = window.requestAnimationFrame(this.onFrame), window.addEventListener("blur", this.onBlur), window.addEventListener("focus", this.onFocus);
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        window.removeEventListener("blur", this.onBlur), window.removeEventListener("focus", this.onFocus), this.rafId && (window.cancelAnimationFrame(this.rafId), this.rafId = void 0), this.events.forEach(function (e) {
          return e.dispose();
        });
      }
    }]);
    return wb;
  }(Dr),
  PE = /*#__PURE__*/function () {
    function PE(t, e, r, i, s, o) {
      _classCallCheck(this, PE);
      this.id = t;
      this.data = e;
      this.object = r;
      this.actions = gr(e, e.actions, i, s, o, r);
    }
    _createClass(PE, [{
      key: "dispatch",
      value: function dispatch() {
        var _this404 = this;
        var t = this.actions;
        t.Audio.forEach(function (e) {
          return e.dispatchConditional();
        }), t.Particles.forEach(function (e) {
          return e.dispatchConditional();
        }), t.Video.forEach(function (e) {
          return e.dispatchConditional();
        }), t.Create.forEach(function (e) {
          return e.dispatch();
        }), t.Destroy.forEach(function (e) {
          return e.dispatch();
        }), t.Reset.forEach(function (e) {
          return e.dispatch();
        }), t.Transition.forEach(function (e) {
          e.object.currentTransitionEvent !== _this404 && (e.object.currentTransitionEvent = _this404), e.init();
        }), t.Transition.forEach(function (e) {
          return e.play();
        }), t.Animation.forEach(function (e) {
          return e.play();
        }), t.SwitchCamera.forEach(function (e) {
          return e.play();
        }), t.SceneTransition.forEach(function (e) {
          return e.dispatch();
        }), t.SetVariable.forEach(function (e) {
          return e.checkConditions();
        }), t.SetVariable.forEach(function (e) {
          return e.dispatch();
        }), t.DynamicVariablePlay.forEach(function (e) {
          return e.dispatch();
        });
      }
    }, {
      key: "dispose",
      value: function dispose() {
        tr(this.actions);
      }
    }]);
    return PE;
  }();
function aN(n) {
  return n.length === 3 ? n[2] + n[1] * 60 + n[0] * 3600 : n[1] + n[0] * 60;
}
var cN = !1 ? (typeof window === "undefined" ? "undefined" : _typeof(window)) < "u" ? window.location.href : "" : "https://unpkg.com/@splinetool/runtime@1.0.17/build/",
  KZ = !1 ? cN : "https://unpkg.com/@splinetool/navmesh-wasm@1.0.17/build/",
  ZZ = "\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('".concat(cN, "' + 'navmesh.js'),\n\t\tfetch('").concat(KZ, "' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n"),
  JZ = "\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n",
  $Z = "\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n",
  lN = .001,
  eJ = {
    cs: 6,
    ch: 2,
    walkableSlopeAngle: 90,
    walkableHeight: 20,
    walkableClimb: 5,
    walkableRadius: 0,
    maxEdgeLen: 12,
    maxSimplificationError: 1.3,
    minRegionArea: 8,
    mergeRegionArea: 20,
    maxVertsPerPoly: 6,
    detailSampleDist: 6,
    detailSampleMaxError: 1
  },
  uN,
  bt,
  $i;
C2.then(function (n) {
  uN = n, bt = new n.Vec3(), $i = new n.Vec3();
});
var tJ = new _(),
  Ab = /*#__PURE__*/function () {
    function Ab() {
      var _this405 = this;
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !1;
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
      _classCallCheck(this, Ab);
      this.usePhysics = t;
      this.isExport = e;
      this.onPointerDown = function (t) {
        if (Ye.length !== 1) return;
        var _this405$eventContext = _this405.eventContext,
          e = _this405$eventContext.raycaster,
          r = _this405$eventContext.page;
        _this405.eventContext.updateRaycaster(t);
        var i = r.raycastWithClones(e);
        if (i.length !== 0) {
          if (_this405.gameControl) {
            var _s131 = tJ.copy(_this405.gameControl.colliderWorldPosition);
            _s131.y -= _this405.gameControl.colliderHeight / 2, _this405.gameControl.path = _this405.computePath(_s131, i[0].point);
          }
          _this405.eventContext.requestRender();
        }
      };
      this.traverseWithPhysics = function (t, e) {
        return function (r) {
          var _i$dataPatched$cloner, _i$dataPatched$cloner2, _i$dataPatched$physic2, _s$physics, _s$physics2, _s$physics4;
          var i;
          if (r instanceof Gi) {
            if (r.objectForSample) {
              if (r.objectForSample.dataPatched.physics.fusedBody) return;
              i = r.object;
            } else return r.object.dataPatched.physics.fusedBody === !0 && r.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
          } else if (r instanceof Pr) i = r.object;else if (i = r, ((_i$dataPatched$cloner = i.dataPatched.cloner) === null || _i$dataPatched$cloner === void 0 ? void 0 : _i$dataPatched$cloner.disabled) === !1 && (_i$dataPatched$cloner2 = i.dataPatched.cloner) !== null && _i$dataPatched$cloner2 !== void 0 && _i$dataPatched$cloner2.hideBase && ((_i$dataPatched$physic2 = i.dataPatched.physics) === null || _i$dataPatched$physic2 === void 0 ? void 0 : _i$dataPatched$physic2.fusedBody) !== !0) return !0;
          if (e && !i.userData.navmesh) return;
          var s = i.dataPatched;
          if (!s.visible && ((_s$physics = s.physics) === null || _s$physics === void 0 ? void 0 : _s$physics.enabled) !== !0) return !0;
          r.updateMatrixWorldSVD();
          var o = vg(s),
            a = i.userData.hasDestroy,
            l = i.userData.hasDrag,
            u = !1,
            c = !1;
          var _iterator185 = _createForOfIteratorHelper(s.events),
            _step185;
          try {
            for (_iterator185.s(); !(_step185 = _iterator185.n()).done;) {
              var d = _step185.value;
              d.data.disabled !== !0 && (d.data.type === "GameControl" ? u = !0 : d.data.type === "Follow" && (c = !0));
            }
          } catch (err) {
            _iterator185.e(err);
          } finally {
            _iterator185.f();
          }
          if (u || o || c || a || l) return !0;
          if (_this405.usePhysics && ((_s$physics2 = s.physics) === null || _s$physics2 === void 0 ? void 0 : _s$physics2.rigidBody) === "dynamic") {
            var _s$physics3;
            if (_this405.usePhysics && (_s$physics3 = s.physics) !== null && _s$physics3 !== void 0 && _s$physics3.fusedBody) return !0;
          } else if ("geometry" in r && r.geometry && t.push(io(r.geometry, r.matrixWorld)), _this405.usePhysics && (_s$physics4 = s.physics) !== null && _s$physics4 !== void 0 && _s$physics4.fusedBody) return r.traverseObject(function (d, h) {
            var _d$dataPatched$cloner, _p$physics;
            if (h === 0) return;
            var f;
            if (d instanceof Gi) {
              if (d.objectForSample) {
                if (d.objectForSample.dataPatched.physics.fusedBody) return;
                f = d.object;
              } else return d.object.dataPatched.physics.fusedBody === !0 && d.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
            } else if (d instanceof Pr) f = d.object;else if (f = d, (_d$dataPatched$cloner = d.dataPatched.cloner) !== null && _d$dataPatched$cloner !== void 0 && _d$dataPatched$cloner.hideBase) return !0;
            var p = f.dataPatched;
            if (!p.visible && ((_p$physics = p.physics) === null || _p$physics === void 0 ? void 0 : _p$physics.enabled) !== !0) return !0;
            "geometry" in d && d.geometry && t.push(io(d.geometry, d.matrixWorld));
          }), !0;
        };
      };
      this.traverseNoPhysics = function (t, e) {
        return function (r) {
          var i;
          if (r instanceof Gi) return;
          r instanceof Pr ? i = r.object : i = r;
          var s = i.dataPatched;
          if (s.physics.enabled === "visibility" ? !s.visible : !s.physics.enabled) return !0;
          if (e && !i.userData.navmesh) return;
          var o = r.geometry,
            a = i.userData.hasDestroy === !0,
            l = i.userData.hasDrag === !0;
          if (vg(s) || a || l || i.dataPatched.events.some(function (u) {
            return u.data.disabled !== !0 && u.data.type === "GameControl";
          })) return !0;
          o && t.push(io(o, r.matrixWorld));
        };
      };
      this.navmeshWasm = uN, this.navMesh = new this.navmeshWasm.NavMesh(), this._workerURL = URL.createObjectURL(new Blob([(e ? ZZ : JZ) + $Z])), this._worker = new Worker(this._workerURL);
    }
    _createClass(Ab, [{
      key: "init",
      value: function init(t, e, r) {
        var _this406 = this;
        this.gameControl = e, this.eventContext = r, this.resolution = t.ch, this.setDefaultQueryExtent(new _().setScalar(t.ch * t.walkableRadius * 1.2)), this._worker.onmessage = function () {
          _this406.createNavMesh(r.page, t, function (i) {
            _this406.buildFromNavmeshData(i.data);
          });
        }, this.eventContext.renderer.domElement.addEventListener("pointerdown", this.onPointerDown);
      }
    }, {
      key: "createNavMesh",
      value: function createNavMesh(t, e, r) {
        e.objects.forEach(function (u) {
          var _c$cloner;
          var c = t.scene.find(u);
          c.traverseEntity(function (d) {
            d.userData.navmesh = !0;
          }), (_c$cloner = c.cloner) === null || _c$cloner === void 0 ? void 0 : _c$cloner.traverseObject(function (d) {
            d.userData.navmesh = !0;
          });
        });
        var i = [],
          s = (this.usePhysics ? this.traverseWithPhysics : this.traverseNoPhysics)(i, e.zones === "custom");
        if (t.traverseChildren(s), e.objects.forEach(function (u) {
          var _c$cloner2;
          var c = t.scene.find(u);
          c.traverseEntity(function (d) {
            d.userData.navmesh = void 0;
          }), (_c$cloner2 = c.cloner) === null || _c$cloner2 === void 0 ? void 0 : _c$cloner2.traverseObject(function (d) {
            d.userData.navmesh = void 0;
          });
        }), i.length === 0) return !1;
        var o = Vs(i),
          _Fc4 = Fc(o.getAttribute("position"), o.getIndex()),
          a = _Fc4.positions,
          l = _Fc4.triIndices;
        return this._worker.postMessage([a, a.length / 3, l, l.length, _objectSpread(_objectSpread({}, eJ), e)]), this._worker.onmessage = r, !0;
      }
    }, {
      key: "createDebugNavGeometry",
      value: function createDebugNavGeometry() {
        var t,
          e,
          r = this.navMesh.getDebugNavMesh(),
          i = r.getTriangleCount(),
          s = new Uint32Array(i * 3),
          o = new Float32Array(i * 3 * 3);
        for (t = 0; t < i * 3; t++) s[t] = t;
        for (t = 0; t < i; t++) for (e = 0; e < 3; e++) {
          var l = r.getTriangle(t).getPoint(e);
          o[t * 9 + e * 3 + 0] = l.x, o[t * 9 + e * 3 + 1] = l.y, o[t * 9 + e * 3 + 2] = l.z;
        }
        var a = new we();
        return a.setIndex(new Ge(s, 1)), a.setAttribute("position", new Ge(o, 3)), a;
      }
    }, {
      key: "getClosestPoint",
      value: function getClosestPoint(t) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, this.navMesh.getClosestPoint(bt);
      }
    }, {
      key: "getClosestPointToRef",
      value: function getClosestPointToRef(t, e) {
        bt.x = t.x, bt.y = t.y, bt.z = t.z;
        var r = this.navMesh.getClosestPoint(bt);
        e.set(r.x, r.y, r.z);
      }
    }, {
      key: "getRandomPointAround",
      value: function getRandomPointAround(t, e) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, this.navMesh.getRandomPointAround(bt, e);
      }
    }, {
      key: "getRandomPointAroundToRef",
      value: function getRandomPointAroundToRef(t, e, r) {
        bt.x = t.x, bt.y = t.y, bt.z = t.z;
        var i = this.navMesh.getRandomPointAround(bt, e);
        r.set(i.x, i.y, i.z);
      }
    }, {
      key: "moveAlong",
      value: function moveAlong(t, e) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, $i.x = e.x, $i.y = e.y, $i.z = e.z, this.navMesh.moveAlong(bt, $i);
      }
    }, {
      key: "moveAlongToRef",
      value: function moveAlongToRef(t, e, r) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, $i.x = e.x, $i.y = e.y, $i.z = e.z, this.navMesh.moveAlong(bt, $i);
      }
    }, {
      key: "computePath",
      value: function computePath(t, e) {
        var r = this.getClosestPoint(e);
        $i.x = r.x, $i.y = r.y, $i.z = r.z, this.getClosestPoint(t);
        var i = this.navMesh.computePath(bt, $i),
          s = i.getPointCount(),
          o = [];
        for (var a = 0; a < s; a++) {
          var l = i.getPoint(a);
          o.push(new _(l.x, l.y, l.z));
        }
        return o;
      }
    }, {
      key: "createCrowd",
      value: function createCrowd(t, e) {
        return new DE(this, t, e);
      }
    }, {
      key: "setDefaultQueryExtent",
      value: function setDefaultQueryExtent(t) {
        bt.x = t.x, bt.y = t.y, bt.z = t.z, this.navMesh.setDefaultQueryExtent(bt);
      }
    }, {
      key: "getDefaultQueryExtent",
      value: function getDefaultQueryExtent() {
        return this.navMesh.getDefaultQueryExtent();
      }
    }, {
      key: "buildFromNavmeshData",
      value: function buildFromNavmeshData(t) {
        var e = t.length * t.BYTES_PER_ELEMENT,
          r = this.navmeshWasm._malloc(e),
          i = new Uint8Array(this.navmeshWasm.HEAPU8.buffer, r, e);
        i.set(t);
        var s = new this.navmeshWasm.NavmeshData();
        s.dataPointer = i.byteOffset, s.size = t.length, this.navMesh.buildFromNavmeshData(s), this.navmeshWasm._free(i.byteOffset);
      }
    }, {
      key: "getNavmeshData",
      value: function getNavmeshData() {
        var t = this.navMesh.getNavmeshData(),
          e = new Uint8Array(this.navmeshWasm.HEAPU8.buffer, t.dataPointer, t.size),
          r = new Uint8Array(t.size);
        return r.set(e), this.navMesh.freeNavmeshData(t), r;
      }
    }, {
      key: "getDefaultQueryExtentToRef",
      value: function getDefaultQueryExtentToRef(t) {
        var e = this.navMesh.getDefaultQueryExtent();
        t.set(e.x, e.y, e.z);
      }
    }, {
      key: "dispose",
      value: function dispose() {
        var _this$eventContext14;
        this.navMesh.destroy(), this._worker.terminate(), URL.revokeObjectURL(this._workerURL), (_this$eventContext14 = this.eventContext) === null || _this$eventContext14 === void 0 ? void 0 : _this$eventContext14.renderer.domElement.removeEventListener("pointerdown", this.onPointerDown);
      }
    }, {
      key: "addCylinderObstacle",
      value: function addCylinderObstacle(t, e, r) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, this.navMesh.addCylinderObstacle(bt, e, r);
      }
    }, {
      key: "addBoxObstacle",
      value: function addBoxObstacle(t, e, r) {
        return bt.x = t.x, bt.y = t.y, bt.z = t.z, $i.x = e.x, $i.y = e.y, $i.z = e.z, this.navMesh.addBoxObstacle(bt, $i, r);
      }
    }, {
      key: "removeObstacle",
      value: function removeObstacle(t) {
        this.navMesh.removeObstacle(t);
      }
    }, {
      key: "isSupported",
      value: function isSupported() {
        return this.navmeshWasm !== void 0;
      }
    }]);
    return Ab;
  }(),
  DE = /*#__PURE__*/function () {
    function DE(t, e, r) {
      _classCallCheck(this, DE);
      this.navmeshWasmWrapper = t;
      this.transforms = [];
      this.agents = new Array();
      this.reachRadii = new Array();
      this._agentDestinationArmed = new Array();
      this._agentDestination = new Array();
      this.crowd = new this.navmeshWasmWrapper.navmeshWasm.Crowd(e, r, this.navmeshWasmWrapper.navMesh.getNavMesh());
    }
    _createClass(DE, [{
      key: "onReachTarget",
      value: function onReachTarget(t, e) {}
    }, {
      key: "addAgent",
      value: function addAgent(t, e, r) {
        var i = new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams();
        i.radius = e.radius, i.height = e.height, i.maxAcceleration = e.maxAcceleration, i.maxSpeed = e.maxSpeed, i.collisionQueryRange = e.collisionQueryRange, i.pathOptimizationRange = e.pathOptimizationRange, i.separationWeight = e.separationWeight, i.updateFlags = 7, i.obstacleAvoidanceType = 0, i.queryFilterType = 0, i.userData = 0;
        var s = this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x, t.y, t.z), i);
        return this.transforms.push(r), this.agents.push(s), this.reachRadii.push(e.reachRadius ? e.reachRadius : e.radius), this._agentDestinationArmed.push(!1), this._agentDestination.push(new _(0, 0, 0)), s;
      }
    }, {
      key: "getAgentPosition",
      value: function getAgentPosition(t) {
        return this.crowd.getAgentPosition(t);
      }
    }, {
      key: "getAgentPositionToRef",
      value: function getAgentPositionToRef(t, e) {
        var r = this.crowd.getAgentPosition(t);
        e.set(r.x, r.y, r.z);
      }
    }, {
      key: "getAgentVelocity",
      value: function getAgentVelocity(t) {
        return this.crowd.getAgentVelocity(t);
      }
    }, {
      key: "getAgentVelocityToRef",
      value: function getAgentVelocityToRef(t, e) {
        var r = this.crowd.getAgentVelocity(t);
        e.set(r.x, r.y, r.z);
      }
    }, {
      key: "getAgentNextTargetPath",
      value: function getAgentNextTargetPath(t) {
        return this.crowd.getAgentNextTargetPath(t);
      }
    }, {
      key: "getAgentNextTargetPathToRef",
      value: function getAgentNextTargetPathToRef(t, e) {
        var r = this.crowd.getAgentNextTargetPath(t);
        e.set(r.x, r.y, r.z);
      }
    }, {
      key: "getAgentState",
      value: function getAgentState(t) {
        return this.crowd.getAgentState(t);
      }
    }, {
      key: "overOffmeshConnection",
      value: function overOffmeshConnection(t) {
        return this.crowd.overOffmeshConnection(t);
      }
    }, {
      key: "agentGoto",
      value: function agentGoto(t, e) {
        this.crowd.agentGoto(t, new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x, e.y, e.z));
        var r = this.agents.indexOf(t);
        r > -1 && (this._agentDestinationArmed[r] = !0, this._agentDestination[r].set(e.x, e.y, e.z));
      }
    }, {
      key: "agentTeleport",
      value: function agentTeleport(t, e) {
        this.crowd.agentTeleport(t, new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x, e.y, e.z));
      }
    }, {
      key: "updateAgentParameters",
      value: function updateAgentParameters(t, e) {
        var r = this.crowd.getAgentParameters(t);
        e.radius !== void 0 && (r.radius = e.radius), e.height !== void 0 && (r.height = e.height), e.maxAcceleration !== void 0 && (r.maxAcceleration = e.maxAcceleration), e.maxSpeed !== void 0 && (r.maxSpeed = e.maxSpeed), e.collisionQueryRange !== void 0 && (r.collisionQueryRange = e.collisionQueryRange), e.pathOptimizationRange !== void 0 && (r.pathOptimizationRange = e.pathOptimizationRange), e.separationWeight !== void 0 && (r.separationWeight = e.separationWeight), this.crowd.setAgentParameters(t, r);
      }
    }, {
      key: "removeAgent",
      value: function removeAgent(t) {
        this.crowd.removeAgent(t);
        var e = this.agents.indexOf(t);
        e > -1 && (this.agents.splice(e, 1), this.transforms.splice(e, 1), this.reachRadii.splice(e, 1), this._agentDestinationArmed.splice(e, 1), this._agentDestination.splice(e, 1));
      }
    }, {
      key: "getAgents",
      value: function getAgents() {
        return this.agents;
      }
    }, {
      key: "update",
      value: function update(t) {
        if (this.navmeshWasmWrapper.navMesh.update(), t <= lN) return;
        var e = 1 / 60,
          r = 10;
        if (e <= lN) this.crowd.update(t);else {
          var _i194 = Math.floor(t / e);
          r && _i194 > r && (_i194 = r), _i194 < 1 && (_i194 = 1);
          var _s132 = t / _i194;
          for (var o = 0; o < _i194; o++) this.crowd.update(_s132);
        }
        for (var _i195 = 0; _i195 < this.agents.length; _i195++) {
          var _s133 = this.agents[_i195],
            _o80 = this.getAgentPosition(_s133);
          if (this.transforms[_i195].copy(_o80), this._agentDestinationArmed[_i195]) {
            var a = _o80.x - this._agentDestination[_i195].x,
              l = _o80.z - this._agentDestination[_i195].z,
              u = this.reachRadii[_i195],
              c = this._agentDestination[_i195].y - this.reachRadii[_i195],
              d = this._agentDestination[_i195].y + this.reachRadii[_i195],
              _h108 = a * a + l * l;
            _o80.y > c && _o80.y < d && _h108 < u * u && (this.onReachTarget(_s133, this._agentDestination[_i195]), this._agentDestinationArmed[_i195] = !1);
          }
        }
      }
    }, {
      key: "setDefaultQueryExtent",
      value: function setDefaultQueryExtent(t) {
        var e = new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x, t.y, t.z);
        this.crowd.setDefaultQueryExtent(e);
      }
    }, {
      key: "getDefaultQueryExtent",
      value: function getDefaultQueryExtent() {
        return this.crowd.getDefaultQueryExtent();
      }
    }, {
      key: "getDefaultQueryExtentToRef",
      value: function getDefaultQueryExtentToRef(t) {
        var e = this.crowd.getDefaultQueryExtent();
        t.set(e.x, e.y, e.z);
      }
    }, {
      key: "getCorners",
      value: function getCorners(t) {
        var e,
          r = this.crowd.getCorners(t),
          i = r.getPointCount(),
          s = [];
        for (e = 0; e < i; e++) {
          var o = r.getPoint(e);
          s.push(new _(o.x, o.y, o.z));
        }
        return s;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.crowd.destroy();
      }
    }]);
    return DE;
  }();
function OE(n) {
  var t = !1;
  return n.scene.objects.forEach(function (e) {
    e.data.type === "Page" && !t && e.data.publish.gameControlObject && Al.traverseModuleInstances(n, e.id, function (i, s, o) {
      var _iterator186 = _createForOfIteratorHelper(o),
        _step186;
      try {
        for (_iterator186.s(); !(_step186 = _iterator186.n()).done;) {
          var a = _step186.value;
          a.data.type === "GameControl" && a.data.navmesh.enabled && (t = !0);
        }
      } catch (err) {
        _iterator186.e(err);
      } finally {
        _iterator186.f();
      }
    });
  }), t;
}
var rJ = {
    type: "change"
  },
  dN = {
    type: "changeZoom"
  },
  iJ = {
    type: "changePan"
  },
  Vf = {
    type: "start"
  },
  Uf = {
    type: "end",
    changed: !0
  },
  nJ = {
    type: "end",
    changed: !1
  },
  IE = new je(),
  hN = new N(),
  sJ = 2 * Math.PI,
  oJ = 1e-8,
  aJ = .01,
  RE = new _(),
  _b = new N(),
  LE = new _(),
  Eb = new je(),
  fN = new te();
var lJ = {
    type: "requestRender"
  },
  Gf = /*#__PURE__*/function (_ir17) {
    _inherits(Gf, _ir17);
    var _super313 = _createSuper(Gf);
    function Gf(e, r) {
      var _this407;
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {
        isPlayMode: !1,
        isExport: !1
      };
      _classCallCheck(this, Gf);
      _this407 = _super313.call(this);
      _this407.object = e;
      _this407.domElement = r;
      _this407.options = i;
      _this407.enabled = !0;
      _this407.useKeyEvents = !0;
      _this407.enableDamping = !1;
      _this407.enableZoom = !0;
      _this407.enableRotate = !0;
      _this407.enablePan = !0;
      _this407.autoRotate = !1;
      _this407.rotationLimitsMode = 0;
      _this407.panLimitsMode = 0;
      _this407.rotationSoftLimit = 2;
      _this407.panSoftLimit = 2;
      _this407.hoverRotatePanMode = 0;
      _this407.zoomLimitsEnabled = !1;
      _this407.mouseButtons = [0, 5];
      _this407.mouseButtonsPlay = [3, 4, 5];
      _this407.touches = [null, qn.DOLLY_ROTATE, qn.PAN];
      _this407.offset = new _();
      _this407.eye = new _();
      _this407.lastPosition = new _();
      _this407.lastQuaternion = new je();
      _this407.current = new N();
      _this407.overShoot = new N();
      _this407.overRatio = new N();
      _this407.spherical = new wp();
      _this407.sphericalDelta = new wp();
      _this407.panOffset = new _();
      _this407.panLeftV = new _();
      _this407.panUpV = new _();
      _this407.panV = new _();
      _this407.rotateStart = new N();
      _this407.rotateEnd = new N();
      _this407.rotateDelta = new N();
      _this407.panStart = new N();
      _this407.panEnd = new N();
      _this407.panDelta = new N();
      _this407.dollyStart = new N();
      _this407.dollyEnd = new N();
      _this407.dollyDelta = new N();
      _this407.rotationRangeFactor = new N();
      _this407.panRangeFactor = new N();
      _this407.state = -1;
      _this407.zoomChanged = !1;
      _this407.isPointerDown = !1;
      _this407.isThetaFlipped = !1;
      _this407.prevScale = 0;
      _this407.scale = 1;
      _this407.gesture = !1;
      _this407.timer = -1;
      _this407.timerHover = -1;
      _this407.minDistance = 0;
      _this407.maxDistance = 1 / 0;
      _this407.minZoom = 0;
      _this407.maxZoom = 1 / 0;
      _this407.minPhi = 0;
      _this407.maxPhi = Math.PI;
      _this407.minTheta = -1 / 0;
      _this407.maxTheta = 1 / 0;
      _this407.minH = 0;
      _this407.maxH = Math.PI;
      _this407.minV = -1 / 0;
      _this407.maxV = 1 / 0;
      _this407.autoRotateClockwise = !0;
      _this407.isPanOverShoot = !1;
      _this407.isRotateOverShoot = !1;
      _this407.resetHoverEffectOnPointerLeave = !1;
      _this407.hasChange = !1;
      _this407.useWindowEvents = !1;
      _this407.isTouchZoom = !0;
      _this407.autoRotateSpeed = 2;
      _this407.dampingFactor = .125;
      _this407.zoomSpeed = 2;
      _this407.rotateSpeed = 1;
      _this407.panSpeed = 1;
      _this407.hoverRotatePanStrength = .1;
      _this407.hoverRotateDamping = _this407.dampingFactor;
      _this407.thetaIsFree = !1;
      _this407.phiIsFree = !1;
      _this407.needsUpdate = !0;
      _this407.onCameraChange = function (e) {
        _this407.object.removeEventListener("beginState", _this407.onBeginState), _this407.object.removeEventListener("completeState", _this407.onCompleteState), _this407.object.removeEventListener("cameraChange", _this407.onCameraChange), _this407.object = e.camera, _this407.object.addEventListener("beginState", _this407.onBeginState), _this407.object.addEventListener("completeState", _this407.onCompleteState), _this407.object.addEventListener("cameraChange", _this407.onCameraChange);
      };
      _this407.update = function () {
        _this407.object.updateWorldMatrix(!0, !1), _this407.object.matrixWorld.decompose(LE, Eb, RE), _this407.offset.copy(LE).sub(_this407.target), _this407.spherical.setFromVector3(_this407.offset), _this407.object.isUpVectorFlipped && (_this407.spherical.phi *= -1, _this407.spherical.theta -= Math.PI), _this407.autoRotate && _this407.state === -1 && _this407.rotateLeft((_this407.autoRotateClockwise === !0 ? 1 : -1) * _this407.getAutoRotationAngle()), _this407.rotationLimitsMode !== 0 && _this407.applyLimits(_this407.sphericalDelta, _this407.rotationLimitsMode, _this407.rotationSoftLimit, _this407.maxTheta, _this407.minTheta, _this407.maxPhi, _this407.minPhi, _this407.rotationRangeFactor), _this407.rotationLimitsMode !== 2 && (_this407.spherical.phi += _this407.sphericalDelta.phi), (_this407.rotationLimitsMode !== 1 || _this407.autoRotate === !0) && (_this407.spherical.theta += _this407.sphericalDelta.theta), _this407.spherical.radius *= _this407.scale, _this407.zoomLimitsEnabled && (_this407.spherical.radius = Math.max(_this407.minDistance, Math.min(_this407.maxDistance, _this407.spherical.radius))), _this407.panLimitsMode !== 0 && (_this407.target.applyQuaternion(IE.copy(Eb).invert()), _this407.panOffset.applyQuaternion(IE), _this407.applyLimits(_this407.panOffset, _this407.panLimitsMode, _this407.panSoftLimit, _this407.maxH, _this407.minH, _this407.maxV, _this407.minV, _this407.panRangeFactor), _this407.target.applyQuaternion(Eb), _this407.panOffset.applyQuaternion(Eb)), _this407.panLimitsMode === 2 && (_this407.panOffset.y = 0), _this407.panLimitsMode === 1 && (_this407.panOffset.x = 0), _this407.state === -1 && !_this407.gesture ? (_this407.panOffset.multiplyScalar(1 - _this407.dampingFactor), _this407.target.add(_this407.panOffset)) : (_this407.target.add(_this407.panOffset), _this407.panOffset.set(0, 0, 0)), _this407.offset.setFromSpherical(_this407.spherical), LE.copy(_this407.target).add(_this407.offset), _this407.object.position.copy(_this407.target).add(_this407.offset), _this407.object.parent && (fN.copy(_this407.object.parent.matrixWorld).invert(), _this407.object.position.applyMatrix4(fN));
        var e = _this407.spherical.phi % sJ;
        if (_this407.eye.copy(_this407.offset).normalize(), _this407.object.up.copy(mt.DEFAULT_UP).applyAxisAngle(_this407.eye, _this407.object.angleOffsetFromUp), e > 0 && e > Math.PI || e < 0 && e > -Math.PI ? (_this407.object.up.negate(), _this407.object.lookAt(_this407.target), _this407.object.isUpVectorFlipped = !0) : (_this407.object.lookAt(_this407.target), _this407.object.isUpVectorFlipped = !1), _this407.state === -1 || _this407.enableDamping === !0) {
          var _r76 = _this407.hoverRotatePanMode === 1 ? _this407.hoverRotateDamping : _this407.dampingFactor;
          _this407.sphericalDelta.theta *= 1 - _r76, _this407.sphericalDelta.phi *= 1 - _r76;
        } else _this407.sphericalDelta.set(0, 0, 0);
        return _this407.scale = 1, _this407.zoomChanged || _this407.lastPosition.distanceToSquared(_this407.object.position) > aJ || 8 * (1 - _this407.lastQuaternion.dot(_this407.object.quaternion)) > oJ ? (_this407.dispatchEvent(rJ), _this407.object.dispatchEvent(lJ), _this407.lastPosition.copy(_this407.object.position), _this407.lastQuaternion.copy(_this407.object.quaternion), _this407.zoomChanged = !1, !0) : (_this407.isPanOverShoot = !1, _this407.isRotateOverShoot = !1, _this407.object.wasMovedBySwitchCameraAction = !1, _this407.sphericalDelta.set(0, 0, 0), _this407.panOffset.set(0, 0, 0), !1);
      };
      _this407.onPointerDown = function (e) {
        _this407.enabled !== !1 && (e.pointerType === "touch" || e.pointerType === "pen" && Si ? _this407.onPointerDownTouch(e) : _this407.onPointerDownMouse(e), _this407.state !== -1 && (_this407.isPointerDown = !0, _this407.dispatchEvent(Vf), _this407.domElement.addEventListener("pointermove", _this407.onPointerMove), _this407.domElement.addEventListener("pointerup", _this407.onPointerUp), e.stopPropagation(), e.pointerType === "touch" || e.pointerType === "pen" && Si || _this407.domElement.setPointerCapture(e.pointerId)));
      };
      _this407.onPointerLeave = function (e) {
        _this407.resetHoverEffectOnPointerLeave && !_this407.useWindowEvents ? (_this407.hoverRotatePanMode === 1 ? (_this407.sphericalDelta.theta = -_this407.spherical.theta, _this407.sphericalDelta.phi = -_this407.spherical.phi, RE.subVectors(_this407.position0, _this407.target0), _this407.spherical.setFromVector3(RE), _this407.sphericalDelta.theta += _this407.spherical.theta, _this407.sphericalDelta.phi += _this407.spherical.phi, _this407.sphericalDelta.theta /= 8, _this407.sphericalDelta.phi /= 8) : _this407.hoverRotatePanMode === 2 && _this407.panOffset.subVectors(_this407.target0, _this407.target).divideScalar(8), _this407.update()) : _this407.pointerLeaveEvent = e;
      };
      _this407.onPointerEnter = function (e) {
        _this407.resetHoverEffectOnPointerLeave || _this407.pointerLeaveEvent === void 0 ? _b.set(e.clientX - _this407.domElement.clientWidth / 2, e.clientY - _this407.domElement.clientHeight / 2) : _b.set(e.clientX - _this407.pointerLeaveEvent.clientX, e.clientY - _this407.pointerLeaveEvent.clientY), _this407.hoverRotatePanMode === 1 ? (_this407.rotateDelta.copy(_b).multiplyScalar(_this407.rotateSpeed * _this407.hoverRotatePanStrength).rotateAround(hN, -_this407.object.angleOffsetFromUp), _this407.rotateLeft(2 * Math.PI * _this407.rotateDelta.x / _this407.domElement.clientHeight), _this407.rotateUp(2 * Math.PI * _this407.rotateDelta.y / _this407.domElement.clientHeight), _this407.rotateStart.set(e.clientX, e.clientY)) : _this407.hoverRotatePanMode === 2 && (_this407.panDelta.copy(_b).multiplyScalar(_this407.panSpeed * _this407.hoverRotatePanStrength), _this407.pan(_this407.panDelta.x, _this407.panDelta.y), _this407.panStart.set(e.clientX, e.clientY)), _this407.update();
      };
      _this407.onPointerMove = function (e) {
        _this407.enabled !== !1 && (_this407.checkRaycastLock() || (e.pointerType === "touch" || e.pointerType === "pen" && Si ? _this407.onPointerMoveTouch(e) : _this407.onPointerMoveMouse(e), e.stopPropagation()));
      };
      _this407.onPointerUp = function (e) {
        _this407.isPointerDown = !1, Ye.length === 0 && (_this407.domElement.removeEventListener("pointermove", _this407.onPointerMove), _this407.domElement.removeEventListener("pointerup", _this407.onPointerUp)), Ye.length > 1 && e.preventDefault(), _this407.hasChange ? _this407.dispatchEvent(Uf) : _this407.dispatchEvent(nJ), _this407.state = -1, e && (e.stopPropagation(), e.pointerType === "touch" || e.pointerType === "pen" && Si || _this407.domElement.releasePointerCapture(e.pointerId));
      };
      _this407.onPointerDownMouse = function (e) {
        var r;
        switch (_this407.useKeyEvents ? r = _this407.mouseButtons[e.button] : r = _this407.mouseButtonsPlay[e.button], r) {
          case 0:
            if (e.altKey === !0 && !e.shiftKey && !Lp(e)) {
              if (_this407.enableRotate === !1) return;
              _this407.handleMouseDownRotate(e), _this407.state = 0;
            } else if (_this407.key === " ") {
              if (_this407.enablePan === !1) return;
              _this407.handleMouseDownPan(e), _this407.state = 2;
            }
            break;
          case 4:
            if (_this407.enablePan === !1) return;
            _this407.handleMouseDownPan(e), _this407.state = 2;
            break;
          case 3:
            if (Lp(e) || e.shiftKey) {
              if (_this407.enablePan === !1) return;
              _this407.handleMouseDownPan(e), _this407.state = 2;
            } else {
              if (_this407.enableRotate === !1) return;
              _this407.handleMouseDownRotate(e), _this407.state = 0;
            }
            break;
          case 5:
            if (Lp(e) || e.shiftKey) {
              if (_this407.enableRotate === !1) return;
              _this407.handleMouseDownRotate(e), _this407.state = 0;
            } else {
              if (_this407.enablePan === !1) return;
              _this407.handleMouseDownPan(e), _this407.state = 2;
            }
            break;
          default:
            _this407.state = -1;
        }
      };
      _this407.onPointerMoveMouse = function (e) {
        switch (_this407.state) {
          case 0:
            if (_this407.enableRotate === !1) return;
            _this407.handleMouseMoveRotate(e);
            break;
          case 1:
            if (_this407.enableZoom === !1) return;
            _this407.handleMouseMoveDolly(e);
            break;
          case 2:
            if (_this407.enablePan === !1) return;
            _this407.handleMouseMovePan(e);
            break;
        }
        _this407.object.wasMovedByUser = !0;
      };
      _this407.onPointerDownTouch = function (e) {
        switch (Ye.length > 1 && e.preventDefault(), _this407.touches[Ye.length - 1]) {
          case qn.ROTATE:
            if (_this407.enableRotate === !1) {
              _this407.state = -1;
              return;
            }
            _this407.handleTouchStartRotate(), _this407.state = 3;
            break;
          case qn.PAN:
            if (_this407.enablePan === !1) {
              _this407.state = -1;
              return;
            }
            _this407.handleTouchStartPan(), _this407.state = 4;
            break;
          case qn.DOLLY_PAN:
            if (_this407.enableZoom === !1 && _this407.enablePan === !1) return;
            _this407.handleTouchStartDollyPan(), _this407.state = 5;
            break;
          case qn.DOLLY_ROTATE:
            if (_this407.enableZoom === !1 && _this407.enableRotate === !1) return;
            _this407.handleTouchStartDollyRotate(), _this407.state = 6;
            break;
          default:
            _this407.state = -1;
        }
      };
      _this407.onPointerMoveTouch = function (e) {
        switch (Ye.length > 1 && e.preventDefault(), _this407.state) {
          case 3:
            if (_this407.enableRotate === !1) return;
            _this407.handleTouchMoveRotate(e), _this407.update();
            break;
          case 4:
            if (_this407.enablePan === !1) return;
            _this407.handleTouchMovePan(e), _this407.update();
            break;
          case 5:
            if (_this407.enableZoom === !1 && _this407.enablePan === !1) return;
            _this407.handleTouchMoveDollyPan(e), _this407.update();
            break;
          case 6:
            if (_this407.enableZoom === !1 && _this407.enableRotate === !1) return;
            _this407.handleTouchMoveDollyRotate(e), _this407.update();
            break;
          default:
            _this407.state = -1;
        }
        _this407.object.wasMovedByUser = !0;
      };
      _this407.dispatchEndDebounced = Ec(function () {
        return _this407.dispatchEvent(Uf);
      }, 33);
      _this407.onMouseWheel = function (e) {
        _this407.enabled === !1 || _this407.enableZoom === !1 && _this407.enablePan === !1 || _this407.checkRaycastLock() || (!_this407.options.isExport && _this407.domElement.clientHeight === document.body.clientHeight && _this407.domElement.clientWidth === document.body.clientWidth && e.preventDefault(), _this407.dispatchEvent(Vf), _this407.handleMouseWheel(e), _this407.dispatchEndDebounced(), _this407.object.wasMovedByUser = !0);
      };
      _this407.onGesture = function (e) {
        if (e.preventDefault(), _this407.enabled !== !1 && !_this407.checkRaycastLock() && !Md) if (e.type === "gesturechange") {
          if (_this407.enableZoom === !1 || _this407.isTouchZoom === !1) return;
          _this407.dispatchEvent(Vf), e.scale > _this407.prevScale ? _this407.dollyIn(_this407.getZoomScale()) : e.scale < _this407.prevScale && _this407.dollyOut(_this407.getZoomScale()), _this407.prevScale = e.scale, _this407.update(), _this407.object.wasMovedByUser = !0;
        } else _this407.dispatchEvent(Uf);
      };
      _this407.onContextMenu = function (e) {
        e.preventDefault();
      };
      _this407.onTouchEnd = function (e) {
        e.preventDefault();
      };
      _this407.onKeyDown = function (e) {
        _this407.enabled !== !1 && (_this407.key = e.key, e.key === " " && _this407.dispatchEvent(Vf));
      };
      _this407.onKeyUp = function (e) {
        _this407.enabled !== !1 && (_this407.key = void 0, _this407.state !== -1 && e.key === "Alt" && _this407.onPointerUp(Ye[0]), e.key === " " && _this407.dispatchEvent(Uf));
      };
      _this407.onPointerHover = function (e) {
        e.pointerType !== "mouse" || _this407.enabled === !1 || _this407.state !== -1 || _this407.hoverRotatePanMode === 2 && _this407.isPanOverShoot || _this407.hoverRotatePanMode === 1 && _this407.isRotateOverShoot || (_this407.isPointerDown = !0, _this407.hoverRotatePanMode === 2 ? _this407.handleMouseMovePan(e, _this407.hoverRotatePanStrength) : _this407.hoverRotatePanMode === 1 && _this407.handleMouseMoveRotate(e, _this407.hoverRotatePanStrength));
      };
      _this407.onBeginState = function () {
        _this407.enabled = !1, _this407.needsUpdate = !1;
      };
      _this407.onCompleteState = function (e) {
        e.isfromEntity && _this407.options.isPlayMode || (_this407.enabled = !0, _this407.needsUpdate = !0, _this407.object.updateUp(), _this407.object.getTarget(_this407.target));
      };
      _this407.target = _this407.object.getTarget(), _this407.target0 = _this407.target.clone(), _this407.position0 = _this407.object.position.clone(), _this407.zoom0 = _this407.object.zoom, _this407.quat0 = _this407.object.quaternion.clone(), _this407.isUpVectorFlipped0 = _this407.object.isUpVectorFlipped, _this407.offset.copy(_this407.object.position).sub(_this407.target), _this407.spherical.setFromVector3(_this407.offset), _this407.object.isUpVectorFlipped && (_this407.spherical.phi *= -1, _this407.spherical.theta -= Math.PI), _this407.addEventListenersToCamera();
      return _this407;
    }
    _createClass(Gf, [{
      key: "dispatchEvent",
      value: function dispatchEvent(e) {
        e.type === "start" ? this.hasChange = !1 : this.hasChange = !0, _get(_getPrototypeOf(Gf.prototype), "dispatchEvent", this).call(this, e);
      }
    }, {
      key: "addEventListenersToCamera",
      value: function addEventListenersToCamera() {
        this.object.addEventListener("beginState", this.onBeginState), this.object.addEventListener("completeState", this.onCompleteState), this.object.addEventListener("cameraChange", this.onCameraChange);
      }
    }, {
      key: "removeEventListenersFromCamera",
      value: function removeEventListenersFromCamera() {
        this.object.removeEventListener("beginState", this.onBeginState), this.object.removeEventListener("completeState", this.onCompleteState), this.object.removeEventListener("cameraChange", this.onCameraChange);
      }
    }, {
      key: "updateUseWindowEvents",
      value: function updateUseWindowEvents(e) {
        if (window.removeEventListener("pointermove", this.onPointerHover), this.domElement.removeEventListener("pointermove", this.onPointerHover), this.useWindowEvents = e, this.hoverRotatePanMode !== 0 && (this.useWindowEvents ? window.addEventListener("pointermove", this.onPointerHover) : this.domElement.addEventListener("pointermove", this.onPointerHover)), this.domElement.removeEventListener("pointerleave", this.onPointerLeave), this.domElement.removeEventListener("pointerenter", this.onPointerEnter), window.removeEventListener("pointerleave", this.onPointerLeave), window.removeEventListener("pointerenter", this.onPointerEnter), this.hoverRotatePanMode !== 0 && !this.useWindowEvents) {
          var r = this.useWindowEvents ? window : this.domElement;
          r.addEventListener("pointerleave", this.onPointerLeave), r.addEventListener("pointerenter", this.onPointerEnter);
        }
      }
    }, {
      key: "fromJSON",
      value: function fromJSON(e, r) {
        var _e$hoverRotateDamping, _e$resetHoverEffectOn;
        this.setEnableDampingSpeed(e.enableDamping), this.enablePan = e.enablePan, this.enableZoom = e.enableZoom, this.enableRotate = e.enableRotate, this.rotationLimitsMode = e.rotationLimitsMode, this.thetaIsFree = e.rotationHorizontalOffset.min === e.rotationHorizontalOffset.max && e.rotationHorizontalOffset.min === Math.PI, this.phiIsFree = e.rotationVerticalOffset.min === e.rotationVerticalOffset.max && e.rotationVerticalOffset.min === Math.PI, this.panLimitsMode = e.panLimitsMode, this.panSoftLimit = e.panSoftLimit, this.rotationSoftLimit = e.rotationSoftLimit, this.hoverRotatePanMode = e.hoverRotatePanMode, this.hoverRotateDamping = (_e$hoverRotateDamping = e.hoverRotateDamping) !== null && _e$hoverRotateDamping !== void 0 ? _e$hoverRotateDamping : this.dampingFactor, this.useWindowEvents = r === "window", this.hoverRotatePanMode !== 0 && (this.useWindowEvents ? window.addEventListener("pointermove", this.onPointerHover) : this.domElement.addEventListener("pointermove", this.onPointerHover));
        var i = e.hoverRotatePanStrength / 100;
        this.hoverRotatePanStrength = Math.pow(i, 2), this.zoomLimitsEnabled = e.zoomLimitsEnabled, this.minZoom = e.zoomLimits.min, this.maxZoom = Math.max(e.zoomLimits.min, e.zoomLimits.max), this.minDistance = 1e3 / e.zoomLimits.max, this.maxDistance = Math.max(this.minDistance, 1e3 / e.zoomLimits.min), this.autoRotate = e.autoRotate, this.autoRotateSpeed = e.autoRotateSpeed, this.autoRotateClockwise = e.autoRotateClockwise;
        var s = this.object.getTarget().applyQuaternion(IE.copy(this.object.quaternion).invert());
        this.minV = -e.panVerticalOffset.min + s.y, this.maxV = e.panVerticalOffset.max + s.y, this.minH = -e.panHorizontalOffset.min + s.x, this.maxH = e.panHorizontalOffset.max + s.x, this.panRangeFactor.set(this.maxH - this.minH, this.maxV - this.minV).divideScalar(2), this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4), this.minPhi = Xo(this.spherical.phi - e.rotationVerticalOffset.min), this.maxPhi = Xo(this.spherical.phi + e.rotationVerticalOffset.max), this.minTheta = Xo(Xo(this.spherical.theta) - e.rotationHorizontalOffset.min), this.maxTheta = Xo(Xo(this.spherical.theta) + e.rotationHorizontalOffset.max), this.isThetaFlipped = this.minTheta > this.maxTheta, e.orbitTouches === 1 && (this.touches[0] = qn.ROTATE), e.panTouches === 1 && (this.touches[0] = qn.PAN), e.orbitTouches === 2 && (this.touches[1] = qn.DOLLY_ROTATE), e.panTouches === 2 && (this.touches[1] = qn.DOLLY_PAN), e.orbitTouches === 3 && (this.touches[2] = qn.ROTATE), e.panTouches === 3 && (this.touches[2] = qn.PAN), this.isTouchZoom = e.isTouchZoom, this.resetHoverEffectOnPointerLeave = (_e$resetHoverEffectOn = e.resetHoverEffectOnPointerLeave) !== null && _e$resetHoverEffectOn !== void 0 ? _e$resetHoverEffectOn : !1;
      }
    }, {
      key: "connect",
      value: function connect() {
        if (this.domElement.addEventListener("contextmenu", this.onContextMenu), this.domElement.addEventListener("pointerdown", this.onPointerDown), this.domElement.addEventListener("wheel", this.onMouseWheel), window.addEventListener("keydown", this.onKeyDown, !1), window.addEventListener("keyup", this.onKeyUp, !1), this.domElement.addEventListener("gesturestart", this.onGesture), this.domElement.addEventListener("gesturechange", this.onGesture), this.domElement.addEventListener("gestureend", this.onGesture), this.domElement.addEventListener("touchend", this.onTouchEnd), this.hoverRotatePanMode !== 0 && !this.useWindowEvents) {
          var e = this.useWindowEvents ? window : this.domElement;
          e.addEventListener("pointerleave", this.onPointerLeave), e.addEventListener("pointerenter", this.onPointerEnter);
        }
        this.pointerLeaveEvent = void 0;
      }
    }, {
      key: "dispose",
      value: function dispose() {
        this.removeEventListenersFromCamera(), this.domElement.removeEventListener("contextmenu", this.onContextMenu), this.domElement.removeEventListener("pointerdown", this.onPointerDown), this.domElement.removeEventListener("wheel", this.onMouseWheel), window.removeEventListener("keydown", this.onKeyDown, !1), window.removeEventListener("keyup", this.onKeyUp, !1), this.domElement.removeEventListener("pointermove", this.onPointerHover), window.removeEventListener("pointermove", this.onPointerHover), this.domElement.removeEventListener("gesturestart", this.onGesture), this.domElement.removeEventListener("gesturechange", this.onGesture), this.domElement.removeEventListener("gestureend", this.onGesture), this.domElement.removeEventListener("touchend", this.onTouchEnd), this.domElement.removeEventListener("pointerleave", this.onPointerLeave), this.domElement.removeEventListener("pointerenter", this.onPointerEnter), window.removeEventListener("pointerleave", this.onPointerLeave), window.removeEventListener("pointerenter", this.onPointerEnter), this.domElement.removeEventListener("pointermove", this.onPointerMove), this.domElement.removeEventListener("pointerup", this.onPointerUp);
      }
    }, {
      key: "applyLimits",
      value: function applyLimits(e, r, i, s, o, a, l, u) {
        this.overShoot.set(0, 0);
        var c, d, h;
        e instanceof _ ? (c = e.x, d = e.y, this.current.set(this.target.x, this.target.y), h = !0) : (c = e.theta, d = e.phi, this.current.set(Xo(this.spherical.theta), Xo(this.spherical.phi)), h = !1), i === 0 && (this.current.x += c, this.current.y += d), (r === 3 || r === 2) && (!h && this.isThetaFlipped ? this.current.x > s && this.current.x < 0 ? this.overShoot.x = s - this.current.x : this.current.x < o && this.current.x > 0 && (this.overShoot.x = o - this.current.x) : this.current.x > s ? this.overShoot.x = s - this.current.x : this.current.x < o && (this.overShoot.x = o - this.current.x)), (r === 3 || r === 1) && (this.current.y > a ? this.overShoot.y = a - this.current.y : this.current.y < l && (this.overShoot.y = l - this.current.y)), h || (this.overShoot.x = Xo(this.overShoot.x), this.overShoot.y = Xo(this.overShoot.y)), i !== 0 ? (this.overRatio.copy(this.overShoot).divide(u), this.overRatio.x = Math.min(Math.abs(this.overRatio.x), 1), this.overRatio.y = Math.min(Math.abs(this.overRatio.y), 1), i === 1 && (this.overRatio.x = pN(Math.abs(this.overRatio.x)), this.overRatio.y = pN(Math.abs(this.overRatio.y))), this.isPointerDown || i === 1 ? i === 2 && (this.overRatio.x > .9 && !this.thetaIsFree || this.overRatio.y > .9 && !this.phiIsFree) ? this.isPointerDown = !1 : (c * this.overShoot.x < 0 && !this.thetaIsFree && (c *= 1 - this.overRatio.x), d * this.overShoot.y < 0 && !this.phiIsFree && (d *= 1 - this.overRatio.y)) : i === 2 && (!h && (this.overRatio.x > .002 && !this.thetaIsFree || this.overRatio.y > .002 && !this.phiIsFree) || h && (Math.abs(this.overShoot.x) > 2 || Math.abs(this.overShoot.y) > 2) ? (this.thetaIsFree || (c = this.overShoot.x * .05), this.phiIsFree || (d = this.overShoot.y * .05), h ? this.isPanOverShoot = !0 : this.isRotateOverShoot = !0) : h ? this.isPanOverShoot = !1 : this.isRotateOverShoot = !1)) : (c += this.overShoot.x, d += this.overShoot.y), e instanceof _ ? (e.x = c, e.y = d) : (this.thetaIsFree || (e.theta = c), this.phiIsFree || (e.phi = d));
      }
    }, {
      key: "setEnableDampingSpeed",
      value: function setEnableDampingSpeed(e) {
        this.enableDamping = e, this.rotateSpeed = e === !0 ? .2 : 1;
      }
    }, {
      key: "stopDamping",
      value: function stopDamping() {
        this.sphericalDelta.theta = 0, this.sphericalDelta.phi = 0;
      }
    }, {
      key: "getAutoRotationAngle",
      value: function getAutoRotationAngle() {
        return 2 * Math.PI / 60 / 60 * this.autoRotateSpeed;
      }
    }, {
      key: "getZoomScale",
      value: function getZoomScale() {
        return Math.pow(.95, this.zoomSpeed);
      }
    }, {
      key: "rotateLeft",
      value: function rotateLeft(e) {
        this.sphericalDelta.theta -= e;
      }
    }, {
      key: "rotateUp",
      value: function rotateUp(e) {
        this.sphericalDelta.phi -= e;
      }
    }, {
      key: "panLeft",
      value: function panLeft(e, r) {
        this.panLeftV.setFromMatrixColumn(r, 0), this.panLeftV.multiplyScalar(-e), this.panOffset.add(this.panLeftV);
      }
    }, {
      key: "panUp",
      value: function panUp(e, r) {
        this.panUpV.setFromMatrixColumn(r, 1), this.panUpV.multiplyScalar(e), this.panOffset.add(this.panUpV);
      }
    }, {
      key: "pan",
      value: function pan(e, r) {
        var i = this.domElement;
        if (i && this.object.isPerspectiveCamera) {
          var _s134 = this.object.position;
          this.panV.copy(_s134).sub(this.target);
          var o = this.panV.length();
          o *= Math.tan(this.object.fov / 2 * Math.PI / 180), this.panLeft(2 * e * o / i.clientHeight, this.object.matrixWorld), this.panUp(2 * r * o / i.clientHeight, this.object.matrixWorld);
        } else i && this.object.isOrthographicCamera && (this.panLeft(e * (this.object.right - this.object.left) / this.object.zoom / i.clientWidth, this.object.matrixWorld), this.panUp(r * (this.object.top - this.object.bottom) / this.object.zoom / i.clientHeight, this.object.matrixWorld));
        this.dispatchEvent(iJ);
      }
    }, {
      key: "dollyOut",
      value: function dollyOut(e) {
        this.object.isPerspectiveCamera ? this.scale /= e : this.object.isOrthographicCamera && (this.object.zoom *= e, this.zoomLimitsEnabled && (this.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom))), this.object.updateProjectionMatrix(), this.zoomChanged = !0), this.dispatchEvent(dN);
      }
    }, {
      key: "dollyIn",
      value: function dollyIn(e) {
        this.object.isPerspectiveCamera ? this.scale *= e : this.object.isOrthographicCamera && (this.object.zoom /= e, this.zoomLimitsEnabled && (this.object.zoom = Math.max(this.minZoom, Math.min(this.maxZoom, this.object.zoom))), this.object.updateProjectionMatrix(), this.zoomChanged = !0), this.dispatchEvent(dN);
      }
    }, {
      key: "zoomOut",
      value: function zoomOut() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.getZoomScale();
        this.dispatchEvent(Vf), this.dollyOut(e), this.dispatchEvent(Uf);
      }
    }, {
      key: "zoomIn",
      value: function zoomIn() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.getZoomScale();
        this.dispatchEvent(Vf), this.dollyIn(e), this.dispatchEvent(Uf);
      }
    }, {
      key: "handleMouseDownRotate",
      value: function handleMouseDownRotate(e) {
        this.rotateStart.set(e.clientX, e.clientY);
      }
    }, {
      key: "handleMouseDownDolly",
      value: function handleMouseDownDolly(e) {
        this.dollyStart.set(e.clientX, e.clientY);
      }
    }, {
      key: "handleMouseDownPan",
      value: function handleMouseDownPan(e) {
        this.panStart.set(e.clientX, e.clientY);
      }
    }, {
      key: "handleMouseMoveRotate",
      value: function handleMouseMoveRotate(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
        e.movementX !== void 0 ? this.rotateDelta.set(e.movementX, e.movementY) : (this.rotateEnd.set(e.clientX, e.clientY), this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart), this.rotateStart.copy(this.rotateEnd)), this.rotateDelta.multiplyScalar(this.rotateSpeed * r).rotateAround(hN, -this.object.angleOffsetFromUp);
        var i = this.domElement,
          s = this.useWindowEvents ? window.innerHeight : i.clientHeight,
          o = 2 * Math.PI * this.rotateDelta.x / s,
          a = 2 * Math.PI * this.rotateDelta.y / s;
        this.rotateLeft(o), this.rotateUp(a), this.update();
      }
    }, {
      key: "handleMouseMoveDolly",
      value: function handleMouseMoveDolly(e) {
        this.dollyEnd.set(e.clientX, e.clientY), this.dollyDelta.subVectors(this.dollyEnd, this.dollyStart), this.dollyDelta.y > 0 ? this.dollyOut(this.getZoomScale()) : this.dollyDelta.y < 0 && this.dollyIn(this.getZoomScale()), this.dollyStart.copy(this.dollyEnd), this.update();
      }
    }, {
      key: "handleMouseMovePan",
      value: function handleMouseMovePan(e) {
        var r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
        e.movementX !== void 0 ? this.panDelta.set(e.movementX, e.movementY) : (this.panEnd.set(e.clientX, e.clientY), this.panDelta.subVectors(this.panEnd, this.panStart), this.panStart.copy(this.panEnd)), this.panDelta.multiplyScalar(this.panSpeed * r), this.pan(this.panDelta.x, this.panDelta.y), this.update();
      }
    }, {
      key: "handleMouseWheel",
      value: function handleMouseWheel(e) {
        var _this408 = this;
        if (x2 === !1 && Lp(e) === !1 && b2(e) === !0) {
          if (this.enablePan === !1) return;
          this.gesture ? (this.panDelta.set(-e.deltaX, -e.deltaY).multiplyScalar(this.panSpeed), this.panDelta.x = Math.min(Math.abs(this.panDelta.x), 100) * (this.panDelta.x < 0 ? -1 : 1), this.panDelta.y = Math.min(Math.abs(this.panDelta.y), 100) * (this.panDelta.y < 0 ? -1 : 1), e.altKey ? this.pan(0, this.panDelta.y) : e.shiftKey ? this.pan(this.panDelta.x, 0) : this.pan(this.panDelta.x, this.panDelta.y), this.update()) : (this.gesture = !0, this.isPointerDown = !0), window.clearTimeout(this.timer), this.timer = window.setTimeout(function () {
            _this408.gesture = !1, _this408.isPointerDown = !1;
          }, 30);
        } else {
          if (this.enableZoom === !1) return;
          e.deltaY === 0 ? e.deltaX < 0 ? this.dollyIn(this.getZoomScale()) : e.deltaX > 0 && this.dollyOut(this.getZoomScale()) : e.deltaY < 0 ? this.dollyIn(this.getZoomScale()) : e.deltaY > 0 && this.dollyOut(this.getZoomScale()), this.update(), this.gesture = !1, this.isPointerDown = !1;
        }
      }
    }, {
      key: "handleTouchStartRotate",
      value: function handleTouchStartRotate() {
        if (Ye.length === 2) {
          var e = .5 * (Ye[0].pageX + Ye[1].pageX),
            r = .5 * (Ye[0].pageY + Ye[1].pageY);
          this.rotateStart.set(e, r);
        } else this.rotateStart.set(Ye[0].pageX, Ye[0].pageY);
      }
    }, {
      key: "handleTouchStartPan",
      value: function handleTouchStartPan() {
        if (Ye.length === 2) {
          var e = .5 * (Ye[0].pageX + Ye[1].pageX),
            r = .5 * (Ye[0].pageY + Ye[1].pageY);
          this.panStart.set(e, r);
        } else this.panStart.set(Ye[0].pageX, Ye[0].pageY);
      }
    }, {
      key: "handleTouchStartDolly",
      value: function handleTouchStartDolly() {
        var e = Ye[0].pageX - Ye[1].pageX,
          r = Ye[0].pageY - Ye[1].pageY,
          i = Math.sqrt(e * e + r * r);
        this.dollyStart.set(0, i);
      }
    }, {
      key: "handleTouchStartDollyPan",
      value: function handleTouchStartDollyPan() {
        this.enableZoom && this.isTouchZoom === !0 && this.handleTouchStartDolly(), this.enablePan && this.handleTouchStartPan();
      }
    }, {
      key: "handleTouchStartDollyRotate",
      value: function handleTouchStartDollyRotate() {
        this.enableZoom && this.isTouchZoom === !0 && this.handleTouchStartDolly(), this.enableRotate && this.handleTouchStartRotate();
      }
    }, {
      key: "handleTouchMoveRotate",
      value: function handleTouchMoveRotate(e) {
        if (Ye.length === 2) {
          var _i196 = lv(e),
            _s135 = .5 * (e.pageX + _i196.x),
            o = .5 * (e.pageY + _i196.y);
          this.rotateEnd.set(_s135, o);
        } else {
          if (e.pointerId !== Ye[0].pointerId) return;
          this.rotateEnd.set(e.pageX, e.pageY);
        }
        this.rotateDelta.subVectors(this.rotateEnd, this.rotateStart).multiplyScalar(this.rotateSpeed);
        var r = this.domElement;
        r && (this.rotateLeft(2 * Math.PI * this.rotateDelta.x / r.clientHeight), this.rotateUp(2 * Math.PI * this.rotateDelta.y / r.clientHeight)), this.rotateStart.copy(this.rotateEnd);
      }
    }, {
      key: "handleTouchMovePan",
      value: function handleTouchMovePan(e) {
        if (Ye.length === 2) {
          var r = lv(e),
            _i197 = .5 * (e.pageX + r.x),
            _s136 = .5 * (e.pageY + r.y);
          this.panEnd.set(_i197, _s136);
        } else {
          if (e.pointerId !== Ye[0].pointerId) return;
          this.panEnd.set(e.pageX, e.pageY);
        }
        this.panDelta.subVectors(this.panEnd, this.panStart).multiplyScalar(this.panSpeed), this.pan(this.panDelta.x, this.panDelta.y), this.panStart.copy(this.panEnd);
      }
    }, {
      key: "handleTouchMoveDolly",
      value: function handleTouchMoveDolly(e) {
        var r = lv(e),
          i = e.pageX - r.x,
          s = e.pageY - r.y,
          o = Math.sqrt(i * i + s * s);
        this.dollyEnd.set(0, o), this.dollyDelta.set(0, Math.pow(this.dollyEnd.y / this.dollyStart.y, this.zoomSpeed)), this.dollyOut(this.dollyDelta.y), this.dollyStart.copy(this.dollyEnd);
      }
    }, {
      key: "handleTouchMoveDollyPan",
      value: function handleTouchMoveDollyPan(e) {
        this.enableZoom && this.isTouchZoom === !0 && this.handleTouchMoveDolly(e), this.enablePan && this.handleTouchMovePan(e);
      }
    }, {
      key: "handleTouchMoveDollyRotate",
      value: function handleTouchMoveDollyRotate(e) {
        this.enableZoom && this.isTouchZoom === !0 && this.handleTouchMoveDolly(e), this.enableRotate && this.handleTouchMoveRotate(e);
      }
    }, {
      key: "checkRaycastLock",
      value: function checkRaycastLock() {
        if (this.object.data.raycastLock) {
          if (this.options.isPlayMode) return !1;
          {
            var _this$options;
            var e = (_this$options = this.options) === null || _this$options === void 0 ? void 0 : _this$options.showCameraLock;
            return e && e(), !0;
          }
        } else return !1;
      }
    }]);
    return Gf;
  }(ir);
function Xo(n) {
  var t = Math.PI * 2;
  for (; n <= -Math.PI;) n += t;
  for (; n > Math.PI;) n -= t;
  return n;
}
function pN(n) {
  return 1 - Math.pow(1 - n, 4);
}
var xg = /*#__PURE__*/function () {
  function xg(t, e, r, i, s, o) {
    _classCallCheck(this, xg);
    this.id = t;
    this.data = e;
    this.object = r;
    this.page = i;
    this.currentIntersectedObjects = [];
    this.disabled = !1;
    this.alreadyPlayedNonTogglingActions = new Set();
    this.actions = gr(e, e.actions, i, s, o, r), this.target = e.target, this.useToggle = e.runMode === "Toggle", this.triggeringObjects = e.triggeringObjects.map(function (a) {
      return i.scene.find(a);
    });
  }
  _createClass(xg, [{
    key: "isValidTriggeringObject",
    value: function isValidTriggeringObject(t) {
      return this.target === "all" ? !0 : this.triggeringObjects.some(function (e) {
        return e === t || e.isAncestorOf(t.uuid) || t.isAncestorOf(e.uuid);
      });
    }
  }, {
    key: "disconnect",
    value: function disconnect() {
      tr(this.actions);
    }
  }, {
    key: "dispatch",
    value: function dispatch() {
      var _this409 = this;
      this.disabled || this.object.destroyedInAction || (this.actions.Transition.forEach(function (t) {
        t.object.currentTransitionEvent !== _this409 ? (t.object.currentTransitionEvent = _this409, t.init()) : _this409.data.runMode === "Once" && _this409.alreadyPlayedNonTogglingActions.add(t);
      }), this.object.dispatchEvent({
        type: "beginEvent",
        eventName: "Trigger"
      }), this.useToggle ? (this.actions.Transition.forEach(function (t) {
        t.toggle();
      }), this.actions.SwitchCamera.forEach(function (t) {
        t.toggle();
      })) : (this.actions.Transition.forEach(function (t) {
        _this409.alreadyPlayedNonTogglingActions.has(t) === !1 && t.play();
      }), this.actions.SwitchCamera.forEach(function (t) {
        t.play();
      })), this.actions.Link.forEach(function (t) {
        t.dispatch();
      }), this.actions.Reset.forEach(function (t) {
        t.dispatch();
      }), this.actions.Create.forEach(function (t) {
        t.dispatch();
      }), this.actions.Destroy.forEach(function (t) {
        t.dispatch(!1);
      }), this.actions.Audio.forEach(function (t) {
        t.dispatchBasic();
      }), this.actions.Particles.forEach(function (t) {
        t.dispatchBasic();
      }), this.actions.Video.forEach(function (t) {
        t.dispatchBasic();
      }), this.actions.SceneTransition.forEach(function (t) {
        t.dispatch();
      }), this.actions.SetVariable.forEach(function (t) {
        return t.checkConditions();
      }), this.actions.SetVariable.forEach(function (t) {
        return t.dispatch();
      }), this.actions.DynamicVariablePlay.forEach(function (t) {
        return t.dispatch();
      }));
    }
  }]);
  return xg;
}();
var Pt;
O2.then(function (n) {
  return Pt = n;
});
var pi = new _(),
  so = new je(),
  Jl = new _(),
  BE = new Kt(0, 0, 0, "YXZ"),
  mN = new Kt(0, 0, 0, "XYZ"),
  oo = new _(),
  NE = new _(),
  FE = new _(1, 1, 1),
  jf = new je(),
  Tb = new te(),
  gN = new te(),
  cJ = {
    type: "updateMatrix"
  },
  yN = new je(),
  kE = new Er(),
  ab = {
    type: "beginEvent",
    eventName: "Collision"
  },
  uJ = {
    type: "beginEvent",
    eventName: "Trigger"
  };
function vN(n) {
  if (Al.physicsEnabled(n.scene.objects)) return !0;
  var t = !1;
  return n.scene.objects.traverse(function (e, r) {
    if (r.events) {
      if (Array.isArray(r.events)) {
        var _iterator187 = _createForOfIteratorHelper(r.events),
          _step187;
        try {
          for (_iterator187.s(); !(_step187 = _iterator187.n()).done;) {
            var _i198 = _step187.value;
            if (_i198.data.disabled !== !0 && _i198.data.type === "GameControl" && _i198.data.collisionEnabled) {
              t = !0;
              break;
            }
          }
        } catch (err) {
          _iterator187.e(err);
        } finally {
          _iterator187.f();
        }
      } else for (var _i199 = 0, _Object$values5 = Object.values(r.events); _i199 < _Object$values5.length; _i199++) {
        var _i200 = _Object$values5[_i199];
        if (_i200.disabled !== !0 && _i200.type === "GameControl" && _i200.collisionEnabled) {
          t = !0;
          break;
        }
      }
    }
  }), t;
}
var vg = function vg(n) {
    return n.states.some(function (t) {
      return t.data.position !== void 0 || t.data.rotation !== void 0 || t.data.hiddenMatrix !== void 0 || t.data.cloner !== void 0 || t.data.pathSnapping !== void 0;
    });
  },
  Mb = /*#__PURE__*/function () {
    function Mb(t) {
      var _this410 = this;
      _classCallCheck(this, Mb);
      this.eventContext = t;
      this.isEnabled = !1;
      this.gameControl = null;
      this.joysticks = [];
      this.joystickToGameControls = [];
      this.sharedGameControlGlobals = {
        entitiesWithTransformAnim: [],
        entityToCollisionEvents: {},
        colliderToEntity: new Map(),
        triggers: [],
        gamePads: [],
        createdObjects: [],
        nCreatedPerAction: {}
      };
      this.sensorToTriggerEvent = {};
      this.eventManager = void 0;
      this.needsCollisionDetection = !1;
      this.initializationCounter = -1;
      this.rigidBodyToMesh = new Map();
      this.nActiveRigidBodies = 0;
      this.collisionEvents = [];
      this.isExport = !1;
      this.processRigidBody = function (t) {
        if (t.bodyType() !== Pt.RigidBodyType.Dynamic) return;
        t.isSleeping() || _this410.nActiveRigidBodies++;
        var _this410$rigidBodyToM = _this410.rigidBodyToMesh.get(t.handle),
          _this410$rigidBodyToM2 = _slicedToArray(_this410$rigidBodyToM, 3),
          e = _this410$rigidBodyToM2[0],
          r = _this410$rigidBodyToM2[1],
          i = _this410$rigidBodyToM2[2];
        if (pi.copy(t.translation()).multiplyScalar(_this410.pixelsPerMeter), so.copy(t.rotation()), e.matrixWorld.compose(pi, so, r), e.hasNonUniformScale && e.matrixWorld.multiply(e.shearScale), e.dispatchEvent(cJ), i) {
          var _s137 = e.cloner;
          if (_s137 && _s137.objectForSample === void 0) {
            _s137.matrixWorld.copy(e.matrixWorld);
            var _iterator188 = _createForOfIteratorHelper(_s137.children),
              _step188;
            try {
              for (_iterator188.s(); !(_step188 = _iterator188.n()).done;) {
                var o = _step188.value;
                o.updateMatrixWorld(!0);
              }
            } catch (err) {
              _iterator188.e(err);
            } finally {
              _iterator188.f();
            }
          }
          var _iterator189 = _createForOfIteratorHelper(e.children),
            _step189;
          try {
            for (_iterator189.s(); !(_step189 = _iterator189.n()).done;) {
              var _o81 = _step189.value;
              _o81.updateMatrixWorld(!0);
            }
          } catch (err) {
            _iterator189.e(err);
          } finally {
            _iterator189.f();
          }
        }
      };
      this.accumulator = 0;
      this.handleCollisionEvents = function (t, e, r) {
        var _this410$gameControl, _this410$gameControl2;
        if (r === !1) return;
        var i, s;
        if (_this410.sensorToTriggerEvent[t] ? (i = _this410.sensorToTriggerEvent[t], s = _this410.sharedGameControlGlobals.colliderToEntity.get(e)) : _this410.sensorToTriggerEvent[e] && (i = _this410.sensorToTriggerEvent[e], s = _this410.sharedGameControlGlobals.colliderToEntity.get(t)), i && s && i.isValidTriggeringObject(s)) {
          i.dispatch();
          return;
        }
        var _loop20 = function _loop20() {
          var _a$rigidBody, _a$rigidBody2;
          var a = _this410.sharedGameControlGlobals.createdObjects[o];
          if (a.userData.hasCollisionDestroy && (((_a$rigidBody = a.rigidBody) === null || _a$rigidBody === void 0 ? void 0 : _a$rigidBody.collider(0).handle) === t || ((_a$rigidBody2 = a.rigidBody) === null || _a$rigidBody2 === void 0 ? void 0 : _a$rigidBody2.collider(0).handle) === e)) {
            _this410.sharedGameControlGlobals.createdObjects.splice(o, 1), a.removeFromParent(), requestAnimationFrame(function () {
              var _this410$sharedGameCo;
              return (_this410$sharedGameCo = _this410.sharedGameControlGlobals.rapierWorld) === null || _this410$sharedGameCo === void 0 ? void 0 : _this410$sharedGameCo.removeRigidBody(a.rigidBody);
            });
            return 1; // break
          }
        };
        for (var o = _this410.sharedGameControlGlobals.createdObjects.length - 1; o >= 0; o--) {
          if (_loop20()) break;
        }
        if (((_this410$gameControl = _this410.gameControl) === null || _this410$gameControl === void 0 ? void 0 : _this410$gameControl.object) === _this410.sharedGameControlGlobals.colliderToEntity.get(t)) {
          var _o82 = _this410.sharedGameControlGlobals.colliderToEntity.get(e),
            a = _this410.sharedGameControlGlobals.entityToCollisionEvents[_o82.uuid];
          if (a === void 0) return;
          var _iterator190 = _createForOfIteratorHelper(a),
            _step190;
          try {
            for (_iterator190.s(); !(_step190 = _iterator190.n()).done;) {
              var l = _step190.value;
              l.data.target === "character" && _this410.dispatchCollisionEvent(l, _o82, e);
            }
          } catch (err) {
            _iterator190.e(err);
          } finally {
            _iterator190.f();
          }
        } else if (((_this410$gameControl2 = _this410.gameControl) === null || _this410$gameControl2 === void 0 ? void 0 : _this410$gameControl2.object) === _this410.sharedGameControlGlobals.colliderToEntity.get(e)) {
          var _o83 = _this410.sharedGameControlGlobals.colliderToEntity.get(t),
            _a73 = _this410.sharedGameControlGlobals.entityToCollisionEvents[_o83.uuid];
          if (_a73 === void 0) return;
          var _iterator191 = _createForOfIteratorHelper(_a73),
            _step191;
          try {
            for (_iterator191.s(); !(_step191 = _iterator191.n()).done;) {
              var _l100 = _step191.value;
              _l100.data.target === "character" && _this410.dispatchCollisionEvent(_l100, _o83, t);
            }
          } catch (err) {
            _iterator191.e(err);
          } finally {
            _iterator191.f();
          }
        } else {
          var _o84 = _this410.sharedGameControlGlobals.colliderToEntity.get(t),
            _a74 = _this410.sharedGameControlGlobals.entityToCollisionEvents[_o84.uuid];
          if (_a74 !== void 0) {
            var _iterator192 = _createForOfIteratorHelper(_a74),
              _step192;
            try {
              for (_iterator192.s(); !(_step192 = _iterator192.n()).done;) {
                var c = _step192.value;
                c.data.target === "scene" && _this410.dispatchCollisionEvent(c, _o84, t);
              }
            } catch (err) {
              _iterator192.e(err);
            } finally {
              _iterator192.f();
            }
          }
          var _l101 = _this410.sharedGameControlGlobals.colliderToEntity.get(e),
            u = _this410.sharedGameControlGlobals.entityToCollisionEvents[_l101 === null || _l101 === void 0 ? void 0 : _l101.uuid];
          if (u !== void 0) {
            var _iterator193 = _createForOfIteratorHelper(u),
              _step193;
            try {
              for (_iterator193.s(); !(_step193 = _iterator193.n()).done;) {
                var _c56 = _step193.value;
                _c56.data.target === "scene" && _this410.dispatchCollisionEvent(_c56, _l101, e);
              }
            } catch (err) {
              _iterator193.e(err);
            } finally {
              _iterator193.f();
            }
          }
        }
      };
      this.isExport = t.isExport, this.sharedAssets = t.sharedAssets, this.renderer = t.renderer, this.requestRender = t.requestRender, this.domElement = this.renderer.domElement, this.pixelsPerMeter = dE, this.gravity = this.page.data.globalPhysics.gravity;
    }
    _createClass(Mb, [{
      key: "page",
      get: function get() {
        return this.eventContext.page;
      }
    }, {
      key: "attachVRControllers",
      value: function attachVRControllers(t) {
        var _this411 = this;
        t.forEach(function (e) {
          e.addEventListener("connected", function (r) {
            "gamepad" in r.data && "axes" in r.data.gamepad && _this411.sharedGameControlGlobals.gamePads.push(r.data.gamepad);
          });
        });
      }
    }, {
      key: "markIsDestroyTarget",
      value: function markIsDestroyTarget() {
        var _this412 = this;
        this.page.traverseVisibleEntity(function (t) {
          var e = t.dataPatched;
          var _iterator194 = _createForOfIteratorHelper(e.events),
            _step194;
          try {
            for (_iterator194.s(); !(_step194 = _iterator194.n()).done;) {
              var _r$data$actions;
              var r = _step194.value;
              if (r.data.disabled === !0) continue;
              var _i201 = (_r$data$actions = r.data.actions) === null || _r$data$actions === void 0 || (_r$data$actions = _r$data$actions.find(function (s) {
                return s.data.type === "Destroy";
              })) === null || _r$data$actions === void 0 ? void 0 : _r$data$actions.data;
              if (_i201) {
                var _iterator195 = _createForOfIteratorHelper(_i201.objects),
                  _step195;
                try {
                  for (_iterator195.s(); !(_step195 = _iterator195.n()).done;) {
                    var _s138 = _step195.value;
                    var o = _this412.page.scene.find(_s138);
                    o && (o.userData.hasDestroy = !0);
                  }
                } catch (err) {
                  _iterator195.e(err);
                } finally {
                  _iterator195.f();
                }
              }
            }
          } catch (err) {
            _iterator194.e(err);
          } finally {
            _iterator194.f();
          }
        });
      }
    }, {
      key: "markIsDragObject",
      value: function markIsDragObject() {
        var _this413 = this;
        this.page.traverseVisibleEntity(function (t) {
          var e = t.dataPatched;
          var _iterator196 = _createForOfIteratorHelper(e.events),
            _step196;
          try {
            for (_iterator196.s(); !(_step196 = _iterator196.n()).done;) {
              var r = _step196.value;
              if (!(r.data.disabled === !0 || r.data.type !== "DragDrop")) {
                var _iterator197 = _createForOfIteratorHelper(r.data.objects),
                  _step197;
                try {
                  for (_iterator197.s(); !(_step197 = _iterator197.n()).done;) {
                    var _i202 = _step197.value;
                    var _s139 = _this413.page.scene.find(_i202);
                    _s139 && (_s139.userData.hasDrag = !0);
                  }
                } catch (err) {
                  _iterator197.e(err);
                } finally {
                  _iterator197.f();
                }
              }
            }
          } catch (err) {
            _iterator196.e(err);
          } finally {
            _iterator196.f();
          }
        });
      }
    }, {
      key: "initBVH",
      value: function initBVH() {
        var _this414 = this;
        var t = [];
        if (this.page.traverseChildren(function (e) {
          var _o$physics, _o$physics2;
          var r,
            i = e instanceof Xc,
            s = e instanceof eu;
          if (e instanceof Gi || i || s) return;
          e instanceof Pr ? r = e.object : r = e;
          var o = r.dataPatched;
          if (((_o$physics = o.physics) === null || _o$physics === void 0 ? void 0 : _o$physics.enabled) === "visibility" ? !o.visible : !((_o$physics2 = o.physics) !== null && _o$physics2 !== void 0 && _o$physics2.enabled)) return !0;
          var a = e.geometry,
            l = r.userData.hasDestroy === !0,
            u = r.userData.hasDrag === !0;
          if (vg(o) || l || u || r.dataPatched.events.some(function (c) {
            return c.data.disabled !== !0 && c.data.type === "GameControl";
          })) return e.updateMatrixWorldSVD(), _this414.addBoundsTree(e), !0;
          a && t.push(io(a, e.matrixWorld));
        }), t.length > 0) {
          var e = Vs(t, !1);
          this.sharedGameControlGlobals.staticMeshBVH = new Eo(e);
        }
      }
    }, {
      key: "addRigidBody",
      value: function addRigidBody(t, e, r) {
        var i = [],
          s = "geometry" in t ? t.geometry : void 0,
          o = e.dataPatched;
        if ((s === null || s === void 0 ? void 0 : s.getAttribute("position")) !== void 0 && i.push(io(s, t.shearScale)), o.physics.fusedBody) {
          var a = this.gatherChildrenGeom(t, i);
          t.traverseObject(a), t.children.forEach(function (u) {
            return u.updateMatrixWorld(!0);
          });
          var l = t.cloner;
          l && l.objectForSample === void 0 && o.physics.rigidBody === "dynamic" && (l.traverseObject(a), l.children.forEach(function (u) {
            return u.updateMatrixWorld(!0);
          }));
        }
        if (i.length > 0) {
          var _a75$setLinearDamping, _a75$setLinearDamping2;
          var _a75,
            _l102 = !r.fromCreate && o.physics.rigidBody === "dynamic" || r.fromCreate && r.dynamic;
          _l102 ? (_a75 = Pt.RigidBodyDesc.dynamic(), (_a75$setLinearDamping = (_a75$setLinearDamping2 = _a75.setLinearDamping(o.physics.damping).setAngularDamping(o.physics.damping).setAdditionalMass(1e-9).setGravityScale(o.physics.gravityScale)).enabledRotations.apply(_a75$setLinearDamping2, _toConsumableArray(o.physics.enabledRotation))).enabledTranslations.apply(_a75$setLinearDamping, _toConsumableArray(o.physics.enabledTranslation))) : (r.hasTransformAnim || r.hasFollow || r.hasDrag) && !r.fromCreate ? (_a75 = Pt.RigidBodyDesc.kinematicPositionBased(), this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)) : _a75 = Pt.RigidBodyDesc.fixed();
          var u = Vs(i);
          (t.hasNonUniformScale ? t.matrixWorldRigid : t.matrixWorld).decompose(pi, so, Jl), t.position0 = pi.clone().divideScalar(this.pixelsPerMeter), t.rotation0 = so.clone(), pi.divideScalar(this.pixelsPerMeter), _a75.setTranslation(pi.x, pi.y, pi.z).setRotation(so), s ? u === null || u === void 0 ? void 0 : u.scale(1 / this.pixelsPerMeter, 1 / this.pixelsPerMeter, 1 / this.pixelsPerMeter) : u === null || u === void 0 ? void 0 : u.scale(Jl.x / this.pixelsPerMeter, Jl.y / this.pixelsPerMeter, Jl.z / this.pixelsPerMeter);
          var c = this.sharedGameControlGlobals.rapierWorld.createRigidBody(_a75);
          _l102 && this.rigidBodyToMesh.set(c.handle, [t, Jl.clone(), o.physics.fusedBody]);
          var d = !(o.geometry === void 0 || o.geometry.type === "SubdivGeometry" || o.geometry.type === "NonParametricGeometry" || o.geometry.type === "BooleanGeometry" || o.geometry.type === "VectorGeometry" || o.geometry.type === "StarGeometry" || o.geometry.type === "RectangleGeometry" || o.geometry.type === "EllipseGeometry" || o.geometry.type === "TriangleGeometry" || o.geometry.type === "TorusGeometry" || o.geometry.type === "HelixGeometry");
          try {
            this.addCollider(c, o.physics, u, e, d);
          } catch (_unused35) {
            try {
              this.addCollider(c, o.physics, u, e, !1);
            } catch (f) {
              console.error(f);
            }
          }
          t.rigidBody = c;
        }
      }
    }, {
      key: "addBoundsTree",
      value: function addBoundsTree(t) {
        var _t$geometry, _t$geometry2;
        var e = [];
        if (((_t$geometry = t.geometry) === null || _t$geometry === void 0 ? void 0 : _t$geometry.getAttribute("position")) !== void 0 && ((_t$geometry2 = t.geometry) === null || _t$geometry2 === void 0 ? void 0 : _t$geometry2.getAttribute("position").count) > 0 && e.push(io(t.geometry, t.shearScale)), t.traverseObject(this.gatherChildrenGeom(t, e)), t.children.forEach(function (r) {
          return r.updateMatrixWorld(!0);
        }), e.length > 0) {
          var r = Vs(e, !1);
          t.bvhGeometry = r, t.bvhGeometry.boundsTree = new Eo(r), this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t);
        }
      }
    }, {
      key: "addCollider",
      value: function addCollider(t, e, r, i) {
        var _r$getIndex, _this$sharedGameContr3;
        var s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !0;
        if ((r === null || r === void 0 ? void 0 : r.getAttribute("position").count) === 0 || (r === null || r === void 0 || (_r$getIndex = r.getIndex()) === null || _r$getIndex === void 0 ? void 0 : _r$getIndex.count) === 0) return;
        var o;
        r && (e.colliderType === "trimesh" ? o = Pt.ColliderDesc.trimesh(r.getAttribute("position").array, r.getIndex().array) : o = Pt.ColliderDesc.convexMesh(r.getAttribute("position").array, s ? r.getIndex().array : void 0)), o.setFrictionCombineRule(Pt.CoefficientCombineRule.Average).setRestitutionCombineRule(Pt.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);
        var a = this.sharedGameControlGlobals.rapierWorld.createCollider(o, t);
        this.sharedGameControlGlobals.colliderToEntity.set(a.handle, i), ((_this$sharedGameContr3 = this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid]) === null || _this$sharedGameContr3 === void 0 ? void 0 : _this$sharedGameContr3.some(function (l) {
          return l.target === "scene";
        })) && a.setActiveEvents(Pt.ActiveEvents.COLLISION_EVENTS);
      }
    }, {
      key: "gatherChildrenGeom",
      value: function gatherChildrenGeom(t, e) {
        return function (r, i) {
          var _s$dataPatched$cloner;
          if (i === 0) return;
          var s;
          if (r instanceof Gi) {
            if (r.objectForSample) {
              if (r.objectForSample.dataPatched.physics.fusedBody) return;
              s = r.object;
            } else return r.object.dataPatched.physics.fusedBody === !0 && r.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
          } else if (r instanceof Pr) s = r.object;else if (s = r, (_s$dataPatched$cloner = s.dataPatched.cloner) !== null && _s$dataPatched$cloner !== void 0 && _s$dataPatched$cloner.hideBase) return !0;
          var o = s.dataPatched;
          if (o.physics.enabled === "visibility" ? !o.visible : !o.physics.enabled) return !0;
          i === 1 ? t.hasNonUniformScale ? r.matrixWorld.multiplyMatrices(t.shearScale, r.hiddenMatrix) : r.matrixWorld.copy(r.hiddenMatrix) : r.matrixWorld.multiplyMatrices(r.parent.matrixWorld, r.hiddenMatrix), r.matrixWorld.multiply(r.matrix);
          var a = r.geometry;
          (a === null || a === void 0 ? void 0 : a.getAttribute("position")) !== void 0 && e.push(io(a, r.matrixWorld));
        };
      }
    }, {
      key: "activate",
      value: function activate(t) {
        var _this415 = this;
        if (this.isEnabled) return;
        this.isEnabled = !0, this.eventManager = t, this.usePhysics = this.page.data.globalPhysics.usePhysics;
        var e = this.page.playCamera,
          r = !1,
          i = 5,
          s = 8,
          o = 9,
          a = "drag",
          l = this.page.data.publish.gameControlObject,
          u = l !== null ? this.page.find(l) : null,
          c = null;
        if (u) {
          var _iterator198 = _createForOfIteratorHelper(u.data.events),
            _step198;
          try {
            for (_iterator198.s(); !(_step198 = _iterator198.n()).done;) {
              var f = _step198.value;
              if (f.data.disabled || f.data.type !== "GameControl") break;
              var p = u;
              for (; this.usePhysics && ((_p58 = p = p.parent) === null || _p58 === void 0 ? void 0 : _p58.parent) !== null && !((_p$data$physics = p.data.physics) !== null && _p$data$physics !== void 0 && _p$data$physics.fusedBody);) {
                var _p58, _p$data$physics;
                ;
              }
              f.data.collisionEnabled && (this.needsCollisionDetection = !0), c === null && (c = f.data);
            }
          } catch (err) {
            _iterator198.e(err);
          } finally {
            _iterator198.f();
          }
        }
        if (this.page.traverseEntity(function (f) {
          var _iterator199 = _createForOfIteratorHelper(f.dataPatched.events),
            _step199;
          try {
            for (_iterator199.s(); !(_step199 = _iterator199.n()).done;) {
              var _p59 = _step199.value;
              if (_p59.data.disabled === !1 && _p59.data.type === "Trigger") return _this415.needsCollisionDetection = !0, !0;
            }
          } catch (err) {
            _iterator199.e(err);
          } finally {
            _iterator199.f();
          }
        }), u && c) {
          r = r || c.camera === e.uuid || u.uuid === e.uuid;
          var _f84 = new dg(u, this.renderer.domElement, c, this.eventContext.page.data.globalPhysics, this, u.uuid !== e.uuid && c.camera === e.uuid, e, this.page, this.sharedAssets);
          this.gameControl = _f84, i = c.joystickPosLoc, s = c.joystickRotLoc, o = c.jumpTouchButtonLoc, a = c.rotByTouch, Si && c.touchControl && (this.joystickToGameControls[i] = "pos", c.moveMode === "walk" && (this.joystickToGameControls[o] = "jmp"), a === "joystick" && (this.joystickToGameControls[s] = "rot"));
        }
        if (this.gameControl && this.gameControl.data.navmesh.enabled) {
          var _f85 = this.gameControl.data;
          if (!this.navigationMeshWrapper) {
            this.navigationMeshWrapper = new Ab(this.usePhysics, this.isExport);
            var _p60;
            _f85.collider.type === "sphere" ? _p60 = _f85.collider.radius * 2 : _p60 = _f85.collider.height, _p60 = Math.floor(_p60 / _f85.navmesh.ch - 1), this.navigationMeshWrapper.init(_objectSpread(_objectSpread({}, _f85.navmesh), {}, {
              walkableHeight: _p60
            }), this.gameControl, this.eventContext);
          }
        }
        if (r === !1) {
          var _this$eventManager$pu = this.eventManager.publish.orbitControls,
            _f86 = _this$eventManager$pu.enableRotate,
            _p61 = _this$eventManager$pu.enablePan,
            m = _this$eventManager$pu.enableZoom,
            g = _this$eventManager$pu.autoRotate,
            y = _this$eventManager$pu.hoverRotatePanMode;
          (_f86 || _p61 || m || g || y !== 0) && (this.orbitControls = new Gf(e, this.renderer.domElement, {
            isExport: this.isExport,
            isPlayMode: !0
          }), this.orbitControls.addEventListener("change", this.requestRender), this.orbitControls.addEventListener("end", this.requestRender), this.orbitControls.addEventListener("start", this.requestRender), this.orbitControls.fromJSON(this.eventManager.publish.orbitControls, this.eventManager.publish.mouseEventTarget), this.orbitControls.useKeyEvents = !1, this.orbitControls.addEventListenersToCamera(), this.orbitControls.connect(), this.orbitControls.update());
        }
        var d = this.renderer.domElement.width / this.renderer.getPixelRatio(),
          h = this.renderer.domElement.height / this.renderer.getPixelRatio();
        this.joystickToGameControls.forEach(function (f, p) {
          var m = document.body.appendChild(document.createElement("div")),
            _this415$eventManager = _slicedToArray(_this415.eventManager.eventContext.publish.joystickSizeAndXYOffset[p], 3),
            g = _this415$eventManager[0],
            y = _this415$eventManager[1],
            v = _this415$eventManager[2],
            x = (d - 5 * g) / 4 + g,
            S = {},
            w = f === "jmp",
            A = w ? 0 : g;
          p < 10 ? (p < 5 ? S.top = A / 2 : S.bottom = A / 2, S.left = A / 2 + p % 5 * x) : p === 10 ? (S.left = A / 2, S.top = h / 2) : (S.right = A / 2, S.top = h / 2), S.top ? S.top -= y[1] : S.bottom += y[1], S.left ? S.left += y[0] : S.right -= y[0];
          for (var T in S) S[T] += "px";
          if (w) {
            var _T16 = m.appendChild(document.createElement("div"));
            Object.assign(_T16.style, S, {
              position: "absolute",
              width: g + "px",
              height: g + "px",
              backgroundColor: "rgba(255,255,255,".concat(v === "show" ? .4 : 0, ")"),
              zIndex: "9999",
              borderRadius: g + "px",
              border: v === "show" ? "solid 2px rgba(0, 0, 0, .1)" : "none",
              display: "flex",
              alignItems: "center",
              justifyContent: "center",
              touchAction: "none"
            });
            var M = g / 16 * 16 * .4;
            v === "show" && (_T16.innerHTML = "\n\t\t\t\t\t\t<svg width=\"".concat(M, "\" height=\"").concat(g * .4, "\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t\t<path d=\"M2 10L8 4L14 10\" stroke=\"black\" stroke-opacity=\"40%\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t")), _T16.addEventListener("pointerdown", function () {
              _this415.gameControl.movementState.jump = 1, _this415.requestRender();
            }), _T16.addEventListener("touchend", function (C) {
              return C.preventDefault();
            }), _this415.joysticks[p] = [void 0, m];
            return;
          }
          var E = {
            zone: m,
            mode: "static",
            position: S,
            size: g
          };
          v === "hide" && (E.restOpacity = 0);
          var b = QL.create(E);
          b.on("move", function (T, M) {
            var C = _this415.gameControl;
            f === "pos" ? M.force < .2 ? C.moveForce = 0 : (C.movementState.movePosZ = Math.sin(-M.angle.radian), C.movementState.movePosX = Math.cos(-M.angle.radian), M.force > 1.2 ? C.movementState.run = 1 : C.movementState.run = 0, M.force < .3 ? C.moveForce = (M.force - .2) / .1 : C.moveForce = 1) : f === "rot" && (M.force < .2 ? C.rotForce = 0 : (C.movementState.rotPosX = M.vector.y, C.movementState.rotPosY = -M.vector.x, M.force < .3 ? C.rotForce = (M.force - .2) / .1 : C.rotForce = 1)), _this415.requestRender();
          }), b.on("end", function (T, M) {
            var C = _this415.gameControl;
            f === "pos" ? (C.movementState.movePosZ = 0, C.movementState.movePosX = 0, C.moveForce = 1) : f === "rot" && (C.movementState.rotPosX = 0, C.movementState.rotPosY = 0, C.rotForce = 1);
          }), _this415.joysticks[p] = [b, m];
        }), this.markIsDestroyTarget(), this.markIsDragObject(), this.rebuildBVH(), this.initializationCounter++, window.setTimeout(function () {
          _this415.collisionEvents.forEach(function (f) {
            return f.disabled = !1;
          });
        }, 80);
      }
    }, {
      key: "initPhysics",
      value: function initPhysics() {
        var _this$sharedGameContr4,
          _this416 = this;
        (_this$sharedGameContr4 = this.sharedGameControlGlobals.rapierWorld) !== null && _this$sharedGameContr4 !== void 0 && _this$sharedGameContr4.free(), this.sharedGameControlGlobals.rapierWorld = new Pt.World(new Pt.Vector3(0, this.gravity, 0)), this.events = new Pt.EventQueue(!0);
        var t = [],
          e = [];
        if (this.page.traverseChildren(function (a) {
          var _u$physics;
          var l;
          if (a instanceof Gi) {
            if (a.objectForSample) {
              if (a.objectForSample.dataPatched.physics.fusedBody) return;
              l = a.object;
            } else return a.object.dataPatched.physics.fusedBody === !0 && a.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
          } else if (a instanceof Pr) l = a.object;else {
            var _l$dataPatched$cloner, _l$dataPatched$cloner2, _l$dataPatched$physic;
            if (a instanceof eu || a instanceof Xc) return;
            if (l = a, ((_l$dataPatched$cloner = l.dataPatched.cloner) === null || _l$dataPatched$cloner === void 0 ? void 0 : _l$dataPatched$cloner.disabled) === !1 && (_l$dataPatched$cloner2 = l.dataPatched.cloner) !== null && _l$dataPatched$cloner2 !== void 0 && _l$dataPatched$cloner2.hideBase && ((_l$dataPatched$physic = l.dataPatched.physics) === null || _l$dataPatched$physic === void 0 ? void 0 : _l$dataPatched$physic.fusedBody) !== !0) return !0;
          }
          var u = l.dataPatched,
            c;
          var _iterator200 = _createForOfIteratorHelper(u.events),
            _step200;
          try {
            for (_iterator200.s(); !(_step200 = _iterator200.n()).done;) {
              var _y59 = _step200.value;
              _y59.data.disabled !== !0 && _y59.data.type === "GameControl" && (c = _y59.data);
            }
          } catch (err) {
            _iterator200.e(err);
          } finally {
            _iterator200.f();
          }
          if (!u.physics || (u.physics.enabled === "visibility" ? !u.visible : !u.physics.enabled)) return !0;
          a.updateMatrixWorldSVD();
          var d = vg(u),
            h = !1,
            f = l.userData.hasDestroy,
            p = l.userData.hasDrag,
            m = !1;
          var _iterator201 = _createForOfIteratorHelper(u.events),
            _step201;
          try {
            var _loop21 = function _loop21() {
              var y = _step201.value;
              if (y.data.disabled !== !0) {
                if (y.data.type === "Collision") {
                  h = !0;
                  var _v35 = new Sb(y.id, y.data, l, _this416.page, _this416.sharedAssets, _this416.eventManager);
                  _v35.disabled = !0, _this416.collisionEvents.push(_v35), _this416.sharedGameControlGlobals.entityToCollisionEvents[l.uuid] && _this416.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(function (x) {
                    return x.id !== y.id;
                  }) ? _this416.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(_v35) : _this416.sharedGameControlGlobals.entityToCollisionEvents[l.uuid] = [_v35];
                } else if (y.data.type === "Follow") {
                  m = !0;
                  var _v36 = y.data.target;
                  a.traverseVisible(function (x) {
                    x.userData.isFollowingObj = _v36;
                  });
                }
              }
            };
            for (_iterator201.s(); !(_step201 = _iterator201.n()).done;) {
              _loop21();
            }
          } catch (err) {
            _iterator201.e(err);
          } finally {
            _iterator201.f();
          }
          u.physics.rigidBody === "dynamic" && u.physics.fusedBody === !1 && (a.matrixWorldFusedFalse = a.matrixWorld.clone());
          var g = a.geometry;
          if (c !== void 0) {
            var y = Pt.RigidBodyDesc.kinematicPositionBased();
            (a.hasNonUniformScale ? a.matrixWorldRigid : a.matrixWorld).decompose(pi, so, Jl), a.position0 = pi.clone().divideScalar(_this416.pixelsPerMeter), a.rotation0 = so.clone(), pi.divideScalar(_this416.pixelsPerMeter), y.setTranslation(pi.x, pi.y, pi.z).setRotation(so);
            var v = _this416.sharedGameControlGlobals.rapierWorld.createRigidBody(y);
            a.rigidBody = v;
            var x;
            c.collider.type === "sphere" ? x = Pt.ColliderDesc.ball(c.collider.radius / _this416.pixelsPerMeter) : c.collider.type === "capsule" ? x = Pt.ColliderDesc.capsule((c.collider.height / 2 - c.collider.radius) / _this416.pixelsPerMeter, c.collider.radius / _this416.pixelsPerMeter) : x = Pt.ColliderDesc.cuboid(c.collider.width / _this416.pixelsPerMeter / 2, c.collider.height / _this416.pixelsPerMeter / 2, c.collider.depth / _this416.pixelsPerMeter / 2), x.setFrictionCombineRule(Pt.CoefficientCombineRule.Average).setRestitutionCombineRule(Pt.CoefficientCombineRule.Average).setDensity(u.physics.density).setFriction(u.physics.friction).setRestitution(u.physics.restitution);
            var S = _this416.sharedGameControlGlobals.rapierWorld.createCollider(x, v);
            _this416.sharedGameControlGlobals.colliderToEntity.set(S.handle, l), pi.fromArray(c.collider.position).multiply(Jl.setFromMatrixScale(l.matrixWorld)).divideScalar(_this416.pixelsPerMeter), S.setTranslationWrtParent(pi);
            var w = new je().setFromEuler(new Kt().setFromVector3(new _().fromArray(c.collider.rotation)));
            S.setRotationWrtParent(w), S.setActiveEvents(Pt.ActiveEvents.COLLISION_EVENTS), _this416.generateSensorColliderDescs(l, !0);
          } else u.physics.rigidBody === "dynamic" || d || m || f || p || h ? (_this416.addRigidBody(a, l, {
            hasFollow: m,
            hasTransformAnim: d,
            hasDrag: p
          }), _this416.generateSensorColliderDescs(l, u.physics.fusedBody)) : (g && t.push(io(g, a.matrixWorld)), u.physics.fusedBody && a.traverseObject(function (y, v) {
            var _x$dataPatched$cloner;
            if (v === 0) return;
            var x;
            if (y instanceof Gi) {
              if (y.objectForSample) {
                if (y.objectForSample.dataPatched.physics.fusedBody) return;
                x = y.object;
              } else return y.object.dataPatched.physics.fusedBody === !0 && y.object.dataPatched.physics.rigidBody === "dynamic" ? !0 : void 0;
            } else if (y instanceof Pr) x = y.object;else if (x = y, (_x$dataPatched$cloner = x.dataPatched.cloner) !== null && _x$dataPatched$cloner !== void 0 && _x$dataPatched$cloner.hideBase) return !0;
            var S = x.dataPatched;
            if (S.physics.enabled === "visibility" ? !S.visible : !S.physics.enabled) return !0;
            var w = y.geometry;
            (w === null || w === void 0 ? void 0 : w.getAttribute("position")) !== void 0 && t.push(io(w, y.matrixWorld));
          }), _this416.generateSensorColliderDescs(l, u.physics.fusedBody, e));
          if (((_u$physics = u.physics) === null || _u$physics === void 0 ? void 0 : _u$physics.fusedBody) === !0 || c) return !0;
        }), t.length === 0) return;
        var r = Vs(t);
        r.scale(1 / this.pixelsPerMeter, 1 / this.pixelsPerMeter, 1 / this.pixelsPerMeter);
        var i = Pt.RigidBodyDesc.fixed(),
          s = this.sharedGameControlGlobals.rapierWorld.createRigidBody(i),
          o = Pt.ColliderDesc.trimesh(r.getAttribute("position").array, r.getIndex().array).setFrictionCombineRule(Pt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Pt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);
        this.sharedGameControlGlobals.rapierWorld.createCollider(o, s);
        for (var _i203 = 0, _e71 = e; _i203 < _e71.length; _i203++) {
          var _e71$_i = _slicedToArray(_e71[_i203], 2),
            a = _e71$_i[0],
            l = _e71$_i[1];
          var u = this.sharedGameControlGlobals.rapierWorld.createCollider(a, s);
          this.sensorToTriggerEvent[u.handle] = l;
        }
      }
    }, {
      key: "updatePositions",
      value: function updatePositions() {
        return this.nActiveRigidBodies = 0, this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody), this.nActiveRigidBodies > 0;
      }
    }, {
      key: "rebuildBVH",
      value: function rebuildBVH() {
        var _this417 = this;
        this.usePhysics ? this.initPhysics() : (this.page.traverseEntity(function (t) {
          var _iterator202 = _createForOfIteratorHelper(t.dataPatched.events),
            _step202;
          try {
            for (_iterator202.s(); !(_step202 = _iterator202.n()).done;) {
              var e = _step202.value;
              if (e.data.type === "Trigger" && e.data.disabled !== !0) {
                var r = new xg(e.id, e.data, t, _this417.page, _this417.sharedAssets, _this417.eventManager),
                  _i204 = new te().compose(oo.fromArray(e.data.position), jf.setFromEuler(mN.fromArray(e.data.rotation)), FE);
                if (e.data.triggerZone === "box") {
                  var _s140 = new Bt();
                  _s140.min.fromArray(e.data.size).multiplyScalar(-.5), _s140.max.fromArray(e.data.size).multiplyScalar(.5), _this417.sharedGameControlGlobals.triggers.push([_s140, _i204, t, r]);
                } else _this417.sharedGameControlGlobals.triggers.push([e.data.radius, _i204, t, r]);
              }
            }
          } catch (err) {
            _iterator202.e(err);
          } finally {
            _iterator202.f();
          }
        }), this.needsCollisionDetection && this.initBVH());
      }
    }, {
      key: "disconnectEvents",
      value: function disconnectEvents() {
        this.collisionEvents.forEach(function (t) {
          return t.disconnect();
        }), this.sharedGameControlGlobals.triggers.forEach(function (t) {
          return t[3].disconnect();
        }), this.sharedGameControlGlobals.triggers.length = 0;
      }
    }, {
      key: "deactivate",
      value: function deactivate() {
        if (!!this.isEnabled) {
          var _this$sharedGameContr5, _this$gameControl, _this$gameControl2, _this$navigationMeshW;
          this.isEnabled = !1, this.page.traverse(function (t) {
            var e = t;
            e.matrixWorldFusedFalse && (e.matrixWorldFusedFalse = void 0), e.rigidBody && (e.rigidBody = void 0), e.position0 && (e.position0 = void 0), e.rotation0 && (e.rotation0 = void 0);
          }), (_this$sharedGameContr5 = this.sharedGameControlGlobals.rapierWorld) !== null && _this$sharedGameContr5 !== void 0 && _this$sharedGameContr5.free(), this.sharedGameControlGlobals.rapierWorld = void 0, this.sharedGameControlGlobals.staticMeshBVH = void 0, this.accumulator = 0, this.sharedGameControlGlobals.entitiesWithTransformAnim = [], this.disconnectEvents(), (_this$gameControl = this.gameControl) !== null && _this$gameControl !== void 0 && _this$gameControl.reset(), (_this$gameControl2 = this.gameControl) !== null && _this$gameControl2 !== void 0 && _this$gameControl2.dispose(), this.gameControl = null, this.initializationCounter = -1, this.joysticks.forEach(function (_ref144) {
            var _ref145 = _slicedToArray(_ref144, 2),
              t = _ref145[0],
              e = _ref145[1];
            t !== null && t !== void 0 && t.destroy(), e.remove();
          }), this.joystickToGameControls = [], this.joysticks = [], this.orbitControls && (this.orbitControls.dispose(), this.orbitControls = void 0), (_this$navigationMeshW = this.navigationMeshWrapper) !== null && _this$navigationMeshW !== void 0 && _this$navigationMeshW.dispose(), this.navigationMeshWrapper = void 0;
          for (var _i205 = 0, _Object$values6 = Object.values(this.sharedGameControlGlobals.entityToCollisionEvents); _i205 < _Object$values6.length; _i205++) {
            var t = _Object$values6[_i205];
            t.forEach(function (e) {
              return e.disconnect();
            });
          }
          this.sharedGameControlGlobals.entityToCollisionEvents = {}, this.page.updateMatrixWorld(!0);
        }
      }
    }, {
      key: "update",
      value: function update(t, e, r) {
        if (!this.isEnabled) return !0;
        var i = !0;
        if (this.orbitControls !== void 0 && this.orbitControls.needsUpdate && (i = !this.orbitControls.update()), this.initializationCounter >= 0 && this.initializationCounter < 2 ? (this.initializationCounter++, i = !1) : this.initializationCounter === 2 && this.gameControl && (i = !this.gameControl.update(t, e, r) && i), this.usePhysics === !1 && this.checkTrigger(), this.usePhysics) {
          var _s141 = .016666666666666666;
          if (t === 0) i = this.stepPhysics() && i;else {
            var o = t / 1e3;
            o < _s141 && o > _s141 * .55 && (o = _s141), this.accumulator += o;
            var a = performance.now(),
              l = 0,
              u = 6;
            for (; this.accumulator >= _s141 && l < u && (i = this.stepPhysics() && i, this.accumulator -= _s141, l++, !(performance.now() - a > _s141 * 1e3)););
            this.accumulator = this.accumulator % _s141;
          }
        }
        return i;
      }
    }, {
      key: "stepPhysics",
      value: function stepPhysics() {
        var _this$events;
        var _iterator203 = _createForOfIteratorHelper(this.sharedGameControlGlobals.entitiesWithTransformAnim),
          _step203;
        try {
          for (_iterator203.s(); !(_step203 = _iterator203.n()).done;) {
            var e = _step203.value;
            (e.hasNonUniformScale ? e.matrixWorldRigid : e.matrixWorld).decompose(pi, so, Jl), BE.setFromQuaternion(so);
            var r = e;
            r.prevR === void 0 ? (r.prevR = BE.clone(), r.prevT = pi.clone()) : (r.prevR.copy(BE), r.prevT.copy(pi)), e.rigidBody && (e.rigidBody.setNextKinematicTranslation(pi.divideScalar(this.pixelsPerMeter)), e.rigidBody.setNextKinematicRotation(so));
          }
        } catch (err) {
          _iterator203.e(err);
        } finally {
          _iterator203.f();
        }
        return this.sharedGameControlGlobals.rapierWorld.step(this.events), (_this$events = this.events) !== null && _this$events !== void 0 && _this$events.drainCollisionEvents(this.handleCollisionEvents), !this.updatePositions();
      }
    }, {
      key: "dispatchCollisionEvent",
      value: function dispatchCollisionEvent(t, e, r) {
        var _this$sharedGameContr6;
        var i = ((_this$sharedGameContr6 = this.sharedGameControlGlobals.rapierWorld) === null || _this$sharedGameContr6 === void 0 ? void 0 : _this$sharedGameContr6.getCollider(r))._parent,
          s;
        if (e.cloner) {
          var _iterator204 = _createForOfIteratorHelper(e.cloner.children),
            _step204;
          try {
            for (_iterator204.s(); !(_step204 = _iterator204.n()).done;) {
              var o = _step204.value;
              if (o.rigidBody === i) {
                s = o;
                break;
              }
            }
          } catch (err) {
            _iterator204.e(err);
          } finally {
            _iterator204.f();
          }
        }
        t.dispatch(s), e.dispatchEvent(ab);
      }
    }, {
      key: "updateUseWindowEvents",
      value: function updateUseWindowEvents(t) {
        var _this$orbitControls;
        (_this$orbitControls = this.orbitControls) === null || _this$orbitControls === void 0 || _this$orbitControls.updateUseWindowEvents(t);
      }
    }, {
      key: "generateSensorColliderDescs",
      value: function generateSensorColliderDescs(t, e, r) {
        var _this418 = this;
        var i = gN.copy(t.matrixWorld).invert();
        t.traverseEntity(function (s, o) {
          if (e === !1 && o === 1) return !0;
          var _iterator205 = _createForOfIteratorHelper(s.dataPatched.events),
            _step205;
          try {
            for (_iterator205.s(); !(_step205 = _iterator205.n()).done;) {
              var a = _step205.value;
              if (a.data.type === "Trigger" && a.data.disabled !== !0) {
                var _Pt$ColliderDesc;
                var l = new xg(a.id, a.data, s, _this418.page, _this418.sharedAssets, _this418.eventManager),
                  u = void 0;
                if (a.data.triggerZone === "box" ? u = (_Pt$ColliderDesc = Pt.ColliderDesc).cuboid.apply(_Pt$ColliderDesc, _toConsumableArray(a.data.size.map(function (c) {
                  return c / (2 * _this418.pixelsPerMeter);
                }))) : u = Pt.ColliderDesc.ball(a.data.radius / _this418.pixelsPerMeter), u.setDensity(0).setSensor(!0).setActiveEvents(Pt.ActiveEvents.COLLISION_EVENTS), oo.fromArray(a.data.position), jf.setFromEuler(mN.fromArray(a.data.rotation)), Tb.compose(oo, jf, FE).premultiply(s.matrixWorld), r ? (Tb.decompose(oo, jf, NE), u.setActiveCollisionTypes(Pt.ActiveCollisionTypes.KINEMATIC_FIXED | Pt.ActiveCollisionTypes.DYNAMIC_FIXED)) : (Tb.premultiply(i).decompose(oo, jf, NE), t.rigidBody.bodyType() === Pt.RigidBodyType.Dynamic || (t.rigidBody.bodyType() === Pt.RigidBodyType.Fixed ? u.setActiveCollisionTypes(Pt.ActiveCollisionTypes.KINEMATIC_FIXED | Pt.ActiveCollisionTypes.DYNAMIC_FIXED) : u.setActiveCollisionTypes(Pt.ActiveCollisionTypes.KINEMATIC_KINEMATIC | Pt.ActiveCollisionTypes.DYNAMIC_KINEMATIC))), oo.divideScalar(_this418.pixelsPerMeter), u.setTranslation(oo.x, oo.y, oo.z), u.setRotation(jf), r) r.push([u, l]);else {
                  var c = _this418.sharedGameControlGlobals.rapierWorld.createCollider(u, t.rigidBody);
                  _this418.sensorToTriggerEvent[c.handle] = l;
                }
              }
            }
          } catch (err) {
            _iterator205.e(err);
          } finally {
            _iterator205.f();
          }
        });
      }
    }, {
      key: "checkTrigger",
      value: function checkTrigger() {
        var _this419 = this;
        var t;
        for (var e = 0; e < this.sharedGameControlGlobals.triggers.length; e++) {
          var _this$sharedGameContr7 = _slicedToArray(this.sharedGameControlGlobals.triggers[e], 4),
            r = _this$sharedGameContr7[0],
            _i206 = _this$sharedGameContr7[1],
            _s142 = _this$sharedGameContr7[2],
            o = _this$sharedGameContr7[3];
          var _loop22 = function _loop22() {
            var l = _this419.sharedGameControlGlobals.entitiesWithTransformAnim[a];
            if (_s142 === l || o.isValidTriggeringObject(ut.is(l) ? l : l.object) === !1) return 1; // continue
            var u = gN.copy(_s142.matrixWorld).decompose(oo, yN, NE).compose(oo, yN, FE).multiply(_i206),
              c = Tb.copy(l.matrixWorld).invert().multiply(u);
            r instanceof Bt ? t = l.bvhGeometry.boundsTree.intersectsBox(r, c) : (kE.radius = r, kE.center.setFromMatrixPosition(c), t = l.bvhGeometry.boundsTree.intersectsSphere(kE)), t ? o.currentIntersectedObjects.indexOf(l) === -1 && (o.currentIntersectedObjects.push(l), o.dispatch(), _s142.dispatchEvent(uJ)) : o.currentIntersectedObjects = o.currentIntersectedObjects.filter(function (d) {
              return d !== l;
            });
          };
          for (var a = 0; a < this.sharedGameControlGlobals.entitiesWithTransformAnim.length; a++) {
            if (_loop22()) continue;
          }
        }
      }
    }]);
    return Mb;
  }();
function xN(n) {
  var _this$_clip$start;
  var t = this._clip.duration,
    e = (_this$_clip$start = this._clip.start) !== null && _this$_clip$start !== void 0 ? _this$_clip$start : 0,
    r = this.loop,
    i = this.time + n,
    s = this._loopCount,
    o = r === Ap;
  if (n === 0) return s === -1 ? i : o && (s & 1) === 1 ? t - (i - e) : i;
  if (r === sw) {
    s === -1 && (this._loopCount = 0, this._setEndings(!0, !0, !1));
    e: {
      if (i >= t) i = t;else if (i < 0) i = 0;else {
        this.time = i;
        break e;
      }
      this.clampWhenFinished ? this.paused = !0 : this.enabled = !1, this.time = i, this._mixer.dispatchEvent({
        type: "finished",
        action: this,
        direction: n < 0 ? -1 : 1
      });
    }
  } else {
    if (s === -1 && (n >= 0 ? (s = 0, this._setEndings(!0, this.repetitions === 0, o)) : this._setEndings(this.repetitions === 0, !0, o)), i >= t || i < e) {
      var a = Math.floor((i - e) / (t - e));
      i -= (t - e) * a, s += Math.abs(a);
      var l = this.repetitions - s;
      if (l <= 0) this.clampWhenFinished ? this.paused = !0 : this.enabled = !1, o || (i = n > 0 ? t : e, this.repetitions === 1 && (i = t)), this.time = i, this._mixer.dispatchEvent({
        type: "finished",
        action: this,
        direction: n > 0 ? 1 : -1
      });else {
        if (l === 1) {
          var u = n < 0;
          this._setEndings(u, !u, o);
        } else this._setEndings(!1, !1, o);
        this._loopCount = s, this.time = i, this._mixer.dispatchEvent({
          type: "loop",
          action: this,
          loopDelta: a
        });
      }
    } else this.time = i;
    if (o && (s & 1) === 1) return t - (i - e);
  }
  return i;
}
var bN = !1,
  Cb = /*#__PURE__*/function () {
    function Cb(t, e, r, i) {
      var _this420 = this;
      _classCallCheck(this, Cb);
      this.scene = t;
      this.requestRender = e;
      this.updateDisplayProgress = r;
      this.animationInspectorState = i;
      this.clipIdToAction = {};
      this.activeClip = null;
      this.needsUpdate = !1;
      this.addClip = function (t) {
        t.data.type === "Empty" && t.data.animations && t.data.animations.forEach(function (e, r) {
          var i = e[0] + "/";
          if (Array.isArray(t.identity) ? i += t.identity[0] : i += t.uuid, _this420.clipIdToAction[i]) return;
          var s = Hu.parse(JSON.parse(e[2]));
          t.animations[r] = s;
          var o = _this420.mixer.clipAction(s, t);
          bN === !1 && (Object.getPrototypeOf(o)._updateTime = xN, bN = !0), o.clampWhenFinished = !0, _this420.clipIdToAction[i] = o;
        });
      };
      this.mixer = new Sy(t), this.scene.traverseEntity(this.addClip);
    }
    _createClass(Cb, [{
      key: "deleteClip",
      value: function deleteClip(t, e) {
        var r = this.scene.find(e);
        if (!r) return;
        var i = r.animations.find(function (o) {
          return o.uuid === t;
        });
        if (!i) return;
        var s = this.clipIdToAction[t];
        !s || (s.stop(), this.mixer.uncacheClip(i), delete this.clipIdToAction[t], r.animations = r.animations.filter(function (o) {
          return o.uuid !== t;
        }));
      }
    }, {
      key: "isPlaying",
      get: function get() {
        return Object.values(this.clipIdToAction).some(function (t) {
          return t.isRunning();
        });
      }
    }, {
      key: "playFromInspector",
      value: function playFromInspector(t) {
        this.mixer.stopAllAction();
        var e = this.clipIdToAction[t];
        !e || (e.play(), this.activeClip = e.getClip(), this.requestRender());
      }
    }, {
      key: "onExitPlayMode",
      value: function onExitPlayMode() {
        Object.values(this.clipIdToAction).forEach(function (t) {
          t.repetitions = 1 / 0, t.loop = ow;
        }), this.mixer.stopAllAction(), this.requestRender();
      }
    }, {
      key: "play",
      value: function play(t) {
        var e = t.clipId + "/" + t.object,
          r = this.clipIdToAction[e];
        if (!!r) return t && (t.repeat >= 0 && (r.repetitions = t.repeat + 1), t.direction === "pingpong" && t.repeat !== 0 && (r.loop = Ap)), r.play(), r.paused = !1, this.requestRender(), r;
      }
    }, {
      key: "resumeFromInspector",
      value: function resumeFromInspector(t) {
        var e = this.clipIdToAction[t];
        !e || (e.play(), e.paused = !1, this.requestRender());
      }
    }, {
      key: "pauseFromInspector",
      value: function pauseFromInspector(t) {
        var e = this.clipIdToAction[t];
        !e || (e.paused = !0);
      }
    }, {
      key: "stop",
      value: function stop() {
        this.mixer.stopAllAction(), this.requestRender();
      }
    }, {
      key: "update",
      value: function update(t) {
        var _this$animationInspec;
        if (this.needsUpdate) this.needsUpdate = !1;else if (this.isPlaying === !1 || (_this$animationInspec = this.animationInspectorState) !== null && _this$animationInspec !== void 0 && _this$animationInspec.isScrubbing) return;
        this.mixer.update(t / 1e3), this.activeClip && this.updateDisplayProgress(Math.round(this.mixer.time / this.activeClip.duration * this.maxFrames % this.maxFrames)), this.requestRender();
      }
    }, {
      key: "maxFrames",
      get: function get() {
        var _this$activeClip$trac, _this$activeClip;
        return (_this$activeClip$trac = (_this$activeClip = this.activeClip) === null || _this$activeClip === void 0 || (_this$activeClip = _this$activeClip.tracks[0]) === null || _this$activeClip === void 0 ? void 0 : _this$activeClip.times.length) !== null && _this$activeClip$trac !== void 0 ? _this$activeClip$trac : 0;
      }
    }, {
      key: "setProgressFromInspector",
      value: function setProgressFromInspector(t, e) {
        if (!this.clipIdToAction[e]) return;
        this.activeClip !== this.clipIdToAction[e].getClip() && this.playFromInspector(e);
        var r = this.clipIdToAction[e].paused;
        this.clipIdToAction[e].paused = !1, this.mixer.setTime(Math.min(this.maxFrames ? t / this.maxFrames : 0, .9999) * this.activeClip.duration), this.requestRender(), r && (this.clipIdToAction[e].paused = !0);
      }
    }]);
    return Cb;
  }();
var zE = new WeakMap(),
  Pb = /*#__PURE__*/function (_rl5) {
    _inherits(Pb, _rl5);
    var _super314 = _createSuper(Pb);
    function Pb(t) {
      var _this421;
      _classCallCheck(this, Pb);
      _this421 = _super314.call(this, t), _this421.decoderPath = "", _this421.decoderConfig = {}, _this421.decoderBinary = null, _this421.decoderPending = null, _this421.workerLimit = 4, _this421.workerPool = [], _this421.workerNextTaskID = 1, _this421.workerSourceURL = "", _this421.defaultAttributeIDs = {
        position: "POSITION",
        normal: "NORMAL",
        color: "COLOR",
        uv: "TEX_COORD"
      }, _this421.defaultAttributeTypes = {
        position: "Float32Array",
        normal: "Float32Array",
        color: "Float32Array",
        uv: "Float32Array"
      };
      return _this421;
    }
    _createClass(Pb, [{
      key: "setDecoderPath",
      value: function setDecoderPath(t) {
        return this.decoderPath = t, this;
      }
    }, {
      key: "setDecoderConfig",
      value: function setDecoderConfig(t) {
        return this.decoderConfig = t, this;
      }
    }, {
      key: "setWorkerLimit",
      value: function setWorkerLimit(t) {
        return this.workerLimit = t, this;
      }
    }, {
      key: "load",
      value: function load(t, e, r, i) {
        var _this422 = this;
        var s = new Wu(this.manager);
        s.setPath(this.path), s.setResponseType("arraybuffer"), s.setRequestHeader(this.requestHeader), s.setWithCredentials(this.withCredentials), s.load(t, function (o) {
          _this422.decodeDracoFile(o, e).catch(i);
        }, r, i);
      }
    }, {
      key: "decodeDracoFile",
      value: function decodeDracoFile(t, e, r, i) {
        var s = {
          attributeIDs: r || this.defaultAttributeIDs,
          attributeTypes: i || this.defaultAttributeTypes,
          useUniqueIDs: !!r
        };
        return this.decodeGeometry(t, s).then(e);
      }
    }, {
      key: "decodeGeometry",
      value: function decodeGeometry(t, e) {
        var _this423 = this;
        var r = JSON.stringify(e);
        if (zE.has(t)) {
          var l = zE.get(t);
          if (l.key === r) return l.promise;
          if (t.byteLength === 0) throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.");
        }
        var i,
          s = this.workerNextTaskID++,
          o = t.byteLength,
          a = this._getWorker(s, o).then(function (l) {
            return i = l, new Promise(function (u, c) {
              i._callbacks[s] = {
                resolve: u,
                reject: c
              }, i.postMessage({
                type: "decode",
                id: s,
                taskConfig: e,
                buffer: t
              }, [t]);
            });
          }).then(function (l) {
            return _this423._createGeometry(l.geometry);
          });
        return a.catch(function () {
          return !0;
        }).then(function () {
          i && s && _this423._releaseTask(i, s);
        }), zE.set(t, {
          key: r,
          promise: a
        }), a;
      }
    }, {
      key: "_createGeometry",
      value: function _createGeometry(t) {
        var e = new we();
        t.index && e.setIndex(new Ge(t.index.array, 1));
        for (var r = 0; r < t.attributes.length; r++) {
          var _i207 = t.attributes[r],
            _s143 = _i207.name,
            o = _i207.array,
            a = _i207.itemSize;
          e.setAttribute(_s143, new Ge(o, a));
        }
        return e;
      }
    }, {
      key: "_loadLibrary",
      value: function _loadLibrary(t, e) {
        var r = new Wu(this.manager);
        return r.setPath(this.decoderPath), r.setResponseType(e), r.setWithCredentials(this.withCredentials), new Promise(function (i, s) {
          r.load(t, i, void 0, s);
        });
      }
    }, {
      key: "preload",
      value: function preload() {
        return this._initDecoder(), this;
      }
    }, {
      key: "_initDecoder",
      value: function _initDecoder() {
        var _this424 = this;
        if (this.decoderPending) return this.decoderPending;
        var t = (typeof WebAssembly === "undefined" ? "undefined" : _typeof(WebAssembly)) != "object" || this.decoderConfig.type === "js",
          e = [];
        return t ? e.push(this._loadLibrary("draco_decoder.js", "text")) : (e.push(this._loadLibrary("draco_wasm_wrapper.js", "text")), e.push(this._loadLibrary("draco_decoder.wasm", "arraybuffer"))), this.decoderPending = Promise.all(e).then(function (r) {
          var i = r[0];
          t || (_this424.decoderConfig.wasmBinary = r[1]);
          var s = dJ.toString(),
            o = ["/* draco decoder */", i, "", "/* worker */", s.substring(s.indexOf("{") + 1, s.lastIndexOf("}"))].join("\n");
          _this424.workerSourceURL = URL.createObjectURL(new Blob([o]));
        }), this.decoderPending;
      }
    }, {
      key: "_getWorker",
      value: function _getWorker(t, e) {
        var _this425 = this;
        return this._initDecoder().then(function () {
          if (_this425.workerPool.length < _this425.workerLimit) {
            var _i208 = new Worker(_this425.workerSourceURL);
            _i208._callbacks = {}, _i208._taskCosts = {}, _i208._taskLoad = 0, _i208.postMessage({
              type: "init",
              decoderConfig: _this425.decoderConfig
            }), _i208.onmessage = function (s) {
              var o = s.data;
              switch (o.type) {
                case "decode":
                  _i208._callbacks[o.id].resolve(o);
                  break;
                case "error":
                  _i208._callbacks[o.id].reject(o);
                  break;
                default:
                  console.error('THREE.DRACOLoader: Unexpected message, "' + o.type + '"');
              }
            }, _this425.workerPool.push(_i208);
          } else _this425.workerPool.sort(function (i, s) {
            return i._taskLoad > s._taskLoad ? -1 : 1;
          });
          var r = _this425.workerPool[_this425.workerPool.length - 1];
          return r._taskCosts[t] = e, r._taskLoad += e, r;
        });
      }
    }, {
      key: "_releaseTask",
      value: function _releaseTask(t, e) {
        t._taskLoad -= t._taskCosts[e], delete t._callbacks[e], delete t._taskCosts[e];
      }
    }, {
      key: "debug",
      value: function debug() {
        console.log("Task load: ", this.workerPool.map(function (t) {
          return t._taskLoad;
        }));
      }
    }, {
      key: "dispose",
      value: function dispose() {
        for (var t = 0; t < this.workerPool.length; ++t) this.workerPool[t].terminate();
        return this.workerPool.length = 0, this.workerSourceURL !== "" && URL.revokeObjectURL(this.workerSourceURL), this;
      }
    }]);
    return Pb;
  }(rl);
function dJ() {
  var n, t;
  onmessage = function onmessage(o) {
    var a = o.data;
    switch (a.type) {
      case "init":
        n = a.decoderConfig, t = new Promise(function (c) {
          n.onModuleLoaded = function (d) {
            c({
              draco: d
            });
          }, DracoDecoderModule(n);
        });
        break;
      case "decode":
        var l = a.buffer,
          u = a.taskConfig;
        t.then(function (c) {
          var d = c.draco,
            h = new d.Decoder(),
            f = new d.DecoderBuffer();
          f.Init(new Int8Array(l), l.byteLength);
          try {
            var p = e(d, h, f, u),
              m = p.attributes.map(function (g) {
                return g.array.buffer;
              });
            p.index && m.push(p.index.array.buffer), self.postMessage({
              type: "decode",
              id: a.id,
              geometry: p
            }, m);
          } catch (p) {
            console.error(p), self.postMessage({
              type: "error",
              id: a.id,
              error: p.message
            });
          } finally {
            d.destroy(f), d.destroy(h);
          }
        });
        break;
    }
  };
  function e(o, a, l, u) {
    var c = u.attributeIDs,
      d = u.attributeTypes,
      h,
      f,
      p = a.GetEncodedGeometryType(l);
    if (p === o.TRIANGULAR_MESH) h = new o.Mesh(), f = a.DecodeBufferToMesh(l, h);else if (p === o.POINT_CLOUD) h = new o.PointCloud(), f = a.DecodeBufferToPointCloud(l, h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");
    if (!f.ok() || h.ptr === 0) throw new Error("THREE.DRACOLoader: Decoding failed: " + f.error_msg());
    var m = {
      index: null,
      attributes: []
    };
    for (var g in c) {
      var y = self[d[g]],
        v = void 0,
        x = void 0;
      if (u.useUniqueIDs) x = c[g], v = a.GetAttributeByUniqueId(h, x);else {
        if (x = a.GetAttributeId(h, o[c[g]]), x === -1) continue;
        v = a.GetAttribute(h, x);
      }
      m.attributes.push(i(o, a, h, g, y, v));
    }
    return p === o.TRIANGULAR_MESH && (m.index = r(o, a, h)), o.destroy(h), m;
  }
  function r(o, a, l) {
    var c = l.num_faces() * 3,
      d = c * 4,
      h = o._malloc(d);
    a.GetTrianglesUInt32Array(l, d, h);
    var f = new Uint32Array(o.HEAPF32.buffer, h, c).slice();
    return o._free(h), {
      array: f,
      itemSize: 1
    };
  }
  function i(o, a, l, u, c, d) {
    var h = d.num_components(),
      p = l.num_points() * h,
      m = p * c.BYTES_PER_ELEMENT,
      g = s(o, c),
      y = o._malloc(m);
    a.GetAttributeDataArrayForAllPoints(l, d, g, m, y);
    var v = new c(o.HEAPF32.buffer, y, p).slice();
    return o._free(y), {
      name: u,
      array: v,
      itemSize: h
    };
  }
  function s(o, a) {
    switch (a) {
      case Float32Array:
        return o.DT_FLOAT32;
      case Int8Array:
        return o.DT_INT8;
      case Int16Array:
        return o.DT_INT16;
      case Int32Array:
        return o.DT_INT32;
      case Uint8Array:
        return o.DT_UINT8;
      case Uint16Array:
        return o.DT_UINT16;
      case Uint32Array:
        return o.DT_UINT32;
    }
  }
}
var $l;
function hJ() {
  return $l || ($l = new Pb(), $l.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()), $l.decoderPending;
}
function fJ(_x48) {
  return _fJ.apply(this, arguments);
}
function _fJ() {
  _fJ = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(n) {
    var t, e;
    return _regeneratorRuntime().wrap(function _callee25$(_context31) {
      while (1) switch (_context31.prev = _context31.next) {
        case 0:
          if (!$l) {
            _context31.next = 13;
            break;
          }
          t = {
            attributeIDs: $l.defaultAttributeIDs,
            attributeTypes: $l.defaultAttributeTypes,
            useUniqueIDs: !1
          };
          _context31.prev = 2;
          _context31.next = 5;
          return $l.decodeGeometry(new Int8Array(n).buffer, t);
        case 5:
          e = _context31.sent;
          _context31.next = 11;
          break;
        case 8:
          _context31.prev = 8;
          _context31.t0 = _context31["catch"](2);
          console.error(_context31.t0);
        case 11:
          if (!e) {
            _context31.next = 13;
            break;
          }
          return _context31.abrupt("return", {
            index: e.index ? {
              array: e.index.array
            } : void 0,
            attributes: Object.entries(e.attributes).map(function (_ref153) {
              var _ref154 = _slicedToArray(_ref153, 2),
                r = _ref154[0],
                i = _ref154[1];
              return {
                name: r,
                itemSize: i.itemSize,
                array: i.array
              };
            })
          });
        case 13:
          return _context31.abrupt("return", null);
        case 14:
        case "end":
          return _context31.stop();
      }
    }, _callee25, null, [[2, 8]]);
  }));
  return _fJ.apply(this, arguments);
}
function SN(_x49, _x50) {
  return _SN.apply(this, arguments);
}
function _SN() {
  _SN = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(n, t) {
    var _zw3, _zw4, e, r, i, _loop25, _i223, _i222;
    return _regeneratorRuntime().wrap(function _callee26$(_context33) {
      while (1) switch (_context33.prev = _context33.next) {
        case 0:
          _zw3 = zw(Mv.deserialize(new Uint8Array(n))), _zw4 = _slicedToArray(_zw3, 2), e = _zw4[0], r = _zw4[1];
          Xv(e);
          i = [];
          e.scene.objects.traverse(function (s, o) {
            o.type === "Mesh" && o.geometry.type === "NonParametricGeometry" && o.geometry.data.draco !== void 0 && i.push(o);
          });
          _context33.t0 = i.length;
          if (!_context33.t0) {
            _context33.next = 8;
            break;
          }
          _context33.next = 8;
          return hJ();
        case 8:
          _loop25 = /*#__PURE__*/_regeneratorRuntime().mark(function _loop25() {
            var s, o, a;
            return _regeneratorRuntime().wrap(function _loop25$(_context32) {
              while (1) switch (_context32.prev = _context32.next) {
                case 0:
                  s = _i222[_i223];
                  _context32.next = 3;
                  return fJ(Cr(s.geometry.data.draco));
                case 3:
                  o = _context32.sent;
                  if (o) {
                    o.index && (s.geometry.data.index = {
                      array: o.index.array,
                      itemSize: 1,
                      normalized: !1,
                      type: "Uint32Array"
                    });
                    a = {};
                    o.attributes.forEach(function (_ref155) {
                      var l = _ref155.name,
                        u = _ref155.array,
                        c = _ref155.itemSize;
                      a[l] = {
                        array: u,
                        itemSize: c,
                        type: "Float32Array",
                        normalized: !1
                      };
                    }), s.geometry.data.attributes = a, s.geometry.data.draco = void 0;
                  }
                case 5:
                case "end":
                  return _context32.stop();
              }
            }, _loop25);
          });
          _i223 = 0, _i222 = i;
        case 10:
          if (!(_i223 < _i222.length)) {
            _context33.next = 15;
            break;
          }
          return _context33.delegateYield(_loop25(), "t1", 12);
        case 12:
          _i223++;
          _context33.next = 10;
          break;
        case 15:
          return _context33.abrupt("return", (t && t(e), r.result().data));
        case 16:
        case "end":
          return _context33.stop();
      }
    }, _callee26);
  }));
  return _SN.apply(this, arguments);
}
var VE = /*#__PURE__*/function () {
    function VE(t, e, r, i, s, o, a) {
      _classCallCheck(this, VE);
      this.id = t;
      this.data = e;
      this.dataEvent = r;
      this.object = i;
      this.stage = !1;
      this.actions = gr(r, e.actions, s, o, a, i);
    }
    _createClass(VE, [{
      key: "disconnect",
      value: function disconnect() {
        tr(this.actions);
      }
    }, {
      key: "dispatchIn",
      value: function dispatchIn() {
        var _this426 = this;
        this.actions.Audio.forEach(function (t) {
          return t.dispatchBasic();
        }), this.actions.Particles.forEach(function (t) {
          return t.dispatchBasic();
        }), this.actions.Video.forEach(function (t) {
          return t.dispatchBasic();
        }), this.actions.Create.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Destroy.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Reset.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Link.forEach(function (t) {
          return t.dispatch();
        }), this.actions.Transition.forEach(function (t) {
          t.object.currentTransitionEvent !== _this426 && (t.object.currentTransitionEvent = _this426, t.init());
        }), this.actions.Transition.forEach(function (t) {
          return t.toggle();
        }), this.actions.Animation.forEach(function (t) {
          return t.play();
        }), this.actions.SwitchCamera.forEach(function (t) {
          return t.play();
        }), this.actions.SceneTransition.forEach(function (t) {
          return t.dispatch();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.checkConditions();
        }), this.actions.SetVariable.forEach(function (t) {
          return t.dispatch();
        }), this.actions.DynamicVariablePlay.forEach(function (t) {
          return t.dispatch();
        });
      }
    }, {
      key: "dispatchOut",
      value: function dispatchOut() {
        this.actions.Transition.forEach(function (t) {
          t.toggle();
        });
      }
    }]);
    return VE;
  }(),
  Db = /*#__PURE__*/function (_Dr11) {
    _inherits(Db, _Dr11);
    var _super315 = _createSuper(Db);
    function Db(e, r) {
      var _this427;
      _classCallCheck(this, Db);
      _this427 = _super315.call(this, e);
      _this427.eventManager = r;
      _this427.breakpoints = [];
      _this427.resize = function (e, r) {
        _this427.breakpoints.forEach(function (i) {
          var s = Ov.deviceToSize(i.data.size),
            o = i.dataEvent.orientation === "horizontal" ? e : r,
            a;
          switch (i.data.operator) {
            case "<":
              a = o < s[0];
              break;
            case ">":
              a = o > s[0];
              break;
            case "<>":
              a = o > s[0] && o < s[1];
              break;
          }
          i.stage !== a && (i.stage = a, i.stage ? i.dispatchIn() : i.dispatchOut());
        });
      };
      _this427.onResizeObserver = new ResizeObserver(function (e) {
        var _iterator206 = _createForOfIteratorHelper(e),
          _step206;
        try {
          for (_iterator206.s(); !(_step206 = _iterator206.n()).done;) {
            var _r77 = _step206.value;
            var _r77$contentRect = _r77.contentRect,
              _i209 = _r77$contentRect.width,
              _s144 = _r77$contentRect.height;
            _this427.resize(_i209, _s144);
          }
        } catch (err) {
          _iterator206.e(err);
        } finally {
          _iterator206.f();
        }
      });
      return _this427;
    }
    _createClass(Db, [{
      key: "connect",
      value: function connect() {
        var _this428 = this;
        var _this$eventContext15 = this.eventContext,
          e = _this$eventContext15.page,
          r = _this$eventContext15.sharedAssets,
          i = _this$eventContext15.domElement;
        this.onResizeObserver.observe(i);
        var s = function s(o) {
          var _o$data2;
          if (!(!o.visible || !((_o$data2 = o.data) !== null && _o$data2 !== void 0 && _o$data2.events.length))) {
            var _iterator207 = _createForOfIteratorHelper(o.data.events),
              _step207;
            try {
              var _loop23 = function _loop23() {
                var a = _step207.value.data;
                a.disabled || a.type === "Resize" && a.breakpoints.forEach(function (_ref146) {
                  var l = _ref146.data,
                    u = _ref146.id;
                  try {
                    var c = new VE(u, l, a, o, e, r, _this428.eventManager);
                    _this428.breakpoints.push(c);
                  } catch (c) {
                    !1 && console.log(c);
                  }
                });
              };
              for (_iterator207.s(); !(_step207 = _iterator207.n()).done;) {
                _loop23();
              }
            } catch (err) {
              _iterator207.e(err);
            } finally {
              _iterator207.f();
            }
          }
        };
        e.traverseEntity(function (o) {
          var _o$frame;
          (o instanceof fr || o instanceof sr) && (_o$frame = o.frame) !== null && _o$frame !== void 0 && _o$frame.traverse(function (a) {
            s(a);
          }), s(o);
        });
      }
    }, {
      key: "disconnect",
      value: function disconnect() {
        this.onResizeObserver.disconnect(), this.breakpoints.forEach(function (e) {
          e.disconnect();
        }), this.breakpoints = [];
      }
    }]);
    return Db;
  }(Dr);
var Ob = /*#__PURE__*/function () {
  function Ob(t, e, r, i, s) {
    var _this429 = this;
    _classCallCheck(this, Ob);
    this.publish = t;
    this.controlsManager = e;
    this.animationControls = r;
    this.eventContext = i;
    this.sharedVariables = s;
    this.isEnabled = !1;
    this.activateCount = 0;
    this.needsMouse = !1;
    this.needsRaycast = !1;
    this.onTouchMovePreventScroll = function (t) {
      (t.touches.length > 1 || _this429.preventTouchScroll) && t.preventDefault();
    };
    this.onMouseWheelPreventScroll = function (t) {
      _this429.preventScroll && t.preventDefault();
    };
    this.onMouseMove = function (t) {
      _this429.eventContext.sharedAssets.mouseProperty = _objectSpread(_objectSpread({}, _this429.getMousePosition(t)), {}, {
        pressed: t.buttons > 0
      });
    };
    this.onMouseDown = function (t) {
      _this429.eventContext.sharedAssets.mouseProperty = _objectSpread(_objectSpread({}, _this429.getMousePosition(t)), {}, {
        pressed: !0
      });
    };
    this.onMouseUp = function (t) {
      _this429.eventContext.sharedAssets.mouseProperty = _objectSpread(_objectSpread({}, _this429.getMousePosition(t)), {}, {
        pressed: !1
      });
    };
    this.getMousePosition = function (t) {
      var _t$touches2;
      var e = _this429.eventContext.domRect,
        _ref147 = ((_t$touches2 = t.touches) === null || _t$touches2 === void 0 ? void 0 : _t$touches2.length) > 0 ? t.touches[0] : t,
        r = _ref147.pageX,
        i = _ref147.pageY;
      return {
        x: r - (e.left + window.scrollX),
        y: i - (e.top + window.scrollY)
      };
    };
    this.stopRaycast = t.stopRaycast, this.preventScroll = t.preventScroll, this.preventTouchScroll = t.preventTouchScroll, this.hideCursor = t.hideCursor, this.requestRender = i.requestRender;
  }
  _createClass(Ob, [{
    key: "activate",
    value: function activate() {
      var _this430 = this;
      if (this.isEnabled) return;
      this.isEnabled = !0, this.initializeActionsDependentStates(), this.needsMouse && (this.eventContext.domElement.addEventListener("pointermove", this.onMouseMove), this.eventContext.domElement.addEventListener("pointerdown", this.onMouseDown)), this.handlers = _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({
        Spline: new ub(this.eventContext),
        DynamicVariable: new wb(this.eventContext, this.sharedVariables, this, this.needsMouse, this.needsRaycast)
      }, "Conditional", new fb(this.eventContext, this)), "Start", new bb(this.eventContext, this)), "Basic", new db(this.eventContext, this, this.needsRaycast)), "MouseHover", new vb(this.eventContext, this)), "Scroll", new xb(this.eventContext, this)), "Follow", new mb(this.eventContext, this)), "DragDrop", new pb(this.eventContext, this)), "LookAt", new yb(this.eventContext)), "Resize", new Db(this.eventContext, this));
      var _this$eventContext16 = this.eventContext,
        t = _this$eventContext16.page,
        e = _this$eventContext16.domElement;
      this.hideCursor && (e.style.cursor = "none"), t.traverseEntity(function (r) {
        r.addEventListener("requestRender", _this430.requestRender);
      }), Object.values(this.handlers).forEach(function (r) {
        return r.connect();
      }), e.addEventListener("wheel", this.onMouseWheelPreventScroll), e.addEventListener("touchmove", this.onTouchMovePreventScroll), this.activateCount++;
    }
  }, {
    key: "deactivate",
    value: function deactivate() {
      var _this$controlsManager2,
        _this431 = this;
      if (!this.isEnabled) return;
      this.isEnabled = !1, this.eventContext.domElement.removeEventListener("pointermove", this.onMouseMove), this.eventContext.domElement.removeEventListener("pointerdown", this.onMouseDown), this.eventContext.domElement.removeEventListener("pointerup", this.onMouseUp), this.eventContext.sharedAssets.mouseProperty = null, this.eventContext.sharedAssets.raycastProperty = null;
      var _this$eventContext17 = this.eventContext,
        t = _this$eventContext17.page,
        e = _this$eventContext17.domElement;
      e.style.cursor = "", Object.values(this.handlers).forEach(function (r) {
        return r.disconnect();
      }), (_this$controlsManager2 = this.controlsManager.gameControl) !== null && _this$controlsManager2 !== void 0 && _this$controlsManager2.disposeActions(), this.controlsManager.disconnectEvents(), t.traverseEntity(function (r) {
        r.removeEventListener("requestRender", _this431.requestRender), r.destroyedInAction = !1;
      }), e.removeEventListener("touchmove", this.onTouchMovePreventScroll), e.removeEventListener("wheel", this.onMouseWheelPreventScroll), this.animationControls.onExitPlayMode();
    }
  }, {
    key: "isPaused",
    get: function get() {
      return this.isEnabled;
    }
  }, {
    key: "pause",
    value: function pause() {
      this.deactivate();
    }
  }, {
    key: "resume",
    value: function resume() {
      this.activate();
    }
  }, {
    key: "reset",
    value: function reset() {
      this.deactivate(), this.activate(), this.controlsManager.page.updateMatrixWorld(!0), this.controlsManager.rebuildBVH();
    }
  }, {
    key: "updateUseWindowEvents",
    value: function updateUseWindowEvents(t) {
      var e = this.isEnabled;
      e && this.deactivate(), this.eventContext.useWindowEvents = t, e && this.activate();
    }
  }, {
    key: "initializeActionsDependentStates",
    value: function initializeActionsDependentStates() {
      var _this432 = this;
      var t = this.eventContext.sharedAssets;
      t.resetDynamicVariablePlayState();
      var e = function e(r) {
        if (r.data.type === "Conditional" && (r.data.ifActions.forEach(e), r.data.elseActions.forEach(e)), r.data.type === "Conditional" || r.data.type === "SetVariable") {
          var _iterator208 = _createForOfIteratorHelper(r.data.type === "Conditional" ? r.data.condition : r.data.expression),
            _step208;
          try {
            for (_iterator208.s(); !(_step208 = _iterator208.n()).done;) {
              var _i210 = _step208.value;
              "id" in _i210 && Array.isArray(_i210.id) && (_i210.id[0] === "mouse" && (_this432.needsMouse = !0), _i210.id[0] === "raycast" && (_this432.needsRaycast = !0));
            }
          } catch (err) {
            _iterator208.e(err);
          } finally {
            _iterator208.f();
          }
        }
        r.data.type === "DynamicVariablePlay" && r.data.variableId !== "" && (r.data.mode === "Play" || r.data.mode === "PlayPause" || r.data.mode === "Toggle") && t.setDynamicVariablePlayState(r.data.variableId, "Stopped");
      };
      this.eventContext.page.traverseEntity(function (r) {
        var _r$data;
        if (!!((_r$data = r.data) !== null && _r$data !== void 0 && _r$data.events.length)) {
          var _iterator209 = _createForOfIteratorHelper(r.data.events),
            _step209;
          try {
            for (_iterator209.s(); !(_step209 = _iterator209.n()).done;) {
              var _i211 = _step209.value;
              if (!_i211.data.disabled) if (_i211.data.type === "VariableChange" && (_i211.data.variableId === "mouseProperty" && (_this432.needsMouse = !0), _i211.data.variableId === "raycastProperty" && (_this432.needsRaycast = !0)), _i211.data.type === "Conditional") for (var _i212 = 0, _arr3 = ["inActions", "outActions"]; _i212 < _arr3.length; _i212++) {
                var _s145 = _arr3[_i212];
                _i211.data[_s145].forEach(e);
              } else if (_i211.data.type === "DragDrop") for (var _i213 = 0, _arr4 = ["drag", "drop"]; _i213 < _arr4.length; _i213++) {
                var _s146 = _arr4[_i213];
                _i211.data.dragDropActions[_s146].forEach(e);
              } else if (_i211.data.type === "GameControl") for (var _i214 = 0, _arr5 = ["idle", "move", "jump", "run"]; _i214 < _arr5.length; _i214++) {
                var _s147 = _arr5[_i214];
                _i211.data.gameActions[_s147].forEach(e);
              } else if (_i211.data.type === "Resize") {
                var _iterator210 = _createForOfIteratorHelper(_i211.data.breakpoints),
                  _step210;
                try {
                  for (_iterator210.s(); !(_step210 = _iterator210.n()).done;) {
                    var _s148 = _step210.value;
                    _s148.data.actions.forEach(e);
                  }
                } catch (err) {
                  _iterator210.e(err);
                } finally {
                  _iterator210.f();
                }
              } else _i211.data.type === "LookAt" || _i211.data.actions.forEach(e);
            }
          } catch (err) {
            _iterator209.e(err);
          } finally {
            _iterator209.f();
          }
        }
      });
    }
  }]);
  return Ob;
}();
var Ib = /*#__PURE__*/function () {
  function Ib(t, e, r, i, s) {
    _classCallCheck(this, Ib);
    this._aspect = 1;
    this.enableResponsive = !1;
    this._renderer = t, this._camera = e, this._frameSize = new N().copy(r), this._editorSize = new N().copy(i), this._aspect = e.aspect, this._fov = s !== null && s !== void 0 ? s : e.fov;
  }
  _createClass(Ib, [{
    key: "frameSize",
    set: function set(t) {
      this._frameSize.copy(t);
    }
  }, {
    key: "updateRenderer",
    value: function updateRenderer() {
      !this._renderer || this._renderer.setSize(this._frameSize.x, this._frameSize.y);
    }
  }, {
    key: "updateViewport",
    value: function updateViewport() {
      if (!this._renderer || !this._camera || this._camera.cameraType !== "PerspectiveCamera") return;
      var t = this._frameSize.x,
        e = this._frameSize.y,
        r = this._editorSize.y;
      this._aspect = t / e, e <= r && (this._camera.zoom *= r / e), this._renderer.setViewport(0, 0, t, e);
    }
  }, {
    key: "updateCamera",
    value: function updateCamera() {
      var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
      if (!!this._camera) if (this._camera.cameraType === "PerspectiveCamera") {
        var e = this._frameSize.y,
          r = this._editorSize.y,
          _i215 = this._fov;
        if (t && e > r) {
          var _s149 = pJ(e, 1080, 2160, 1, 15) / 100;
          _i215 *= e / r, _i215 *= 1 - _s149;
        }
        this._camera.aspect = this._aspect, this._camera.fov = _i215, this._camera.updateProjectionMatrix();
      } else this._camera.setViewplaneSize(this._frameSize.x, this._frameSize.y, this.enableResponsive);
    }
  }, {
    key: "setCamera",
    value: function setCamera(t) {
      this._camera = t, this._aspect = t.aspect, this._fov = t.fov;
    }
  }, {
    key: "revert",
    value: function revert() {
      var t = window.innerWidth,
        e = window.innerHeight;
      this._renderer && (this._renderer.setViewport(0, 0, t, e), this._renderer.setSize(t, e)), this._camera && (this._camera.aspect = t / e, this._camera.fov = this._fov, this._camera.setViewplaneSize(t, e, this.enableResponsive), this._camera.updateProjectionMatrix());
    }
  }]);
  return Ib;
}();
function pJ(n, t, e, r, i) {
  return (n - t) / (e - t) * (i - r) + r;
}
var Rb = /*#__PURE__*/function () {
  function Rb(t) {
    var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    _classCallCheck(this, Rb);
    this.shared = new Wc(t.shared, e), this.scene = new Vl(t.scene, this.sharedAssets), this.shared.setEntityOpContext({
      scene: this.scene,
      shared: this.shared
    });
  }
  _createClass(Rb, [{
    key: "sharedAssets",
    get: function get() {
      return this.shared;
    }
  }, {
    key: "reset",
    value: function reset(t, e) {
      this.scene.clearScene(), this.sharedAssets.reset(t.shared), this.scene.resetAfterClear(t.scene, this.sharedAssets);
    }
  }, {
    key: "resetPersonalCameraFromDocumentData",
    value: function resetPersonalCameraFromDocumentData() {
      var _iterator211 = _createForOfIteratorHelper(this.scene.children),
        _step211;
      try {
        for (_iterator211.s(); !(_step211 = _iterator211.n()).done;) {
          var t = _step211.value;
          t instanceof sr && !t.uiScene && t.personalCamera.updateState(t.data.camera, {
            scene: this.scene,
            shared: this.shared
          });
        }
      } catch (err) {
        _iterator211.e(err);
      } finally {
        _iterator211.f();
      }
    }
  }, {
    key: "dispose",
    value: function dispose() {
      this.scene.dispose(), this.shared.dispose();
    }
  }, {
    key: "gc",
    value: function gc() {
      var _this433 = this;
      this.shared.geometryCache.startGc(), this.shared.geometryCache2.startGc(), this.scene.traverseEntity(function (t) {
        t instanceof er && t.markGeometryAsReachable(_this433.shared);
      }), this.shared.geometryCache.endGc(), this.shared.geometryCache2.endGc();
    }
  }]);
  return Rb;
}();
var Lb = /*#__PURE__*/function () {
  function Lb(_ref148) {
    var _ref148$x = _ref148.x,
      t = _ref148$x === void 0 ? 10 : _ref148$x,
      _ref148$y = _ref148.y,
      e = _ref148$y === void 0 ? 10 : _ref148$y;
    _classCallCheck(this, Lb);
    this._startTime = 0;
    var r = document.getElementById("spe-perfs");
    r ? this.element = r : (this.element = document.createElement("div"), document.body.appendChild(this.element), this.element.style.position = "absolute", this.element.style.zIndex = "10000", this.element.style.fontFamily = "monospace", this.element.style.background = "black", this.element.style.color = "white", this.element.style.padding = "10px", this.element.style.opacity = "0.5", this.element.style.fontSize = "11px", this.element.setAttribute("id", "spe-perfs")), this.element.style.left = "".concat(t, "px"), this.element.style.top = "".concat(e, "px");
  }
  _createClass(Lb, [{
    key: "dispose",
    value: function dispose() {
      var _this$element$parentE;
      (_this$element$parentE = this.element.parentElement) === null || _this$element$parentE === void 0 || _this$element$parentE.removeChild(this.element);
    }
  }, {
    key: "start",
    value: function start() {
      this._startTime = performance.now();
    }
  }, {
    key: "end",
    value: function end() {
      var e = performance.now() - this._startTime;
      this.element.innerHTML = e.toFixed(3) + " ms";
    }
  }]);
  return Lb;
}();
function mJ(n) {
  var t;
  if (!!n.index) for (var e = 0; e < n.index.array.length; e += 3) t = n.index.array[e], n.index.array[e] = n.index.array[e + 2], n.index.array[e + 2] = t;
}
function bg(n) {
  return n instanceof Qs ? "SubdivObject" : n.geometry.type === "NonParametricGeometry" ? "NonParametric" : "Mesh";
}
function gJ(n, t) {
  var e = {};
  return n.traverseEntity(function (r) {
    if (!r.visible || !(r instanceof nr) || r.type !== "Mesh" || Array.isArray(r.material) || r.states && Object.keys(r.states).length) return;
    var i = r.parent;
    for (; i;) {
      if (i instanceof nr && r.states && Object.keys(r.states).length) return;
      i = i.parent;
    }
    var s = r.material.uuid,
      o = t.shared.materials[s];
    if (o) {
      if (!Qr.isMergable(o)) return;
    } else {
      var _t$scene$objects$get;
      var u = (_t$scene$objects$get = t.scene.objects.get(r.uuid)) === null || _t$scene$objects$get === void 0 ? void 0 : _t$scene$objects$get.data;
      if (u && "material" in u && typeof u.material != "string") {
        if (!Qr.isMergable(u.material)) return;
        s = Qr.getHash(u.material);
      }
    }
    e[s] || (e[s] = {});
    var l = e[s][bg(r)];
    if (l) {
      if (l.push(r), r.cloner) {
        var _iterator212 = _createForOfIteratorHelper(r.cloner.children),
          _step212;
        try {
          for (_iterator212.s(); !(_step212 = _iterator212.n()).done;) {
            var _u71 = _step212.value;
            l.push(_u71);
          }
        } catch (err) {
          _iterator212.e(err);
        } finally {
          _iterator212.f();
        }
      }
    } else if (e[s][bg(r)] = [r], r.cloner) {
      var _iterator213 = _createForOfIteratorHelper(r.cloner.children),
        _step213;
      try {
        for (_iterator213.s(); !(_step213 = _iterator213.n()).done;) {
          var _u72 = _step213.value;
          e[s][bg(r)].push(_u72);
        }
      } catch (err) {
        _iterator213.e(err);
      } finally {
        _iterator213.f();
      }
    }
  }), e;
}
function yJ(n) {
  var t = 0;
  return Object.values(n).forEach(function (e) {
    Object.values(e).forEach(function (r) {
      var i = r.length;
      i > t && (t = i);
    });
  }), t;
}
function wN(n, t) {
  var e = gJ(t, n),
    r = yJ(e),
    i = new Array(r),
    s = 0,
    o = new Array(r),
    a = 0,
    l = new Array(r),
    u = 0,
    c = new Array(r),
    d = 0;
  for (var _i216 = 0, _Object$entries37 = Object.entries(e); _i216 < _Object$entries37.length; _i216++) {
    var _Object$entries37$_i = _slicedToArray(_Object$entries37[_i216], 2),
      _h109 = _Object$entries37$_i[0],
      f = _Object$entries37$_i[1];
    var _loop24 = function _loop24() {
      var p = _Object$values7[_i217];
      if (a = 0, u = 0, p.forEach(function (g) {
        g instanceof nr && (o[a++] = g.geometry.clone(), l[u++] = g);
      }), u < 2) return 1; // continue
      for (var g = 0; g < u; g++) l[g].updateWorldMatrix(!0, !1), o[g].applyMatrix4(l[g].matrixWorld), l[g].matrixWorld.determinant() < 0 && mJ(o[g]);
      var m = Vs(o.slice(0, a), !1);
      if (m) {
        var _g54;
        switch (_h109) {
          case "SubdivObject":
            {
              console.warn("Turning subdiv object into mesh"), _g54 = new rr(m, l[0].material);
              break;
            }
          default:
            {
              _g54 = new rr(m, l[0].material);
              break;
            }
        }
        _g54.castShadow = l[0].castShadow, _g54.receiveShadow = l[0].receiveShadow, t.add(_g54);
        var y = function y(v) {
          d = 0;
          var _iterator214 = _createForOfIteratorHelper(v),
            _step214;
          try {
            for (_iterator214.s(); !(_step214 = _iterator214.n()).done;) {
              var _x51 = _step214.value;
              _x51.children && y(_x51.children), _x51 instanceof nr && (Array.isArray(_x51.material) || e[_x51.material.uuid] && e[_x51.material.uuid][bg(_x51)] && e[_x51.material.uuid][bg(_x51)].length > 1 || (c[d++] = _x51));
            }
          } catch (err) {
            _iterator214.e(err);
          } finally {
            _iterator214.f();
          }
          for (var x = 0; x < d; x++) t.attach(c[x]);
        };
        for (var v = 0; v < u; v++) {
          var x = l[v];
          y(x.children), i[s++] = x;
        }
      }
    };
    for (var _i217 = 0, _Object$values7 = Object.values(f); _i217 < _Object$values7.length; _i217++) {
      if (_loop24()) continue;
    }
  }
  for (var _h110 = 0; _h110 < s; _h110++) i[_h110].removeFromParent();
}
var TN = Pi(_N(), 1);
var xJ = new N();
function bJ(n) {
  var t = "The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";
  n.endsWith(".spline") ? console.warn(t + " The .spline files are only meant to be used by the Editor.") : n.endsWith(".splinecode") || console.warn(t);
}
var EN = exports.Application = /*#__PURE__*/function () {
  function EN(t) {
    var _this434 = this;
    var _ref149 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
      e = _ref149.renderOnDemand,
      _ref149$renderMode = _ref149.renderMode,
      r = _ref149$renderMode === void 0 ? "auto" : _ref149$renderMode;
    _classCallCheck(this, EN);
    this._viewportMode = 1;
    this._viewportWidth = window.innerWidth;
    this._viewportHeight = window.innerHeight;
    this._proxyObjectCache = new Map();
    this._variablesCache = new Map();
    this._isPaused = !1;
    this._renderRequested = !1;
    this._skipRender = !1;
    this.time = performance.now();
    this.dt = 0;
    this.currentTAAFrame = 0;
    this.disposed = !1;
    this._requestRenderAutoMode = function () {
      _this434._skipRender = !1;
    };
    this.requestRender = function () {
      _this434._renderRequested = !0;
    };
    this.render = function (t) {
      var _this434$_perfs, _this434$_eventManage, _this434$_eventManage2, _this434$_eventManage3, _this434$_animationCo, _this434$_scene, _this434$_eventManage4, _this434$_eventManage5, _this434$_eventManage6, _this434$_eventManage7, _this434$_perfs4;
      if (_this434.time = t, _this434._lastTime && (_this434.dt = _this434.time - _this434._lastTime), _this434._lastTime = _this434.time, (_this434$_perfs = _this434._perfs) !== null && _this434$_perfs !== void 0 && _this434$_perfs.start(), !_this434._renderer) {
        var _this434$_perfs2;
        (_this434$_perfs2 = _this434._perfs) === null || _this434$_perfs2 === void 0 || _this434$_perfs2.end();
        return;
      }
      if (!_this434._isPaused && (_this434.renderMode === "manual" && !_this434._renderRequested || _this434.renderMode === "auto" && _this434._skipRender)) {
        var _this434$_perfs3;
        (_this434$_perfs3 = _this434._perfs) === null || _this434$_perfs3 === void 0 || _this434$_perfs3.end();
        return;
      }
      if (_this434._renderRequested = !1, _this434._skipRender = !0, _this434._controls && (_this434._skipRender = _this434._controls.update(_this434.dt)), _this434._eventManager && ((_this434$_eventManage = _this434._eventManager.handlers) !== null && _this434$_eventManage !== void 0 && _this434$_eventManage.Start.hasVideoAction || (_this434$_eventManage2 = _this434._eventManager.handlers) !== null && _this434$_eventManage2 !== void 0 && _this434$_eventManage2.Basic.hasVideoAction || (_this434$_eventManage3 = _this434._eventManager.handlers) !== null && _this434$_eventManage3 !== void 0 && _this434$_eventManage3.Conditional.hasVideoAction) && (_this434._skipRender = !1), (_this434$_animationCo = _this434._animationControls) !== null && _this434$_animationCo !== void 0 && _this434$_animationCo.update(_this434.dt), _this434._skipRender ? (_this434.currentTAAFrame++, _this434.currentTAAFrame < 32 ? _this434._skipRender = !1 : _this434.currentTAAFrame = 0) : _this434.currentTAAFrame = 0, (_this434$_scene = _this434._scene) !== null && _this434$_scene !== void 0 && _this434$_scene.traverseVisibleEntity(function (e) {
        e.type === "ParticleSystem" && (e.update(_this434.dt), _this434._skipRender = !1);
      }), _this434._scene && _this434._scene.activeCamera !== _this434._camera && (_this434._camera = _this434._scene.activeCamera), (_this434$_eventManage4 = _this434._eventManager) !== null && _this434$_eventManage4 !== void 0 && _this434$_eventManage4.isEnabled && (((_this434$_eventManage5 = _this434._eventManager.handlers) === null || _this434$_eventManage5 === void 0 ? void 0 : _this434$_eventManage5.Follow).onAnimationFrameDamping(), ((_this434$_eventManage6 = _this434._eventManager.handlers) === null || _this434$_eventManage6 === void 0 ? void 0 : _this434$_eventManage6.LookAt).onAnimationFrameDamping(), ((_this434$_eventManage7 = _this434._eventManager.handlers) === null || _this434$_eventManage7 === void 0 ? void 0 : _this434$_eventManage7.DragDrop).onAnimationFrameDamping()), _this434._scene && _this434._camera) {
        if (_this434._scene.pathConstraints.applyConstraints(_this434._scene), _this434._renderer.sceneTransitionTimeRemaining > 0) {
          _this434._renderer.sceneTransitionTimeRemaining -= _this434.dt;
          var _e72 = 1 - _this434._renderer.sceneTransitionTimeRemaining / _this434._renderer.sceneTransitionDuration;
          _this434._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value = _e72, _this434._skipRender = !1;
        } else _this434._renderer.pipeline.sceneTransitionFromTexture = null;
        _this434._renderer.renderSplineScene(_this434._scene, _this434._camera);
      }
      _this434.canvas.dispatchEvent(_this434._renderedEvent), (_this434$_perfs4 = _this434._perfs) === null || _this434$_perfs4 === void 0 ? void 0 : _this434$_perfs4.end();
    };
    this._resize = function () {
      if (!!_this434._renderer) {
        var _this434$_scene2, _this434$_scene3, _this434$_frameView$f, _this434$_frameView, _this434$_frameView$f2, _this434$_frameView2, _this434$_frameView$e, _this434$_frameView3;
        if (_this434._viewportMode === 1 && _this434._frameView && (_this434._frameView.frameSize = xJ.set(_this434._viewportWidth, _this434._viewportHeight)), _this434._renderer.setSize(_this434._viewportWidth, _this434._viewportHeight, !1), _this434._camera = (_this434$_scene2 = _this434._scene) === null || _this434$_scene2 === void 0 ? void 0 : _this434$_scene2.activeCamera, (_this434$_scene3 = _this434._scene) !== null && _this434$_scene3 !== void 0 && _this434$_scene3.updateViewPlaneSize((_this434$_frameView$f = (_this434$_frameView = _this434._frameView) === null || _this434$_frameView === void 0 || (_this434$_frameView = _this434$_frameView.frameSize) === null || _this434$_frameView === void 0 ? void 0 : _this434$_frameView.x) !== null && _this434$_frameView$f !== void 0 ? _this434$_frameView$f : _this434._viewportWidth, (_this434$_frameView$f2 = (_this434$_frameView2 = _this434._frameView) === null || _this434$_frameView2 === void 0 || (_this434$_frameView2 = _this434$_frameView2.frameSize) === null || _this434$_frameView2 === void 0 ? void 0 : _this434$_frameView2.y) !== null && _this434$_frameView$f2 !== void 0 ? _this434$_frameView$f2 : _this434._viewportHeight, (_this434$_frameView$e = (_this434$_frameView3 = _this434._frameView) === null || _this434$_frameView3 === void 0 ? void 0 : _this434$_frameView3.enableResponsive) !== null && _this434$_frameView$e !== void 0 ? _this434$_frameView$e : !1), _this434._camera) {
          var _Object$values$0$pres, _this434$_data$frames, _this434$_data, _this434$_frameView4, _this434$_frameView5;
          var _t32 = (_Object$values$0$pres = Object.values((_this434$_data$frames = (_this434$_data = _this434._data) === null || _this434$_data === void 0 ? void 0 : _this434$_data.frames) !== null && _this434$_data$frames !== void 0 ? _this434$_data$frames : {})[0].preset) !== null && _Object$values$0$pres !== void 0 ? _Object$values$0$pres : "fullscreen";
          (_this434$_frameView4 = _this434._frameView) !== null && _this434$_frameView4 !== void 0 && _this434$_frameView4.setCamera(_this434._camera), (_this434$_frameView5 = _this434._frameView) !== null && _this434$_frameView5 !== void 0 && _this434$_frameView5.updateCamera(_t32 !== "fullscreen"), _this434._camera.cameraType === "PerspectiveCamera" && (_this434._camera.aspect = _this434._viewportWidth / _this434._viewportHeight), _this434._camera.updateProjectionMatrix();
        }
        _this434.eventManager && (_this434.eventManager.eventContext.domRect = _this434.canvas.getBoundingClientRect()), _this434._requestRenderAutoMode();
      }
    };
    this._debouncedResize = Ec(this._resize, 10);
    this._onScroll = function (t) {
      _this434.eventManager && (_this434.eventManager.eventContext.domRect = _this434.canvas.getBoundingClientRect());
    };
    this.canvas = t, this.renderMode = e ? "auto" : r, this._renderedEvent = new CustomEvent("rendered", {
      bubbles: !0
    }), Object.defineProperty(this._renderedEvent, "target", {
      writable: !1,
      value: this
    }), window.location.search.includes("perfs") && (this._perfs = new Lb({
      x: 10,
      y: 10
    })), E2(t);
  }
  _createClass(EN, [{
    key: "load",
    value: function () {
      var _load2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(t, e, r) {
        var s;
        return _regeneratorRuntime().wrap(function _callee20$(_context26) {
          while (1) switch (_context26.prev = _context26.next) {
            case 0:
              bJ(t), this.disposed = !1;
              _context26.next = 3;
              return fetch(t, r);
            case 3:
              _context26.next = 5;
              return _context26.sent.arrayBuffer();
            case 5:
              s = _context26.sent;
              _context26.next = 8;
              return this.start(s, {
                variables: e
              });
            case 8:
            case "end":
              return _context26.stop();
          }
        }, _callee20, this);
      }));
      function load(_x52, _x53, _x54) {
        return _load2.apply(this, arguments);
      }
      return load;
    }()
  }, {
    key: "start",
    value: function () {
      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(t) {
        var _this$_eventManager,
          _this$_controls,
          _this$_scene,
          _this435 = this,
          _this$_scene2,
          _a$allowResponsive;
        var _ref150,
          _ref150$interactive,
          e,
          r,
          i,
          s,
          l,
          u,
          o,
          _l103,
          a,
          _l104,
          _args18 = arguments;
        return _regeneratorRuntime().wrap(function _callee21$(_context27) {
          while (1) switch (_context27.prev = _context27.next) {
            case 0:
              _ref150 = _args18.length > 1 && _args18[1] !== undefined ? _args18[1] : {}, _ref150$interactive = _ref150.interactive, e = _ref150$interactive === void 0 ? !0 : _ref150$interactive, r = _ref150.variables;
              if (!this.disposed) {
                _context27.next = 3;
                break;
              }
              return _context27.abrupt("return");
            case 3:
              _context27.next = 5;
              return SN(t);
            case 5:
              i = _context27.sent;
              this._data = i;
              i.version && (0, TN.default)(i.version, "1.0.17") > 0 && console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version.");
              _context27.next = 10;
              return Promise.all([h_(i) && AI(), hR(i) && gI(), Al.physicsEnabled(i.scene.objects) && I2(), n_(i) && oR(), __(i) && E3(), OE(i) && P2()].filter(Boolean));
            case 10:
              (_this$_eventManager = this._eventManager) !== null && _this$_eventManager !== void 0 && _this$_eventManager.deactivate();
              (_this$_controls = this._controls) !== null && _this$_controls !== void 0 && _this$_controls.deactivate();
              (_this$_scene = this._scene) === null || _this$_scene === void 0 ? void 0 : _this$_scene.dispose();
              s = new Rb(i);
              if (s.resetPersonalCameraFromDocumentData(), this._scene = s.scene, this._sharedAssetsManager = s.sharedAssets, this._camera = this._scene.activeCamera, window.location.search.includes("merge-geometries")) {
                l = performance.now();
                wN(i, s.scene);
                u = performance.now();
                console.log("Merged geometries in ", u - l, " ms");
              }
              h_(i) && this._scene.traverse(function (l) {
                An(l) && l.recomputeBoolean();
              }), this._sharedAssetsManager.setRequestRender(function () {
                var _this435$_scene;
                _this435._requestRenderAutoMode(), (_this435$_scene = _this435._scene) === null || _this435$_scene === void 0 ? void 0 : _this435$_scene.traverse(function (l) {
                  l instanceof Gi && l.pendingMediaLoad && l.update();
                });
              }), (_this$_scene2 = this._scene) === null || _this$_scene2 === void 0 ? void 0 : _this$_scene2.traverse(function (l) {
                l.type === "ParticleSystem" && (l.wakeUp(), l.data.autoPlay ? l.start() : l.stop());
              });
              o = Object.keys(i.shared.fonts).map(function (l) {
                return _this435._sharedAssetsManager.getFont(l).loadingPromise;
              });
              Promise.all(o).then(function () {
                s.scene.markNeedsUpdateRendererDirty(), _this435._requestRenderAutoMode();
              });
              _context27.t0 = n_(i) && vN(i);
              if (!_context27.t0) {
                _context27.next = 22;
                break;
              }
              _context27.next = 22;
              return Promise.all(o);
            case 22:
              if (!__(i)) {
                _context27.next = 27;
                break;
              }
              _l103 = [];
              this._scene.traverseEntity(function (u) {
                u instanceof fr && _l103.push(u);
              });
              _context27.next = 27;
              return Promise.all(_l103.map(function (u) {
                return u.uiCanvas.promise;
              }));
            case 27:
              this._scene.rewriteEventsBeforeGoToPlayMode(), If(this._scene.activePage, this._sharedAssetsManager), this._renderer || (this._renderer = new wx({
                canvas: this.canvas,
                antialias: !1,
                alpha: !0,
                stencil: !1,
                depth: !1,
                powerPreference: "high-performance"
              }), this._renderer.hdTransmission = i.scene.publish.hdTransmission === !0, this._renderer.setPixelRatio(window.devicePixelRatio), this._renderer.pipeline.enableUIOverlay(), this._renderer.pipeline.addEventListener("smaaloaded", this._requestRenderAutoMode)), this._scene.initializeSplatViewer(this._renderer), i.scene.blueNoiseTextureData !== void 0 && this._renderer.pipeline.updateBlueNoiseTexture(i.scene.blueNoiseTextureData);
              a = Object.values(i.frames)[0];
              if (this._frameView ? this._frameView.setCamera(this._camera) : (a.preset === "fullscreen" ? (this._viewportMode = 1, this.canvas.style.display = "block", this.canvas.parentElement && (this._viewportWidth = this.canvas.parentElement.clientWidth || 300, this.canvas.style.width = "100%"), this.canvas.parentElement && (this._viewportHeight = this.canvas.parentElement.clientHeight || 150, this.canvas.style.height = "100%")) : (this._viewportMode = 2, this._viewportWidth = a.size[0], this._viewportHeight = a.size[1], this.canvas.style.width = "".concat(this._viewportWidth, "px"), this.canvas.style.height = "".concat(this._viewportHeight, "px")), this._renderer.setSize(this._viewportWidth, this._viewportHeight, !1), this._frameView = new Ib(this._renderer, this._camera, new N(this._viewportWidth, this._viewportHeight), new N(window.innerWidth, window.innerHeight)), this._frameView.enableResponsive = ((_a$allowResponsive = a.allowResponsive) !== null && _a$allowResponsive !== void 0 ? _a$allowResponsive : !1) && a.preset === "fullscreen"), e) {
                _l104 = new cb(this._renderer, this.data.scene.publish, this._scene, function () {
                  return _this435._scene.activeCamera;
                }, this._sharedAssetsManager, this._requestRenderAutoMode, !0, a);
                this._scene.updateMatrixWorld(!0), this._controls = new Mb(_l104), this._animationControls = new Cb(this._scene, this._requestRenderAutoMode), this._eventManager = new Ob(i.scene.publish, this._controls, this._animationControls, _l104, i.shared.variables), this._eventManager.activate(), this._controls.activate(this._eventManager);
              }
              this._resize(), r !== void 0 && this.setVariables(r), this.dt === 0 && (this.render(performance.now()), setTimeout(function () {
                var _this435$_renderer;
                (_this435$_renderer = _this435._renderer) === null || _this435$_renderer === void 0 || _this435$_renderer.setAnimationLoop(_this435.render);
              }, 0)), this._resizeObserverTimeout = setTimeout(function () {
                !_this435._resizeObserver && _this435.canvas.parentElement && (_this435._resizeObserver = new ResizeObserver(function () {
                  _this435._viewportWidth = _this435.canvas.clientWidth, _this435._viewportHeight = _this435.canvas.clientHeight, _this435._debouncedResize();
                }), _this435._resizeObserver.observe(_this435.canvas.parentElement));
              }, 300), document.addEventListener("scroll", this._onScroll);
            case 31:
            case "end":
              return _context27.stop();
          }
        }, _callee21, this);
      }));
      function start(_x55) {
        return _start.apply(this, arguments);
      }
      return start;
    }()
  }, {
    key: "setVariables",
    value: function setVariables(t) {
      if (this._data !== void 0) {
        var e = Object.entries(t);
        for (var _i218 = 0, _e73 = e; _i218 < _e73.length; _i218++) {
          var _e73$_i = _slicedToArray(_e73[_i218], 2),
            r = _e73$_i[0],
            _i219 = _e73$_i[1];
          this.setVariable(r, _i219);
        }
      }
    }
  }, {
    key: "setVariable",
    value: function setVariable(t, e) {
      var r = this._getVariableByName(t);
      if (r && !("dynamicVariableType" in r.data)) {
        var _this$_sharedAssetsMa;
        var _i220 = e;
        typeof r.data.value == "number" ? _i220 = typeof e == "number" ? e : typeof e == "boolean" ? e === !0 ? 1 : 0 : parseFloat(e) : typeof r.data.value == "boolean" ? _i220 = typeof e == "number" ? !!e : typeof e == "boolean" ? e : e.toLocaleLowerCase() === "false" ? !1 : !!e : typeof r.data.value != "string" && r.data.value.textValue !== void 0 && (_i220 = e.toString());
        var _s150 = typeof _i220 == "string" ? {
          textValue: _i220
        } : _i220;
        (_this$_sharedAssetsMa = this._sharedAssetsManager) !== null && _this$_sharedAssetsMa !== void 0 && _this$_sharedAssetsMa.updateVariable(r.id, _s150), this.requestRender(), this._requestRenderAutoMode();
      } else r === void 0 ? console.warn("No variable named ".concat(t, " was found in your Spline file. Make sure to create it from Spline editor.")) : "dynamicVariableType" in r.data && console.warn("Dynamic variables like ".concat(t, " cannot be updated from code."));
    }
  }, {
    key: "getVariables",
    value: function getVariables() {
      var _this436 = this;
      var t = {};
      return this._data && this._data.shared.variables.forEach(function (e) {
        t[e.data.name] === void 0 && (t[e.data.name] = _this436._getVariableValue(_this436._sharedAssetsManager.getVariable(e.id)));
      }), t;
    }
  }, {
    key: "getVariable",
    value: function getVariable(t) {
      var e = this._getVariableByName(t);
      if (e) {
        var r = this._sharedAssetsManager.getVariable(e.id);
        return this._getVariableValue(r);
      }
    }
  }, {
    key: "_getVariableValue",
    value: function _getVariableValue(t) {
      return typeof t != "string" && Fi.isTextValue(t) ? Fi.getDisplayedValue(t) : t;
    }
  }, {
    key: "_getVariableByName",
    value: function _getVariableByName(t) {
      if (this._data) {
        if (this._variablesCache.has(t)) return this._variablesCache.get(t);
        var e = this._data.shared.variables.find(function (r) {
          return r.data.name === t;
        });
        return e && this._variablesCache.set(t, e), e;
      }
    }
  }, {
    key: "findObjectById",
    value: function findObjectById(t) {
      var _this$_scene3;
      var e = (_this$_scene3 = this._scene) === null || _this$_scene3 === void 0 ? void 0 : _this$_scene3.getObjectByProperty("uuid", t);
      return this._createProxyObject(e);
    }
  }, {
    key: "findObjectByName",
    value: function findObjectByName(t) {
      var _this$_scene4;
      var e = (_this$_scene4 = this._scene) === null || _this$_scene4 === void 0 ? void 0 : _this$_scene4.getObjectByName(t);
      return this._createProxyObject(e);
    }
  }, {
    key: "getAllObjects",
    value: function getAllObjects() {
      var _this$_scene5,
        _this437 = this;
      var t = [];
      return (_this$_scene5 = this._scene) !== null && _this$_scene5 !== void 0 && _this$_scene5.traverseEntity(function (e) {
        if (e.uuid !== us && !_this437._scene.isInvisibleObjects(e) && !(e instanceof sr)) {
          var r = _this437._createProxyObject(e);
          r && t.push(r);
        }
      }), t;
    }
  }, {
    key: "getSplineEvents",
    value: function getSplineEvents() {
      var _this$_eventManager2;
      return ((_this$_eventManager2 = this._eventManager) === null || _this$_eventManager2 === void 0 || (_this$_eventManager2 = _this$_eventManager2.handlers) === null || _this$_eventManager2 === void 0 ? void 0 : _this$_eventManager2.Spline).splineEvents;
    }
  }, {
    key: "emitEvent",
    value: function emitEvent(t, e) {
      var _ref151;
      (_ref151 = this.findObjectById(e) || this.findObjectByName(e)) === null || _ref151 === void 0 || _ref151.emitEvent(t);
    }
  }, {
    key: "emitEventReverse",
    value: function emitEventReverse(t, e) {
      var _ref152;
      (_ref152 = this.findObjectById(e) || this.findObjectByName(e)) === null || _ref152 === void 0 || _ref152.emitEventReverse(t);
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(t, e) {
      this.canvas.addEventListener(t, e);
    }
  }, {
    key: "removeEventListener",
    value: function removeEventListener(t, e) {
      this.canvas.removeEventListener(t, e);
    }
  }, {
    key: "setZoom",
    value: function setZoom(t) {
      var _this$_controls2, _this$_controls3;
      ((_this$_controls2 = this._controls) === null || _this$_controls2 === void 0 ? void 0 : _this$_controls2.orbitControls) instanceof Gf && ((_this$_controls3 = this._controls) === null || _this$_controls3 === void 0 ? void 0 : _this$_controls3.orbitControls.zoomOut(t));
    }
  }, {
    key: "eventManager",
    get: function get() {
      return this._eventManager;
    }
  }, {
    key: "controls",
    get: function get() {
      return this._controls;
    }
  }, {
    key: "setSize",
    value: function setSize(t, e) {
      this._viewportWidth = t, this._viewportHeight = e, this._viewportMode = 2, this._resize();
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(t) {
      var _this$_scene6;
      var _r$g$b$a = {
          r: 0,
          g: 0,
          b: 0,
          a: 1
        },
        e = _r$g$b$a.r,
        r = _r$g$b$a.g,
        i = _r$g$b$a.b,
        s = _r$g$b$a.a,
        o = new cr(e, r, i, s);
      try {
        o.setStyle(t);
      } catch (_unused36) {
        console.error("This is not a valid css color", t);
      }
      (_this$_scene6 = this._scene) !== null && _this$_scene6 !== void 0 && _this$_scene6.activePage.setBackgroundColor(o), this._requestRenderAutoMode();
    }
  }, {
    key: "dispose",
    value: function dispose() {
      var _this$_eventManager3, _this$_scene7, _this$_sharedAssetsMa2, _this$_renderer, _this$_renderer2, _this$_sharedAssetsMa3, _this$_controls4;
      this.disposed = !0, (_this$_eventManager3 = this._eventManager) !== null && _this$_eventManager3 !== void 0 && _this$_eventManager3.deactivate(), (_this$_scene7 = this._scene) !== null && _this$_scene7 !== void 0 && _this$_scene7.dispose(), (_this$_sharedAssetsMa2 = this._sharedAssetsManager) !== null && _this$_sharedAssetsMa2 !== void 0 && _this$_sharedAssetsMa2.dispose(), this._proxyObjectCache.forEach(function (t) {
        _w.unsubscribe(t);
      }), this._variablesCache.clear(), (_this$_renderer = this._renderer) !== null && _this$_renderer !== void 0 && _this$_renderer.setAnimationLoop(null), (_this$_renderer2 = this._renderer) !== null && _this$_renderer2 !== void 0 && _this$_renderer2.dispose(), this._renderer = void 0, (_this$_sharedAssetsMa3 = this._sharedAssetsManager) !== null && _this$_sharedAssetsMa3 !== void 0 && _this$_sharedAssetsMa3.dispose(), this._resizeObserver && (this._resizeObserver.disconnect(), this._resizeObserver = void 0), this._resizeObserverTimeout !== void 0 && clearTimeout(this._resizeObserverTimeout), this.canvas.style.width = "", this.canvas.style.height = "", this.canvas.removeAttribute("width"), this.canvas.removeAttribute("height"), this._frameView && (this._frameView = void 0), (_this$_controls4 = this._controls) !== null && _this$_controls4 !== void 0 && _this$_controls4.deactivate(), T2(this.canvas), document.removeEventListener("scroll", this._onScroll);
    }
  }, {
    key: "isStopped",
    get: function get() {
      return this._isPaused;
    }
  }, {
    key: "stop",
    value: function stop() {
      var _this$_renderer3, _this$_eventManager4, _this$_controls5;
      this._isPaused || ((_this$_renderer3 = this._renderer) !== null && _this$_renderer3 !== void 0 && _this$_renderer3.setAnimationLoop(null), this._isPaused = !0, (_this$_eventManager4 = this._eventManager) !== null && _this$_eventManager4 !== void 0 && _this$_eventManager4.pause(), ((_this$_controls5 = this._controls) === null || _this$_controls5 === void 0 ? void 0 : _this$_controls5.orbitControls) && (this._controls.orbitControls.enabled = !1));
    }
  }, {
    key: "play",
    value: function play() {
      var _this$_eventManager5, _this$_controls6, _this$_renderer4;
      !this._isPaused || (this._isPaused = !1, (_this$_eventManager5 = this._eventManager) !== null && _this$_eventManager5 !== void 0 && _this$_eventManager5.resume(), (_this$_controls6 = this._controls) !== null && _this$_controls6 !== void 0 && _this$_controls6.orbitControls && (this._controls.orbitControls.enabled = !0), (_this$_renderer4 = this._renderer) === null || _this$_renderer4 === void 0 ? void 0 : _this$_renderer4.setAnimationLoop(this.render));
    }
  }, {
    key: "setGlobalEvents",
    value: function setGlobalEvents(t) {
      var _this$_eventManager6;
      (_this$_eventManager6 = this._eventManager) === null || _this$_eventManager6 === void 0 || _this$_eventManager6.updateUseWindowEvents(t);
    }
  }, {
    key: "data",
    get: function get() {
      return this._data;
    }
  }, {
    key: "_createProxyObject",
    value: function _createProxyObject(t) {
      var _t$parent,
        _this438 = this;
      if (t == null) return;
      if (this._proxyObjectCache.has(t.uuid)) return this._proxyObjectCache.get(t.uuid);
      var e;
      t.traverseAncestors(function (s) {
        s instanceof sr && (e = s.name);
      });
      var r = {
          name: t.name,
          uuid: t.uuid,
          visible: t.visible,
          intensity: t.intensity,
          position: t.position,
          rotation: t.rotation,
          scale: t.scale,
          type: t.data.type,
          page: e,
          parentUuid: t.parent instanceof sr || t instanceof Vl ? void 0 : (_t$parent = t.parent) === null || _t$parent === void 0 ? void 0 : _t$parent.uuid,
          emitEvent: function emitEvent(s) {
            t.dispatchEvent({
              type: "userEvent",
              eventName: s
            });
          },
          emitEventReverse: function emitEventReverse(s) {
            t.dispatchEvent({
              type: "userEvent",
              eventName: s,
              reverse: !0
            });
          }
        },
        i = _w(r, function (s, o) {
          var _Object$getOwnPropert;
          _typeof(t[s]) != "object" && (_Object$getOwnPropert = Object.getOwnPropertyDescriptor(t, s)) !== null && _Object$getOwnPropert !== void 0 && _Object$getOwnPropert.writable && (t[s] = o), _this438._requestRenderAutoMode(), t.updateMatrix();
        });
      return this._proxyObjectCache.set(t.uuid, i), i;
    }
  }, {
    key: "setUIWasmUrl",
    value: function setUIWasmUrl(t) {
      z0.skiaWasmUrl = t;
    }
  }]);
  return EN;
}();
},{"_bundle_loader":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/bundle-loader.js","./navmesh.js":[["navmesh.2d199a20.js","node_modules/@splinetool/runtime/build/navmesh.js"],"navmesh.2d199a20.js.map","node_modules/@splinetool/runtime/build/navmesh.js"],"./physics.js":[["physics.5c24407e.js","node_modules/@splinetool/runtime/build/physics.js"],"physics.5c24407e.js.map","node_modules/@splinetool/runtime/build/physics.js"],"./process.js":[["process.ce49c067.js","node_modules/@splinetool/runtime/build/process.js"],"process.ce49c067.js.map","node_modules/@splinetool/runtime/build/process.js"],"./boolean.js":[["boolean.75c07de5.js","node_modules/@splinetool/runtime/build/boolean.js"],"boolean.75c07de5.js.map","node_modules/@splinetool/runtime/build/boolean.js"],"./opentype.js":[["opentype.95073e17.js","node_modules/@splinetool/runtime/build/opentype.js"],"opentype.95073e17.js.map","node_modules/@splinetool/runtime/build/opentype.js"],"./ui.js":[["ui.ee823c81.js","node_modules/@splinetool/runtime/build/ui.js"],"ui.ee823c81.js.map","node_modules/@splinetool/runtime/build/ui.js"],"process":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/process/browser.js","buffer":"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/buffer/index.js"}],"js/index.js":[function(require,module,exports) {
"use strict";

var _runtime = require("@splinetool/runtime");
var canvas = document.getElementById('canvas3d');
var app = new _runtime.Application(canvas);
app.load('https://prod.spline.design/rRKMbzr1HiXTgr8N/scene.splinecode');
},{"@splinetool/runtime":"node_modules/@splinetool/runtime/build/runtime.js"}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/hmr-runtime.js":[function(require,module,exports) {
var global = arguments[3];
var OVERLAY_ID = '__parcel__error__overlay__';
var OldModule = module.bundle.Module;
function Module(moduleName) {
  OldModule.call(this, moduleName);
  this.hot = {
    data: module.bundle.hotData,
    _acceptCallbacks: [],
    _disposeCallbacks: [],
    accept: function (fn) {
      this._acceptCallbacks.push(fn || function () {});
    },
    dispose: function (fn) {
      this._disposeCallbacks.push(fn);
    }
  };
  module.bundle.hotData = null;
}
module.bundle.Module = Module;
var checkedAssets, assetsToAccept;
var parent = module.bundle.parent;
if ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {
  var hostname = "" || location.hostname;
  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';
  var ws = new WebSocket(protocol + '://' + hostname + ':' + "53518" + '/');
  ws.onmessage = function (event) {
    checkedAssets = {};
    assetsToAccept = [];
    var data = JSON.parse(event.data);
    if (data.type === 'update') {
      var handled = false;
      data.assets.forEach(function (asset) {
        if (!asset.isNew) {
          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);
          if (didAccept) {
            handled = true;
          }
        }
      });

      // Enable HMR for CSS by default.
      handled = handled || data.assets.every(function (asset) {
        return asset.type === 'css' && asset.generated.js;
      });
      if (handled) {
        console.clear();
        data.assets.forEach(function (asset) {
          hmrApply(global.parcelRequire, asset);
        });
        assetsToAccept.forEach(function (v) {
          hmrAcceptRun(v[0], v[1]);
        });
      } else if (location.reload) {
        // `location` global exists in a web worker context but lacks `.reload()` function.
        location.reload();
      }
    }
    if (data.type === 'reload') {
      ws.close();
      ws.onclose = function () {
        location.reload();
      };
    }
    if (data.type === 'error-resolved') {
      console.log('[parcel] ✨ Error resolved');
      removeErrorOverlay();
    }
    if (data.type === 'error') {
      console.error('[parcel] 🚨  ' + data.error.message + '\n' + data.error.stack);
      removeErrorOverlay();
      var overlay = createErrorOverlay(data);
      document.body.appendChild(overlay);
    }
  };
}
function removeErrorOverlay() {
  var overlay = document.getElementById(OVERLAY_ID);
  if (overlay) {
    overlay.remove();
  }
}
function createErrorOverlay(data) {
  var overlay = document.createElement('div');
  overlay.id = OVERLAY_ID;

  // html encode message and stack trace
  var message = document.createElement('div');
  var stackTrace = document.createElement('pre');
  message.innerText = data.error.message;
  stackTrace.innerText = data.error.stack;
  overlay.innerHTML = '<div style="background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;">' + '<span style="background: red; padding: 2px 4px; border-radius: 2px;">ERROR</span>' + '<span style="top: 2px; margin-left: 5px; position: relative;">🚨</span>' + '<div style="font-size: 18px; font-weight: bold; margin-top: 20px;">' + message.innerHTML + '</div>' + '<pre>' + stackTrace.innerHTML + '</pre>' + '</div>';
  return overlay;
}
function getParents(bundle, id) {
  var modules = bundle.modules;
  if (!modules) {
    return [];
  }
  var parents = [];
  var k, d, dep;
  for (k in modules) {
    for (d in modules[k][1]) {
      dep = modules[k][1][d];
      if (dep === id || Array.isArray(dep) && dep[dep.length - 1] === id) {
        parents.push(k);
      }
    }
  }
  if (bundle.parent) {
    parents = parents.concat(getParents(bundle.parent, id));
  }
  return parents;
}
function hmrApply(bundle, asset) {
  var modules = bundle.modules;
  if (!modules) {
    return;
  }
  if (modules[asset.id] || !bundle.parent) {
    var fn = new Function('require', 'module', 'exports', asset.generated.js);
    asset.isNew = !modules[asset.id];
    modules[asset.id] = [fn, asset.deps];
  } else if (bundle.parent) {
    hmrApply(bundle.parent, asset);
  }
}
function hmrAcceptCheck(bundle, id) {
  var modules = bundle.modules;
  if (!modules) {
    return;
  }
  if (!modules[id] && bundle.parent) {
    return hmrAcceptCheck(bundle.parent, id);
  }
  if (checkedAssets[id]) {
    return;
  }
  checkedAssets[id] = true;
  var cached = bundle.cache[id];
  assetsToAccept.push([bundle, id]);
  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {
    return true;
  }
  return getParents(global.parcelRequire, id).some(function (id) {
    return hmrAcceptCheck(global.parcelRequire, id);
  });
}
function hmrAcceptRun(bundle, id) {
  var cached = bundle.cache[id];
  bundle.hotData = {};
  if (cached) {
    cached.hot.data = bundle.hotData;
  }
  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {
    cached.hot._disposeCallbacks.forEach(function (cb) {
      cb(bundle.hotData);
    });
  }
  delete bundle.cache[id];
  bundle(id);
  cached = bundle.cache[id];
  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {
    cached.hot._acceptCallbacks.forEach(function (cb) {
      cb();
    });
    return true;
  }
}
},{}],"C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js":[function(require,module,exports) {
module.exports = function loadJSBundle(bundle) {
  return new Promise(function (resolve, reject) {
    var script = document.createElement('script');
    script.async = true;
    script.type = 'text/javascript';
    script.charset = 'utf-8';
    script.src = bundle;
    script.onerror = function (e) {
      script.onerror = script.onload = null;
      reject(e);
    };
    script.onload = function () {
      script.onerror = script.onload = null;
      resolve();
    };
    document.getElementsByTagName('head')[0].appendChild(script);
  });
};
},{}],0:[function(require,module,exports) {
var b=require("C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/bundle-loader.js");b.register("js",require("C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js"));
},{}]},{},["C:/Users/David/AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/hmr-runtime.js",0,"js/index.js"], null)
//# sourceMappingURL=/js.00a46daa.js.map